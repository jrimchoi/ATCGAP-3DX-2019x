define("DS/InstantMessagingW/js/model/IMWContactModel",["UWA/Class/Model","DS/RTProxyDriver/RTLogger"],function(b,a){return b.extend({defaults:{email:"mail@im.com",status:"Offline",login:"DefaultIM",username:"DefaultIM",tenants:"DefaultIM",avatarUrl:"./assets/avatarDefault.png",devEnv:false},setup:function(c){this.roles={}},setRole:function(d,e){var c=this.getRole(d);if(c&&c!=e){a.Widget("Replacing role "+c+" for user "+this.get("login")+" in room "+d)}this.roles[d]=e},getRole:function(c){return this.roles[c]},isOwner:function(c){return this.getRole(c)=="owner"}})});define("DS/InstantMessagingW/js/view/IMWdiscoveroom",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed"],function(f,b,d,a,c,e){return f.extend({tagName:"div",className:"IMWdiscoveroom2",setup:function(g){this.id="disco"+this.model.get("room_id");this.ctrl=g.ctrl;this.setRoomListeners()},setRoomListeners:function(){this.listenTo(this.model,"onChange:alreadyIn",this.updatePresence);this.listenTo(this.model,"onChange:msgqty",this.setMsgQty);this.listenTo(this.model,"onChange:userqty",this.setUserQty);this.listenTo(this.model,"onChange:lastmsgDate",this.updateLastMsg);this.listenTo(this.model,"onChange:name",this.updateName);this.listenTo(this.model,"onChange:pathImage",this.updateImage);this.listenTo(this.model,"onChange:description",this.updateDescription)},updateImage:function(){var g=this.model.get("pathImage");if(g){this.showRoomImg(g)}else{this.showDefaultSvg()}},updateName:function(){this.container.getElement(".card-title").innerHTML=this.model.get("name")},updateDescription:function(){this.container.getElement(".card-content").innerHTML=this.model.get("description")},setUserQty:function(){var g=this.model.get("userqty")>99?"+99":this.model.get("userqty");this.container.getElement(".discoUsersQtyTextSVG").innerHTML=g||"0"},setMsgQty:function(){this.container.getElement(".discoMsgQtyTextSVG").innerHTML=this.model.get("msgqty")||"0"},updatePresence:function(){if(this.model.get("alreadyIn")){this.showLeaveBtn();this.container.classList.add("alreadyIn");this.dispatchEvent("showToggle")}else{this.showJoinBtn();this.container.classList.remove("alreadyIn")}},updateLastMsg:function(){if(this.model.get("lastmsgDate")){var l=new Date(this.model.get("lastmsgDate"));var g=new Date((new Date().toISOString()).replace("Z","").replace("T"," "));var k=Math.floor((g-l)/1000);var j,h,i;if(k<60){i="seconds";j=k}else{if(k<3600){i="minuts";j=Math.floor(k/60)}else{if(k<86400){i="hours";j=Math.floor(k/3600)}else{if(k<604800){i="days";j=Math.floor(k/86400)}else{if(k<2419200){i="weeks";j=Math.floor(k/604800)}else{return this.container.getElement(".card-subtitle").innerHTML=e.LastMessage+" "+l.toLocaleDateString("en-US",{month:"short",year:"numeric"})}}}}}h=j>1?e[i]:e[i+"Singulier"];this.container.getElement(".card-subtitle").innerHTML=e.LastMessage+" "+j+" "+h}else{this.container.getElement(".card-subtitle").innerHTML=""}},joinOrLeaveFactory:function(){return(function(g){return function(){if(g.container.classList.contains("alreadyIn")){g.ctrl.leaveRoom(g.model)}else{g.ctrl.joinPublicRoom(g.model)}}})(this)},showRoomImg:function(g){this.container.getElement(".discoRoomImgSrc").classList.remove("hidden");this.container.getElement(".discoRoomImgSvg").classList.add("hidden");this.container.getElement(".discoRoomImgSrc").style.backgroundImage="url('"+g||this.model.get("pathImage")+"')"},showDefaultSvg:function(){this.container.getElement(".discoRoomImgSrc").classList.add("hidden");this.container.getElement(".discoRoomImgSvg").classList.remove("hidden")},showLeaveBtn:function(){this.container.getElement(".card-thumbnail").classList.add("card-thumbnail-selectable");this.container.getElement(".card-thumbnail").classList.add("card-thumbnail-selected")},showJoinBtn:function(){this.container.getElement(".card-thumbnail").classList.remove("card-thumbnail-selected")},showHover:function(){this.container.getElement(".card-thumbnail").classList.add("card-thumbnail-selectable")},hideHover:function(){if(!this.container.classList.contains("alreadyIn")){this.container.getElement(".card-thumbnail").classList.remove("card-thumbnail-selectable")}},render:function(){this.container.setContent([{id:this.model.get("name"),tag:"div","class":"card card-thumbnail",html:[{tag:"div","class":"fakeCardWidth"},{"class":"card-img",tag:"div",html:[{"class":"discoRoomImgSrc",tag:"div"},{"class":"discoRoomImgSvg hidden",tag:"div",html:d.room_default_recropped},]},{"class":"card-block card-thumbnail-title-bar",tag:"div",html:[{"class":"card-title",tag:"h4",html:this.model.get("name")},{"class":"card-subtitle",tag:"h4"}]},{"class":"card-block card-thumbnail-content",tag:"div",html:[{"class":"card-content",tag:"p",html:this.model.get("description")}]},{"class":"card-footer",tag:"div",html:[{"class":"badge badge-success",tag:"span",html:[{"class":"fonticon fonticon-globe",tag:"span"},{"class":"badge-content",tag:"span",html:e.Public}]},{"class":"badge badge-primary",tag:"span",html:[{"class":"fonticon fonticon-users",tag:"span"},{"class":"badge-content discoUsersQtyTextSVG",tag:"span",html:"0"}]},{"class":"badge badge-primary",tag:"span",html:[{"class":"fonticon fonticon-chat",tag:"span"},{"class":"badge-content discoMsgQtyTextSVG",tag:"span",html:"0"}]}]}]}]);this.container.addEvent("mouseover",(function(g){return function(){g.showHover()}})(this));this.container.addEvent("mouseout",(function(g){return function(){g.hideHover()}})(this));this.container.addEvent("click",this.joinOrLeaveFactory());this.updateImage();this.updatePresence();this.setUserQty();this.setMsgQty();this.updateLastMsg();this.tooltipDescription=new c({position:"",target:this.container.getElement(".card-content"),body:this.model.get("description")});this.tooltipName=new c({position:"",target:this.container.getElement(".card-title"),body:this.model.get("name")});this.container.id=this.id;return this}})});define("DS/InstantMessagingW/js/view/IMWMeInfo",["UWA/Class/View","DS/UIKIT/DropdownMenu","DS/RTColors/RTColors","DS/InstantMessagingW/assets/demo"],function(d,a,c,b){return d.extend({className:"IMWMeInfoView",setup:function(e){this.user=e.user;this.setStatus=e.setStatus;this._createContent();this.listenTo(this.user,"onChange:status",this.changeUserStatus.bind(this))},changeUserStatus:function(g){var e=this.user.get("status").toLowerCase();var f=c[e];this.container.getElement(".IM-user-status").style.background=f;this.container.getElement(".IM-user-status-txt").innerHTML=this.user.get("status");if(e==="offline"){this.container.getElement(".IM-me-img").style.opacity="0.3"}else{this.container.getElement(".IM-me-img").style.opacity="0.9"}this.setMyStatus({myStatus:this.user.get("status")})},_createContent:function(){var e=this;this.setContainer({tag:"div","class":"IMWMeInfoView",styles:{width:"100%"},html:{tag:"div","class":"IM-chatpanel-global",html:[{tag:"div","class":"IMWMeView",styles:{background:"#005686",height:"100px"},html:[{tag:"div","class":"IM-me-contact",styles:{"margin-left":"45px"},html:[{tag:"img","class":"IM-me-img",draggable:"false",src:document.rtcwidget_Swym_URL+this.user.get("login")+"/format"}]},{tag:"div","class":"IM-me-infos",html:[{tag:"div","class":"IM-chat-username",styles:{"font-size":"22px"},html:this.user.get("username")},{tag:"div","class":"IM-me-details",html:[{tag:"div","class":"IM-user-status me",styles:{background:c[this.user.get("status").toLowerCase()]}},{tag:"div","class":"IM-user-status-txt",html:this.user.get("status")},{tag:"span","class":"fonticon fonticon-down-open IM-user-status-dropdown"},{tag:"div","class":"IM-me-separator",html:(b[this.user.get("login")]?"|":""),styles:{"margin-left":"10px",opacity:"0.5"}},{tag:"div","class":"IM-me-place",html:(b[this.user.get("login")]?b[this.user.get("login")]:""),styles:{"margin-left":"10px",opacity:"0.5"}}]}]},{tag:"div","class":"IM-me-menu",styles:{"padding-top":"10px","padding-right":"8px"}}]}]}});this.buildDropDownMenu()},buildDropDownMenu:function(){var g=this;var i=this.container.getElement(".IM-user-status-dropdown");this.dropdownMenu=new a({target:i,items:[],events:{onClick:function(k,j){g.setStatus({myStatus:j.name,statusMsg:j.name});g.setMyStatus({myStatus:j.name,statusMsg:j.name})}}});this.dropdownMenu.getContent().style.zIndex="3000";var h={Offline:"Offline",Away:"Away",Busy:"Busy",Online:"Online"};var f;for(var e in h){this.dropdownMenu.addItem({text:e,name:e,icon:(e==="Online")?"fonticon fonticon-check":""})}},setMyStatus:function(g){var f=this;if(this.dropdownMenu){var e=this.dropdownMenu.items;e.forEach(function(h){if(h.name=="SignoutLIname"){return}if(h.name===g.myStatus){f.dropdownMenu.updateItem({id:h.id,text:h.text,name:h.name,icon:"fonticon fonticon-check"})}else{f.dropdownMenu.updateItem({id:h.id,text:h.text,name:h.name,icon:""})}if(h.elements&&h.elements.container&&h.elements.container.firstChild&&!h.elements.container.firstChild.className){h.elements.container.firstChild.destroy()}})}},inject:function(e){if(!this.container.isInjected()){this.container.inject(e)}}})});define("DS/InstantMessagingW/js/model/IMWMediaModel",["UWA/Class/Model"],function(a){return a.extend({defaults:{media_id:"noID",mime:null,name:null,path:null,icon:null,timeMedia:null,view:null},setup:function(f){try{var d=this.get("path").replace("/opt/data",document.rtcwidget_RTC_URL)}catch(c){var d=document.rtcwidget_RTC_URL+"/medias/"+this.get("name")}this.set("path",d);var b=document.rtcwidget_Assets_URL+"/I_UnknownFile200x150.png";switch(this.get("mime").toLowerCase()){case"gif":case"jpg":case"png":case"svg":b=this.get("path").replace("/opt/data",document.rtcwidget_RTC_URL);break;case"pdf":b=document.rtcwidget_Assets_URL+"/I_PDFdoc200x150.png";break;case"doc":b=document.rtcwidget_Assets_URL+"/I_TextDoc200x150.png";break;case"docx":b=document.rtcwidget_Assets_URL+"/I_TextDoc200x150.png";break;case"xls":b=document.rtcwidget_Assets_URL+"/I_TableDoc200x150.png";break;case"xlsx":b=document.rtcwidget_Assets_URL+"/I_TableDoc200x150.png";break;case"ppt":b=document.rtcwidget_Assets_URL+"/I_PresDoc200x150.png";break;case"pptx":b=document.rtcwidget_Assets_URL+"/I_PresDoc200x150.png";break;case"zip":case"rar":b=document.rtcwidget_Assets_URL+"/I_ZIPDoc200x150.png";break;case"3dxm":case"3dxml":b=document.rtcwidget_Assets_URL+"/I_3DXML200x150.png";break;case"stl":b=document.rtcwidget_Assets_URL+"/I_STL200x150.png";break;case"mp4":b=this.get("path").replace("/opt/data",document.rtcwidget_RTC_URL);break}this.set("icon",b)}})});define("DS/InstantMessagingW/js/view/IMW3DPlayPlayer",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Spinner","DS/UIKIT/Alert"],function(d,a,c,b){return d.extend({setup:function(e){this.room_id=undefined;this.uploadFile=e.uploadFile;this.launchCoreview=e.launchCoreview;this._createContent();this.ctrl=e.ctrl},_createContent:function(){var e=this;this.setContainer({tag:"div","class":"IM-3dplayer",styles:{display:"none"},html:[{tag:"div",id:"IMWActionBar","class":"IM-3dplayer-action",styles:{margin:"0px",display:"none"},html:[{tag:"div","class":"IM-3dplayer-feedback",styles:{width:"170px",height:"40px"}}]},{tag:"div","class":"IM-3dplayer-div",}]})},inject:function(e){this.container.inject(e)},startCoreview:function(){if(this.container.style.display!=="none"){var e=this;this._player.setCollabMode(true);this._player.addCollabCB(function(g,f){console.log("collab");e.sendCoreviewAction({arg1:g,arg2:f})});this.launchCoreview({room_id:this.room_id,path:this.path,fileName:this.fileName,mime:this.mime,start:true})}},sendCoreviewAction:function(e){this.launchCoreview({room_id:this.room_id,path:this.path,fileName:this.fileName,mime:this.mime,actions:e})},onCoreviewAction:function(e){this._player.performAction(e.arg1,e.arg2)},send:function(){var g=this.getElement(".IM-3dplayer-feedback");var f=this.getElement(".IM-3dplayer-action");f.style.display="inline-flex";var e=this;this._player.getScreenshot({onSuccess:function(h){console.log("URL received");var i=new XMLHttpRequest();i.open("GET",h,true);i.send();i.onload=function(k){console.log("svg");var j=i.responseText;e.uploadFile({room_id:e.room_id,mime:"svg",name:e.fileName,file:i.responseText});var l=new b({visible:true}).inject(g);l.add({className:"success",message:"Model shared !"});setTimeout(function(m){g.innerHTML="";f.style.display="none"},3000)}}})},display3dplayer:function(f){if(this.container.style.display==="none"){if(f){this.ctrl.view.chatPanelView.showShareBtn();this.mime=f.mime;this.room_id=f.room_id;this.fileName=f.fileName;this.coreview=f.coreview;if(this.path!==f.path){this.path=f.path;this.createPlayer(f.fileName)}this.container.style.display="block";this.divTop=(this.container.offsetHeight+59);this.container.style.top="59px";if(this._player&&this.coreview){this._player.setCollabMode(false)}}}else{this.container.style.top=this.divTop+"px";var e=this;if(this._player&&this._player.setCollabMode&&this._player.removeCollabCB){this._player.setCollabMode(false);this._player.removeCollabCB()}setTimeout(function(){e.container.style.display="none"},600)}},createPlayer:function(h){var e=this.container.getElement(".IM-3dplayer-div");var f={container:e,input:{asset:this.path},options:{loading:"autoplay",callbacks:{experience:{ExperienceReady:this.onExperienceReady.bind(this)},asset:{LoadingFinished:this.onLoadingFinished.bind(this)}}}};if(this._player){this._player.dispose()}var g=require("DS/3DPlayHelper/3DPlayHelper");this._player=new g(f)},onExperienceReady:function(e){if(this.coreview){this._player.setCollabMode(false)}},onLoadingFinished:function(e){}})});define("DS/InstantMessagingW/js/view/IMWPlayerVideoView",["UWA/Class/View"],function(b,a){return b.extend({tagName:"div",className:"IMWMessageView",setup:function(c){this.path=c.path;this.intervalRef=undefined;this.originSrc=undefined;this.tabImgs=[];this.video=undefined;this.played=false;this.isClickable=c.isClickable===undefined?true:c.isClickable;this._createContent(c)},_createContent:function(c){var d=this;this.video=UWA.createElement("video",{"class":"IM-video-player-video",crossOrigin:"Anonymous",autoplay:true,src:this.path,muted:true});this.video.oncanplay=function(){this.pause();this.oncanplay=""};this.setContainer({tag:"div","class":"IM-video-player",html:[{tag:"div",styles:{position:"relative"},html:[{tag:"div","class":"IM-video-player-icon",html:{tag:"span","class":"fonticon fonticon-play",styles:{color:"white",margin:"auto"}}},this.video]}],events:{click:function(e){if(d.isClickable){if(d.intervalRef){clearInterval(d.intervalRef)}d.video.currentTime=0;this.getElementsByClassName("IM-video-player-icon")[0].style.display="none";d.video.style.display="block";d.video.play();d.video.muted=false;d.video.controls=true;d.played=true}},mouseover:function(){if(!d.played){var f=2;var e=Math.floor(d.video.duration/8);if(e){d.video.currentTime=e;d.intervalRef=setInterval(function(){if(f===8){f=0}d.video.currentTime=e*f;f++},900)}}},mouseout:function(){if(!d.played){if(d.intervalRef){clearInterval(d.intervalRef)}d.video.currentTime=0}}}})},grab:function(){var e=document.createElement("canvas");e.height=this.video.videoHeight;e.width=this.video.videoWidth;var c=e.getContext("2d");c.drawImage(this.video,0,0,e.width,e.height);var d=e.toDataURL();return d},inject:function(d,c){if(c){this.container.inject(d,c)}else{this.container.inject(d)}}})});define("DS/InstantMessagingW/js/model/IMWShareContentModel",["UWA/Class/Model"],function(a){return a.extend({defaults:{shared:false,name:"",data:null},})});define("DS/InstantMessagingW/js/model/IMWMessageModel",["UWA/Class/Model"],function(a){return a.extend({defaults:{message_id:"noID",message:"no text",html:null,isSent:"DefaultIM",read_date:"none",createDate:"none",readBy:{},devEnv:false,user:{},fileId:null,fileName:null,data:null,origin:null,bot:false},setup:function(b){if(this.get("html")){this.set("message",this.get("html"))}if(this.get("message_id")==="noID"){this.set("message_id",UWA.Utils.getUUID())}if(this.get("read_date")===""){this.set("read_date","none")}}})});define("DS/InstantMessagingW/js/view/IMWContactView",["UWA/Class/View","DS/RTColors/RTColors","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed"],function(d,b,a,c){return d.extend({tagName:"div",className:"IMWContactView",setup:function(e){this.user=e.user;this.startChat=e.startChat;this._createContent();this.listenTo(this.user,"onChange:status",this.changeUserStatus.bind(this));this.room_id=e.room_id;this.absent=e.absent;this.setFonticonIfNeeded()},changeUserStatus:function(g){var e=this.user.get("status");var f=b[e.toLowerCase()];this.container.getElement(".IM-user-status").style.background=f;if(e.toLowerCase()==="offline"){this.container.getElement(".IM-contact-img").style.opacity="0.3"}else{this.container.getElement(".IM-contact-img").style.opacity="0.9"}},setFonticonIfNeeded:function(){if(!this.room_id){return false}if(this.user.isOwner(this.room_id)){var e=this.container.getElement(".IM-username-role");e.classList.remove("hidden");e.setText("Owner");if(this.tooltipRole){this.tooltipRole.destroy()}this.tooltipRole=new a({target:e,body:c.OwnerSentence,position:"left"})}if(this.absent){var e=this.container.getElement(".IM-username-role");e.classList.remove("hidden");e.setText(c.hasLeft||"has left");this.container.classList.add("absent")}return true},setFonticon:function(e){this.container.getElement(".IM-contact-fonticon").classList.remove("hidden");this.container.getElement(".IM-contact-fonticon").classList.add(e)},_createContent:function(){var e=this;this.setContainer({tag:"div","class":"IMWContactView",html:[{tag:"div","class":"IM-contact",html:[{tag:"img","class":"IM-contact-img",draggable:"false",src:document.rtcwidget_Swym_URL+this.user.get("login")+"/format"},{tag:"div","class":"IM-user-status contact",}]},{tag:"div","class":"IM-contact-details",html:[{tag:"div","class":"IM-username",text:this.user.get("username")},{tag:"div","class":"IM-username-role hidden"}]}],events:{click:function(f){}}});this.changeUserStatus()},inject:function(e){this.container.inject(e)}})});define("DS/InstantMessagingW/js/view/smileycodes",[],function(){var a=[];a[0]=";)";a[1]=":(";a[2]=":angry:";a[3]=":)";a[4]="^^";a[5]="(y)";a[6]="<3";a[7]=":hourglass:";a[8]=":D";a[9]=":mug:";return a});define("DS/InstantMessagingW/js/view/IMWfmot",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed","DS/UIKIT/Spinner"],function(g,b,e,a,d,f,c){return g.extend({tagName:"div",id:"FMOT",setup:function(h){this.loading()},show:function(){this._parent();this.isHidden=false},hide:function(){this._parent();this.isHidden=true},setForUser:function(i){this.render();var h=document.rtcwidget_Swym_URL+i.get("login")+"/format";this.container.children.fmotAvatar.children.fmotAvatarImg.src=h},loading:function(){this.container.setContent([{id:"spinner",tag:"div",html:[{id:"spinnerspan",tag:"span",html:"Loading"}]},]);this.spinner=new c().inject(this.container.children.spinner).show()},render:function(){if(this.spinner){this.spinner.destroy()}this.container.setContent([{id:"fmotAvatar",tag:"div",html:[{"class":"divider",tag:"p"},{id:"fmotAvatarImg",tag:"img"},{id:"welcome",tag:"div",html:[{id:"fmotWelcomeText",tag:"div",html:f.fmotWelcomeText},{id:"fmotStartText",tag:"div",html:f.fmotStartText}]},]},{id:"fmotCreation",tag:"div",html:[{id:"fmotChannel","class":"fmotcontainer",tag:"div",html:[{id:"fmotChannelImg","class":"fmotimg",tag:"div",html:[{id:"fmotChannelSVG",tag:"div",html:e.room_default_recropped},{id:"fmotChannelInfo",tag:"div","class":"fonticon fonticon-info "}]},{id:"fmotChannelButton",tag:"div"}]},{id:"fmotDM","class":"fmotcontainer",tag:"div",html:[{id:"fmotDMImg","class":"fmotimg",tag:"div",html:[{id:"fmotDMSVG",tag:"div",html:e.group_chat},{id:"fmotDMInfo",tag:"div","class":"fonticon fonticon-info "}]},{id:"fmotDMButton",tag:"div"}]},{id:"fmotDiscover","class":"fmotcontainer",tag:"div",html:[{id:"fmotDiscoverImg","class":"fmotimg",tag:"div",html:[{id:"fmotDiscoverSVG",tag:"div",html:e.magnifier},{id:"fmotDiscoverInfo",tag:"div","class":"fonticon fonticon-info "}]},{id:"fmotDiscoverButton",tag:"div"}]}]}]);this.channelBtn=new a({value:"Room",className:"primary"}).inject(this.container.getElement("#fmotChannelButton"));this.dmBtn=new a({value:"Direct Message",className:"primary"}).inject(this.container.getElement("#fmotDMButton"));this.discoverBtn=new a({value:"Discover",className:"primary"}).inject(this.container.getElement("#fmotDiscoverButton"));this.channelBtn.addEvent("onClick",(function(h){return function(){h.dispatchEvent("startChannelCreation")}})(this));this.dmBtn.addEvent("onClick",(function(h){return function(){h.dispatchEvent("startDMCreation")}})(this));this.discoverBtn.addEvent("onClick",(function(h){return function(){h.dispatchEvent("showBigDisco")}})(this));this.tooltiChannel=new d({position:"right",target:this.container.children.fmotCreation.children.fmotChannel.children.fmotChannelImg.children.fmotChannelInfo,body:f.ChannelCreationInfo});this.tooltiChannel=new d({position:"right",target:this.container.children.fmotCreation.children.fmotDM.children.fmotDMImg.children.fmotDMInfo,body:f.DMCreationInfo});this.tooltiDiscover=new d({position:"right",target:this.container.children.fmotCreation.children.fmotDiscover.children.fmotDiscoverImg.children.fmotDiscoverInfo,body:f.DiscoverInfo})}})});define("DS/InstantMessagingW/js/view/IMWBOTMessageView",["UWA/Class/View","DS/UIKIT/Input/Select","DS/UIKIT/DropdownMenu","DS/WAFData/WAFData"],function(c,d,b,a){return c.extend({tagName:"div",className:"IMWBOTMessageView",setup:function(e){this.searchUser=e.searchUser;this.assignTask=e.assignTask;this.listOfValues={Create:"Preliminary",Assign:"Ready",Active:"In Work",Review:"In Review",Complete:"Complete"};this.dropdowns={};this._createContent(e)},_createContent:function(u){var p=this;var t=u.message.get("message");this.message=t;var s=u.message.get("origin");var k=t.tasks;var f=t.apps;var l=t.projects;var q=new Date(u.message.get("createDate"));var g={weekday:"long",month:"long",day:"numeric"};var e=q.toLocaleDateString("en-US",g);var o=q.getHours();var j=q.getMinutes();var r=(o<10?"0"+o:o)+":"+(j<10?"0"+j:j);this.setContainer({tag:"div","class":"IMWMessageView-global",draggable:"false",html:[{tag:"div","class":"IMWMessageView",html:[{tag:"div","class":"IM-message-contact",html:[{tag:"img","class":"IM-message-contact-img",draggable:"false",styles:{"border-radius":"0"},src:t.icon}]},{tag:"div","class":"IM-message-details",html:[{tag:"div","class":"IM-message-user",html:[{tag:"div","class":"IM-message-username",html:t.title},{tag:"div","class":"IM-message-time",html:r}]},{tag:"div","class":"IM-message-text",html:t.txt}]}]},{tag:"div","class":"IM-message-bot-tasks",styles:{"margin-left":"20px"}}]});if(k&&k.length){for(var n=0;n<k.length;n++){this.addTask(k[n])}}if(f&&f.length){for(var n=0;n<f.length;n++){this.addApp(f[n])}}if(l&&l.length){for(var n=0;n<l.length;n++){this.addProjects(l[n])}}if(u.message.get("origin")=="webservice"){this.setContainerForWS()}},setContainerForWS:function(){try{this.message.txt=this.message.txt.replace(/\\n/g,"");var i=JSON.parse(this.message.txt);var g=i.type;var h=i.value.content||i.value.htmlContent;var f=i.value.link||i.enclosures&&i.enclosures.link}catch(k){return console.error(k)}var j=this.container.getElement(".IM-message-text");j.innerHTML="";j.setContent({tag:"div",html:[{tag:"div",html:h}]});if(g=="Continuous Delivery"){this.container.getElement(".IM-message-username").innerHTML="Delivery Pipeline";this.setIcon()}else{if(g=="Service Monitoring"){this.container.getElement(".IM-message-username").innerHTML="Service Supervision";this.setIcon()}else{if(g=="CollaborativeTasks"){this.container.getElement(".IM-message-username").innerHTML="Collaborative Task";this.setIcon("https://devopsrioqe420211432-euw1-20dsw10517-space.3dx-staging.3ds.com/enovia/widget/images/MyApps/ENOTASK_AP_AppIcon.png")}}}},setIcon:function(e){var f=e||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAANqElEQVR4XuWbCVhTVxbH/wkQEhIgBIJUC4IIKKJFQcWl2jqCS11AZKp+tmpHsNbWpdZqp45LR1udTmvrV2vd0S72q2ur1hW0UlutIhSXio5CgbqxE7KQ7c13XvIggbCIQdOZ9303Ly/vvvvu+d1zzj13CQ//5wfvscofMyEQjD5e5iVdUFZe2b5+XVxdBTpPd4+8+6WlO2Fg9uP8rmx71/exAZCPmLGmuKxsro/cBz17RyEsPBxubm4AGDAM+4nS4hIU5Bcg+0ImSktK4OEuya6qVszD2d2n7AXi0QOIjJdKfWU5Wp3Bf2xSImJHDiNpWYEZkor7bj6broHcq7/h4N79uPHbNYjEotXq9B2L7AHh0QKIjJf6BbS/5SIUeU1/ZQb8AzuCYRoKXqcFBMR0n9OKk0eOYfeXO+HuLt6jOJE6/mEhPFIAPiOSr8DJOXzZ6nchqqfuXEvXATELzmoFB8F0Pnf6DL7YvAVgeAn45Zv9DwPh0QGISZoKBtuWrVoJ/8CA2hatFdz8hTUFs9pbtr6lb6CsBOBKVnaFMn27l2MBiBn/DMB/Bgwj9ZBIBkvEQneFSlPgxOf3CY98SvzSzJRG7Zxa39TgTfsDultWXIJ3Fix6aC2wnwb0Top09xCfUlQrPf07BsBNLAZ5eB+5HAX5+bh29RqWrloJb7k328JN2XlLnCJB+vfSd6CsKFtdeSK11Q7RPgB6J0W6uQkzu3Tvxp849QX4+PjUOq76qmtyaFwLN27nlr1BY7D27/waN3J+vXn3wPrOrTUDuwDwj591XuzlHb1w6dtNdmWsuFbdnLWXbxKWDd9w9NsDOH30qK6mRvspGN6p1jhEuwBA3yTm1TfmoVd0VLP9eaN23kQM0Ngz/7l2HVeysnC7sAi3rl+HRCKuqq6uXopzuz9qqUbYDcDSVSvYfr1Z1bXRrTX7jFVQZNtBlpeUIvOnn5F28BDEEnG2srTiWWTvr2gOxIMBiIyXQugS7yYWj5IIRd3VNRo/haLag16y4B9/R2h4FzMAU2TXanXn+v1WwCJt2PLhGjjxeHnKk9s72Q9A3/FzXVwEq3Q6nWvP6CgEBHaEyE0Eb7kchfm/o//gpyFjnR8nuMnZtbRbsyesO4WF2LrmY3r1as2ppkPmFmmAcNAL6zU1mpfHjh+H2JHDWcHrx+326NbsCevnk+k4snsvwHMKwtmv8xvThOYBsENWQ97EKZMxdMRwq9Hag4Sv9rBzy/e1BNbqBW9Co1bNa8opNg+gOSP6k9+3BhAzPhUMb8pDycRjtuPs7qlsGY5eHgBrAH2TGE+JGyJDAmsZGBgGOgMlI3RGBnpzMhgZGM1OjstcUV6OiooK4NwuU7kOVt7dO3eg0Wjq6mcLwOCe4Ti1flktAEWNHsVKLUqUWpSqdChX61Cp0aNaq4dGb7RSlpNpaaBkCcCRytu6aRPy8/KaBjAwsisyPlvOClajN6JCo0OZSocytelM11UsAAO0huYBOFJ5LQIQ070LvvtoMXg8QKtnoNTq2RYnwelMibRCpTOw5mB52NIARyqvRQCiuoVhx3sLWedAAqr1BlTXGKDQkuAGVnil1gCN3mAe1tYh4AD8sGEl++PgGW/DkcprEYCnuoZg7ZL5rAaQhtcYjFDrDFBpDVDqDKzwdF2/9UlgDkB1+nYWgGTIFDhSeS0CEB7WGSsXzmE1gDSc7JwgaHQmEOT46ts+pwMcAEVaKvuT+1+mwpHKaxGAsJBgLJo7yxTDm82ABNaygjONCm+pAVUntrHPewydBkcqr0UAgoM7Yfasl00AGIDiAMu+v6kgidOAyuNb2GyesX+DI5XXIgBBQUFInpFSqwE0oqvn7BtlwAGoOLaZzSONmw5HKq9FAAKDgvBScnJTDd0sgPKjm9g8XsOS4UjltQiAUCiE3xNPtAoAFwqXHdnIPi8bngKpVIqeUVGtKi/v1i02crNXeVmZmdaheoNQ2A6Dl4lD+2HdfNNYaNYHqdh54udWCc89ZO/yYDlYawDA9FbqAfmUVn11JMHHW/bl9CXvO9uSovT7z1olnPdIk5Otf9i7vNQVb2ruFpdOWTRp+D7q1c3JKnytPx9A1xwA508PZOwIaidLGvFa3eDIstIlh9a3CoDPczNtPmfv8jI2rcTFm3e/nZMwaAL16BYAaiHYAkCt7wTA5cP9GXdGRga5d3l+ns0KF7cSgLwRAPYuL2/PWuw6d0PzZuIgHwA6AIb6WmALgBOiRg3xlvlOkHp6TL1Z+EeTs0b9I0IwoEco+ncPwYDuoTZBnbl0HT9duoEzOdfx0+UbTWqNvcsL9u9g1Or1+wsL8zcg82C6GYJNDeDU3xl9k2pao9v3D6yz+ZjvaFNk+aCHvcvDuV2uZlNgV+g4h8fVq9b2AQiX70wrSuwdLJG7ix603g6Vv0qtReqP1zQrJ8f6AdDU8wVWU2IEgGxfMPGtD3sHdYtInx3bg/yBQx++cl+oVCqoNWoYDGTiDY9NJ68ofi8semXzgil7AWgtzYCz7zr1BwQLt363PaS977hRkR0dWniq3Nix8Zg8eTISEhIgk8mg0aih1ZKMdcf5vPs4nn1z39qZ4140A6AegTUDSwDU2i4AXOdtPVw0pmegpIuf1CYAPz/SJuvj7t27DX6zla8xoraep7zNlREREcG2vF6vR3x8PBITExEdHQ2lUgm1Ws2+rkKlxbq0S5pPUkZRxcm/UY9AcYEVAFb9R897t3dA1x7pi0f3alT9p0yZyqqdZTp37mwD2SifTqdjK2frbPlbVtZFm2yoDE5AOlt+p3Lr/0bXoaGhmDRpEkawCzmmY9WhbM29P4pSvl6assfSDDjVpzNFe4K56/f8K6hDu5lJ0UGNqv/UqdMaADh7tmHIS/laCuDixUyb76MyHhSAXC5HcvJ0jBkzprbMg78W4Exuwb7tc5+3MgPLyI9V/+R1+3PH9wluF9FB5vD2TxWMi42rBdS/f38k/TUJvXr1alD32xVKrD12WfP53HFWZsABYNW/34uvhwX3GnhhdVIfh/f+nIQJCeMwdOhQJCaOa9ZfLN57QXPvdlHK9++9WmsGln2/YPCsFbExMX33zh7S9U/R+g9ayT1Zhczh81c+OLx8Oi18UFeh5/p+Vv37pSyJGzDg6W+Wj+8PlUrJ2q/RaL348aAvfdz5+Xw+XFxcIJFIsDE9BwcystacWDWTALC9Qa3zAyDqOWVBnCSg21cfT4tDz6DWTYo8boEbe3/apTzM234CXnz1x6ffn/NPANRHagmAwJzEERNmxzn7d99RUKqAp8gVHkIBxK4uELo4w8WJb976Zr13t+GuTtv3ua1x3J5fyx2iXBmWeSw3XHC7R0k47nlurpIWaI3mhVrSVlq0pYlcA/fdQL8Z2YndsHaeNS6Ke8syNy6haWslB4AGCEJaxwhLeHmYS6deW26XV/9PAujSzlOpuZU1O3ffZ8cAKMgMSANotEPJI/i56XGC0KgN9yrVbQ5gdI8ATIrpDIlIgAq1DrvO38KeCzdtbLA0b6U3D2AfRgM6yyVKZe75+fnfbyMAVWQGBEAMgP6p4On91KAeHWIn7y4qq+Y9KhOQewiROn0Ijl0uwgdHstsUQKDMTaXMPbuw6OgXBIC20KkIgLsZAgX+vhHzN/xwu1zZ5hpAkg4M9cPrcT1QqtJi2paTtVto6+8ltpcPeNJTqFJd/XHxnZPfEIByANUEgPb5SWganwCEzVmfXqxoexN4ISYEI3v44/DlInTtIIOvhwhSsRAKjQ4TP6X61W2btxcAP4mrSn01Y+n907uPAygjP0AAPC0AtAt69ZMTlSptm2nAG3ER6P6kDHweH9VaHQ7lFKJfyBMIb+/FasHdSlWD3eR2A+Ah1Jcc35qsvJGdA6DUFgDfJ2euTVPV6NsMgI9EiNeGhIPH46GHvwz3qjR4a88v2DFjKPKKFUjeRqbAdni1f5ywFwC5uxBF62ePBHDPrAFVnAmQIyQT8GmX8tEPOr2xzQCkThuIYkUNOvl6wonPw+aMXOy7mI+l8b3xdFh7zP4iAzmF1Dj2ByB1E+DexrnDABRbmgA5QbYXoNUs6YurjvKdBR5t0QvMjw1Hn06+4PH4oBB114VbGNE9AK4CZ0hErqhU08TFZaRdKWoTAGKBM8q2vv6sWf2pF2CdILU+BUIEQuo2YcVegUgU5OUmtHskuDN5EGhj2a9F5dj643XcV2jYvcW+7iL4eIhwqbC0zbpBWuF2gqGq+vNFpAHUA1AcwHaDFARRNEha4O4UOSLapdvgbc5OfJ6nSOgscObDmU8tZpo947YGmrdBW+0TMpmueTs7N+/M/QHK6n+BdRG75eZqk+XXfXCT93W/me9bmge9r/ZPGKbvFB5zoTKdDUaDnh7RF+Qs02d8ddAsfDXNEpNUJDyNBkkLCIYY3sHt0TlqAN9d1pVhDAIYjM5g9E5gGD6b2IN2ETnawTDg8QkHA56TATwnPY/P10OrKjTmnjqO4qI7pPbmcQBNkbOhMAnPToiYYXAguBCZrukel4/ychMpDkfAYhGUZn5pzE/DXhr5WSYSnu6xw2ESiFqV5gQpsXMDFqNEuqZE99hVY4tVZUfSAkuLoUkMWiQgCDQDTMJyMFjBzfcM3IwQdyYYlDgY3HcOEie8IwleXwu5ZS8OAgeCYFCiay4Z/wtxqxLY2piLyQAAAABJRU5ErkJggg==";this.container.getElement(".IM-message-contact-img").src=f},addProjects:function(g){var e=this.container.getElement(".IM-message-bot-tasks");var f=UWA.createElement("div",{"class":"IMWMessageView",styles:{"border-left":"4px solid rgb(0, 86, 134)"},html:[{"class":"IM-message-details",styles:{display:"inline-grid",},html:[{tag:"div","class":"IM-message-user",html:[{tag:"div","class":"IM-bot-title",html:g["dsxplan:label"]},{tag:"div","class":"IM-message-time",html:""}]},{tag:"div","class":"IM-message-text",styles:{background:"transparent",display:"inline-flex"},html:[{tag:"div","class":"IM-BOT-tast-state",html:"ID : "+g["@id"]}]}]}]});f.inject(e)},addApp:function(g){var e=this.container.getElement(".IM-message-bot-tasks");var f=UWA.createElement("div",{"class":"IMWMessageView",styles:{"border-left":"4px solid rgb(0, 86, 134)"},html:[{tag:"div","class":"IM-message-contact",styles:{"margin-left":"5px"},html:[{tag:"img","class":"IM-message-contact-img",draggable:"false",styles:{"border-radius":"0"},src:g.icon}]},{"class":"IM-message-details",styles:{display:"inline-grid","margin-left":"10px"},html:[{tag:"div","class":"IM-message-user",html:[{tag:"div","class":"IM-bot-title",html:g.title},{tag:"div","class":"IM-message-time",html:g.state}]},{tag:"div","class":"IM-message-text",styles:{background:"transparent",display:"inline-flex"},html:[{tag:"div","class":"IM-BOT-tast-state",html:g.detail}]}]}]});f.inject(e)},addTask:function(h){var f=new Date(h.dataelements.originated);var e=this.container.getElement(".IM-message-bot-tasks");var k=UWA.createElement("div",{"class":"IMWMessageView",styles:{"border-left":"4px solid rgb(0, 86, 134)"},html:[{"class":"IM-message-details",styles:{display:"inline-grid"},html:[{tag:"div","class":"IM-message-user",html:[{tag:"div","class":"IM-bot-title",html:h.dataelements.title,events:{click:function(m){console.log("3DIM - TASK click");if(window.parent.location.href.indexOf("/app:ENOTASK_AP/content")>-1){var n=window.parent.location.href.substring(window.parent.location.href.indexOf("/app:ENOTASK_AP/content"),window.parent.location.href.length);window.parent.location.href=window.parent.location.href.replace(n,"")}window.parent.location.href+="/app:ENOTASK_AP/content:ids="+h.id}}},{tag:"div","class":"IM-message-time",html:f.toDateString()}]},{tag:"div","class":"IM-message-text",styles:{background:"transparent",display:"inline-flex"},html:[{tag:"div","class":"IM-BOT-tast-state",html:this.listOfValues[h.dataelements.state]},{tag:"span","class":"fonticon fonticon-down-open BOT-task-dropdown BOT-task-dropdown_"+h.id},{tag:"div",styles:{"margin-left":"10px",display:"inline-flex"},html:[{tag:"div",html:"Assigned: "},{tag:"div",contenteditable:"true",html:(h.relateddata.assignees.length!==0&&h.relateddata.assignees[0].dataelements&&h.relateddata.assignees[0].dataelements.firstname&&h.relateddata.assignees[0].dataelements.lastname)?h.relateddata.assignees[0].dataelements.firstname+" "+h.relateddata.assignees[0].dataelements.lastname:"",events:{keydown:function(n){console.log("3DIM - Edit Assign");n.stopPropagation();if(n.keyCode===13&&this.innerHTML!==""){var o=this.innerHTML;var m=this;i.searchUser(o,function(p){var q=p.data[0].dataelements.firstname+" "+p.data[0].dataelements.lastname;i.assignTask({user:p,task:h},function(r){m.innerHTML=q})})}}},styles:{"white-space":"nowrap",width:"200px",overflow:"hidden"}}]}]}]}]});k.inject(e);var l=this.container.getElement(".BOT-task-dropdown_"+h.id);var i=this;var g=new b({target:l,items:[],events:{onClick:function(q,o){q.stopPropagation();var p=o.name;var n=document.rtcwidget_Space_URL+"/resources/v1/modeler/tasks?tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader.Company%20Name.Common%20Space&e6w-lang=en&e6w-timezone=-120&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&xrequestedwith=xmlhttprequest";var m=document.rtcwidget_Space_URL+"/resources/v1/modeler/tasks/"+h.id+"?tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader.Company%20Name.Common%20Space&e6w-lang=en&e6w-timezone=-120&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&xrequestedwith=xmlhttprequest";a.authenticatedRequest(n,{method:"GET",type:"json",timeout:60000,onComplete:function(s){console.log("TASKS get TOKEN Reponse : ",s);var r=Date.now();var t={csrf:s.csrf,data:[{id:h.id,updateAction:"MODIFY",cestamp:h.cestamp,dataelements:{state:p}}]};a.authenticatedRequest(m,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(t),onComplete:function(v){console.log("TASKS Update Reponse : ",v);var u=g.items;u.forEach(function(w){if(w.name===p){g.updateItem({id:w.id,text:w.text,name:w.name,icon:"fonticon fonticon-check"})}else{g.updateItem({id:w.id,text:w.text,name:w.name,icon:""})}})}})}});i.container.getElement(".IM-BOT-tast-state").innerHTML=i.listOfValues[p]}}});g.getContent().style.zIndex="3000";for(var j in this.listOfValues){g.addItem({text:this.listOfValues[j],name:j,icon:(j===h.dataelements.state)?"fonticon fonticon-check":""})}},inject:function(f,e){if(e){this.container.inject(f,e)}else{this.container.inject(f)}}})});define("DS/InstantMessagingW/js/view/IMWShareContentView",["UWA/Class/View","DS/UIKIT/Spinner"],function(b,a){return b.extend({tagName:"div",className:"IMWShareContentView",setup:function(c){this._createContent(c);this.listenTo(this.model,"onChange:shared",this.onStateChange.bind(this))},_createContent:function(c){var d=this;this.setContainer({tag:"div","class":"IM-DnD-item",html:[{tag:"span","class":"fonticon fonticon-cloud-upload IM-DnD-item-ulpload"},{tag:"div","class":"IM-DnD-item-detail",html:this.model.get("name")},{tag:"div","class":"IM-DnD-item-state",html:[this.spinner=new a({visible:true})]},{tag:"div","class":"IM-DnD-item-state-shared",html:"Shared"},{tag:"span","class":"fonticon fonticon-cancel IM-DnD-item-close",styles:{display:"none"},events:{click:function(e){d.remove()}}}]})},onStateChange:function(c){var d=this;this.container.getElement(".IM-DnD-item-state").style.display="none";this.container.getElement(".IM-DnD-item-state-shared").style.display="block";this.container.getElement(".IM-DnD-item-close").style.display="block";setTimeout(function(){d.remove()},10000)},inject:function(e,c){if(c){this.container.inject(e,c)}else{this.container.inject(e)}var d=new UWA.Fx(this.container,{duration:250,transition:"linear"});d.start({opacity:[0,0.9]})},remove:function(){var d=this;var c=new UWA.Fx(this.container,{duration:250,transition:"linear",events:{onComplete:function(){d.destroy()}}});c.start({opacity:0,height:0})}})});define("DS/InstantMessagingW/js/model/IMWRoomModel",["UWA/Class/Model","UWA/Class/Collection","DS/InstantMessagingW/js/model/IMWMessageModel","DS/InstantMessagingW/js/model/IMWContactModel","DS/InstantMessagingW/js/model/IMWMediaModel"],function(d,b,c,a,e){return d.extend({defaults:{name:"default conversation",room_id:"noID",devEnv:false,nway:false,directmessage:null,pathImage:null,description:null,security:null,type:null,date_in:null,active:false,userqty:null,mediaqty:null,msgqty:null,alreadyIn:null,lastmsgDate:null},isChannel:function(){return !this.get("directmessage")},setup:function(f){this.messages=new b([],{model:c});this.users=new b([],{model:a});this.usersLeft=new b([],{model:a});this.medias=new b([],{model:e,comparator:"timeMedia"});this.sharedContent=new b([],{});this.mySharedContent=new b([],{});this.lastMessage=undefined;if(f.imgpath){this.set({pathImage:f.imgpath})}if(this.get("pathImage")){this.set({pathImage:this.get("pathImage").replace("/opt/data",document.rtcwidget_RTC_URL)})}if(this.get("directmessage")){this.listenTo(this.users,"onAdd",this.addUser.bind(this))}},addUser:function(f){if(this.users.length===1){this.set("name",f.get("username"))}else{this.set("name",this.get("name")+", "+f.get("username"))}},addMedia:function(k){var f=this.medias.where({media_id:k.media_id});if(f.length===0){var j=k.date||k.message.date||k.message.createDate;var g=new Date(j);if(g=="Invalid Date"){g=new Date(Date.parse(j.replace(" ","T")))}var i="";var h=new e({media_id:k.media_id,mime:k.mime,name:k.name,path:k.path,icon:i,timeMedia:g.getTime()});this.medias.add(h)}},addMessage:function(g){var k=this.messages.where({message_id:g.message_id});if(k.length===0){var q=g.date||g.createDate||g.dateMsg;if(!q){var s=new Date();var p=s.getUTCFullYear();var h=s.getUTCMonth()+1;var n=s.getUTCDate();var r=s.getUTCHours();var l=s.getUTCMinutes();var j=s.getUTCSeconds();q=p+"-"+(h<10?"0"+h:h)+"-"+(n<10?"0"+n:n)+" "+(r<10?"0"+r:r)+":"+(l<10?"0"+l:l)+":"+(j<10?"0"+j:j)+"Z"}var o=new Date(q);if(o=="Invalid Date"){o=new Date(Date.parse(q.replace(" ","T")))}var i=this.users.where({login:g.login||g.from})[0];if(g.login=="BOT2"){i=document.bot2}var t=new c({origin:g.origin,message_id:g.message_id,message:g.message,html:g.html,isSent:g.isSent,read_date:g.read_date,fileId:g.fileId,fileName:g.fileName,data:g.data,createDate:o.getTime(),readBy:{},devEnv:false,user:i,bot:g.bot||false});var f=t.get("createDate");if(!this.lastMessage||this.lastMessage.get("createDate")>=f){this.lastMessage=t}this.messages.add(t);if(g.origin==="media"){this.addMedia({media_id:g.data.media_id,mime:g.data.mime,name:g.data.name,path:g.data.path,date:o.getTime()})}return t}else{return{error:"Message already exist"}}},cleanMedias:function(){this.medias.reset()},updateInfos:function(f){if(f.type){this.set("type",f.type)}if(!this.isChannel()){return true}if(f.name){this.set("name",f.name)}if(f.description){this.set("description",f.description)}if(f.security){this.set("security",f.security)}if(f.pathImage){this.set("pathImage",f.pathImage)}}})});define("DS/InstantMessagingW/js/view/IMWMessageView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWPlayerVideoView","DS/InstantMessagingW/js/view/smileycodes"],function(c,b,a){return c.extend({tagName:"div",className:"IMWMessageView",setup:function(d){this.message=d.message;this.isSystem=d.message.get("origin")=="system";this.display3dplayer=d.display3dplayer;this.maximizeChat=d.maximizeChat;this._createContent(d);var e=this.container.getElement(".IMWMessageView-title.unread");if(e){setTimeout(function(){var f=new UWA.Fx(e,{duration:400,transition:"linear",events:{onComplete:function(g){e.destroy()}}});f.start({opacity:0})},5000)}},_createContent:function(e){var p=this;var E=this.message.get("user");var C=this.message.get("fileName");var f="";if(C){f=C.substr(C.indexOf(".")+1,C.length)}var o=undefined;var r=false;var g="toto";if(E&&E.get){var s=E.get("login");g=E.get("username");o=document.rtcwidget_Swym_URL+s+"/format";r=true}else{g=document.rtcwidget_Me.get("username");o=document.rtcwidget_Swym_URL+document.rtcwidget_Me.get("login")+"/format"}var u=new Date(this.message.get("createDate"));var d={weekday:"long",month:"long",day:"numeric"};var t=u.toLocaleDateString("en-US",d);var z=u.getHours();var x=u.getMinutes();var l=(z<10?"0"+z:z)+":"+(x<10?"0"+x:x);if(e.message.get("origin")!="bot"){var k=this.message.get("message");var A=a;for(var y in A){var q="";while(q!==k){q=k;k=k.replace(A[y],'<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(y,10)+1)+'.svg">')}}}else{k=e.message.get("message");if(k===""){k=e.message.get("html")}}if(e.message.get("origin")==="media"){var w=document.rtcwidget_Assets_URL+"/I_UnknownFile200x150.png";var n="IMWMessageView-media-img";var B=false;switch(e.message.get("data").mime.toLowerCase()){case"gif":case"jpg":case"jpeg":case"png":case"svg":w=e.message.get("data").path.replace("/opt/data",document.rtcwidget_RTC_URL);break;case"pdf":w=document.rtcwidget_Assets_URL+"/I_PDFdoc200x150.png";n="IMWMessageView-media-thumb";break;case"doc":w=document.rtcwidget_Assets_URL+"/I_TextDoc200x150.png";n="IMWMessageView-media-thumb";break;case"docx":w=document.rtcwidget_Assets_URL+"/I_TextDoc200x150.png";n="IMWMessageView-media-thumb";break;case"xls":w=document.rtcwidget_Assets_URL+"/I_TableDoc200x150.png";n="IMWMessageView-media-thumb";break;case"xlsx":w=document.rtcwidget_Assets_URL+"/I_TableDoc200x150.png";n="IMWMessageView-media-thumb";break;case"ppt":w=document.rtcwidget_Assets_URL+"/I_PresDoc200x150.png";n="IMWMessageView-media-thumb";break;case"pptx":w=document.rtcwidget_Assets_URL+"/I_PresDoc200x150.png";n="IMWMessageView-media-thumb";break;case"3dxm":case"3dxml":w=document.rtcwidget_Assets_URL+"/I_3DXML200x150.png";n="IMWMessageView-media-thumb";break;case"stl":w=document.rtcwidget_Assets_URL+"/I_STL200x150.png";n="IMWMessageView-media-thumb";break;case"mpg":case"mp4":B=true;w=e.message.get("data").path.replace("/opt/data",document.rtcwidget_RTC_URL);break;case"zip":case"rar":w=document.rtcwidget_Assets_URL+"/I_ZIPDoc200x150.png";n="IMWMessageView-media-thumb";break;default:n="IMWMessageView-media-thumb"}var j=undefined;if(B){j=new b({path:w})}else{j=UWA.createElement("img",{draggable:"false",src:w,"class":n,events:{click:function(h){console.log("click on 3D content");var i=e.message.get("data").path.replace("/opt/data",document.rtcwidget_RTC_URL);var D=e.message.get("data").mime.toLowerCase();switch(e.message.get("data").mime.toLowerCase()){case"pdf":case"stl":case"3dxml":case"3dxm":case"svg":p.maximizeChat();p.display3dplayer({mime:e.message.get("data").mime,path:i,fileName:e.message.get("data").name});break;default:var m=j.cloneNode();p.maximizeChat({image:m,message:e.message})}},load:function(h){e.scrollTo()}}})}k=UWA.createElement("div",{html:[{tag:"div",html:"Share this media : <b>"+e.message.get("data").name+"</b>"},j]})}var v=this.message.get("displayUnread");this.setContainer({tag:"div","class":"IMWMessageView-global",draggable:"false",styles:{},html:[(v)?{tag:"div","class":"IMWMessageView-title unread",html:[{tag:"div","class":"IMWMessageView-date unread",html:"UNREAD MESSAGES"}]}:{},(e.displayDate)?{tag:"div","class":"IMWMessageView-title",html:[{tag:"div","class":"IMWMessageView-date",html:t},{tag:"div","class":"IMWMessageView-cube-global",html:{tag:"div","class":"IMWMessageView-cube",}}]}:{},{tag:"div","class":"IMWMessageView"+(r?"":" sent"),html:[{tag:"div","class":"IM-message-contact"+(r?"":" sent"),html:[{tag:"img","class":"IM-message-contact-img",draggable:"false",src:o}]},{tag:"div","class":"IM-message-details",html:[{tag:"div","class":"IM-message-user"+(r?"":" sent"),html:[{tag:"div","class":"IM-message-username"+(r?"":" sent"),html:g},{tag:"div","class":"IM-message-time",html:l}]},{tag:"div","class":"IM-message-text"+(r?"":" sent"),html:k}]}]}]});if(v){this.message.set("displayUnread",false)}if(this.isSystem){this.container.classList.remove("sent");this.container.getElement(".IM-message-contact").classList.add("hidden");this.container.getElement(".IM-message-user").classList.add("hidden");this.container.getElement(".IM-message-details").classList.add("systemMessage")}},inject:function(e,d){if(d){this.container.inject(e,d)}else{this.container.inject(e)}}})});define("DS/InstantMessagingW/js/view/IMWConversationView",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/RTColors/RTColors","DS/InstantMessagingW/js/model/IMWContactModel","i18n!DS/InstantMessagingW/assets/nls/feed","DS/InstantMessaging/js/ressources/FileSaver","DS/InstantMessagingW/assets/demo","DS/InstantMessagingW/js/view/smileycodes","DS/InstantMessagingW/assets/svg_icons_widget"],function(b,i,c,g,h,d,e,f,a){return b.extend({tagName:"div",className:"IMWConversationView",setup:function(j){this.room=j.room;this.ctrl=j.ctrl;this.startChat=j.startChat;this.unactiveConversations=j.unactiveConversations;this.listenTo(this.room.messages,"onAdd",this.addMessage.bind(this));this.listenTo(this.room.users,"onAdd",this.addUser.bind(this));this.listenTo(this.room.users,"onRemove",this.removeUser.bind(this));this.listenTo(this.room,"onChange:name",this.changeName.bind(this));this.listenTo(this.room,"onChange:pathImage",this.changeImage.bind(this));this._createContent();this.nbUnread=0;if(!this.room.isChannel()){this.updateTitle()}this.currentMsg=undefined},_createContent:function(){var k=this;this.setContainer({tag:"div","class":"IMWConversationView",room_id:this.room.get("room_id"),html:[{tag:"div","class":"IM-chat-state",},{tag:"div","class":"IM-chat-contact",html:[{tag:"div","class":"IM-chat-contact-img",draggable:"false",},(this.room.get("directmessage")&&!this.room.get("nway"))?{tag:"div","class":"IM-user-status room",}:{tag:"div","class":"IM-user-status room hidden",},{tag:"span","class":"fonticon fonticon-lock lockRoom hidden"}]},{tag:"div","class":"IM-chat-details",html:[{tag:"div","class":"IM-chat-msg-info",html:[{tag:"div","class":"IM-chat-username",text:this.room.isChannel()?this.room.get("name"):null},{tag:"div","class":"IM-chat-timer"},{tag:"div","class":"IM-nb-unread",html:{tag:"span",html:1}}]},{tag:"div","class":"IM-chat-message",}]},{tag:"div","class":"IM-chat-reply",html:[{tag:"span","class":"fonticon fonticon-reply"}]},{tag:"div","class":"IM-chat-time",html:[{tag:"div","class":"IM-chat-time-detail"}]},{tag:"div","class":"IM-chat-menu",html:[{tag:"span","class":"fonticon fonticon-open-down"}]}],events:{click:function(l){k.nbUnread=0;k.startChat(k.room);localStorage.setItem("3DIM_ROOM",k.room.get("room_id"));i.Widget("click on room "+JSON.stringify(k.room))},mouseover:function(){if(k.container.getElement(".IM-user-status")&&k.container.getElement(".IM-chat-state").className!=="IM-chat-state active"){k.container.getElement(".IM-user-status").style.border="1px solid #368ec4"}},mouseout:function(){if(k.container.getElement(".IM-user-status")&&k.container.getElement(".IM-chat-state").className!=="IM-chat-state active"){k.container.getElement(".IM-user-status").style.border="1px solid #003c5a"}},}});if(this.room.get("directmessage")){if(this.room.get("nway")){this.displaySVGicon("group_chat")}else{var j=this.room.users.first();if(!j){j=this.ctrl.me}this.displayIMG(document.rtcwidget_Swym_URL+j.get("login")+"/format");this.listenTo(j,"onChange:status",this.changeUserStatus.bind(this));this.changeUserStatus(j)}}else{if(this.room.get("pathImage")){this.displayIMG(this.room.get("pathImage"))}else{this.displaySVGicon("room_default")}}},displaySVGicon:function(k){var j=a[k];if(!j){return i.error("svg_icons_widget key not found : "+k)}this.container.getElement(".IM-chat-contact-img").innerHTML=j;this.container.getElement(".IM-chat-contact-img").style.opacity="1";this.container.getElement(".IM-chat-contact-img").style.backgroundImage=""},displayIMG:function(j){this.container.getElement(".IM-chat-contact-img").style.backgroundImage="url('"+j+"')";this.container.getElement(".IM-chat-contact-img").style.opacity="0.9";this.container.getElement(".IM-chat-contact-img").innerHTML=""},changeName:function(j){this.container.getElement(".IM-chat-username").setHTML(j.get("name"))},changeImage:function(){if(this.room.get("pathImage")){this.displayIMG(this.room.get("pathImage"))}else{this.displaySVGicon("room_default")}},removeUser:function(j){if(!this.room.isChannel()){this.updateTitle();if(this.room.users.length<=1){var j=this.room.users.first();if(!j){j=this.ctrl.me}this.displayIMG(document.rtcwidget_Swym_URL+j.get("login")+"/format");this.listenTo(j,"onChange:status",this.changeUserStatus.bind(this));this.changeUserStatus(j);this.showUserStatus()}}},addUser:function(j){if(!this.room.isChannel()){this.updateTitle();if(this.room.users.length>1){this.displaySVGicon("group_chat");this.hideUserStatus()}}},showUserStatus:function(){if(!this.container.getElement(".IM-user-status")){return i.error("no user status div")}this.container.getElement(".IM-user-status").classList.remove("hidden")},hideUserStatus:function(){if(this.container.getElement(".IM-user-status")){this.container.getElement(".IM-user-status").classList.add("hidden")}},changeUserStatus:function(m){if(this.room.get("directmessage")){var j=m.get("status");var l=m.get("login");var k=c[j.toLowerCase()];if(!this.room.get("nway")){if(j.toLowerCase()!=="offline"){this.container.getElement(".IM-chat-contact-img").style.opacity="0.9";this.container.getElement(".IM-user-status").style.background=k}else{this.container.getElement(".IM-chat-contact-img").style.opacity="0.3"}}else{}}},SaveToDisk:function(p,C){var m=(p);var t=m.split(";");var o=t[1].split(",");var k=t[0].split(":")[1];var D=o[1];var A=k;var l=512;var B=atob(D);var v=[];for(var n=0;n<B.length;n+=l){var u=B.slice(n,n+l);var s=new Array(u.length);for(var y=0;y<u.length;y++){s[y]=u.charCodeAt(y)}var q=new Uint8Array(s);v.push(q)}var j=new Blob(v,{type:A});d.saveAs(j,C);return true;var r=URL.createObjectURL(j);if(!window.ActiveXObject){var z=document.createElement("a");z.href=r;z.target="_blank";z.download=C||"unknown";var w=document.createEvent("Event");w.initEvent("click",true,true);z.dispatchEvent(w);(window.URL||window.webkitURL).revokeObjectURL(z.href)}else{if(!!window.ActiveXObject&&document.execCommand){var x=window.open(r,"_blank");x.document.close();x.document.execCommand("SaveAs",true,C||r);x.close()}}},addRobotMessage:function(m){var n=m.get("data").name;var j="FILE_ID";var k=n.substr(n.lastIndexOf(".")+1,n.length);if(!document.bot2){document.bot2=new g({status:"Online",login:"BOT2",username:"3DSwym Bot",tenants:"DSQAL006"})}var l={message_id:m.get("message_id")+"_robotmessage",message:null,html:"<div class='robotmessage'>I can add this file in 3DDrive. Do you agree ? <a>Yes please</a><a>No. Maybe next time</a></div>",isSent:false,fileId:j,fileName:n,readBy:{},devEnv:false,user:document.bot2,login:"BOT2",data:m.get("data"),origin:"bot"};setTimeout(function(){this.room.addMessage(l)}.bind(this),300)},addMessage:function(m){if(!m.get("bot")){if(m.get("data")&&(typeof m.get("data")==="string")&&m.get("data").indexOf("data")==0){document[m.get("fileId")]=m.get("data");return console.log("loaded the file "+m.get("fileId"))}if(this.currentMsg===undefined||m.get("createDate")>this.currentMsg.get("createDate")){this.currentMsg=m;if(m.get("message").indexOf("<div")!=-1||m.get("message").indexOf("<img")!=-1||m.get("origin")==="data"){var q=h.dataReceived;this.container.getElement(".IM-chat-message").setHTML(q)}else{var q=m.get("message");var n=f;for(var p in n){var o="";while(o!==q){o=q;q=q.replace(n[p],'<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(p,10)+1)+'.svg">')}}if(m.get("origin")==="media"){q=m.get("data").name}this.container.getElement(".IM-chat-message").setHTML(q);var k=new Date();var s=new Date(m.get("createDate"));var t={weekday:"long",month:"long",day:"numeric"};var r=s.toLocaleDateString("en-US",t);if(r===k.toLocaleDateString("en-US",t)){r=s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:false})}else{r=s.toLocaleTimeString("en-US",{month:"short",day:"numeric"});var l=r.indexOf(",");if(l!==-1){r=r.substr(0,l)}}this.container.getElement(".IM-chat-timer").setHTML(r)}var j=m.get("read_date");if((this.container.getElement(".IM-chat-state").className==="IM-chat-state unread"||this.container.getElement(".IM-chat-state").className==="IM-chat-state")&&Object.keys(m.get("user")).length>0&&(j===""||j==="none")){this.nbUnread++;this.container.getElement(".IM-nb-unread").style.display="block";this.container.getElement(".IM-nb-unread").setHTML(this.nbUnread);this.setUnread(true)}}}},updateTitle:function(k){if(this.room.isChannel()){return false}var l=this.container.getElement(".IM-chat-username");var j=this.room.users.first();if(!j&&this.room.users.length==0){j=this.ctrl.me}l.innerHTML=j.get("username");this.room.users.forEach(function(m,n){if(n==0){return true}l.innerHTML+=", "+m.get("username")}.bind(this))},setUnread:function(j){if(this.container.getElement(".IM-chat-state").className!=="IM-chat-state active"){if(j){this.container.getElement(".IM-chat-details").style.opacity="0.9";this.container.getElement(".IM-chat-state").classList.add("unread")}else{this.container.getElement(".IM-chat-time").className="IM-chat-time";this.container.getElement(".IM-chat-message").className="IM-chat-message";this.container.getElement(".IM-chat-username").className="IM-chat-username";this.container.getElement(".IM-chat-state").classList.remove("unread")}}},inject:function(j){this.container.inject(j)}})});define("DS/InstantMessagingW/js/view/IMWSearchView",["UWA/Class/View","DS/UIKIT/Scroller","DS/InstantMessagingW/js/view/IMWContactView"],function(c,a,b){return c.extend({tagName:"div",className:"IMWSearchView",setup:function(d){this.search=d.search;this.startChat=d.startChat;this.listenTo(this.search,"onAdd",this.addUser.bind(this));this._createContent()},_createContent:function(){var d=this;this.setContainer({tag:"div","class":"IMWSearchView"});this.setContainer({tag:"div","class":"IMWSearchView",html:this.scrollerView=new a({element:UWA.createElement("div",{"class":"scrollable-body",styles:{height:"100%"},html:{tag:"div","class":"IMWSearchContactsView"}})})})},addUser:function(d){var e=this.container.getElement(".IMWSearchContactsView");new b({user:d,type:"search",startChat:this.startChat}).inject(e)},inject:function(d){this.container.inject(d)}})});define("DS/InstantMessagingW/js/view/IMWSearchAndSelectView",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/RTColors/RTColors","DS/InstantMessagingW/js/model/IMWContactModel","DS/UIKIT/Autocomplete","i18n!DS/InstantMessagingW/assets/nls/feed"],function(a,j,b,h,g,i){var c="Search users...";var e=true;var f=false;var d={templateEngine:function(l,m,k){l.addClassName("default-template people-search-template with-sub-label");l.setHTML('<img class="people-search-img" src="'+document.rtcwidget_Swym_URL+k.picture+'"/> <div class="item-label">'+k.value+'</div> <div class="sub-label">'+k.subLabel+"</div>")},filterEngine:function(o,k){if(!f){return this.getItems()}var m=[],n=[],l;k.forEach(function(p){l=m.indexOf(p.value);(l<0)&&m.push(p.value)&&n.push(p)});return m}};return a.extend({tagName:"div",className:"IMWSearchAndSelectView",usersFound:{},usersSelection:{},allUsers:{},setup:function(l){this.search=l.search;this.usersFound={};this.usersSelection={};this.doSearch=l.doSearch;if(!e){this.listenTo(this.search,"onAdd",this.addUserFound.bind(this));this.search.forEach(this.addUserFound.bind(this))}if(e){this.peopleSearchInput=new g({multiSelect:true,showSuggestsOnFocus:true});this.initDataset();this.peopleTextInput=this.peopleSearchInput.elements.container.getElementsByTagName("input")[0];this.peopleTextInput.addEventListener("keydown",(function(n){return function(o){var p=o.key=="Backspace"?this.value:this.value+o.key;if(p.length>2){f=true;n.doSearch(p);n.unsetNeeded();return true}f=false;return false}})(this));var m=document.createElement("span");m.id="spanTo";m.innerText=i.To;var k=this.peopleSearchInput.elements.container.getElementsByClassName("autocomplete-searchbox")[0];if(k.prepend){k.prepend(m)}else{k.insertBefore(m,k.firstChild)}this.listenTo(this.search,"onAdd",(function(n){return function(o){n.addUserToDataset(o)}})(this))}this.render()},render:function(){if(!e){var k=this;this.container.setContent([{id:"IMWSelectedAndInput",tag:"div",html:[{id:"IMWSelectedUsers",tag:"ul",html:[{id:"IMWSearchUserInput",tag:"li",contenteditable:true,html:c,events:{click:function(){if(this.innerHTML!=c){return true}this.innerHTML=""},focusout:function(){this.innerHTML=c;this.style.color="#E2E4E3"},keypress:function(l){this.style.color="#3d3d3d";if(this.innerText.length<2){return false}j.Widget("look for "+this.innerText+l.key);k.removeAllUsersFromList("found");k.doSearch(this.innerText+l.key);this.peopleSearchInput.ex_onKeyDown(l)}}}]}]},{id:"IMWUsersFound",tag:"ul"}])}else{this.peopleSearchInput.inject(this.container)}},addUserToList:function(k,m){if(!k||!k instanceof h){return j.error("bad user arg")}if(!m||m!="found"&&m!="selected"){return j.error("bad list arg")}this.allUsers[k.get("login")]=k;this.usersSelection.container=this.usersSelection.container||this.container.children.IMWSelectedAndInput.children.IMWSelectedUsers;this.usersFound.container=this.usersFound.container||this.container.children.IMWUsersFound;var n=(m=="found")?this.usersFound:this.usersSelection;var l=this.getUserLIview(k);k.userSearchView=l;if(l.error){return j.error(l.error)}if(n[k.get("login")]){return j.Widget("The login "+k.get("login")+" has already been added to list "+m)}n[k.get("login")]=l;if(!n.container){return j.error("can not find container of list "+m)}l.inject(n.container,"top");return k},removeUserFromList:function(k,l){if(!k||!k instanceof h){return j.error("bad user arg")}if(!l||l!="found"&&l!="selected"){return j.error("bad list arg")}var m=l=="found"?this.usersFound:this.usersSelection;if(!m[k.get("login")]){return j.error("user not found in array")}m[k.get("login")].remove();m[k.get("login")]=null},removeAllUsersFromList:function(l){if(!l||l!="found"&&l!="selected"){return j.error("bad list arg")}var m=l=="found"?this.usersFound:this.usersSelection;for(var k in m){if(!m[k]||k=="container"){continue}m[k].remove();m[k]=null}if(l=="selected"&&e){this.peopleSearchInput.unselectAll()}},removeUserFound:function(k){return this.removeUserFromList(k,"found")},removeSelected:function(k){return this.removeUserFromList(k,"selected")},initDataset:function(){var k=[];this.search.forEach(function(m){k.push({value:m.get("username"),subLabel:m.get("status"),picture:m.get("login")})});var l={name:"Peoples",items:k,configuration:d};this.peopleSearchInput.addDataset(l)},isUserInDataset:function(k){if(this.allUsers[k.get("login")]){return true}return false},addUserToDataset:function(l){if(this.isUserInDataset(l)){return false}this.allUsers[l.get("login")]=l;var k=[];k.push({value:l.get("username")+" ("+l.get("login")+")",subLabel:i[l.get("status").toLowerCase()],picture:l.get("login")});var m={name:"Peoples",items:k,configuration:{templateEngine:function(o,p,n){o.addClassName("default-template people-search-template with-sub-label");o.setHTML('<img class="people-search-img" src="'+document.rtcwidget_Swym_URL+n.picture+'"/> <div class="item-label">'+n.value+'</div> <div class="sub-label">'+n.subLabel+"</div>")}}};this.peopleSearchInput.addDataset(m)},addUserFound:function(k){if(!e){return this.addUserToList(k,"found")}j.error("addUserFound must not be used with useUIKITautocomplete")},addUserSelected:function(k){return this.addUserToList(k,"selected")},getSelectedUsers:function(){var l,k,m,o=[];if(!e){for(l in this.usersSelection){if(l=="container"){continue}if(!this.usersSelection[l]){continue}k=this.allUsers[l];if(!k){return j.error("the user model of "+l+" is not in allUsers")}o.push(k)}}else{var n=this.peopleSearchInput.getSelection();for(m=0;m<n.length;m++){l=n[m].picture;k=this.allUsers[l];if(!k){return j.error("the user model of "+l+" is not in allUsers")}o.push(k)}}return o},switchList:function(l){if(!l||!l instanceof h){return j.error("bad user arg")}var k;if(this.usersFound[l.get("login")]){j.Widget("switch user "+l.get("login")+" from found to selected");k=this.removeUserFound(l);k=this.addUserSelected(l);if(k.error){j.error(k)}}else{if(this.usersSelection[l.get("login")]){j.Widget("switch user "+l.get("login")+" from selected to found");k=this.removeSelected(l);k=this.addUserFound(l);if(k.error){j.error(k)}}else{return j.error("user "+l.get("login")+" can not be switched because not found")}}},setNeeded:function(k){this.getContent().classList.add("needed")},unsetNeeded:function(k){this.getContent().classList.remove("needed")},emptySearch:function(){this.peopleTextInput.value=""},getUserLIview:function(k){if(!k||!k instanceof h){return j.error("bad arg")}return UWA.createElement("li",{"class":"IMWPeopleInfoView",id:k.get("user_id")||k.get("login"),html:{tag:"div","class":"IM-chatpanel-global",events:{click:(function(l){return function(){l.switchList(k)}})(this)},html:[{tag:"div","class":"IMWConversationView",styles:{height:"60px"},html:[{tag:"div","class":"IM-chat-contact",styles:{"margin-left":"10px"},html:[{tag:"img","class":"IM-chat-contact-img",src:document.rtcwidget_Swym_URL+k.get("login")+"/format"},{tag:"div","class":"IM-user-status chat-panel",styles:{background:b[k.get("status")]}}]},{tag:"div","class":"IM-chat-details",html:[{tag:"div","class":"IM-chat-username",styles:{"font-size":"15px"},html:k.get("username")},{tag:"div","class":"IM-chat-message",html:k.get("status")}]},{tag:"div","class":"IM-chat-menu",html:[{tag:"span","class":"fonticon fonticon-close"}]}]}]}})}})});define("DS/InstantMessagingW/js/view/IMWRoomCreationView",["UWA/Class/View","DS/UIKIT/Input/Toggle","DS/RTProxyDriver/RTLogger","DS/RTColors/RTColors","DS/InstantMessagingW/js/model/IMWContactModel","DS/InstantMessagingW/js/view/IMWSearchAndSelectView","DS/UIKIT/Input/Button","DS/UIKIT/Modal","i18n!DS/InstantMessagingW/assets/nls/feed","DS/UIKIT/Input/File","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Tooltip","DS/UIKIT/Alert"],function(a,i,n,b,k,j,e,g,m,f,c,h,d){var l=true;return a.extend({tagName:"div",className:"IMWRoomCreationView",setup:function(o){this.defaultName="#";this.defaultVisibility="secret";this.defaultDescription=m.defaultDescription;this.defaultImageUrl=c.room_default_cropped;this.room=o.room;this.inviteUser=o.inviteUser;this.getRoom=o.getRoom;this.doSearch=o.doSearch;this.editRoom=o.editRoom;this.type=o.type;this.search=o.search;this.privacy="public";this.showHistoric=true;this.setTitle(false);this.modal=new g({className:"site-reset",closable:true,header:'<span class="modalTitle">'+this.title+"</span>",body:"",footer:""});if(this.isInvit()&&!this.inviteUser){return n.error("no inviteUser method")}if((this.isDM()||this.isChannel())&&!this.getRoom){return n.error("no getRoom method")}if(this.isEdition()&&!this.editRoom){return n.error("no editRoom method")}if(this.isEdition()&&!this.room){return n.error("no room to edit")}this.render()},isChannel:function(){return this.type=="channel"},isInvit:function(){return this.type=="invitation"},isDM:function(){return this.type=="dm"},isEdition:function(){return this.type=="edition"},setTitle:function(o){if(this.isChannel()){this.title=m.CreateRoom}else{if(this.isDM()){this.title=m.CreateDM}else{if(this.isEdition()){this.title=m.EditRoom}else{if(this.isInvit()){if(!this.room){return n.Widget("type is invitation|edition but no room specified")}if(this.room.get("directmessage")){this.title=m.InviteInDM}else{this.title=m.InviteInRoom+" "+this.room.get("name")}}else{return n.error("type unknown : "+this.type)}}}}if(o){this.modal.setHeader('<span class="modalTitle">'+this.title+"</span>")}},show:function(){this._parent();this.IMWNameRoomInput.classList.remove("needed");this.searchAndSelect.getContent().classList.remove("needed");if(this.alert){this.alert.destroy()}this.searchAndSelect.removeAllUsersFromList("selected");this.IMWNameRoomInput.innerText=this.defaultName;this.IMWDescriptionInput.innerText=this.defaultDescription;this.chooseImage();this.searchAndSelect.inject(this.container.children.IMWSearchParams.children.IMWRoomSearch);this.setVisibility(this.defaultVisibility);this.imageBin=null;this.searchAndSelect.emptySearch();this.modal.show();if(this.type=="channel"){this.IMWNameRoomInput.focus()}else{this.searchAndSelect.peopleTextInput.focus()}},checkVisibility:function(o){if(!l){return this.container.children.IMWVisibilityParam.classList.add("hidden")}this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.privateinput.children[0].checked=false;this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.secretinput.children[0].checked=false;this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.publicinput.children[0].checked=false;if(o=="private"){this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.privateinput.children[0].checked=true}else{if(o=="secret"){this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.secretinput.children[0].checked=true}else{if(o=="public"){this.container.children.IMWVisibilityParam.children.IMWPrivacyInput.children.publicinput.children[0].checked=true}else{return n.error("unknown visibilty : "+o)}}}},showForRoom:function(o){if(this.type!="invitation"){return n.error("showForRoom must be used only for invitation")}this.room=o;this.setTitle(true);this.show()},hide:function(){this._parent();this.modal.hide()},getSelectedUsers:function(){if(!this.searchAndSelect){return n.error("no IMWSearchAndSelectView instance")}return this.searchAndSelect.getSelectedUsers()},getSelectedName:function(){return this.IMWNameRoomInput.innerText},getSelectedDescription:function(){return this.IMWDescriptionInput.innerText},createRoom:function(){var o=this.getSelectedName();var s=this.getSelectedUsers();var q=this.getSelectedDescription();var r=this.privacy;var p=this.imageBin;if(this.isChannel()&&(!o||o==this.defaultName)){this.IMWNameRoomInput.classList.add("needed");this.IMWNameRoomInput.focus();this.showNameAlert();return false}if(!this.isEdition()&&s.length==0){this.searchAndSelect.setNeeded();this.searchAndSelect.peopleTextInput.focus();this.showUserAlert();return false}if(q==this.defaultDescription){q=null}if(o==this.defaultName){o=null}this.IMWNameRoomInput.classList.remove("needed");this.searchAndSelect.unsetNeeded();if(this.isEdition()){if(!this.editRoom){return n.error("no editRoom method")}this.editRoom(this.room,o,q,r,p);this.hide()}else{if(!this.getRoom){return n.error("no getRoom method")}this.getRoom(o,s,this.type,false,q,r,p);this.hide()}},cancel:function(){this.hide()},inviteUserClick:function(){if(!this.inviteUser){return n.error("no inviteUser method")}this.inviteUser(this.room,this.getSelectedUsers());this.hide()},setPrivacy:function(o){if(o&&o.target&&o.target.checked){this.privacy="secret";this.container.children.IMWPrivacyParam.children.IMWPrivacyInfo.innerHTML="Your room will be <b>secret</b> : only invited people can join."}else{this.privacy="public";this.container.children.IMWPrivacyParam.children.IMWPrivacyInfo.innerHTML="Your room will be <b>public</b> : everyone can discover and join."}},setVisibility:function(o,q){var p=o.value||o;if(q&&p!=this.privacy&&p=="public"){this.showPublicAlert()}this.privacy=p;this.checkVisibility(this.privacy)},setHistoric:function(o){if(o&&o.target&&o.target.checked){this.showHistoric=true;this.container.children.IMWPrivacyParam.children.IMWHistoricInfo.innerHTML="<b>Show historic</b> to users who recently joined the room."}else{this.showHistoric=false;this.container.children.IMWPrivacyParam.children.IMWHistoricInfo.innerHTML="<b>Hide historic</b> to users who recently joined the room."}},showPublicAlert:function(){this.showAlert("alertPublicRoom","warning")},showNameAlert:function(){this.showAlert("alertName","error")},showUserAlert:function(){this.showAlert("alertUser","error")},showAlert:function(p,o){this.alert=new d({visible:true,autoHide:true,hideDelay:3000}).inject(this.container.getElement("#IMWAlert"));this.alert.add({className:o,message:m[p]})},setImage:function(o,p){if(!p){this.IMWRoomImg.src=o;this.IMWRoomImgSVG.classList.add("hidden");this.IMWRoomImg.classList.remove("hidden")}else{this.IMWRoomImg.innerHTML=o;this.IMWRoomImg.classList.add("hidden");this.IMWRoomImgSVG.classList.remove("hidden")}},chooseImage:function(){if(this.room&&this.room.get("pathImage")){this.setImage(this.room.get("pathImage"))}else{this.setImage(this.defaultImageUrl,true)}},render:function(){this.container.setContent([{id:"IMWRoomCreationTitle",tag:"span",html:this.title},{id:"IMWAlert",tag:"div"},{id:"IMWRoomImgName",tag:"span",html:[{id:"IMWRoomImage",tag:"div",html:[{id:"IMWRoomImg",tag:"img",src:""},{id:"IMWRoomImgSVG",tag:"div",html:this.defaultImageUrl},{tag:"input",type:"file",accept:"image/*",name:"IM-file-browser-file","class":"IM-roomcreation-attach-file",styles:{display:"none"},events:{change:(function(q){return function(s){var u=s.target.files;for(var t=0;t<u.length;t++){var v=u[t].name;var r=new FileReader();r.onload=function(x){var B=new Uint8Array(x.target.result);var A=32768;var y=0;var z=B.length;var w="";var D;while(y<z){D=B.subarray(y,Math.min(y+A,z));w+=String.fromCharCode.apply(null,D);y+=A}var C=v.substr(v.lastIndexOf(".")+1,v.length);q.imageBin={mime:C,name:v,file:btoa(w)};q.setImage("data:image/jpeg;base64,"+q.imageBin.file)};r.readAsArrayBuffer(u[t])}}})(this)}},{tag:"span",id:"pencil","class":"fonticon fonticon-pencil IM-roomcreation-pencil interactive",events:{click:(function(q){return function(r){q.getElement(".IM-roomcreation-attach-file").click()}})(this)}}]},{id:"IMWNameParam",tag:"div",html:[{id:"IMWRoomNameLabel",tag:"label",html:m.Name+"*"},{id:"IMWNameRoomInput",tag:"div",html:"",contenteditable:true,events:{focusin:(function(q){return function(){if(q.isEdition()){return true}if(this.innerHTML!=q.defaultName){return true}this.innerHTML=""}})(this),focusout:(function(q){return function(){if(this.innerHTML==""){this.innerHTML=q.defaultName}else{this.classList.remove("needed")}}})(this)}}]},]},{id:"IMWDescriptionParam",tag:"div","class":"paramBlock",html:[{id:"IMWDescriptionLabel",tag:"label",html:m.Description},{id:"IMWDescriptionInput",tag:"div",html:this.defaultDescription,contenteditable:true,events:{focusin:(function(q){return function(){if(q.isEdition()){return true}if(this.innerHTML!=q.defaultDescription){return true}this.innerHTML=""}})(this),focusout:(function(q){return function(){if(q.isEdition()){return true}if(this.innerHTML==""){this.innerHTML=q.defaultDescription}}})(this)}}]},{id:"IMWPrivacyParam",tag:"div","class":"paramBlock",html:[{id:"IMWPrivacyLabel",tag:"label",html:"Privacy"},{id:"delimiter",tag:"p",html:""},{id:"IMWPrivacyInput",tag:"div",html:new i({type:"switch",value:"secret",label:""})},{id:"IMWPrivacyInfo",tag:"span",html:"Your room will be <b>public</b> : everyone can discover and join."},{id:"delimiter",tag:"p",html:""},{id:"IMWHistoricInput",tag:"div",html:(new i({type:"switch",value:"historic",label:""})).check()},{id:"IMWHistoricInfo",tag:"span",html:"<b>Show historic</b> to users who recently joined the room."}]},{id:"IMWVisibilityParam",tag:"div","class":"paramBlock",html:[{id:"IMWPrivacyLabel",tag:"label",html:m.Visibility},{id:"delimiter",tag:"p",styles:{margin:"0"},html:""},{id:"IMWPrivacyInput",tag:"div",html:[{tag:"div","class":"toggle toggle-primary hidden",id:"privateinput",html:[{tag:"input",type:"radio",name:"visibility",id:"private"+this.cid,events:{click:(function(q){return function(){q.setVisibility(this,true)}})(this)},value:"private"},{tag:"label","class":"control-label","for":"private"+this.cid,html:[{tag:"span","class":"fonticon fonticon-lock"},{tag:"span",html:m.Private}]}]},{tag:"div","class":"toggle toggle-primary",id:"publicinput",html:[{tag:"input",type:"radio",name:"visibility",id:"public"+this.cid,events:{click:(function(q){return function(){q.setVisibility(this,true)}})(this)},value:"public"},{tag:"label","class":"control-label","for":"public"+this.cid,html:[{tag:"span","class":"fonticon fonticon-globe"},{tag:"span",html:m.Public}]}]},{tag:"div","class":"toggle toggle-primary",id:"secretinput",html:[{tag:"input",type:"radio",name:"visibility",id:"secret"+this.cid,events:{click:(function(q){return function(){q.setVisibility(this,true)}})(this)},value:"secret"},{tag:"label","class":"control-label","for":"secret"+this.cid,html:[{tag:"span","class":"fonticon fonticon-eye-off"},{tag:"span",html:m.Secret}]}]}]}]},{id:"IMWSearchParams",tag:"div","class":"paramBlock",html:[{id:"IMWRoomSearchLabel",tag:"label",html:m.sendInviteTo},{id:"IMWRoomSearch",tag:"div"}]},{id:"IMWSubmitRoomButton",tag:"div"}]);this.container.children.IMWPrivacyParam.children.IMWHistoricInput.addEvent("change",this.setHistoric.bind(this));this.IMWNameParam=this.container.children.IMWRoomImgName.children.IMWNameParam;this.IMWNameRoomInput=this.container.children.IMWRoomImgName.children.IMWNameParam.children.IMWNameRoomInput;this.IMWDescriptionInput=this.container.children.IMWDescriptionParam.children.IMWDescriptionInput;this.IMWRoomImgName=this.container.children.IMWRoomImgName;this.IMWRoomImage=this.IMWRoomImgName.children.IMWRoomImage;this.IMWRoomImg=this.IMWRoomImage.children.IMWRoomImg;this.IMWRoomImgSVG=this.IMWRoomImage.children.IMWRoomImgSVG;this.pencil=this.IMWRoomImage.children.pencil;this.IMWRoomCreationTitle=this.container.children.IMWRoomCreationTitle;this.searchAndSelect=document.searchAndSelect||new j({doSearch:this.doSearch,search:this.search});document.searchAndSelect=document.searchAndSelect||this.searchAndSelect;if(this.isDM()||this.isInvit()){this.IMWRoomImgName.classList.add("hidden");this.container.children.IMWPrivacyParam.classList.add("hidden");this.container.children.IMWVisibilityParam.classList.add("hidden");this.container.children.IMWDescriptionParam.classList.add("hidden")}else{if(this.isEdition()){this.container.children.IMWSearchParams.classList.add("hidden");this.defaultName=this.room.get("name");this.defaultDescription=this.room.get("description");this.defaultVisibility=this.room.get("security");this.IMWNameRoomInput.value=this.defaultName;this.IMWDescriptionInput.value=this.defaultDescription;this.checkVisibility(this.defaultVisibility)}}this.chooseImage();this.tooltiPencil=new h({position:"bottom",target:this.pencil,body:m.Change});this.modal.inject(document.body);this.container.inject(this.modal.getBody());this.container.children.IMWRoomCreationTitle.classList.add("hidden");this.container.children.IMWPrivacyParam.classList.add("hidden");var o,p;if(this.isInvit()){o=m.Invite;p=this.inviteUserClick.bind(this)}else{if(this.isDM()||this.isChannel()){o=m.Create;p=this.createRoom.bind(this)}else{if(this.isEdition()){o=m.Edit;p=this.createRoom.bind(this)}}}this.createButton=new e({value:o,className:"primary"}).inject(this.modal.getFooter());this.createButton.addEvent("onClick",p);this.cancelButton=new e({value:m.Cancel}).inject(this.modal.getFooter());this.cancelButton.addEvent("onClick",this.cancel.bind(this));this.hide()}})});define("DS/InstantMessagingW/js/view/IMWNotification",["UWA/Class/View","DS/InstantMessagingW/assets/svg_icons_widget","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/js/view/IMWMessageView"],function(d,b,a,c){return d.extend({className:"IMWNotification",setup:function(e){this.userView=undefined;this.notifications=e.notifications;this.listenTo(this.notifications,"onAdd",this.addNotification.bind(this));this._createContent()},_createContent:function(){var e=this;this.setContainer({tag:"div","class":"IMWNotification",html:[{tag:"div","class":"IMWNotification-title",html:[{tag:"div","class":"IMWNotification-title-icon"},{tag:"div","class":"IMWNotification-title-name"}]}]})},addNotification:function(i){if(this.userView){this.userView.destroy()}var k=i.get("room");var h=i.get("message");if(h.error){return a.error("addNotification failed : "+h.error)}h=h.clone();if(this.timeNotif){clearTimeout(this.timeNotif)}if(k.get("nway")){this.container.getElement(".IMWNotification-title").style.display="inline-flex";var f=this.container.getElement(".IMWNotification-title-name");var j=this.container.getElement(".IMWNotification-title-icon");j.innerHTML="";f.setText(k.get("name"));if(k.get("directmessage")){if(k.get("nway")||!k.users||k.users.length==0){var e=b.group_chat;j.setHTML(e)}}else{if(k.get("pathImage")){UWA.createElement("img",{src:k.get("pathImage")}).inject(j)}else{var e=b.room_default;j.setHTML(e)}}}else{this.container.getElement(".IMWNotification-title").style.display="none"}if(h.get("origin")==="media"){h.set("origin","chat");h.set("message","Data received")}this.userView=new c({message:h,displayDate:false});this.userView.inject(this.container);this.container.style.top="0px";var g=this;this.timeNotif=setTimeout(function(){g.container.style.top="-100px";g.userView.destroy()},3000)},inject:function(e){if(!this.container.isInjected()){this.container.inject(e)}}})});define("DS/InstantMessagingW/js/view/IMWSectionMessages",["UWA/Class/View","UWA/Class/Collection","DS/InstantMessagingW/js/view/IMWMessageView","DS/InstantMessagingW/js/view/IMWBOTMessageView"],function(c,a,b,d){return c.extend({tagName:"div",className:"IMWSectionMessages",setup:function(e){this.display3dplayer=e.display3dplayer;this.maximizeChat=e.maximizeChat;this.scrollTo=e.scrollTo;this.searchUser=e.searchUser;this.assignTask=e.assignTask;this.messages=new a([],{comparator:"time"});this._createContent(e)},_createContent:function(e){var f=this;this.setContainer({tag:"div","class":"IM-section",html:[{tag:"div","class":"IMWMessageView-title",html:[{tag:"div","class":"IMWMessageView-date",html:e.refDate},{tag:"div","class":"IMWMessageView-cube-global",html:{tag:"div","class":"IMWMessageView-cube",}}]},{tag:"div","class":"IM-section-messages",}]})},addMessage:function(h){var i=undefined;if(h.get("bot")){i=new d({message:h,scrollTo:this.scrollTo,searchUser:this.searchUser,assignTask:this.assignTask})}else{i=new b({message:h,displayDate:false,display3dplayer:this.display3dplayer,maximizeChat:this.maximizeChat,scrollTo:this.scrollTo})}var e=new Date(h.get("createDate"));this.messages.add({message_id:h.get("message_id"),time:e.getTime(),view:i});this.messages.sort();var g=this.messages.indexOf(this.messages.where({message_id:h.get("message_id")})[0]);if(g<(this.messages.size()-1)&&this.messages.size()>1){i.inject(this.messages.at(g+1).get("view").container,"before")}else{var f=this.container.getElement(".IM-section-messages");i.inject(f);this.scrollTo()}},inject:function(g,e){if(e){this.container.inject(g,e)}else{this.container.inject(g)}var f=new UWA.Fx(this.container,{duration:250,transition:"linear"});f.start({opacity:[0,0.9]})},})});define("DS/InstantMessagingW/js/view/IMWConversationsView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWConversationView","DS/InstantMessagingW/js/view/IMWRoomCreationView","DS/UIKIT/Scroller","i18n!DS/InstantMessagingW/assets/nls/feed"],function(e,a,c,b,d){return e.extend({tagName:"div",className:"IMWConversationsView",setup:function(f){this.allRoomElements={};this.rooms=f.rooms;this.startChat=f.startChat;this.getRoom=f.getRoom;this.doSearch=f.doSearch;this.search=f.search;this.ctrl=f.ctrl;this.showChannelCreationView=f.showChannelCreationView;this.showDMCreationView=f.showDMCreationView;this.listenTo(this.rooms,"onAdd",this.updateRoomList.bind(this));this.listenTo(this.rooms,"onRemove",this.removeRoom.bind(this));this._createContent()},updateRoomList:function(){var f=null;this.rooms.forEach(function(j,h){j.set("active",false);if(this.allRoomElements[j.get("room_id")]){var i=this.allRoomElements[j.get("room_id")].getElement(".IM-chat-state");if(i.hasClassName("active")){j.set("active",true);f=j}this.removeRoom(j)}},this);var g=this.rooms.sortBy("date_in").reverse();g.forEach(function(i,h){this.addRoom(i)},this);this.unactiveConversations(f)},_createContent:function(){var f=this;this.setContainer({tag:"div","class":"IMWConversationsMainView",html:this.scrollerView=new b({element:UWA.createElement("div",{"class":"scrollable-body",styles:{height:"100%"},html:[{tag:"div","class":"IMWDiscover",html:[{tag:"div",html:d.DISCOVER},{tag:"span","class":"fonticon fonticon-globe",styles:{margin:"auto","margin-right":"17px","font-size":"20px",cursor:"pointer"}}],events:{click:(function(g){return function(){g.showDiscover()}})(this)}},{tag:"div","class":"IMWChannels",styles:{color:"#A3B0B9",display:"inline-flex",width:"100%"},html:[{tag:"div","class":"IMWChannels-name",html:"ROOMS",styles:{margin:"10px","font-weight":"bold","margin-left":"20px","font-size":"16px",flex:1}},{tag:"span","class":"fonticon fonticon-plus",styles:{margin:"auto","margin-right":"40px","font-size":"16px",cursor:"pointer"},events:{click:(function(g){return function(){g.showChannelCreationView()}})(this)}}]},{tag:"div","class":"IMWChannelsView"},{tag:"div","class":"IMWPeople",styles:{color:"#A3B0B9",display:"inline-flex",width:"100%"},html:[{tag:"div","class":"IMWPeople-name",html:"DIRECT MESSAGES",styles:{margin:"10px","font-weight":"bold","margin-left":"20px","font-size":"16px",flex:1}},{tag:"span","class":"fonticon fonticon-plus",styles:{margin:"auto","margin-right":"40px","font-size":"16px",cursor:"pointer"},events:{click:(function(g){return function(){g.showDMCreationView()}})(this)}}]},{tag:"div","class":"IMWConversationsView"}]})})})},addRoom:function(g){var f=new a({ctrl:this.ctrl,room:g,startChat:this.startChat,unactiveConversations:this.unactiveConversations.bind(this)});var h=!g.isChannel();if(!h){f.inject(this.container.getElement(".IMWChannelsView"))}else{f.inject(this.container.getElement(".IMWConversationsView"))}this.allRoomElements[g.get("room_id")]=f},removeRoom:function(f){var g=typeof f.get("directmessage")=="boolean"?f.get("directmessage"):!f.get("nway");if(!g){this.container.getElement(".IMWChannelsView").removeChild(this.allRoomElements[f.get("room_id")].getContent())}else{this.container.getElement(".IMWConversationsView").removeChild(this.allRoomElements[f.get("room_id")].getContent())}this.allRoomElements[f.get("room_id")]=null},inject:function(f){this.container.inject(f)},unactiveConversations:function(k,g){if(!k&&this.getElement(".IMWDiscover").hasClassName("activated")){return true}var j=this.container.getElements(".IMWConversationView");for(var h=0;h<j.length;h++){if(k&&j[h].getAttribute("room_id")==k.get("room_id")){k.set("active",true);j[h].getElement(".IM-chat-time").className="IM-chat-time";j[h].getElement(".IM-chat-message").className="IM-chat-message";j[h].getElement(".IM-chat-username").className="IM-chat-username";j[h].getElement(".IM-chat-state").className="IM-chat-state active";j[h].getElement(".IM-chat-details").style.opacity="0.9";j[h].getElement(".IM-nb-unread").style.display="none";if(j[h].getElement(".IM-user-status")){j[h].getElement(".IM-user-status").style.border="1px solid #368ec4"}}else{if(j[h].getElement(".IM-chat-state").className==="IM-chat-state active"){j[h].getElement(".IM-chat-time").className="IM-chat-time";j[h].getElement(".IM-chat-message").className="IM-chat-message";j[h].getElement(".IM-chat-username").className="IM-chat-username";j[h].getElement(".IM-chat-state").className="IM-chat-state";j[h].getElement(".IM-chat-details").style.opacity="0.3";j[h].getElement(".IM-chat-details").style.opacity="0.3";if(j[h].getElement(".IM-user-status")){j[h].getElement(".IM-user-status").style.border="1px solid #003c5a"}}}}var f=this.container.getElement(".IMWDiscover");if(g){f.classList.add("activated")}else{f.classList.remove("activated")}},showDiscover:function(){this.unactiveConversations(null,true);this.ctrl.discoClick()}})});define("DS/InstantMessagingW/js/view/IMWInfoRoomView",["UWA/Class/View","UWA/Fx","DS/UIKIT/Scroller","DS/UIKIT/Tooltip","DS/RTColors/RTColors","DS/InstantMessagingW/js/view/IMWContactView","DS/InstantMessagingW/js/view/IMWPlayerVideoView","DS/InstantMessagingW/js/view/IMWRoomCreationView","DS/InstantMessagingWebRTC/assets/svg_icons"],function(b,f,d,h,c,g,i,a,e){return b.extend({className:"IMWInfoRoomView",setup:function(j){this.display3dplayer=j.display3dplayer;this.maximizeChat=j.maximizeChat;this.numContent=0;this.ctrl=j.ctrl;this._createContent()},_createContent:function(){var j=this;this.setContainer({tag:"div","class":"IMWInfoRoomView",html:{tag:"div","class":"IM-info-global",styles:{},html:[{tag:"div","class":"IM-room-about",html:[{tag:"div","class":"IM-room-about-title",html:"About this conversation",styles:{"font-weight":"bold"}},{tag:"div","class":"IM-room-about-icon hidden",id:"IM-room-about-icon-settings",html:{tag:"span","class":"fonticon fonticon-pencil",},styles:{"font-weight":"bold","margin-right":"20px"},events:{click:function(k){j.displayModalSettings()}}},{tag:"div","class":"IM-room-about-icon",html:{tag:"span","class":"fonticon fonticon-wrong",},styles:{"font-weight":"bold"},events:{click:function(k){j.display()}}}],styles:{"font-weight":"bold"}},{tag:"div","class":"IM-people-details",html:[{tag:"div","class":"IM-people-details-txt",html:[{tag:"div",html:{tag:"span","class":"fonticon fonticon-users",styles:{margin:"auto",color:"#b4b6ba","font-size":"18px",background:"#f4f5f6"}},styles:{height:"58px",width:"58px",display:"inline-flex",background:"#f1f1f1"}},{tag:"div",html:"PEOPLE",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-left":"20px",flex:"1"}},{tag:"div","class":"IM-people-details-nb-people",html:"0",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"5px",opacity:"0.5"}},{tag:"span","class":"fonticon fonticon-user",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"20px",opacity:"0.5","margin-bottom":"3px"}}],styles:{height:"60px","font-weight":"bold",display:"inline-flex","align-items":"center",background:"#f4f5f6",width:"100%","border-top":"1px solid #d1d4d4","border-bottom":"1px solid #d1d4d4"}},this.scrollerView=new d({element:UWA.createElement("div",{"class":"scrollable-body",styles:{overflow:"hidden",flex:"1",background:"white"},html:{tag:"div","class":"IM-people-details-tumb",}})})]},{tag:"div","class":"IM-shared-details",html:[{tag:"div","class":"IM-shared-details-txt",html:[{tag:"div",html:{tag:"span","class":"fonticon fonticon-forward",styles:{margin:"auto",color:"#b4b6ba","font-size":"18px",background:"#f4f5f6"}},styles:{height:"58px",width:"58px",display:"inline-flex",background:"#f4f5f6"}},{tag:"div",html:"SHARED CONTENT",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-left":"20px",flex:"1"}},{tag:"div","class":"IM-shared-details-nb-content",html:"0",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"5px",opacity:"0.5"}},{tag:"span","class":"fonticon fonticon-doc",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-rigth":"20px",opacity:"0.5","margin-bottom":"3px"}}],styles:{height:"60px","font-weight":"bold",display:"inline-flex","align-items":"center",background:"#f4f5f6",width:"100%","border-top":"1px solid #d1d4d4","border-bottom":"1px solid #d1d4d4"}},new d({element:UWA.createElement("div",{"class":"scrollable-body shared",styles:{overflow:"hidden",background:"#ffffff",flex:"1"},html:{tag:"div","class":"IM-shared-details-tumb",styles:{display:"inline-flex","flex-wrap":"wrap",width:"100%"}}})})]},{tag:"div","class":"IM-calls-details",styles:{display:"none"},html:[{tag:"div","class":"IM-calls-details-txt",html:[{tag:"div","class":"IM-call-svg-icon",styles:{color:"#b4b6ba",width:"58px",height:"58px",padding:"12px","padding-top":"10px",background:"#f4f5f6"},html:{tag:"span","class":"IM-chatpanel-svg",html:e.RTwebrtc_icon_phone,styles:{color:"#b4b6ba"}},events:{click:function(k){j.startAudioCall()}}},{tag:"div",html:"RECENT CALLS",styles:{"font-size":"16px","font-weight":"bold",color:"#77797c","margin-left":"20px"}}],styles:{height:"60px","font-weight":"bold",display:"inline-flex","align-items":"center",background:"#f4f5f6",width:"100%","border-top":"1px solid #d1d4d4","border-bottom":"1px solid #d1d4d4"}},{tag:"div","class":"IM-calls-details-info",styles:{display:"flex","flex-direction":"row","flex-wrap":"wrap",background:"white"}}]}]}})},cleanContent:function(l){this.numContent=0;for(var j in this.tumbs){if(this.tumbs[j].destroy){this.tumbs[j].destroy()}}var k=this.container.getElement(".IM-shared-details");k.style.display="none"},addSharedContent:function(n){var l=this;var p=false;var k=this.container.getElement(".IM-shared-details");if(k.style.display!=="flex"){k.style.display="flex"}if(document.getElementById("tumb"+n.get("media_id"))){return false}this.numContent++;var j=this.container.getElement(".IM-shared-details-nb-content");j.innerHTML=this.numContent;var o=n.get("icon");if(n.get("mime")==="mp4"){p=true}var q=undefined;if(p){q=new i({path:o,isClickable:false})}else{q=UWA.createElement("img",{"class":"IM-thumb-img",draggable:"false",src:o,styles:{"max-width":"100%","max-height":"100%",width:"100%"}})}var m=UWA.createElement("div",{id:"tumb-"+n.get("media_id"),"class":"IM-thumb",styles:{width:"22%",height:"calc(attr(width)*3/4)",margin:"5px",cursor:"pointer",display:"flex","align-items":"center","justify-content":"center",background:"#E9E9E9",position:"relative",overflow:"hidden"},html:[{tag:"div","class":"IM-thumb-img-toolbar",html:[{tag:"span","class":"fonticon fonticon-download",styles:{"font-size":"16px","float":"right",opacity:"0.8","margin-top":"5px"},events:{click:function(r){r.stopPropagation();l.saveFile(n.get("path"),n.get("name"))}}}]}],events:{click:function(r){switch(n.get("mime").toLowerCase()){case"pdf":case"stl":case"3dxml":case"3dxm":case"svg":l.maximizeChat();l.display3dplayer({mime:n.get("mime"),path:n.get("path"),fileName:n.get("name")});break;case"mp4":var s=UWA.createElement("video",{src:n.get("path"),controls:true,styles:{"max-width":"100%","max-height":"100%",margin:"auto"}});l.maximizeChat({video:s});break;default:console.log("test");var t=q.cloneNode();l.maximizeChat({image:t,message:{data:n}})}}}});q.inject(m);if(!this.tumbs){this.tumbs=[]}this.tumbs.push(m);new h({target:m,body:n.get("name")});return m},saveFile:function(k,j){var l=new XMLHttpRequest();l.responseType="blob";l.onload=function(){var m=document.createElement("a");m.href=window.URL.createObjectURL(l.response);m.download=j;m.style.display="none";document.body.appendChild(m);m.click()};l.open("GET",k);l.send()},cleanPeople:function(){var j=this.container.getElement(".IM-people-details");j.style.display="none";var j=this.container.getElement(".IM-people-details-tumb");while(j.firstChild){j.removeChild(j.firstChild)}},setRoom:function(j){this.setPeople(j.users,j.get("room_id"),j.usersLeft);this.room=j},setPeople:function(o,m,n){this.cleanPeople();var k=this.container.getElement(".IM-people-details");k.style.display="flex";this.container.getElement(".scrollable-body").style.height=60*o.length+"px";var l=this;o.forEach(function(q,p){var r=new g({user:q,room_id:m});r.inject(l.container.getElement(".IM-people-details-tumb"))});var j=this.container.getElement(".IM-people-details-nb-people");j.innerHTML=o.length;this.participants=o;if(n){n.forEach(function(q,p){if(o.where({login:q.get("login")}).length==0){var r=new g({user:q,room_id:m,absent:true});r.inject(l.container.getElement(".IM-people-details-tumb"))}})}},display:function(){var j=this.container.offsetWidth;var m=this.container.parentElement.getElement(".IM-chatpanel-history");if(this.container.isHidden()||(this.container.style.marginRight!=="0px"&&this.container.style.marginRight!=="")){this.container.className="IMWInfoRoomView showMe";this.showPanel=true;j=this.container.offsetWidth}else{this.showPanel=false;m.className="IM-chatpanel-history"}var l=this;var k=new UWA.Fx(this.container,{duration:500,transition:"linear",events:{onComplete:function(){if(!l.showPanel){l.container.className="IMWInfoRoomView";l.container.classList.add("hidden")}else{l.container.classList.remove("hidden");m.className="IM-chatpanel-history hideMe"}}}});k.start({marginRight:(this.showPanel)?[(-j),0]:(-j)})},inject:function(j){if(!this.container.isInjected()){this.showPanel=true;this.container.inject(j)}},displayButtonSettings:function(){this.container.getElement("#IM-room-about-icon-settings").classList.remove("hidden")},hideButtonSettings:function(){this.container.getElement("#IM-room-about-icon-settings").classList.add("hidden")},displayModalSettings:function(){this.channelEditionView=new a({type:"edition",room:this.room,editRoom:this.ctrl.editRoom.bind(this.ctrl)});this.channelEditionView.show()}})});define("DS/InstantMessagingW/js/view/IMWGroupView",["UWA/Class/View","DS/UIKIT/Accordion","DS/InstantMessagingW/js/view/IMWContactView"],function(c,a,b){return c.extend({tagName:"div",className:"IMWGroupView",setup:function(d){this.group=d.group;this.listenTo(this.group.users,"onAdd",this.addUser.bind(this));this._createContent()},_createContent:function(){var d=this;this.setContainer({tag:"div","class":"IMWGroupView",html:new a({items:[{title:'<span class="fonticon fonticon-users"></span>'+this.group.get("name"),content:{tag:"div","class":"IM-Group-contacts"}}]})});this.group.users.forEach(function(f,e){d.addUser(f)})},addUser:function(d){var e=this.container.getElement(".IM-Group-contacts");new b({user:d}).inject(e)},inject:function(d){this.container.inject(d)}})});define("DS/InstantMessagingW/js/model/IMWGroupModel",["UWA/Class/Model","UWA/Class/Collection","DS/InstantMessagingW/js/model/IMWContactModel"],function(c,b,a){return c.extend({defaults:{group_id:"noID",name:"DefaultIM",isReadOnly:false,tenant:"DefaultIM",devEnv:false,},setup:function(f){this.users=new b([],{model:a});for(var e=0;e<f.users.length;e++){var d=new a({email:f.users[e].email,login:f.users[e].login,username:f.users[e].username,status:f.users[e].presence.show});this.users.add(d)}},})});define("DS/InstantMessagingW/js/view/IMWShareDataView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWShareContentView"],function(b,a){return b.extend({tagName:"div",className:"IMWShareDataView",setup:function(c){this.contents=undefined;this._drop=c.drop;this.timeOut=undefined;this._createContent(c)},_createContent:function(c){var d=this;this.setContainer({tag:"div","class":"IM-chatpanel-DnD",html:[{tag:"div","class":"IM-chatpanel-DnD-zone",html:[{tag:"span","class":"fonticon handler fonticon-popup IM-chatpanel-DnD-icon",},{tag:"div","class":"IM-chatpanel-DnD-txt",html:"Drop your content here."}]},{tag:"div","class":"IM-chatpanel-DnD-result"},]})},setContents:function(d){if(this.contents){this.stopListening(this.contents,"onAdd");this.contents.reset();var c=this.container.getElement(".IM-chatpanel-DnD-result");while(c.firstChild){c.removeChild(c.firstChild)}}this.contents=d;this.listenTo(this.contents,"onAdd",this.addContent.bind(this))},addContent:function(d){var c=new a({model:d});c.inject(this.container.getElement(".IM-chatpanel-DnD-result"))},display:function(e){var d=this.container.getElement(".IM-chatpanel-DnD-zone");if(e){d.style.display="inline-flex";d.style.opacity="0.9";this.container.style.flex="100%";d.style.flex="1";var c=this;if(this.timeOut){clearTimeout(this.timeOut)}var c=this;this.timeOut=setTimeout(function(){var f=new UWA.Fx(d,{duration:250,transition:"linear",events:{onComplete:function(){d.style.display="none";c.container.style.flex="";c.timeOut=undefined}}});f.start({opacity:0})},5000)}else{d.style.display="none";this.container.style.flex="";d.style.flex=""}},inject:function(d,c){if(c){this.container.inject(d,c)}else{this.container.inject(d)}},domEvents:{drop:"_drop"},})});define("DS/InstantMessagingW/js/view/IMWChatPanelView",["UWA/Class/View","UWA/Fx","DS/UIKIT/Input/Text","UWA/Class/Collection","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/InstantMessagingW/js/view/IMWSectionMessages","DS/InstantMessaging/js/view/RTSendDataView","DS/UIKIT/Scroller","DS/InstantMessagingW/js/view/IMWInfoRoomView","DS/RTColors/RTColors","DS/InstantMessagingWebRTC/assets/svg_icons","DS/InstantMessagingW/assets/demo","DS/InstantMessagingW/js/view/smileycodes","DS/InstantMessagingW/js/view/IMWShareDataView","DS/UIKIT/Alert","i18n!DS/InstantMessagingW/assets/nls/feed","DS/InstantMessagingW/assets/svg_icons_widget","DS/RTProxyDriver/RTLogger","DS/WAFData/WAFData"],function(m,e,n,u,i,o,q,a,r,l,f,c,h,p,s,g,d,j,t,b){var k=true;var v=function(w){t.Widget(w)};v.error=t.error;return m.extend({className:"IMWChatPanelView",discoveryView:function(w){this.container.getElement(".IM-chat-contact").innerHTML="";this.container.getElement(".IM-chatpanel-topbar-icons").innerHTML="";this.container.getElement(".IM-chatpanel-global-details").innerHTML="";this.container.getElement(".IM-chatpanel-global").classList.add("noselect");this.container.getElement(".IM-chat-message").innerHTML="";this.container.getElement(".IM-chatpanel-subtopbar").classList.remove("hidden");this.container.getElement(".IM-chatpanel-svg-icon.backToList").classList.add("hidden");this.isDiscoveryView=true},startX3DPhoto:function(w){this.startX3DPhotoLauncher(w)},setup:function(w){if(w.discovery){this._createContent();this.discoveryView();return true}this.unactiveConversations=w.unactiveConversations;this.room=undefined;this.textToSend="";this.sectionDate=new u([],{comparator:"time"});this.uploadFile=w.uploadFile;this.startX3DPhotoLauncher=w.startX3DPhoto;this.sendMessage=w.sendMessage;this.sendData=w.sendData;this.startCall=w.startCall;this.display3dplayer=w.display3dplayer;this.showInvitationForRoom=w.showInvitationForRoom;this.leaveRoom=w.leaveRoom;this.maxChat=w.maximizeChat;this.miniChat=w.minimizeChat;this.share3dplayer=w.share3dplayer;this.sharex3dphoto=w.ctrl.sharex3dphoto;this.startCoreview=w.startCoreview;this.getArchives=w.getArchives;this.getMedias=w.getMedias;this.ctrl=w.ctrl;this.infoRoomView=new l({display3dplayer:this.load3DPlay.bind(this),maximizeChat:this.maximizeChat.bind(this),ctrl:this.ctrl});this._createContent()},_createContent:function(){var w=this;this.setContainer({tag:"div","class":"IMWChatPanelView",styles:{"border-top":"1px solid #d1d4d4"},html:{tag:"div","class":"IM-chatpanel-global",html:[{tag:"div","class":"IM-chatpanel-topbar",html:[{tag:"div","class":"IM-chatpanel-user-info",html:[{tag:"div","class":"IM-chatpanel-svg-icon backToList",html:{tag:"span","class":"fonticon fonticon-down-open IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px",margin:"auto","-ms-transform":"rotate(90deg)","-webkit-transform":"rotate(90deg)",transform:"rotate(90deg)"}},events:{click:function(x){w.display()}}},{tag:"div","class":"IM-chat-contact noMobile",html:[{tag:"div","class":"IM-chat-contact-img",draggable:"false"}]},{tag:"div","class":"IM-chat-details chatPanel",styles:{color:"#3d3d3d",opacity:1,position:"absolute",right:"0px",top:"0px",bottom:"0px",left:"75px"},html:[{tag:"div","class":"IM-chat-username chatPanel",styles:{"font-size":"18px",color:"#3d3d3d"},html:"nobody"},{tag:"div","class":"IM-chat-message chatPanel",styles:{display:"inline-flex"},html:[{tag:"div","class":"IM-user-status me",styles:{margin:"auto 0","margin-right":"5px"}},{tag:"div","class":"IM-me-details chatPanel",styles:{display:"inline-flex",color:"#77797c",margin:"auto 0","margin-right":"5px"},html:d.online,},{tag:"div","class":"IM-me-role-txt",styles:{display:"inline-flex",color:"rgb(87, 184, 71)",margin:"auto 0","margin-right":"5px"},html:"Owner",},{tag:"div","class":"IM-me-separator chatPanel",html:"|",styles:{margin:"0px 5px"}},{tag:"span","class":"IM-me-role chatPanel fonticon"},{tag:"span","class":"IM-me-security chatPanel fonticon"},{tag:"div","class":"IM-me-place chatPanel",styles:{color:"#77797c",margin:"auto 0","margin-right":"5px",overflow:"hidden","text-overflow":"ellipsis"}}]}]},{tag:"div","class":"IM-chat-menu",html:[{tag:"span","class":"fonticon fonticon-open-down"}]}]},{tag:"div","class":"IM-chatpanel-topbar-icons",html:[{tag:"div","class":"IM-chatpanel-topbar-nnbPeople",styles:{display:"inline-flex"}},{tag:"div","class":"IM-chatpanel-svg-icon share",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",display:"none"},html:{tag:"span","class":"fonticon fonticon-forward  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(x){if(document.rtcwidget_x3dphoto){try{w.share3dplayer()}catch(y){w.sharex3dphoto()}}else{w.share3dplayer()}}}},{tag:"div","class":"IM-chatpanel-svg-icon pencil hidden",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",display:"none"},html:{tag:"span","class":"fonticon fonticon-pencil  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(x){if(w.messageMax){var y=w.messageMax.get("data");w.startX3DPhoto({room_id:w.room.get("room_id"),fileName:y.name,url:y.path.replace("/rtc_service/",document.rtcwidget_RTC_URL)})}}}},{tag:"div","class":"IM-chatpanel-svg-icon phone",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"12px","padding-top":"10px"},html:{tag:"span","class":"IM-chatpanel-svg",html:c.RTwebrtc_icon_phone,styles:{color:"#b4b6ba"}},events:{click:function(x){w.startAudioCall()}}},{tag:"div","class":"IM-chatpanel-svg-icon video",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"12px","padding-top":"10px"},html:{tag:"span","class":"IM-chatpanel-svg",html:c.RTwebrtc_icon_video,styles:{color:"#b4b6ba"}},events:{click:function(x){w.startVideoCall();w.startCoreview()}}},{tag:"div","class":"IM-chatpanel-svg-icon addUser",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px"},html:{tag:"span","class":"fonticon fonticon-user-add  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(x){w.startInvitation()}}},{tag:"div","class":"IM-chatpanel-svg-icon deleteUser",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px"},html:{tag:"span","class":"fonticon fonticon-user-delete  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(x){w.leaveCurrentRoom()}}},{tag:"div","class":"IM-chatpanel-svg-icon info",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",background:"#368ec4"},html:{tag:"span","class":"fonticon fonticon-info  IM-chatpanel-topbar-icon",styles:{color:"#ffffff","font-size":"22px"}},events:{click:function(x){w.infoRoomView.container.style.width="33%";w.infoRoomView.display();if(w.infoRoomView.showPanel){this.style.background="#368ec4";this.firstChild.style.color="white"}else{this.style.background="#f9f9f9";this.firstChild.style.color="rgb(180, 182, 186)"}}}},{tag:"div","class":"IM-chatpanel-svg-icon menu-dot",styles:{color:"#b4b6ba",width:"59px",height:"59px",padding:"14px",display:"none"},html:{tag:"span","class":"fonticon fonticon-menu-dot  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px"}},events:{click:function(x){}}},{tag:"div","class":"IM-chatpanel-svg-icon close",styles:{color:"#b4b6ba",width:"0px",height:"59px",display:"block"},html:{tag:"span","class":"fonticon fonticon-cancel  IM-chatpanel-topbar-icon",styles:{color:"#b4b6ba","font-size":"22px",margin:"14px 20px"}},events:{click:function(x){w.minimizeChat();w.display3dplayer()}}}]}]},{tag:"div","class":"IM-chatpanel-subtopbar hidden"},{tag:"div","class":"IM-chatpanel-global-details",styles:{display:"flex","flex-direction":"row",flex:"1"},html:[{tag:"div","class":"IM-chatpanel-history",styles:{flex:"1",display:"flex","flex-direction":"column"},html:[this.scrollerView=new r({element:UWA.createElement("div",{"class":"scrollable-body",styles:{flex:1,overflow:"hidden",margin:"0px 10px",background:"white"},html:{tag:"div","class":"IM-chatpanel-scroll",}})}),this.sDataView=new s({drop:w.sendDataFromDrop.bind(w)}),{tag:"div","class":"IM-chatpanel-input",html:[{tag:"input","class":"IM-chatpanel-attach-file",type:"file",name:"IM-file-browser-file",styles:{display:"none"},events:{change:function(y){var A=y.target.files;for(var z=0;z<A.length;z++){var B=A[z].name;var x=new FileReader();x.onload=function(D){var H=new Uint8Array(D.target.result);var G=32768;var E=0;var F=H.length;var C="";var J;while(E<F){J=H.subarray(E,Math.min(E+G,F));C+=String.fromCharCode.apply(null,J);E+=G}var I=B.substr(B.lastIndexOf(".")+1,B.length);w.uploadFile({room_id:w.room.get("room_id"),mime:I,name:B,file:C})};w.room.mySharedContent.add({shared:false,name:B});x.readAsArrayBuffer(A[z])}}}},{tag:"span","class":"fonticon fonticon-attach IM-chatpanel-attach",events:{click:function(x){w.getElement(".IM-chatpanel-attach-file").click()}}},{tag:"div","class":"IM-chatpanel-send-input",html:[{tag:"div","class":"RTSendMsg",html:[{tag:"div","class":"holderSendMsg",text:"Send message...",},{tag:"p","class":"placeHolderView",contenteditable:"true",spellcheck:"true",events:{keydown:function(y){y.stopPropagation();var I=w.container.getElement(".holderSendMsg");if(this.textContent!==""){I.style.display="none"}else{I.style.display="block"}if(y.keyCode===13&&this.innerHTML!==""){y.preventDefault();var D=p;var H=this.innerHTML;var B=unescape(this.innerText);var K=B.split(" ");switch(K[0]){case"/3DMessaging":switch(K[1]){case"project":if(K[2]&&K[2]==="list"){var z="https://devopsrioqe420211432-euw1-20dsw10517-3dplan.3dx-staging.3ds.com/3DPLAN/v0/invoke/dsxplan:getAllVersions?$mask=dsplan:MVMask.WorkPackage.Basic&xrequestedwith=xmlhttprequest";var G=["dsxplan:WorkPackage",false];b.authenticatedRequest(z,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(G),onComplete:function(M){console.log("TASKS ADD Reponse : ",M);var N=JSON.parse(M);w.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Here are your project :",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png",projects:N.member},room_id:w.room.get("room_id"),bot:true})}})}break;case"room":if(K[2]&&K[2]==="project"){if(K[3]&&K[3]==="set"){localStorage.setItem(w.room.get("room_id"),K[4]);w.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Project assigned to room.",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:w.room.get("room_id"),bot:true})}if(K[3]&&K[3]==="get"){w.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Project assigned : "+localStorage.getItem(w.room.get("room_id")),icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:w.room.get("room_id"),bot:true})}}else{w.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Room URL :"+document.rtcwidget_RTC_URL+"/room/"+w.room.get("room_id"),icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:w.room.get("room_id"),bot:true})}break;case"apps":if(K[2]){if(K[2]==="enable"){localStorage.setItem("3DIMBOT","enable")}if(K[2]==="disable"){localStorage.setItem("3DIMBOT","disable")}}var A=localStorage.getItem("3DIMBOT");if(A===null){A="disable"}var x=[{title:"Potion",detail:"Create a Potion to manage interactions between your apps, data and events, automatically",state:A,icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/NETDOFT_AP_AppIcon.png"},{title:"Collaborative Task",detail:"Create tasks and manage your project",state:A,icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png"}];w.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Here are your available apps :",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png",apps:x},room_id:w.room.get("room_id"),bot:true});break}break;case"/task":var C=B.replace(K[0]+" "+K[1]+" ","");var J=K[K.length-1];if(J&&J.indexOf("@")!=-1){K[1]="addAndAssign";J=J.replace("@","");C=C.replace(" "+K[K.length-1],"")}switch(K[1]){case"list":var z=document.rtcwidget_Space_URL+"/resources/v1/modeler/tasks?$terse=true&tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader%2eCompany%20Name%2eCommon%20Space&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&%24language=en&%24timezone=-120&xrequestedwith=xmlhttprequest";b.authenticatedRequest(z,{method:"GET",type:"json",timeout:60000,onComplete:function(M){console.log("TASKS Reponse : ",M);w.room.addMessage({message:{bot:"BOT_COLLAB_TASK",title:"Collaborative Task",txt:"Here are your tasks :",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png",tasks:M.data},room_id:w.room.get("room_id"),bot:true})}});break;case"add":var L=localStorage.getItem(w.room.get("room_id"));if(L===null){w.room.addMessage({message:{bot:"BOT_3DMESSAGING",title:"3DMessaging",txt:"Please assign a project : '/3DMessaging room project set ID_PROJECT'",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/X3DIMSG_AP_AppIcon.png"},room_id:w.room.get("room_id"),bot:true})}else{w.addTask(C,function(M){var N={bot:"BOT_COLLAB_TASK",title:"Collaborative Task",txt:"The task '"+C+"' has been created by "+document.rtcwidget_Me.get("username")+". Have a nice day !",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png"};w.sendData({persisted:true,data:btoa(JSON.stringify(N)),typeData:"BOT_DATA",room_id:w.room.get("room_id"),robotName:"BOT_COLLAB_TASK"});w.room.addMessage({message:N,room_id:w.room.get("room_id"),bot:true})})}break;case"addAndAssign":w.searchUser(J,function(M){var N=M.data[0].dataelements.firstname+" "+M.data[0].dataelements.lastname;w.addTask(C,function(O){w.assignTask({user:M,task:JSON.parse(O)},function(P){var Q={bot:"BOT_COLLAB_TASK",title:"Collaborative Task",txt:"Your task '"+C+"' has been created by "+document.rtcwidget_Me.get("username")+" and assignes to "+N+". "+N+" has been notified.  Have a nice day !",icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/ENOTASK_AP_AppIcon.png"};w.sendData({persisted:true,data:btoa(JSON.stringify(Q)),typeData:"BOT_DATA",room_id:w.room.get("room_id"),robotName:"BOT_COLLAB_TASK"});w.room.addMessage({message:Q,room_id:w.room.get("room_id"),bot:true})})})});break}break;default:for(var F in D){var E="";while(E!==H){E=H;H=H.replace('<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(F,10)+1)+'.svg">',D[F])}}w.sendMessage({message:H,room_id:w.room.get("room_id")});w.room.addMessage({message:H,room_id:w.room.get("room_id")})}this.textContent="";this.innerHTML="";w.textToSend=""}if(y.keyCode===27&&this.textContent!==""){this.textContent="";this.innerHTML="";w.textToSend=""}},keyup:function(y){y.stopPropagation();var x=w.container.getElement(".holderSendMsg");if(this.textContent!==""){x.style.display="none"}else{x.style.display="block"}if(y.keyCode===13&&this.textContent===""){y.preventDefault();this.textContent="";this.innerHTML="";w.textToSend=""}}}}]},{tag:"img","class":"smileyIcon",draggable:"false",events:{click:function(x){var y=w.container.getElement(".smileysIconList");if(y.style.display==="block"){y.style.display="none"}else{y.style.display="block"}}}},{tag:"div","class":"smileysIconList",styles:{width:"166px",height:"70px",border:"1px solid #f1f1f1",position:"absolute",top:"-65px",right:"14px","box-shadow":"0px 0px 10px rgba(0,0,0,0.05)",display:"none",background:"white"}}]}]}]},this.infoRoomView]}]}});if(document.rtcwidget_x3dphoto){this.container.getElement(".IM-chatpanel-svg-icon.pencil").classList.remove("hidden")}this.scrollerView.getInnerElement().onscroll=function(){var x=w.scrollerView.getInnerElement();if(!x.scrollTop&&w.room.messages.length>=20){console.log("Scroll to top !");w.getArchives({room_id:w.room.get("room_id"),lastMessageID:w.room.lastMessage.get("message_id")})}};this.initDDView();this.buildDropDownMenu();this.buildTooltip()},addTask:function(x,B){var z=this;var w=localStorage.getItem(z.room.get("room_id"));var y="https://devopsrioqe420211432-euw1-20dsw10517-3dplan.3dx-staging.3ds.com/3DPLAN/v0/invoke/dsxplan:createItemVersion?%24mask=dsplan%3AMVMask%2eTask%2eComplex";var A=[{"dsxplan:usesCalendar":{"@id":"dsplan:EST.Calendar"},"dsxplan:durationIntervalMin":"PT86400S","dsxplan:durationIntervalMax":"PT86400S","@type":"dsxplan:Task","dsxplan:hasContentRepository":"Common Space","dsxplan:label":x,"dsxplan:estimatedStartDate":"2018-05-23T16:04:48.434Z","dsxplan:estimatedEndDate":"2018-05-25T16:04:48.434Z","dsxplan:comment":"","dsxplan:hasMaturity":"Open"},w+"/dsxplan:hasTask"];b.authenticatedRequest(y,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(A),onComplete:function(C){console.log("TASKS ADD Reponse : ",C);B(C)}})},assignTask:function(x,y){var w="https://devopsrioqe420211432-euw1-20dsw10517-3dplan.3dx-staging.3ds.com/3DPLAN/v0/invoke/dsxplan:modifyItemVersion?$mask=dsplan:MVMask.Task.Property&xrequestedwith=xmlhttprequest";var x=[[{op:"add",path:"/dsxplan:hasAssignee/-",value:{"@id":"iam:"+x.user.data[0].dataelements.name}}],x.task.value["@id"]];b.authenticatedRequest(w,{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(x),onComplete:function(z){console.log("TASKS ADD Reponse : ",z);y(z)}})},searchUser:function(x,y){var w=document.rtcwidget_Space_URL+"/resources/v2/e6w/service/PersonSearch?searchStr="+x+"*&tenant="+document.rtcwidget_PlatformID_URL+"&SecurityContext=ctx%3A%3AVPLMProjectLeader.Company%20Name.Common%20Space&e6w-lang=en&e6w-timezone=-120&showProjectTasks=true&currentTaskFilter=all&createSampleData=true&xrequestedwith=xmlhttprequest";b.authenticatedRequest(w,{method:"GET",type:"json",timeout:60000,onComplete:function(z){console.log("TASKS get TOKEN Reponse : ",z);y(z)}})},buildTooltip:function(){var w=[{target:this.container.getElement(".IM-chatpanel-svg-icon.phone"),body:"Audio call"},{target:this.container.getElement(".IM-chatpanel-svg-icon.video"),body:"Video call"},{target:this.container.getElement(".IM-chatpanel-svg-icon.addUser"),body:"Add a user"},{target:this.container.getElement(".IM-chatpanel-svg-icon.deleteUser"),body:d.leave},{target:this.container.getElement(".IM-chatpanel-svg-icon.info"),body:"More information"},{target:this.container.getElement(".IM-chatpanel-svg-icon.close"),body:"Close fullscreen"}];for(var x=0;x<w.length;x++){new o({target:w[x].target,body:w[x].body,position:"bottom"})}},buildDropDownMenu:function(){var x=this;var z=this.container.getElement(".IM-chatpanel-svg-icon.menu-dot");this.dropdownMenu=new i({target:z,items:[],events:{onClick:function(B,A){switch(A.name){case"info":x.infoRoomView.display();break;case"user-delete":x.leaveCurrentRoom();break;case"user-add":x.startInvitation();break}}}});this.dropdownMenu.getContent().style.zIndex="3000";var w={"user-add":"Add user","user-delete":d.leave,info:"About"};for(var y in w){this.dropdownMenu.addItem({text:w[y],name:y,icon:"fonticon fonticon-"+y})}},setupSmileys:function(){this.container.getElement(".smileyIcon").src=document.rtcwidget_Smileys_URL+"smiley.png";var x=p;for(var w in x){(function(y){var z=UWA.createElement("img",{"class":"smileysIcon3DIMLarge",draggable:"false",src:document.rtcwidget_Smileys_URL+"emoji"+(parseInt(y,10)+1)+".svg",events:{click:function(B){var D=this.container.getElement(".smileysIconList");D.style.display="none";var C=x[y]||":)";this.textToSend+=C;var E=this.container.getElement(".placeHolderView");E.innerHTML+='<img class="smileysIcon3DIM" src="'+document.rtcwidget_Smileys_URL+"emoji"+(parseInt(y,10)+1)+'.svg">';var A=this.container.getElement(".holderSendMsg");A.style.display="none"}.bind(this)}});z.inject(this.container.getElement(".smileysIconList"))}.bind(this))(w)}},startInvitation:function(){this.showInvitationForRoom(this.room)},leaveCurrentRoom:function(){this.hide();this.leaveRoom(this.room)},startVideoCall:function(){var w={type:"video",room_id:this.room.get("room_id")};this.startCall(w)},startAudioCall:function(){var w={type:"audio",room_id:this.room.get("room_id")};this.startCall(w)},addMedia:function(z){var y=this.infoRoomView.addSharedContent(z);z.set("view",y);this.room.medias.sort();var x=this.room.medias.indexOf(this.room.medias.where({media_id:z.get("media_id")})[0]);if(x>0&&this.room.medias.size()>1){y.inject(this.room.medias.at(x-1).get("view"),"before")}else{var A=this.infoRoomView.container.getElement(".IM-shared-details-tumb");y.inject(A)}var w=new UWA.Fx(y,{duration:300,transition:"linear"});w.start({opacity:[0,0.9]})},updatePeopleList:function(w){this.infoRoomView.setPeople(this.room.users,w.room_id||(w.room?w.room.room_id:null)||this.room.get("room_id"),this.room.usersLeft);this.updateTitle()},onJoin:function(w){return this.updatePeopleList(w)},onLeave:function(w){return this.updatePeopleList(w)},updateTitle:function(x){var y=this.container.getElement(".IM-chat-username");var w=this.room.users.first();if(!w){w=this.ctrl.me}y.innerHTML=w.get("username");this.room.users.forEach(function(z,A){if(A==0){return true}y.innerHTML+=", "+z.get("username")}.bind(this))},displaySVGicon:function(x){var w=j[x];if(!w){return v.error("svg_icons_widget key not found : "+x)}this.container.getElement(".IM-chat-contact-img").innerHTML=w;this.container.getElement(".IM-chat-contact-img").style.opacity="1";this.container.getElement(".IM-chat-contact-img").style.backgroundImage=""},displayIMG:function(w){this.container.getElement(".IM-chat-contact-img").style.backgroundImage="url('"+w+"')";this.container.getElement(".IM-chat-contact-img").style.opacity="0.9";this.container.getElement(".IM-chat-contact-img").innerHTML=""},showSubTitle:function(){this.container.getElement(".IM-chat-message").classList.remove("hidden")},hideSubTitle:function(){this.container.getElement(".IM-chat-message").classList.add("hidden")},showPresence:function(){this.showSubTitle();this.container.getElement(".IM-user-status").classList.remove("hidden");this.container.getElement(".IM-me-details").classList.remove("hidden")},hidePresence:function(){this.container.getElement(".IM-user-status").classList.add("hidden");this.container.getElement(".IM-me-details").classList.add("hidden");this.hideSeparator()},showSeparator:function(){this.container.getElement(".IM-me-separator").classList.remove("hidden")},hideSeparator:function(){this.container.getElement(".IM-me-separator").classList.add("hidden")},setDescription:function(w){this.container.getElement(".IM-me-place").innerText=w;this.showDescription()},hideDescription:function(w){this.container.getElement(".IM-me-place").classList.add("hidden")},showDescription:function(w){this.container.getElement(".IM-me-place").classList.remove("hidden")},hideSecurity:function(w){this.container.getElement(".IM-me-security").classList.add("hidden")},showSecurity:function(w){this.container.getElement(".IM-me-security").classList.remove("hidden")},setSecurity:function(y){var x,w;if(y=="private"){x="fonticon-lock";w=d.PrivateSentence}else{if(y=="secret"){x="fonticon-eye-off";w=d.SecretSentence}else{if(y=="public"){x="fonticon-globe";w=d.PublicSentence}else{return v.error("unknown security "+y)}}}this.container.getElement(".IM-me-security").classList.remove("fonticon-lock");this.container.getElement(".IM-me-security").classList.remove("fonticon-eye-off");this.container.getElement(".IM-me-security").classList.remove("fonticon-globe");this.container.getElement(".IM-me-security").classList.add(x);if(k){this.showSecurity()}if(this.tooltipSecurity){this.tooltipSecurity.destroy()}this.tooltipSecurity=new o({target:this.container.getElement(".IM-me-security"),body:w,position:"bottom"})},hideRole:function(w){this.container.getElement(".IM-me-role-txt").classList.add("hidden");this.hideSeparator()},showRole:function(w){this.container.getElement(".IM-me-role-txt").classList.remove("hidden")},setRole:function(w){if(w=="owner"){if(this.tooltipRole){this.tooltipRole.destroy()}this.tooltipRole=new o({target:this.container.getElement(".IM-me-role-txt"),body:d.IamOwnerSentence,position:"bottom"});this.showSeparator();this.showRole()}else{if(w=="member"){}else{v.error("role unknown : "+w)}}},setRoomListeners:function(){this.listenTo(this.room,"onChange:name",this.updateName.bind(this));this.listenTo(this.room,"onChange:pathImage",this.updateImage.bind(this));this.listenTo(this.room,"onChange:description",this.updateDescription.bind(this));this.listenTo(this.room,"onChange:security",this.updateSecurity.bind(this))},unsetRoomListeners:function(){this.stopListening()},updateImage:function(){var w=this.room.get("pathImage");if(w){this.displayIMG(w)}else{return false}return true},updateName:function(){var w=this.container.getElement(".IM-chat-username");w.innerHTML=this.room.get("name")},updateDescription:function(){var w=this.room.get("description");if(w){this.setDescription(w)}},updateSecurity:function(){var w=this.room.get("security");if(w){this.setSecurity(w)}},startChat:function(y){if(!this.room||this.room.get("room_id")!==y.room.get("room_id")){this.stopListening();this.room=y.room;this.setRoomListeners();this.sectionDate.reset();this.infoRoomView.cleanContent();this.room.cleanMedias();window.top.currentRoomId=this.room.get("room_id");this.getMedias({room_id:this.room.get("room_id")});this.listenTo(this.room.messages,"onAdd",this.addMessage.bind(this));this.listenTo(this.room.users,"onAdd",this.updatePeopleList.bind(this));this.listenTo(this.room.users,"onRemove",this.updatePeopleList.bind(this));this.listenTo(this.room.usersLeft,"onAdd",this.updatePeopleList.bind(this));this.listenTo(this.room.usersLeft,"onRemove",this.updatePeopleList.bind(this));this.listenTo(this.room.medias,"onAdd",this.addMedia.bind(this));var x=this.container.getElement(".IM-chat-username");this.hideDescription();this.hideSecurity();this.hideRole();this.infoRoomView.hideButtonSettings();if(!this.room.get("directmessage")){x.innerHTML=this.room.get("name");if(!this.updateImage()){this.displaySVGicon("room_default")}this.hidePresence();this.showSubTitle();this.updateDescription();this.updateSecurity();var C=document.rtcwidget_Me.getRole(this.room.get("room_id"));if(C){this.setRole(C)}if(C==="owner"){this.infoRoomView.displayButtonSettings()}}else{if(this.room.get("nway")){var B=this.room.users.first();if(!B){B=this.ctrl.me}x.innerHTML=B.get("username");this.displaySVGicon("group_chat");this.hidePresence();this.room.users.forEach(function(F,G){if(G==0){return true}x.innerHTML+=", "+F.get("username")}.bind(this))}else{var B=this.room.users.first();if(!B){B=this.ctrl.me}this.showPresence();this.container.getElement(".IM-user-status").style.background=f[B.get("status").toLowerCase()];this.container.getElement(".IM-me-details").innerHTML=B.get("status").capitalize();this.listenTo(B,"onChange:status",function(H){var F=H.get("status");var G=f[F.toLowerCase()];this.container.getElement(".IM-user-status").style.background=G;this.container.getElement(".IM-me-details").innerHTML=B.get("status").capitalize()}.bind(this));this.displayIMG(document.rtcwidget_Swym_URL+B.get("login")+"/format");x.innerHTML=B.get("username")}}this.sDataView.setContents(this.room.mySharedContent);var w=this.container.getElement(".IM-chatpanel-scroll");while(w.firstChild){w.removeChild(w.firstChild)}var E=this;var A=this.room.messages.sortBy("createDate");var z=false;A.forEach(function(G,F){if(!z&&G.get("read_date")==="none"&&Object.keys(G.get("user")).length!=0){z=true;G.set("displayUnread",true)}if(G.get("read_date")==="none"){G.set("read_date",Date.now())}E.addMessage(G)});this.scrollToEnd();var D=this.container.getElement(".IM-chatpanel-topbar-nnbPeople");if(this.room.get("nway")){D.style.display="none"}else{this.infoRoomView.cleanPeople();D.style.display="none"}this.infoRoomView.setRoom(this.room);this.getArchives({room_id:this.room.get("room_id"),lastMessageID:this.room.lastMessage?this.room.lastMessage.get("message_id"):null})}},scrollToEnd:function(){var w=this.container.getElement(".IM-chatpanel-scroll");this.scrollerView.scrollTo(0,w.scrollHeight)},load3DPlay:function(w){this._3DplayData=w;this.display3dplayer({mime:w.mime,path:w.path,fileName:w.fileName,room_id:this.room.get("room_id")})},showShareBtn:function(w){this.container.getElement(".IM-chatpanel-svg-icon.share").style.display="block"},display:function(y){var x=this.container.offsetWidth;if(x<800){this.showPanel=y||!this.showPanel;var x=this.container.offsetWidth;var z=new UWA.Fx(this.container,{duration:300,transition:"sineOut"});z.start({left:(this.showPanel)?[x,0]:x,right:(this.showPanel)?[-x,0]:-x})}},addMessage:function(I){var z=this.scrollerView.getInnerElement();var x=z.scrollTop;var J=z.scrollHeight;var w=this.container.getElement(".IM-chatpanel-scroll").firstChild;var y=undefined;if(w){y=w.firstChild}var F=new Date(I.get("createDate"));var K={weekday:"long",month:"long",day:"numeric"};if(I.get("origin")==="media"&&I.get("data").name){var C=this.room.mySharedContent.where({name:I.get("data").name});for(var B=0;B<C.length;B++){if(!C[B].get("shared")){C[B].set("shared",true);break}}}var D=F.toLocaleDateString("en-US",K);var G=this.sectionDate.where({title:D});if(G.length===0){this.addSectionDate(F)}G=this.sectionDate.where({title:D});G[0].get("view").addMessage(I);if(I.get("origin")==="media"){var A=I.get("data");A.date=I.get("createDate");this.room.addMedia(A)}var H=this.container.getElement(".IM-chatpanel-scroll").firstChild;var E=undefined;if(H){E=H.firstChild}if(w&&y&&(H!==w||E!==y)){z.scrollTop=z.scrollHeight-J}else{this.scrollToEnd()}},addSectionDate:function(x){var y={weekday:"long",month:"long",day:"numeric"};var B=x.toLocaleDateString("en-US",y);var A=new q({refDate:B,display3dplayer:this.load3DPlay.bind(this),maximizeChat:this.maximizeChat.bind(this),scrollTo:this.scrollToEnd.bind(this),searchUser:this.searchUser.bind(this),assignTask:this.assignTask.bind(this)});this.sectionDate.add({title:B,time:x.getTime(),view:A});this.sectionDate.sort();var z=this.sectionDate.indexOf(this.sectionDate.where({time:x.getTime()})[0]);if(z<(this.sectionDate.size()-1)&&this.sectionDate.size()>1){A.inject(this.sectionDate.at(z+1).get("view").container,"before")}else{var w=this.container.getElement(".IM-chatpanel-scroll");A.inject(w)}},addRobotMessage:function(A){var B=A.get("data").name;var w=B.substr(B.lastIndexOf(".")+1,B.length);var y=this;var z=UWA.createElement("div",{"class":"robotmessage",html:[{tag:"div",html:"I can add this file in 3DDrive. Do you agree ? "},{tag:"a",html:"Yes please"},{tag:"a",html:"No. Maybe next time",events:{click:function(C){var D=this.getParents();for(var E=0;E<D.length;E++){if(D[E].className==="IMWMessageView-global"){var F=new UWA.Fx(D[E],{duration:300,transition:"linear"});F.start({height:0});break}}}}},{tag:"a",html:"Never"}]});var x={message_id:A.get("message_id")+"_robotmessage",message:null,html:z,isSent:false,fileName:B,readBy:{},devEnv:false,user:document.bot2,login:"BOT2",data:A.get("data"),origin:"bot",createDate:A.get("createDate")};this.room.addMessage(x)},inject:function(w){this.showPanel=true;if(this.container.isInjected()){this.container.style.display="block";this.container.style.left=0;this.container.style.right=0;this.display(this.showPanel)}else{this.container.inject(w);this.container.style.left=0;this.container.style.right=0;this.display(this.showPanel)}},maximizeChat:function(A){this.stateOfInfo=this.infoRoomView.showPanel;var C=this;var F=document.body.offsetWidth;var B=document.body.offsetHeight;if(this.infoRoomView.showPanel){this.infoRoomView.display()}this.imgMsg=undefined;if(A&&(A.image||A.video)){if(A.image){A.image.style.height="";A.image.style.width="";A.image.style.position="absolute";A.image.style.top="0";A.image.style.bottom="0";A.image.style.left="0";A.image.style.right="0";A.image.style["max-width"]="900px";A.image.style["max-height"]="100%";A.image.style.margin="auto";A.image.className=""}this.messageMax=A.message&&A.message.data?A.message.data:A.message;if(this.messageMax&&!this.messageMax.get("data")){this.messageMax.set("data",A.message._attributes)}this.imgMsg=UWA.createElement("div",{"class":"IM-MAX-IMG",html:A.image||A.video});this.imgMsg.inject(document.body);var x=this.imgMsg.getOffsets().y;var z=new UWA.Fx(this.imgMsg,{duration:400,transition:"linear",events:{onComplete:function(){C.container.className="IMWChatPanelView fullscreen";C.imgMsg.className="IM-MAX-IMG fullscreen"}}});z.start({top:[B,x]})}var E=this.container.getElement(".IM-chatpanel-user-info");if(document.rtcwidget_x3dphoto){this.container.getElement(".IM-chatpanel-svg-icon.pencil").style.display="block";this.container.getElement(".IM-chatpanel-svg-icon.share").style.display="block"}var G=this.container.getElement(".IM-chatpanel-svg-icon.close");var D=this.container.getElement(".IM-chatpanel-svg-icon.backToList");D.classList.add("hidden");var y=this.container.getElement(".IM-chatpanel-svg-icon.info");y.style.background="#f9f9f9";y.firstChild.style.color="rgb(180, 182, 186)";G.style.width="59px";this.maxChat()},minimizeChat:function(){this.messageMax=undefined;this._3DplayData=undefined;var B=this;var E=document.body.offsetWidth;var A=document.body.offsetHeight;var C=this.container.getElement(".IM-chatpanel-svg-icon.backToList");if(!this.isDiscoveryView){C.classList.remove("hidden")}var D=this.container.getElement(".IM-chatpanel-user-info");if(document.rtcwidget_x3dphoto){this.container.getElement(".IM-chatpanel-svg-icon.share").style.display="none";this.container.getElement(".IM-chatpanel-svg-icon.pencil").style.display="none"}var F=this.container.getElement(".IM-chatpanel-svg-icon.close");this.container.className="IMWChatPanelView";var y=F.offsetWidth;if(this.imgMsg){this.imgMsg.className="IM-MAX-IMG";var z=new UWA.Fx(this.imgMsg,{duration:400,transition:"linear",events:{onComplete:function(){B.imgMsg.destroy()}}});z.start({top:A})}this.miniChat();F.style.width="0px";D.style.paddingLeft="0px";if(this.stateOfInfo){this.infoRoomView.display()}var x=this.container.getElement(".IM-chatpanel-svg-icon.info");x.style.background="#368ec4";x.firstChild.style.color="white"},initDDView:function(){this.sendDataView=new a({panelId:"panelId",events:{ondrop:this.sendDataFromDrop.bind(this)}});if(this.sendDataView){this.sendDataView.getView().style.bottom=0;this.sendDataView.getView().style.top="20%";this.sendDataView.getView().style.left="";this.sendDataView.getView().style.right="";this.sendDataView.getView().style.bottom="";this.sendDataView.getView().style.width="50%";this.sendDataView.getView().style.height="50%";this.container.addContent(this.sendDataView.getView())}this.container.ondragover=this.showDDView.bind(this)},showDDView:function(w){w.preventDefault();this.sDataView.display(true)},sendGeneratedView:function(B,F,y,x,G,z){if(!B){if(B===null){return v("RTChatController - dropped widget format is not supported")}else{if(B===false){return v("RTChatController - can not generate html view from dropped widget")}}return v("RTChatController - unknown error about generatedStringView")}else{var D,w=false;try{D=btoa(unescape(encodeURIComponent(B)))}catch(E){return v("RTChatController - unable to btoa generated view")}if(x=="coreviewInvitation"){F=JSON.stringify(F)}else{if(x!="fileTransferInvitation"){w=true}}var C={data:encodeURIComponent(JSON.stringify(F)),datahtml:D,uri:y};C=btoa(JSON.stringify(C));this.sendData({persisted:w,data:C,typeData:x,options:G,room_id:this.room.get("room_id")});if(x=="fileTransferInvitation"){var A=this.sendDataView.files[z];if(!A){v("can not find the file "+z)}else{this.sendData({data:A.data,typeData:"fileTransfer",options:A,room_id:this.room.get("room_id")})}}this.room.addMessage({html:B,fileId:z,fileName:G?G.fileName:null,room_id:this.room.get("room_id")})}},generateViewFromFile:function(z){var y=z.fileName.substr(z.fileName.indexOf(".")+1,z.fileName.length);var w=z.fileName.substr(0,z.fileName.indexOf(y)-1);var x="<div class='fileTransfer' id='"+z.fileId+"'  style='line-height:60px; padding-left:10px; height:"+((y==="3dxml")?"216px":"60px")+"; background:"+((y==="3dxml")?"#ffffff":"#f1f1f1")+"; color:black; display:flex; align-items:center; flex-wrap:nowrap; flex-direction:row; '>";var A;switch(y){case"jpg":A="http://images.all-free-download.com/images/graphiclarge/jpg_file_37138.jpg";break;case"pdf":A="https://www.linuxvoice.com/wp-content/uploads/2016/12/adobe-pdf-icon.png";break;case"3dxml":A="https://dsqal001-euw1-20psp21115-rtc.3dx-staging.3ds.com/public/media/"+w+".png";break;default:A="https://cdn1.iconfinder.com/data/icons/education-set-3/512/text-file-512.png"}if(y==="3dxml"){x+="<img height='216px' src='"+A+"'/>"}else{x+="<img height='32px' src='"+A+"'/>";x+="<span style='margin-left:10px'> "+w+"</span>"}x+="<span class='download' style='margin:0 auto; margin-right:10px; width:40px; display:flex; justify-content:flex-end; margin-right:30px; align-items:center; flex-direction:row'>";x+="<div class=\"fileTransDown fonticon fonticon-download\" style='color:#77797C;margin-right:0px; font-size:1.7em' onclick=\"document['download"+z.fileId+"']()\">";x+="</div>";x+="</div>";x+="</div>";return x},replaceProgressBar:function(w,y,x){this.container.getElementById(w).style.color=x;this.container.getElementById(w).innerHTML=y},sendDataFromDrop:function(G){this.sDataView.display(false);var B=this;var E=50000000;G.stopPropagation();G.preventDefault();var y=!G?null:G.dataTransfer?G.dataTransfer.files:G.target?G.target.files:null;var F=[];var D;var A;var z;var K=null;if(y&&y.length>0&&(G.dataTransfer.types.length==1||G.dataTransfer.types[0]&&G.dataTransfer.types[0].indexOf("moz")!=-1)){D="fileTransfer";var H,I,M="";for(H=0;I=y[H];H++){M=y[H].name;F[M]=new FileReader();F[M].fileName=M;var L="3DIMfiletransfer"+Date.now();F[M].fileId=L;F[M].size=y[H].size;if(F[M].size>E){continue}F[M].onload=function(P){var T=new Uint8Array(P.target.result);var S=32768;var Q=0;var R=T.length;var O="";var V;while(Q<R){V=T.subarray(Q,Math.min(Q+S,R));O+=String.fromCharCode.apply(null,V);Q+=S}var U=M.substr(M.lastIndexOf(".")+1,M.length);B.uploadFile({room_id:B.room.get("room_id"),mime:U,name:M,file:O});delete F[M]};F[M].readAsArrayBuffer(y[H]);this.room.mySharedContent.add({shared:false,name:M})}}else{D="DS3DXContent";var x,w;if(G.dataTransfer&&G.dataTransfer.getData&&G.dataTransfer.types){if(!Array.prototype.contains){if(Array.prototype.includes){Array.prototype.contains=Array.prototype.includes}else{Array.prototype.contains=function(O){if(G.dataTransfer.types.indexOf(O)!=-1){return true}return false}}}if(G.dataTransfer.types.contains("text")||G.dataTransfer.types.contains("Text")){A=G.dataTransfer.getData("text")}else{if(G.dataTransfer.types.contains("text/plain")){A=G.dataTransfer.getData("text/plain")}else{return v("RTChatController ondrop senddata view : no data found in dataTransfer")}}if(G.dataTransfer.types.contains("text/plain")){x=G.dataTransfer.getData("text/plain")}else{x=A}if(G.dataTransfer.types.contains("text/uri-list")){z=G.dataTransfer.getData("text/uri-list")}else{if(G.dataTransfer.types.contains("Url")){z=G.dataTransfer.getData("Url")}else{z=A.url?A.url:null}}if(G.dataTransfer.types.contains("text/html")){w=G.dataTransfer.getData("text/html")}else{w=A}}else{if(G.detail){A=G.detail;x=A;w=A;z=A.url?A.url:G.detail.data&&G.detail.data.items&&G.detail.data.items[0]?G.detail.data.items[0].urlContent:null}else{return v("RTChatController ondrop senddata view : no data attached")}}var N=undefined;if(typeof A=="object"){N=A}else{try{N=JSON.parse(A)}catch(J){v(J);N=undefined}}if(N&&N.data&&N.data.items&&N.data.items[0]&&N.data.items[0].serviceId!="3DDrive"&&(N.data.items[0].serviceId=="3DSwym"||(N.source==="X3DCSMA_AP"||N.source==="X3DMCTY_AP"||N.source=="X3DWNEW_AP"||N.source=="X3DDRIV_AP"||N.source=="X3PDRIV_AP"))){K=B.sendDataView.generateViewFromJson(N.data.items[0]);if(!K){K=B.sendDataView.generateViewFromTile(N.data.items[0])}}else{if(N&&N.type&&N.type=="coreview"){if(!N.channel){return v("RTChatController sendDataFromDrop received a coreview without channel !")}this.initCoreview(N.channel,true);K=null;B.sendGeneratedView("<div></div>",N,null,"coreviewInvitation",N);return true}else{if(w&&w.indexOf("item-title")!=-1){K=B.sendDataView.generateViewFromNetvibes(w)}}}if(!K){if(w&&typeof w=="string"){var C=w.slice(w.length-3);if(w.indexOf("<img")===0){K=B.sendDataView.generateViewFromImage(x);z=B.sendDataView.getURLFromImageString(K)}else{if(w.indexOf("http")==0&&(C=="jpg"||C=="png"||C=="gif"||C=="bmp")){K=B.sendDataView.generateViewFromImage(w)}else{if(w.indexOf("<a")!=-1){K=B.sendDataView.generateViewFromLink(w)}}}}if(!K&&z&&z.length>0){K=B.sendDataView.generateViewFromUrl(z)}}if(K&&K.length>E){this.displayAlertSizeLimitReached();return false}if(K){B.sendGeneratedView(K,A,z,D)}else{return false}}}})});define("DS/InstantMessagingW/js/view/IMWGroupsView",["UWA/Class/View","DS/InstantMessagingW/js/view/IMWGroupView","DS/UIKIT/Scroller"],function(c,b,a){return c.extend({tagName:"div",className:"IMWGroupsView",setup:function(d){this.groups=d.groups;this.listenTo(this.groups,"onAdd",this.addGroup.bind(this));this._createContent()},_createContent:function(){var d=this;this.setContainer({tag:"div","class":"IMWGroupsView",html:[{tag:"div","class":"IMWAddGroup",html:[{tag:"div","class":"IM-addGroup-name",text:"Add group"},{tag:"span","class":"fonticon fonticon-plus"}]},this.scrollerView=new a({element:UWA.createElement("div",{"class":"scrollable-body",styles:{height:"100%"},html:{tag:"div","class":"IMWListGroupsView"}})})]})},addGroup:function(e){var d=new b({group:e,startChat:this.startChat});d.inject(this.container.getElement(".IMWListGroupsView"))},inject:function(d){this.container.inject(d)}})});define("DS/InstantMessagingW/js/view/IMWdiscovery",["UWA/Class/View","DS/RTProxyDriver/RTLogger","DS/InstantMessagingW/assets/svg_icons_widget","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","i18n!DS/InstantMessagingW/assets/nls/feed","DS/UIKIT/Spinner","DS/InstantMessagingW/js/view/IMWdiscoveroom","DS/InstantMessagingW/js/view/IMWChatPanelView","DS/InstantMessagingW/js/model/IMWRoomModel","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Toggler"],function(b,m,a,g,j,l,d,e,i,h,k,f,c){return b.extend({tagName:"div",className:"IMWDiscovery",setup:function(n){this.id=n.id;this.ctrl=n.ctrl;this.returnAction=n.returnAction;this.chatPanelView=new i({discovery:true});this.addRooms(this.ctrl.publicRooms);this.render();this.listenTo(this.ctrl.publicRooms,"onAdd",this.addRoom);this.listenTo(this.ctrl.publicRooms,"onRemove",this.removeRoom)},displayEmptyMessageIfNeeded:function(){var o=this.browser.getElements(".IMWdiscoveroom2");for(var n=0;n<o.length;n++){if(!o[n].isHidden()){return this.hideEmptyMessage()}}this.showEmptyMessage()},resetParams:function(){this.showJoinedRooms();this.joinedRoomsBtn.setActive();this.leftRoomsBtn.setActive();this.showLeftRooms();this.searchInput.setValue("");this.search()},search:function(o){var p,q=this.searchInput.getValue();this.searchInput.setValue(q);if(!q){p=this.ctrl.publicRooms}else{var n=function(r){return(r.get("name")||"").indexOf(q)==-1&&(r.get("description")||"").indexOf(q)==-1};p=this.ctrl.publicRooms.reject(n);this.ctrl.publicRooms.forEach((function(r){return function(t,s){r.browser.getElement("#disco"+t.get("room_id")).classList.add("hidden")}})(this))}p.forEach((function(r){return function(t,s){r.browser.getElement("#disco"+t.get("room_id")).classList.remove("hidden")}})(this));if(p.length==0){this.showEmptyMessage()}else{this.hideEmptyMessage()}},showEmptyMessage:function(){this.browser.getElement(".discoEmptyMessage").classList.remove("hidden")},hideEmptyMessage:function(){this.browser.getElement(".discoEmptyMessage").classList.add("hidden")},addRooms:function(n){n.forEach((function(o){return function(q,p){o.addRoom(q)}})(this))},addRoom:function(n){var o=new e({model:n,ctrl:this.ctrl});if(this.cardCreation){o.render().inject(this.cardCreation,"after")}else{o.render().inject(this.browser,"top")}},removeRoom:function(n){this.browser.getElement("#disco"+n.get("room_id")).destroy()},hideJoinedRooms:function(){this.container.classList.add("hideJoined")},showJoinedRooms:function(){this.container.classList.remove("hideJoined")},toggleDisplayJoinedRooms:function(){if(this.joinedRoomsBtn.isActive()){this.joinedRoomsBtn.setActive(false);this.hideJoinedRooms()}else{this.joinedRoomsBtn.setActive();this.showJoinedRooms()}this.displayEmptyMessageIfNeeded()},togglerFactory:function(){return(function(n){return function(){n.toggleDisplayJoinedRooms()}})(this)},hideLeftRooms:function(){this.container.classList.add("hideLeft")},showLeftRooms:function(){this.container.classList.remove("hideLeft")},toggleDisplayLeftRooms:function(){if(this.leftRoomsBtn.isActive()){this.leftRoomsBtn.setActive(false);this.hideLeftRooms()}else{this.leftRoomsBtn.setActive();this.showLeftRooms()}this.displayEmptyMessageIfNeeded()},togglerLeftFactory:function(){return(function(n){return function(){n.toggleDisplayLeftRooms()}})(this)},resetViewFactory:function(){return(function(n){return function(){n.resetParams()}})(this)},showParams:function(){if(this.chatPanelView.getElement(".IM-chatpanel-subtopbar").hasClassName("notHidden")){this.chatPanelView.getElement(".IM-chatpanel-subtopbar").classList.remove("notHidden")}else{this.chatPanelView.getElement(".IM-chatpanel-subtopbar").classList.add("notHidden")}},showParamsFactory:function(){return(function(n){return function(){n.showParams()}})(this)},createEmptyCard:function(n){return UWA.createElement("div",{id:n,"class":"IMWdiscoveroom2",html:[{tag:"div","class":"card card-thumbnail",events:{mouseover:function(){this.classList.add("card-thumbnail-selectable")},mouseout:function(){this.classList.remove("card-thumbnail-selectable")}}},{tag:"div","class":"fakeCardWidth"}]})},createAddRoomCard:function(){this.cardCreation=this.createEmptyCard("discoCreateRoom");var n=UWA.createElement("div",{"class":"discoCreateRoomContent",html:[{"class":"fonticon fonticon-plus",tag:"span"},{"class":"",tag:"span",html:l.CreateRoom}]});this.cardCreation.inject(this.browser,"top");this.cardCreation.addEvent("click",this.startCreationFactory());n.inject(this.cardCreation.getElement(".card"))},startCreationFactory:function(){return(function(n){return function(){n.ctrl.IMWView.showChannelCreationView()}})(this)},render:function(){this.chatPanelView.inject(this.container);this.browser=this.chatPanelView.getElement(".IM-chatpanel-global-details");this.browser.setStyle("flex","1");this.createAddRoomCard();if(this.returnAction){this.backIcon=UWA.createElement("span",{"class":"fonticon fonticon-chevron-left noMobile",styles:{"font-size":"40px",color:"#003c5a",cursor:"pointer"}}).inject(this.chatPanelView.getElement(".IM-chat-contact"));this.backIcon.addEvent("click",this.returnAction);this.chatPanelView.getElement(".IM-chat-details").style.left="130px";this.tooltipBack=new j({position:"left",target:this.backIcon,body:l.backToFMOT})}this.icon=UWA.createElement("span",{"class":"fonticon fonticon-globe noMobile",styles:{"font-size":"40px",color:"#003c5a"}}).inject(this.chatPanelView.getElement(".IM-chat-contact"));this.chatPanelView.getElement(".IM-chat-username").innerHTML=l.DISCOVER;this.chatPanelView.getElement(".IM-chat-message").innerHTML=l.DiscoverInfo;this.emptyMessage=UWA.createElement("span",{"class":"discoEmptyMessage hidden",html:l.noRoomFound}).inject(this.browser);this.cogWheel=UWA.createElement("span",{"class":"fonticon fonticon-filter"}).inject(this.chatPanelView.getElement(".IM-chatpanel-topbar-icons"));this.cogWheel.addEvent("click",this.showParamsFactory());this.searchInput=(new f({placeholder:l.Search+"..."})).inject(this.chatPanelView.getElement(".IM-chatpanel-topbar-icons"),"top");this.searchInput.elements.container.addEventListener("keyup",(function(n){return function(o){n.search(o.key)}})(this));this.discoParams=UWA.createElement("span",{"class":"discoParams"}).inject(this.chatPanelView.getElement(".IM-chatpanel-subtopbar"));this.joinedRoomsBtn=new g({value:l.alreadyIn,className:"primary"}).setActive().inject(this.container.getElement(".discoParams"));this.joinedRoomsBtn.addEvent("onClick",this.togglerFactory());this.leftRoomsBtn=new g({value:l.notIn,className:"primary"}).setActive().inject(this.container.getElement(".discoParams"));this.leftRoomsBtn.addEvent("onClick",this.togglerLeftFactory());this.resetBtn=new g({value:l.Reset,className:"primary"}).inject(this.container.getElement(".discoParams"));this.resetBtn.addEvent("onClick",this.resetViewFactory());return this}})});define("DS/InstantMessagingW/js/view/IMWView",["UWA/Class/View","DS/UIKIT/Input/Text","DS/InstantMessagingW/js/view/IMWConversationsView","DS/InstantMessagingW/js/view/IMWGroupsView","DS/InstantMessagingW/js/view/IMWSearchView","DS/InstantMessagingW/js/view/IMWChatPanelView","DS/InstantMessagingW/js/view/IMWRoomCreationView","DS/InstantMessagingW/js/view/IMWMeInfo","DS/InstantMessagingW/js/view/IMWNotification","DS/InstantMessagingW/js/view/IMW3DPlayPlayer","DS/InstantMessagingW/js/view/IMWdiscovery","DS/UIKIT/Modal","css!InstantMessagingW/InstantMessagingW.css"],function(c,e,b,d,f,j,a,h,m,g,l,i){var k=c.extend({setup:function(n){this.ctrl=n.ctrl;this._createContent()},_createContent:function(){var n=this;this.setContainer({tag:"div","class":"IM-tab"+((this.options&&this.options.active)?" active":""),html:[{tag:"span","class":"fonticon "+this.options.icon+" IM-tab-icon"+((this.options&&this.options.active)?" active":""),},{tag:"div","class":"IM-tab-name"+((this.options&&this.options.active)?" active":""),html:(this.options&&this.options.label)?this.options.label:undefined}],events:{click:function(o){if(this.className!=="IM-tab active"){var q=this.getParent().getElements(".IM-tab");for(var p=0;p<q.length;p++){q[p].className="IM-tab";q[p].getElement(".IM-tab-name").className="IM-tab-name";var r=q[p].getElement(".IM-tab-icon").className;q[p].getElement(".IM-tab-icon").className=r.substr(0,r.indexOf("IM-tab-icon")+"IM-tab-icon".length)}this.className="IM-tab active";this.getElement(".IM-tab-name").className="IM-tab-name active";this.getElement(".IM-tab-icon").className="fonticon "+n.options.icon+" IM-tab-icon active";if(n.options.events&&n.options.events.click){n.options.events.click(o)}}},mouseover:function(){if(this.className!=="IM-tab active"){this.className="IM-tab hover";this.getElement(".IM-tab-name").className="IM-tab-name hover";this.getElement(".IM-tab-icon").className="fonticon "+n.options.icon+" IM-tab-icon hover"}},mouseout:function(){if(this.className!=="IM-tab active"){this.className="IM-tab";this.getElement(".IM-tab-name").className="IM-tab-name";this.getElement(".IM-tab-icon").className="fonticon "+n.options.icon+" IM-tab-icon"}}}})},});return c.extend({setup:function(n){this.ctrl=n.ctrl;this.ctrl.addMe=this.addMe.bind(this);this.ctrl.onCoreview=this.onCoreview.bind(this);this.conversationsView=new b({ctrl:this.ctrl,rooms:this.ctrl.rooms,showDMCreationView:this.showDMCreationView.bind(this),showChannelCreationView:this.showChannelCreationView.bind(this),search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this),doSearch:this.ctrl.doSearch.bind(this)});this.channelsView=new b({ctrl:this.ctrl,rooms:this.ctrl.rooms,search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this),doSearch:this.ctrl.doSearch.bind(this)});this.groupsView=new d({groups:this.ctrl.groups});this.searchView=new f({search:this.ctrl.search,startChat:this.startChat.bind(this)});this.playerView=new g({ctrl:this.ctrl,uploadFile:this.ctrl.uploadFile.bind(this.ctrl),launchCoreview:this.ctrl.launchCoreview.bind(this.ctrl)});this.chatPanelView=new j({unactiveConversations:this.conversationsView.unactiveConversations.bind(this.conversationsView),sendMessage:this.ctrl.sendMessage,sendData:this.ctrl.sendData,startCall:this.ctrl.startCall,leaveRoom:this.ctrl.leaveRoom.bind(this.ctrl),showInvitationForRoom:this.showInvitationForRoom.bind(this),display3dplayer:this.playerView.display3dplayer.bind(this.playerView),share3dplayer:this.playerView.send.bind(this.playerView),startCoreview:this.playerView.startCoreview.bind(this.playerView),uploadFile:this.ctrl.uploadFile.bind(this.ctrl),startX3DPhoto:this.ctrl.startX3DPhoto.bind(this.ctrl),maximizeChat:this.maximizeChat.bind(this),minimizeChat:this.minimizeChat.bind(this),getArchives:this.ctrl.getArchives.bind(this.ctrl),getMedias:this.ctrl.getMedias.bind(this.ctrl),ctrl:this.ctrl});this.channelCreationView=new a({type:"channel",search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this.ctrl),doSearch:this.ctrl.doSearch.bind(this),name:"Channel X",selectedUsers:[],foundUsers:[]});this.dmCreationView=new a({type:"dm",search:this.ctrl.search,startChat:this.startChat.bind(this),getRoom:this.ctrl.getRoom.bind(this.ctrl),doSearch:this.ctrl.doSearch.bind(this),name:"Direct Message X",selectedUsers:[],foundUsers:[]});this.InvitationView=new a({type:"invitation",search:this.ctrl.search,doSearch:this.ctrl.doSearch.bind(this),inviteUser:this.ctrl.inviteUser,selectedUsers:[],foundUsers:[]});this._createContent();this.initDiscover()},setupSmileys:function(){this.chatPanelView.setupSmileys()},onCoreview:function(p){var o=this;if(!p.actions){var n=new i({closable:true,header:"<h4>"+p.username+" want to start a coreview with you</h4>",body:'<div class="thumbFile"><img src="https://euw1-20psp21115-ifwe.3dx-staging.3ds.com/api/widget/proxy/external/X3DDRIV_AP/aHR0cHM6Ly9ldXcxLTIwcHNwMjExMTUtaWZ3ZS4zZHgtc3RhZ2luZy4zZHMuY29tL3Jlc291cmNlcy9lbi8xL3dlYmFwcHMvVzNERHJpdmUvVzNERHJpdmUuaHRtbA/1948f8f9801940cc22134b1bd3570af17a09b243/20171115T194511Z/resources/en/1/webapps/W3DDrive/assets/thumbnails/I_3DXML200x150.png" style="height: 64px;"><div><b>'+p.fileName+"</b></div></div>",footer:"<button type='button' id='coreviewRefuse' class='btn btn-default'>Refuse</button> <button type='button' id='coreviewAccept' class='btn btn-primary'>Accept</button>"}).inject(document.body);n.getContent().getElements("#coreviewRefuse")[0].addEvent("click",function(){n.hide()});n.getContent().getElements("#coreviewAccept")[0].addEvent("click",function(){n.hide();o.chatPanelView.maximizeChat();o.playerView.display3dplayer({mime:p.mime,path:p.path,room_id:p.room_id,fileName:p.fileName,coreview:true})});n.show()}else{this.playerView.onCoreviewAction(p.actions)}},showChannelCreationView:function(){if(!this.channelsView.container.isInjected()){this.chatPanelView.inject(this.container)}this.hideInvitationView();this.hideDMCreationView();this.channelCreationView.show()},showDMCreationView:function(){if(!this.channelsView.container.isInjected()){this.chatPanelView.inject(this.container)}this.hideInvitationView();this.hideChannelCreationView();this.dmCreationView.show()},showInvitationForRoom:function(n){this.hideCreationViews();this.InvitationView.showForRoom(n)},hideDMCreationView:function(){this.dmCreationView.hide()},hideChannelCreationView:function(){this.channelCreationView.hide()},hideCreationViews:function(){this.hideDMCreationView();this.hideChannelCreationView();this.hideInvitationView()},hideInvitationView:function(){this.InvitationView.hide()},hideDiscover:function(){this.smallDisco.hide()},showDiscover:function(){this.chatPanelView.inject(this.container);this.smallDisco.show();this.conversationsView.unactiveConversations(null,true)},initDiscover:function(){this.smallDisco=new l({ctrl:this.ctrl,id:"smallDisco"});this.smallDisco.inject(this.chatPanelView.container);this.smallDisco.hide()},addMe:function(o){o.setStatus=this.ctrl.setStatus.bind(this.ctrl);var n=new h(o);n.inject(this.container.getElement(".IM-topbar"))},_createContent:function(){var n=this;this.setContainer({tag:"div","class":"IM-global-view",html:[this.playerView,{tag:"div","class":"IM-main-view",html:[this.notification=new m({notifications:this.ctrl.notifications}),{tag:"div","class":"IM-topbar"},{tag:"div","class":"IM-scroll-view",html:this.conversationsView}]}]})},startChat:function(o){if(o){this.hideDiscover();this.hideCreationViews();this.chatPanelView.inject(this.container);this.chatPanelView.startChat({room:o});this.ctrl.rooms.forEach(function(q,p){q.set("active",false)});o.set("active",true);this.conversationsView.unactiveConversations(o);var n=this.ctrl.notifications.where({room_id:o.get("room_id")});if(n.length===1){this.ctrl.notifications.remove(n[0])}}},maximizeChat:function(o){var p=this.container.getElement(".IM-main-view");var n=-(p.offsetWidth+1);this.container.style.paddingTop="0px";p.style.marginLeft=n+"px"},minimizeChat:function(o){var p=this.container.getElement(".IM-main-view");var n=-(p.offsetWidth+1);p.style.marginLeft="0px"},inject:function(n){this.container.inject(n)}})});define("DS/InstantMessagingW/js/controller/IMWController",["UWA/Class","UWA/Class/Events","UWA/Class/Collection","DS/InstantMessagingW/js/model/IMWContactModel","DS/InstantMessagingW/js/model/IMWGroupModel","DS/InstantMessagingW/js/model/IMWRoomModel","DS/InstantMessagingW/js/model/IMWMessageModel","DS/InstantMessagingW/js/view/IMWView","DS/RTProxyDriver/RTLogger","DS/RTProxyDriver/RTProxyDriver","DS/InstantMessagingW/js/view/IMWfmot","DS/PlatformAPI/PlatformAPI","i18n!DS/InstantMessagingW/assets/nls/feed"],function(k,h,p,m,j,l,c,s,o,f,a,b,g){var q={};var n=undefined;var d=false;var i=function(t){if(!d){b.publish("fromwidgetim.ds.com",t)}else{n.dispatchEvent("sendToServer",t)}};o.addLevel("Widget","darkorange");var r=function(t){return o.Widget(t)};r.error=function(t){return o.error(t)};var e=k.extend(h,{init:function(t){this.appId=t.appId;this.container=t.container;this.swymUrl=t.swymUrl;this.rtcUrl=t.rtcUrl;this.spaceUrl=t.spaceUrl;this.passportUrl=t.passportUrl;this.platformId=t.platformId;this.username=t.username;this.login=t.login;this.devEnv=t.devEnv;this.embeddedManager=t.embeddedManager;d=t.embeddedManager;this.initLists()},initView:function(u){u.body.innerHTML="";var t=new s({ctrl:this});t.inject(u.body);this.setIMWView(t);this.view=t;this.initFMOT(t)},initFMOT:function(t){this.fmot=new a();this.fmot.inject(t.container);this.showFMOT();this.fmot.addEvent("startChannelCreation",this.view.showChannelCreationView.bind(this.view));this.fmot.addEvent("startDMCreation",this.view.showDMCreationView.bind(this.view));this.fmot.addEvent("showBigDisco",this.discoClick.bind(this))},showFMOT:function(t){this.fmot.hide();this.IMWView.showDiscover()},hideFMOT:function(t){this.fmot.hide()},setSwymUrl:function(t){document.rtcwidget_Swym_URL=t+"/api/user/getpicture/login/"},setSpaceUrl:function(t){document.rtcwidget_Space_URL=t},setPlatformID:function(t){document.rtcwidget_PlatformID_URL=t},setRtcUrl:function(t){document.rtcwidget_RTC_URL=t||"https://dsdev010-euw1-20dna10118-rtc1.3dx-staging.3ds.com";document.rtcwidget_Assets_URL=document.rtcwidget_RTC_URL+"/resources/InstantMessagingW/assets/";document.rtcwidget_Smileys_URL=document.rtcwidget_Assets_URL+"smileys/"},initLists:function(){this.groups=new p([],{model:j});this.rooms=new p([],{model:l});this.publicRooms=new p([],{model:l});this.search=new p([],{model:m});this.notifications=new p([]);this.users={};this.me=undefined;this.addMe=undefined},setup:function(){this.setSwymUrl(this.swymUrl);this.setRtcUrl(this.rtcUrl);this.setSpaceUrl(this.spaceUrl);this.setPlatformID(this.platformId);this.initView(this.container);this.IMWView.setupSmileys();if(!this.embeddedManager){b.subscribe("towidgetim.ds.com",(function(t){return function(u){t.receiveFromServer(u)}})(this));i({evenement:"GETLOGINOKDATA"})}},addGroup:function(u){var t=this.groups.where({group_id:u.group_id});if(t.length===0){var u=new j({name:u.name,group_id:u.group_id,users:u.users,tenant:u.tenant});this.groups.add(u)}else{return{error:"Group already exist"}}},addContact:function(t){var u=this.groups.where({group_id:t.group_id});if(u.length===1&&t.login!==this.login){var v=new m({status:t.status,login:t.login,username:t.username,tenants:t.tenant});u[0].users.add(v)}else{return{error:"Group doesn't exist"}}},getOrSetUser:function(t,u){if(!this.users){this.users={}}t.login=t.login||t.userId;var v;if(!this.users[t.login]){v=new m({status:t.status,login:t.login,username:t.username||t.userName,tenants:t.tenant});this.users[t.login]=v}else{v=this.users[t.login];if(t.username){v.set("username",t.username)}}if(u&&t.role){this.users[t.login].setRole(u,t.role)}return this.users[t.login]},getRoomInfos:function(t){i({evenement:"getRoomInfos",data:t})},addRoom:function(x){var y=x.room||x;var w=this.rooms.where({room_id:y.room_id});if(w.length===0){if(!x.users||!x.users.length){return this.getRoomInfos(x)}var v=new l({name:y.name,room_id:y.room_id,nway:x.users&&x.users.length>2,directmessage:y.type?(y.type=="dm"):null,description:y.description,security:y.security,type:y.type,pathImage:x.room.imgpath?x.room.imgpath.replace("/opt/data",document.rtcwidget_RTC_URL):null,date_in:y.date_in});var z;for(var u=0;u<x.users.length;u++){if(x.users[u].login==this.login){this.getOrSetUser(x.users[u],y.room_id);continue}z=this.getOrSetUser(x.users[u],y.room_id);v.users.add(z)}if(x.usersLeft){for(var u=0;u<x.usersLeft.length;u++){if(x.usersLeft[u].login==this.login){continue}z=this.getOrSetUser(x.usersLeft[u],y.room_id);v.usersLeft.add(z)}}this.rooms.add(v);return v}else{if(w.length>1){r("Room "+y.room_id+" already exist multiple !!");return{error:"Room already exist multiple"}}else{r("Room "+y.room_id+" already exist, updating it ...");var t=w[0];t.updateInfos({name:y.name,description:y.description,security:y.security,type:y.type,pathImage:x.room.imgpath?x.room.imgpath.replace("/opt/data",document.rtcwidget_RTC_URL):null});return t}}},setIMWView:function(t){r("set IMWView ");this.IMWView=t},openRoomIfExpected:function(t,u){if(!this.expectedRoom){return false}if(this.expectedRoom!="firstOne"){if(!this.expectedRoom.room_id){if(this.expectedRoom.name&&this.expectedRoom.name!=t.get("name")){return false}if(this.expectedRoom.type=="dm"&&t.isChannel()){return false}if(this.expectedRoom.type=="channel"&&t.get("directmessage")){return false}if(this.expectedRoom.length!=u.length){return false}}else{if(this.expectedRoom.room_id!=t.get("room_id")){return false}}}this.IMWView.startChat(t);this.expectedRoom=null},openRoom:function(t){var u=this.getRoomFromCollection(t);if(u){this.IMWView.startChat(u)}else{r.error("openRoom room not found "+t)}},addRooms:function(u){for(var t in u){this.addRoom(u[t])}},addMedia:function(u){var t=this.rooms.where({room_id:u.room_id});if(t.length===1){t[0].addMedia(u)}},addMessage:function(w,t){if((window.location.href.indexOf("filtre3DIM")===-1)||(w.data.mime!=="3dxml"&&w.data.mime!=="3dxm")){if(w.type!=="archive_qty"){var u=this.rooms.where({room_id:w.room_id});if(u.length===1){w.message=w.message;var v;if(w.origin=="webservice"){w.message={bot:w.username,title:"3DMessaging",txt:w.message,icon:document.rtcwidget_Space_URL+"/widget/images/MyApps/NETDOFT_AP_AppIcon.png"};w.bot=true;v=u[0].addMessage(w)}else{v=u[0].addMessage(w)}if(!t&&!u[0].get("active")&&v&&v.get("origin")=="chat"){this.notifications.add({message:v,room_id:w.room_id,room:u[0]})}}else{return{error:"Room doesn't exist"}}}}},addMessages:function(t){for(var u in t){this.addMessage(t[u])}},addSearchResult:function(u){var v;for(var t=0;t<u.users.length;t++){v=this.getOrSetUser(u.users[t]);this.search.remove(v);this.search.add(v)}},sendMessage:function(u){var t={msg:u.message,uuid:u.room_id};r("sendMessage "+JSON.stringify(t));i({evenement:"SENDMSG",data:t})},sendData:function(u){var t={data:u.html||u.data,roomId:u.room_id,persisted:u.persisted,robotName:u.robotName};if(u.options){t.fileId=u.options.fileId;t.fileName=u.options.fileName}r("sendData "+JSON.stringify(t));i({evenement:"SENDDATA",data:t})},uploadFile:function(t){i({evenement:"uploadMedia",data:t})},setStatus:function(t){i({evenement:"SETSTATUS",data:t})},startX3DPhoto:function(t){if(t.url){t.url=t.url.replace("/opt/data",document.rtcwidget_RTC_URL)}b.publish("fromwidgetim.ds.com",{evenement:"startX3DPhoto",data:t});r("startX3DPhoto");r(t)},sharex3dphoto:function(t){var t={rtcUrl:document.rtcwidget_RTC_URL,data:t};b.publish("tox3dphoto.ds.com",{evenement:"sharex3dphoto",data:t});r("sharex3dphoto");r(t)},launchCoreview:function(t){t.username=this.username;i({evenement:"coreview",data:t})},startCall:function(t){i({evenement:"startCall",data:t,action:"publish"})},getArchives:function(t){r("getArchives "+JSON.stringify(t));i({evenement:"GETARCHIVES",data:{uuid:t.room_id,archive_qty:t.archive_qty||20,lastMessageID:t.lastMessageID}})},getMedias:function(t){r("getMedias "+JSON.stringify(t));i({evenement:"getMedias",data:{room_id:t.room_id}})},editRoom:function(x,t,v,w,u){i({evenement:"UPDATEROOM",action:"publish",data:{room_id:x.get("room_id"),name:t,description:v,security:w,imageBin:u}})},getRoom:function(t,u,z,y,C,B,A){if(y){if(!this.IMWView.chatPanelView.room){this.IMWView.chatPanelView.hide()}return this.IMWView.hideCreationViews()}if(!u||!u.length){return false}var w,v=[];for(var x in u){w=u[x];v.push(w.get("login"))}if(u.error){r.error(u.error)}r("get room with "+v);i({evenement:"GETROOM",action:"publish",data:{logins:v,name:t,type:z,description:C,security:B,imageBin:A}});this.expectedRoom={name:t=="#"?null:t,length:u.length+1,type:z}},inviteUser:function(x,y){if(!y||!y.length){return false}var u,t=[];if(y.error){r.error(y.error)}var w=x.get("room_id");if(!w){return r.error("inviteUser unable to get room_id")}for(var v in y){u=y[v];t.push(u.get("login"));r("invite user "+u.get("login")+" in room "+x.get("name")+x.get("room_id"));i({evenement:"JOINROOM",action:"publish",data:{login:u.get("login"),room_id:w}})}},doSearch:function(t){r("search "+JSON.stringify(t));i({evenement:"SEARCHCONTACT",data:t})},removeRoom:function(x,t){this.rooms.remove(x);if(t){var v=this.rooms.sortBy("date_in").reverse();var w,u=v.indexOf(x);if(u==0){w=v[1]}else{w=v[v.indexOf(x)-1]}if(!w){w=v[v.indexOf(x)+1]}if(!w){w=v[0]}if(!w){if(this.rooms.length==0){if(!this.IMWView.smallDisco.container.isHidden()){this.showFMOT();this.IMWView.showDiscover()}else{this.showFMOT()}}else{return r.error("unable to find a roomToDisplay")}}else{if(this.IMWView.smallDisco.container.isHidden()){this.IMWView.startChat(w)}}}},joinPublicRoom:function(t){r("joinPublicRoom "+t.get("room_id"));this.expectedRoom={room_id:t.get("room_id")};i({evenement:"JOINPUBLICROOM",data:{room_id:t.get("room_id")}})},leaveRoom:function(t){r("leaveRoom "+t.get("room_id"));i({evenement:"LEAVEROOM",data:{room_id:t.get("room_id")}})},onLeaveRoom:function(w){var v=w.room_id;var t=w.user;if(!v||!t||!t.login){return r("onLeaveRoom bad args")}var x=this.getRoomFromCollection(v);if(t.login==this.me.get("login")){this.removeRoom(x,true)}else{var u=x&&x.users?x.users.where({login:t.login}):null;if(!u){return r("user "+t.login+" not found in room "+v)}x.users.remove(u);x.usersLeft.add(u)}},onJoinRoom:function(w){var v=w.room_id;var t=w.user;if(!v||!t||!t.login){return r("onJoinRoom bad args")}var x=this.getRoomFromCollection(v);var u=this.getOrSetUser(t);if(u.get("login")==this.login){return true}x.users.add(u)},getRoomFromCollection:function(u){var t=this.rooms.where({room_id:u});if(t.length===0){return r("room_id "+u+" not found")}if(t.length>1){return r("wtf many room_id "+u+" !! ")}var v=t[0];return v},sendDiscover:function(){i({evenement:"discover",data:{disco:"ver"}})},onDiscover:function(v){var t=v.publicRooms||v.publicRoom;r("discovered "+t.length+" public rooms");for(var u in t){this.updatePublicRoom(new l(t[u]))}},updatePublicRoom:function(u){var t=this.publicRooms.findWhere({room_id:u.get("room_id")});if(!t){this.publicRooms.add(u)}else{if(u.get("security")!="public"){this.publicRooms.remove(t)}else{if(u.get("userqty")||u.get("userqty")===0){t.set({userqty:u.get("userqty")})}if(u.get("mediaqty")||u.get("mediaqty")===0){t.set({mediaqty:u.get("mediaqty")})}if(u.get("name")){t.set({name:u.get("name")})}if(u.get("description")){t.set({description:u.get("description")})}if(u.get("pathImage")){t.set({pathImage:u.get("pathImage").replace("/opt/data",document.rtcwidget_RTC_URL)})}if(u.get("lastmsgDate")){t.set({lastmsgDate:u.get("lastmsgDate")})}if(typeof u.get("alreadyIn")=="boolean"){t.set({alreadyIn:u.get("alreadyIn")})}}}},discoClick:function(){this.IMWView.showDiscover()},receiveData:function(w,v){if(v){var u;try{u=JSON.parse(w.data)}catch(x){u=w.data}var t=this.getOrSetUser({login:u.login});var y=this.getOrSetUser({login:u.inviter});if(u.NLSkey=="hasBeenAdded"){w.message=t.get("username")+" "+g[""+u.NLSkey]+" "+y.get("username")}else{w.message=t.get("username")+" "+g[""+u.NLSkey]}}else{if(w.nbpart&&w.data.indexOf("data")==0){document[w.fileId]=w.data}else{var u=JSON.parse(atob(w.data));if(u.bot){w.message=u;w.bot=true}else{if(u.datahtml){w.message=atob(u.datahtml)}try{w.action=JSON.parse(decodeURIComponent(u.data))}catch(x){r.error("unable to parse received data");r.error(u.data)}}}}this.addMessage(w)},receiveSystemMsg:function(t){t.data=t.message;this.receiveData(t,true)},receiveFromServer:function(t){var y=t.evenement;var u=t.data;switch(y){case"CONNECTED":this.user_id=u.user_id;this.login=u.userId;this.username=u.username;r("login success");if(u.options){if(u.options.url){this.setRtcUrl(u.options.url)}if(u.options.swymUrl){this.setSwymUrl(u.options.swymUrl)}if(u.options["3dspace"]){this.setSpaceUrl(u.options["3dspace"])}if(u.options.platformId){this.setPlatformID(u.options.platformId)}}if(localStorage.getItem("3DIM_ROOM")){this.expectedRoom={room_id:localStorage.getItem("3DIM_ROOM")}}else{if(u.data&&u.data.rooms&&u.data.rooms.length){this.hideFMOT();this.expectedRoom=u.data.rooms[0]}else{this.expectedRoom="firstOne"}}if(!this.me){this.me=new m({status:u.status,login:u.data.user.login,username:u.data.user.username,tenants:undefined});document.rtcwidget_Me=this.me;this.users[u.data.user.login]=this.me;this.fmot.setForUser(this.me)}if(this.addMe){this.addMe({user:this.me})}if(u.expectedRoom){this.expectedRoom={room_id:u.expectedRoom}}this.sendDiscover();break;case"GROUP":r(u);this.addGroup(u);break;case"ROOM":r(u);var w=this.addRoom(u);this.getArchives({room_id:u.room.room_id,archive_qty:1});if(w){this.openRoomIfExpected(w,u.users)}break;case"DISPLAY_ROOM":r("DISPLAY_ROOM "+JSON.stringify(u));this.openRoom(u.roomId||u.room_id);break;case"ONMESSAGERECEIVED":u.room_id=u.roomId;u.message=u.msg||u.html||u.data;if(u.origin=="data"){try{u.data=JSON.parse(u.message).data;this.receiveData(u)}catch(v){r.error(v)}}else{if(u.origin=="system"){this.receiveSystemMsg(u)}else{if(u.data&&(typeof u.data==="string")&&u.origin!=="media"){this.receiveData(u)}else{this.addMessage(u)}}}break;case"ONARCHIVERECEIVED":u.room_id=u.uuid;u.message=u.msg;if(u.origin=="data"){try{u.data=JSON.parse(u.message).data;this.receiveData(u)}catch(v){r.error(v)}}else{if(u.origin=="system"){this.receiveSystemMsg(u)}else{this.addMessage(u,true)}}break;case"ONPRESENCERECEIVED":r("presence received"+JSON.stringify(u));var x=this.getOrSetUser({login:u.userId,username:u.username,status:u.status});x.set("status",u.status);break;case"RESULTOFSEARCH":r("RESULTOFSEARCH");r(u);this.addSearchResult({users:u});break;case"COREVIEW":r("COREVIEW");r(u);this.onCoreview(u);break;case"onLeaveRoom":r("onLeaveRoom");r(u);this.onLeaveRoom(u);break;case"onJoinRoom":r("onJoinRoom");r(u);this.onJoinRoom(u);break;case"mediaReceived":this.addMedia(u);break;case"discovered":this.onDiscover(u);break;default:r.error("unregistered event : "+y)}}});q.getInstance=function(t){if(!n){n=new e(t);n.setup()}return n};return q});define("DS/InstantMessagingW/InstantMessagingW",["UWA/Class","UWA/Class/Events","DS/RTProxyDriver/RTProxyDriver","DS/WAFData/WAFData","DS/InstantMessagingW/js/controller/IMWController","DS/MessageBus/MessageBus","DS/PlatformAPI/PlatformAPI","DS/InstantMessagingWebRTC/InstantMessagingWebRTC","DS/RTProxyDriver/RTLogger"],function(b,j,g,e,a,c,h,d,i){var f=b.extend(j,{init:function(k){i.addLevel("WManager","maroon");i.WManager("InstantMessaging Embedded Manager init");this.channelToServer="fromwidgetim.ds.com";this.channelToWidget="towidgetim.ds.com";this.params=k;this.params.embeddedManager=true;this.appName="widget";this.devEnv=location.origin=="http://127.0.0.1:8176"},setup:function(){this.getServicesInfos((function(l){return function(m){l.params.swymUrl=m["3dswym"];if(!l.params.rtcUrl){l.params.rtcUrl=m["3dmessaging"].replace("/rest","/")}if(!l.params.passportUrl){l.params.passportUrl=m["3dpassport"]}if(!l.params.spaceUrl){l.params.spaceUrl=m["3dspace"]}l.params.platformId=window.sessionStorage.getItem("3DIMfavoriteTenant")||m.platformid;l.webrtcCtrl=new d({nwayActivated:true,appName:l.appName,login:l.login,userName:l.user.userName,swymUrl:l.params.swymUrl,doLogRTC:false,url:"toremove",platformId:"toremove"});l.loadWidget();l.connectToServer()}})(this));this.eventsFromDriver=["CONNECTED","GROUP","ROOM","ONMESSAGERECEIVED","ONDATARECEIVED","ONARCHIVERECEIVED","ONPRESENCERECEIVED","RESULTOFSEARCH","onJoinRoom","COREVIEW","miscellaneous","onLeaveRoom","mediaReceived","discovered"];for(var k in this.eventsFromDriver){(function(l,m){g.addEvent(l,function(n){m.publishToWidget(l,n)})})(this.eventsFromDriver[k],this)}},getServicesInfos:function(l){if(this.devEnv){this.params.passportUrl="none";this.params.rtcUrl="http://localhost:443";this.params.login=UWA.Utils.getQueryString(window.top.document.URL,"login3DIM");this.user={userName:this.params.login+"name",login:this.params.login};l({platformid:UWA.Utils.getQueryString(window.top.document.URL,"tenant3DIM")||"hyper3dsy"});return true}this.params.passportUrl=h.getApplicationConfiguration("app.urls.passport");this.user=h.getUser();this.login=this.user.login;var k=this.chooseTenant();require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(m){m.getPlatformServices({onComplete:function(p){for(var o=0;o<p.length;o++){for(var n in p[o]){if(p[o].hasOwnProperty(n)){p[o][n.toLowerCase()]=p[o][n];delete p[o][n]}}}if(k){for(var o in p){if(p[o].platformid===k){l(p[o]);break}}}else{if(l){l(p[0])}else{i.error("InstantMessagingW unable to selecte resources to connect to")}}}})})},chooseTenant:function(){var n=widget.getValue("x3dPlatformId");if(n){return n}if(this.user){try{var k=JSON.parse(this.user.properties.dashboards);for(var l in k){if(k[l].platformId){return k[l].platformId}}}catch(m){return null}}return null},connectToServer:function(){var k=this.params.passportUrl;var l=k+"/login?service=3DSIM";var m={nameApp:"3DIM",driverName:"NODE",url:this.params.rtcUrl,domaineName:this.params.platformId,username:this.params.username,passportUrl:k,credentials:{jid:this.params.login||"noLogin",user:this.params.login,password:null}};g.dispatch(g.eventName.SETDRIVER,[m])},loadWidget:function(){var k=a.getInstance(this.params);this.IMWCtrl=k;document.IMWCtrl=k;this.IMWCtrl.addEvent("sendToServer",this.fromWidgetListener)},publishToWidget:function(k,l){if(!this.IMWCtrl){return i.error("no IMWCtrl")}this.IMWCtrl.receiveFromServer({evenement:k,data:l})},fromWidgetListener:function(m){var n=m.evenement;var l=m.data;var k=m.action;if(n!="CONNECTED"&&(k==="publish"||l)){g.dispatch(n,[l])}}});return f});