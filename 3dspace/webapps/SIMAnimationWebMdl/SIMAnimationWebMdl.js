define("DS/SIMAnimationWebMdl/SIMAnimationRepRefUnstreamer",["UWA/Class","DS/Visualization/Node3D"],function(a,b){return a.extend({init:function(){},unstream:function(h,c,j){var k=this;var f=h.firstChild;if(f&&f.nodeName==="Osm"){k.animations=[];k.variantToAnimation=[];k.animChannelToAnimation=[];k.propertyToAnimation=[];k.propertyToChannel=[];var d=f.getElementsByTagName("Feature");for(var i=0;i<d.length;++i){var l=d[i];var g=l.getAttribute("StartUp");switch(g){case ("CATAnimation"):k.unstreamAnimation(l);break;case ("CATAnimVariantLine"):k.unstreamVariantLine(l);break;case ("CATAnimChannel"):k.unstreamAnimChannel(l);break;case ("CATAnimPropertyDouble"):k.unstreamPropertyCommon(l);k.unstreamPropertyDouble(l);break;case ("CATAnimPropertyOctet"):k.unstreamPropertyCommon(l);k.unstreamPropertyOctet(l);break;case ("CATAnimPropertyMessage"):k.unstreamPropertyCommon(l);k.unstreamPropertyMessage(l);break;default:console.error("Startup type "+g+" not handled yet.");break}}if(k.animations.length>=1){var e=new b("AnimationsList");e.AnimFeaturesList=k.animations;j.add(e)}}},unstreamAnimation:function(o){var n=this;var m=n.animations.length;var e={attributes:{}};var c=o.getElementsByTagName("Attr");for(var f=0;f<c.length;++f){var l=c[f];var g=l.getAttribute("Name");switch(g){case ("_Name"):e.attributes._Name=l.getAttribute("Value");break;case ("_Description"):e.attributes._Description=l.getAttribute("Value");break;case ("_Version"):e.attributes._Version=parseInt(l.getAttribute("Value"));break;case ("_VariantLine"):var i=parseInt(l.getAttribute("Value").replace(/#/g,""));n.variantToAnimation[i]=m;e.attributes._VariantLine={};break;case ("_AnimChannels"):var h=JSON.parse(l.getAttribute("Value").replace(/#/g,""));for(var d=0;d<h.length;++d){n.animChannelToAnimation[h[d]]=m}e.attributes._AnimChannels=[];break;default:break}}n.animations.push(e)},unstreamVariantLine:function(m){var l=this;var h=m.getAttribute("Id");var k=l.variantToAnimation[h];var c=l.animations[k].attributes._VariantLine;c.attributes={};var f=m.getElementsByTagName("Attr");for(var e=0;e<f.length;++e){var g=f[e];var i=g.getAttribute("Name");switch(i){case ("_CkeType"):c.attributes._CkeType=g.getAttribute("Value");break;case ("_Indexes"):c.attributes._Indexes=JSON.parse(g.getAttribute("Value"));break;case ("_IndexedValues"):var d=g.getAttribute("Value").replace(/\.,/g,",").replace(/\.e/g,"e").replace(/\.\]/g,"]");c.attributes._IndexedValues=JSON.parse(d);break;default:break}}},unstreamAnimChannel:function(o){var n=this;var c=o.getAttribute("Id");var m=n.animChannelToAnimation[c];var p=n.animations[m].attributes._AnimChannels.length;var i={attributes:{}};var h=o.getElementsByTagName("Attr");for(var f=0;f<h.length;++f){var e=h[f];var g=e.getAttribute("Name");switch(g){case ("_ExternalObject"):i.attributes._ExternalObject=e.getAttribute("Value");break;case ("_AnimProperties"):var l=JSON.parse(e.getAttribute("Value").replace(/#/g,""));for(var d=0;d<l.length;++d){n.propertyToAnimation[l[d]]=m;n.propertyToChannel[l[d]]=p}i.attributes._AnimProperties=[];break;default:break}}n.animations[m].attributes._AnimChannels.push(i)},unstreamPropertyCommon:function(m){var k=this;var c=m.getAttribute("Id");var n=k.propertyToChannel[c];var i=k.propertyToAnimation[c];var d={attributes:{}};var e=m.getElementsByTagName("Attr");for(var g=0;g<e.length;++g){var l=e[g];var h=l.getAttribute("Name");switch(h){case ("_Type"):var f=l.getAttribute("Value").replace(/\'/g,"");d.attributes._Type=f;break;case ("_TypeSize"):d.attributes._TypeSize=l.getAttribute("Value");break;case ("_DefaultInterpolation"):d.attributes._DefaultInterpolation=l.getAttribute("Value");break;case ("_InterpretType"):d.attributes._InterpretType=l.getAttribute("Value");break;case ("_RepeatCount"):d.attributes._RepeatCount=l.getAttribute("Value");break;case ("_ValuesTimeIndex"):d.attributes._ValuesTimeIndex=JSON.parse(l.getAttribute("Value"));break;default:break}}k.animations[i].attributes._AnimChannels[n].attributes._AnimProperties.push(d)},unstreamPropertyDouble:function(o){var m=this;var c=o.getAttribute("Id");var p=m.propertyToChannel[c];var l=m.propertyToAnimation[c];var h=m.animations[l].attributes._AnimChannels[p].attributes._AnimProperties;var d=h[h.length-1];var e=o.getElementsByTagName("Attr");for(var g=0;g<e.length;++g){var n=e[g];var k=n.getAttribute("Name");switch(k){case ("_ValuesDouble"):var f=n.getAttribute("Value").replace(/\.,/g,",").replace(/\.e/g,"e").replace(/\.\]/g,"]");var i=JSON.parse(f);d.attributes._ValuesDouble=i;break;default:break}}},unstreamPropertyOctet:function(n){var l=this;var c=n.getAttribute("Id");var o=l.propertyToChannel[c];var k=l.propertyToAnimation[c];var g=l.animations[k].attributes._AnimChannels[o].attributes._AnimProperties;var d=g[g.length-1];var e=n.getElementsByTagName("Attr");for(var f=0;f<e.length;++f){var m=e[f];var i=m.getAttribute("Name");switch(i){case ("_ValuesOctet"):var h=JSON.parse(m.getAttribute("Value"));d.attributes._ValuesOctet=h;break;default:break}}},unstreamPropertyMessage:function(n){var l=this;var c=n.getAttribute("Id");var o=l.propertyToChannel[c];var k=l.propertyToAnimation[c];var h=l.animations[k].attributes._AnimChannels[o].attributes._AnimProperties;var d=h[h.length-1];d.values={type:"message"};var e=n.getElementsByTagName("Attr");for(var g=0;g<e.length;++g){var m=e[g];var i=m.getAttribute("Name");switch(i){case ("_V6Text"):d.attributes._V6Text=(m.getAttribute("Value")==="true")?true:false;break;case ("_ValuesOpCode"):d.attributes._ValuesOpCode=JSON.parse(m.getAttribute("Value"));break;case ("_ValuesDialogId"):d.attributes._ValuesDialogId=m.getAttribute("Value");break;case ("_ValuesString"):var f=m.getAttribute("Value").replace(/\"/g,'\\"').replace(/\'/g,'"');d.attributes._ValueString=JSON.parse(f);break;case ("_WindowSize"):d.attributes._WindowSize=JSON.parse(m.getAttribute("Value"));break;default:break}}}})});define("DS/SIMAnimationWebMdl/SIMAnimationServices",["UWA/Class"],function(a){var b=UWA.Class.extend({refreshSceneGraphState:function(c,d,e){if(c!==undefined&&d!==undefined&&e!==undefined){d.SetCurrentFrame(e);d.UpdateProperties()}},getKeyFramer:function(c){var d=this;var f;if(c.KeyFramer!==undefined){f=c.KeyFramer}else{for(var e=0;e<c.children.length;++e){f=d.getKeyFramer(c.children[e]);if(f!==undefined){break}}}return f},getAnimationNodes:function(c){var e=this;var d=[];if(c.AnimFeaturesList!==undefined){d.push(c)}else{for(var f=0;f<c.children.length;++f){var g=e.getAnimationNodes(c.children[f]);d=d.concat(g)}}return d},getAnimations:function(c){var d=this;var g=[];if(c.AnimFeaturesList!==undefined){if(c.AnimFeaturesList.length>0){g=g.concat(c.AnimFeaturesList)}else{g.push(c.AnimFeaturesList)}}else{for(var e=0;e<c.children.length;++e){var f=d.getAnimations(c.children[e]);g=g.concat(f)}}g.forEach(function(i){var h=i.attributes._VariantLine;h.attributes._OrderedIndexedValues=h.attributes._IndexedValues.slice(0);h.attributes._OrderedIndexedValues.sort(function(k,j){return k-j});h.attributes._OrderedIndexes=h.attributes._Indexes.slice(0);h.attributes._OrderedIndexes.sort(function(k,j){return h.attributes._IndexedValues[h.attributes._Indexes.indexOf(k)]-h.attributes._IndexedValues[h.attributes._Indexes.indexOf(j)]})});return g}});return b});