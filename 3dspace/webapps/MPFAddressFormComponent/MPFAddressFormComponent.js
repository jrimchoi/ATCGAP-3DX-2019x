define("DS/MPFAddressFormComponent/AddressCard",["UWA/Core","UWA/Class/View","DS/MPFAddressModel/AddressModel","DS/MPFPersonModel/PersonModel","DS/MPFCompanyModel/CompanyModel","DS/MPFError/BadArgumentError","css!DS/MPFUI/MPFUI"],function(c,g,e,b,f,a){var d=g.extend({className:"mpf-address-card",domEvents:{click:"cardClicked"},setup:function(h){h||(h={});if(!(c.is(h.legalEntity))){throw new Error("options.legalEntity is required")}if(!(e.prototype.isPrototypeOf(this.model))){throw new a("AddressCard this.model must be an AddressModel")}if(!(f.prototype.isPrototypeOf(h.legalEntity)||b.prototype.isPrototypeOf(h.legalEntity))){throw new a("AddressCard options.legalEntity must be a CompanyModel or a PersonModel")}this._parent(h);this.legalEntity=h.legalEntity;this.country=h.country;if(!(this.model.get("addressLine0"))){this.model.set("addressLine0",this._getAddressTitle())}},render:function(){var j=this;var i;var h=this.model;i=["addressLine1","addressLine2","addressLine3","addressLine4","city","county","state","postalCode","country"].map(function(k){if(k==="country"&&c.is(j.country)){return j.country}else{return h.get(k)}}).filter(function(k){return k&&k.length>0}).map(function(k){return c.createElement("p",{"class":"mpf-address-card-line",text:k})});i.unshift(c.createElement("p",{"class":"mpf-address-card-line title",text:this.model.get("addressLine0")}));this.container.setContent(i);return this},destroy:function(){this.model=null;this._parent();this.container=null},cardClicked:function(){this.dispatchEvent("onSelected",this.model)},_getAddressTitle:function(){var h;if(this.legalEntity._type==="CompanyModel"){h=this.legalEntity.getName()}else{h=this.legalEntity.getFirstName()+" "+this.legalEntity.getLastName()}return h}});return d});define("DS/MPFAddressFormComponent/AddressFormComponent",["UWA/Core","UWA/Promise","UWA/Element","UWA/Class/View","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/MPFAddressModel/AddressModel","DS/MPFModelFactory/CountryFactory","DS/MPFCountrySelectComponent/CountrySelectComponent","DS/MPFError/BadArgumentError","i18n!DS/MPFAddressFormComponent/assets/nls/AddressFormComponent","css!DS/MPFUI/MPFUI"],function(i,g,j,a,e,h,f,d,l,k,c){var b=a.extend({tagName:"form",className:"mpf-form mpf-address-form",setup:function(m){var n=this;if(!(i.is(m))){throw new Error("Parameter options is required")}if(!(i.is(m.constraints))){throw new Error("Parameter options.constraints is required")}this._parent(m);this.constraints=m.constraints;this.possibleAddresses=[];this.countryMode=m.countryMode||"seller";this.countryReadOnly=m.countryReadOnly===true;this.hideCountry=m.hideCountry===true;if(i.is(this.collection)){if(this.collection.isEmpty()){if(!(i.is(this.model))){this.model=new this.collection.model({},{dataProxy:this.collection.modelDataProxy,constraints:this.collection.constraints})}}else{this.model=this.collection.first()}}this.countryFactory=new d(this.model.dataProxy.connector);this.countries=this.countryFactory.createCollection(this.countryMode);this.waitForCountries=new g(function(q,p){n.countries.fetch({onComplete:q,onFailure:function(r,s){p()}})});var o;if(!this.hideCountry){this.countrySelectComponent=new l({countries:this.countries,model:this.model,preSetCountry:m.preSetCountry,readOnly:this.countryReadOnly})}this.readOnly=m.readOnly===true;this.listenTo(this.model,"onChange:country",function(p){if(this.countrySelectComponent&&this.countrySelectComponent.select){o=this.countrySelectComponent.select.elements.input}this._onChangeCountry(o)})},destroy:function(){this.countrySelectComponent.destroy();this.countrySelectComponent=null;this.stopListening(this.model);this.model=null;this._parent();this.container=null},domEvents:{change:"onChange"},onChange:function(n){var o;var r;var v;var w;v=n?n.target:undefined;w=v&&v.name==="country";r=this._getAttributes();if(!(w)){this.model.set(r)}else{this.model.set({country:r.country})}n&&this._validateField(v);var q=this.model.get("country");if(!this.possibleAddresses.hasOwnProperty(q)||!(w)){if(this.constraints.get(q)){o=Object.keys(this.constraints.get(q).pick(["addressLine1","addressLine2","addressLine3","addressLine4"]))}else{o=Object.keys(this.constraints.get("DEFAULT").pick(["addressLine1","addressLine2","addressLine3","addressLine4"]))}var s=[];if(r.hasOwnProperty("addressLine1")){s.push(r.addressLine1);delete r.addressLine1}if(r.hasOwnProperty("addressLine2")){s.push(r.addressLine2);delete r.addressLine2}if(r.hasOwnProperty("addressLine3")){s.push(r.addressLine3);delete r.addressLine3}if(r.hasOwnProperty("addressLine4")){s.push(r.addressLine4);delete r.addressLine4}if(!this.possibleAddresses.hasOwnProperty(q)){this.possibleAddresses[q]={}}for(var u=0;u<o.length;u++){if(s.length>0){this.possibleAddresses[q][o[u]]=s.shift()}}var t=Object.keys(r);for(var m=0;m<t.length;m++){var p=t[m];this.possibleAddresses[q][p]=r[p]}}},render:function(n){var o=this;var p=[];var m;this.waitForCountries.then(function(){if(o.countrySelectComponent){p.push(o.countrySelectComponent.render())}m=o._createEntries();Array.prototype.push.apply(p,m);o.form=i.createElement("fieldset",{html:p});if(o.readOnly){o.form.setAttributes({disabled:true})}o.container.setContent(o.form);var q=o._getAttributes();o.model.set(q);if(o.countrySelectComponent&&n!==undefined&&n.changedInput!==undefined){o._validateField(o.countrySelectComponent.select.elements.input)}o.dispatchEvent("onRender",this)},function(){o.dispatchEvent("onError","Cannot fetch country list")});return this},save:function(m){var n;if(this.validate(m)){if(i.is(this.collection)&&this.model.isNew()){this.collection.create(this.model,m)}else{this.model.save(null,m)}}else{n=m.onFailure;if(typeof n==="function"){n()}}},savePromise:function(n){var m=g.deferred();var p;var o;n||(n={});p=n.onComplete;n.onComplete=function(s,q,r){if(typeof p==="function"){p(arguments)}m.resolve({model:s,response:q,options:r})};o=n.onFailure;n.onFailure=function(t,q,s){var r;if(typeof o==="function"){o(arguments)}if(q&&q.errorCode&&q.errorCode==="Error.Tax"){r=new k(c.get("invalidTaxArea"))}m.reject(r)};this.save(n);return m.promise},validate:function(m){var o;var n;for(var p=0;p<this.inputs.length;p++){o=this._validateField(this.inputs[p].elements.input)}n=o&&o.length&&o.length>0;return !(n)},clear:function(){var m;if(this.model.isNew()){m=i.clone(f.prototype.defaults);if(this.countryReadOnly){delete m[f.Fields.COUNTRY]}this.model.set(m);this.possibleAddresses=[];this.render()}},_createEntries:function(){this.inputs=[];if(this.countrySelectComponent){this.inputs.push(this.countrySelectComponent.select)}var o=[];var q=this;var m=this.model.get("country");var r=this.constraints.get(m);var p=0;var s={};var u;var t;if(!(i.is(r))){r=this.constraints.get("DEFAULT")}if(i.is(r)){var n=1;r.keys().filter(function(v){return v!=="country"&&q.model.get(v)!==undefined}).forEach(function(w){var z=Array.isArray(r.get(w))?r.get(w)[0]:r.get(w);var v=c.get(w)==="Address Line "?++p:"";var y;t=z.isRequired()?c.get(w)+v+'<em class="mpf-required">*</em>':c.get(w)+v;if(Object.keys(q.possibleAddresses).length===0){u=q.model.get(w);s[w]=u}else{y=q.possibleAddresses[m];if(y){u=y[w]||""}else{u=""}}var x=z.getPattern();if(w==="state"&&x.length>0&&x.split("|").length>1){o.push(q._createStateField(t,w,u,x.replace(/\^|\$/g,"").split("|"),m))}else{o.push(q._createEntry(t,w,u,n++))}});if(Object.keys(s).length>0){this.possibleAddresses[m]=s}}return o},_createEntry:function(o,n,q,p){var m=new e({name:n,value:q});this.inputs.push(m);return i.createElement("div",{"class":"mpf-addressEntry",html:[{"class":"mpf-labels",html:[{"class":"mpf-addressLabelSpan"+p,html:o,tag:"span"},{"class":"mpf-addressInlineInput",html:m,tag:"div"}],tag:"label"}]})},_createStateField:function(o,n,q,r,s){var m=new h({name:"state",placeholder:c.get("statePlaceholder"),disabled:this.readOnly});this.inputs.push(m);for(var p=0;p<r.length;p++){m.add({label:c.get(s+r[p]),selected:(this.possibleAddresses[s]!==undefined)?this.possibleAddresses[s].state===r[p]:this.model.get("state")===r[p],value:r[p]})}return i.createElement("div",{"class":"mpf-addressEntry",html:[{"class":"mpf-addressStateLabel",html:o,tag:"span"},{"class":"mpf-addressStateDiv",html:m,tag:"div"}]})},_onChangeCountry:function(m){var o;var n;var p;o=this.container.getElement('input[name="postalCode"]');if(o){o.value=""}n=this.container.getElement('input[name="city"]');if(n){n.value=""}p=this.container.getElement('select[name="state"]');if(p){p.selectedIndex=0}this.render({changedInput:m})},_validateField:function(n){var s=n.getTagName()==="select"?n.getParent():n;var m=n.getTagName()==="select"?"mpf-addressSelectError":"mpf-addressInputError";if(s){s.setStyle("border","");s.setStyle("border-radius","");var r=s.getParent().getElementsByTagName("p");for(var q=0;q<r.length;q++){s.getParent().removeChild(r[q])}}var o;var p=this.model.validate();if(p!==undefined){o=p.filter(function(t){return t.field===n.name});if(o.length>0){if(s){s.setStyle("border","1px solid red");s.setStyle("border-radius","4px")}i.createElement("p",{"class":m,text:c.get(o[0].field+"Error")}).inject(s.getParent())}}return p},_getAttributes:function(){var m=this.container.getElements("input").concat(this.container.getElements("select")).reduce(function(n,o){n[o.name]=o.name==="country"&&o.value.trim()===""?"DEFAULT":o.value.trim();return n},{});return m}});return b});define("DS/MPFAddressFormComponent/AddressFormComponentV2",["UWA/Core","UWA/Promise","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFAddressModel/AddressModel","DS/MPFAddressConstraintsModel/AddressConstraintsCollection","DS/MPFCountryModel/CountryCollection","DS/MPFView/FieldTextInputV2","DS/MPFView/FieldSelectInputV2","DS/MPFError/ValidationError","DS/MPFError/BadArgumentError","i18n!DS/MPFAddressFormComponent/assets/nls/AddressFormComponent","css!DS/MPFUI/MPFUI","css!DS/MPFAddressFormComponent/MPFAddressFormComponent"],function(h,j,b,k,f,a,e,i,g,l,m,d){var c=b.extend({tagName:"form",className:"mpf-form mpf-address-form-v2",domEvents:{'change select[name="country"]':"_onCountryChange"},setup:function(n){n||(n={});this._checkRequiredParameters(n);this.addressModel=n.addressModel;this.addressConstraints=n.addressConstraints;this.countries=n.countries;this.readOnly=n.readOnly===true;this.countryReadOnly=n.countryReadOnly===true;this.horizontalLayout=n.horizontalLayout===true;this.preSetCountry=n.preSetCountry;this.keepErrorMessages=n.keepErrorMessages===true;this._createInputs()},render:function(){if(this.horizontalLayout){this.container.addClassName("mpf-horizontal")}var n=[];this.inputs.forEach(function(o){n.push(o.render())});this.container.setContent(n);this._applyCountryFormatAddress();return this},validate:function(){var o=this;var n;var p=true;this.inputs.forEach(function(q){if(q.fieldName!==f.Fields.STATE){if(q.container.isHidden()){o.addressModel.set(q.fieldName,"")}else{n=q.validate();p=p&&n.isValid}}});if(this.stateSelectInput.container.isHidden()&&this.stateTextInput.container.isHidden()){o.addressModel.set(f.Fields.STATE,"")}else{if(this.stateSelectInput.container.isHidden()){n=this.stateTextInput.validate();p=p&&n.isValid}else{n=this.stateSelectInput.validate();p=p&&n.isValid}}return p},save:function(n){if(this.validate()){return this.addressModel.save(null,n)}},savePromise:function(n){if(this.validate()){return this.addressModel.savePromise(null,n)["catch"](function(p){var q;var o=p&&p.response;if(o&&o.errorCode&&o.errorCode==="Error.Tax"){q=new m(d.get("invalidTaxArea"))}return j.reject(q)})}else{return j.reject(new l(d.get("invalidAddress")))}},clear:function(){var o;var n;if(this.addressModel.isNew()){o=h.clone(f.prototype.defaults);if(this.countryReadOnly){delete o[f.Fields.COUNTRY]}delete o[f.Fields.IS_BILL_TO];delete o[f.Fields.IS_SHIP_TO];this.addressModel.set(o);n=Object.keys(o);this.inputs.forEach(function(p){if(n.indexOf(p.fieldName)!==-1){p.resetValue()}})}},_onCountryChange:function(){if(this.countrySelectComponent.getValue()===""){this.addressModel.set("country","DEFAULT")}this._applyCountryFormatAddress()},_applyCountryFormatAddress:function(r){var o=this;var q;var p;var n;q=this.addressModel.getCountry()?this.addressModel.getCountry():"DEFAULT";p=this.addressConstraints.get(q)?this.addressConstraints.get(q):this.addressConstraints.get("DEFAULT");this.inputs.forEach(function(s){if(!(s.fieldName===f.Fields.COUNTRY&&s.getValue()==="")&&!o.keepErrorMessages){s._removeErrorMessage()}n=p.get(s.fieldName);if(h.is(n)){o._handleRequiredSymbol(s,n.isRequired());if(s.fieldName===f.Fields.STATE){o._displayTextOrSelectStateInput(q,n)}else{s.show()}}else{s.hide()}});this._adaptLabelInputsToAddressFormat(p)},_adaptLabelInputsToAddressFormat:function(s){var p=this;var o=0;var n;var r;var q=[];this.addressLineInputs.forEach(function(t){if(t.getValue()!==""){q.push(t.getValue())}if(t.container.isHidden()){++o}else{n=parseInt(t.fieldName[t.fieldName.length-1]);r=n-o;t.fieldLabel=d.get("labelAddressLine"+r);t.container.getElement(".mpf-label").setContent(d.get("labelAddressLine"+r));p._handleRequiredSymbol(t,s.get(t.fieldName).isRequired())}});this._adaptValuesToInputsDisplayed(q)},_adaptValuesToInputsDisplayed:function(n){this.addressLineInputs.forEach(function(o){if(o.container.isHidden()){o.resetValue({silent:true})}else{o.setValue(n.length>0?n.shift():"",{silent:true})}})},_displayTextOrSelectStateInput:function(s,p){var q=this;var r=p.getPattern();var n;var o=[];if(r.indexOf("|")!==-1){this.stateSelectInput.remove();n=r.substring(1,r.length-1).split("|");n.forEach(function(t){o.push({value:t,label:d.get(s+t),selected:h.is(q.addressModel.getState())?q.addressModel.getState()===t&&q.addressModel.getCountry()===s:false})});this.stateSelectInput.add(o);this.stateTextInput.hide();this.stateSelectInput.show();this.stateSelectInput._removeErrorMessage()}else{this.stateSelectInput.hide();this.stateTextInput.show()}},_handleRequiredSymbol:function(n,p){var o;var q;o=n.container.getElement("em.mpf-required");q=h.createElement("em",{"class":"mpf-required",text:" *"});if(!h.is(o)&&p){n.required=true;if(n.container.hasClassName("mpf-select-v2")){q.inject(n.container.getElement(".mpf-label label"))}else{q.inject(n.container.getElement("span.mpf-label"))}}if(h.is(o)&&!p){n.required=false;o.remove()}},_createInputs:function(){this.countrySelectComponent=new g({model:this.addressModel,fieldName:f.Fields.COUNTRY,fieldLabel:d.get("country"),readOnly:this.countryReadOnly,placeholder:d.get("selectCountry"),selectableOptions:this._getCountriesOptions(),dynamicValidation:true});this.addressLine1Input=new i({model:this.addressModel,fieldName:f.Fields.LINE1,fieldLabel:d.get("labelAddressLine1"),readOnly:this.readOnly,dynamicValidation:true});this.addressLine2Input=new i({model:this.addressModel,fieldName:f.Fields.LINE2,fieldLabel:d.get("labelAddressLine2"),readOnly:this.readOnly,dynamicValidation:true});this.addressLine3Input=new i({model:this.addressModel,fieldName:f.Fields.LINE3,fieldLabel:d.get("labelAddressLine3"),readOnly:this.readOnly,dynamicValidation:true});this.addressLine4Input=new i({model:this.addressModel,fieldName:f.Fields.LINE4,fieldLabel:d.get("labelAddressLine4"),readOnly:this.readOnly,dynamicValidation:true});this.cityInput=new i({model:this.addressModel,fieldName:f.Fields.CITY,fieldLabel:d.get("city"),readOnly:this.readOnly,dynamicValidation:true});this.countyInput=new i({model:this.addressModel,fieldName:f.Fields.COUNTY,fieldLabel:d.get("county"),readOnly:this.readOnly,dynamicValidation:true});this.stateTextInput=new i({model:this.addressModel,fieldName:f.Fields.STATE,fieldLabel:d.get("state"),readOnly:this.readOnly,dynamicValidation:true});this.stateSelectInput=new g({model:this.addressModel,fieldName:f.Fields.STATE,fieldLabel:d.get("state"),readOnly:this.readOnly,placeholder:d.get("statePlaceholder"),dynamicValidation:true});this.postalCodeInput=new i({model:this.addressModel,fieldName:f.Fields.POSTAL_CODE,fieldLabel:d.get("postalCode"),readOnly:this.readOnly,dynamicValidation:true});this.addressLineInputs=[this.addressLine1Input,this.addressLine2Input,this.addressLine3Input,this.addressLine4Input];this.inputs=[this.countrySelectComponent,this.addressLine1Input,this.addressLine2Input,this.addressLine3Input,this.addressLine4Input,this.cityInput,this.countyInput,this.stateTextInput,this.stateSelectInput,this.postalCodeInput]},_getCountriesOptions:function(){var o=this;var n=[];this.countries.forEach(function(q){var p={value:q.getIso3(),label:q.getName()};p.selected=h.is(o.preSetCountry)?o.preSetCountry:q.getIso3()===o.addressModel.getCountry();n.push(p)});return n},_checkRequiredParameters:function(n){k.requiredOfPrototype(n.addressModel,f,"options.addressModel must be an AddressModel");k.requiredOfPrototype(n.addressConstraints,a,"options.addressConstraints must be an AddressConstraintsCollection");k.requiredOfPrototype(n.countries,e,"options.countries must be a CountryCollection")}});return c});define("DS/MPFAddressFormComponent/AddressList",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/MPFAddressFormComponent/AddressCard"],function(b,e,a,c){var d;d=e.extend({className:"mpf-address-list",setup:function(f){f||(f={});if(!(b.is(f.legalEntity))){throw new Error("options.legalEntity is required")}this._parent(f);this.addressCards=[];this.selectedAddress=null;this.legalEntity=f.legalEntity},render:function(){var h=this;var g;var i;var f;this.addressCards.forEach(function(j){h.stopListening(j,"onSelected")});this.addressCards=this.model.filter(function(j){return !(j.isNew())}).map(function(j){var k;k=new c({model:j,legalEntity:h.legalEntity});return k});this.addressCards.forEach(function(j){h.listenTo(j,"onSelected",h.setSelectedAddress.bind(h))});g=this.addressCards.map(function(j){var k;k=j.render();if(h.selectedAddress&&h.selectedAddress.id===j.model.id){j.container.addClassName("selected")}return k});i=b.createElement("div",{"class":"mpf-address-cards",html:g});f=new a({element:i});this.container.setContent(f);return this},getSelectedAddress:function(){return this.selectedAddress},setSelectedAddress:function(f){if(this.model.contains(f)){this.selectedAddress=f;this.addressCards.forEach(function(g){if(g.model.id===f.id){g.container.addClassName("selected")}else{g.container.removeClassName("selected")}});this.dispatchEvent("AddressSelected",f)}},removeClassName:function(f){this.container.removeClassName(f)},addClassName:function(f){this.container.addClassName(f)}});return d});