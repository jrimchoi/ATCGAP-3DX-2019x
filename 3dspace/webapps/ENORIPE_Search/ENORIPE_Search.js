/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/ENORIPE_Search/WhereUsed",["UWA/Core","UWA/Controls/Abstract","UWA/Utils/InterCom","i18n!DS/ENORIPE_Search/assets/nls/Enoripe_Search.json","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Promise","DS/CefCommunication/CefCommunication","DS/SNNavigationMap/MapSettings"],function(g,d,h,i,a,f,b,e){var c=d.extend({name:"WhereUsedAction",_compass_socket:null,_action_info:null,_role_check_promise:null,init:function(j){this._action_info=[{title:i.get("whereused_title"),icon:"object-related",id:"whereUsed",multisel:false,callback:this.launchCustoAction.bind(this),addinMode:(j&&j.addinmode?j.addinmode:undefined)}]},availableForTypes:function(){var j=[];if(!b.isAvailable()||(this._action_info[0].addinMode==="catiav5"||this._action_info[0].addinMode==="solidworks")){j=["all"]}return j},getActionForObject:function(j,m){var l=this;if(UWA.is(j.sourceid,"string")&&j.sourceid.indexOf("3dspace")===0){if(!g.is(this._role_check_promise)){this._role_check_promise=new f(function(o,n){a.getGrantedRoles(function(r){if(g.is(r,"array")){var p=false;var s={CSV:true,InternalDS:true};for(var q=0;q<r.length;q++){if(s.hasOwnProperty(r[q].id)){p=true;break}}if(p){o()}else{n()}}else{n()}})})}var k=function(){if(g.is(m)){m.call(null,l._action_info)}};this._role_check_promise.then(k,function(){})}},launchCustoAction:function(k){if(!g.is(k,"object")||!g.is(k.object_ids,"array")||k.action_id!=="whereUsed"||!k.actionsHelper){throw new Error("INVALID data inputs while trying to execute the whereUsed action")}var o=k.actionsHelper;var q=k.object_ids[0];var l={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:k.widget_id,data:{items:[{envId:o.getPlatformID({id:q}),serviceId:o.getServiceID({id:q}),contextId:"",objectId:q,objectType:o.getValue({id:q,attribute:"ds6w:type_value"}),displayName:o.getValue({id:q,attribute:"ds6w:label"}),displayType:o.getValue({id:q,attribute:"ds6w:type"})}]}};var n="whereUsedcompassSocket";if(this._compass_socket===null){this._compass_socket=new h.Socket(n);this._compass_socket.subscribeServer("com.ds.compass",window.parent)}this._compass_socket.dispatchEvent("onSetX3DContent",l,n);if(g.is(k.nav_history)&&k.nav_history===true){var j=require,m=j("DS/SNInfraUX/SearchUtils");if(g.is(m)){m.instantiateAppInSearch("Relational","ENORIPE_AP",l,k)}}else{var p={appId:"ENORIPE_AP"};this._compass_socket.dispatchEvent("onLaunchApp",p,n)}}});return c});