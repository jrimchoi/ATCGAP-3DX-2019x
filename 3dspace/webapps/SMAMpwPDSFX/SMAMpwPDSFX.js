/*!  Copyright 2019 Dassault Systemes. All rights reserved. */
define("DS/SMAMpwPDSFX/SMAMpwNodesAbstract",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(c,a){var b=c.extend({_processParameters:function(d){d.parameters.ContourMap1D.map.wrapS=a.ClampToEdgeWrapping;d.parameters.ContourMap1D.map.wrapT=a.ClampToEdgeWrapping;d.parameters.ContourMap2D.map.wrapS=a.ClampToEdgeWrapping;d.parameters.ContourMap2D.map.wrapT=a.ClampToEdgeWrapping;d.parameters.ContourMap1D.map.minFilter=a.NearestFilter;d.parameters.ContourMap1D.map.magFilter=a.NearestFilter;d.parameters.ContourMap2D.map.minFilter=a.NearestFilter;d.parameters.ContourMap2D.map.magFilter=a.NearestFilter},_getUniforms:function(d){return{ContourMap1D:{type:"t2",value:d.parameters.ContourMap1D.map},ContourMap2D:{type:"t2",value:d.parameters.ContourMap2D.map},NoResultScale:{type:"f",value:d.parameters.NoResultScale},PointSpriteSize:{type:"f",value:d.parameters.PointSpriteSize},PointSymbol:{type:"f",value:d.parameters.PointSymbol},ResultScale:{type:"f",value:d.parameters.ResultScale},ResultShift:{type:"f",value:d.parameters.ResultShift},ResultsDim:{type:"f",value:d.parameters.ResultsDim},RetexturingScale:{type:"f",value:1},RetexturingShift:{type:"f",value:0}}},_getVSComputePointSize:function(){return["float ComputePointSize() {","  f_Size = PointSpriteSize;","  if( 14.0 == PointSymbol )","    f_Size = 3.0;","  else if( 15.0 == PointSymbol )","    f_Size = 1.0;","  else if( f_Size < 0.55 )","	   f_Size = 0.55;","  return f_Size;","}"].join("\n")},_getFSComputeDiscard:function(){return["bool ComputeDiscard() {","  vec2 v2PC = vGetPointCoord();","  vec3 n;","  n.xy = v2PC * 2.0 - 1.0;","  n.z = dot(n.xy, n.xy);","  if (n.z > 1.0)","    return true;","  n.z = sqrt(1.0 - n.z);","  gv3_Normal = normalize(n);","  return false;","}"].join("\n")},_getFSComputeViewNormal:function(){return["vec3 ComputeViewNormal() {","  return gv3_Normal;","}"].join("\n")},_getFSProcessFinalColor:function(){return["void ProcessFinalColor(inout vec4 ioFinalColor) {","  ioFinalColor.rgb = ioFinalColor.rgb * gv3_Normal.z;","}"].join("\n")},init:function(){this._parent();this._MaterialOptions={size:4,color:new a.Color(65535),sizeAttenuation:false,useBlending:true}},initMaterial:function(h){if(h){h.material=new a.ParticleBasicMaterial(this._MaterialOptions);h.material.activatePDSFX();h.material.lights=true;var d="";var i="vec3 gv3_Normal;";h.material.setPDSFXGlobalShaderCode(d,i);var f={v4_color:{type:"v4"},v4_WorldViewPosition:{type:"v4"},vUv:{type:"v2"},f_Size:{type:"f"}};h.material.setPDSFXVaryings(f);this._processParameters(h);h.material.setPDSFXUniforms(this._getUniforms(h));var e={ComputeVaryingValues:["void ComputeVaryingValues() {","  vec4 v4Col = vec4(1.0,1.0,1.0,1.0);","  float fDim = ResultsDim;","  if( 0.0 != fDim ) {","    // Get texture coordinate for the result value","    vec2 v2TexCoord = vGetAttribTangent().xy;","    float fResX = v2TexCoord.x * ResultScale + ResultShift;","    if( 4.0 > fDim )","		   v2TexCoord.x = clamp(fResX, 0.0, 1.0);","	   else","	     v2TexCoord.x = fract(fResX);","    v2TexCoord.x = v2TexCoord.x * RetexturingScale + RetexturingShift;","	   if( 1.0 == fDim || 5.0 == fDim ) {","		   v2TexCoord.y = 0.0;","		   v4Col.xyz *= texture2D(ContourMap1D, v2TexCoord).xyz;","    }","	   else { //if( 2.0 == ResultsDim )","		   v2TexCoord.y *= NoResultScale; // = clamp(v2TexCoord.y,0.0,1.0);","      v4Col.xyz *= texture2D(ContourMap2D, v2TexCoord).xyz;","	   }","  }","  v4_color = v4Col * 0.9;","  v4_WorldViewPosition = vGetWorldViewMatrix() * vec4(vGetAttribPosition(), 1.0);","}"].join("\n"),ComputePointSize:this._getVSComputePointSize()};var g={ComputeDiscard:this._getFSComputeDiscard(),ComputeAlbedo:["vec3 ComputeAlbedo() {","  return v4_color.rgb;","}"].join("\n"),ComputeEmissive:["vec3 ComputeEmissive() {","  return vec3(0.0);","}"].join("\n"),ComputeOpacity:["float ComputeOpacity() {","  return v4_color.a;","}"].join("\n"),ComputeSpecularColor:["vec3 ComputeSpecularColor() {","  return v4_color.rgb;","}"].join("\n"),ComputeViewNormal:this._getFSComputeViewNormal()};if(this._getFSProcessFinalColor()){g.ProcessFinalColor=this._getFSProcessFinalColor()}h.material.setPDSFXOverridableFunctions(e,g)}}});return b});define("DS/SMAMpwPDSFX/SMAMpwFrontBackTranslucent",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],function(d,c,a){var b=c.singleton({init:function(){this._parent()},initMaterial:function(h){if(h){h.material=new a.MeshPhongMaterial({opacity:0.01});h.material.activatePDSFX();var e="";var i="vec4 gv4_color;";h.material.setPDSFXGlobalShaderCode(e,i);h.material.setPDSFXVaryings({v2_Tex:{type:"v2"}});h.material.setPDSFXUniforms({ColorMap:{type:"t2",value:h.parameters.TextureName.map},HasTexture:{type:"f",value:h.parameters.HasTexture},BackColor:{type:"v4",value:new a.Vector4(h.parameters.BackColor[0],h.parameters.BackColor[1],h.parameters.BackColor[2],h.parameters.BackColor[3])},FrontColor:{type:"v4",value:new a.Vector4(h.parameters.FrontColor[0],h.parameters.FrontColor[1],h.parameters.FrontColor[2],h.parameters.FrontColor[3])},ShowBackColor:{type:"f",value:h.parameters.ShowBackColor}});var f={ComputeVaryingValues:["void ComputeVaryingValues() {","  vec2 v2TexCoord = vec2(0.0);","  // Save texture coordinate for the result value","  float fDim = HasTexture;","  if (0.0 != fDim)","    v2TexCoord = vGetAttribTexCoord0().xy;","  v2_Tex = v2TexCoord;","}"].join("\n")};var g={ComputeCommonValues:["void ComputeCommonValues() {","  if (vIsFrontFacing())","    gv4_color = FrontColor;","  else","    gv4_color = BackColor;","  if (HasTexture != 0.0)","    gv4_color = texture2D(ColorMap, v2_Tex);","}"].join("\n"),ComputeAlbedo:["vec3 ComputeAlbedo() {","  return gv4_color.rgb;","}"].join("\n"),ComputeEmissive:["vec3 ComputeEmissive() {","  return vec3(0.0);","}"].join("\n"),ComputeOpacity:["float ComputeOpacity() {","  return gv4_color.a;","}"].join("\n"),ComputeSpecularReflectance:["vec3 ComputeSpecularReflectance() {","  return vec3(0.04) * gv4_color.rgb;","}"].join("\n"),ComputeDiscard:["bool ComputeDiscard() {","  float showBckC = ShowBackColor;","  return (!vIsFrontFacing() && showBckC == 0.0);","}"].join("\n")};h.material.setPDSFXOverridableFunctions(f,g)}}});return d.namespace("DS/SMAMpwPDSFX/SMAMpwFrontBackTranslucent",b)});define("DS/SMAMpwPDSFX/SMAMpwNodes",["DS/SMAMpwPDSFX/SMAMpwNodesAbstract"],function(b){var a=b.singleton({init:function(){this._parent()}});return a});define("DS/SMAMpwPDSFX/SMAMpwNodesDepth",["DS/SMAMpwPDSFX/SMAMpwNodesAbstract"],function(b){var a=b.singleton({_getVSComputePointSize:function(){return["float ComputePointSize() {","  vec4 v4ProjectedPosition = vGetViewProjectionMatrix() * v4_WorldViewPosition;","  f_Size = PointSpriteSize / ((vGetViewProjectionMatrix()[0][0] / v4ProjectedPosition.w) * float(vGetViewportSize().x));","  return PointSpriteSize;","}"].join("\n")},_getFSProcessFinalColor:function(){return["void ProcessFinalColor(inout vec4 ioFinalColor) {","  vec3 v3SpherePosition = v4_WorldViewPosition.xyz + gv3_Normal * f_Size;","  vec4 v4ProjSpherePosition = vGetProjectionMatrix() * vec4(v3SpherePosition, 1.0);","  v4ProjSpherePosition /= v4ProjSpherePosition.w;","  vSetFragDepth(v4ProjSpherePosition.z*0.5 + 0.5);","  ioFinalColor.rgb = ioFinalColor.rgb * gv3_Normal.z;","}"].join("\n")},init:function(){this._parent()}});return a});define("DS/SMAMpwPDSFX/SMAMpwPtSym",["DS/SMAMpwPDSFX/SMAMpwNodesAbstract"],function(b){var a=b.singleton({_getUniforms:function(d){var c=this._parent(d);c.PointLineWidth={type:"f",value:d.parameters.PointLineWidth};return c},_getFSComputeDiscard:function(){return["bool ComputeDiscard() {","  bool toDiscard = false;","  vec2 n = vGetPointCoord() * 2.0 - 1.0;","  if (PointSymbol == 3.0 || PointSymbol == 4.0 || PointSymbol == 10.0 || PointSymbol == 12.0) {","	   float fMag = dot(n, n);","    toDiscard = ( (PointSymbol == 3.0)	/*CONCENTRIC*/ &&","                (abs(fMag - 0.7) >= 0.35) )","           || ( (PointSymbol == 4.0)  /*COINCIDENT*/ &&","                (abs(fMag - 0.75) >= PointLineWidth) && (abs(fMag - 0.2) >= 0.10) )","           || ( (PointSymbol == 10.0) /*FULLCIRCLE*/ &&","		             (fMag > 0.65) )","           || ( (PointSymbol == 12.0) /*FULLCIRCLE2*/ &&","		             (fMag > 1.0) );","  } else {","    toDiscard = ( (PointSymbol == 1.0 ) /*CROSS*/ &&","                (abs(n.x - n.y) >= PointLineWidth) && (abs(n.x + n.y) >= PointLineWidth) )","           || ( (PointSymbol == 2.0) /*PLUS*/ &&","                (abs(n.x) >= PointLineWidth) && (abs(n.y) >= PointLineWidth) )","           || ( (PointSymbol == 7.0) /*STAR*/ &&","                (abs(n.x - n.y) >= PointLineWidth) &&","                (abs(n.x + n.y) >= PointLineWidth) &&","                (abs(n.x) >= 0.18) && (abs(n.y) >= 0.18) )","           || ( (PointSymbol == 11.0) /*FULLSQUARE*/ &&","                ( abs(n.x) > 0.7 || abs(n.y) > 0.7 ) );","  }","  return toDiscard;","}"].join("\n")},_getFSComputeViewNormal:function(){return["vec3 ComputeViewNormal() {","  return vec3(0.0, 1.0, 0.0);","}"].join("\n")},_getFSProcessFinalColor:function(){return undefined},init:function(){this._parent();this._MaterialOptions.lights=false}});return a});define("DS/SMAMpwPDSFX/SMAMpwShaderFactory",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialManager","DS/SMAMpwPDSFX/SMAMpwFrontBackTranslucent","DS/SMAMpwPDSFX/SMAMpwNodes","DS/SMAMpwPDSFX/SMAMpwNodesDepth","DS/SMAMpwPDSFX/SMAMpwPtSym"],function(c,h,g,i,b,d,e,f){var a=h.singleton({init:function(){this._parent()},registerOnPDSFXMaterial:function(){var k=new i();var j=function(l){var m;switch(l.name){case"SMAMpaFrontBackTranslucent":m=b;break;case"SMAHvcPtSym":m=f;break;case"SMAHvcNodes":m=d;break;case"SMAHvcNodesDepth":m=e;break;default:if(l.name.indexOf("SMAHvc")===0){l.material=new g.MeshPhongMaterial({color:16777215})}break}if(m){m.initMaterial(l)}};k.onPDSFXMaterial(j)}});return c.namespace("DS/SMAMpwPDSFX/SMAMpwShaderFactory",a)});