define("DS/WebApplicationBase/W3AASGNodeHolder",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement"],function(a,b,c){var d=a.extend({init:function(){this._sgNode=null},buildSGNode:function(){console.error("Should be overridden and parent not called")},giveSGNode:function(){return this._sgNode},getSGNode:function(){if(!this._sgNode){if(!this._pathElement){this._sgNode=this.buildSGNode()}else{this._sgNode=this._pathElement.getLastElement()}}return this._sgNode},update:function(e){if(this._sgNode&&this._sgNode.update){this._sgNode.update(e);return this._sgNode.Dirty}return false},preRender:function(e){if(this._sgNode&&this._sgNode.preRender){return this._sgNode.preRender(e)}},postRender:function(e){if(this._sgNode&&this._sgNode.postRender){return this._sgNode.postRender(e)}},postUpdate:function(e){if(!this._sgNode){return}if(this._sgNode&&this._sgNode.postUpdate){return this._sgNode.postUpdate(e)}return false},unreferenceSGNode:function(){this._pathElement=null;this._sgNode=null},Dispose:function(){this.unreferenceSGNode()},setSGNodeDirty:function(f){var e=f;if(e===undefined){e=true}if(this._sgNode){this._sgNode.Dirty=e}},isSGNodeUpToDate:function(){if(this._sgNode){return !this._sgNode.Dirty}},setPathElement:function(e){if(this.isSelfManagedPathElement()){console.warn("isSelfManagedPathElement is set. This method shouldn't be used. Instead, set _pathElement directly")}else{this._pathElement=e}},getPathElement:function(){if(this._pathElement){return this._pathElement}else{return null}},getRelativePathElement:function(l){var h=l.QueryInterface("W3AISGNodeHolder");if(h){var g=h.getPathElement();var m=this._pathElement.externalPath.concat([]);var f=g.externalPath;var j=m.indexOf(f[f.length-1]);var k;for(k=0;k<f.length;k++){if(f[k]!==m[k]){return this._pathElement}}m.splice(0,f.length);var e=new c();e.setFromArray(m);return e}return this._pathElement},getMatrix:function(e){if(!e){console.warn("without a viewer getMatrix method could return unexpected result")}return this.getPathElement().getMatrix(e)},getWorldMatrix:function(e){if(!this.getPathElement()){return null}if(!e){console.error("without a viewer getWorldMatrix method could return unexpected result")}return this.getPathElement().getWorldMatrix(e)},getMatrixInLCS:function(e,g,f){if(!this.getPathElement()){return null}if(!g){return this.getMatrix(e)}if(!f||!this._invWorldMatrix){this._invWorldMatrix=new b.Matrix4().getInverse(this.getWorldMatrix(e))}return new b.Matrix4().multiplyMatrices(this._invWorldMatrix,g)},getPositionInLCS:function(e,f,g){if(!this.getPathElement()){return null}if(!f){return new b.Vector3().getPositionFromMatrix(this.getMatrix(e))}if(!g||!this._invWorldMatrix){this._invWorldMatrix=new b.Matrix4().getInverse(this.getWorldMatrix(e))}return f.clone().applyMatrix4(this._invWorldMatrix)},getDirectionInLCS:function(f,e,g){if(!this.getPathElement()){return null}if(!e){console.error("You have to provide an input direction")}if(!g||!this._invWorldMatrix3){this._invWorldMatrix3=new b.Matrix3().getInverse(this.getWorldMatrix(f))}return e.clone().applyMatrix3(this._invWorldMatrix3)},getMatrixInWCS:function(e,f){if(!this.getPathElement()){return null}if(!f){return this.getWorldMatrix(e)}return this.getWorldMatrix(e).multiply(f)},getPositionInWCS:function(f,e){if(!this.getPathElement()){return null}if(!e){return new b.Vector3().getPositionFromMatrix(this.getWorldMatrix(f))}return e.clone().applyMatrix4(this.getWorldMatrix(f))},getDirectionInWCS:function(f,e){if(!this.getPathElement()){return null}if(!e){console.error("You have to provide an input direction")}return e.clone().applyMatrix3(new b.Matrix3().copy(this.getWorldMatrix(f)))},isSelfManagedPathElement:function(){return false}});return d});define("DS/WebApplicationBase/W3AISGNodeHolder",["DS/WebComponentModeler/CATWebInterface"],function(a){var b=a.singleton({interfaceName:"W3AISGNodeHolder",required:{buildSGNode:function(){},giveSGNode:function(){},getSGNode:function(){},update:function(c){},unreferenceSGNode:function(){},setSGNodeDirty:function(c){},isSGNodeUpToDate:function(){},getPathElement:function(){},getRelativePathElement:function(c){},getMatrix:function(c){},getWorldMatrix:function(c){},getMatrixInLCS:function(c,d){},getPositionInLCS:function(c,d){},getDirectionInLCS:function(d,c){},getMatrixInWCS:function(c,d){},getPositionInWCS:function(d,c){},getDirectionInWCS:function(d,c){},isSelfManagedPathElement:function(){}},optional:{setPathElement:function(c){},preRender:function(c){},postRender:function(c){},postUpdate:function(c){}}});return b});define("DS/WebApplicationBase/W3AIManager",["DS/WebComponentModeler/CATWebInterface"],function(a){var b=a.singleton({interfaceName:"W3AIManager",required:{getUpdatePriority:function(){},initialize:function(){},unInitialize:function(){},postInitialize:function(){},update:function(c){},preRender:function(c){},postRender:function(c){},postUpdate:function(c){},getVersion:function(){}}});return b});define("DS/WebApplicationBase/W3AAManager",["UWA/Class"],function(a){var b=a.extend({init:function(){},getUpdatePriority:function(){return 0},initialize:function(){},unInitialize:function(){},postInitialize:function(){},GetType:function(){return this.componentType},update:function(c){},preRender:function(c){},postRender:function(c){},postUpdate:function(c){},getVersion:function(){return"0.0"}});Object.defineProperty(b.prototype,"componentType",{enumerable:true,get:function(){return"W3AAManager"}});return b});define("DS/WebApplicationBase/VCXIModelNavigable",["DS/WebComponentModeler/CATWebInterface"],function(b){var a=b.singleton({interfaceName:"VCXIModelNavigable",required:{getParent:function(){},setParent:function(c){},setInternalParent:function(c){},addChild:function(c){},addChildren:function(c){},removeChild:function(c){},setWorkingRoot:function(c){},getWorkingRoot:function(){},getAssetNavigable:function(){},setAssetNavigable:function(c){},isSelfOrganized:function(){},traverse:function(e,c,d){},clear:function(){}},optional:{}});return a});define("DS/WebApplicationBase/VCXAModelNavigable",["UWA/Class",],function(a){var b=a.extend({init:function(){this._father=null;this._childrenList=[]},getParent:function(){return this._father},setParent:function(c){if(this.getParent()){this.getParent().removeChild(this)}if(c){c.addChild(this)}},setInternalParent:function(c){this._father=c},getChildren:function(){return this._childrenList},isAncestorOf:function(c){if(!c||c.QueryInterface("VCXIModelNavigable")!==c){return}if(this===c){return true}var d=c.getParent();while(d){if(this===d){return true}else{d=d.getParent()}}return false},addChild:function(c){this.getChildren().push(c);c.setInternalParent(this)},addChildren:function(e){this._childrenList=this._childrenList.concat(e);for(var c=0;c<e.length;c++){var d=e[c];if(d){d.setInternalParent(this)}}},removeChild:function(f){if(f){}else{return}var c=-1;var e=this.getChildren();for(var d=0;d<e.length;d++){var h=e[d];if(h){var g=h.GetObject().GetID();if(f.GetObject().GetID()===g){c=d}}}if(c>=0){this.getChildren()[c].setInternalParent(null);this.getChildren().splice(c,1)}},setWorkingRoot:function(c){this._workingRoot=c},getWorkingRoot:function(){if(!this._workingRoot&&this.getParent()){this._workingRoot=this.getParent().getWorkingRoot()}return this._workingRoot},setAssetNavigable:function(c){this._assetNavigable=c},getAssetNavigable:function(){if(!this._assetNavigable&&this.getParent()){this._assetNavigable=this.getParent().getAssetNavigable()}return this._assetNavigable},isSelfOrganized:function(){return false},traverse:function(g,c,f){if(!f||!f.childrenFirst){g(this,c,f)}var e=this.getChildren();var h=e.length;for(var d=0;d<h&&(!f||!f.stop);++d){var j=e[d];j.traverse(g,c,f)}if(f&&f.childrenFirst){g(this,c,f)}},Dispose:function(){this._father=null;this._childrenList=[];this._workingRoot=null;this._assetNavigable=null},clear:function(c){var f=this.getChildren();var g=f.length;for(var e=0;e<g;++e){var h=f[e];if(h&&typeof h.clear==="function"){h.clear(true)}}if(!c&&this.getParent()){this.getParent().removeChild(this)}var d=this.GetObject();if(d){d.CallDispose()}}});return b});define("DS/WebApplicationBase/W3AManagerSet",["UWA/Class","DS/CoreEvents/Events"],function(b,c){var a=b.extend({init:function(){this._ManagerArray=[];this._ManagerSet={}},initialize:function(){var e=[];var f;for(f=0;f<this._ManagerArray.length;f++){var d=this._ManagerArray[f];var g=d.initialize();if(g){e.push(g)}}return UWA.Promise.allSettled(e)},postInitialize:function(){this._firstStep=true;var f=[];var d=UWA.Promise.deferred();var g;for(g=0;g<this._ManagerArray.length;g++){var e=this._ManagerArray[g];var h=e.postInitialize();if(h){f.push(h)}}var i=this;UWA.Promise.allSettled(f).then(function(){i._loopReady=true;d.resolve()});return d.promise},unInitialize:function(){this._loopReady=false;var d=UWA.Promise.deferred();var f=[];var g;for(g=this._ManagerArray.length-1;g>=0;g--){var e=this._ManagerArray[g];var h=e.unInitialize();if(h){f.push(h)}}var i=this;UWA.Promise.allSettled(f).then(function(){d.resolve()});return d.promise},getManager:function(d){return this._ManagerSet[d]},addManager:function(d,e){if(d){var f=e.QueryInterface("W3AIManager");if(f){if(this._ManagerSet[d]){console.warn("The manager "+d+" already exists!");return 2}this._ManagerSet[d]=f.GetObject();this._ManagerArray.push(this._ManagerSet[d]);f.GetObject()._ManagerSet=this;f._ManagerSet=this;f._experienceBase=f.GetObject()._experienceBase;if(f._experienceBase&&this._experienceBase===undefined){this._experienceBase=f._experienceBase}this._ManagerArray.sort(function(h,g){if(h.getUpdatePriority()>g.getUpdatePriority()){return 1}if(h.getUpdatePriority()<g.getUpdatePriority()){return -1}return 0});return 0}}console.warn("The manager "+d+" have not been added to the managerSet!");return 1},removeManager:function(d){if(d){var g=this._ManagerSet[d];if(g){var e=-1;for(var f=0;f<this._ManagerArray.length&&e===-1;f++){if(g===this._ManagerArray[f]){e=f}}if(e>=0){this._ManagerArray.splice(e,1)}this._ManagerSet[d].unInitialize();delete this._ManagerSet[d]}}},update:function(f){if(this._firstStep){this._firstStep=false;c.publish({event:"/W3A/ManagerSet/RunLoopStarted"})}if(!this._loopReady){console.warn("Loop is not ready!");return}var d=f.profiler;if(f&&f.viewer&&!f.viewpoint){f.viewpoint=f.viewer.currentViewpoint}var g;for(g=0;g<this._ManagerArray.length;g++){var e=this._ManagerArray[g];if(e.update){if(d){f.profiler=d.addProfile(e._ID)}e.update(f);if(f.profiler){f.profiler.stop()}}}if(d){d.stop();f.profiler=d}},preRender:function(f){if(!this._loopReady){console.warn("Loop is not ready!");return}f.viewer.div.style.visibility;if(f.viewer&&f.viewer.div&&f.viewer.div.style&&f.viewer.div.style.visibility==="hidden"){return}var d=f.profiler;var g;for(g=0;g<this._ManagerArray.length;g++){var e=this._ManagerArray[g];if(e.preRender){if(d){f.profiler=d.addProfile(e._ID)}e.preRender(f);if(f.profiler){f.profiler.stop()}}}if(d){d.stop();f.profiler=d}},postRender:function(f){if(!this._loopReady){console.warn("Loop is not ready!");return}var d=f.profiler;var g;for(g=this._ManagerArray.length-1;g>=0;g--){var e=this._ManagerArray[g];if(e.postRender){if(d){f.profiler=d.addProfile(e._ID)}e.postRender(f);if(f.profiler){f.profiler.stop()}}}if(d){d.stop();f.profiler=d}},postUpdate:function(f){if(!this._loopReady){console.warn("Loop is not ready!");return}var d=f.profiler;var g;for(g=this._ManagerArray.length-1;g>=0;g--){var e=this._ManagerArray[g];if(e.postUpdate){if(d){f.profiler=d.addProfile(e._ID)}e.postUpdate(f);if(f.profiler){f.profiler.stop()}}}if(d){d.stop();f.profiler=d}},getVersions:function(){var d=[];var g;for(g=0;g<this._ManagerArray.length;g++){var f=this._ManagerArray[g];if(f&&f.QueryInterface&&f.GetType){var e=f.QueryInterface("W3AIManager");if(e&&e.getVersion&&e.getUpdatePriority){d.push({Type:f.GetType(),Version:e.getVersion(),Priority:e.getUpdatePriority()})}}}return d}});return a});define("DS/WebApplicationBase/WebComponentsMap",["UWA/Class","UWA/Utils"],function(a,c){var b=a.extend({init:function(){this._ComponentTable={};this._maxID=0;this._hashTable={};this._hashTableValid=false},Clean:function(){this._ComponentTable={};this._maxID=0;this._hashTable={};this._hashTableValid=false},GetComponentTable:function(){return this._ComponentTable},AddComponent:function(e){this._hashTableValid=false;if(e){var d=e.GetID();if(d){if(this._ComponentTable[d]){return}}else{var f=c.getUUID();d=f.substr(0,18);e.SetID(d.toString())}this._ComponentTable[d]=e}else{console.log("WARNING -> WebComponentsMap::AddComponent FAILED")}},RemoveComponent:function(d){this._hashTableValid=false;delete this._ComponentTable[d]},GetComponentFromID:function(e){var d=this._ComponentTable[e];if(typeof d==="undefined"){return null}return d},GetComponentsFromIDs:function(e){var h=[];for(var f=0;f<e.length;++f){var g=e[f];var d=this.GetComponentFromID(g);if(d){h.push(d)}}return h},GetComponentFromType:function(h,e){var g=[];for(var f in this._ComponentTable){if(this._ComponentTable.hasOwnProperty(f)){var d=this._ComponentTable[f];if(d.IsKindOf(h)){if(!e){g.push(d)}}else{if(e){g.push(d)}}}}return g},GetComponentsFromFilterMethod:function(e){if(typeof e!=="function"){console.warn("GetComponentsFromFilterMethod needs a function as unique argument.");return}var g=[];for(var f in this._ComponentTable){if(this._ComponentTable.hasOwnProperty(f)){var d=this._ComponentTable[f];if(e(d)){g.push(d)}}}return g},GetComponentFromLink:function(e){if(e){var f=e.GetValue();var d=this.GetComponentFromID(f);return d}else{return null}},InitHashTable:function(){for(var f in this._ComponentTable){if(this._ComponentTable.hasOwnProperty(f)){var d=this._ComponentTable[f];if(d.QueryInterface("W3AISGNodeHolder")&&d.QueryInterface("W3AISGNodeHolder").getPathElement){var e=d.QueryInterface("W3AISGNodeHolder").getPathElement();var g=this.BuildHashingFromPathElement(e);this._hashTable[g]=d}}}this._hashTableValid=true},BuildHashingFromPathElement:function(d){if(d){return this.BuildHashingFromExternalPath(d.externalPath)}else{return null}},BuildHashingFromExternalPath:function(g){var h="";var f=g.length;for(var e=0;e<f;e++){var d=g[e];if(d){h+=d.id}if(e<f-1){h+="."}}return h},GetComponentFromPathElement:function(d){return this.GetComponentFromExternalPath(d.externalPath)},GetComponentsFromPathElements:function(h){if(!Array.isArray(h)){return}var f=[];for(var g=0;g<h.length;++g){var e=h[g];var d=e&&this.GetComponentFromPathElement(e);f.push(d)}return f},GetComponentFromExternalPath:function(e){var f=this.BuildHashingFromExternalPath(e);if(!this._hashTableValid){this.InitHashTable()}var d=this._hashTable[f];return d}});return b});define("DS/WebApplicationBase/WebApplicationBase",["DS/WebApplicationBase/WebComponentsMap","DS/WebComponentModeler/WebComponentModelerBase","DS/WebApplicationBase/W3AManagerSet"],function(d,b,a){var c=b.extend({init:function(e,f){this._parent(e,f);this._ManagerSet=new a();var g=new d();Object.defineProperty(this,"ComponentsMap",{enumerable:true,get:function(){return g}})},Clean:function(){this._parent();this.ComponentsMap.Clean()},BuildComponentsFromNode:function(l,g){if(this.deprecatedDisplayed!==true){console.warn("BuildComponentsFromNode is DEPRECATED since R420 please use BuildComponentsFromNodeEXT instead");this.deprecatedDisplayed=true}var e=l.getChildren();for(var j=0;j<e.length;j++){var h=e[j];var k=g.clone();k.addElement(h);if(h.productType!=="Reference3D"&&h.productType!=="InstanceRep"){var f=this.Factory.BuildComponent("VCXWebComponentOccurrence");if(f){f.QueryInterface("W3AISGNodeHolder").setPathElement(k);this.ComponentsMap.AddComponent(f)}}else{if(h.name==="Experience"){var f=this.Factory.BuildComponent("VCXWebComponentOccurrence");if(f){f.QueryInterface("W3AISGNodeHolder").setPathElement(k);f.SetID("VCX_Root");f.SetPersistency(0)}this.ComponentsMap.AddComponent(f)}}if(h.productType!=="InstanceRep"){this.BuildComponentsFromNode(h,k)}}},BuildComponentsFromNodeEXT:function(h,q,f,j){var p=h.getChildren();for(var k=0;k<p.length;k++){var e=p[k];var g=q.clone();g.addElement(e);var n=null;if(typeof e.VCX_ROOT_ID!=="undefined"){}else{if(j.componentTypeFromFunction){n=j.componentTypeFromFunction(e)}else{if(typeof e[j.attributeToUse]!=="undefined"&&e[j.attributeToUse]!==""){n=j[e[j.attributeToUse]]}else{n=j.defaultType}}}var l=null;if((typeof n!=="undefined")&&n!==null){var o=this.Factory.BuildComponent(n);if(o){l=o.QueryInterface("VCXIModelNavigable");if(l&&f){l.setParent(f)}var m=o.QueryInterface("W3AISGNodeHolder");if(m){m.setPathElement(g)}this.ComponentsMap.AddComponent(o)}}if(l){this.BuildComponentsFromNodeEXT(e,g,l,j)}else{this.BuildComponentsFromNodeEXT(e,g,f,j)}}},AddDictionary:function(e){this._parent(e)},AddDictionaryApp:function(e){this._parent(e)},AddDictionaryBase:function(e){this._parent(e)},getManager:function(e){if(this._ManagerSet){return this._ManagerSet.getManager(e)}}});return c});