define("DS/XCTInfStreamReader/XCTXHRWithProxyAbstraction",["UWA/Core","DS/XCTInfUtilsWeb/XCTLogger"],function(c,b){var a=function(){var d=function(g,h,f){var e=g.indexOf("/");var j=g.indexOf("/",e+2);var i=g.slice(0,e)+"//"+h+":"+f+g.slice(j,g.length);return i};this.executePostHttpRequest2=function(g,l,k,j,f){if(a.proxyUsage===2){b.log("gestion UWA");var e={timeout:100000,method:"POST",data:k,type:"text",headers:{"Content-Type":l,Accept:"application/json"},onComplete:j,onFailure:function(){c.log("arguments onFailure");c.log(arguments)}};if(f.responseType!==null){e.type=f.responseType}if(a.proxymode){e.proxy=a.proxymode}c.Data.request(g,e)}else{if(a.proxyUsage===1){g=d(g,a.server,a.sport)}var i=new XMLHttpRequest();i.open("POST",g,true);i.onload=function(){j(this.response)};var h=new FormData();h.append("data",k);i.setRequestHeader("Content-type",l);i.setRequestHeader("Accept","text/plain");if(f.responseType){i.responseType=f.responseType}i.send(k)}};this.executeSyncPostHttpRequest=function(g,j,i){if(a.proxyUsage===2){b.log("gestion UWA");var e;var f={timeout:100000,method:"POST",data:i,type:"text",async:false,headers:{"Content-type":j,Accept:"text/plain"},onComplete:function(k){b.warn("retour >data",k);e=k},onFailure:function(){b.log("arguments onFailure");b.log(arguments)}};if(a.proxymode){f.proxy=a.proxymode}c.Data.request(g,f);return e}else{if(a.proxyUsage===1){g=d(g,a.server,a.sport)}var h=new XMLHttpRequest();h.open("POST",g,false);h.setRequestHeader("Content-type",j);h.setRequestHeader("Accept","text/plain");h.send(i);return h.responseText}};this.transformUrlIntoRealUrl=function(e){if(a.proxyUsage===2){b.log("gestion UWA");return c.Data.proxifyUrl(e,{proxy:"passport"})}else{if(a.proxyUsage===1){e=d(e,a.server,a.sport);return e}}return e};this.syncTransformFCSUrlIntoRealUrl=function(f,g){var h=f.indexOf("v23");var q=f.slice(3,h);var j=f.slice(h+3,f.length);var n="application/xml";if(typeof(g)==="boolean"&&g){n="application/xmql"}var k=this.executeSyncPostHttpRequest(q,n,j);var o=/\{\{([^\}]*)\}\{([^\}]*)\}\}/;var p=o.exec(k);var e=p[1];var m=p[2];var i=m;var l="posthttp:"+i+":postparams:__fcs__jobTicket="+encodeURIComponent(e);return l}};a.useNoProxy=function(){a.proxyUsage=0;a.server=null;a.sport=null};a.useProxyDefinedBy=function(e,d){a.proxyUsage=1;a.server=e;a.sport=d};a.useUWAProxy=function(d){a.proxyUsage=2;a.server=null;a.sport=null;a.proxymode=d};return a});define("DS/XCTInfStreamReader/XCTInfStreamReader",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAFData/WAFData","DS/XCTInfStreamReader/XCTXHRWithProxyAbstraction","DS/XCTInfUtilsWeb/XCTLogger"],function(g,f,e,a,b,c){var d=f.extend({getStreamDescriptors:function(h,m){var k="start transaction;\n";k+="temp query businessobject * * * ";k+='where "physicalid match %1" select physicalid attribute[StreamDescriptors];\n';k+="abort transaction;";k=k.replace("%1",h.physicalid);var i=location.protocol+"//"+location.hostname+"/3DSpace/i3dx/services/xmql?raw=true";b.useUWAProxy("passport");var l=new b();var j=l.transformUrlIntoRealUrl(i);l.executePostHttpRequest2(j,"application/xmql",k,function(r){var w=[];var p=r.split("attribute[StreamDescriptors] =")[1];var q=p.split(":");for(var s=0;s<q.length;s++){var o=q[s].trim();o=o.substring(5,o.length-1);var t=o.split(",");var v=t[0];var u=t[1];var n=t[6];w.push({format:v,name:h.physicalid+"_"+u+"."+v+"="+n.substring(1,n.length-1)})}c.log(w);m(h,w)},{})},streamDescriptorToTicket:function(h,m,n){var k="start transaction ;\n";k+="get checkout ticket nozip mcsurl %1 \n";k+=" store %2 \n";k+="businessobjectproxy physicalid %3 format %4 filename %5 tcl;\n";k+="abort transaction ;\n";k=k.replace("%1","1");k=k.replace("%2","2");k=k.replace("%3",h);k=k.replace("%4",m.format);k=k.replace("%5",m.name);var i=location.protocol+"//"+location.hostname+"/3DSpace/i3dx/services/xmql?raw=true";b.useUWAProxy("passport");var l=new b();var j=l.transformUrlIntoRealUrl(i);l.executePostHttpRequest2(j,"application/xmql",k,function(o){var t=/\{\{([^\}]*)\}\{([^\}]*)\}\}/;var r=t.exec(o);var q=r[1];var s=r[2];var p=s+"?__fcs__jobTicket="+encodeURIComponent(q)+"&jobTicket=__fcs__jobTicket&__fcs__attachment=true";n(m,p)},{})},handleTicket:function(i,j){var h={timeout:100000,method:"GET",type:"blob",proxy:"passport",headers:{Accept:"application/octet-stream"},onComplete:function(k){j(k)},onFailure:function(){g.log("arguments onFailure");g.log(arguments)}};g.Data.request(i,h)}});return d});