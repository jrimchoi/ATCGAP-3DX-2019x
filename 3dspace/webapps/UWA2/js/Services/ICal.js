define("UWA/Services/ICal",["UWA/Core","UWA/String"],function(c,b){var a=function(d){this.stream=d;this.parse()};a.prototype={stream:null,regexes:{component:"BEGIN:{0}(?:[^])*?END:{0}",multipleProperties:"\n{0}[^:]*",singleProperty:"({0})(;[^=]*=[^;:\n]*)*:([^\n]*)"},keys:{core:{version:"VERSION",prodId:"PRODID",calendarScale:"CALSCALE",method:"METHOD"},components:{event:"VEVENT",todo:"VTODO",journal:"VJOURNAL",freebusy:"VFREEBUSY"},event:{classification:{key:"CLASS",multiple:false},created:{key:"CREATED",multiple:false},description:{key:"DESCRIPTION",multiple:false},geo:{key:"GEO",multiple:false},lastModified:{key:"LAST-MODIFIED",multiple:false},location:{key:"LOCATION",multiple:false},organizer:{key:"ORGANIZER",multiple:false},priority:{key:"PRIORITY",multiple:false},dateTimeStamp:{key:"DTSTAMP",multiple:false},sequence:{key:"SEQUENCE",multiple:false},status:{key:"STATUS",multiple:false},transparent:{key:"TRANSP",multiple:false},url:{key:"URL",multiple:false},recurrenceId:{key:"RECURRENCE-ID",multiple:false},duration:{key:"DURATION",multiple:false},attach:{key:"ATTACH",multiple:true},attendee:{key:"ATTENDEE",multiple:true},categories:{key:"CATEGORIES",multiple:true},comment:{key:"COMMENT",multiple:true},contact:{key:"CONTACT",multiple:true},exceptionDate:{key:"EXDATE",multiple:true},exceptionRule:{key:"EXRULE",multiple:true},requestStatus:{key:"REQUEST-STATUS",multiple:true},related:{key:"RELATED",multiple:true},ressources:{key:"RESSOURCES",multiple:true},recurrenceDate:{key:"RDATE",multiple:true},recurrenceRule:{key:"RRULE",multiple:true},xProperty:{key:"X-",multiple:true},uid:{key:"UID",multiple:true},summary:{key:"SUMMARY",multiple:false},dateTimeStart:{key:"DTSTART",multiple:false},dateTimeEnd:{key:"DTEND",multiple:false}},todo:{classification:{key:"CLASS",multiple:false},completed:{key:"COMPLETED",multiple:false},created:{key:"CREATED",multiple:false},description:{key:"DESCRIPTION",multiple:false},dateTimeStamp:{key:"DTSTAMP",multiple:false},geoPosition:{key:"GEO",multiple:false},lastModified:{key:"LAST-MODIFIED",multiple:false},location:{key:"LOCATION",multiple:false},organizer:{key:"ORGANIZER",multiple:false},percentComplete:{key:"PERCENT-COMPLETE",multiple:false},priority:{key:"PRIORITY",multiple:false},recurrenceId:{key:"RECURRENCE-ID",multiple:false},sequence:{key:"SEQUENCE",multiple:false},status:{key:"STATUS",multiple:false},summary:{key:"SUMMARY",multiple:false},uid:{key:"UID",multiple:false},url:{key:"URL",multiple:false},due:{key:"DUE",multiple:false},duration:{key:"DURATION",multiple:false},attach:{key:"ATTACH",multiple:true},attendee:{key:"ATTENDEE",multiple:true},categories:{key:"CATEGORIES",multiple:true},comment:{key:"COMMENT",multiple:true},contact:{key:"CONTACT",multiple:true},exceptionDate:{key:"EXDATE",multiple:true},exceptioRule:{key:"EXRULE",multiple:true},requestStatus:{key:"REQUEST-STATUS",multiple:true},related:{key:"RELATED",multiple:true},ressources:{key:"RESSOURCES",multiple:true},recurrenceDate:{key:"RDATE",multiple:true},recurrenceRule:{key:"RRULE",multiple:true},xProperty:{key:"X-",multiple:true}},journal:{classification:{key:"CLASS",multiple:false},created:{key:"CREATED",multiple:false},description:{key:"DESCRIPTION",multiple:false},datetimeStart:{key:"DTSTART",multiple:false},datetimeStamp:{key:"DTSTAMP",multiple:false},lastModified:{key:"LAST-MODIFIED",multiple:false},organizer:{key:"ORGANIZER",multiple:false},recurrenceId:{key:"RECURRENCE-ID",multiple:false},sequence:{key:"SEQUENCE",multiple:false},status:{key:"STATUS",multiple:false},summary:{key:"SUMMARY",multiple:false},uid:{key:"UID",multiple:false},url:{key:"URL",multiple:false},attach:{key:"ATTACH",multiple:true},attendee:{key:"ATTENDEE",multiple:true},categories:{key:"CATEGORIES",multiple:true},comment:{key:"COMMENT",multiple:true},contact:{key:"CONTACT",multiple:true},exceptionDate:{key:"EXDATE",multiple:true},exceptionRule:{key:"EXRULE",multiple:true},related:{key:"RELATED",multiple:true},recurrenceDate:{key:"RDATE",multiple:true},recurrenceRule:{key:"RRULE",multiple:true},requestStatus:{key:"REQUEST-STATUS",multiple:true},xProperty:{key:"X-",multiple:true}},freebusy:{contact:{key:"CONTACT",multiple:false},datetimeStart:{key:"DTSTART",multiple:false},datetimeEnd:{key:"DTEND",multiple:false},duration:{key:"DURATION",multiple:false},description:{key:"DESCRIPTION",multiple:false},datetimeStamp:{key:"DTSTAMP",multiple:false},organizer:{key:"ORGANIZER",multiple:false},uid:{key:"UID",multiple:false},url:{key:"URL",multiple:false},attendee:{key:"ATTENDEE",multiple:true},comment:{key:"COMMENT",multiple:true},freebusy:{key:"FREEBUSY",multiple:true},requestStatus:{key:"REQUEST-STATUS",multiple:true},xProperty:{key:"X-",multiple:true}}},core:{version:"",prodId:"",calendarScale:"",method:""},components:{event:[],todo:[],journal:[],freebusy:[]},parse:function(){this.parseCoreProperties();this.parseComponent("event");this.parseComponent("todo");this.parseComponent("journal");this.parseComponent("freebusy")},parseCoreProperties:function(){var d=this.stream;this.core.version=this.parseProperty(this.keys.core.version,d);this.core.prodId=this.parseProperty(this.keys.core.prodId,d);this.core.calendarScale=this.parseProperty(this.keys.core.calendarScale,d);this.core.method=this.parseProperty(this.keys.core.method,d)},parseComponent:function(e){var i,d,h=this.keys,g=this.components,f=new RegExp(b.format(this.regexes.component,h.components[e]),"g"),j;if(typeof(this.stream)==="string"){j=this.stream.match(f);if(j){for(d in j){if(typeof(j[d])==="string"){g[e].push({});for(i in h[e]){if(typeof(h[e][i])==="object"){g[e][d][i]=(h[e][i].multiple)?this.parseMultipleProperties(h[e][i].key,j[d]):this.parseProperty(h[e][i].key,j[d])}}}}}}},parseProperty:function(f,l){var e,j,h,k,g=new RegExp(b.format(this.regexes.singleProperty,f),"g"),d=g.exec(l);if(d){j=d[3];if(d[2]){h=d[2].substr(1).split(";");for(e=0;e<h.length;e++){k=h[e].split("=");if(k[1]===undefined){k[1]=k[0]}h[k[0]]=k[1]}}return{value:j,parameters:h}}return(undefined)},parseMultipleProperties:function(f,j){var e,d,g=new RegExp(b.format(this.regexes.multipleProperties,f),"g"),h=j.match(g);if(h){d=[];for(e=0;e<h.length;e++){h[e]=h[e].replace(/;.*/,"");d[d.length]=this.parseProperty(h[e])}return(d)}return(undefined)},getCalendar:function(){return({core:this.core,components:this.components})},getEvents:function(){return(this.components.event)},getTodoArray:function(){return(this.components.todo)},getJournals:function(){return(this.components.journal)},getFreebusys:function(){return(this.components.freebusy)},getCoreProperties:function(){return(this.core)}};return c.namespace("Services/ICal",a,c)});