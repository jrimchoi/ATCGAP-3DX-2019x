define("UWA/Services/Auth/Adapter/SiteMinder",["UWA/Core","UWA/Utils","UWA/Ajax","UWA/Json","UWA/Data","UWA/Services/Auth/Adapter/Abstract"],function(g,e,c,a,b,f){var d=f.extend({defaultOptions:{timeout:15000,smagentname:"",realmoid:"",forest:"",guid:"",type:"",smauthreason:0,target:"https://example.com/myapp/test.json",login:"https://example.com/global/2.0/login.fcc",logout:"https://example.com/global/2.0/logout.fcc"},isAjaxPostAllowed:function(){return b.allowCrossOriginRequest},hasIdentity:function(j,i){var h=this.options;if(this.hasIdentityRequest){this.hasIdentityRequest.cancel()}this.hasIdentityRequest=a.request(h.target,{useOfflineCache:false,timeout:h.timeout,onComplete:function(k){if(typeof j==="function"){j(k)}}.bind(this),onFailure:function(k){if(typeof i==="function"){i(k)}}.bind(this)})},getIdentity:function(i,h){h(new Error("Not implemented."))},clearIdentity:function(h){h=h||function(){};if(this.isAjaxPostAllowed()){this.clearIdentityUsingAjax(h)}else{this.clearIdentityUsingFrame(h)}},authenticate:function(o,h,k){h=h||function(){};o=o||function(){};if(!k.login||!k.password){h(new Error("Invalid credentials values."))}else{var p=this.options,n=p.target+"&callback=jsonp"+(Date.now()+e.random(1,10000)),l=e.toQueryString({type:p.type,realmoid:p.realmoid,guid:p.guid,smauthreason:p.smauthreason,method:"GET",smagentname:"-SM-"+p.smagentname,target:"-SM-"+n}).replace(/%25/g,"-%"),i=p.login+"?"+l,j=function(){this.hasIdentity(o,h)}.bind(this),m={target:n,smquerydata:"",smauthreason:p.smauthreason,smagentname:p.smagentname,postpreservationdata:"",forest:p.forest,userid:k.login,password:k.password,Submit:""};if(this.isAjaxPostAllowed()){this.authenticateUsingAjax(m,i,j,h)}else{this.authenticateUsingFrame(m,i,j,h)}}},authenticateUsingFrame:function(n,l,m){var p,j,o=Math.ceil(Math.random()*100000),h=g.createElement("div",{styles:{position:"absolute",top:"-2000px",left:"0px"}}),k=g.createElement("iframe",{src:"about:blank",name:"siteminder:frame:"+o}).inject(h),i=g.createElement("form",{target:"siteminder:frame:"+o,action:l,method:"post"}).inject(h);for(p in n){if(n.hasOwnProperty(p)){j=n[p];g.createElement("input",{type:"hidden",name:p,value:j}).inject(i)}}document.body.appendChild(h);k.addEvent("load",function(){this.destroy();m()});i.submit()},clearIdentityUsingFrame:function(i){var j,h=this.options.logout;h+=((h.indexOf("?")>-1)?"&":"?")+"rnd="+Math.random();j=g.createElement("iframe",{src:"about:blank",styles:{position:"absolute",top:"-2000px",left:"0px"}}).inject(document.body);j.addEvent("load",function(){this.destroy();i()});j.setAttribute("src",h)},authenticateUsingAjax:function(h,i,k,j){c.request(i,{onComplete:k,onFailure:function(){this.hasIdentity(k,j)}.bind(this),method:"POST",data:h})},clearIdentityUsingAjax:function(h){c.request(this.options.logout,{onComplete:h,onFailure:h,method:"GET"})}});return g.namespace("Services/Auth/Adapter/SiteMinder",d,g)});