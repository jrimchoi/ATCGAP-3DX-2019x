define("UWA/Ajax",["UWA/Core","UWA/Utils","UWA/String"],function(d,c,b){var a={getRequest:function(g,n){n=d.merge(n||{},{url:g,method:"GET",async:true,responseType:"text",onComplete:function(){},onFailure:function(o){throw o},onTimeout:function(o){throw o},onCancel:function(){}});var l,k,f,e=n.method||"GET",i=n.headers||{},m=n.authentication,h=a.onStateChange;if(/OPTIONS|GET|HEAD|POST|PUT|DELETE|TRACE|CONNECT/i.test(e)){e=e.toUpperCase()}if(n.data){if(!d.is(n.data,["string","arraybufferview","formdata","blob"])){n.data=c.toQueryString(n.data)}if(e==="GET"){g+=((g.indexOf("?")>-1)?"&":"?")+n.data;n.url=g;delete n.data}}if(!n.cors){if(!c.getOwnPropertyMatchName(i,"X-Requested-With")){i["X-Requested-With"]="XMLHttpRequest"}if(!c.getOwnPropertyMatchName(i,"X-Requested-Method")){i["X-Requested-Method"]=e}}if(e==="POST"&&!c.getOwnPropertyMatchName(i,"Content-Type")&&!d.is(n.data,["arraybufferview","formdata","blob"])){i["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"}if(m){if(m.username&&m.password){f=g.split("://");g=f[0]+"://"+m.username+":"+m.password+"@"+f[1]}else{g+=(g.indexOf("?")>-1?"&":"?")+c.toQueryString(m)}}if(n.cors){k=a.createCORSRequest()}else{k=a.createRequest()}if(!k){n.onFailure(new Error("Unable to initiate XMLHttpRequest object."));return}k.cancel=function(){k.aborted=true;k.abort()};if(k.addEventListener&&n.onProgress){k.addEventListener("progress",function(o){n.onProgress(o)})}k.open(e,g,n.async);n.responseTypeSupport="responseType" in k&&n.responseType!=="json"&&(n.async||typeof window==="undefined");if(n.responseTypeSupport){try{k.responseType=n.responseType}catch(j){k.responseType="text"}}n.withCredentialsSupport="withCredentials" in k&&(n.async||typeof window==="undefined");if(n.withCredentials){if(n.withCredentialsSupport){k.withCredentials=n.withCredentials}else{n.onFailure(new Error("XMLHttpRequest does not support withCredentials."));return}}if(n.timeout){k.timeoutTimer=setTimeout(function(){k.timedout=true;k.abort()},n.timeout)}if(n.cors){k.onerror=function(){d.merge(k,{readyState:4,status:500});h(k,n)};k.onload=function(){d.merge(k,{readyState:4,status:200});h(k,n)}}else{k.onreadystatechange=h.bind(a,k,n)}if(k.setRequestHeader){for(l in i){if(i.hasOwnProperty(l)){k.setRequestHeader(l,i[l])}}}return k},createRequest:function(){var e;if(window.XMLHttpRequest){e=new window.XMLHttpRequest()}else{if(window.ActiveXObject){e=new window.ActiveXObject("Msxml2.XMLHTTP")}}return e},createCORSRequest:function(){var e;if(window.XMLHttpRequest){e=new window.XMLHttpRequest();if(!e.withCredentials&&window.XDomainRequest){e=new window.XDomainRequest()}}return e},request:function(f,e){var g;e=e||{};g=a.getRequest(f,e);g.send(e.data||null);if(!e.async){a.onStateChange(g,e)}return g},parseResponseHeaders:function(l){var g,f,e,k,j,h,m={};if(l){h=l.split("\u000d\u000a");for(g=0;g<h.length;g++){j=h[g];f=j.indexOf("\u003a\u0020");if(f>0){e=j.substring(0,f);k=j.substring(f+2);m[e]=k}}}return m},onStateChange:(function(){var h="UWA_Platform_";function g(j){var l=j,k;if(d.is(l,"string")&&l.contains(h)){try{l=b.stripComments(l);l=JSON.parse(l)}catch(m){l=false}}if(l&&l.error&&String(l.error.type).startsWith(h)){k=new Error(b.format("ProxyError: {0}",l.error.message));d.merge(k,l.error);return k}}function i(n,l){var j,m,k=l.responseTypeSupport?n.responseType:l.responseType;if(l.responseTypeSupport){if(k==="text"||k===""){j=n.responseText}else{try{j=n.response}catch(o){throw new Error(b.format('InvalidResponseError: request has probably invalid "Content-type" header require by responseType "{0}" causing: "{1}".',n.responseType,o))}}if(l.fromDataRequest){m=g(j)}if(m){throw m}}else{if(l.fromDataRequest){m=g(n.responseText)}if(m){throw m}else{if(k==="text"||k===""){j=n.responseText}else{if(k==="json"){j=String(n.responseText).trim();if(j.length===0){j=null}else{j=b.stripComments(j);j=JSON.parse(j)}}else{if(k==="document"){j=n.responseXML}else{if(k==="arraybuffer"){j=(function(t){var r,s,q=new ArrayBuffer(t.length*2),p=new Uint16Array(q);for(r=0,s=t.length;r<s;r++){p[r]=t.charCodeAt(r)}return q}(n.responseText))}else{if(k==="blob"){j=new Blob([n.responseText],{type:n.getResponseHeader("Content-Type")})}}}}}}}return j}function e(j){return a.parseResponseHeaders(j.getAllResponseHeaders())}function f(k,j){if(j.cors){k.onerror=null;k.onload=null}else{k.onreadystatechange=null}}return function(m,r){var l,k,p,o;if(m.aborted){r.onCancel(m,r)}else{if(m.timedout){r.onTimeout(new Error("Request timed out after "+r.timeout+" ms"),m,r)}else{if(m.readyState===4){if(m.timeoutTimer){clearTimeout(m.timeoutTimer)}if(m.completed){return}else{m.completed=true}var j=true;if(m.status<=0){var n=c.parseUrl(c.buildUrl(window.location,r.url)).protocol;j=n!=="http"&&n!=="https"}else{if(m.status>=400){j=false}}if(j){k=e(m);try{l=i(m,r)}catch(q){p=q;if(String(q.type).startsWith(h)){k=q.headers;l=q.body}r.onFailure(q,l,k)}finally{if(!p){r.onComplete(l,k)}}}else{o=new Error(b.format('NetworkError: url "{0}" return ResponseCode with value "{1}".',r.fromDataRequest||r.url,m.status||0));k=e(m);try{l=i(m,r)}catch(q){if(String(q.type).startsWith(h)){Object.assign(o,q);k=q.headers;l=q.body}}r.onFailure(o,l,k)}f(m,r)}}}}}())};return d.namespace("Ajax",a,d)});