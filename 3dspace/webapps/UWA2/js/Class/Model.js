define("UWA/Class/Model",["UWA/Core","UWA/String","UWA/Data","UWA/Class","UWA/Class/Events","UWA/Class/Listener"],function(h,c,j,a,l,k){var d,g=0,b={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};function e(n,m){var o=m.onFailure;m.onFailure=function(p){if(o){o(n,p,m)}n.dispatchEvent("onError",[n,p,m])}}function f(){throw new Error('A "url" property or function must be specified')}function i(m){return Array.prototype.concat.apply([],Array.prototype.slice.call(m,0))}d=a.extend(l,k,{init:function(m,o){var p,n=m||{};this.cid="c"+(++g);this._attributes={};if(o){if(h.is(o.collection)){this.collection=o.collection}if(o.parse===true){n=(this.parse(m,o))||{}}}p=h.result(this,"defaults");if(h.is(p)){n=h.merge(h.clone(n,false),p)}this.set(n,o);this._changed={};this.setup.apply(this,arguments)},clone:function(){return new this.constructor(this._attributes)},setup:function(){return},sync:function(m,s,u){var r;if(!h.is(u)){u={}}var t=h.is(u.ajax,"function")?u.ajax:j.request;var p={method:b[m],type:"json",headers:{}};if(!u.url){p.url=(h.result(s,"url"))||f()}if((!h.is(u.data))&&s&&(m==="create"||m==="update"||m==="patch")){p.headers["Content-Type"]="application/json";p.data=u.attrs||(s.toJSON(u))}if(p.method!=="GET"&&h.is(p.data,"object")){p.data=JSON.stringify(p.data)}var o=u.onComplete;u.onComplete=function(x,w){var v;if(r){v=r.xhr?r.xhr.status:200}else{v=200}u.responseHeaders=w;if(o){o((m==="delete"&&(v===202||v===204))?undefined:x)}};var n=u.onFailure;u.onFailure=function(v,x,w){u.responseHeaders=w;if(n){if(!x||0===x.length){x=v.message||""}n(x)}};var q=h.extend(p,u);r=u.request=t(q.url,q);s.dispatchEvent("onRequest",[s,r,u]);return r},parse:function(m){return m},_validate:function(o,n){var m;if(!(n.validate&&this.validate)){return true}o=h.extend(h.extend({},this._attributes),o);m=this.validationError=(this.validate(o,n))||null;if(!m){return true}this.dispatchEvent("onValidationFailure",[this,m,h.extend(n,{validationError:m})]);return false},url:function(){var m;m=(h.result(this,"urlRoot"))||(h.result(this.collection,"url"))||f();if(!this.isNew()){m+=m.charAt(m.length-1)==="/"?"":"/";m+=encodeURIComponent(this.id)}return m},idAttribute:"id",set:function(w,m,A){var t,x,u,v,z,p,s,n,o,q,y,r;if(w){if(h.is(w,"object")){x=w;A=m||{}}else{x={};x[w]=m;A=A||{}}if(!this._validate(x,A)){return false}y=A.unset;r=A.silent;v=[];z=this._changing;this._changing=true;if(!z){this._previousAttributes=h.clone(this._attributes,false);this._changed={}}if(x.hasOwnProperty(this.idAttribute)){this.id=x[this.idAttribute]}s=this._attributes;n=this._previousAttributes;p=this._changed;for(t in x){m=x[t];if(!h.equals(s[t],m)){v.push(t)}if(h.equals(n[t],m)){delete p[t]}else{p[t]=m}if(y){delete s[t]}else{s[t]=m}}if(!r){if(v.length){this._pending=true}for(o=0,q=v.length;o<q;o++){u=v[o];this.dispatchEvent("onChange:"+u,[this,s[u],A])}}if(!z){if(!r){while(this._pending){this._pending=false;this.dispatchEvent("onChange",[this,A])}}this._pending=false;this._changing=false}}return true},unset:function(m,n){return this.set(m,undefined,h.extend(h.extend({},n),{unset:true}))},clear:function(n){var o,m={};n=n?h.clone(n):{};for(o in this._attributes){m[o]=undefined}return this.set(m,h.extend(n,{unset:true}))},get:function(m){return this._attributes[m]},escape:function(m){var n=this.get(m);return !h.is(n)?"":c.escapeHTML(n.toString())},has:function(m){return h.is(this.get(m))},keys:function(){return Object.keys(this._attributes)},values:function(){var p,m,o=this.keys(),n=[];for(p=0,m=o.length;p<m;p++){n.push(this.get(o[p]))}return n},pairs:function(){var p,n,m,o=this.keys(),q=[];for(p=0,n=o.length;p<n;p++){m=o[p];q.push([m,this.get(m)])}return q},toJSON:function(){return h.clone(this._attributes,false)},pick:function(){var n=this,o={},m=i(arguments);m.forEach(function(p){if(n.has(p)){o[p]=n.get(p)}});return o},omit:function(){var q,n,m,r={},p=i(arguments),o=this.keys();for(q=0,n=o.length;q<n;q++){m=o[q];if(p.indexOf(m)===-1){r[m]=this.get(m)}}return r},isNew:function(){return !h.is(this.id)},isValid:function(m){return !this.validate||!this.validate(this._attributes,m)},hasChanged:function(m){var o,n=false,p=this._changed;if(p){if(h.is(m)){n=h.owns(p,m)}else{for(o in p){if(h.owns(p,o)){n=true;break}}}}return n},changedAttributes:function(o){var p,m,n=false;if(h.is(o,"object")){p=this._changing?this._previousAttributes:this._attributes;for(m in o){if(!h.equals(p[m],o[m])){n=n||{};n[m]=o[m]}}}else{if(this.hasChanged()){n=h.clone(this._changed,false)}}return n},previous:function(m){var n=this._previousAttributes;return h.is(m)&&n?n[m]:null},previousAttributes:function(){return h.clone(this._previousAttributes,false)},save:function(s,n,u){var q,t,m,o,p,r=this;q=r._attributes;if((!h.is(s))||(h.typeOf(s))==="object"){t=s;u=n}else{t={};t[s]=n}u=h.extend({validate:true},u);if(t&&!u.wait){if(!r.set(t,u)){return false}}else{if(!r._validate(t,u)){return false}}if(t&&u.wait){r._attributes=h.extend(h.extend({},q),t)}if(u.parse===undefined){u.parse=true}o=u.onComplete;u.onComplete=function(w){var v;r._attributes=q;v=r.parse(w,u);if(u.wait){v=h.extend(t||{},v)}if(typeof v==="object"&&v!==null&&!r.set(v,u)){return false}if(o){o(r,w,u)}return r.dispatchEvent("onSync",[r,w,u])};e(this,u);m=this.isNew()?"create":u.patch?"patch":"update";if(m==="patch"){u.attrs=t}p=this.sync(m,this,u);if(t&&u.wait){r._attributes=q}return p},fetch:function(m){var o,n=this;m=m?h.clone(m,false):{};if(m.parse===undefined){m.parse=true}o=m.onComplete;m.onComplete=function(p){if(!n.set(n.parse(p,m),m)){return false}if(o){o(n,p,m)}return n.dispatchEvent("onSync",[n,p,m])};e(this,m);return this.sync("read",this,m)},destroy:function(m){var n,q,p,o=this;m=m?h.clone(m,false):{};q=m.onComplete;n=function(){return o.dispatchEvent("onDestroy",[o,o.collection,m])};m.onComplete=function(r){if(m.wait||o.isNew()){n()}if(q){q(o,r,m)}if(!o.isNew()){return o.dispatchEvent("onSync",[o,r,m])}};if(o.isNew()){m.onComplete();return false}e(o,m);p=o.sync("delete",o,m);if(!m.wait){n()}return p}});return h.namespace("Model",d,a)});