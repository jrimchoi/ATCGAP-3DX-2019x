define("UWA/Environments/WebOs",["UWA/Core","UWA/Environment","UWA/Internal/StringMap"],function(c,b,a){if(c.is(window.Mojo)){c.log=function(d){Mojo.Log.error("UWA: "+d)};c.Data.allowCrossOriginRequest=true}c.Data.useOfflineCache=true;c.extend(c.Environment.prototype,{name:"webos",init:function(d){this.name="webos";this.data=new a();if(window.PalmSystem){window.PalmSystem.setWindowOrientation("free")}this._parent(d)},onInit:function(){var d=c.extendElement(document.body),e=d.getElement.bind(d);this.html={wrapper:e(".module"),header:e(".moduleHeader"),title:e(".title"),icon:e(".icon"),refreshLink:e(".refresh"),editLink:e(".edit"),content:e(".moduleWrapper"),body:e(".moduleContent"),edit:e(".moduleEdit"),footer:e(".moduleFooter")};this.html.scroller=c.createElement("div",{id:"contentScroller"}).inject(this.html.content,"before");this.html.content.inject(this.html.scroller);this.dispatchEvent("onResize");this.html.content.addEvent("resize",this.dispatchEvent.bind(this,"onResize"));c.Element.addEvent.apply(window,["resize",this.dispatchEvent.bind(this,"onResize")])},onRegisterWidget:function(){this.html.wrapper.handleExternalLinks(this.widget.openURL.bind(this.widget))},onShowEdit:function(){this.scrollTo(0,0);this._parent()},onHideEdit:function(){this.scrollTo(0,0);this._parent()},onResize:function(){var e=this.html,g=c.Utils.Client.getSize(),f=e.content.offsetHeight,d=0;["header","footer"].forEach(function(h){d+=e[h]?e[h].offsetHeight:0});if(this.prevHeight!==g.height+f){this.prevHeight=g.height+f;if(d+f>=g.height){e.scroller.setStyle("height","auto")}else{e.scroller.setStyle("height",g.height-d+"px")}e.scroller.setStyle("min-height",g.height-d+"px");if(this.sceneController&&this.getScrollPosition().top<0&&(this.getScrollPosition().top-g.height)<(-f+d)){this.scrollTo(0,-g.height-f-d,true)}}if(this.prevWidth!==g.width){this.prevWidth=g.width;this.dispatchEvent("onResize")}else{return false}},onOpenURL:function(e){e=c.Utils.parseUrl(e);if(window.PalmServiceBridge&&!e.subprotocol){var d=new window.PalmServiceBridge();d.call("palm://com.palm.applicationManager/open",JSON.stringify({id:"com.palm.app.browser",params:{target:e.source}}));return false}},setIcon:function(d,e){if(this.html.icon){var f=this.html.icon;if(e||!d.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)){d=c.Data.proxifyUrl(d,{proxy:"icon"})}c.createElement("img",{styles:{display:"none"},events:{load:function(){f.setContent({tag:"img",src:d,width:"16",height:"16"});this.destroy()}}}).inject(document.body).setAttribute("src",d)}},scrollTo:function(d,f,e){return this.sceneController.getSceneScroller.apply(this.sceneController).mojo.scrollTo(d,f,e)},getScrollPosition:function(){return this.sceneController.getSceneScroller.apply(this.sceneController).mojo.getScrollPosition()},handleSelect:function(){var g,e,d,f=document.querySelectorAll("select");if(f){for(g=0,e=f.length;g<e;g++){d=c.extendElement(f[g]);if(!d.handleSelect){d.handleSelect=true;d.addEvent("click",this.handleSelectClick.bind(this,d))}}}},handleSelectClick:function(d){var j,e,k,h=d.childNodes,g=this.sceneController,f=[];for(j=0,e=h.length;j<e;j++){k=h[j];f.push({label:k.innerHTML,command:k.value})}g.popupSubmenu({placeNear:d,items:f,toggleCmd:d.value,onChoose:function(i){if(i!==d.value){d.value=i;if(typeof d.onchange==="function"){d.onchange.call()}}}})}})});