define("UWA/Environments/Vista",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Element","UWA/Environment","UWA/Data","UWA/Controls/Scroller","UWA/Storage/Adapter/Vista","UWA/Storage/Adapter/Object"],function(h,f,g,b,d,c,a){if(!h.is(window.System)){window.System={Fake:true,Gadget:{Flyout:{},docked:false,TransitionType:{},Settings:{read:function(){},write:function(){}},endTransition:function(){},beginTransition:function(){}}}}else{c.allowCrossOriginRequest=true}c.useOfflineCache=true;var e=d.extend({name:"vista",maxHeight:400,minHeight:100,maxWidth:351,onInit:function(){var j=document.getElementById("gadget"),i=b.getElement.bind(j);if(!i(".moduleVista")){this.buildSkeleton(j)}this.html={viewport:i(".moduleWrapper"),wrapper:i(".module"),header:i(".moduleHeader"),content:i(".moduleWrapper"),body:i(".moduleContent"),edit:i(".moduleEdit"),footer:i(".moduleFooter"),counter:i(".counter"),title:i(".title"),icon:i(".icon"),shareAction:i(".share"),refreshAction:i(".refresh"),editAction:i(".edit")};if(!this.scroller&&!System.Gadget.docked){this.scroller=new a(this.html.content,{bounce:true,lockDirection:true,momentum:true,scrollDrag:false,scrollbarH:false,scrollbar:{autoHide:false}})}System.Gadget.onUndock=System.Gadget.onDock=function(){window.location=String(window.location)}},buildSkeleton:function(k){var j=h.hosts,m=h.i18n,l=System.Gadget.docked,n=j.uwa+h.paths.img+(l?"richIcon.png":"icon.png"),i=l?48:16;if(!l){b.setContent.call(k,{tag:"div","class":"module moduleVista",html:[{tag:"div","class":"moduleHeader",html:[{tag:"a","class":"edit",text:m("Edit"),styles:{display:"none"}},{tag:"a","class":"refresh",text:m("Refresh"),styles:{display:"none"}},{tag:"span","class":"icon",html:{tag:"img",height:i,width:i,src:n}},{tag:"span","class":"counter"},{tag:"span","class":"title",text:m(document.title)}]},{tag:"div","class":"moduleScroller",html:{tag:"div","class":"moduleWrapper",html:[{tag:"div","class":"moduleEdit"},{tag:"div","class":"moduleContent",html:m("Loading...")}]}},{tag:"div","class":"moduleFooter",html:[{tag:"a","class":"powered",href:j.netvibes,text:m("Â© Netvibes")},{tag:"a","class":"share",href:j.ecosystem,text:m("Subscribe to this app")}]}]})}else{b.setStyles.call(document.body,{width:"48px",height:"48px"});b.setContent.call(k,{tag:"div","class":"module moduleVista docked",html:[{tag:"div","class":"moduleContent",styles:{display:"none"}},{tag:"div","class":"moduleWrapper",html:{tag:"div","class":"icon",html:{tag:"img",src:n,width:i,height:i}}}]})}},onShowEdit:function(){if(this.scroller){this.scroller.setPosition(0,0,0,true)}this.dispatchEvent("onResize");this._parent()},onHideEdit:function(){if(this.scroller){this.scroller.setPosition(0,0,0,true)}this.dispatchEvent("onResize");this._parent()},onResize:function(){var k,l=this,j=l.html,i=j.content.getScrolls().height;if(i>0&&i!==this.prevHeight){this.prevHeight=i;if(this.scroller){i=Math.max(Math.min(i,this.maxHeight),this.minHeight);this.scroller.setOptions({height:i,width:326});this.scroller.onRefresh();this.resize(this.maxWidth,j.wrapper.getScrolls().height)}}k=j.content.getScrolls().width;if(this.prevWidth!==k){this.prevWidth=k}else{return false}},settingsClosed:function(){if(event.closeAction===event.Action.commit){this.widget.data={};this.data={}}else{this.dispatchEvent("endEdit")}},resize:function(j,i){document.body.style.width=j;document.body.style.height=i},onUpdateIcon:function(j,k){if(this.html.icon){var m=System.Gadget.docked,l=this.html.icon,i=(m?48:16);if(m||k||!j.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)$/)){j=c.proxifyUrl(j,{proxy:m?"richIcon":"icon"})}h.createElement("img",{styles:{display:"none"},events:{load:function(){l.setContent({tag:"img",src:j,width:i,height:i});this.destroy()}}}).inject(document.body).setAttribute("src",j);return false}}});h.extend(d.prototype,e.prototype);return h.namespace("Environments/Vista",e,h)});