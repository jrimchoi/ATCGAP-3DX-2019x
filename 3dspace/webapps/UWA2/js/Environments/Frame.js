define("UWA/Environments/Frame",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Utils/InterCom","UWA/Element","UWA/Event","UWA/Environment","UWA/Controls/Scroller","UWA/Storage/Adapter/Object"],function(d,e,b,h,a,g,f,c){var i=f.extend({name:"frame",init:function(j){this._remoteQueue=[];this._parent(j)},getOption:function(k){var j=document.querySelector("body");return j.hasAttribute(k)&&j.getAttribute(k)},onInit:function(){var k=document.querySelector("body"),j=a.getElement.bind(k);if(!j(".moduleFrame")){this.buildSkeleton(k)}this.html={wrapper:j(".module"),header:j(".moduleHeader"),content:j(".moduleWrapper"),body:j(".moduleContent"),edit:j(".moduleEdit"),menus:j(".moduleHeader > menu"),footer:j(".moduleFooter"),counter:j(".counter"),title:j(".title"),icon:j(".icon"),shareAction:j(".share"),refreshAction:j(".refresh"),editAction:j(".edit")};if(!this.scroller&&Number(this.getOption("displayScroller"))){this.scroller=new c(this.html.content,{snap:false,bounce:true,momentum:true,lockDirection:true})}this.onResize()},buildSkeleton:function(k){var q=d.hosts,t=d.i18n,l=q.uwa+d.paths.img+"icon.png",j=16,m=["module moduleUwa"],o=this.getOption("chromeColor"),r=Number(this.getOption("displayHeader")),s=Number(this.getOption("displayFooter")),n=Number(this.getOption("displayEdit")),p=[];if(o){m.push(o+"-module")}if(r){p.push({tag:"div","class":"moduleHeader",html:[{tag:"span","class":"icon",html:{tag:"img",height:j,width:j,src:l}},{tag:"span","class":"counter"},{tag:"span","class":"title",text:t(document.title)||t("Loading...")},{tag:"menu",type:"toolbar","class":"menus"}]})}p.push({tag:"div","class":"moduleWrapper",html:[n&&{tag:"div","class":"moduleEdit"},{tag:"div","class":"moduleContent",html:t("Loading...")}]});if(s){p.push({tag:"div","class":"moduleFooter",html:[{tag:"a","class":"powered",href:q.netvibes,text:t("Â© Netvibes")},{tag:"a","class":"share",href:q.ecosystem,text:t("Subscribe to this app")}]})}a.setContent.call(k,{tag:"div","class":m.join(" "),html:p})},onResize:function(){var n=this,l=n.html,k=l.wrapper.getScrolls(),o=n.scroller?b.getSize():k,m=o.width,j=o.height;if(j>0&&j!==n.prevHeight){this.sendRemote("onResizeHeight",j);if(this.scroller){["header","footer"].forEach(function(p){j-=l[p]?l[p].offsetHeight:0});this.scroller.setOptions({height:j});this.scroller.onRefresh()}this.prevHeight=j}if(this.prevWidth!==m){if(b.Engine.safari){this.html.wrapper.setStyle("width",m+"px")}this.prevWidth=m}else{return false}},onRegisterWidget:function(){this._parent();this.sendRemote("onRegisterWidget");g.onDomReady(function(){this.initRemote()},this)},registerMenus:function(){if(this.widget.readOnly){return}this.widget.setMenu({name:"options",icon:"options"});this.widget.setMenu({name:"options/preferences",icon:"cogwheel",label:d.i18n("Settings"),onExecute:"onMenuExecute"});this.widget.setMenu({name:"options/refresh",icon:"refresh",label:d.i18n("Refresh"),onExecute:"onMenuExecute"});this.widget.addEvent("onMenuExecute",function(j){if(j.name==="options/preferences"){this.dispatchEvent("toggleEdit")}else{if(j.name==="options/refresh"){this.dispatchEvent("onRefresh")}}}.bind(this))},onLoad:function(){this._parent();this.sendRemote("onLoad")},onInitConfig:function(j){this._parent();this.sendRemote("onInitConfig",j)},onUpdateCounter:function(k,j){this._parent(k,j);this.sendRemote("onUpdateCounter",k,j)},onUpdateTitle:function(j){this._parent(j);this.sendRemote("onUpdateTitle",j)},onUpdateIcon:function(j){this._parent(j);this.sendRemote("onUpdateIcon",j)},onUpdateValue:function(j,k){if(this.widget){this.widget.setValue(j,k)}else{this.setData(j,k)}this.sendRemote("onUpdateValue",j,k)},onUpdatePreferences:function(j){this._parent(j);this.sendRemote("onUpdatePreferences",j)},onSearch:function(j){this._parent(j);this.sendRemote("onSearch",j)},onResetSearch:function(){this._parent();this.sendRemote("onResetSearch")},onViewRequest:function(j){this.sendRemote("onViewRequest",j)},initRemote:function(){var j,k=this,l=k.widget;if(!k.socket){k.remoteCallbacks={};j=new h.Socket(l.id+"-slave");j.subscribeServer("uwa.embedded",window.parent,l.widgetDomain);j.addListener("environmentMessage",function(o){var m=o.args,n=m.shift();k.disableRemote=n;k.dispatchEvent(n,m);k.disableRemote=false});k.socket=j;k._runRemoteQueue()}},_runRemoteQueue:function(){var l,j,k=this;if(!k.socket||k._remoteQueue.length===0){return}j=k._remoteQueue.shift();if(k.disableRemote===true||k.disableRemote===j[0]){k.log("sendRemote message ignored: "+j)}else{l={id:k.widget.id,args:j};k.log("sendRemote message: "+j);k.socket.dispatchEvent("widgetMessage",l,[l.id+"-master"])}k._runRemoteQueue()},sendRemote:function(){var j=this;j._remoteQueue.push(e.toArray(arguments));j._runRemoteQueue()}});return d.namespace("Environments/Frame",i,d)});