define("UWA/Controls/TabView",["UWA/Core","UWA/Utils/Client","UWA/Event","UWA/Element","UWA/Controls/Abstract","UWA/Controls/Carousel"],function(g,e,a,b,f,d){var c=f.extend({defaultOptions:{element:null,selectedTab:null,className:"",classNames:{tabView:"uwa-tabview",tabList:"uwa-tablist",tabPanels:"uwa-tabview-panel",tabPanel:"uwa-tab-panel",tab:"uwa-tab",selected:"selected",disabled:"disabled"},scroller:{scrollSize:1,nextButton:null,previousButton:null},tabScroller:false,tabSelector:".uwa-tab",allowReload:false,noContent:false},tabs:null,selectedTab:null,init:function(h){this._parent(h);this.tabs=[];this.selectedTab=null;this.buildContainer();this.initEvents();if(g.is(this.options.tabs,"array")){this.options.tabs.forEach(this.addTab,this);delete this.options.tabs}if(this.options.tabScroller||this.options.scroller.nextButton||this.options.scroller.previousButton){this.createScroller()}},addTab:function(i,h){var j;if(i instanceof c.Tab===false){i=new c.Tab(i)}i.setOption("classNames",this.options.classNames);if(g.is(h,"number")&&h<this.tabs.length&&h>=0){i.tabElement().inject(this.getTab(h).tabElement(),"before");this.tabs.splice(h,0,i)}else{this.elements.tabList.grab(i.tabElement());this.tabs.push(i)}if(this.elements.contentNode){j=i.contentElement();if(j){this.elements.contentNode.grab(i.contentElement())}}if(i.options.selected){this.selectTab(i)}this.onResize();this.dispatchEvent("onAddTab",[i]);return this},removeTab:function(i){var h=this.getTab(i);if(h){h.remove();this.tabs.splice(this.tabs.indexOf(h),1);this.onResize();this.dispatchEvent("onRemoveTab",[h])}return this},selectTab:function(l,i){var j,k,h=this.getTab(l);if(h){if(h!==this.selectedTab||this.options.allowReload){j=this.selectedTab;if(j){j.setSelected(false)}else{k=0}this.dispatchEvent("onPreSelectTab",[h,j,i]);this.selectedTab=h.setSelected(true);this.onResize();this.dispatchEvent("onSelectTab",[h,j,i])}this.ensureTabIsVisible(h,false,k)}},enableTab:function(j,h){var i=this.getTab(j);if(i){i.setDisabled(h===undefined?false:!h)}},getTab:function(m){var j,h,k=false;if(!g.is(m)){k=this.selectedTab}else{if(m instanceof c.Tab){k=m}else{for(j=0,h=this.tabs.length;j<h;j+=1){k=this.tabs[j];if(m&&m.nodeType&&k.tabElement()===m){break}else{if(j===m||k.getId()===m||k.getName()===m){break}}k=false}}}return k},moveTab:function(l,i){var j,k,h=(i+1>=this.tabs.length);j=this.getTab(l);k=this.tabs.indexOf(j);if(k!==i){this.tabs.splice(i,0,this.tabs.splice(k,1)[0]);if(h){j.tabElement().inject(this.getTab(i-1).tabElement(),"after")}else{j.tabElement().inject(this.getTab(i+1).tabElement(),"before")}return true}return false},selectDefaultTab:function(){var k,j,h;for(j=0,h=this.tabs.length;j<h;j+=1){k=this.tabs[j];if(k.isSelectable()){this.selectTab(k);return k}}return false},setTabContent:function(h,i){this.getTab(h).setContent(i);return this},getTabContent:function(h){return this.getTab(h).contentElement()},buildContainer:function(){if(this.options.element){this.elements.container=g.extendElement(this.options.element);delete this.options.element}else{this.elements.container=g.createElement("div")}this.elements.container.addClassName(this.options.classNames.tabView+" "+this.options.className);this.elements.tabList=g.createElement("ul",{"class":this.options.classNames.tabList}).inject(this.elements.container);if(!this.options.noContent){this.elements.contentNode=g.createElement("div",{"class":this.options.classNames.tabPanels}).inject(this.elements.container)}},initEvents:function(){this.elements.container.addEvent("click",this.handleEvent.bind(this))},handleEvent:function(i){var h=this.getTabFromEvent(i);if(h){a.preventDefault(i);if(g.is(h.handleEvent,"function")){h.handleEvent(i,this)}if(!h.isDisabled()){this.selectTab(h,i)}}},getTabFromEvent:function(i){var h=a.getElement(i).getClosest(this.options.tabSelector);return h&&this.getTab(h)},createScroller:function(){var i=this,h=i.elements.container;h.setAttribute("scrollable","true");this.scroller=this.getScroller();this.scroller.addEvent("onScrollerResize",this.onScrollerResize.bind(this))},getScroller:function(){if(!this.scroller){this.scroller=new d(this.elements.tabList,this.options.scroller)}return this.scroller},onScrollerResize:function(h){var i=this.overflow;this.overflow=this.scroller.hasOverflow();if(this.overflow&&this.selectedTab&&(h&&Math.abs(h.deltaScroll)>100)){this.ensureTabIsVisible(this.selectedTab,false,0)}if(i!==this.overflow){this.elements.container.setAttribute("overflow",String(this.overflow));this.dispatchEvent("onOverflowChange",[{overflow:this.overflow}])}},reload:function(){var h=this.selectedTab;this.selectedTab=null;this.selectTab(h)},showTabList:function(){this.elements.tabList.show()},hideTabList:function(){this.elements.tabList.hide()},isTabVisible:function(k,j){var h=false,i=this.getTab(k);if(i){h=this.scroller&&this.scroller.isItemVisible(i.tabElement(),j)}return h},ensureTabIsVisible:function(j,i,h){if(this.scroller){if(!this.isTabVisible(j,i)){this.scrollToTab(j,h)}}},scrollNext:function(){if(this.scroller){this.scroller.scrollNext()}},scrollPrevious:function(){if(this.scroller){this.scroller.scrollPrevious()}},scrollToTab:function(j,i){var h=this.getTab(j).tabElement();if(h){this.scroller.scrollToItem(h,undefined,i)}},selectTabItem:function(l,k,j,i){var h=this.getTab(l);if(h instanceof c.DropdownTab){h.items.forEach(function(m){if(m[k]===j){h.selectItem(m,this,i!==false)}},this)}return this},onResize:function(){if(this.scroller){this.scroller.onRefresh()}},onPreInject:function(){if(this.options.selectedTab===null){this.selectDefaultTab()}},onPostInject:function(){if(this.options.selectedTab!==null){this.selectTab(this.options.selectedTab)}}});c.Tab=f.extend({defaultOptions:{id:"",disabled:false,selected:false,text:"",icon:"",name:"",content:null,className:""},init:function(h){if(h&&!h.id&&h.id!==0&&!h.name){h.id=Date.now().toString(36)}this._parent(h)},getId:function(){return this.options.id},getName:function(){return this.options.name},getText:function(){return this.options.text},setIcon:function(h){if(h){if(this.elements.icon){if(this.options.icon!==h){this.options.icon=h;this.elements.icon.src=h}}else{this.elements.icon=g.createElement("img",{"class":"icon",src:h}).inject(this.tabElement().getElement(".title"),"before")}}else{if(this.elements.icon){this.elements.icon.remove()}}return this},setText:function(h){this.tabElement().getElement(".title").setText(h);return this},setDisabled:function(h){if(h===undefined){h=true}this.tabElement().toggleClassName("disabled",h);if(this.elements.content){this.elements.content.toggleClassName("disabled",h)}this.options.disabled=h;return this},setSelected:function(h){this.tabElement().toggleClassName("selected",h);if(this.elements.content){this.elements.content.toggleClassName("selected",h).toggleClassName("hidden",!h)}this.options.selected=h;return this},setContent:function(h){this.contentElement().setHTML(h);return this},isSelectable:function(){return !this.isDisabled()},isSelected:function(){return this.options.selected},isDisabled:function(){return this.options.disabled},remove:function(){this.tabElement().remove();if(this.elements.content){this.elements.content.remove()}},tabElement:function(){if(!this.elements.container){this.elements.container=this._createTabElement();if(this.options.name){this.elements.container.addClassName(this.options.name)}if(this.options.className){this.elements.container.addClassName(this.options.className)}if(this.options.icon){this.setIcon(this.options.icon)}}return this.elements.container},contentElement:function(){if(!this.elements.content){this.elements.content=this._createContentElement();if(this.elements.content){this.elements.content.addClassName("hidden "+this.options.name)}}return this.elements.content},_createTabElement:function(){var h=g.createElement("li",{"class":this.options.classNames.tab});return h.grab(this._createInnerTabElement(h))},_createInnerTabElement:function(){return g.createElement("a",{href:this.options.id?"#"+this.options.id:""}).grab(g.createElement("span",{"class":"title",text:this.options.text}))},_createContentElement:function(){var h=g.createElement("div",{id:this.options.id,html:this.options.content||g.i18n("Loading..."),"class":this.options.classNames.tabPanel});delete this.options.content;return h}});c.DropdownTab=c.Tab.extend({defaultOptions:{autohide:true,popupMenuItemSelector:".uwa-popup-menu-item",classNames:{dropdownTab:"uwa-tab-dropdown",popupMenu:"uwa-popup-menu",popupMenuItem:"uwa-popup-menu-item"}},init:function(i,h){this.items=h;this.selectedItem=h[0];this._parent(g.merge({name:String(i)},this.selectedItem))},setSelected:function(h){this._parent(h);if(this.options.autohide){this.elements.container.getElement(".dropdown").toggleClassName("hidden",!h)}return this},handleEvent:function(i,h){if(this.isSelected()){a.stop(i);this.tabView=h;this.togglePopupMenu()}},togglePopupMenu:function(){var h=this.elements.container.hasClassName("open");if(h){this.hidePopupMenu()}else{this.showPopupMenu()}return !h},showPopupMenu:function(){this.createPopupMenu();this.elements.container.addClassName("open")},hidePopupMenu:function(i){if(i){var h=g.Event.getElement(i).getClosest("."+this.options.classPopupMenu);if(h){return}}this.elements.container.removeClassName("open");if(this.elements.popupMenu){this.elements.popupMenu.destroy();delete this.elements.popupMenu}if(this.boundHidePopupMenu){b.removeEvent.apply(document.body,["click",this.boundHidePopupMenu]);delete this.boundHidePopupMenu}if(this.tabView){this.tabView=null;delete this.tabView}},createPopupMenu:function(){var m,k,j,h;if(this.elements.popupMenu){this.elements.popupMenu.remove()}this.elements.popupMenu=g.createElement("ul",{"class":this.options.classNames.popupMenu,events:{click:this.onPopupMenuItemClick.bind(this)}});for(m=0,k=this.items.length;m<k;m++){if(this.selectedItem!==this.items[m]){this._createPopupMenuItem(this.items[m]).inject(this.elements.popupMenu).setAttribute("data-index",m)}}this.elements.popupMenu.inject(this.elements.container.getParent("."+this.options.classNames.tabView)).setPosition({x:0,y:this.elements.container.getDimensions().height},{relative:this.elements.container,boundary:"auto",fit:"resize-max"});j=this.elements.popupMenu.getDimensions();h=this.elements.container.getDimensions();if(j.width<h.width){this.elements.popupMenu.setStyle("width",h.width+"px")}if(!this.boundHidePopupMenu){this.boundHidePopupMenu=this.hidePopupMenu.bind(this);b.addEvent.apply(document.body,["click",this.boundHidePopupMenu])}return this.elements.popupMenu},selectItem:function(j,i,k){if(g.is(j,"object")){if(g.is(j.handler,"function")){j.handler.call(this)}else{if(j!==this.selectedItem){var h=i||this.tabView;this.tabElement().getElement(".title").setText(j.text||"");if(j.icon){this.setIcon(j.icon)}this.previousItem=this.selectedItem;this.selectedItem=j;if(h){if(k!==false){h.selectedTab=null;h.selectTab(this)}}}}this.hidePopupMenu()}},onPopupMenuItemClick:function(j){a.stop(j);var i=g.Event.getElement(j).getClosest(this.options.popupMenuItemSelector),h,k;if(i){h=Number(i.getAttribute("data-index"));k=this.items[h];if(k){this.selectItem(k)}}},_createPopupMenuItem:function(j){var h=g.createElement("li",{"class":this.options.classNames.popupMenuItem}),i=g.createElement("a").inject(h);if(j.icon){i.grab(g.createElement("img",{src:j.icon,"class":"icon"}))}i.grab(g.createElement("span",{text:j.text}));return h},_createTabElement:function(){return this._parent().addClassName(this.options.classNames.dropdownTab)},_createInnerTabElement:function(){return g.createElement("a",{href:this.options.id?"#"+this.options.id:""}).grab(g.createElement("span",{"class":"title",text:this.options.text})).grab(g.createElement("span",{"class":"dropdown hidden"}))}});return g.namespace("Controls/TabView",c,g)});