define("UWA/Controls/SearchForm",["UWA/Core","UWA/Utils/Client","UWA/Json","UWA/Event","UWA/Class/Timed","UWA/Controls/Abstract"],function(g,e,c,b,d,f){var a=f.extend(d,{name:"uwa-searchform",defaultOptions:{searchText:"",faviconUrl:"",submitButton:"button",className:"nv-search",showCheckbox:false,showHistory:false,allowEmpty:false,dir:"ltr",limit:10},init:function(h){this.historyList=[];this._parent(h);this.buildSkeleton();if(this.options.faviconUrl){this.setFavicon(h.faviconUrl)}if(this.options.searchText){this.setSearchText(h.searchText)}},setOptions:function(h){h=h||{};if(h.searchHistory){h.showHistory=true}this._parent(h)},setInitialState:function(h,j){var i=this;i.setFavicon(h);i.setSearchText(j);i.setCheckboxState(j)},buildSkeleton:function(){var h,l,j,n=g.i18n,k=this,i=k.options,m=k.elements;h=g.createElement("div",{"class":"search "+this.getClassNames()});m.form=g.createElement("form",{events:{submit:this.dispatchAsEventListener("onSubmitByHistoryLink")}}).inject(h);m.favicon=g.createElement("img",{"class":"favicon",src:g.hosts.uwa+g.paths.css+"base/img/s.gif",width:16,height:16,styles:{display:"none"}}).inject(m.form);m.inputSearch=g.createElement("input",{"class":"search",type:"text",value:"",events:{focus:this.dispatchAsEventListener("onFocusSearch"),blur:this.dispatchAsEventListener("onBlurSearch"),click:this.dispatchAsEventListener("onClickSearch"),keypress:this.dispatchAsEventListener("onSearchKeyPress")}}).inject(m.form);m.resetButton=g.createElement("img",{"class":"clear",alt:n("Clear"),title:n("Clear"),src:g.hosts.uwa+g.paths.css+"base/img/clear.gif",events:{click:this.dispatchAsEventListener("onResetSearch")},styles:{display:"none"}}).inject(m.form);if(!i.submitButton||typeof(i.submitButton)==="string"){if(i.submitButton==="icon"){j=g.createElement("a",{"data-icon":"U","class":"uwa-icon uwa-icon-only",alt:g.i18n("Search"),events:{click:this.dispatchAsEventListener("onSubmitByHistoryLink")}})}else{j=g.createElement("input",{type:"submit",value:g.i18n("Search")})}}else{j=i.submitButton}m.form.addContent(j);m.form.lastChild.addClassName("submit");if(i.showCheckbox){m.checkbox=g.createElement("input",{"class":"check",type:"checkbox",title:i.checkboxTitle||"",value:"",events:{click:this.dispatchAsEventListener("onToggleSearch")}}).inject(m.form);if(i.dir==="rtl"){m.checkbox.setStyle("left","5px")}else{m.checkbox.setStyle("right","5px")}}k.inputSearch=m.inputSearch;k.form=m.form;this.container=h},buildHistoryBox:function(){this.hideHistory();var j=this,l=j.elements,n=l.inputSearch,h=n.getSize(),k=j.getSearchText(),m=j.historyList,i=g.createElement("ul",{"class":"uwa-popup-menu",events:{click:function(p){b.stop(p);var o=g.Event.getElement(p),q=o.getText();j.setSearchText(q);j.dispatchEvent("onSubmitByHistoryLink",[p])}}});m.forEach(function(o){if(k!==o){j.getHistoryBoxItem(o).inject(i)}});g.createElement("li",{"class":"uwa-popup-menu-item action",html:{tag:"a",text:g.i18n("Clear recent searches"),events:{click:function(o){b.stop(o);j.clearHistory()}}}}).inject(i);i.inject(l.form);i.setStyles({width:(h.width-n.getComputedSize("borderWidth"))+"px"});i.setPosition({x:0,y:h.height-n.getComputedSize("borderWidth")},{relative:n});l.historyBox=i},getHistoryBoxItem:function(h){return g.createElement("li",{"class":"uwa-popup-menu-item",html:{tag:"a",href:"#history:"+h,html:{tag:"span",text:h}}})},setFavicon:function(h,j){var i=this.elements.favicon;i.src=h;i.alt=i.title=j;i[h&&h.length?"show":"hide"]()},setSearchText:function(k){var i=this,j=i.elements,l=j.inputSearch,h=j.resetButton;l.value=k||"";h[k&&k.length?"show":"hide"]();i.addHistory(k)},getSearchText:function(){return this.elements.inputSearch.value},setCheckboxState:function(h){var i=this.elements.checkbox;if(i){if(h){i.setAttribute("checked","checked");i.defaultChecked=true}else{i.setAttribute("checked","");i.defaultChecked=false}}},getCheckboxState:function(){var h=this.elements.checkbox;return h&&h.getAttribute("checked")==="checked"},setHistoryString:function(k){var i=this,h=[];if(g.is(k,"string")){try{k=c.decode(k)||k}catch(j){}}if(g.is(k,"array")){h=k}else{if(g.is(k)){h=String(k).split(":")}}h.forEach(i.addHistory,i)},getHistoryString:function(){return c.encode(this.historyList)},addHistory:function(i){var h=this,k=h.historyList,j=k.indexOf(i);if(g.is(i,"string")&&i.length>0){if(j>-1){k.splice(j,1)}k.unshift(i);if(k.length>h.options.limit){k.pop()}h.dispatchEvent("updateHistory")}},clearHistory:function(){var h=this;h.historyList=[];h.dispatchEvent("updateHistory");h.hideHistory()},hideHistory:function(){var h=this;if(h.elements.historyBox){h.elements.historyBox.destroy()}h.elements.historyBox=null},showHistory:function(){var h=this,j=h.historyList,i=h.getSearchText();if(h.options.showHistory&&((j.length>1)||(j.length===1&&j[0]!==i))){h.buildHistoryBox()}},toggleHistory:function(){var h=this;if(h.options.showHistory){if(!h.elements.historyList){h.showHistory()}else{h.hideHistory()}}},onSubmitSearch:function(j,i){var h=this;h.hideHistory();h.setSearchText(j);h.dispatchEvent("submit",[j,i])},onSubmitByHistoryLink:function(i){b.stop(i);var j=this.getSearchText(),h="onSubmitSearch";if(j.trim().length===0&&!this.options.allowEmpty){h="onResetSearch"}this.dispatchEvent(h,[j,this.getCheckboxState()])},onResetSearch:function(){var h=this;h.hideHistory();h.setSearchText("");h.dispatchEvent("reset")},onToggleSearch:function(){this.dispatchEvent("toggle")},onFocusSearch:function(){this.dispatchEvent("focus");this.clearDelayed("onBlurSearch")},onBlurSearch:function(){if(this.options.showHistory){this.setDelayed("onBlurSearch",this.hideHistory,500,false,this)}this.dispatchEvent("blur")},onClickSearch:function(){if(this.options.showHistory){this.toggleHistory()}},onSearchKeyPress:function(){if(this.options.showHistory){this.hideHistory()}}});return g.namespace("Controls/SearchForm",a,g)});