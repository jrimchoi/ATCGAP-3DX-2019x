define("UWA/Controls/Ellipsis",["UWA/Core","UWA/Controls/Abstract"],function(c,b){var a=b.extend({defaultOptions:{reference:null,refreshOn:[],ellipsis:"&#8230;",spaces:/[\s,.:]+/g},init:function(e,d){this._parent(d);d=this.options;this.element=e;this.ellipsis=c.createElement("span",{html:this.options.ellipsis})},destroy:function(){this.ellipsis.destroy()},onRefresh:function(){var h,j,i,k,e,g=this.element,f=this.options,d=f.reference||g;if(g.offsetWidth){this.dispatchEvent("onPreRefresh");if(!this.totalWords){this.totalWords=this.computeData(g)}h=Math.floor(this.totalWords/2);j=Math.ceil(h/2)||1;g.appendChild(this.ellipsis);for(e=10;e>0;e-=1){this.setWordCount(g,h);i=d.offsetHeight+1<d.scrollHeight;if(h>=this.totalWords&&!i){g.removeChild(this.ellipsis);break}if(j===1){if(k!==undefined&&k!==i){break}k=i}h+=i?-j:j;j=Math.ceil(j/2)}if(i){this.setWordCount(g,h-1)}this.dispatchEvent("onPostRefresh")}return this},setWordCount:function(f,h){var e,m,j,l,g,d,k=h;if(f===this.ellipsis){return 0}if(f!==this.element){f.style.display=h?"":"none"}if(h||f===this.element){e=f.childNodes.length;if(!e){k=h-1}else{for(g=0;g<e;g+=1){d=f.childNodes[g];if(d.nodeType===3){j=f.ellipsisData[g].spaces;m=f.ellipsisData[g].original;l=j.length;d.data=!k?"":!l||l+1<=k?m:m.substr(0,j[k-1]||0);k-=Math.min(k,l+1)}else{if(d.nodeType===1){k-=k-this.setWordCount(d,k)}}}}}return k},computeData:function(m){var g,d,n,h,f,j,p,q,o,k=m.ellipsisData=[],e=m.childNodes,r=0;for(g=0,d=e.length;g<d;g+=1){f=e[g];if(f.nodeType===3){k[g]={original:q=f.data,spaces:p=q.match(this.options.spaces)||[]};for(n=0,h=p.length;n<h;n+=1){o=q.indexOf(p[n],n?o+j:0);j=p[n].length;p[n]=o}if(p[h-1]+j===q.length){p.pop()}if(p[0]===0){p.shift()}r+=p.length+1}else{if(f.nodeType===1){r+=this.computeData(f)}}}return r}});return c.namespace("Controls/Ellipsis",a,c)});