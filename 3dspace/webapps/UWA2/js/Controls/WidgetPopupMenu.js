define("UWA/Controls/WidgetPopupMenu",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils","UWA/Controls/DropDown"],function(f,c,a,d,e){var b=e.extend({name:"uwa-widget-popup-menu",init:function(g){this._parent();this.env=g;this.items=null},setTarget:function(g){this.target=g;return this},onClick:function(h){this._parent(h);var g=a.findElement(h,"li"),i=this.env.widget.getMenu(g.getAttribute("data-name"));if(i){this.env.dispatchEvent("onMenuExecute",[i])}},onClickOutside:function(g){if(a.getElement(g)!==this.target){this.hide()}},setPosition:function(){var g,l,i=this.env.html.moduleFrame||this.env.html.wrapper,h=c.getOffsets.call(i),m=c.getSize.call(i),j=c.getOffsets.call(this.target),k=c.getSize.call(this.target);g={x:j.x,y:j.y+k.height};l={boundary:{x:0,y:j.y+k.height,width:h.x+m.width,height:Infinity}};return this._parent(j,l)},getInnerElement:function(){this.getContent();return this.elements.inner},getContent:function(){var g=this.elements;if(!g.inner){this._parent().setContent(g.inner=f.createElement("menu",{type:"popup"}))}return g.container},setItems:function(g){this.items=g;return this},toggle:function(){this.getInnerElement().empty();this.items.forEach(this.addItem,this);this.setPosition();this._parent()},onShow:function(){this.target.addClassName("active");this._parent()},onHide:function(){this.target.removeClassName("active");this._parent()},addItem:function(j){var k,g,i,h;if(f.is(j.visible,"function")){k=j.visible()}else{k=(j.visible!==false)}if(k===false){return}g=f.createElement("li",{"class":this.getClassNames("-item"),"data-name":j.name});if(j.icon){i=f.createElement("span",{"class":"uwa-icon uwa-icon-only"});if(this._getUtf8StringLength(j.icon)===1){i.set("data-icon",j.icon);i.addClassName("uwa-icon-unicode")}else{if(d.isAbsoluteUrl(j.icon)){i.adopt(f.createElement("img",{src:j.icon,width:16,height:16}))}else{i.addClassName(j.icon)}}i.inject(g)}if(j.label){f.createElement("span",{text:j.label}).inject(g)}if(f.is(j.disabled,"function")){h=j.disabled()}else{h=!!j.disabled}if(h){g.addClassName("disabled")}return g.inject(this.getInnerElement())},_getUtf8StringLength:function(h){var g=encodeURIComponent(h).match(/%[89ABab]/g);return h.length+(g?g.length:0)}});return f.namespace("Controls/WidgetPopupMenu",b,f)});