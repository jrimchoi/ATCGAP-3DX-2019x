define("UWA/Controls/Drag",["UWA/Internal/Deprecate","UWA/Core","UWA/Class","UWA/Class/Options","UWA/Utils","UWA/Utils/Client","UWA/Element","UWA/Event"],function(i,e,a,h,g,d,b,l){var k,n=d.Features.eventCapture,f=function(){};function m(o){return o.type.startsWith("touch")}function j(p,o){var q=p.offsetParent,r;if(q&&q.nodeType===1){r=b.getOffsets.call(q);r.y+=parseInt(b.getStyle.call(q,"border-top-width"),10)||0;r.x+=parseInt(b.getStyle.call(q,"border-left-width"),10)||0}else{r={x:0,y:0}}p.setStyles({top:(o.y-r.y)+"px",left:(o.x-r.x)+"px"})}function c(q){var o,p=b.getComputedSize;while(q&&b.getStyle.call(q,"display")==="inline"){q=q.getParent()}if(q){o=b.getOffsets.call(q);o.maxX=o.x+q.offsetWidth-p.call(q,"border-right-width","padding-right");o.maxY=o.y+q.offsetHeight-p.call(q,"border-bottom-width","padding-bottom");o.x+=p.call(q,"border-left-width","padding-left");o.y+=p.call(q,"border-top-width","padding-top")}else{o={x:0,y:0,maxX:0,maxY:0}}return o}k=a.extend(h,{defaultOptions:{mouseSnap:10,mouseDelay:0,touchSnap:20,touchDelay:300,delegate:"*",document:document},init:function(q){this.setOptions(q);if(this.options.snap!==undefined){i.warn("Controls/Drag snap option","Use the mouseSnap and touchSnap options instead.");this.options.mouseSnap=this.options.touchSnap=this.options.snap}if(this.options.delay!==undefined){i.warn("Controls/Drag delay option","Use the mouseDelay and touchDelay options instead.");this.options.mouseDelay=this.options.touchDelay=this.options.delay}var r=this.onMove.bind(this);var p=this.onStop.bind(this);var o=this.onStart.bind(this);this.documentEvents={touchmove:r,mousemove:r,touchend:p,mouseup:p,touchcancel:p};this.elementEvents={touchstart:o,mousedown:o};this.attach()},setOptions:function(o){this._parent(o);o=this.options;this.root=e.extendElement(o.root||document.body);this.element=e.extendElement(o.element||this.root);this.document=o.document;if(!n){if(!this.clickDiscarder){this.clickDiscarder=e.createElement("div",{styles:{position:"absolute",height:"1px",width:"1px"}})}this.clickDiscarder.inject(this.root)}return this},destroy:function(){this.detach();if(!n){this.clickDiscarder.destroy()}},attach:function(){b.addEvents.call(this.element,this.elementEvents);return this},detach:function(){this.reset();b.removeEvents.call(this.element,this.elementEvents);return this},start:f,move:n?f:function(o){j(this.clickDiscarder,o)},snap:function(p){if(!n){j(this.clickDiscarder,p);this.clickDiscarder.show()}var o=e.Controls&&e.Controls.Scroller;o=o&&o.activeScroller;if(o){o.onScrollStop(this.currentEvent)}},stop:f,cancel:f,reset:function(){clearTimeout(this.startTimeout);if(!n){this.clickDiscarder.hide()}else{if(this.snapped){this.document.addEventListener("click",l.stopPropagation,true);setTimeout(function(){this.document.removeEventListener("click",l.stopPropagation,true)}.bind(this),300)}}this.snapped=false;this.startOrigin=this.currentDelta=this.currentEvent=this.target=null;b.removeEvents.call(this.document,this.documentEvents)},onStart:function(r){var q=l.getElement(r),p=(r.which||r.button||0)<2;if(p&&!this.target&&b.match.call(q,this.options.delegate,this.root)){this.currentEvent=r;this.target=q;this.startOrigin=l.getPosition(r);this.start(this.startOrigin);if(this.target){b.addEvents.call(this.document,this.documentEvents);var o=m(r)?this.options.touchDelay:this.options.mouseDelay;if(o){this.startTimeout=setTimeout(this.onMove.bind(this,false),o)}if(!m(r)){l.preventDefault(r)}}}},onMove:function(s){var t,q;if(!s){s=this.currentEvent;q=true}else{this.currentEvent=s;if(this.snapped){l.preventDefault(s)}}var p=l.getPosition(s);this.currentDelta=t={x:p.x-this.startOrigin.x,y:p.y-this.startOrigin.y,distance:0};t.distance=Math.sqrt(t.x*t.x+t.y*t.y);if(!this.snapped){var o=m(s)?this.options.touchSnap:this.options.mouseSnap;var r=m(s)?this.options.touchDelay:this.options.mouseDelay;if(r?q&&t.distance<=o:!o||t.distance>o){this.snapped=true;this.snap(p,t)}else{if(r){this.cancel();this.reset()}}}if(this.snapped){this.move(p,t)}},onStop:function(o){this.currentEvent=o;if(this.snapped){this.stop();l.stop(o)}else{this.cancel()}this.reset()}});k.Move=k.extend({init:function(o){this._parent(o);this.refreshCache=this.refreshCache.bind(this)},setOptions:function(o){if(o&&!o.root){o.root=o.container}return this._parent(o)},start:function(o){this._parent(o);this.context=Object.create(this);if(this.call("start")===false||this.call("fixed",this.target)===true){this.reset()}},snap:function(p,r){this._parent(p,r);var o,q=this.options;this.handles=this.call("handles")||this.target;if(q.centerHandles){j(this.handles,{x:p.x-this.handles.offsetWidth/2-r.x,y:p.y-this.handles.offsetHeight/2-r.y})}this.startPosition=b.getOffsets.call(this.handles);if(this.options.overlay){o=this.document.body||this.document;this.overlay=e.createElement("div",{styles:{position:"absolute",top:0,left:0,width:o.offsetWidth+"px",height:o.offsetHeight+"px"}}).inject(o)}this.refreshCache()},refreshCache:function(){var o=this.options;this.zones=o.zones?this.getList(o.zones):[this.root];this.positions=this.zones.map(function(s){var r=c(s);r.element=s;return r});if(o.container&&this.handles){var p=c(o.container);var q=b.getDimensions.call(this.handles);this.limit={x:[p.x,p.maxX-q.outerWidth],y:[p.y,p.maxY-q.outerHeight]}}else{this.limit={x:[-Infinity,Infinity],y:[-Infinity,Infinity]}}},reset:function(){this._parent();this.zone=null;this.startPosition=null;if(this.overlay){this.overlay.destroy();this.overlay=null}},stop:function(){this._parent();if(!this.zone||this.call("drop")===false){this.setPosition(this.startOrigin,{x:0,y:0});this.call("cancel")}this.call("stop")},move:function(o,t){this._parent(o,t);this.setPosition(o,t);var r,q,p,s;for(r=0,q=this.positions.length;r<q;r+=1){s=this.positions[r];if(s.x<=o.x&&o.x<=s.maxX&&s.y<=o.y&&o.y<=s.maxY){p=s.element}}if(this.zone!==p){if(this.zone){this.call("leave");if(this.placeholder){this.placeholder.remove();this.placeholder=null;this.refreshCache()}}this.zone=p;if(p){this.placeholder=this.call("enter");this.refreshPlaceholderCache()}}if(this.zone&&this.placeholder){this.placePlaceholder()}this.call("move")},setPosition:function(o,v){var q,s,u,p,r=this.limited={},t={};for(s=0;s<2;s+=1){u=s?"x":"y";q=this.limit[u];t[u]=this.startPosition[u]+v[u];p=0;if(q[1]<t[u]){p=q[1]-t[u];r[s?"right":"bottom"]=p}else{if(q[0]>t[u]){p=q[0]-t[u];r[s?"left":"top"]=p}}if(p){o[u]+=p;t[u]+=p;v[u]+=p}}j(this.handles,t)},getList:function(o){var q,p=e.typeOf(o);if(p==="array"){q=o}else{if(p==="function"){q=o.apply(this,Array.prototype.slice.call(arguments,1))}else{q=this.root.getElements(o)}}return q},call:function(q,o){var p=this.options[q];if(p){return g.attempt(p,0,null,this.context,o)}},refreshPlaceholderCache:function(){var s,r,o,q=(this.zone||this.root).childNodes,p=[];for(r=0,o=q.length;r<o;r+=1){s=q[r];if(s.nodeType===1&&s!==this.handles&&s!==this.placeholder&&(s.offsetHeight||s.offsetWidth)&&this.clickDiscarder!==s&&this.call("fixed",s)!==true){p[p.length]={element:s,position:b.getOffsets.call(s)}}}this.placeholderCache=p},placePlaceholder:function(){var I,D,C,s,w,z,u,q,t,F,v,G,y,A="offsetWidth",x="offsetHeight",o=this.context.handles,r=this.context.placeholder,B=this.context.limited,E=this.zone||this.root,H=this.target,p=this.placeholderCache;while(H&&H.parentNode!==E){H=H.parentNode}I=b.getOffsets.call(o);t={x:B.left?-Infinity:B.right?Infinity:I.x+o[A]/2,y:B.top?-Infinity:B.bottom?Infinity:I.y+o[x]/2};for(D=0,C=p.length;D<C;D+=1){s=p[D];I=s.position;G=y===undefined||y>I.x;if(G){v=y===undefined}else{F=true}y=I.x+s.element[A];if((G||I.x<=t.x)&&(v||I.y<=t.y)){w=D}}z=0;if(w!==undefined){s=p[w];I=s.position;if(F?I.x+s.element[A]/2>t.x:I.y+s.element[x]/2>t.y){z=w}else{z=w+1}}u=p[z]&&p[z].element;q=p[z-1]&&p[z-1].element;if(H===o||!H||(this.options.allowBesidePlaceholder||q!==H&&u!==H)){if(u?u!==r&&u.previousSibling!==r:q?q!==r&&q.nextSibling!==r:E.lastChild!==r){if(u||q){r.inject(u||q,u?"before":"after")}else{r.inject(E)}this.refreshPlaceholderCache();this.refreshCache()}}else{if(b.isInjected.call(r)){r.remove();this.refreshPlaceholderCache();this.refreshCache()}}}});return e.namespace("Controls/Drag",k,e)});