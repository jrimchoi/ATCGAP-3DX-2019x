define("UWA/Controls/Carousel",["UWA/Core","UWA/Class/Timed","UWA/Utils/Client","UWA/Event","UWA/Element","UWA/Controls/Abstract","UWA/Controls/Scroller"],function(h,d,f,b,c,g,a){var e=g.extend(d,{defaultOptions:{className:"uwa-carousel",orientation:"horizontal",scrollSize:3,scrollerOptions:{lockDirection:true,momentum:false,scrollbarH:false,scrollbarV:false,scrollDrag:f.Features.touchEvents},nextButton:null,previousButton:null,scrollButtonClassName:"uwa-carousel-button",scrollDuration:300,autoScrollPressedDelay:500,itemSelector:"li"},init:function(j,i){this._parent(i);this.element=h.extendElement(j);this.elements.container=h.createElement("div",{"class":this.options.className}).inject(this.element,"before").grab(this.element);this.initEvents();this.options.scrollerOptions.scrollableY=this.isVertical();this.options.scrollerOptions.scrollableX=!this.options.scrollerOptions.scrollableY;this.scroller=new a(j,h.merge({_root:false},this.options.scrollerOptions));this.scroller.addEvent("onMouseWheel",this.updateScrollButtonsDisabledState.bind(this));this.scroller.addEvent("onScrollEnd",this.updateScrollButtonsDisabledState.bind(this));this.scroller.addEvent("onRefresh",this.dispatchEvent.bind(this,"onRefresh"))},scrollHead:function(i){this.scrollToItem(this.element.firstChild,i)},scrollTail:function(i){this.scrollToItem(this.element.lastChild,i)},scrollNext:function(i){this.scrollTo("next",i)},scrollPrevious:function(i){this.scrollTo("previous",i)},scrollToItem:function(m,o){var k,j,i,l,n;if(this.hasDelayed("onRefresh")){this.clearDelayed("onRefresh");this.onRefreshNoDelay()}if(isNaN(o)){o=this.options.scrollDuration}if(this.element.firstChild===m){k="start"}else{if(this.element.lastChild===m){k="end"}else{j=this.getItems();i=this.getVisibleItems(true);l=j.indexOf(m);n=j.indexOf(i[0]);k=l>n?"end":"before"}}this.scroller.scrollToElement(m,k,o)},scrollTo:function(n,k,m){var l,i,j=this.getItems();k=k||this.options.scrollSize;if(isNaN(m)){m=this.options.scrollDuration}if(n==="next"){l=j.indexOf(this.getLastItemVisible())+k;i="end"}else{if(n==="previous"){l=j.indexOf(this.getFirstItemVisible())-k;i="start"}}l=Math.min(j.length-1,Math.max(0,l));this.scroller.scrollToElement(j[l],i,m);this.updateScrollButtonsDisabledState()},isItemVisible:function(j,k){var i=this.isVertical()?"y":"x";return this.scroller.isInViewport(j,k!==false,i)},getFirstItemVisible:function(){var n,m,j,k=this.getItems();for(m=0,j=k.length;m<j;m+=1){n=k[m];if(this.isItemVisible(n,false)){return n}}return null},getLastItemVisible:function(){var i=this.getVisibleItems(false);return i.length?i[i.length-1]:null},getVisibleItems:function(k){var i,j,l;return this.getItems().filter(function(m){if(l!==true){i=this.isItemVisible(m,k);l=(i===false&&j===true);j=i}else{i=false}return i},this)},nextButton:function(){if(!this.elements.nextButton){this.elements.nextButton=this._createScrollButton("next")}return this.elements.nextButton},previousButton:function(){if(!this.elements.previousButton){this.elements.previousButton=this._createScrollButton("previous")}return this.elements.previousButton},initEvents:function(){var j,k=f.Features.touchEvents,i={};i[k?"touchstart":"mousedown"]=this.onScrollButtonDown.bind(this);i[k?"touchend":"mouseup"]=this.onScrollButtonUp.bind(this);i.click=this.onScrollButtonClick.bind(this);j=this.nextButton();if(j){j.addEvents(i);j.setAttribute("data-scroll","next")}j=this.previousButton();if(j){j.addEvents(i);j.setAttribute("data-scroll","previous")}},onScrollButtonClick:function(i){if(!this.stopScroll()){var j=(i.timeStamp||Date.now());if(this.lastClickTime&&(j-this.lastClickTime<=300)){delete this.lastClickTime;this.onScrollButtonDblClick(i)}else{b.preventDefault(i);this.lastClickTime=j;this.scrollTo(this.getScrollButtonFromEvent(i).getAttribute("data-scroll"),this.options.scrollSize)}}},onScrollButtonDblClick:function(i){b.stop(i);this.scrollTo(this.getScrollButtonFromEvent(i).getAttribute("data-scroll"),this.getVisibleItems(true).length)},onScrollButtonDown:function(i){this.setDelayed("pressedTimeout",this.autoScroll.bind(this,this.getScrollButtonFromEvent(i).getAttribute("data-scroll")),this.options.autoScrollPressedDelay)},onScrollButtonUp:function(){this.stopScroll()},autoScrollNext:function(){this.autoScroll("next")},autoScrollPrevious:function(){this.autoScroll("previous")},autoScroll:function(i){this.stopScroll();this.setPeriodical("scrollTimer",function(){var j=this.scroller.getPosition(),k=this.isVertical()?"y":"x";if(i==="previous"){j[k]+=20}else{if(i==="next"){j[k]-=20}}this.scroller.setPosition(j.x,j.y,0)}.bind(this),20)},stopScroll:function(){this.clearDelayed("pressedTimeout");var i=this.hasPeriodical("scrollTimer");this.clearPeriodical("scrollTimer");if(this.scroller.dragScrolling){this.scroller.dragScrolling=false}return i},onRefresh:function(){this.setDelayed("onRefresh",this.onRefreshNoDelay.bind(this),50)},onRefreshNoDelay:function(){if(this.isInjected()){var k,i=this.isVertical()?"y":"x",j=this.scroller.maxScroll[i];if(!this.elements.container.hasAttribute("overflow")){this._updateOverflowStatus()}this._updateOverflowStatus();this.scroller.dispatchEvent("onRefresh");k=Math.abs(j)-Math.abs(this.scroller.maxScroll[i]);this.dispatchEvent("onScrollerResize",[{deltaScroll:k}]);this.updateScrollButtonsDisabledState()}},updateScrollButtonsDisabledState:function(){var k,i,l=this,m=l.elements,j=l.isVertical()?"y":"x";[m.nextButton,m.previousButton].forEach(function(o,n){if(o){k=l.scroller.isMaxPosition(j,false,n*2-1);o.toggleClassName("disabled",k);i="max-scroll-"+o.getAttribute("data-scroll");if(k){m.container.setAttribute(i,"true")}else{m.container.removeAttribute(i)}}})},hasOverflow:function(){return this.elements.container.getAttribute("overflow")==="true"},isVertical:function(){return this.options.orientation==="vertical"},getItems:function(){return this.element.getElements(this.options.itemSelector)},isInjected:function(){if(this.injected!==true){this.injected=this.elements.container&&this.elements.container.isInjected()}return this.injected},getScrollButtonFromEvent:function(i){return h.Event.getElement(i).getClosest("."+this.options.scrollButtonClassName)},_createScrollButton:function(l){var j=this.options,k=l+"Button",i=false;if(j[k]!==false){if(h.is(j[k],"function")){i=j[k](this.elements.container)}else{if(h.is(j[k],"element")){i=j[k]}else{i=h.createElement("a",{"class":j.scrollButtonClassName+" "+j.scrollButtonClassName+"-"+l}).grab(h.createElement("span")).inject(this.elements.container)}}i=h.extendElement(i)}return i},_updateOverflowStatus:function(){var i=this.isVertical()?"y":"x",j=this.scroller.hasOverflow(i);this.elements.container.setAttribute("overflow",String(j));this.scroller.setOptions({preventDefaultMouseWheel:j})}});return h.namespace("Controls/Carousel",e,h)});