define("UWA/Controls/Overlay",["UWA/Core","UWA/Event","UWA/Fx","UWA/Controls/Abstract","UWA/Class/Timed"],function(h,c,f,g,e){var d=new WeakMap();var a=new WeakMap();var b=g.extend(e,{name:"uwa-overlay",defaultOptions:{exclusive:true,exclusiveWith:function(i){return i.name===this.name},closeable:true,fxOptions:{},resizeParent:false},init:function(i){this._parent(i);this.buildSkeleton();this.fx=new f(this.elements.container,h.merge({wait:false,events:{onComplete:this.onFxComplete.bind(this)}},this.options.fxOptions))},buildSkeleton:function(){var i=this.elements.container=h.createElement("div",{"class":this.getClassNames(),styles:{display:"none",opacity:0}});d.set(i,this);if(this.options.closeable){i.addClassName("closeable").addEvent("click",function(j){if(c.getElement(j)===i){this.close()}}.bind(this))}},closeOverlays:function(i){var k=1;function j(){k-=1;if(k===0){i()}}if(this.options.exclusive){var l=this.elements.container&&this.elements.container.getParent();if(l){l.getElements(".uwa-overlay").forEach(function(n){var m=d.get(n);if(m&&this!==m&&m.isOpen()&&this.options.exclusiveWith.call(this,m)){k+=1;m.addEventOnce("onClose",j);m.close()}},this)}}j()},onFxComplete:function(){var j=this.opening,i=this.elements.container;if(!j){i.setStyle("display","none");this.resize(true)}this.dispatchEvent((j?"onOpen":"onClose"),[i]);this.opening=null},isOpen:function(){var i=this.elements.container;return i.getParent()&&i.getStyle("display")!=="none"&&this.opening!==false},open:function(){this.setPeriodical("needResize",this.resize,500);return this.toggle(true)},close:function(){this.clearPeriodical("needResize");return this.toggle(false)},toggle:function(k){var i=this.elements.container,j=this.isOpen();if(k===undefined){k=!j}else{if(k===j){return}}this.dispatchEvent((k?"onPreOpen":"onPreClose"),[i]);this.opening=k;i.setStyle("display","block");if(this.fx){this.fx.fade((k?"in":"out"))}if(k){this.closeOverlays(function(){this.resize()}.bind(this))}if(!this.fx){this.onFxComplete()}return this},resize:function(l){if(this.options.resizeParent){var k=a.get(this);var j=this.getContent();var i=j.getOffsetParent();if(k&&(!i||k!==i)){k.setStyle("height","");a["delete"](this)}if(i){if(l){i.setStyle("height","");a["delete"](this)}else{if(j.scrollHeight>i.offsetHeight){i.setStyle("height",j.scrollHeight);a.set(this,i)}}}}},onRemoved:function(){this.resize(true)},onInjected:function(){this.resize()},destroy:function(){this.resize(true);this._parent()}});return h.namespace("Controls/Overlay",b,h)});