define("UWA/Controls/ThemedScroller",["UWA/Core","UWA/Utils","UWA/Utils/Client","UWA/Controls/Abstract","UWA/Controls/Drag","UWA/Class/Timed"],function(d,g,b,e,i,f){function c(p){if(p.event){p=p.event}var n=p.changedTouches||p.touches||[p];var k={x:0,y:0};var m=n.length;var o;for(o=0;o<m;o++){k.x+=n[o].clientX/m;k.y+=n[o].clientY/m}return k}var j={delta:0,coef:1,active:false,visible:false,scrollSize:0,scrollPosition:0,offsetSize:0};var a=i.extend({defaultOptions:{touchSnap:0,touchDelay:0},init:function(k,l){this._parent(l);this.scroller=k;this.direction=this.element.className.contains("scrollbar-y")?"y":"x"},_getInfos:function(){return this.scroller._infos[this.direction]},_getPosition:function(){var k=this.element.getBoundingClientRect()[this.direction==="y"?"top":"left"];return c(this.currentEvent)[this.direction]-k},start:function(k){this._parent(k);this._getInfos().active=true;this.scroller.update();this.position=this._getPosition()},move:function(k,m){this._parent(k,m);var l=this._getInfos();l.delta=(this._getPosition()-this.position)*l.coef;l.active=true;this.scroller.updateVisible()},stop:function(){this._parent();this.scroller.updateActive(this.currentEvent)}});var h=e.extend(f,{name:"uwa-themed-scroller",options:{element:null,scrollbars:"auto",scrollbarsMargin:4,scrollbarsMinSize:50,shadows:false},init:function(k){if(d.is(k)&&d.is(k.element)){d.extendElement(k.element)}this._parent(k);this._elementEvents={mousemove:this.updateActive.bind(this),mouseout:this.updateActive.bind(this)};this.build();this.initInfos()},initInfos:function(){this._infos={x:Object.create(j),y:Object.create(j)};this.setPeriodical("update",this.update,1000);this.updateShift();this.update()},destroy:function(){if(this.options.element){var k=this.elements.container;k.removeEvents(this._elementEvents).removeClassName(this.getClassNames()).setContent(this.elements.content.childNodes);var l=k.destroy;k.destroy=function(){};this._parent();k.destroy=l}else{this._parent()}},onInjected:function(){this.initInfos()},build:function(){var k=this.options.element||d.createElement("div");k.addClassName(this.getClassNames()).addEvents(this._elementEvents);var m=this.options.scrollbars==="native"?"native-scrollbars ":"no-native-scrollbars ";var l=d.createElement("div",{"class":m+this.getClassNames("-content"),events:{scroll:this.updateVisible.bind(this)},html:k.childNodes}).inject(k);this.setDelayed("hide-overflow",function(){k.setStyle("overflow","hidden")},0);this.elements.container=k;this.elements.content=l},getInnerElement:function(){return this.elements.content},getScrollbar:function(k,l){var m=this.elements[k+"Scrollbar"];if(!m&&l){m=this.elements[k+"Scrollbar"]=d.createElement("div",{"class":this.getClassNames("-scrollbar","-scrollbar-"+k)}).inject(this.elements.container);new a(this,{element:m,root:this.elements.container});m.clientHeight}return m},getShadow:function(k,l){var m=this.elements[k+"Shadow"];if(!m&&l){m=this.elements[k+"Shadow"]=d.createElement("div",{"class":this.getClassNames("-shadow","-shadow-"+k)}).inject(this.elements.container)}return m},showShadow:function(k,l){var n=this.getShadow(k,l);var m=100;if(l){if(l>m){l=m}n.setStyle("opacity",l/m).addClassName("active")}else{if(n){n.removeClassName("active")}}},updateActive:function(n){this.updateShift();if(this.options.scrollbars!=="virtual"){return}function l(q,p,r){return q<p&&p<r}if(n.type==="mouseout"||n.type==="touchend"){this._infos.x.active=this._infos.y.active=false}else{var m=this.elements.container.getBoundingClientRect();var o=12;var k=c(n);["x","y"].forEach(function(q,r){var p=m[r?"right":"bottom"];this._infos[q].active=l(p-o,k[r?"x":"y"],p)&&l(m[r?"top":"left"],k[q],m[r?"bottom":"right"])},this)}this.updateVisible()},updateVisible:function(){this._infos.x.visible=this._infos.y.visible=true;this.setDelayed("scrollbars-visible",function(){this._infos.x.visible=this._infos.y.visible=false;this.update()},1000);this.update()},updateShift:function(){var m=this.elements.content;if(this._shift===undefined&&m.isInjected()){var l=this.options.scrollbars;if(l==="auto"){if(b.Platform.ios||(m.offsetWidth-m.clientWidth===0&&b.Engine.firefox)){l="native";m.removeClassName("no-native-scrollbars").addClassName("native-scrollbars")}else{l="virtual"}this.options.scrollbars=l}if(l==="virtual"){var k=m.offsetWidth-m.clientWidth;if(k>=0&&k<30){this._shift=k;m.setStyles({right:-this._shift,bottom:-this._shift})}}else{this._shift=0}}},_read:function(m){var l=this._infos[m?"y":"x"];var k=this.elements.content;l.scrollSize=k[m?"scrollHeight":"scrollWidth"];l.scrollPosition=k[m?"scrollTop":"scrollLeft"]+l.delta;l.offsetSize=k[m?"offsetHeight":"offsetWidth"]-(this._shift||0);if(l.scrollPosition<0){l.scrollPosition=0}else{if(l.scrollPosition>l.scrollSize-l.offsetSize){l.scrollPosition=l.scrollSize-l.offsetSize}}},_write:function(r){var n=r?"y":"x";var p=this._infos[n];var m=this.options;if(p.delta){this.elements.content[r?"scrollTop":"scrollLeft"]=p.scrollPosition;p.delta=0}if(this.options.scrollbars==="virtual"){var k=p.scrollSize>p.offsetSize;var q=this.getScrollbar(n,k);if(k&&p.scrollSize){var l=p.offsetSize-2*m.scrollbarsMargin;var o=(l*(p.offsetSize/p.scrollSize));if(o<m.scrollbarsMinSize){o=m.scrollbarsMinSize}p.coef=(p.scrollSize-p.offsetSize)/(l-o);q.style[r?"top":"left"]=(m.scrollbarsMargin+p.scrollPosition/p.coef)+"px";q.style[r?"height":"width"]=o+"px";q.toggleClassName("active",p.active).toggleClassName("visible",p.visible)}else{if(q){q.removeClassName("active").removeClassName("visible")}}}if(m.shadows){this.showShadow(n+"-start",p.scrollPosition);this.showShadow(n+"-end",p.scrollSize-p.scrollPosition-p.offsetSize)}},update:function(){this.setAnimate("update",function(){this.updateShift();this._read(false);this._read(true);if(!d.equals(this._previousInfos,this._infos)){this._write(false);this._write(true);this._previousInfos=d.clone(this._infos)}})}});return d.namespace("Controls/ThemedScroller",h,d)});