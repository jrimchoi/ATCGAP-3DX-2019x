define("DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-view",["UWA/Core","UWA/Element","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/wiki/model/wikitree-model","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/view/wikitree-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/edit/wiki-creator-view","DS/Controls/Tree","DS/Controls/TreeBase","DS/Controls/TreeNode","DS/Controls/TreeNodeBase","DS/SwymUICore/script/feature/core/error/error","DS/WebappsUtils/Console","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Spinner"],function(a,q,w,D,t,e,m,b,x,h,s,c,p,z,g,k){var y={switchToWriteView:{event:"dblclick",callback:function(){this.switchToWriteView()},view:function(E){return new q("div",{"class":"wux-tree-label",html:E.getLabel()})}},switchToReadView:{event:"blur",callback:function(){this.switchToReadView()},view:function(E){return new q("div",{"class":"wux-tree-label",html:E.getLabel()})}},nodesAreDraggable:true,cells:true};var r="#F66";var f="#77797C";var j="#3d3d3d";var n="white";var v="none";var i=1;var d=10;var A=20;var C=0;var o=2;var l={"class":"Expander",html:"",styles:{backgroundColor:"transparent",borderColor:"transparent",cursor:"pointer",zIndex:1000}};var u={"class":"NoExpander Link",text:"",styles:{backgroundColor:"transparent",borderTop:i+"px "+v+" "+r,cursor:"pointer",zIndex:1000}};var B=w.extend({_modelClass:D,_modelEvents:{onRequest:"mask",onSync:function(){this.refresh();this.unmask()},onError:"unmask",onModelUpdated:"onModelUpdated",onCurrentPageChange:"onCurrentPageChange"},_addScroller:true,_scrollerContentSelector:".wikitree-wrapper",domEvents:{"dragover .WUXTree":"_onWikiTreeDragOver"},name:"wikitree-view",treeData:null,treeEl:null,currentNode:null,currentPageId:null,globalNodeArr:null,facetView:false,on3DDPlusClicked:function(){},state:null,editable:false,creation:false,_moveOnlyCurrentNode:false,ui:{expander:{size:d,borderSize:i},icon:{size:A},shadow:false,link:{size:i,color:r,bgColor:n,style:v},label:{borderRadius:10,"font-size":"11px","font-family":"arial,tahoma,helvetica,sans-serif",color:f,"font-weight":"normal","margin-right":"5px","margin-left":"5px"},layout:{nodeMargin:20,btMargin:o,lrMargin:C},asyncState:l,noExpandState:u},_onWikiTreeDragOver:function(E){var F=E.event||E;if(F.stopPropagation){F.stopPropagation()}if(this.editable){if(F.preventDefault){F.preventDefault()}F.dataTransfer.dropEffect="move";return false}},onNodeExpand:function(G){var E=G.elements.container,F=!this._moveOnlyCurrentNode;this.changeSubNodesDraggability(E,F)},_createNode:function(I,H,E){var G,F=this;if(I&&!I.onPostExpand){I.onPostExpand=function(){var J=this;F.onNodeExpand(J)}}if(E&&(I.id===E)){G=new c(I);this.setCurrentNode(G,true)}else{G=new c(I)}if(Array.isArray(this.globalNodeArr)){this.globalNodeArr.push(G)}return G},_createTree:function(I,H,E){var G,F=this;if(I&&!I.onPostExpand){I.onPostExpand=function(){var J=this;F.onNodeExpand(J)}}G=new h({roots:[I],UI:H,isEditable:this.editable?y:false,isScrollable:false});this.setCurrentNode(G._treeRoot.getChildren()[0],true);if(Array.isArray(this.globalNodeArr)){this.globalNodeArr.push(G)}return G},toggleEdit:function(){this.editable=!this.editable;this.refresh()},init:function(E){if(a.is(E.addScroller)){this._addScroller=E.addScroller}if(E.editable){this.editable=E.editable}if(E.creation){this.creation=E.creation}if(E.moveOnlyCurrentNode){this._moveOnlyCurrentNode=E.moveOnlyCurrentNode}var G={"class":"Expander open",html:"",styles:{background:"url("+g.getWebappsBaseUrl()+"SwymUIComponents/assets/wiki/arrows.png) no-repeat -19px -2px",borderColor:"transparent",cursor:"pointer",zIndex:1000,height:"20px"}};var F={"class":"Expander closed",html:"",styles:{background:"url("+g.getWebappsBaseUrl()+"SwymUIComponents/assets/wiki/arrows.png) no-repeat -4px -2px",borderColor:"transparent",cursor:"pointer",zIndex:1000}};this.ui.expandState=F;this.ui.collapseState=G;this.globalNodeArr=[];this._parent.apply(this,arguments)},formatTree2:function(U,V,M){var R,P,F,I,K,H=0,O=0,G,W,S=U.length,E,T,Q,L;var N=[];var J=[];for(R=0;R<S;R++){P=U[R];T=parseInt(P.visibility,10);P={id:P.id,value:P.id,label:P.title,depth:P.depth,dfsLeftValue:P.dfs_left_value,dfsRightValue:P.dfs_right_value,UI:M};if(this.model.currentPage){F=this.model.currentPage.get("mid")}if(T!==1){P.icons=[g.getWebappsBaseUrl()+"SwymUIComponents/assets/wiki/privatepage.png"]}W=parseInt(P.dfsLeftValue,10);G=parseInt(P.dfsRightValue,10);Q=parseInt(P.depth,10);if(Q===0){if(V){P.children=[];J[Q]=(P)}else{N[Q]=this._createTree(P,M,F)}}else{if(Q===(L+1)){if(V){P.children=[];J[Q]=(P)}else{N[Q]=this._createNode(P,M,F)}}else{if(Q===L){if(V){I=J.pop();K=J[Q-1];K.children.push(I);P.children=[];J[Q]=(P)}else{I=N.pop();K=N[Q-1];K.addChild?K.addChild(I):K.getNthRoot(0).addChild(I);N[Q]=this._createNode(P,M,F)}}else{if(Q<L){E=L;do{E--;if(V){I=J.pop();K=J[E];K.children.push(I)}else{I=N.pop();K=N[E];K.addChild?K.addChild(I):K.getNthRoot(0).addChild(I)}}while(E>=Q);if(V){P.children=[];J[Q]=(P)}else{N[Q]=this._createNode(P,M,F)}}else{throw new Error("Error in tree traversal")}}}}O=W;H=G;L=Q}if(V){S=J.length}else{S=N.length}if(S>=2){R=S-1;while(R>0){if(V){I=J.pop();K=J[R-1];K.children.push(I)}else{I=N.pop();K=N[R-1];K.addChild?K.addChild(I):K.getNthRoot(0).addChild(I)}R--}}if(V){z.log("Tree Json Array: ",J);z.log("Tree: ",J[0]);return J}else{z.log("Tree Array: ",N);z.log("Tree: ",N[0]);return N[0]}},addChildRecursively:function(I,F){var H,E,G=new c(I);F.addChild(G);if(I.children&&Array.isArray(I.children)&&((E=I.children.length)>0)){for(H=0;H<E;H++){this.addChildRecursively(I.children[H],G)}}},_createContent:function(){var I=this,E,H=a.createElement("div",{html:new k({className:"msg-animation",visible:true,animate:true,spin:true}),styles:{"text-align":"center",height:"60px","line-height":"60px"}}),G=false,F=I.model;if(Array.isArray(I.globalNodeArr)){I.globalNodeArr=[]}if(F&&(E=F.get("tree"))){I.treeData=a.clone(E);if(I.treeData&&I.treeData.length>0){I.treeData.forEach(function(J){J.title=J.title.escapeHTML()})}if(G){I.treeData=I.formatTree2(I.treeData,G);I.treeEl=new h({roots:I.treeData,UI:I.ui,isEditable:I.editable?y:false})}else{I.treeEl=I.formatTree2(I.treeData,G,I.ui)}if(I.creation){H={"class":"creation",html:[{"class":"wikitree-editable-text",html:b.Wheredoyouwanttoaddyourpage},I.treeEl]}}else{if(I.editable){H={"class":(I._moveOnlyCurrentNode?"edition single":"edition"),html:[{"class":"wikitree-editable-text",html:(I._moveOnlyCurrentNode?m.Youcandraganddropcurrentpage:m.Reorganize)},I.treeEl]}}else{H=I.treeEl}}if(!a.Utils.Client.Engine.ie){I._expandRootNode()}else{window.requestAnimationFrame(I._expandRootNode.bind(I))}}return{"class":"wikitree-wrapper",html:H}},_expandRootNode:function(){var G=this;G.treeEl.getNthRoot(0).expand();var F,E;if(G.model.currentPage&&G.currentNode){G.expandNode(G.currentNode);if(G.currentNode.elements){if((E=G.currentNode.elements.container)){E.addClassName("current-node-wrapper")}if((F=G.currentNode.elements.label)){F.setStyle("font-weight","bold");F.setStyle("color",j);F.addClassName("current-node")}}}},onDrag:function(G){var I,E,F,H;if((this.editable===false)&&Array.isArray(this.globalNodeArr)){I=G.target||G.srcElement;I=(!I.hasClassName("Node")&&!I.hasClassName("Horizontal"))?I.getParent(".Node.Horizontal"):I;E=this.globalNodeArr.filter(function(J){if(J.elements.container.getElement(".Node.Horizontal")===I){return true}else{return false}});if(E&&(E.length>0)){F=E[0];if(F.options&&(F.options.id||(F.options.roots&&(F.options.roots.length>0)&&F.options.roots[0].id))){H={protocol:"3DXContent",version:"1.0",source:e.getMyCommunitiesAppKey(),data:{items:[{envId:e.getTenantIdFromUrlPreference(window.widget),serviceId:"3DSwym",contextId:"",objectId:F.options.id||F.options.roots[0].id,objectType:"wiki"}]}};G.dataTransfer.setData("text",JSON.stringify(H));z.log("wiki page dragData ---",H);if(window.widget){widget.dispatchEvent("ContentDragStarted",[H]);if(I){I.addEvent("dragend",function(){I.removeEvent("dragend");widget.dispatchEvent("ContentDragEnded",[H])})}}}}}},setDraggable:function(E,F){if(E&&E.setAttribute){E.setAttribute("draggable",(F===true?"true":"false"))}},changeSubNodesDraggability:function(H,E){var G=this,F=H.getElements(".Node.Horizontal");F.forEach(function(I){G.setDraggable(I,E)})},onRedraw:function(){var H=this,G,E;if(H.treeEl){G=H.treeEl.elements.container;setTimeout(function(){H.changeSubNodesDraggability(G,!H._moveOnlyCurrentNode);if(H._moveOnlyCurrentNode&&H.currentNode&&H.currentNode.elements){H.setDraggable(H.currentNode.elements.view,true)}G.addEvent("dragstart .Node.Horizontal",H.onDrag.bind(H))},0);H.treeEl.onNodeClick(function(I){if(!H.editable&&!H.creation){H.setCurrentNode(I)}else{if(H.creation){H.setCurrentNode(I,true)}}H.expandNode(I)});H.treeEl.onNodePostDrop(function(J){var K=J.from;var I=this;H.onNodePostDrop.call(H,{from:K,to:I})});if(H.currentNode&&H.currentNode.elements&&H.currentNode.elements.container){if(!a.Utils.Client.Engine.ie11){var F=H.currentNode.elements.container;F.scrollIntoView(false)}}}},onNodePostDrop:function(N){var L=N.from,P=N.to,M=L.options.dfsLeftValue,H=L.options.dfsRightValue,J=P.options.dfsLeftValue,G=P.options.dfsRightValue,Q=P.getParent().getChildren().indexOf(P),O=-1,F=null;z.log("droppedNode",L.options.label,L.options.id);z.log("refNode",P.options.label,P.options.id);z.log("refNodeIndex",Q);var I,K,E=this.treeEl.getRoots();if(E&&(E.length>0)){if(E.length===1){I=E[0];K=I.options.id;if((O=P.getParent().getChildren().indexOf(L))>=0){if(O===(Q-1)){F="above"}else{if(O===(Q+1)){F="below"}else{z.log("Dropped node is neither above nor below the reference node");z.log("Changing reference node... ");if(O===(P.getParent().getChildren().length-1)){if(O>0){P=P.getParent().getNthChild(O-1);F="below"}}else{if(O<(P.getParent().getChildren().length-1)){P=P.getParent().getNthChild(O+1);F="above"}}z.log("NEW refNode",P.options.label,P.options.id)}}}else{if(P.getChildren()&&((O=P.getChildren().indexOf(L))>=0)){F="append"}else{if((J>M)&&(G<H)){p.displayError("Apagecannotbemovedtoitsdescendant");this.refresh()}else{throw new Error("Dropped node is neither in the siblings or the children of the ref node")}}}}else{if(O===0){p.displayError("Apagecannotbeaddedabovethewikirootpage");this.refresh();return}else{p.displayError("Apagecannotbeaddedatthesamelevelofthewikirootpage");this.refresh();return}}}else{throw new Error("No root node found for this wiki tree")}z.log("droppedNodeIndex",O);z.log("dropPos",F);if((O>-1)&&(F!==null)){if((J>M)&&(G<H)){p.displayError("Apagecannotbemovedtoitsdescendant");this.refresh()}else{this.model.move({data:{id:L.options.id,relation:F,targetid:P.options.id}})}}},setCurrentNode:function(G,H){var F,E;if(!this.currentNode||this.currentNode.options){if(this.currentNode&&this.currentNode.elements){if((E=this.currentNode.elements.container)){E.removeClassName("current-node-wrapper")}if((F=this.currentNode.elements.label)){F.setStyle("font-weight","normal");F.setStyle("color",f);F.removeClassName("current-node")}}if(G){this.currentNode=G;this.currentPageId=G.options.id;z.log("Changed current node to ",G);if(this.currentNode.elements){if((E=this.currentNode.elements.container)){E.addClassName("current-node-wrapper")}if((F=this.currentNode.elements.label)){F.setStyle("font-weight","bold");F.setStyle("color",j);F.addClassName("current-node")}}if(H!==true){this.model.setCurrentPage(this.currentPageId,true)}this.dispatchEvent("currentPageChange",{id:this.currentPageId,isPrivate:(Boolean(G.options.icons)),dontSetModel:H})}}},expandNode:function(G){var F=[],E,H;while(G&&!(G.options.isRoot||G.isExpanded())){F.push(G);G=G.getParent()}E=F.length;while(E>0){H=F.pop();H.expand();E--}},searchTree:function(F,L){var G,I,J,H=false,K=F.getRoots(),E=K.length;for(I=0;I<E;I++){G=K[I];if(J=this.searchSubtree(G,L)){H=J;break}}return H},searchSubtree:function(I,K){var H,E,G,J,F=false;if(K&&I){if(I.options&&I.options.id&&I.options.id===K){F=I}else{G=I.getChildren();if(G&&((E=G.length)>0)){for(H=0;H<E;H++){J=G[H];if(F=this.searchSubtree(J,K)){break}}}}}else{throw new Error("Incorrect parameters provide to search tree")}return F},onCurrentPageChange:function(F){var G,H,E=this.treeEl;if(E&&F&&F.id&&(this.currentPageId!==F.id)){G=this.searchTree(E,F.id);if(G){this.expandNode(G);this.setCurrentNode(G,true)}else{z.log("Current page node not found")}}if(window.ds&&(window.ds.env==="3DD")&&F&&F.id){H=new t({id:F.id});this.dispatchEvent("onItemViewSelect",[null,{model:H}])}},selectItemView:function(E){z.log("in selectItemView",E);if(!this.currentPageId||(this.currentPageId!==E||(typeof E==="object"&&this.currentPageId!==E.get("mid")))){this.model.setCurrentPage(E)}},onModelUpdated:function(G,F,H){var E,I;if(G&&this.currentNode&&this.currentPageId&&this.currentPageId===G.get("mid")){if(H&&(typeof H.data==="object")){I=H.data;if(I.title!==undefined){this.onCurrentPageTitleUpdated(I.title)}if(I.visibility!==undefined){E=parseInt(I.visibility,10);this.onCurrentPageVisibilityChanged(E);this.refresh()}}}},onCurrentPageTitleUpdated:function(E){this.currentNode.setLabel(E)},onCurrentPageVisibilityChanged:function(E){var F,H,G;H=this.currentNode.getAllDescendants();F=this.currentNode.getChildren();if(H&&(H.length>0)){G=H.map(function(I){return I.options.id});this.model.updateTreeNodeVisibility(G,(E===2?0:1))}if(F&&H&&(F.length<H.length)){this.refresh()}else{this.changeNodeVisibility(this.currentNode,E);this.changeVisibilityOfDescendantNodes(this.currentNode,E)}},changeVisibilityOfDescendantNodes:function(H,F){var I,G=this,E=function(J){G.changeNodeVisibility(J,F)};if(H&&(typeof H.getAllDescendants==="function")&&H.hasChildren()){I=H.getAllDescendants();I.forEach(E)}},changeNodeVisibility:function(F,E){if(F&&F.elements){if(E===1){if(Array.isArray(F.elements.icons)&&F.elements.icons[0]){F.elements.icons[0].remove()}}else{if(Array.isArray(F.elements.icons)&&F.elements.icons[0]){F.setIcon({picture:g.getWebappsBaseUrl()+"SwymUIComponents/assets/wiki/privatepage.png"})}else{F._buildIcons({picture:g.getWebappsBaseUrl()+"SwymUIComponents/assets/wiki/privatepage.png"})}}}},getCommunityId:function(){return(this.model?this.model.get("mid"):null)}});return B});define("DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/pagination/collection/paginated-collection","DS/WebappsUtils/Console"],function(d,c,e,b){var a=c.extend({_collectionClass:e,_collectionEventsForAutoRefresh:["onAfterPageChange"],name:"paging-toolbar-view",nbPrevPagesToDisplay:3,nbNextPagesToDisplay:3,activePageNum:null,lastPageNum:null,domEvents:{"click .page":"goToPage","click .dsnext":"goToNextPage","click .dsprev":"goToPrevPage"},_createContent:function(){var w,u,g,o,q,m,v,s,f=false,h=false,k,x,p=this.collection,t=p.getCurrentPage(),y=this.nbPrevPagesToDisplay,r=this.nbNextPagesToDisplay;if(t){this.container.show();this.activePageNum=m=t;this.lastPageNum=q=p.getLastPageNum();f=p.hasPrevious();h=(q!==t);if(p.paginationMode==="PREV_NEXT"){o=m;g=m;x=false;k=false;v=false;s=false}else{o=m-y;if(o>2){s=true;x=true}else{if(o===2){s=true;x=false}else{o=1;s=false;x=false}}g=(m+r);if(g<(q-1)){v=true;k=true}else{if(g===(q-1)){v=true;k=false}else{g=q;v=false;k=false}}}if(f===false&&h===false){this.container.hide();return""}var n=[];if(f){n.push({tag:"span","class":"link dsprev",styles:{"margin-right":"3px"},html:{tag:"span",styles:{padding:"0px 3px"},html:"<"}})}if(s){n.push({tag:"span","class":"link page",page:1,html:"&nbsp;1&nbsp;"})}if(x){n.push({tag:"span",styles:{padding:"0px 10px"},html:"..."})}if(p.paginationMode==="PREV_NEXT"){n.push({tag:"span","class":"link current_page",html:"&nbsp;"+m+"&nbsp;"})}else{for(w=o,u=g;w<=u;w++){if(w===m){n.push({tag:"span","class":"link current_page",html:"&nbsp;"+w+"&nbsp;"})}else{n.push({tag:"span","class":"link page",page:w,html:"&nbsp;"+w+"&nbsp;"})}}}if(k){n.push({tag:"span",styles:{padding:"0px 10px"},html:"..."})}if(v){n.push({tag:"span","class":"link page",page:q,html:"&nbsp;"+q+"&nbsp;"})}if(h){n.push({tag:"span","class":"link dsnext",styles:{"margin-right":"3px"},html:{tag:"span",styles:{padding:"0px 3px"},html:">"}})}var l=d.createElement("div",{"class":"paging_toolbar",html:n});return l}else{this.container.hide();return""}},setup:function(f){this._parent.apply(this,arguments);this.activePageNum=1;return this},goToPage:function(g){var f=d.Event.getElement(g),h=f.getAttribute("page");if(h){this.collection.goToPage(h)}},goToPrevPage:function(){var f=this.activePageNum-1;if(f>0){this.collection.goToPage(f)}},goToNextPage:function(){var f=this.activePageNum+1;if(f<=this.lastPageNum){this.collection.goToPage(f)}}});return a});define("DS/SwymUIComponents/script/feature/core/ui-components/sortable/sortable-list-legacy-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","UWA/Controls/Drag"],function(d,a,c){var b=a.extend({name:"sortable-list-view",_expanded:true,init:function(e){this.itemView=e.itemView;this.itemClassName=e.itemClassName;this.collection=e.collection;this.onRemove=e.onRemove;this.onChange=e.onChange;this.reorderPlaceholder=e.reorderPlaceholder;this.addPlaceholder=e.addPlaceholder;this.removePlaceholder=e.removePlaceholder;this.defaultPlaceholder=e.defaultPlaceholder;this.ghostBuilder=e.ghostBuilder;this.isAllowedToDrop=e.isAllowedToDrop;this.forbiddenPlaceholder=e.forbiddenPlaceholder;this.viewAllPlaceholder=e.viewAllPlaceholder;this.limit=e.limit;return this._parent.apply(this,arguments)},appendNewItem:function(e){var f=d.createElement("div",{"class":"draggable-sortable-item thread-view community-view "+this.itemClassName,"data-content-id":e.get("mid"),"data-content-type":"community",styles:this._expanded?"":{display:"none"},html:new this.itemView({model:e})});this.container.getElement(".draggable-list").append(f);this.defaultZone.hide()},viewAllAction:function(){var e=this.container.getElementsByClassName("draggable-sortable-item"),f;for(f in e){if(e.hasOwnProperty(f)&&e[f].isHidden()){e[f].show()}}this._expanded=true;this.viewAll.hide()},removeItem:function(f){var e=this.container.querySelector('.draggable-sortable-item[data-content-id="'+f+'"]');e&&e.destroy();if(this.container.getElementsByClassName("draggable-sortable-item").length===0){this.defaultZone.show()}},isExpanded:function(){return this._expanded},_createContent:function(){var j=this,i,f,h=0,e="."+j.itemClassName,g=[{tag:"span","class":"fonticon fonticon-plus fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:j.addPlaceholder}],k=[{tag:"span","class":"fonticon fonticon fonticon-drag-drop fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:j.reorderPlaceholder}];j.defaultZone=d.createElement("div",{"class":"default-drop-zone",html:[{tag:"span","class":"fonticon fonticon-drag-drop fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:j.defaultPlaceholder}]});j.forbiddenZone=d.createElement("div",{"class":"forbidden-zone",html:[{tag:"span","class":"fonticon fonticon-block fonticon-3x"},{tag:"span","class":"drop-zone-placeholder",html:j.forbiddenPlaceholder}]});j.trashZone=d.createElement("div",{"class":"draggable-sortable-trash",html:[{tag:"span","class":"fonticon fonticon-trash fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:j.removePlaceholder}]});j.viewAll=d.createElement("div",{"class":"view-all",html:j.viewAllPlaceholder,events:{click:j.viewAllAction.bind(j)}});if(j.collection.length>0){i=[j.collection.map(function(m){var n="";if(!j.limit||j.limit&&h<j.limit){h+=1}else{n={display:"none"}}return d.createElement("div",{"class":"draggable-sortable-item thread-view community-view "+j.itemClassName,"data-content-id":m.get("mid"),"data-content-type":"community",styles:n,html:new j.itemView({model:m})})})];j.defaultZone.hide()}j._expanded=j.limit&&j.collection.length>j.limit?false:true;j.forbiddenZone.hide();i=[j.forbiddenZone,j.defaultZone,j.sortableContainer=d.createElement("div",{"class":"draggable-list",html:i}),j.trashZone,!j._expanded?j.viewAll:""];var l=function(m){f=d.createElement("div",{"class":"placeholder "+j.itemClassName,html:g});if(m.placeholder&&m.placeholder.isInjected()){f.inject(m.placeholder,"before")}else{f.inject(j.sortableContainer)}};j.isDragState=false;j.dragMoveComponent=new c.Move({container:document.body,zones:[j.sortableContainer,j.trashZone],delegate:e+", "+e+" *",centerHandles:true,handles:function(m){var n;j.isFromDraggableList=m.target.getClosest(e).hasClassName("draggable-sortable-item");j.isDragState=true;j.isAllowed=true;j.defaultZone.hide();n=j.ghostBuilder(m);n=n?n.addClassName("custom-ghost"):m.target.getClosest(e);n.addClassName("dragged");if(!j.isAllowedToDrop(n)&&!j.isFromDraggableList){j.isAllowed=false;j.container.addClassName("forbidden");j.forbiddenZone.show()}(!m.placeholder||(!m.placeholder.isInjected()&&!f.isInjected()))&&j.isAllowed&&l(m);if(j.isFromDraggableList&&j.isAllowed){setTimeout(function(){j.trashZone.setStyle("display","block");setTimeout(function(){j.trashZone.setStyle("opacity",1)},1)},1)}m.placeholder=d.createElement("div",{"class":"placeholder hover-placeholder "+j.itemClassName,html:j.isFromDraggableList?k:g});return n},fixed:function(n,m){if(m.hasClassName("draggable-sortable-trash")||m.hasClassName("default-drop-zone")){return true}return false},enter:function(m){if(j.isAllowed){if(m.zone.hasClassName("draggable-list")){f&&f.destroy();return m.placeholder}else{!m.placeholder.isInjected()&&!f.isInjected()&&l(m)}if(m.zone.hasClassName("draggable-sortable-trash")){m.zone.addClassName("hover-trash")}}},leave:function(m){if(j.isAllowed){if(m.zone.hasClassName("draggable-sortable-trash")){m.zone.removeClassName("hover-trash")}if(m.zone.hasClassName("draggable-list")){l(m)}}},drop:function(m){if(j.isAllowed){var n=0,o;if(m.zone.hasClassName("draggable-sortable-trash")){j.onRemove(m.handles);m.target.getClosest(e).destroy()}else{if(m.zone.hasClassName("draggable-list")){o=j.sortableContainer.getChildren();if(m.handles.getClosest(e).hasClassName("draggable-sortable-item")&&o.indexOf(m.handles)<o.indexOf(m.placeholder)){n=-1}j.onChange(m.handles,o.indexOf(m.placeholder)+n);m.handles.removeClassName("custom-ghost");m.handles.addClassName("draggable-sortable-item")}else{m.handles.removeClassName("draggable-sortable-item")}}}},stop:function(m){if(j.isAllowed){j.trashZone.setStyle("opacity",0);j.trashZone.removeClassName("hover-trash");j.trashZone.hide();f&&f.destroy();if(m.handles.getClosest(e)){m.handles.getClosest(e).removeClassName("dragged");m.handles.getClosest(e).setStyles({left:null,top:null});if(j.sortableContainer.getChildren().length===0&&m.placeholder.isInjected()){j.sortableContainer.grab(m.handles.getClosest(e));m.placeholder.destroy()}else{m.placeholder.isInjected()&&m.placeholder.grab(m.handles,"after").destroy()}}else{m.placeholder.destroy()}if(j.sortableContainer.getChildren().length===0){j.defaultZone.show()}}else{if(m.handles.getClosest(e)){m.handles.getClosest(e).removeClassName("dragged");m.handles.getClosest(e).setStyles({left:null,top:null})}j.container.removeClassName("forbidden");j.forbiddenZone.hide()}if(m.handles.hasClassName("custom-ghost")){m.handles.destroy()}j.isFromDraggableList=false;j.isDragState=false}});return i},destroy:function(){this.dragMoveComponent.destroy();return this._parent.apply(this,arguments)}});return b});define("DS/SwymUIComponents/script/feature/community/media/view/document-pdf-viewer",["UWA/Core","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/W3DXComponents/PDFViewer"],function(e,c,d,b){var a=d.extend({name:"document-pdf-viewer",_createContent:function(){var f=this.model,h=false,g=false,i=false;if(!this.container.getParent(".detailed-content")){h=true;i=true}g=true;if(this.model.get("media_type")==="document"&&this.model.get("play").download_original_url.format==="pdf"){this.pdfViewer=new b({url:c.getBaseUrl()+"/api/media/streammedia/id/"+this.model.get("mid")+"/type/original",pageNum:1,stickyViewer:h,fullScreen:g,forceFit:true,deactivateShortcutsOnBlur:i,requestsOptions:{authentication:"passport"},scale:90})}this._parentView._parentView.container.addClassName("pdf-container");return this.pdfViewer.render()}});return a});define("DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/macro/user-aboutme-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/UIKIT/Input/Button","DS/WebappsUtils/Console","DS/PubSub/PubSub"],function(g,f,e,b,d,a){var c=e.extend({name:" edit-view-mode-switch",className:"",_doNotReactToEditAllEvent:false,_mode:null,_readView:null,_editable:null,_editView:null,_modes:["edit","read"],_actionOnSave:null,domEvents:{"click .cancelButton":"onCancelClick","click .saveButton":"onSaveClick","click .fonticon-trash":"onDestroyClick","focusin .edit-content":"_onFocus","focusout .edit-content":"_onBlur"},_onBlur:function(){this.container.removeClassName("block-color-editall")},_onFocus:function(){this.container.addClassName("block-color-editall")},onDestroyClick:function(){this._actionOnDestroy()},onSaveClick:function(){var i=this.getControl("save-button");if(i){i.load()}var h=this._actionOnSave();if(h===false){i.load(false)}else{this._dispatchEvent(false);this.model.dispatchEvent("onSave")}},_dispatchEvent:function(h){if(this.model.collection){if(!this.model.has("mid")&&h===true){this.model.collection.remove(this.model)}}},onCancelClick:function(){if(!this.model.get("mid")){this.model.collection.remove(this.model)}else{this.model.removeChanges();var h=this.getChildView("editview");if(h){h.refresh()}this.setMode("read")}this.model.dispatchEvent("onCancel");this._dispatchEvent(true)},onIconEditClick:function(){this.setMode("edit")},_createContent:function(){var h;h=[{"class":"edit-content",html:[this.addChildView("editview",this._editView),this.addChildView("readview",this._readView)]},{"class":"actionBar edit-style",styles:{display:(this._mode==="edit")?"block":"none"},html:[this.addControl("save-button",new b({value:f.Save,className:"saveButton primary"})),this.addControl("cancel-button",new b({value:f.Cancel,className:"cancelButton default"}))]}];this.getChildView("editview").hide();return h},_addEventsOnModel:function(){this.model.addEvent("onPencilIconClicked",function(){this.onIconEditClick()}.bind(this));this.model.addEvent("onTrashIconClicked",function(){this.onDestroyClick()}.bind(this))},setup:function(h){this._addEventsOnModel();this.addEvent("onDestroy",function(){var i=c.instances.indexOf(this);if(i>-1){c.instances.splice(i,1)}}.bind(this));c.instances.push(this);a.add("editAll",function(i){if(this.isRendered()){var j=this.getElement(".actionBar");if(i===true&&this._doNotReactToEditAllEvent===false){this.setMode("edit");if(j){j.hide()}}else{if(i===false){this.setMode("read")}}}}.bind(this),null,true);return this._parent.apply(this,arguments)},init:function(h){try{h=h||{};if(h.editView){this._editView=h.editView}else{throw new Error("editview undefined")}if(h.readView){this._readView=h.readView}else{throw new Error("readView undefined")}if(h.doNotReactToEditAllEvent){this._doNotReactToEditAllEvent=h.doNotReactToEditAllEvent}if(h.actionOnSave){this._actionOnSave=h.actionOnSave}else{throw new Error("actionOnSave undefined")}this._editable=h.editable?true:false;if(h.actionOnDestroy){this._actionOnDestroy=h.actionOnDestroy}this._mode=this.isModeValid(h.mode)?h.mode:"read";return this._parent.apply(this,arguments)}catch(i){d.error("Error initializing view mode switch: "+i.message);return false}},isModeValid:function(h){if(h&&this._modes.indexOf(h)>-1){return true}return false},getMode:function(){return this._mode},setMode:function(k){this._mode=k;var m=this.container?this.getElement(".edit-content"):"";if(k==="edit"){this._parentView.container.addClassName("edition");if(m){m.addClassName("edit-style")}if(this.getChildView("editview")){if(c.editAllActivated===true&&this.model.collection){var l=this.getChildView("editview"),j=g.createElement("div",{"class":"user-edit-all-delete-button",html:this.addControl("button-delete",new b({value:f.Delete,events:{onClick:function(){this.onDestroyClick()}.bind(this)}}))});l.addEvent("onLanguageRefresh",function(){j.inject(l.container,"after")});j.inject(l.container,"after")}this.getChildView("editview").show();this.getChildView("readview").hide()}if(c.editAllActivated===false){this.getElement(".actionBar").setStyle("display","block")}var h=this.getElement(".fonticon-pencil");if(h){h.setStyle("visibility","hidden")}this.dispatchEvent("onEdit")}else{if(k==="read"){var i=this.getControl("save-button");if(i&&i.previousValue){i.load(false)}this._parentView.container.removeClassName("edition");if(m){m.removeClassName("edit-style")}this.getChildView("readview").show();this.getChildView("editview").hide();this.getElement(".actionBar").setStyle("display","none");var h=this.getElement(".fonticon-pencil");if(h){h.setStyle("visibility","visible")}this.dispatchEvent("onRead")}else{throw new Error("mode undefined")}}}});c.editAllActivated=false;c.instances=[];a.add("editAll",function(h){c.editAllActivated=h},null,true);return c});define("DS/SwymUIComponents/script/lib/ckeditor/customlink/dialogs/customlink",["i18n!DS/SwymUIComponents/assets/nls/lib/ckeditor/customlink/customlink","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/config/bootstrap-model"],function(c,b,a){CKEDITOR.dialog.add("customlinkDialog",function(d){return{title:c.LinkProperties,minWidth:400,minHeight:100,resizable:false,contents:[{id:"linkBuilder",elements:[{type:"text",id:"desc",label:c.Description},{type:"text",id:"url",label:c.URL}]}],onOk:function(){var e=this,j={},h=d.document.createElement("a"),k=false,i,g,l;j={desc:e.getValueOf("linkBuilder","desc").trim(),url:e.getValueOf("linkBuilder","url").trim()},currentTenant=a.getInstance().get("config").tenant.online_instance_id,urlTenant=null;if(j.url.match(/.*contentId=(.*?)(&|$)/)){k=true;i=j.url.match(/.*contentId=(.*?)(&|$)/);i=i&&i.hasOwnProperty(1)?i[1]:null;l=j.url.match(/.*community=(.*?)(&|$)/);l=l&&l.hasOwnProperty(1)?l[1]:null;g=j.url.match(/.*contentType=(.*?)(&|$)/);g=g&&g.hasOwnProperty(1)?g[1]:null}else{if(j.url.match(/.*community:.*?\/.*:(.*)$/)){urlTenant=j.url.match(/(ftp|http|https):\/\/.*-/)[0].split("-")[0].split("://")[1];if(urlTenant.toLowerCase()===currentTenant.toLowerCase()){k=true;i=j.url.match(/.*community:.*?\/.*:(.*)$/);i=i&&i.hasOwnProperty(1)?i[1]:null;l=j.url.match(/.*community:(.*?)(\/|$)/);l=l&&l.hasOwnProperty(1)?l[1]:null;g=j.url.match(/.*community:.*?\/(.*):/);g=g&&g.hasOwnProperty(1)?g[1]:null}}}if(!k){var f=new RegExp(/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/);if(!f.test(j.url)){alert(c.PleasecheckyourURL);return false}}if(!j.desc){alert(c.Thedescriptionfieldcannotbeempty);return false}if(!j.url){alert(c.TheURLfieldcannotbeempty);return false}if(!i&&!g){g="community";i=l;l=null}if(k){g&&h.setAttribute("data-content-type",g);h.setHtml(j.desc);i&&h.setAttribute("data-content-id",i);l&&h.setAttribute("data-community-id",l);h.setAttribute("target","_self");h.setAttribute("data-type","internal");h.setAttribute("href","#")}else{h.setHtml(j.desc);h.setAttribute("href",j.url);h.setAttribute("data-type","external")}if(d.customLink){d.customLink.outerHTML=h.$.outerHTML}else{d.insertElement(h)}},onCancel:function(e){if(e&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("hide")&&e.data.hide){this.hide()}},onShow:function(){var h=this.getParentEditor(),g=h.getSelection(),f=null,i=CKEDITOR.plugins.link,j;if((f=i.getSelectedLink(h))&&f.getName()==="a"){if(!g.getSelectedElement()){g.selectElement(f)}}else{if(h.customLink){f=h.customLink}else{if(g.getStartElement()&&g.getStartElement().getName()==="a"){f=g.getStartElement()}else{f=null}}}if(f){if(f.getHtml){j=f.getHtml()}else{j=f.getHTML();if(j===""){j=f.outerHTML}}if(h.customLink){this.setValueOf("linkBuilder","desc",j)}if(f.hasAttribute("data-content-id")){var e=b.get3DDTransientAppUrl({appId:b.getMyCommunitiesAppKey(),contentId:f.getAttribute("data-content-id"),community:f.getAttribute("data-community-id"),contentType:f.getAttribute("data-content-type")});this.setValueOf("linkBuilder","url",e);this.setValueOf("linkBuilder","desc",j)}else{this.setValueOf("linkBuilder","desc",j||f.getAttribute("href"));this.setValueOf("linkBuilder","url",f.getAttribute("url")||f.getAttribute("href"))}}else{if(g.getSelectedText()){this.setValueOf("linkBuilder","desc",g.getSelectedText())}}},onHide:function(){var e=this.getParentEditor();if(e.customLink){delete e.customLink;this.getContentElement("linkBuilder","desc").getElement().show();this.getContentElement("linkBuilder","desc").getElement().show()}}}})});define("DS/SwymUIComponents/script/feature/core/education/view/education-edit-view",["i18n!DS/SwymUIComponents/assets/nls/feature/core/education/view/education-edit-view","DS/SwymUICore/script/feature/core/education/model/education-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Form"],function(c,e,d,b){var a=d.extend({_modelClass:e,name:"experience-edit-view",_createContent:function(){var g=this.model,k=this,j=new Date().getTimezoneOffset(),i=this._getValueToNeutralizeDate("date_begin"),f=this._getValueToNeutralizeDate("date_end"),h=this.addControl("form-aboutme",new b({fields:[{type:"text",label:c.degree,placeholder:c.enterIndustry,value:g.get("degree",{escapeHTML:false})||"",events:{onChange:function(){g.addChanges("degree",this.getValue())}}},{type:"text",label:c.field,required:true,value:g.get("field_of_study",{escapeHTML:false}),events:{onChange:function(){g.addChanges("field_of_study",this.getValue())}}},{type:"text",label:c.institution,required:true,value:g.get("school_name",{escapeHTML:false}),events:{onChange:function(){g.addChanges("school_name",this.getValue())}}},{type:"text",label:c.location,placeholder:c.wheredidyouwork,value:g.get("place",{escapeHTML:false}),events:{onChange:function(){g.addChanges("place",this.getValue())}}},{type:"date",name:"dateBegin",label:c.from,max:new Date(),yearRange:50,placeholder:c.selectADate,required:true,renderTo:window.document.body.getElement(".user-app-view-container"),value:i,events:{onChange:function(){var m=new Date(this.getDate()),l=new Date(m.getTime()-j*60000);g.addChanges("date_begin",l)}}},{type:"date",name:"dateEnd",disabled:g.get("not_finished")==="1",label:c.to,placeholder:c.selectADate,required:true,renderTo:window.document.body.getElement(".user-app-view-container"),yearRange:50,value:(g.get("not_finished")==="1")?i:f,events:{onChange:function(){var m=new Date(this.getDate()),l=new Date(m.getTime()-j*60000);g.addChanges("date_end",l)}}},{type:"checkbox",label:c.Icurrently,checked:g.get("not_finished")==="1",events:{onChange:function(){var l=k.getControl("form-aboutme").dates[1];if(this.isChecked()){l.disable();g.addChanges("date_end",null)}else{l.enable();g.addChanges("date_end",new Date(k.getControl("form-aboutme").getField("dateBegin").value))}var m=this.isChecked()?"1":"0";g.addChanges("not_finished",m)}}},{type:"textarea",label:c.description,rows:5,placeholder:c.describeyourposition,value:g.get("description",{escapeHTML:false})||"",events:{onChange:function(){g.addChanges("description",this.getValue())}}}]}));return h},_getValueToNeutralizeDate:function(g){var i=this.model.get(g,{escapeHTML:false}),f=new Date(i),h=i?new Date(f.getTime()+new Date().getTimezoneOffset()*60000):"";return h}});return a});define("DS/SwymUIComponents/script/feature/core/network/view/activity-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/network/model/activity-model","DS/WebappsUtils/Console"],function(e,d,b,a){var c=d.extend({_modelClass:b,name:"activity-view",domEvents:{},_createContent:function(){try{if(this.model){var f=this.model.get("feed_text",{escapeHTML:false});if(window.ds&&(ds.env==="3DD")){f=f.split("<a").join("<i").split("</a>").join("</i>")}return e.createElement("div",{html:f})}else{throw new Error("Model does not exist")}}catch(g){a.error(g.message)}}});return c});define("DS/SwymUIComponents/script/feature/core/user/view/mail/user-mail-read-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/WebappsUtils/Console","DS/UIKIT/Input/Button"],function(f,e,d,c,b){var a=e.extend({_modelEventsForAutoRefresh:["onChange"],_modelClass:d,domEvents:{"click a":"_onClickLink"},_onClickLink:function(){window.location.href="mailto:"+this.model.get("email")},name:"user-mail-read-view",_createContent:function(){return f.createElement("a",{html:this.model.get("email")})}});return a});define("DS/SwymUIComponents/script/feature/core/auto-save/view/auto-save-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/auto-save/model/auto-save-model","DS/UWPClientCode/PublicAPI","DS/UIKIT/Tooltip","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/core/auto-save/view/auto-save-view"],function(g,f,c,a,i,h,e){var b=a.getApplicationConfiguration("app.swymfeature.autoSaveFrequency"),d=f.extend({name:"auto-save",_isRunning:false,_frequency:b?parseInt(b):30,_lastContentSaved:"",_currentContent:"",_autoSaveModel:null,_floppyIcon:null,_leavingSecurityOn:false,_createContent:function(){this._floppyIcon=g.createElement("span",{"class":"auto-save fonticon fonticon-refresh",styles:{cursor:"default"}});this._setTooltip(e.TheContentIsStoredForALaterRecovery);return this._floppyIcon},_setTooltip:function(j){var k=this.getControl("floppyTooltip");if(!k){this.addControl("floppyTooltip",new i({target:this._floppyIcon,body:j}))}else{k.setBody(j)}},init:function(){return this._parent.apply(this,arguments)},setup:function(){return this._parent.apply(this,arguments)},clear:function(){this._lastContentSaved="";this._currentContent="";this._removeAutoSave();this.updateIconStatus("reset")},updateIconStatus:function(k){var j,l={saved:"#57B847",unsaved:"#f4f5f6",reset:"#f4f5f6",error:"#EA4F37"};if(this.isDestroyed()){return}j=this.getElement(".auto-save");if(j){if(this._currentContent.content_type!=="message"&&this._currentContent.content_type!=="media"&&(!j.hasClassName("error")||j.hasClassName("error")&&k==="saved")){j.removeClassName("saved");j.removeClassName("unsaved");j.removeClassName("error");switch(k){case"saved":j.addClassName(k);j.removeClassName("fonticon-refresh");j.addClassName("fonticon-check");this.container.show();this._setTooltip(e.TheContentIsStoredForALaterRecovery);break;case"unsaved":j.addClassName(k);j.removeClassName("fonticon-check");j.addClassName("fonticon-refresh");this.container.show();break;case"error":j.addClassName(k);j.removeClassName("fonticon-check");j.addClassName("fonticon-refresh");this.container.show();this._setTooltip(e.TheContentCouldNotBeStoredForALaterRecovery);break;default:this.container.hide();break}this.container.setStyle("background-color",l[k])}else{if(!j.hasClassName("error")||k==="reset"){this.container.hide();j.removeClassName("error")}}}},onContentChanged:function(j){this._getCurrentContent(j);this.updateIconStatus("unsaved");if(!this._isRunning&&!h.compareObjects(this._currentContent,this._lastContentSaved)){this._startAutoSave()}},_startAutoSave:function(){var j=this;if(!this._isRunning){this._isRunning=true;setTimeout(function(){if(j._currentContent!==j._lastContentSaved&&j._currentContent.content_type!=="message"&&j._currentContent.content_type!=="media"){j._performAutoSave()}else{j._isRunning=false}},this._frequency*1000)}},_performAutoSave:function(){this._lastContentSaved=this._currentContent;this._setAutoSave();this._isRunning=false},destroy:function(){this._parent.apply(this,arguments)},_getCurrentContent:function(k){var l=k.getBodyAttributes(),j=null;if(l.hasOwnProperty("content")){j=l.content;delete l.content}this._currentContent={content_type:k.getCurrentContentType(),community_id:k.getSelectedCommunityID(),content_id:k.model?k.model.get("mid"):null,content_title:k._titleContent,content_message:j,content_options:{}};g.extend(this._currentContent.content_options,l)},_setAutoSave:function(){var j=this._lastContentSaved,l=this,k={onComplete:function(){l.updateIconStatus("saved")},onFailure:function(){l.updateIconStatus("error")}};j.content_options=JSON.stringify(j.content_options);if(!this._autoSaveModel){this._autoSaveModel=c.getInstance()}this._autoSaveModel.addChanges(j);this._autoSaveModel.save({},k)},_removeAutoSave:function(){this._autoSaveModel=c.getInstance();if(this._autoSaveModel){c.deleteInstance();this._autoSaveModel=null}}});return d});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-view",["UWA/Core","UWA/Class/View","DS/UIKIT/DropdownMenu"],function(d,c,b){var a=c.extend({className:"rich-link-preview",domEvents:{"click .preview-close":"_deletePreview","click .preview-domain-link":"_redirectTo","click .preview-container":"_redirectTo"},_redirectTo:function(e){if(e.target.className.includes("preview-domain-link")){window.open("https://www."+this.model.get("domain"));return null}if(e.target.className.includes("preview-close")||e.target.className.includes("preview-toggle")){e.stopPropagation();return null}else{e.stopPropagation();window.open(this.model.get("url"))}},_deletePreview:function(e){e.stopPropagation();this.destroy()},formatTitle:function(f){var e;if(f.length>60){e=f.replace(/^(.{60}[^\s]*).*/,"$1");e=e.concat("...")}if(e.length>120){e=e.replace(/^(.{120}[\s]*).*/,"$1");e=e.concat("...")}return f},createDeleteIcon:function(){return d.createElement("span",{"class":"preview-close fonticon fonticon-wrong"})},createPreferencesMenu:function(g){var i=this;var h=d.createElement("span",{"class":"preview-toggle fonticon fonticon-chevron-down",html:"&nbsp;"});var e=[];if(g.get("image")!="null"){e.push({name:"Toggle image",text:"Toggle image",fonticon:"picture"})}if(g.get("description")!=""){e.push({name:"Toggle description",text:"Toggle description",fonticon:"text"})}if(e.length===0){return""}var f=new b({items:e,events:{onClick:function(m,k){if(k.name==="Toggle image"){var j=i.container.getElement(".preview-thumbnail");if(j.getStyle("width")==="0px"){j.setStyle("width","100%");j.classList.add("preview-thumbnail-visible");j.classList.remove("preview-thumbnail-hidden")}else{j.setStyle("width","0px");j.classList.add("preview-thumbnail-hidden");j.classList.remove("preview-thumbnail-visible")}}else{var l=i.container.getElement(".preview-description");if(l.getStyle("display")==="none"){l.setStyle("display","");l.classList.add("preview-desc-is-visible");l.classList.remove("preview-desc-is-hidden")}else{l.setStyle("display","none");l.classList.add("preview-desc-is-hidden");l.classList.remove("preview-desc-is-visible")}}m.stopPropagation()}},renderTo:i.container.getElement(".scroll-content"),target:h});return h},render:function(){return""},destroy:function(){this.stopListening();this.model=null;this._parent()}});return a});define("DS/SwymUIComponents/script/lib/ckeditor/customtable/dialogs/customtable",["i18n!DS/SwymUIComponents/assets/nls/lib/ckeditor/customtable/customtable"],function(e){var d=CKEDITOR.tools.cssLength,b=function(f){var g=this.id;if(!f.info){f.info={}}f.info[g]=this.getValue()},a=function(n){var k=0,h=0;for(var g=0,o,p=n.$.rows.length;g<p;g++){o=n.$.rows[g],k=0;for(var f=0,l,m=o.cells.length;f<m;f++){l=o.cells[f];k+=l.colSpan}k>h&&(h=k)}return h},c=function(f){return function(){var h=this.getValue(),g=!!(CKEDITOR.dialog.validate.integer()(h)&&h>0);if(!g){alert(f);this.select()}return g}};CKEDITOR.dialog.add("customtableDialog",function(h){var g=h.editable(),i=h.plugins.dialogadvtab,f=function(j){return new CKEDITOR.dom.element(j,h.document)};return{title:e.TableProperties,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,resizable:false,onLoad:function(){var j=this;var k=j.getContentElement("advanced","advStyles");if(k){k.on("change",function(){var n=this.getStyle("width",""),o=j.getContentElement("info","txtWidth");o&&o.setValue(n,true);var l=this.getStyle("height",""),m=j.getContentElement("info","txtHeight");m&&m.setValue(l,true)})}},onShow:function(){var p=h.getSelection(),l=p.getRanges(),q;var k=this.getContentElement("info","txtRows"),n=this.getContentElement("info","txtCols"),m=this.getContentElement("info","txtWidth"),j=this.getContentElement("info","txtHeight");var o=p.getSelectedElement();if(o&&o.is("table")){q=o}else{if(l.length>0){if(CKEDITOR.env.webkit){l[0].shrink(CKEDITOR.NODE_ELEMENT)}q=h.elementPath(l[0].getCommonAncestor(true)).contains("table",1)}}this._.selectedElement=q;if(q){this.setupContent(q);k&&k.disable();n&&n.disable()}else{k&&k.enable();n&&n.enable()}m&&m.onChange();j&&j.onChange()},onCancel:function(){this.hide()},onOk:function(){var C=h.getSelection(),z=this._.selectedElement&&C.createBookmarks();wrapper=f("div");wrapper.setAttribute("class","responsive-table");var x=this._.selectedElement||wrapper.append(f("table")),B={};this.commitContent(B,x);if(B.info){var y=B.info;if(!this._.selectedElement){var k=x.append(f("tbody")),r=parseInt(y.txtRows,10)||0,s=parseInt(y.txtCols,10)||0;for(var v=0;v<r;v++){var q=k.append(f("tr"));for(var u=0;u<s;u++){var l=q.append(f("td"));l.appendBogus()}}}var o=y.selHeaders;if(!x.$.tHead&&(o=="row"||o=="both")){var w=x.getElementsByTag("thead").getItem(0);k=x.getElementsByTag("tbody").getItem(0);var n=k.getElementsByTag("tr").getItem(0);if(!w){w=new CKEDITOR.dom.element("thead");w.insertBefore(k)}for(v=0;v<n.getChildCount();v++){var p=n.getChild(v);if(p.type==CKEDITOR.NODE_ELEMENT&&!p.data("cke-bookmark")){p.renameNode("th");p.setAttribute("scope","col")}}w.append(n.remove())}if(x.$.tHead!==null&&!(o=="row"||o=="both")){w=new CKEDITOR.dom.element(x.$.tHead);k=x.getElementsByTag("tbody").getItem(0);var m=k.getFirst();while(w.getChildCount()>0){n=w.getFirst();for(v=0;v<n.getChildCount();v++){var t=n.getChild(v);if(t.type==CKEDITOR.NODE_ELEMENT){t.renameNode("td");t.removeAttribute("scope")}}n.insertBefore(m)}w.remove()}if(!this.hasColumnHeaders&&(o=="col"||o=="both")){for(q=0;q<x.$.rows.length;q++){t=new CKEDITOR.dom.element(x.$.rows[q].cells[0]);t.renameNode("th");t.setAttribute("scope","row")}}if((this.hasColumnHeaders)&&!(o=="col"||o=="both")){for(v=0;v<x.$.rows.length;v++){q=new CKEDITOR.dom.element(x.$.rows[v]);if(q.getParent().getName()=="tbody"){t=new CKEDITOR.dom.element(q.$.cells[0]);t.renameNode("td");t.removeAttribute("scope")}}}y.txtHeight?x.setStyle("height",y.txtHeight):x.removeStyle("height");y.txtWidth?x.setStyle("width",y.txtWidth):x.removeStyle("width");if(!x.getAttribute("style")){x.removeAttribute("style")}}if(!this._.selectedElement){h.insertElement(wrapper);setTimeout(function(){var D=new CKEDITOR.dom.element(x.$.rows[0].cells[0]);var j=h.createRange();j.moveToPosition(D,CKEDITOR.POSITION_AFTER_START);j.select()},0)}else{try{C.selectBookmarks(z)}catch(A){}}},contents:[{id:"info",label:e.TableProperties,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:e.Rows,required:true,controlStyle:"width:5em",validate:c(h.lang.table.invalidRows),setup:function(j){this.setValue(j.$.rows.length)},commit:b},{type:"text",id:"txtCols","default":2,label:e.Columns,required:true,controlStyle:"width:5em",validate:c(h.lang.table.invalidCols),setup:function(j){this.setValue(a(j))},commit:b},{type:"select",id:"selHeaders",requiredContent:"th","default":"",label:e.Headers,items:[[e.None,""],[e.FirstRow,"row"],[e.FirstColumn,"col"],[e.Both,"both"]],setup:function(k){var l=this.getDialog();l.hasColumnHeaders=true;for(var m=0;m<k.$.rows.length;m++){var j=k.$.rows[m].cells[0];if(j&&j.nodeName.toLowerCase()!="th"){l.hasColumnHeaders=false;break}}if((k.$.tHead!==null)){this.setValue(l.hasColumnHeaders?"both":"row")}else{this.setValue(l.hasColumnHeaders?"col":"")}},commit:b},{id:"cmbAlign",type:"select",requiredContent:"table[align]","default":"",label:e.Alignment,items:[[e.NotSet,""],[e.Left,"left"],[e.Center,"center"],[e.Right,"right"]],setup:function(j){this.setValue(j.getAttribute("align")||"")},commit:function(k,j){if(this.getValue()){j.setAttribute("align",this.getValue())}else{j.removeAttribute("align")}}},{id:"caption",type:"text","default":"",label:e.Caption,setup:function(j){if(j.$.caption){this.setValue(j.$.createCaption().innerHTML)}},commit:function(l,j){if(this.getValue()){var k=j.$.createCaption();k.innerHTML=this.getValue()}else{j.$.deleteCaption()}}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",requiredContent:"table{width}",controlStyle:"width:5em",label:e.Width,title:h.lang.common.cssLengthTooltip,"default":h.filter.check("table{width}")?(g.getSize("width")<500?"100%":500):0,getValue:d,validate:CKEDITOR.dialog.validate.cssLength(h.lang.common.invalidCssLength.replace("%1",h.lang.common.width)),onChange:function(){var j=this.getDialog().getContentElement("advanced","advStyles");j&&j.updateStyle("width",this.getValue())},setup:function(j){var k=j.getStyle("width");this.setValue(k)},commit:b}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",requiredContent:"table{height}",controlStyle:"width:5em",label:e.Height,title:h.lang.common.cssLengthTooltip,"default":"",getValue:d,validate:CKEDITOR.dialog.validate.cssLength(h.lang.common.invalidCssLength.replace("%1",h.lang.common.height)),onChange:function(){var j=this.getDialog().getContentElement("advanced","advStyles");j&&j.updateStyle("height",this.getValue())},setup:function(j){var k=j.getStyle("height");k&&this.setValue(k)},commit:b}]},{type:"hbox",widths:["5em"],children:[{type:"select",id:"cmbBorder",requiredContent:"table[border]","default":h.filter.check("table[border]")?1:0,label:e.DisplayBorder,items:[[e.Yes,1],[e.No,0]],setup:function(j){this.setValue(j.getAttribute("border")||1)},commit:function(k,j){if(this.getValue()){j.setAttribute("border",this.getValue())}else{j.removeAttribute("border")}}}]}]}]}]}]}})});define("DS/SwymUIComponents/script/feature/core/network/view/request-received-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/network/view/request-received-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/network/model/request-model","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UIKIT/Input/Button","DS/PubSub/PubSub","DS/W3DXComponents/Views/Item/TileView","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/sprite/sprite","UWA/Class/Model","DS/WebappsUtils/WebappsUtils"],function(k,f,h,d,e,i,l,g,j,b,m,c){var a=h.extend({_modelClass:d,name:"request-received-view",_getAddrEl:function(o,n){return(o[n])?o[n]+" ":""},_createContent:function(){if(this.model){var o=this.model.collection.getAssociated("groups"),n=this.model.collection.getAssociated("users");if(o){this._idGroupPro=o.getIdGroupProfessional()}if(n){this._users=n}var t=this,p=this.model.getAssociated("user"),q=this.model.getAttributes(),r=new m({title:function(){return'<a data-login="'+(p.get("login")?p.get("login"):"")+'" data-content-type="person" data-hash-key="'+(p.get("hash_key")?p.get("hash_key"):"")+'" class="link">'+p.get("nickname")+"<a>"},subtitle:this._getAddrEl(q,"company")+this._getAddrEl(q,"address")+this._getAddrEl(q,"zip")+this._getAddrEl(q,"city")+this._getAddrEl(q,"country"),imgAttrs:function(){return b.getUserPictureAttributes({format:"normal",cls:"width-60px",hash_key:p.get("hash_key"),imageUpdateTime:p.get("picture_update")})},image:function(){return e.constructUserPictureUrl(null,null,p.get("hash_key"))}}),u=new g({model:r}),s=k.createElement("div",{html:u.render()}),x='<div class="invitation-message"><span class="fonticon fonticon-2x fonticon-comment" ></span> <span class="notifier-message">"'+this.model.get("notifier_message")+'"</span></div>',v=k.createElement("div",{"class":"actionBar edit-style",html:[this.addControl("invite-button",new i({value:f.Accept,className:"saveButton primary",events:{onClick:function(){var A=t.getControl("invite-button");if(A){A.load();var z=t.model.get("user").hash_key,B={group_id:t._idGroupPro,accept_status:"acceptAdd"};if(z){var y=t._users.where({hash_key:z})}if(y&&y.length>0){B={group_id:t._idGroupPro,accept_status:"accept"}}t.model.moderate({data:B,onComplete:function(D,C){if(B.accept_status==="acceptAdd"){this.alert("success",f.RequestModerated);l.dispatch("refreshNetwork",[D.getAssociated("user"),true],true)}else{this.alert("success",f.youHaveBeenAddedToTheUsersNetwork)}l.dispatch("refreshPendingInvitations",true);this.destroy()}.bind(t),onFailure:function(){A.load(false);this.alert("error",f.errorOccuredWhileModeratingInvitationRequest)}.bind(t)})}}}})),this.addControl("cancel-button",new i({value:f.Decline,className:"cancelButton default",events:{onClick:function(){var y=t.getControl("invite-button");if(y){y.load();var z={group_id:t._idGroupPro,accept_status:"decline"};t.model.moderate({data:z,onComplete:function(B,A){this.alert("info",f.InvitationRequestDeclined);l.dispatch("refreshPendingInvitations");this.destroy()}.bind(t),onFailure:function(){y.load(false);this.alert("error",f.errorOccuredWhileModeratingInvitationRequest)}.bind(t)})}}}}))]}),w=k.createElement("div",{"class":"edit-content edit-style",html:[{html:u.render(),styles:{height:"70px"}},this.model.get("notifier_message")?x:""]});return[w,v]}},setup:function(n){return this._parent.apply(this,arguments)}});return a});define("DS/SwymUIComponents/script/feature/core/modal/super-modal",["UWA/Core","DS/UIKIT/SuperModal"],function(c,a){var b=a.extend({init:function(){if(arguments.hasOwnProperty("0")){if(window.ds&&(ds.env!=="3DD")){arguments[0].renderTo=window.document&&window.document.body}else{arguments[0].renderTo=window.widget&&window.widget.body}}return this._parent.apply(this,arguments)}});return b});define("DS/SwymUIComponents/script/feature/core/link/view/account-link-read-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-read-view","DS/SwymUICore/script/feature/core/link/model/link-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu"],function(g,e,b,f,c,a){var d=f.extend({});return d});define("DS/SwymUIComponents/script/feature/community/media/edit/upload/media-upload-queue",["UWA/Core"],function(c){var a=5,b=function(){var l,m,g={},f=a,r=[],n=[],h=[],j=[],p=function(t,v){var u=t.indexOf(v);return t.splice(u,1)},i=function(t){if((r.length===0)&&(n.length===0)){if(j.length===0){l&&l()}else{m&&m(t)}}else{if(r.length>0){s()}}},q=function(t){p(n,t);h.push(t);i()},k=function(u,t){p(n,u);j.push(u);i(t)},e=function(u){var t=false;!t&&h.some(function(v,w){if(v===u){t=h.splice(w,1)[0];return true}});!t&&j.some(function(v,w){if(v===u){t=j.splice(w,1)[0];return true}});return t},d=function(t){var u=r.some(function(v){return v===t});return u},o=function(t){var u=n.some(function(v){return v===t});return u},s=function(t){var u;g=c.merge(t||{},g);if(g){l=g.onUploadsComplete;m=g.onUploadsFailure;if(Array.isArray(g.mediaToBeUploaded)){g.mediaToBeUploaded.forEach(function(w){if(!d(w)&&!o(w)){e(w);w.addEventOnce("removeFromUploadQueue",e);r.push(w)}})}delete g.mediaToBeUploaded}while((r.length>0)&&(n.length<f)){u=r.shift();n.push(u);var v=c.merge({onComplete:q,onFailure:k},g);if(u.get("objectId")&&!u.has("mid")){u.publishFrom3DDriveToSwym(v)}else{u.save({},v)}}};return s};return b});define("DS/SwymUIComponents/script/feature/community/media/view/media-tooltip-view",["DS/SwymUICore/script/lib/view/generic/swym-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/media-tooltip-view","DS/UIKIT/Tooltip","UWA/Controls/DataGrid"],function(c,e,d,b){var a=c.extend({name:"mediaTooltip",_mediaFileExtension:null,_targetElement:null,_displayedFileTypes:["image","video","audio","3dmodel","document","drawing"],setup:function(f){this._targetElement=f.target;if(f.displayedFileTypes){this._displayedFileTypes=f.displayedFileTypes}if(this.model.get("documentedFormats")!==undefined){this._createTooltip()}else{this.reactTo(this.model,"onDocumentedFileExtensionsCreated",this._createTooltip)}this.reactTo(this.model,"onChange:maxSizes",this._createTooltip)},_createTooltip:function(){var f=this.model.get("documentedFormats");this.addControl("supportedFileExtensionsTooltip",new d({className:"dropzone-tooltip",target:this._targetElement,body:this._createTooltipContent(f),position:"right"}))},_createTooltipContent:function(i){var f=this.model.get("maxSizes"),j=this.model.get("maxpixels"),g=[];this._displayedFileTypes.forEach(function(k){switch(k){case"image":g.push({type:e.Image,extension:i.image.join(", "),size:Math.floor(f.picture/1048576)+"MB "+e.Or+" "+Math.floor(j.picture/1000000)+"Mpx"});break;case"video":g.push({type:e.Video,extension:i.video.join(", "),size:Math.floor(f.video/1048576)+"MB"});break;case"audio":g.push({type:e.Audio,extension:i.audio.join(", "),size:Math.floor(f.sound/1048576)+"MB"});break;case"3dmodel":g.push({type:e.ThreeDModel,extension:i["3dmodel"].join(", "),size:Math.floor(f["3d_model"]/1048576)+"MB"});break;case"document":g.push({type:e.Document,extension:i.document.join(", "),size:Math.floor(f.document/1048576)+"MB"});break;case"drawing":g.push({type:e.Drawing,extension:i.drawing.join(", "),size:Math.floor(f.drawing/1048576)+"MB"});break;default:break}});var h=new b({className:"mediaTooltip",columns:[{text:e.Type,dataIndex:"type"},{text:e.Supportedfileextensions,dataIndex:"extension"},{text:e.Maxsize,dataIndex:"size"}],data:g});return h}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/video/player-behaviors",["UWA/Data"],function(b){function a(){return window.ds&&window.ds.env==="MOBILE"}return{getLoopBehavior:function(c){if(c==="animatedPicture"&&!a()){return true}else{return false}},getAutoPlayBehavior:function(d,c){if(c==="animatedPicture"){if(a()){return false}else{return true}}else{return d||false}},getControlsBehavior:function(d,c){if(c==="animatedPicture"){return false}else{return d||true}},getAVStream:function(c){if(a()){return b.proxifyUrl(c,{proxy:"passport"})}else{return c}}}});define("DS/SwymUIComponents/script/feature/community/community/view/community-visibility-settings-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-visibility-settings-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/WebappsUtils/Console"],function(i,e,g,f,k,o,n,j,b){var d=1;var m=0;var c=4;var p=1;var h=0;var l=function(r,q){var s;if(!(s=r.getChanges(q))){s=r.get(q)}return s};var a=g.extend({_modelClass:f,attributes:{tag:"div"},onExtranetVisibilityChange:function(){var s=this.view,r=s.model,q=this.toggle;if(q===s.extranetToggleControls[0]){b.log("onExtranetVisibilityChange public",q.getValue());r.addChanges("extranet_access",q.getValue());r.addChanges("extranet_access_enabled",p)}else{if(q===s.extranetToggleControls[1]){b.log("onExtranetVisibilityChange private",q.getValue());r.addChanges("extranet_access",q.getValue());r.addChanges("extranet_access_enabled",p)}else{if(q===s.extranetToggleControls[2]){b.log("onExtranetVisibilityChange secret",q.getValue());r.addChanges("extranet_access",q.getValue());r.addChanges("extranet_access_enabled",p)}else{if(q===s.extranetToggleControls[3]){b.log("onExtranetVisibilityChange disabled",q.getValue());r.addChanges("extranet_access",null);r.addChanges("extranet_access_enabled",h)}}}}},onIntranetVisibilityChange:function(){var t,s=this.view,r=s.model,q=this.toggle;if(q===s.intranetToggleControls[0]){b.log("onIntranetVisibilityChange public",q.getValue());r.addChanges("access",q.getValue());if(s.extranetToggleControls[0].isDisabled()){s.extranetToggleControls[0].enable()}if(s.extranetToggleControls[1].isDisabled()){s.extranetToggleControls[1].enable()}if(s.optinToggle.isDisabled()){s.optinToggle.setDisabled(false)}}else{if(q===s.intranetToggleControls[1]){b.log("onIntranetVisibilityChange private",q.getValue());r.addChanges("access",q.getValue());if(s.extranetToggleControls[1].isDisabled()){s.extranetToggleControls[1].enable()}if(s.extranetToggleControls[0].isChecked()){s.extranetToggleControls[1].setCheck(true);t=s.extranetToggleControls[1].getValue();b.log("onIntranetVisibilityChange set extranet visibility to private",t);r.addChanges("extranet_access",t)}if(!s.optinToggle.isDisabled()){s.optinToggle.setDisabled(true);s.optinToggle.setCheck(false)}s.extranetToggleControls[0].setDisabled(true)}else{if(q===s.intranetToggleControls[2]){b.log("onIntranetVisibilityChange secret",q.getValue());r.addChanges("access",q.getValue());if(s.extranetToggleControls[0].isChecked()||s.extranetToggleControls[1].isChecked()){s.extranetToggleControls[2].setCheck(true);t=s.extranetToggleControls[2].getValue();b.log("onIntranetVisibilityChange set extranet visibility to secret",t);r.addChanges("extranet_access",t)}if(!s.optinToggle.isDisabled()){s.optinToggle.setDisabled(true);s.optinToggle.setCheck(false)}s.extranetToggleControls[0].setDisabled(true);s.extranetToggleControls[1].setDisabled(true)}}}},createExtranetVisibilityUI:function(r,s,q){r=parseInt(r,10);s=parseInt(s,10);this.extranetToggleControls=[];this.extranetVisibilityUI=i.createElement("div",{"class":"col-xs-12 col-sm-6",styles:{display:"none"},html:[{tag:"div",html:{tag:"h5",html:e.Communityvisibilityforcontractors}},(this.extranetToggleControls[0]=new n({name:"optionsPartners",className:"primary",value:d,label:e.Public,checked:r===d})),(this.extranetToggleControls[1]=new n({name:"optionsPartners",className:"primary",value:m,label:e.Private,checked:r===m})),(this.extranetToggleControls[2]=new n({name:"optionsPartners",className:"primary",value:c,label:e.Secret,checked:r===c})),(this.extranetToggleControls[3]=new n({name:"optionsPartners",className:"primary",value:"disabled",label:e.Disabled,checked:!s}))]});switch(q){case c:this.extranetToggleControls[1].setDisabled(true);case m:this.extranetToggleControls[0].setDisabled(true)}this.extranetToggleControls[0].addEvent("onChange",this.onExtranetVisibilityChange.bind({view:this,toggle:this.extranetToggleControls[0]}));this.extranetToggleControls[1].addEvent("onChange",this.onExtranetVisibilityChange.bind({view:this,toggle:this.extranetToggleControls[1]}));this.extranetToggleControls[2].addEvent("onChange",this.onExtranetVisibilityChange.bind({view:this,toggle:this.extranetToggleControls[2]}));this.extranetToggleControls[3].addEvent("onChange",this.onExtranetVisibilityChange.bind({view:this,toggle:this.extranetToggleControls[3]}));return this.extranetVisibilityUI},createIntranetVisibilityUI:function(q){var r=this;this.intranetToggleControls=[];if(o.getInstance().isFeatureActivated("active_community_blacklist")){r.active_community_blacklist=i.createElement("span",{"class":"community-blacklist-optin-wrapper",html:[(this.optinToggle=new n({type:"checkbox",name:"optin",className:"optin-toggle primary",label:e.Optin,checked:this.model.get("blacklist_by_default")==="1",disabled:q!==d})),(this.helpIcon=i.createElement("span",{"class":"fonticon fonticon-help",styles:{"margin-left":"10px"}}))]})}this.intranetVisibilityUI=i.createElement("div",{"class":"col-xs-12 col-sm-6",styles:{display:"none"},html:{tag:"div","class":"",html:[{tag:"div",html:{tag:"h5",html:e.Communityvisibilityforemployees}},{"class":"public-optin-wrapper",html:[(this.intranetToggleControls[0]=new n({name:"optionsEmployees",className:"primary",value:d,label:e.Public,checked:q===d})),r.active_community_blacklist]},(this.intranetToggleControls[1]=new n({name:"optionsEmployees",className:"primary",value:m,label:e.Private,checked:q===m})),(this.intranetToggleControls[2]=new n({name:"optionsEmployees",className:"primary",value:c,label:e.Secret,checked:q===c}))]}});this.intranetToggleControls[0].addEvent("onChange",this.onIntranetVisibilityChange.bind({view:this,toggle:this.intranetToggleControls[0]}));if(o.getInstance().isFeatureActivated("active_community_blacklist")){this.optinToggle.addEvent("onChange",function(s){r.model.addChanges("blacklist_by_default",s.currentTarget.checked?"1":"0")})}this.intranetToggleControls[1].addEvent("onChange",this.onIntranetVisibilityChange.bind({view:this,toggle:this.intranetToggleControls[1]}));this.intranetToggleControls[2].addEvent("onChange",this.onIntranetVisibilityChange.bind({view:this,toggle:this.intranetToggleControls[2]}));return this.intranetVisibilityUI},_createContent:function(){var r=this.model;var q=parseInt(l(r,"access"),10);var t=parseInt(l(r,"extranet_access"),10);var u=parseInt(l(r,"extranet_access_enabled"),10);var s=UWA.createElement("div",{"class":"col-xs-12",styles:{padding:"0px","margin-top":"20px"},html:[this.createIntranetVisibilityUI.call(this,q),this.createExtranetVisibilityUI.call(this,t,u,q)]});k.getInstanceFetched(function(v){if(v&&v.get("tenant_admin")){if(v.get("tenant_admin")==="1"){this.intranetVisibilityUI.show();this.extranetVisibilityUI.show()}}}.bind(this));if(i.is(this.helpIcon)){this.addControl("MenuTooltip",new j({target:this.helpIcon,body:e.IfSelectedUsersWillNotSeeTheCommunitysContributionsInTheWhatsNew}))}return s}});return a});define("DS/SwymUIComponents/script/feature/community/community/view/rss-feed-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-detailed-view"],function(g,f,a,c,d,e){var b=f.extend({name:"rss-feed-view",domEvents:{"click .rss-feed-action":"_getRssFeed"},setup:function(h){this.button=g.createElement("span",{"class":"rss-feed-action fonticon fonticon-rss"});this.addControl("rssTooltip",new c({target:this.button,body:e.SubscribeToRSSFeed}));this._parent.call(this,h)},_createContent:function(){return this.button},_getRssFeed:function(){if(this.options.mode==="wiki"){window.open(d.getBaseUrl()+"/rss/filter/feed/community_id/"+this.options.communityId+"/model/wiki/")}else{window.open(d.getBaseUrl()+"/rss/filter/"+this.options.mode+"/community_id/"+this.options.communityId)}}});return b});define("DS/SwymUIComponents/script/feature/community/question/question-view-mixin",[],function(){var a={_modelEvents:{"onChange:nb_validate":"_updateAnswerIcon"},onRedraw:function(){this._parent.apply(this,arguments);this._updateAnswerIcon()},_updateAnswerIcon:function(){if(this.hasOwnProperty("model")&&this.model.getModelName()==="iquestion"){var c=this.model,e=this.container.getParent()||this.container,d=c.isValidated(),b=c.get("ds6w_58_status");if(d!==undefined){if(d){e.addClassName("question-validated")}else{e.removeClassName("question-validated")}}else{if(b!==undefined){if(b==="ds6w:status.swym_validated"){e.addClassName("question-validated")}else{e.removeClassName("question-validated")}}}}}};return a});define("DS/SwymUIComponents/script/feature/core/modal/modal",["UWA/Core","DS/UIKIT/Modal"],function(c,a){var b=a.extend({init:function(){if(window.ds&&(ds.env!=="3DD")){arguments[0].renderTo=window.document&&window.document.body}else{arguments[0].renderTo=window.widget&&window.widget.body}return this._parent.apply(this,arguments)}});return b});define("DS/SwymUIComponents/script/feature/core/ui-components/sortable/new-sortable-list-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","UWA/Controls/Drag","DS/SwymUICore/script/utils/utils"],function(e,b,d,a){var c={_expanded:true,_mode:"full",setMode:function(f){if(f==="restricted"){this._mode=f}else{this._mode="full"}},_configureSortableComponent:function(){var f=this;f.dragMoveComponent&&f.destroyComponent();f.dragMoveComponent=new d.Move({container:document.body,zones:[f.sortableContainer,f.trashZone,f.pushBottomZone],delegate:".draggable-community, .draggable-community *",centerHandles:true,handles:f._handles.bind(f),move:f._move.bind(f),fixed:f._fixed.bind(f),enter:f._enter.bind(f),leave:f._leave.bind(f),drop:f._drop.bind(f),stop:f._stop.bind(f),start:f._start.bind(f)})},appendNewItem:function(g){var f=g.get("position"),j=this.container.getElement(".item-list-body"),i=j.getChildren(),h=e.createElement("div",e.extend({html:this.addChildView("sortable-item-"+g.get("mid"),new this.modelViewClass({model:g}))},this.modelViewsCfg(g)));if(f&&i.hasOwnProperty(f-1)){j.insertBefore(h,i[f-1])}else{j.appendChild(h)}this.defaultZone.hide()},removeItem:function(g){var f=this.container.querySelector('.draggable-sortable-item[data-content-id="'+g+'"]');f&&f.destroy();if(this.container.getElementsByClassName("draggable-sortable-item").length===0){this.defaultZone.show()}},isEmpty:function(){return false},viewAllAction:function(){if(this.viewAllPlaceholder){var f=this.container.getElementsByClassName("draggable-sortable-item"),g;for(g in f){if(f.hasOwnProperty(g)&&f[g].isHidden()){f[g].show()}}this._expanded=true;this.viewAll.hide()}},isExpanded:function(){return this._expanded},_addPersistentPlaceholder:function(f){this.persistentPlaceholder=e.createElement("div",{"class":"placeholder "+this.itemClassName,html:this.placeHolderHtml});if(f.placeholder&&f.placeholder.isInjected()){this.persistentPlaceholder.inject(f.placeholder,"before")}else{this.persistentPlaceholder.inject(this.sortableContainer)}},_start:function(f){var g=f.target.getClosest(this.itemCssSelector);if(g.hasClassName("draggable-sortable-item")&&this._mode==="restricted"){return false}},_handles:function(f){var g=this,i,h=[{tag:"span","class":"fonticon fonticon fonticon-drag-drop fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:g.reorderPlaceholder}],j=f.target.getClosest(g.itemCssSelector);g.isFromDraggableList=j.getClosest(".sortable-list-view-container");g.isDragState=g.isAllowed=true;g.hasBeenAdded=g.hasBeenDropped=false;g.dispatchEvent("onDragStart",f);g.defaultZone.hide();i=g.ghostBuilder(f);i=i?i:j;if(!g.isAllowedToDrop(i)&&!g.isFromDraggableList){g.isAllowed=false;g.container.addClassName("forbidden");g.forbiddenZone.show()}(!f.placeholder||(!f.placeholder.isInjected()&&!g.persistentPlaceholder.isInjected()))&&g.isAllowed&&g._mode==="full"&&g._addPersistentPlaceholder(f);if(g.isFromDraggableList&&g.isAllowed){g.trashZone.setStyle("display","block");g.trashZone.setStyle("opacity",1)}if(!g.isFromDraggableList&&g.isAllowed&&g._mode==="restricted"){g.container.addClassName("restricted-mode");g.pushBottomZone.show()}f.placeholder=e.createElement("div",{"class":"placeholder hover-placeholder "+g.itemClassName,html:g.isFromDraggableList?h:g.placeHolderHtml});g.oldHandlesHTML=i;g.currentHandles=a.cloneNode(i,true);e.extendElement(g.currentHandles);i.hide();g.currentHandles.addClassName("dragged custom-ghost");g.currentHandles.inject(document.body).show();g.currentHandles.style.width=g.container.offsetWidth+"px";return g.currentHandles},_move:function(f){f.refreshCache()},_fixed:function(g,f){return(f.hasClassName("draggable-sortable-trash")||f.hasClassName("default-drop-zone"))?true:false},_enter:function(f){if(this.isAllowed&&this._mode==="full"){if(f.zone.hasClassName("item-list-body")){this.persistentPlaceholder&&this.persistentPlaceholder.destroy();return f.placeholder}else{!f.placeholder.isInjected()&&!this.persistentPlaceholder.isInjected()&&this._addPersistentPlaceholder(f)}if(f.zone.hasClassName("draggable-sortable-trash")){f.zone.addClassName("hover-trash")}}else{if(this.isAllowed&&this._mode==="restricted"){if(f.zone.hasClassName("push-bottom-zone")){f.zone.addClassName("hover-placeholder")}}}},_leave:function(f){if(this.isAllowed&&this._mode==="full"){if(f.zone.hasClassName("draggable-sortable-trash")){f.zone.removeClassName("hover-trash")}if(f.zone.hasClassName("item-list-body")){this._addPersistentPlaceholder(f)}}else{if(this.isAllowed&&this._mode==="restricted"){if(f.zone.hasClassName("push-bottom-zone")){f.zone.removeClassName("hover-placeholder")}}}},_drop:function(g){this.hasBeenDropped=true;if(this.isAllowed){var h=0,i,f;if(g.zone.hasClassName("push-bottom-zone")&&this._mode==="restricted"){this.onChange(g.handles,this.sortableContainer.getChildren().length);this.hasBeenAdded=true}else{if(g.zone.hasClassName("draggable-sortable-trash")){this.onRemove(g.handles)}else{if(g.zone.hasClassName("item-list-body")){i=this.sortableContainer.getChildren();f=g.target.getClosest(this.itemCssSelector);if(g.handles.getClosest(this.itemCssSelector).hasClassName("draggable-sortable-item")&&i.indexOf(f)<i.indexOf(g.placeholder)){h=-1}this.isFromDraggableList&&this.oldHandlesHTML.destroy();this.onChange(g.handles,i.indexOf(g.placeholder)+h);this.hasBeenAdded=true}}}}},_stop:function(f){var g=f.handles.getClosest(this.itemCssSelector);this.dispatchEvent("onDragStop",f);if(!this.hasBeenDropped){f.handles.destroy()}if(this.isAllowed){this.trashZone.setStyle("opacity",0);this.trashZone.removeClassName("hover-trash");this.trashZone.hide();this.persistentPlaceholder&&this.persistentPlaceholder.destroy();this.pushBottomZone.hide();this.pushBottomZone.removeClassName("hover-trash");f.placeholder.destroy();f.handles.destroy();if(this.sortableContainer.getChildren().length===0){this.defaultZone.show()}}else{if(g){g.removeClassName("dragged");g.setStyles({left:null,top:null})}this.container.removeClassName("forbidden");this.forbiddenZone.hide();f.handles.destroy()}if(!this.hasBeenAdded){this.oldHandlesHTML.show()}this.isFromDraggableList=this.isDragState=this.hasBeenAdded=false},showItemsView:function(){this.getElements(".thread-view > *:first-child").forEach(function(f){f.show()})},destroyComponent:function(){this.dragMoveComponent.destroy();return this._parent.apply(this,arguments)}};return c});define("DS/SwymUIComponents/script/feature/core/user/view/user-privacy-policies-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/user-privacy-policies-view","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Input/Toggle","DS/WebappsUtils/Console"],function(g,f,d,e,b,h,a){var c=f.extend({_modelClass:d,name:"user-privacy-policies-view",toggleDS:null,setup:function(i){i=i||{};return this._parent.apply(this,arguments)},_createContent:function(){var i=this;return g.createElement("div",{html:[{tag:"h4","class":"titleProfile",html:e.PrivacyPolicies},{"class":"margin-top-20px",styles:{display:"flex"},html:[i.toggleDS=new h({type:"checkbox",value:"dpp_validation",className:"primary legal-checkbox",label:"",events:{onClick:function(){require(["DS/SwymUIComponents/script/feature/core/modal/super-modal"],function(j){var k=new j({closable:false,renderTo:i._widget.body});k.confirm({title:e.LogOut,message:e.AllOptionsMustBeCheckedToUseThePlatform+e.YouWillBeLoggedOut,callback:function(l){if(l===true){i._disagree()}else{i.toggleDS.check()}}})})}}}).check(),{tag:"span","class":"fonticon fonticon-doc-log",styles:{"margin-right":"10px"}},{tag:"a",href:"https://www.3ds.com/privacy-policy/",html:e.PrivacyPolicies+" - "+e.DassaultSystemes}]}]})},_disagree:function(){require(["DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/request/data","DS/WAFData/WAFData"],function(k,j,i){var l=b.getApplicationConfiguration("app.urls.passport");if(l){k.get3DPassportCSRFToken(function(m){i.authenticatedRequest(l+"/api/authenticated/user/fields",{data:JSON.stringify({fields:{dpp_consent:false}}),type:"json",method:"POST",timeout:60000,headers:{"X-DS-IAM-CSRFTOKEN":m,Accept:"application/json","Content-Type":"application/json"},onComplete:function(){j.request({url:"/uwp/logout"});window.location.href=k.getBaseUrl()+"/api/passport/logout?redirect="+encodeURIComponent(document.URL)},onFailure:function(o,n){a.log(o);a.log(n);a.log("3dpassport server error");that.toggleDS.check();require(["DS/UWPClientControls/PlatformNotify"],function(p){p.error("There is an issue with 3DPassport server. Please try again later.")})}})}),function(){console.error("Fail retrieving 3DPassport CSRF Token")}}})}});return c});define("DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/img-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/lib/model/generic/community-content","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/feature/core/tenant/model/tenant-model"],function(e,c,i,a,f,b,g,d){var h=c.extend({_modelEvents:{"onChange:preview_fingerprint":"onChangePreviewFingerprint"},defaultOptions:{refreshOnFingerprintChange:true},name:"media-thumbnail-view",onChangePreviewFingerprint:function(){if(this.options.refreshOnFingerprintChange===true){this.refresh()}else{console.log("no refresh()")}},_createContent:function(){var l,k=this.model,j=k.getModelName();if(j==="community"){l=k.get("picture_update")||k.get("update")}else{l=k.get("update")}return b.renderMediaThumbnail(e.merge({mediaType:k.get("media_type"),imageUpdateTime:l,imageFingerprint:k.get("preview_fingerprint"),modelId:k.get("mid"),modelName:j,deletedMedia:(this.model.get("_deleted")===true)},e.merge(this._imageRenderingOptions||{},this.imageReloadOptions)))},getInitialModel:function(){return this.model},updatePreviewFingerPrintOnCommunityLogoChange:function(){var k=this.model,j;if((k instanceof f)&&!(k instanceof i)){j=k.getCommunity();this.reactTo(j,"onChange:thumbnail",function(){var l=(k.hasAssociation("thumbnail")?k.getAssociated("thumbnail"):null);if(!l||l.isNew()){if(j.get("preview_fingerprint")){this.model.set({preview_fingerprint:j.get("preview_fingerprint")})}}})}},updatePreviewFingerPrintOnTenantLogoChange:function(){var j=this.model,k=this;g.getInstanceFetched(function(l){var m=new d({id:l.get("tenant_uuid")});k.reactTo(m,"onChange:preview_fingerprint",function(){var n=(j.hasAssociated("thumbnail")?j.getAssociated("thumbnail"):null);if(!n||n.isNew()){if(m.get("preview_fingerprint")){j.set({preview_fingerprint:m.get("preview_fingerprint")})}}})})},onSetModel:function(){this.updatePreviewFingerPrintOnCommunityLogoChange();this.updatePreviewFingerPrintOnTenantLogoChange()}});return h});define("DS/SwymUIComponents/script/feature/community/media/editor/view/control-point-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/WebappsUtils/Console"],function(d,c,a){var b=c.extend({type:null,cropboxRect:null,width:20,beingDragged:false,svgWrapper:null,x:null,y:null,offsetX:null,offsetY:null,rectOffsetX:null,rectOffsetY:null,rect:null,rectElt:null,svgWrapperElt:null,render:function(){throw new Error("This class instances must not use render.")},setup:function(f){this.type=f.type;this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect");this.rect.setAttribute("width",this.width);this.rect.setAttribute("height",this.width);this.rect.setAttribute("class","media-editor-cropbox-pointcontrol");this.rectElt=UWA.extendElement(this.rect);var e,g;switch(f.type){case"NW":this.rectOffsetX=0;this.rectOffsetY=0;this.rectElt.setStyle("cursor","nw-resize");break;case"NE":this.rectOffsetX=-this.width;this.rectOffsetY=0;this.rectElt.setStyle("cursor","ne-resize");break;case"SW":this.rectOffsetX=0;this.rectOffsetY=-this.width;this.rectElt.setStyle("cursor","sw-resize");break;case"SE":this.rectOffsetX=-this.width;this.rectOffsetY=-this.width;this.rectElt.setStyle("cursor","se-resize");break}e=f.pointCoord[0]+this.rectOffsetX;g=f.pointCoord[1]+this.rectOffsetY;this.rectElt.setAttribute("x",e);this.rectElt.setAttribute("y",g);a.log("x: "+e+", y:"+g);this.rectElt.inject(f.renderTo);this.svgWrapperElt=f.svgWrapper;this.updateOffsets();a.log("x: "+e+", y:"+g)},updateOffsets:function(){var h,g,f=d.Utils.Client.Engine;if(f.firefox||f.ie){h=document.documentElement.scrollLeft;g=document.documentElement.scrollTop}else{h=document.body.scrollLeft;g=document.body.scrollTop}var e=this.svgWrapperElt.getOffsets();this.offsetX=e.x-h;this.offsetY=e.y-g},setCoordinate:function(f,e){this.rectElt.setAttribute(f,e)},isControlPoint:function(e){return(this.rect===e)},onMouseDown:function(e){this.beingDragged=true},onMouseUp:function(e){this.beingDragged=false},onMouseOut:function(){this.beingDragged=false},onMouseMove:function(e){this.updateOffsets();var g=e.clientX-this.offsetX;var f=e.clientY-this.offsetY;if(this.beingDragged){this.rect.setAttribute("x",g);this.rect.setAttribute("y",f);this.dispatchEvent("ControlPointMoved",this)}},getCoordsInSvgSpace:function(e){return{x:e.clientX-this.offsetX,y:e.clientY-this.offsetY}}});return b});define("DS/SwymUIComponents/script/feature/core/user/view/location/user-location-read-view",["UWA/Core","UWA/String","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model"],function(d,b,c,a){return c.extend({name:"user-location-read-view",_modelEventsForAutoRefresh:["onChange"],_modelClass:a,_getParamInHTML:function(f){var e="";if(/\S/.test(this.model.get(f)||"")){e=b.unescapeHTML(this.model.get(f,{escapeHTML:true}))+"</br>"}return e},_createContent:function(){var e=d.createElement("div",{html:'<span class="company">'+this._getParamInHTML("company")+'</span><span class="address">'+this._getParamInHTML("address")+'</span><span class="zip">'+(this.model.get("zip")||"")+' </span><span class="city">'+this._getParamInHTML("city")+'</span><span class="country">'+(this._getParamInHTML("countryForRead")||this._getParamInHTML("country"))+"</span>"});return e}})});define("DS/SwymUIComponents/script/feature/community/content/edit/tag-autocomplete",["UWA/Core","UWA/Json","UWA/Utils","UWA/String","UWA/Promise","DS/WAFData/WAFData","DS/UWPClientCode/I18n","DS/SocialUserMention/Controls/AbstractAutocomplete","DS/Logger/Logger"],function(g,f,d,b,h,i,j,e,a){var k="ds6w:",c=e.extend({SUGGESTIONS_MAX_HEIGHT:238,defaultOptions:{defaultClassName:"s6m-tag-autocomplete",typeDelayBeforeSearch:0},_initSocialMentionDataSet:function(){var l=this;this.addDataset({name:"6WTags",items:[],searchEngine:function(o,p){var n,m;return["what","when","where","who","why","how"].map(function(q){m=k+q;n=m+"/"+p;return{label:p,predicateWithoutNamespace:q,predicate:m,value:n,id:d.getCheckSum(n)}})}},{templateEngine:function(m,p,n){var o;m.addClassName("default-template");o=g.createElement("span",{"class":"s6m-tag-literal"});o.setText(n.label);m.setContent(g.createElement("span",{"class":"item-label",html:[{tag:"span",title:b.ucfirst(n.predicateWithoutNamespace),"class":"item-label-icon fonticon fonticon-3ds-"+n.predicateWithoutNamespace},o]}))},onError:function(){l.hide()},onTimeout:function(){l.hide()}})}});return c});define("DS/SwymUIComponents/script/feature/core/experience/view/experience-edit-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-edit-view","DS/SwymUICore/script/feature/core/experience/model/experience-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Form","DS/WebappsUtils/Console"],function(g,e,a,f,d,b){var c=f.extend({_modelClass:a,name:"experience-edit-view",_createContent:function(){var i=this.model,m=this,l=new Date().getTimezoneOffset(),k=this._getValueToNeutralizeDate("date_begin"),h=this._getValueToNeutralizeDate("date_end"),j=this.addControl("form-aboutme",new d({fields:[{type:"text",label:e.jobtitle,required:true,value:i.get("title",{escapeHTML:false}),events:{onChange:function(){i.addChanges("title",this.getValue())}}},{type:"text",label:e.company,required:true,value:i.get("work_name",{escapeHTML:false}),events:{onChange:function(){i.addChanges("work_name",this.getValue())}}},{type:"text",label:e.industry,value:i.get("industry",{escapeHTML:false}),events:{onChange:function(){i.addChanges("industry",this.getValue())}}},{type:"text",label:e.location,value:i.get("place",{escapeHTML:false}),events:{onChange:function(){i.addChanges("place",this.getValue())}}},{type:"date",name:"dateBegin",label:e.from,placeholder:e.selectADate,required:true,yearRange:50,renderTo:window.document.body.getElement(".user-app-view-container"),value:k,max:new Date(),events:{onChange:function(){var o=new Date(this.getDate()),n=new Date(o.getTime()-l*60000);i.addChanges("date_begin",n)}}},{type:"date",name:"dateEnd",disabled:i.get("not_finished")==="1",label:e.to,placeholder:e.selectADate,required:true,yearRange:50,renderTo:window.document.body.getElement(".user-app-view-container"),value:(i.get("not_finished")==="1")?k:h,events:{onChange:function(){var o=new Date(this.getDate()),n=new Date(o.getTime()-l*60000);i.addChanges("date_end",n)}}},{type:"checkbox",label:e.Icurrently,checked:i.get("not_finished")==="1",events:{onChange:function(){var n=m.getControl("form-aboutme").dates[1];if(this.isChecked()){n.disable();i.addChanges("date_end",null)}else{n.enable();i.addChanges("date_end",new Date(m.getControl("form-aboutme").getField("dateBegin").value))}var o=this.isChecked()?"1":"0";i.addChanges("not_finished",o)}}},{type:"textarea",label:e.description,rows:5,placeholder:e.describeyourposition,value:i.get("description",{escapeHTML:false}),events:{onChange:function(){i.addChanges("description",this.getValue())}}}]}));return j},_getValueToNeutralizeDate:function(i){var k=this.model.get(i,{escapeHTML:false}),h=new Date(k),j=k?new Date(h.getTime()+new Date().getTimezoneOffset()*60000):"";return j}});return c});define("DS/SwymUIComponents/script/feature/community/media/view/abstract-lightbox-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/interactive-media-thumbnail-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Tooltip"],function(g,e,c,f,d){var b=f.extend({_modelClass:c,name:"lightbox-header-media-view",_modelEventsForAutoRefresh:["onSync"],_shouldPlay360IconBeDisplayed:function(){return(this.model.isConsideredAsA360MediaModel()&&this._parentView._isAutoplayActivated===false)},_getHeaderTitle:function(){return(this.model.getChanges("title")||this.model.get("title"))},_createContent:function(){var n=this.getOption("displayActionsOnHeader"),i=n&&this._shouldPlay360IconBeDisplayed(),j=n&&(this.model.get("download_original_file")=="1"||this.model.get("media_type")==="document"),k=this.getOption("titleInteraction"),h=k?"text":"",m=this._getHeaderTitle()||"";var l=g.createElement("div",{"class":"header",html:[{"class":"title",html:m?('<span class="'+h+'">'+m+"</span>"):""},{"class":"action-icons",html:[j?{tag:"span","class":"fonticon fonticon-download fonticon-2x"}:{},i?{tag:"span","class":"fonticon fonticon-media-360 play-360-experience fonticon-2x"}:{},{tag:"span","class":"fonticon fonticon-cancel fonticon-2x"}]}]});if(i){this.addControl("play-tooltip",new d({target:l.getElement(".play-360-experience"),body:e.Play,position:"left"}))}if(j){this.addControl("download-tooltip",new d({target:l.getElement(".fonticon-download"),body:e.Download,position:"left"}))}this.addControl("cancel-tooltip",new d({target:l.getElement(".fonticon-cancel"),body:e.Close,position:"left"}));return l}});var a=f.extend({_modelClass:c,name:"abstract-lightbox-view",domEvents:{"click .fonticon-cancel":"_destroy"},_destroy:function(h){this.destroy()},setup:function(h){window.addEventListener("orientationchange",this.refresh.bind(this));window.document.onkeydown=function(i){i=i||window.event;var j=false;if("key" in i){j=(i.key=="Escape"||i.key=="Esc")}else{j=(i.keyCode==27)}if(j){this._destroy(i)}}.bind(this);if(window.widget){this._widget=widget}if(this._widget){this._widget.addEventOnce("onRefresh",function(){this.destroy()}.bind(this))}},getContentView:function(){return[]},displayActionsOnHeader:true,titleInteraction:true,removeContentView:function(){},_createContent:function(){if(!this.model.hasBeenFetched()&&!this.model.isNew()){this.model.fetch()}this.removeContentView();var h=g.createElement("div",{"class":"media-full-screen",html:[this.addChildView("header",{Class:b,model:this.model,displayActionsOnHeader:this.displayActionsOnHeader,titleInteraction:this.titleInteraction}),{"class":"content","media-type":this.model.get("media_type"),html:this.getContentView()}]});return h},injectInDom:function(){this.inject(document.body).show()}});return a});define("DS/SwymUIComponents/script/feature/core/tenant/view/tenant-stats-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/tenant-stats-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/WebappsUtils/Console"],function(e,c,d,b){var a=d.extend({model:null,_el:null,_createContent:function(){var f=this.model;if(f&&f.stats){return e.createElement("table",{"class":"table table-hover",html:{tag:"tbody",html:[{tag:"tr",html:[{tag:"td",styles:{"border-top":"none"},html:"<strong>"+c.DiskSpace+"</strong>"},{tag:"td",styles:{"border-top":"none"},html:(f.stats.disk_used_in_bytes<104857600)?(parseInt(f.stats.disk_used_in_bytes)/1048576).toFixed(2)+" MB":(parseInt(f.stats.disk_used_in_bytes)/1073741824).toFixed(2)+" GB"}]},{tag:"tr",html:[{tag:"td",html:"<strong>"+c.NbCommunities+"</strong>"},{tag:"td",html:f.stats.nb_communities}]},{tag:"tr",html:[{tag:"td",html:"<strong>"+c.NbConversations+"</strong>"},{tag:"td",html:f.stats.nb_directmessages}]},{tag:"tr",html:[{tag:"td",html:"<strong>"+c.NbUsers+"</strong>"},{tag:"td",html:f.stats.nb_users}]},{tag:"tr",html:[{tag:"td",html:"<strong>"+c.EmployeeVsPartner+"</strong>"},{tag:"td",html:(parseInt(f.stats.nb_users_employees)*100/(parseInt(f.stats.nb_users_partners)+parseInt(f.stats.nb_users_employees))).toFixed(2)+" %"}]}]}})}}});return a});define("DS/SwymUIComponents/script/utils/media-utils-v1",["UWA/Core","DS/SwymUICore/script/utils/utils","DS/Logger/Logger","DS/SwymUICore/script/feature/community/media/model/media-model"],function(g,f,c,a){function e(i,h){var j;if(typeof i.get==="function"){j=i.get(h)}else{j=i[h]}return j}function d(j){var k=e(j,"status")||e(j,"preview_media_processing_status"),i=parseInt(e(j,"width")||e(j,"preview_original_width"),10),h=parseInt(e(j,"height")||e(j,"preview_original_height"),10);return((k===a.MEDIA_PROCESSING_STATUS.OK)&&(i>0)&&(h>0))}var b={};b.MEDIA_THUMBNAIL=a.MEDIA_THUMBNAIL;b.PICTUREVIEW_V0=a.PICTUREVIEW_V0;b.PICTUREVIEW_V1=a.PICTUREVIEW_V1;b.isPictureViewAvailable=function(h){return d(h)};b.getLargestMediaDisplayDimensions=function(k){var o,i,j,h=e(k,"width")||e(k,"preview_original_width"),p=e(k,"height")||e(k,"preview_original_height"),n=h/p,m=(h>p),l=e(k,"processing_version");l=parseInt(g.is(l)?l:e(k,"preview_media_processing_version"),10);if(l===1){if(d(k)){if(o=k.get("pictureviewConfig")){if(o.xl1){i=o.xl1.width;j=o.xl1.height}else{if(o.o1){i=o.o1.width;j=o.o1.height}}}}else{if(m){i=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.WIDTH;j=i/n}else{j=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.HEIGHT;i=j*n}}}else{throw new Error("V1 picture view expected")}return{width:i,height:j}};b.getBestMediaViewConfig=function(C,L,u,t){var A,D,E,j,F,n,B,o,i,y,I,K,v,x,q,k,H,G,p,w,z,h,r,J=b.MEDIA_THUMBNAIL;if(C){o=e(C,"width")||e(C,"preview_original_width");i=e(C,"height")||e(C,"preview_original_height");p=e(C,"processing_version");p=parseInt(g.is(p)?p:e(C,"preview_media_processing_version"),10)}o=parseInt(o,10)||0;i=parseInt(i,10)||0;I=o?(o/i):(4/3);K=o>i;x=K?o:i;L=parseInt(L,10)||b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.WIDTH;u=parseInt(u,10)||L/I;v=K?L:u;if((p===1)&&(d(C))){j=b.PICTUREVIEW_V1.DIMENSIONS.M1;F=b.PICTUREVIEW_V1.DIMENSIONS.L1;n=b.PICTUREVIEW_V1.DIMENSIONS.XL1;z="picture";if(x<v){if(C&&(w=C.get("pictureviewConfig"))){if(w.xl1){B="xl1"}else{if(w.o1){B="o1"}}}}else{if(v<=j){if(x<=j){B="o1"}else{B="m1"}}else{if(v<=F){if(x<=F){B="o1"}else{B="l1"}}else{if(x<=n){B="o1"}else{B="xl1"}}}}k=b.PICTUREVIEW_V1.KEY[B.toUpperCase()];q=b.PICTUREVIEW_V1.TYPE;if(B==="o1"){H=o;G=i}else{if(K){H=b.PICTUREVIEW_V1.DIMENSIONS[B.toUpperCase()];G=H/I}else{G=b.PICTUREVIEW_V1.DIMENSIONS[B.toUpperCase()];H=G*I}}y=a.constructPictureViewUrl(C.get("mid"),B,e(C,"preview_fingerprint"))}else{if(!K){A=b.MEDIA_THUMBNAIL.DIMENSIONS.SMALL.HEIGHT;D=b.MEDIA_THUMBNAIL.DIMENSIONS.MEDIUM.HEIGHT;E=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.HEIGHT}else{A=b.MEDIA_THUMBNAIL.DIMENSIONS.SMALL.WIDTH;D=b.MEDIA_THUMBNAIL.DIMENSIONS.MEDIUM.WIDTH;E=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.WIDTH}z="thumb";if(t==="whats-new-mode"){if(x){if(x<A){B="s"}else{if(x<D){if(v<=A){B="s"}else{B="m"}}else{if(v<=A){B="s"}else{if(v<=D){B="m"}else{B="l"}}}}}else{if(v){if(v<=A){B="s"}else{if(v<=D){B="m"}else{B="l"}}}else{throw new Error("Dimensions not available to calculate the best thumbnail")}}}else{if(x){if(x<D){B="s"}else{if(x<E){if(v<D){B="s"}else{B="m"}}else{if(v<D){B="s"}else{if(v<E){B="m"}else{B="l"}}}}}else{if(v){if(v<D){B="s"}else{if(v<E){B="m"}else{B="l"}}}else{throw new Error("Dimensions not available to calculate the best thumbnail")}}}y=a.constructThumbnailUrl("media",C.get("mid"),B+"_thumb",e(C,"preview_fingerprint"));q=J.TYPE;h=J.KEY;r=b.MEDIA_THUMBNAIL.DIMENSIONS;I=4/3;switch(B){case"s":k=h.SMALL;if(K){H=r.SMALL.WIDTH;G=H/I}else{G=r.SMALL.HEIGHT;H=G*I}break;case"m":k=h.MEDIUM;if(K){H=r.MEDIUM.WIDTH;G=H/I}else{G=r.MEDIUM.HEIGHT;H=G*I}break;case"l":k=h.LARGE;if(K){H=r.LARGE.WIDTH;G=H/I}else{G=r.LARGE.HEIGHT;H=G*I}break}}return{previewType:z,url:y,size:B,width:H,height:G,spriteKey:k,spriteType:q}};return b});define("DS/SwymUIComponents/script/utils/media-utils-v0",["UWA/Core","DS/SwymUICore/script/utils/utils","DS/Logger/Logger","DS/SwymUICore/script/feature/community/media/model/media-model"],function(g,f,c,a){function e(i,h){var j;if(typeof i.get==="function"){j=i.get(h)}else{j=i[h]}return j}function d(k){var l=e(k,"status")||e(k,"preview_media_processing_status"),i=e(k,"media_type"),j=parseInt(e(k,"width")||e(k,"preview_original_width"),10),h=parseInt(e(k,"height")||e(k,"preview_original_height"),10);return((l===a.MEDIA_PROCESSING_STATUS.OK)&&(i==="picture")&&(j>0)&&(h>0))}var b={};b.MEDIA_THUMBNAIL=a.MEDIA_THUMBNAIL;b.PICTUREVIEW_V0=a.PICTUREVIEW_V0;b.PICTUREVIEW_V1=a.PICTUREVIEW_V1;b.isPictureViewAvailable=function(h){return d(h)};b.getLargestMediaDisplayDimensions=function(k){var o,h,l=e(k,"width")||e(k,"preview_original_width"),i=e(k,"height")||e(k,"preview_original_height"),j=l/i,n=(l>i),m=e(k,"processing_version");m=parseInt(g.is(m)?m:e(k,"preview_media_processing_version"),10);if(m!==1){if(n){if(d(k)){o=b.PICTUREVIEW_V0.DIMENSIONS.LARGE.WIDTH}else{o=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.WIDTH}h=o/j}else{if(d(k)){h=b.PICTUREVIEW_V0.DIMENSIONS.LARGE.HEIGHT}else{h=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.HEIGHT}o=h*j}}else{throw new Error("V0 picture view expected")}return{width:o,height:h}};b.getBestMediaViewConfig=function(C,L,t,r){var z,D,F,A,B,j,n,i,x,I,K,u,w,p,k,y,H,G,o,v,E,h,q,M=b.PICTUREVIEW_V0,J=b.MEDIA_THUMBNAIL;if(C){j=e(C,"media_type");n=e(C,"width")||e(C,"preview_original_width");i=e(C,"height")||e(C,"preview_original_height");o=e(C,"processing_version");o=parseInt(g.is(o)?o:e(C,"preview_media_processing_version"),10)}n=parseInt(n,10)||0;i=parseInt(i,10)||0;I=n?(n/i):(4/3);K=n>i;w=K?n:i;L=parseInt(L,10)||320;t=parseInt(t,10)||L/I;u=K?L:t;if(o!==1){if(!K){if(d(C)){y="picture";z=b.PICTUREVIEW_V0.DIMENSIONS.SMALL.HEIGHT;D=b.PICTUREVIEW_V0.DIMENSIONS.MEDIUM.HEIGHT;F=b.PICTUREVIEW_V0.DIMENSIONS.LARGE.HEIGHT}else{y="thumb";z=b.MEDIA_THUMBNAIL.DIMENSIONS.SMALL.HEIGHT;D=b.MEDIA_THUMBNAIL.DIMENSIONS.MEDIUM.HEIGHT;F=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.HEIGHT;A=b.MEDIA_THUMBNAIL.DIMENSIONS.XLARGE.HEIGHT}}else{if(d(C)){y="picture";z=b.PICTUREVIEW_V0.DIMENSIONS.SMALL.WIDTH;D=b.PICTUREVIEW_V0.DIMENSIONS.MEDIUM.WIDTH;F=b.PICTUREVIEW_V0.DIMENSIONS.LARGE.WIDTH}else{y="thumb";z=b.MEDIA_THUMBNAIL.DIMENSIONS.SMALL.WIDTH;D=b.MEDIA_THUMBNAIL.DIMENSIONS.MEDIUM.WIDTH;F=b.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.WIDTH;A=b.MEDIA_THUMBNAIL.DIMENSIONS.XLARGE.WIDTH}}if(r==="whats-new-mode"){if(w){if(w<z){B="s"}else{if(w<D){if(u<=z){B="s"}else{B="m"}}else{if(u<=z){B="s"}else{if(u<=D){B="m"}else{B="l"}}}}}else{if(u){if(u<=z){B="s"}else{if(u<=D){B="m"}else{B="l"}}}else{throw new Error("Dimensions not available to calculate the best thumbnail")}}}else{if(w){if(w<D){B="s"}else{if(w<F){if(u<D){B="s"}else{B="m"}}else{if(A){if(w<A){if(u<D){B="s"}else{if(u<F){B="m"}else{B="l"}}}else{if(u<D){B="s"}else{if(u<F){B="m"}else{if(u<A){B="l"}else{B="xl"}}}}}else{if(u<D){B="s"}else{if(u<F){B="m"}else{B="l"}}}}}}else{if(u){if(u<D){B="s"}else{if(u<F){B="m"}else{if(A){if(u<A){B="l"}else{B="xl"}}else{B="l"}}}}else{throw new Error("Dimensions not available to calculate the best thumbnail")}}}if(d(C)){x=a.constructPictureViewUrl(C.get("mid"),B,e(C,"preview_fingerprint"));p=M.TYPE;v=M.KEY;E=b.PICTUREVIEW_V0.DIMENSIONS;switch(B){case"s":k=v.SMALL;if(K){H=E.SMALL.WIDTH;G=H/I}else{G=E.SMALL.HEIGHT;H=G*I}break;case"m":k=v.MEDIUM;if(K){H=E.MEDIUM.WIDTH;G=H/I}else{G=E.MEDIUM.HEIGHT;H=G*I}break;case"l":k=v.LARGE;if(K){H=E.LARGE.WIDTH;G=H/I}else{G=E.LARGE.HEIGHT;H=G*I}break}}else{x=a.constructThumbnailUrl("media",C.get("mid"),B+"_thumb",e(C,"preview_fingerprint"));p=J.TYPE;h=J.KEY;q=b.MEDIA_THUMBNAIL.DIMENSIONS;I=4/3;switch(B){case"s":k=h.SMALL;if(K){H=q.SMALL.WIDTH;G=H/I}else{G=q.SMALL.HEIGHT;H=G*I}break;case"m":k=h.MEDIUM;if(K){H=q.MEDIUM.WIDTH;G=H/I}else{G=q.MEDIUM.HEIGHT;H=G*I}break;case"l":k=h.LARGE;if(K){H=q.LARGE.WIDTH;G=H/I}else{G=q.LARGE.HEIGHT;H=G*I}break;case"xl":k=h.XLARGE;if(K){H=q.XLARGE.WIDTH;G=H/I}else{G=q.XLARGE.HEIGHT;H=G*I}break}}}return{previewType:y,url:x,size:B,width:H,height:G,spriteKey:k,spriteType:p}};return b});define("DS/SwymUIComponents/script/feature/core/conversation/view/topic-modal",["UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","i18n!DS/SwymUIComponents/assets/nls/feature/core/conversation/view/topic-modal"],function(f,b,a,c,e){var d=b.extend({_dmModel:null,_topicText:null,_okButton:null,_cancelButton:null,_resetButton:null,init:function(g){this._dmModel=g.model;g.className="topic-modal";this._parent(g);this.setHeader("<h4>"+e.ConversationTopic+"</h4>");this._buildBody();this._buildButtons();this.setFooter([this._resetButton,this._okButton,this._cancelButton])},_buildBody:function(){var h=this,g=this._dmModel.get("topic");this._topicText=new c({placeholder:e.TopicName,value:g?g:""});this._topicText.elements.input.addEvent("input",function(){if(event.currentTarget.value!==""){h._clearButton.show();h._resetButton.show()}else{h._clearButton.hide();h._resetButton.hide()}});this._clearButton=f.createElement("span",{"class":"clear-button fonticon fonticon-clear"});this._clearButton.addEvent("click",function(){h._topicText.setValue("");h._clearButton.hide();h._resetButton.hide()});if(!g){this._clearButton.hide()}var i=f.createElement("div",{"class":"wrapper",html:[this._topicText,this._clearButton]});this.setBody([{"class":"topic-message",html:e.EnterTopic},i])},_buildButtons:function(){var h=this,g=this._dmModel.get("topic");this._okButton=new a({value:e.Ok,className:"primary",events:{onClick:function(){var i=h._topicText.getValue();h._saveTopic(i)}.bind(this)}});this._cancelButton=new a({value:e.Cancel,events:{onClick:function(){this.hide()}.bind(this)}});this._resetButton=new a({value:e.ResetTopic,className:"error",events:{onClick:function(){h._saveTopic("")}.bind(this)}});if(!g){this._resetButton.hide()}},_saveTopic:function(g){var h=this;if(g!==this._dmModel.get("topic")){this._dmModel.setTopic({topic:g,onComplete:function(){h.hide()},onFailure:function(){h.hide();require(["DS/UWPClientControls/PlatformNotify"],function(i){i.error(e.TopicSaveFailure)})}})}else{h.hide()}}});return d});define("DS/SwymUIComponents/script/feature/core/user/view/summary/user-summary-edit-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UIKIT/Input/Text","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/user-summary-edit-view","DS/UIKIT/Form","DS/WebappsUtils/Console"],function(h,g,c,d,f,b,a){var e=g.extend({_modelClass:c,name:"user-summary-edit-view",_createContent:function(){var i=this.model,j=this.addControl("form-aboutme",new b({fields:[{type:"textarea",id:"user-summary",multiline:true,placeholder:f.placeholder,rows:10,value:i.get("tenant_more_about_me",{escapeHTML:false})||"",events:{onChange:function(){i.addChanges("user_infos",this.getValue())}}}]}));return j}});return e});define("DS/SwymUIComponents/script/feature/core/link/view/link-edit-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/link/view/link-edit-view","DS/SwymUICore/script/feature/core/link/model/link-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Form"],function(f,c,b,e,a){var d=e.extend({_modelClass:b,name:"link-edit-view",_createContent:function(){var g=this.model,i=this,h=this.addControl("form-aboutme",new a({fields:[{type:"url",label:c.url,name:"link-url",placeholder:c.enteranURL,required:true,value:g.get("url",{escapeHTML:false}),events:{onChange:function(){g.addChanges("url",this.getValue());var p=i.model.getTypeFromUrl(),k=i.getControl("form-aboutme"),r=k.getInput("type"),q=k.getInput("title");if(p&&k){if(r&&r.getValue()[0]!==p){r.setValue(p);r.setDisabled(true)}if(q){var j=c.title+" "+this.getValue();q.setValue(j);i.model.addChanges("title",j)}}else{if(r&&r.getValue()[0]!=="0"){r.setValue("0");r.setDisabled(false)}}if(i.model.isSocialUrl()&&q){var j=c.title+" "+this.getValue();q.setValue(j);i.model.addChanges("title",j)}var l=k.validate(true);k.getInput("link-url").focus();var n=i.container.getElement(".form-group"),o=f.createElement("div",{"class":"url-example",html:c.urlErrorMessage}),m=n.getElement(".url-example");if(n&&!m){o.inject(n);if(!n.hasClassName("has-error")){o.hide()}}else{if(!n.hasClassName("has-error")){m.hide()}else{m.show()}}i._hideAndShowProperInputs()},onKeyDown:function(k){var j=k.keyCode||k.which;if(j!==9){setTimeout(function(){this.dispatchEvent("onChange")}.bind(this),50)}}}},{type:"select",required:true,name:"type",label:c.type,placeholder:c.selectyourwebsite,options:[{value:"0",selected:g.get("type")==="0",label:c.other},{value:"1",selected:g.get("type")==="1",label:"Facebook"},{value:"2",selected:g.get("type")==="2",label:"Linkedin"},{value:"3",selected:g.get("type")==="3",label:"Viadeo"},{value:"4",selected:g.get("type")==="4",label:"Youtube"},{value:"5",selected:g.get("type")==="5",label:"Certification"},{value:"6",selected:g.get("type")==="6",label:"Flickr"},{value:"7",selected:g.get("type")==="7",label:"Google+"},{value:"8",selected:g.get("type")==="8",label:"Twitter"}],events:{onChange:function(){var l=g.isSocialLink(),j;g.addChanges("type",this.getValue()[0]);j=g.isSocialLink();if(l!==j){var k=i.getControl("form-aboutme");if(k){k.getInput("title").setValue("")}}i._hideAndShowProperInputs()}}},{type:"text",label:c.title,name:"title",required:true,value:g.get("title",{escapeHTML:false}),events:{onChange:function(){g.addChanges("title",this.getValue());i._hideAndShowProperInputs()}}},{type:"textarea",label:c.description,rows:5,value:g.get("description",{escapeHTML:false}),events:{onChange:function(){g.addChanges("description",this.getValue());i._hideAndShowProperInputs()}}}]}));this._hideAndShowProperInputs();return h},_hideAndShowProperInputs:function(){var i=this.getControl("form-aboutme");if(i){var j=i.elements.container.getElements(".form-group"),m=j[0],o=j[1],k=j[2],g=j[3],l=this.model,h=l.getChanges("url")||l.get("url",{escapeHTML:false}),n=l.getChanges("type")||l.get("type"),p=l.getChanges("description")||l.get("description");if(h){o.show();if(l.isSocialLink()){k.hide();i.getInput("title").setValue(""+h);g.hide()}else{k.show();g.show()}}else{o.hide();k.hide();g.hide()}}}});return d});define("DS/SwymUIComponents/script/lib/ckeditor/ckeditor-command-creator",["DS/SwymUICore/script/utils/utils"],function(b){var a={commandList:{h1Style:{command:"h1Command",toolbar:"paragraph",label:"Heading 1",style:"h1",type:"style"},h2Style:{command:"h2Command",toolbar:"paragraph",label:"Heading 2",style:"h2",type:"style"},formattedStyle:{command:"formattedCommand",toolbar:"paragraph",label:"Formatted Style",style:"pre",type:"style"},BulletedListStyle:{command:"BulletedListCommand",toolbar:"paragraph",ckCommand:"bulletedlist",label:"Insert/Remove Bulleted List",style:"ul",type:"command"},NumberedListStyle:{command:"NumberedListCommand",ckCommand:"numberedlist",toolbar:"paragraph",label:"Insert/Remove Numbered List",style:"ol",type:"command"},BlockquoteStyle:{command:"BlockquoteCommand",toolbar:"paragraph",ckCommand:"blockquote",label:"Block Quote",style:"blockquote",type:"command"}},createCommand:function(c){var e=this,d;for(d in e.commandList){if(e.commandList.hasOwnProperty(d)){CKEDITOR.plugins.add(d,{init:function(g){var f=this.name;g.addCommand(e.commandList[f].command,{contextSensitive:true,exec:function(l,j){var i,h,m;if(!j){for(i in l.toolbar){if(l.toolbar.hasOwnProperty(i)&&l.toolbar[i].hasOwnProperty("name")&&l.toolbar[i].hasOwnProperty("items")&&l.toolbar[i].name==="paragraph"){h=l.toolbar[i].items;for(m in h){if(h.hasOwnProperty(m)&&h[m].hasOwnProperty("type")&&h[m].type==="button"&&h[m].getState()===CKEDITOR.TRISTATE_ON&&h[m].command!==e.commandList[f].command){l.execCommand(h[m].command,true)}}}}}if(this.state===CKEDITOR.TRISTATE_ON){if(e.commandList[f].type==="command"){l.execCommand(e.commandList[f].ckCommand)}else{l.removeStyle(new CKEDITOR.style({element:e.commandList[f].style}))}this.setState(CKEDITOR.TRISTATE_OFF)}else{if(e.commandList[f].type==="command"){l.execCommand(e.commandList[f].ckCommand)}else{l.applyStyle(new CKEDITOR.style({element:e.commandList[f].style}))}this.setState(CKEDITOR.TRISTATE_ON)}},refresh:function(i,j){var h=j;if(h.block&&h.block.getName()){h=h.block.getName();if(h==="p"||h==="li"){h=j.block.getParent().getName()}if(h===e.commandList[f].style){this.setState(CKEDITOR.TRISTATE_ON)}else{this.setState(CKEDITOR.TRISTATE_OFF)}}}});g.ui.addButton(e.commandList[f].command,{label:e.commandList[f].label,command:e.commandList[f].command,toolbar:e.commandList[f].toolbar})}})}}}};return a});define("DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-definition",["UWA/Core","UWA/Class/Options"],function(g,h){var i=undefined,a=undefined,f="root",j="/",e=":",c=new RegExp("\\"+e+"([A-Za-z0-9-_]+)?","g");function k(m,n,o,l){n=n||"";o=o||{};l=l||{};Object.keys(m).forEach(function(s){var r=m[s],p=n+(n&&s?j:"")+s,q=new RegExp("(^"+p+")(\\"+j+".*|$.*)");r.config=g.extend(g.clone(o),r.config,true);l[p]=r.config;if(r.branches){k(r.branches,p,r.config,l)}if(r.aliases){r.aliases.forEach(function(t){var u=n+(n&&t?j:"")+t;Object.keys(l).forEach(function(v){var w;if(v.match(q)){w=v.replace(q,u+"$2");if((w.length>1)&&(w.substr(0,1)==="/")){w=w.substr(1)}l[w]=l[v]}})})}});return l}function b(m,o,n){var l={},p=m.pages;if(p){o.forEach(function(r,q){l[p[q]]=r})}i=g.extend(m.branches?g.clone(m.branches):{},l,true);a=k(g.clone(i),"",m.config);n.callback.call(null,a)}var d=h.singleton({defaultOptions:{root:null},parseRoute:function(m){var l=[],n=m||"";if(g.is(m,"string")){l=m.match(c);if(l){n=m.replace(c,"");if(n.endsWith(j)){n=n.slice(0,n.length-1)}}else{l=[]}}return{route:n,values:l}},getRootViewsDefinition:function(n){var m,o,l=this.getOption("root");if(l){o=this.getNode(n).layoutDefinition;m=g.extend({},l.views);Object.keys(m).forEach(function(p){if(!(g.owns(o,p)&&o[p])){delete m[p]}});return m}else{throw new Error("Layout tree has not been created yet")}},getNode:function(m){var p,q,n,l,o=this.getOption("root").homePage;if(a){q=this.parseRoute(m).route;n=a[q];if(!n){p=m.split(j);if(m&&p.length>1){l=this.getNode(p.slice(0,p.length-1).join(j))}else{if(g.is(o)){l={layoutDefinition:a[o],layoutRoute:o}}}l.initialLayoutRoute=q;l.failedToFindRequestedNode=true}else{l={layoutDefinition:n,layoutRoute:q,initialLayoutRoute:q,failedToFindRequestedNode:false}}return l}else{throw new Error("Layout tree has not been created yet")}},getTree:function(l){var n=this,m=[];if(g.is(a)&&(l.reset!==true)){l.callback.call(null,a)}else{if(!l.pageModulesPath.endsWith("/")){l.pageModulesPath+="/"}require([l.pageModulesPath+f],function(o){n.setOption("root",o);if(o.pages){m=o.pages.map(function(p){return l.pageModulesPath+p})}if(m.length>0){require(m,function(){b(o,Array.prototype.slice.call(arguments),l)},function(){throw new Error("Could not load page definitions")})}else{b(o,[],l)}},function(){throw new Error("Could not load root page definition")})}}});return d});define("DS/SwymUIComponents/script/feature/core/ui-components/box-view/box-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/ui-components/box-view/box-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/utils","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/WebappsUtils/Console"],function(h,f,g,e,a,c,b){var d=g.extend({name:"box-view",_modelEventsForAutoRefresh:["onChange"],_createContent:function(){var i,j="",k=e.isFeatureActivated("activateAccount");if(this.model.collection.getAssociated("user").isCurrentUser()){j='<span class ="fonticon fonticon-2x cursor-pointer fonticon-down-open"></span>'}i=h.createElement("div",{"class":"border-box-view"+(k?"":" row"),html:[{"class":(k?"":"col-xs-12 ")+"box-view-line",html:[{"class":"box-view-title",html:this._getHTMLContent()+(k?j:"")},{"class":"box-view-icons level-"+this.model.getLevelFromDBToJS(),html:k?this._getStarsHtml():(this._getStarsHtml()+j)}]},{"class":"profile-box-details",html:this._getDetails()}]});this.addControl("dropdown",new c({target:i.getElement(".fonticon-down-open"),items:[{text:f.Edit,fonticon:"pencil"},{text:f.Delete,fonticon:"trash"}],events:{onClick:function(m,l){if(l.fonticon==="pencil"){this.model.dispatchEvent("onPencilIconClicked")}else{if(l.fonticon==="trash"){this.model.dispatchEvent("onTrashIconClicked")}}}.bind(this)}}));return i},_getHTMLContent:function(){return this.model.get("title")||this.model.get("translated")||this.model.get("lang_english")},_getStarsHtml:function(){var r=e.isFeatureActivated("activateAccount"),p='<span class="fonticon fonticon-1-5x active-blue fonticon-star"></span>',m=r?'<span class="fonticon fonticon-favorite-off"></span>':'<span class="fonticon fonticon-1-5x unactive-blue fonticon-star"></span>',q="",l=this.model.getLevelFromDBToJS();for(var n=0;n<l;n++){q+=p}for(var o=0,k=3-l;o<k;o++){q+=m}return q},_getDetails:function(){return this.model.get("description")||""}});return d});define("DS/SwymUIComponents/script/feature/community/content/view/community-content-overlay-view",["UWA/Core","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view"],function(h,a,d,c,f,g){var e=c.getInstance(),b=d.extend({_delegateSpriteReloadToParentView:false,name:"content-overlay-view",className:"fade-in-animation",imageReloadOptions:{size:"xl"},defaultOptions:{itemView:null,ContentListClass:"DS/SwymUIComponents/script/feature/community/content/view/content-list-view",addBackArrow:true},_onContextChange:function(){var i=this;if(e.isContentContext()){require([a.getModuleNameFromModelName(e.contentType),this.getOption("ContentListClass")],function(l,o){if(e.isContentContext()&&!i.isDestroyed()){var m=i.getChildView("itemView"),n=new l({mid:e.contentId,community_id:e.communityId}),k=i.getChildView("backArrowView"),j=(e&&e.isContentContext()&&e.contentType==="wiki");if(!m||!n.equals(m.model)){if(j){if(m&&m.model.getModelName()==="wiki"&&n.get("mid")){i.getChildView("itemView").removeChildView("editView");i.getChildView("itemView").setModel(n)}else{m=i.addChildView("itemView",o.prototype.createItemView(n))}if(window.ds&&window.ds.swymIM===true){i.listenTo(m,"onScrollToElement",function(p){i.getScroller()&&i.getScroller().scrollToElement(p)})}}else{i.container&&i.container.empty();m=i.addChildView("itemView",o.prototype.createItemView(n))}}if(m){if(e.isContentEditionContext()){m.switchToEditView()}else{m.switchToDetailedView()}}if(!i.isRendered()){i.render()}else{if(!i.container.contains(m.container)){i.refresh()}}if(j||e.isContentEditionContext()){k&&k.hide()}else{k&&k.show()}}})}},setup:function(){this._parent.apply(this,arguments);this._onContextChange=this._onContextChange.bind(this);if(this.getOption("addBackArrow")!==false){if(this._widget.getAppName()===f.getContentReaderAppKey()){if(e.previousAttributes.path==="home"){this.addChildView("backArrowView",{Class:"DS/SwymUIComponents/script/feature/core/ui-components/back-arrow-view",model:this.model,backArrowText:g.ContentList})}}else{this.addChildView("backArrowView",{Class:"DS/SwymUIComponents/script/feature/core/ui-components/back-arrow-view",model:this.model})}}if(e.addListener("onContextChange",this._onContextChange,this,true)===true){this._onContextChange()}},_createContent:function(){var j=(e&&e.isContentContext()&&e.contentType==="wiki")||e.isContentEditionContext(),i=this.getChildView("backArrowView");if(j&&i){i.hide()}return[i?i:"",this.getChildView("itemView")]},onUnMaximize:function(){var i=this.getChildView("itemView");if(i){this.container.empty();i.destroy()}},destroy:function(){e.removeListener("onContextChange",this._onContextChange);return this._parent.apply(this,arguments)}});return b});define("DS/SwymUIComponents/script/feature/core/user/view/idcard/user-idcard-edit-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Form","DS/WebappsUtils/Console","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/idcard/user-idcard-edit-view"],function(f,e,c,b,d){var a=e.extend({name:"user-idcard-edit-view",_createContent:function(){var h=this.model,j=h.getPassportAttributeConstraints("first_name"),i=h.getPassportAttributeConstraints("last_name"),g=this.addControl("idcard1-form",new c({className:"inline",fields:[f.merge({type:"text",label:d.firstName,placeholder:d.firstName,value:h.get("first_name")?h.get("first_name").unescapeHTML():"",events:{onChange:function(){h.addChanges("first_name",this.getValue(),{force:true})}}},j),f.merge({type:"text",label:d.lastName,placeholder:d.lastName,value:h.get("last_name")?h.get("last_name").unescapeHTML():"",events:{onChange:function(){h.addChanges("last_name",this.getValue(),{force:true})}}},i)]}));return[g]}});return a});define("DS/SwymUIComponents/script/lib/ckeditor/highlight/plugin",["DS/SwymUICore/script/utils/utils","DS/WebappsUtils/WebappsUtils","i18n!DS/SwymUIComponents/assets/nls/lib/ckeditor/highlight/highlight"],function(b,a,c){CKEDITOR.plugins.add("highlight",{icons:"highlight",style:{element:"span",attributes:{"class":"marker"}},init:function(d){var e=this;if(d._.menuItems.link){delete d._.menuItems.link}d.addCommand("highlight",{contextSensitive:true,exec:function(g,f){if(this.state===CKEDITOR.TRISTATE_ON){g.removeStyle(new CKEDITOR.style(e.style));this.setState(CKEDITOR.TRISTATE_OFF)}else{g.applyStyle(new CKEDITOR.style(e.style))}},refresh:function(h,j){var f=h.getSelection().getRanges()[0],g=f.startContainer.$,i=true;while(g.parentNode&&g.parentNode.getAttribute&&g.parentNode.getAttribute("id")!==h.name&&i){if(g&&g.nodeName==="SPAN"&&g.getAttribute("class")==="marker"){this.setState(CKEDITOR.TRISTATE_ON);i=false}else{this.setState(CKEDITOR.TRISTATE_OFF)}g=g.parentNode}}});d.ui.addButton("Highlight",{label:c.highlight,command:"highlight",toolbar:"basicstyles",icon:a.getWebappsBaseUrl()+"SwymUIComponents/assets/ckeditor/highlight.png"})}})});define("DS/SwymUIComponents/script/utils/scrollview-utils",["UWA/Core"],function(c){var a={},b=function(d,e){var g=this,f=e||{};d=d||1;if(c.is(g.getFilteringOptions,"function")){c.merge(f,g.getFilteringOptions(g.taggerFilters,g.exaleadFilters,{data:(g.lastCalledService==="filter")?{query:g.exaleadQuery}:{}}))}g.fetchPage(d,f)};a.onInfiniteScroll=function(){var i=this,g=this.collection,h=g.getCurrentPage(),j=(h===null)?1:h+1,f,l=(i&&i.constructor===Object)?i.options:null,e=(l&&l.hasNext)?l.hasNext:"hasNext",d=(l&&l.endLoading)?l.endLoading:"endLoading",k=(l&&l.useInfiniteScroll)?l.useInfiniteScroll:"useInfiniteScroll";if(g[e]()){f=c.extend({reset:false,add:true,remove:false},l||{});f.onComplete=function(){if(i.container){i.container.removeClassName("hidden-empty-view")}if(i.scrollView&&i.scrollView.scroller){g.addEventOnce("onSync",function(){if(g[e]()){i.scrollView[d]();i.scrollView[k](true)}else{i.scrollView[k](false)}})}if(l&&l.onComplete){l.onComplete.apply(g,arguments)}};f.onFailure=function(){if(i.container){i.container.removeClassName("hidden-empty-view")}if(i.scrollView&&i.scrollView.scroller){i.scrollView[k](false)}if(l&&l.onFailure){l.onFailure.apply(g,arguments)}};b.call(g,j,f)}else{if(i.container){i.container.removeClassName("hidden-empty-view")}if(i.scrollView&&i.scrollView.scroller){if(!g.hasBeenFetched()){g.addEventOnce("onSync",function(){if(g[e]()){i.scrollView[d]();i.scrollView[k](true)}else{i.scrollView[k](false)}})}else{i.scrollView[k](false)}}}};a.fetchWithSavedFilters=b;a.onPullToRefresh=function(){var d=this;this.collection.fetchPage(1,{reset:true,onComplete:function(){if(d.scrollView){d.scrollView.endLoading()}},onFailure:function(){if(d.scrollView){d.scrollView.endLoading()}}})};return a});define("DS/SwymUIComponents/script/feature/community/community/view/community-feature-settings-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-feature-settings-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Select","DS/WebappsUtils/Console"],function(j,g,i,h,n,m,b,d){var e=true;var c=false;var f=1;var k=2;var l=function(p,o){var q;if(!(q=p.getChanges(o))){q=p.get(o)}return q};var a=i.extend({_modelClass:h,attributes:{tag:"div"},onAcceptChange:function(q){var p,o;if((o=this.getElement(".featureContainer"))&&this.acceptStatement.isChecked()){o.show()}var r=q.target||q.srcElement;if(r.checked){this.dispatchEvent("enableSave")}else{this.dispatchEvent("disableSave")}},onFeatureToggle:function(r){var q=this.view,p=q.model,o=this.toggle;if(o===q.ideaFeatureToggle){if(o.isChecked()){p.addChanges({ideation_is_enabled:e,ideation_min_acl:k},{force:true});if(r!==false){q.ideaCreationChkBox.enable();q.ideaCreationChkBox.uncheck()}}else{p.addChanges({ideation_is_enabled:c,ideation_min_acl:k},{force:true});if(r!==false){q.ideaCreationChkBox.uncheck();q.ideaCreationChkBox.disable()}}}else{if(o===q.surveyFeatureToggle){if(o.isChecked()){p.addChanges({survey_is_enabled:e,survey_min_acl:k},{force:true});if(r!==false){q.surveyCreationChkBox.enable();q.surveyCreationChkBox.uncheck()}}else{p.addChanges({survey_is_enabled:c,survey_min_acl:k},{force:true});if(r!==false){q.surveyCreationChkBox.uncheck();q.surveyCreationChkBox.disable()}}}else{if(o===q.iQFeatureToggle){if(o.isChecked()){p.addChanges({qna_is_enabled:e,qna_min_acl:k},{force:true});if(r!==false){q.iQCreationChkBox.enable();q.iQCreationChkBox.uncheck()}}else{p.addChanges({qna_is_enabled:c,qna_min_acl:k},{force:true});if(r!==false){q.iQCreationChkBox.uncheck();q.iQCreationChkBox.disable()}}}else{if(o===q.wikiFeatureToggle){if(o.isChecked()){p.addChanges({wiki_is_enabled:e,wiki_min_acl:k},{force:true});if(r!==false){q.wikiCreationChkBox.enable();q.wikiCreationChkBox.uncheck()}}else{p.addChanges({wiki_is_enabled:c,wiki_min_acl:k},{force:true});if(r!==false){q.wikiCreationChkBox.uncheck();q.wikiCreationChkBox.disable()}}}else{if(o===q.messageFeatureToggle){p.addChanges({instant_message_is_enabled:o.isChecked()},{force:true})}}}}}},onFeatureCreationToggle:function(){var q=this.view,p=q.model,o=this.toggle;if(o===q.ideaCreationChkBox){if(o.isChecked()){p.addChanges({ideation_min_acl:f},{force:true})}else{p.addChanges({ideation_min_acl:k},{force:true})}}else{if(o===q.surveyCreationChkBox){if(o.isChecked()){p.addChanges({survey_min_acl:f},{force:true})}else{p.addChanges({survey_min_acl:k},{force:true})}}else{if(o===q.iQCreationChkBox){if(o.isChecked()){p.addChanges({qna_min_acl:f},{force:true})}else{p.addChanges({qna_min_acl:k},{force:true})}}else{if(o===q.wikiCreationChkBox){if(o.isChecked()){p.addChanges({wiki_min_acl:f},{force:true})}else{p.addChanges({wiki_min_acl:k},{force:true})}}}}}},_createContent:function(){var t=this.model,s=l(t,"wiki_is_enabled"),C=parseInt(l(t,"wiki_min_acl"),10),B=l(t,"ideation_is_enabled"),p=parseInt(l(t,"ideation_min_acl"),10),F=l(t,"survey_is_enabled"),I=parseInt(l(t,"survey_min_acl"),10),H=l(t,"qna_is_enabled"),r=parseInt(l(t,"qna_min_acl"),10),v=parseInt(t.get("this").getCurrentUserRights,10),G=l(t,"instant_message_is_enabled"),A=parseInt(l(t,"stats_min_acl"),10);var x=[];var D=1,w="";var y=t.isIdeationContributorCreationEnabledInSettings(B,p);var E=t.isSurveyContributorCreationEnabledInSettings(F,I);var u=t.isContributorCreationEnabledInSettings(H,r);var o=t.isContributorCreationEnabledInSettings(s,C);var J={display:"none"};var z={};while(D<=4){switch(D){case 4:w=g.Disabled;break;case 3:w=g.Owners;break;case 2:w=g.OwnersAndAuthors;break;case 1:w=g.All;break}if(A===D){x.push({value:D,selected:true,label:w})}else{x.push({value:D,label:w})}D++}var q=UWA.createElement("div",{html:[{tag:"h5",html:g.Communityfeatures},{tag:"div","class":"msgContainer",styles:J,html:{tag:"div","class":"msgBody bg-error",html:[{tag:"p",html:g.IncompatibilityMessage},(this.acceptStatement=new m({type:"checkbox",label:g.AcceptStatement,events:{onChange:this.onAcceptChange.bind(this)}}))]}},{tag:"div","class":"featureContainer",styles:z,html:[{tag:"div","class":"feature",html:[(this.iQFeatureToggle=new m({className:"inline feature-toggle",checked:H,type:"switch",label:""})),{tag:"div","class":"feature-title",html:g.iQuestions},(this.iQCreationChkBox=new m({className:"inline primary feature-toggle",type:"checkbox",checked:u,disabled:!H,label:g.Allowcontributortocreate}))]},{tag:"div","class":"feature",html:[(this.ideaFeatureToggle=new m({className:"inline feature-toggle",checked:B,type:"switch",label:""})),{tag:"div","class":"feature-title",html:g.Ideas},(this.ideaCreationChkBox=new m({className:"inline primary feature-toggle",type:"checkbox",checked:y,disabled:!B,label:g.Allowcontributortocreate}))]},{tag:"div","class":"feature",html:[(this.surveyFeatureToggle=new m({className:"inline feature-toggle",checked:F,type:"switch",label:""})),{tag:"div","class":"feature-title",html:g.Surveys},(this.surveyCreationChkBox=new m({className:"inline primary feature-toggle",type:"checkbox",checked:E,disabled:!F,label:g.Allowcontributortocreate}))]},n.getInstance().isFeatureActivated("active_wiki")?{tag:"div","class":"feature",html:[(this.wikiFeatureToggle=new m({className:"inline feature-toggle",checked:s,type:"switch",label:""})),{tag:"div","class":"feature-title",html:g.Wiki},(this.wikiCreationChkBox=new m({className:"inline primary feature-toggle",type:"checkbox",checked:o,disabled:!s,label:g.Allowcontributortocreate}))]}:"",(window.ds&&window.ds.swymIM===true&&this._widget&&this._widget.getBool("showIMSetting")===true)?{"class":"feature",html:[(this.messageFeatureToggle=new m({className:"inline feature-toggle",checked:G,type:"switch",label:""})),{"class":"feature-title",html:g.Messages}]}:"",n.getInstance().isFeatureActivated("activate_community_stats_panel_access")?{tag:"div","class":"feature",html:[{tag:"div",styles:{"vertical-align":"bottom"},"class":"feature-title",html:g.StatisticsAvailableFor},new b({name:"stats",className:"feature-select",placeholder:false,options:x,events:{onChange:function(L){var M,K=this.model;if(L&&L.target&&(M=L.target.value)){K.addChanges("stats_min_acl",M)}}.bind(this)}})]}:""]}]});this.ideaFeatureToggle.addEvent("onChange",this.onFeatureToggle.bind({view:this,toggle:this.ideaFeatureToggle}));this.surveyFeatureToggle.addEvent("onChange",this.onFeatureToggle.bind({view:this,toggle:this.surveyFeatureToggle}));this.iQFeatureToggle.addEvent("onChange",this.onFeatureToggle.bind({view:this,toggle:this.iQFeatureToggle}));if(this.messageFeatureToggle){this.messageFeatureToggle.addEvent("onChange",this.onFeatureToggle.bind({view:this,toggle:this.messageFeatureToggle}))}if(n.getInstance().isFeatureActivated("active_wiki")){this.wikiFeatureToggle.addEvent("onChange",this.onFeatureToggle.bind({view:this,toggle:this.wikiFeatureToggle}));this.wikiCreationChkBox.addEvent("onChange",this.onFeatureCreationToggle.bind({view:this,toggle:this.wikiCreationChkBox}))}this.ideaCreationChkBox.addEvent("onChange",this.onFeatureCreationToggle.bind({view:this,toggle:this.ideaCreationChkBox}));this.surveyCreationChkBox.addEvent("onChange",this.onFeatureCreationToggle.bind({view:this,toggle:this.surveyCreationChkBox}));this.iQCreationChkBox.addEvent("onChange",this.onFeatureCreationToggle.bind({view:this,toggle:this.iQCreationChkBox}));return q}});return a});define("DS/SwymUIComponents/script/feature/core/ui-components/list/dynamic-grid",["UWA/Core","UWA/Class","UWA/Array"],function(h,c,a){var e={autoResize:false,itemSelector:undefined,layout:"medium",offset:5,outerOffset:0,onLayoutChanged:undefined,resizeDelay:50,verticalOffset:undefined,variableSizeItem:true},b={small:[{min:0,columns:1},{min:500,columns:2},{min:768,columns:3},{min:1024,columns:4}],medium:[{min:0,columns:1},{min:768,columns:2},{min:1024,columns:3}],large:[{min:0,columns:1},{min:768,columns:2}]},g="dyngrid";var d=window.requestAnimationFrame||function(i){i()},f=c.extend({items:null,container:null,columns:null,resizeTimeoutID:null,activeItemCount:0,itemHeightsInitialized:false,itemHeightsDirty:false,autoResize:false,_oldContainerWidth:null,layout:null,offset:null,verticalOffset:null,_collectionHasBeenReset:false,init:function(i,j){j=j||{};if(typeof i==="string"){i=document.querySelector(i)}this.updateOptions(e);this.updateOptions(j);this._setContainer(i);this.fetchItems();if(this.autoResize){window.addEventListener("resize",this.onResize.bind(this))}return this},_getWidth:function(i){return i.getSize().width},_bulkSetStyles:function(i){d(function(){i.forEach(function(j){j.el.setStyles(j.css)})})},_isHidden:function(i){return i.offsetParent===null},_setContainer:function(i){this.container=i;this.container.addClassName("dynamic-grid "+this.getLayout()+"-layout"+(this.variableSizeItem===true?" variable-size-items":""));return this},fetchItems:function(){if(this.handledView&&this.modelViewsAsItems===true){this.items=this.handledView.getModelViews().map(function(i){if(!i.isRendered()){i.render()}return i.container})}else{if(this.itemSelector===undefined){this.items=this.container.getElement(".item-list-body")?this.container.getElement(".item-list-body").getChildren():null}else{this.items=this.container.getElements(this.itemSelector)}}this.itemHeightsDirty=true;return this},_getItemDataHeight:function(j,i){return j.getAttribute("data-"+g+i)},_setItemDataHeight:function(j,i,k){j.setAttribute("data-"+g+i,k)},updateOptions:function(i){var j;i=i||{};this.itemHeightsDirty=true;for(j in i){if(i.hasOwnProperty(j)){this[j]=i[j]}}this.verticalOffset=this.verticalOffset||this.offset;return this},onResize:function(){clearTimeout(this.resizeTimeoutID);this.resizeTimeoutID=setTimeout(this.render.bind(this),this.resizeDelay)},onRefresh:function(){this.itemHeightsDirty=true;this.render()},getLayout:function(){if((this.variableLayout===true)&&(this.items.length<3)){return"large"}else{return this.layout||"medium"}},_getColumnsLayout:function(){return b[this.getLayout()]},_getColumnNumber:function(j){var k=this._getColumnsLayout(),i=a.detect(k,function(m,l){return l===k.length-1||k[l+1].min>j});return i.columns},_getItemWidth:function(){var k=this._getWidth(this.container)-2*this.outerOffset,i=this._getColumnNumber(k),j=Math.floor((k-((i-1)*this.offset))/i);return j},render:function(j,t,u){console.info("dyngrid::render");console.info("this._oldContainerWidth === this._getWidth(this.container): ",this._oldContainerWidth===this._getWidth(this.container));console.info("this.items.length === this.activeItemCount: ",this._oldContainerWidth===this._getWidth(this.container));if(!this.items||this._isHidden(this.container)||((this._oldContainerWidth===this._getWidth(this.container)&&(!u||u.incrementalUpdateForExistingColumns!==true))&&this.items.length===this.activeItemCount&&this._collectionHasBeenReset===false)){return this}var l=this._getItemWidth(),k=l+this.offset,s=this._getWidth(this.container),r=s-2*this.outerOffset,v=Math.floor((r+this.offset)/k),n=this.outerOffset,o=null,i=this.items,q=i.length,m=this.container.getElement(".container-column"),p=this;console.info("layout:"+this.layout+", nbColumns:"+v);if(this._oldContainerWidth!==s){console.info("this.itemHeightsDirty set to true;");this.itemHeightsDirty=true}if(this.itemHeightsDirty||!this.itemHeightsInitialized){console.info("itemHeightsDirty");this.items.forEach(function(w){if(!m||(this.variableSizeItem!==true)){w.setStyle("width",l)}p._setItemDataHeight(w,"height",w.offsetHeight);if(this.variableSizeItem===true){w.setStyle("width","")}},this);this.itemHeightsDirty=false;this.itemHeightsInitialized=true}o=this._renderFull(k,v,n,u);this.activeItemCount=q;if(this.variableSizeItem!==true){this.container.setStyle("height",o)}console.info("maxColumnHeight: ",o);if(this.onLayoutChanged!==undefined&&typeof this.onLayoutChanged==="function"){this.onLayoutChanged()}if(typeof t==="function"){t(this.items)}this._oldContainerWidth=s;return this},_renderFull:function(q,I,r,o){console.info("_renderFull");var C=0,u=this,H,p,D,w,G,j=this.items,m=null,y=null,v=null,A,E=[],l=[],k=[],t=null,s=[],n=null,z=this.container.getElements(".container-column"),F=z[0],B=(o&&o.incrementalUpdateForExistingColumns===true),x=[];this.columns=[];while(E.length<I){E.push(this.outerOffset);this.columns.push([])}if(typeof(this.handledView&&this.handledView.getBody)==="function"){n=this.handledView.getBody()}else{if(F){n=F.getParent()}else{n=j[0]&&j[0].getParent()}}if(this.variableSizeItem===true){k=[].concat(z);for(C=0;C<I;C++){if(!k[C]){k[C]=h.createElement("div",{"class":"container-column"});if(n){k[C].inject(n,"bottom")}}}if(I<z.length){while(k.length>I){k.pop().remove()}}k.forEach(function(J,i){p=J.getChildren();x[i]=p})}j.forEach(function(i){m=E[0];y=0;for(C=0;C<I;C++){if(E[C]<m){m=E[C];y=C}}v=y;A=r;if(y>0){A+=y*q}if(u.variableSizeItem===true){if(B===true){H=i.getParent();if(H&&H.hasClassName("container-column")){G=k.indexOf(H)}else{G=-1}if((G!==-1)&&(E[G]===E[y])){v=G}w=u.columns[v].length;D=x[v]&&x[v][w];t=k[v];if(D){if(i!==D){i.inject(D,"before");if(G!==-1){x[G].splice(x[G].indexOf(i),1)}x[v].splice(w,0,i)}}else{if(t){i.inject(t,"bottom");if(G!==-1){x[G].splice(x[G].indexOf(i),1)}x[v].push(i)}}}else{i.inject(k[v],"bottom")}E[v]+=parseInt(u._getItemDataHeight(i,"height"),10)+u.verticalOffset}else{l.push({el:i,css:{position:"absolute",top:m,left:A}});E[v]+=parseInt(u._getItemDataHeight(i,"height"),10)+u.verticalOffset}u.columns[v].push(i)});if(this.variableSizeItem===true){u.columns.forEach(function(J,i){if(J.length>0){s.push(k[i])}});if(n&&s.length>0){k.forEach(function(i){if(i.parentElement!==n){i.inject(n)}})}}else{this._bulkSetStyles(l)}return Math.max.apply(Math,E)},_renderColumns:function(l,p){console.info("_renderColumns");var r=[],s=[],o=0,q=this.columns.length,m,n,t,j;while(q--){m=this.outerOffset;r.push(m);n=this.columns[q];j=q*l+p;for(o=0;o<n.length;o++){t=n[o];s.push({el:t,css:{top:m,left:j}});m+=parseInt(this._getItemDataHeight(t,"height"),10)+this.verticalOffset}r[q]=m}this._bulkSetStyles(s);return Math.max.apply(Math,r)},clear:function(){clearTimeout(this.resizeTimeoutID);if(this.autoResize){window.removeEventListener("resize",this.onResize.bind(this))}},setCollectionHasBeenReset:function(i){this._collectionHasBeenReset=i}});return f});define("DS/SwymUIComponents/script/feature/core/tenant/view/super-user-button-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/super-user-button-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Button"],function(e,c,d,a){var b=d.extend({_modelEvents:{onChange:"refresh"},name:"super-user-button-view",_createContent:function(){var f=this.model;if(f){this.addControl("superUserButton",new a({className:(f.get("tenant_su")==="1"?"warning":"primary")+" become-a-super-user",value:(f.get("tenant_su")==="1"?c.ExitSuperUserMode:c.EnterSuperUserMode),events:{onClick:function(){if(f.get("tenant_su")==="0"){f.setAccess({onComplete:function(){this.getControl("superUserButton").setClassName("warning become-a-super-user");this.getControl("superUserButton").setValue(c.ExitSuperUserMode);this.getElement(".message-box").setHTML(c.Ifyouwanttoremove);f.set("tenant_su","1");this.alert("success",c.Youenteredmoderationmode);window.location.reload()}.bind(this)})}else{f.unsetAccess({onComplete:function(){this.getControl("superUserButton").setClassName("primary become-a-super-user");this.getControl("superUserButton").setValue(c.EnterSuperUserMode);this.getElement(".message-box").setHTML(c.Ifyouwanttoaccess);f.set("tenant_su","0");this.alert("success",c.Youexitedmoderationmode);window.location.reload()}.bind(this)})}}.bind(this)}}));return{html:[{"class":"message-box",styles:{"margin-bottom":"10px"},html:(f.get("tenant_su")==="1"?c.Ifyouwanttoremove:c.Ifyouwanttoaccess)},this.getControl("superUserButton")]}}}});return b});define("DS/SwymUIComponents/script/feature/core/ui-components/tooltip/responsive-button-tooltip",["UWA/Core","DS/UIKIT/Tooltip"],function(c,b){var a=b.extend({defaultOptions:{btnMaxWidth:42},show:function(){if(this.getOption("target")&&this.getOption("target").getSize().width<=this.getOption("btnMaxWidth")){return this._parent.apply(this,arguments)}}});return a});define("DS/SwymUIComponents/script/feature/community/content/edit/emoji-selector-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/utils/utils","DS/WebappsUtils/WebappsUtils","text!DS/i3DXUXEmojis/assets/configuration/emoji-configuration.json","css!DS/i3DXUXEmojis/i3DXUXEmojis"],function(d,a,c,b,e){return a.extend({name:"emoji-selector-view",_emojiConf:null,_emojiKeys:[],domEvents:{"click [data-emoji-unicode]":"_onEmojiClick"},setup:function(g){this._emojiConf=JSON.parse(e).emojis;this._emojiKeys=Object.keys(this._emojiConf);var i,h,f;this._emojiKeys.sort(function(k,j){i=this._emojiConf[k].group;h=this._emojiConf[j].group;if(h===i){f=0}else{if(h>i){f=1}else{f=-1}}return f}.bind(this));this._parent.apply(this,arguments)},_onEmojiClick:function(g){var h=g.target,f;if(h){f=h.getAttribute("data-emoji-unicode");this.dispatchEvent("onEmojiClick",{unicode:this._emojiConf[f].unicode})}},_createContent:function(){var f=[];this._emojiKeys.forEach(function(g){f.push({tag:"span","data-emoji-unicode":g})});return f}})});define("DS/SwymUIComponents/script/utils/dnd-utils",["UWA/Core","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/community/media/model/media-model","DS/WebappsUtils/Console"],function(e,d,a,c){var b={onItemDrag:function(k,o,p){window.widget=p?p:window.widget;if(window.widget){var o,j,l,q,h,n=o.srcElement||o.target,m=widget.getAppName?widget.getAppName():d.getMyCommunitiesAppKey(),f="",i="",g=null;if(k&&o&&o.dataTransfer){l=k.getModelName();q=k.get("mid");if(l==="media"){g=k.get("media_type")}else{if(l==="iquestion"){l="question"}}f=d.getBaseUrl()+k.getRelativePath();i=d.get3DDTransientAppUrl({appId:m,community:k.get("community->mid")||k.get("community").mid||k.get("community").id,contentType:l,contentId:q});h=a.constructThumbnailUrl(((l==="question")?"iquestion":l),q,"m_thumb",k.get("preview_fingerprint"));j={protocol:"3DXContent",version:"1.0",source:m,data:{items:[{envId:window.widget?d.getTenantIdFromUrlPreference(window.widget):"",serviceId:"3DSwym",contextId:"",objectId:k.get("subject6wuri"),objectType:l,objectSubType:(g?g:undefined),displayName:k.get("title"),displayType:(g?g:l),displayIcon:"fonticon:"+d.getIconFromModel(k),displayPreview:h,defaultApp:m,urlContent:{"3DSwym":f,"3DD":i}}]}};o.dataTransfer.setData("text",JSON.stringify(j));c.log("ContentDragStarted",[j]);widget.dispatchEvent("ContentDragStarted",[j]);if(n&&typeof n.addEvent==="function"){n.addEvent("dragend",function(){n.removeEvent("dragend");widget.dispatchEvent("ContentDragEnded",[j])})}}}}};return b});define("DS/SwymUIComponents/script/feature/core/user/view/user-visibility-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/user-visibility-view","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/SwymUICore/script/utils/utils","DS/WebappsUtils/Console"],function(h,f,c,e,a,g,i,b){var d=f.extend({_modelClass:c,name:"user-visibility-view",setup:function(j){j=j||{};return this._parent.apply(this,arguments)},_createContent:function(){this._visibilityOptions=[];var l=this.model.get("tenant_visibility"),m=i.getClientInformation(),j=(m.isIphone||m.isIpad);this._visibilityOptions.push({value:0,selected:l=="0",label:e.noshare});this._visibilityOptions.push({value:1,selected:l=="1",label:e.everyone});this._visibilityOptions.push({value:2,selected:l=="2",label:e.networkOnly});this._visibilityOptions.push({value:3,selected:l=="3",label:e.shareCompany});this._visibilityOptions.push({value:4,selected:l=="4",label:e.shareNetwork});var k=h.createElement("div",{html:[{tag:"h4","class":"titleProfile",html:e.titleSettings},{"class":"margin-top-20px ",html:[{html:[{tag:"label","for":"#selectVisibility",html:e.labelVisibility}]},{"class":"row change-visibility-container",html:[{"class":"col-md-6",html:this.addControl("combobox",new a({name:"visibility",id:"selectVisibility",multiple:false,placeholder:e.SelectYourProfileVisiblity,options:this._visibilityOptions,custom:!j,events:{onChange:function(){var o=this.getElement(".changingCell"),p=this.getControl("combobox").getValue()[0],n=this.getControl("saveButton");if(o&&p){o.setHTML(this._visibilityOptions[parseInt(p)+1].label);if(n){n.setDisabled(false)}}else{this.alert("error",e.pleaseSelectAVisibility);if(n){n.setDisabled(true)}}}.bind(this)}}))},{"class":"col-md-6",html:this.addControl("saveButton",new g({value:e.save,className:"primary",events:{onClick:function(){this.getControl("saveButton").load();var n=this.getControl("combobox").getValue()[0];if(n){this.model.setvisibility({data:{visibility:n},onComplete:function(p,o){this.getControl("saveButton").load(false);this.alert("success",e.visibilitySetSuccess)}.bind(this)})}}.bind(this)}}))}]}]},{"class":"margin-top-20px",html:this._createTable()}]});return k},_firstElementBuild:function(j){var k=h.createElement("tr",{html:[{tag:"td",html:j},{tag:"td",styles:{"text-align":"center"},html:'<span class="fonticon fonticon-check"></span>'},{tag:"td"},{tag:"td"}]});return k},_secondElementBuild:function(j){var k=h.createElement("tr",{html:[{tag:"td",html:j},{tag:"td"},{tag:"td",styles:{"text-align":"center"},html:'<span class="fonticon fonticon-check"></span>'},{tag:"td"}]});return k},_thirdElementBuild:function(j){var k=h.createElement("tr",{html:[{tag:"td",html:j},{tag:"td"},{tag:"td"},{tag:"td",styles:{"text-align":"center","background-color":"lightsteelblue"},html:'<span class="fonticon fonticon-check"></span>'}]});return k},_createTable:function(){var k=this.getControl("combobox").getValue()[0],j=h.createElement("table",{"class":"table table-striped table-bordered",html:[{tag:"thead",html:[{tag:"tr",html:[{tag:"th",styles:{"text-align":"center"},html:e.informationSharedWith},{tag:"th",styles:{"text-align":"center"},html:e.onlyme},{tag:"th",styles:{"text-align":"center"},html:e.everyone},{tag:"th","class":"changingCell",styles:{"text-align":"center","background-color":"lightsteelblue"},html:k?this._visibilityOptions[parseInt(k)+1].label:""}]}]},{tag:"tbody",html:[this._firstElementBuild(e.Login),this._firstElementBuild(e.Email),this._firstElementBuild(e.Password),this._firstElementBuild(e.Title),this._firstElementBuild(e.Phone),this._firstElementBuild(e.StateProvince),this._secondElementBuild(e.firstName),this._secondElementBuild(e.lastName),this._secondElementBuild(e.photo),this._secondElementBuild(e.city),this._secondElementBuild(e.country),this._thirdElementBuild(e.jobtitle),this._thirdElementBuild(e.company),this._thirdElementBuild(e.address),this._thirdElementBuild(e.zip)]}]});return j}});return d});define("DS/SwymUIComponents/script/feature/community/media/library/DriveInSwymView",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view"],function(b,a){return a.extend({className:"target-3ddrive",_createContent:function(){return b.createElement("div",{})},destroy:function(){this.container.remove()}})});define("DS/SwymUIComponents/script/feature/community/media/library/media-library-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/library/media-library-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/upload-manager-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/content-creation-view","DS/SwymUICore/script/utils/i18n","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/community/media/collection/media-collection","DS/SwymUIComponents/script/feature/community/media/library/media-filters-toolbar-view","DS/W3DXComponents/Views/Layout/ScrollView","DS/SwymUIComponents/script/feature/community/media/library/library-list-view","DS/UIKIT/Input/Button","DS/i3DXCompassServices/i3DXCompassPubSub","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/media/library/DriveInSwymView","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/context/context-model"],function(a,i,j,p,h,l,n,f,r,o,k,d,c,b,q,e,m){var g=l.extend({name:"media-library-view",domEvents:{"click .close.fonticon-cancel":"_destroy"},_lastScrollPosition:null,_mediaSelectedCollection:null,_createContent:function(){return[{"class":"library-header",html:'<span class="fonticon close fonticon-cancel fonticon-2x"></span>'},this.getChildView("filtersToolbarView"),this.getChildView("driveInSwymView").hide(),this.getControl("scrollView"),this.getChildView("backToTopView"),{"class":"library-action-buttons",html:[{html:[this.addControl("add-button",new k({className:"primary",value:i.SelectMedia,disabled:true,events:{onClick:function(){this._dispatchMediaCollection([],this._mediaSelectedCollection)}.bind(this)}})),this.addControl("cancel-button",new k({value:p.Cancel,events:{onClick:function(){this._destroy()}.bind(this)}}))]}]}]},_dispatchMediaCollection:function(s,t){this.dispatchEvent("newMediaAdded",{newMedia:s,existingMedia:t})},_updateActionBar:function(u){var s=this.getControl("add-button"),t=u.length;if(s){s.setDisabled(t===0);s.setValue(h.replace(i.AddMedia,{number:t}))}},_destroy:function(){if(!this.isDestroyed()){this.destroy()}},setup:function(w){this._parent.apply(this,arguments);window.document.onkeydown=function(x){x=x||window.event;var y=false;if("key" in x){y=(x.key=="Escape"||x.key=="Esc")}else{y=(x.keyCode==27)}if(y){this._destroy()}}.bind(this);if(!this._lastScrollPosition){this._lastScrollPosition={x:0,y:0}}this.context=m.getInstance();this.context.addListener("onContextChange",this._destroy,this,false);this._collection=new n([],{mode:"all",limit:10});var v=this.addChildView("library-list-view",new o({widget:this._widget,collection:this._collection,communityId:this.getOption("communityId")}));var u=this.addControl("scrollView",new r({view:this.getChildView("library-list-view"),useInfiniteScroll:true,usePullToRefresh:false,events:{onInfiniteScroll:function(x){this.getChildView("library-list-view").dispatchEvent("onInfiniteScroll",[this.getControl("scrollView")])}.bind(this)}}));u.container.addClassName("scroll-library-list");this.addChildView("backToTopView",{Class:"DS/SwymUIComponents/script/feature/core/ui-components/layout/back-to-top-view",manager:this,events:{onInit:function(x){this.listenTo(x,{onScrollToTopRequest:function(y){this.onScrollToTopRequest(y)}})}.bind(this)}});var t=this.addChildView("filtersToolbarView",{Class:f,collection:this._collection,communityId:this.getOption("communityId")});var s=this.addChildView("driveInSwymView",{Class:q});this.listenTo(v,{newMediaAdded:function(){this._dispatchMediaCollection(arguments[0],arguments[1])}.bind(this),newMediaSelected:function(x){this._mediaSelectedCollection=x;this._updateActionBar(x)}.bind(this)});this.listenTo(t,{onActivateDrive:this._activateDrive,onActivateInfiniteScroll:this._activateInfiniteScroll});this._on3DDriveSelectionChangeBound=this._on3DDriveSelectionChange.bind(this);return this},_on3DDriveSelectionChange:function(w){var x,y,u,z,s=this.getChildView("library-list-view")._uploadManager;this._mediaSelectedCollection=[];for(var v=0,t=w.length;v<t;v++){x=w[v];u=x.displayName;if(s){z=u.split(".");if(z.length>1){z=z[z.length-1];y=s._getType(z);if(!y){this.alert("error",j.replace(j.get("FileTypeError"),{FileName:u}))}else{if(x.serviceId==="dropbox"||x.serviceId==="google2"){this.alert("error",i.ExternalDriveError)}else{this._mediaSelectedCollection.push(new b(x))}}}else{console.error("Issue while file extension extraction, ",u)}}}this._updateActionBar(this._mediaSelectedCollection)},_activateDrive:function(s){console.log("drive is activated ? :  "+s);var w=this.getElement(".target-3ddrive"),u=this.getChildView("driveInSwymView"),t=this.getControl("scrollView"),x=this.getChildView("filtersToolbarView"),v=e.getInstance();if(t&&u&&w){if(s){t.hide();x.hideFilters();u.show();require(["DS/W3DDrive/w3DDriveMainView"],function(y){if(!this._driveInstance){this._driveInstance=y.initInstance({platformId:v.get("config").tenant.online_instance_id});this._driveInstance.addEvent("onSelectionChange",this._on3DDriveSelectionChangeBound)}this._driveInstance.inject({targetElement:w})}.bind(this))}else{t.show();x.showFilters();u.hide()}}},_activateInfiniteScroll:function(){var s=this.getControl("scrollView");if(s){s.useInfiniteScroll(true)}},onRedraw:function(){this.renderScrollView()},destroy:function(){if(this._driveInstance){this._driveInstance.removeEvent("onSelectionChange",this._on3DDriveSelectionChangeBound)}this._parent.apply(this,arguments)},onScrollToTopRequest:function(s){if(this.getControl("scrollView")){this.getControl("scrollView").scroller.scrollTo(0,0,(s||0))}},onScroll:function(){var u=this.getChildView("backToTopView"),s=this.getControl("scrollView").scroller.getPosition(),t={position:s,delta:{x:s.x-this._lastScrollPosition.x,y:s.y-this._lastScrollPosition.y}};if(s.y===0){this.container.addClassName("scroll-to-top");u.hide()}else{this.container.removeClassName("scroll-to-top");if(t&&(t.delta.y<0)&&((-1)*s.y>document.body.getSize().height)){u.show()}}this._lastScrollPosition=s},renderScrollView:function(){var s=this.getControl("scrollView");if(s&&(typeof s.render==="function")){s.render();this.listenTo(s.scroller.elements.content,"scroll",this.onScroll.bind(this))}},injectInDom:function(){this.inject(document.body).show()}});return g});define("DS/SwymUIComponents/script/feature/community/survey/view/answer-result-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/answer-result-view","DS/SwymUICore/script/lib/view/generic/swym-model-view"],function(d,b,c){var a=c.extend({_modelEventsForAutoRefresh:["onChange"],_createContent:function(){var e=this.model;if(e){var f=d.createElement("div",{"class":"answer-result",html:[{"class":"answer-wrapper",html:[(parseInt(e.get("is_open"),10)===1?'<div class="answer-description">'+b.OpenAnswers+"</div>":'<div class="answer-description">'+e.get("description"))+'</div><div class="poll-report-stats">('+this.model.getRoundedPercentage()+"%, "+e.get("nbVotes")+" "+(parseInt(e.get("nbVotes"),10)===0?b.votezero:(e.get("nbVotes")>1?b.votes:b.vote))+")</div>"]},{"class":"poll-result-bar",styles:{width:0}}]});return f}},surveyRedraw:function(){if(!this.isDestroyed()&&this.model&&this.model.collection){this.getElement(".poll-result-bar").setStyle("width",this.model.getRoundedPercentage()+"%")}}});return a});define("DS/SwymUIComponents/script/feature/community/content/view/content-small-view-factory",["UWA/Core","UWA/Class","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/content-small-view-factory","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/UIKIT/Tooltip","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/feature/core/user/collection/commenters-collection","DS/SwymUICore/script/feature/core/context/context-model"],function(a,q,j,b,o,p,e,i,n,r,m){var k=10;var d=b.extend({_modelClass:e,_createContent:function(){return this.model.getNickname()}});var l=o.extend({modelViewClass:d,_collectionClass:r,_createContent:function(){var s=this.collection?this._parent({modelViewsToDisplay:k,showSubsetOfModelViews:true}):"";if(this.collection&&this.collection.length>k){a.createElement("div",{html:j.andmore}).inject(s,"bottom")}return s}});var c=p.extend({defaultOptions:{containerView:null},show:function(){var u=this.getOption("containerView"),t=this.getOption("usersTooltipView"),s=u._getCollectionToUse();if(s&&t){t.setCollection(s)}if(u&&u._getNb()>0){if(s&&!s.isBeingFetched()){s.fetch()}return this._parent.apply(this,arguments)}}});var h=b.extend({defaultOptions:{titleNlsKey:"Peoplewhoansweredthisquestion"},name:"nb-comments-view",_modelClass:i,domEvents:{click:"showModal"},attributes:{tag:"button","class":"count-info counter",styles:{"background-color":"transparent",outline:"none"}},setup:function(){this.stopListening();var s;if(this.model.getModelName()==="iquestion"){s=this.model.getAssociated("validatedAnswers");this.listenTo(s,"onRemove",this.refresh.bind(this))}if(this.model.getAnswerCollection){var t=this.model.getAnswerCollection();this.listenTo(t,"onCollectionChange",this.refresh.bind(this))}this._parent.apply(this,arguments)},_getNb:function(){var s;if(this.model.getModelName()==="iquestion"){s=this.model.getAssociated("validatedAnswers");return this.model.getAnswerCollection().length+s._models.length}else{return this.model.getNbComments()}},_getCollectionToUse:function(){return this.model.getWhoAnswered()},_createContent:function(){var s=this._getNb();if(s>0){this.container.addClassName("count-info-pos");this.container.setStyle("cursor","pointer")}else{this.container.removeClassName("count-info-pos");this.container.setStyle("cursor","default")}return[{html:" "+s}]},_getPosition:function(){var s=document.body.getDimensions();if(s.width<=500){return"right"}return"bottom"},showModal:function(){require(["DS/SwymUIComponents/script/feature/core/user/view/user-mini-view","DS/SwymUIComponents/script/feature/core/modal/modal"],function(w,s){var v=this,t=m.getInstance();if(this._getNb()>0){var u=this._getCollectionToUse();if(!u.isBeingFetched()&&!u.hasBeenFetched()){u.fetch()}this.addControl("userListModal",new s({closable:true,header:j.get(this.getOption("titleNlsKey")),body:[{html:this.getChildView("usersList")?this.getChildView("usersList"):this.addChildView("usersList",{collection:u,Class:o,attributes:{styles:{"min-height":"350px"}},modelViewClass:w,modelViewsCfg:{attributes:{"class":"float-left",styles:{"margin-bottom":"10px","min-width":"50%"}}}})},{html:'<div style="clear:both;"></div>'}],events:{onHide:function(){v.getChildView("usersList")&&v.getChildView("usersList").destroy();if(this.elements&&this.getContent()){v.removeControl("userListModal")}}}})).show();t.addListener("onContextChange",this._onContextChange,this)}}.bind(this))},_onContextChange:function(){var s=m.getInstance();this.getControl("userListModal").destroy();s.removeListener("onContextChange",this._onContextChange)},onRender:function(){var s=this.addChildView("usersTooltipView",new l({collection:this._getCollectionToUse()}));this.addControl("usersTooltip",new c({target:this.container,containerView:this,position:"bottom",className:"st-interactor-tooltip",usersTooltipView:s,body:s,offset:{x:0,y:5}}))}}),g=h.extend({defaultOptions:{titleNlsKey:"Peoplewhocontributededtothispage"},name:"nb-contributors-view",_modelClass:n,_modelEventsForAutoRefresh:["onChange:nb_contributors"],domEvents:{click:"showModal"},attributes:{tag:"a","class":"link",styles:{"background-color":"transparent",outline:"none"}},_getNb:function(){return this.model.get("nb_contributors")},_getCollectionToUse:function(){return this.model.getContributors()},_createContent:function(){return this._getNb()+" members"}}),f=q.extend({_views:{nbAnswersNextGen:h,nbContributors:g},createView:function(t,s){var u=this._views[t];if(u.prototype instanceof b){return new u(s)}else{throw new Error("The requested view is not available")}},getViewClass:function(s){return this._views[s]}}).singleton();return f});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-converter-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-converter-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Select","DS/SwymUICore/script/feature/community/community/collection/community-collection","DS/SwymUICore/script/feature/community/idea/collection/idea-collection","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/feature/core/context/context-model","DS/UIKIT/Mask"],function(k,h,j,l,b,c,d,f,a,i,e){var g=j.extend({name:"idea-converter-view",mode:"create",modal:null,_createContent:function(){var m=this.model,o=this;if(m){var n={html:[{html:[o.addControl("createToggle",new l({name:"create-link-radio-"+o.cid,checked:true,label:h.Createanewideain,className:"primary",events:{onChange:function(){o.mode="create";o.getControl("ideaCombo").disable();o.getControl("communityLinkCombo").disable();if(o._communityCollection&&o._communityCollection.isEmpty()===false){o.getControl("communityCreateCombo").enable()}}}}))]},{styles:{"margin-bottom":"10px"},html:o.addControl("communityCreateSelectContainer",k.createElement("div",{html:o.getControl("communityCreateCombo")}))},{html:[o.addControl("linkToggle",new l({name:"create-link-radio-"+o.cid,checked:false,label:h.Linktoanexistingideain+" *",className:"primary",events:{onChange:function(){o.mode="link";if(o._ideaCollection&&o._ideaCollection.isEmpty()===false){o.getControl("ideaCombo").enable()}if(o._communityCollection&&o._communityCollection.isEmpty()===false){o.getControl("communityLinkCombo").enable()}o.getControl("communityCreateCombo").disable()}}}))]},{styles:{"margin-bottom":"10px"},html:o.addControl("communityLinkSelectContainer",k.createElement("div",{html:o.getControl("communityLinkCombo")}))},{styles:{"margin-bottom":"10px"},html:o.addControl("ideaSelectContainer",k.createElement("div",{html:o.getControl("ideaCombo")}))},{styles:{"margin-bottom":"10px",display:"none",position:"relative"},id:"link-message","class":"alert-message alert-warning",html:h.ThereIsNoIdeaInThisCommunity},"* "+h.Linknondisplayedifmembersdoesntgotrights]};return n}},fetchCombo:function(){var m=this;if(!this.isRendered()){this.render();return}m._communityCollection=new c([],{mode:"communities-with-rights",limit:999,modelParam:"Ideation"});e.mask(m.getControl("communityLinkSelectContainer"));e.mask(m.getControl("communityCreateSelectContainer"));m._communityCollection.fetch({onComplete:function(p){if(!m.isDestroyed()){if(p.length>0){var n=[],o=false;p.forEach(function(q){found=(q.get("mid")===m._context.communityId);if(found===true){o=true}n.push({label:q.get("title",{escapeHTML:false}),value:q.get("mid"),selected:found})});if(!o){n[0].selected=true}m.getControl("communityCreateCombo").add(n);m.getControl("communityLinkCombo").add(n);m.getControl("communityCreateCombo").enable();e.unmask(m.getControl("communityLinkSelectContainer"));e.unmask(m.getControl("communityCreateSelectContainer"));m.fetchIdeaCombo=function(r){var q;if(!m.isDestroyed()){e.mask(m.getControl("ideaSelectContainer"));m.getControl("ideaCombo").disable();m.getControl("ideaCombo").add([]);m.getControl("ideaCombo").show();m.getControl("communityLinkCombo").disable();q=m.getContent().getElement("#link-message");if(q){q.hide()}r.fetch({onComplete:function(u){if(!m.isDestroyed()){var t=[],s;if(u.length>0){u.forEach(function(v){if(v.get("id")!=m.model.get("id")){t.push({label:v.get("title",{escapeHTML:false}),value:v.get("mid")})}});if(t[0]){t[0].selected=true;m.getControl("ideaCombo").add(t)}else{m.getControl("ideaCombo").hide();s=m.getContent().getElement("#link-message");if(s){s.show()}}if(m.mode=="link"){m.getControl("ideaCombo").enable();m.getControl("communityLinkCombo").enable()}}else{if(m.mode=="link"){m.getControl("communityLinkCombo").enable()}m.getControl("ideaCombo").hide();s=m.getContent().getElement("#link-message");if(s){s.show()}}e.unmask(m.getControl("ideaSelectContainer"))}}})}};if(n[0]){m._ideaCollection=new d([],{mode:"community",communityId:m.getControl("communityLinkCombo").getValue()[0],limit:999});m.fetchIdeaCombo(m._ideaCollection);m.getControl("communityLinkCombo").addEvent("onChange",function(){var q;m.getControl("ideaCombo").remove();if(m.getControl("communityLinkCombo").getValue()[0]){m.getControl("ideaCombo").show();m._ideaCollection.setup([],{communityId:m.getControl("communityLinkCombo").getValue()[0]});m.fetchIdeaCombo(m._ideaCollection)}else{m.getControl("ideaCombo").hide();q=m.getContent().getElement("#link-message");if(q){q.hide()}}})}}else{m.alert("info",h.ThereIsNoCommunityWhereYouCanAddOrLinkIdea)}}}})},setup:function(){this.addControl("ideaCombo",new b({placeholder:h.Selectanidea,className:"idea-combo",disabled:true}));this.addControl("communityCreateCombo",new b({placeholder:h.Selectacommunity,className:"create-community-combo",disabled:true}));this.addControl("communityLinkCombo",new b({placeholder:h.Selectacommunity,className:"link-community-combo",disabled:true}));this._context=i.getInstance();this._parent.apply(this,arguments)},convertIdea:function(p,o){console.log("convertLayer:");console.log(p);switch(this.mode){case"create":var n=this.model.toJSON();if(this.model.getTableName()=="Media"){n.message='<p><img data-source="swym" class="media" width="240" data-media-type="'+this.model.get("media_type")+'" data-media-id="'+this.model.get("mid")+'"/></p>'+(this.model.get("content")?"<p>"+this.model.get("content")+"</p>":"")}else{n.message=this.model.get("content")}if(this.getControl("communityCreateCombo").getValue()[0]){if(this.getControl("create")){this.getControl("create").load()}var m=new f({});m.addChanges({title:n.title,message:n.message,community_id:this.getControl("communityCreateCombo").getValue()[0]});m.save({},{onComplete:function(){if(this.callback){this.callback.call(this,m)}else{a.goToContent(m.get("mid"),m.getModelName(),m.get("community->mid"),true)}this.idea.addLink({type:"internal",model_id:this.model.get("mid"),model:this.model.getTableName()},{onComplete:function(){}});this.convertLayer.hide();if(this.view.getControl("create")){this.view.getControl("create").load(false)}}.bind({idea:m,convertLayer:p,callback:o,model:this.model,view:this})})}else{this.alert("error",h.Pleaseselectacommunity)}break;case"link":if(this.getControl("communityLinkCombo").getValue()[0]){if(this.getControl("ideaCombo").getValue()[0]){if(this.getControl("create")){this.getControl("create").load()}var m=new f({id:this.getControl("ideaCombo").getValue()[0]},{autoPopulate:false});this.convertLayer=p;m.addLink({type:"internal",model_id:this.model.get("mid"),model:this.model.getTableName()},{onComplete:function(){console.log(h.Success+" "+h.Yourlinkhasbeencreated);this.alert("success",h.Yourlinkhasbeencreated);this.convertLayer.hide();if(this.getControl("create")){this.getControl("create").load(false)}}.bind(this),onFailure:function(r,q){if(q.errorcode=="ERROR_IDEATION_CONTENT_ALREADY_LINKED"){this.alert("error",h.Thiscontentisalreadylinkedtothisidea)}else{if(q.errorcode=="ERROR_CANNOT_LINK_IDEATION_TO_ITSELF"){this.alert("error",h.Cannotlinkanideatoitself)}else{this.alert("error",h.Youdonthaverightstocreatelinkonthisidea)}}if(this.getControl("create")){this.getControl("create").load(false)}}.bind(this)})}else{if(this._ideaCollection&&this._ideaCollection.isEmpty()===false){this.alert("error",h.Pleaseselectanideaintheselectedcommunity)}}}else{this.alert("error",h.Pleaseselectacommunity)}break}},onRedraw:function(){this.fetchCombo()}});return g});define("DS/SwymUIComponents/script/feature/community/idea/view/pipeline-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/pipeline-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/UIKIT/Tooltip","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUICore/script/feature/community/idea/model/status-model","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/date","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/core/context/context-model","UWA/Utils/Client"],function(k,g,i,j,n,d,a,l,c,b,p,m){var o=document,f,h=l.isFeatureActivated("activateMoveStatusAndNewPipeline"),e=i.extend({name:"idea-tooltip-view",_modelClass:d,_modelEventsForAutoRefresh:["onChange:title","onChange:thumbnail"],_createContent:function(){var s=this,q=s.model,r,t=null;if(q){if(q.get("thumbnail")&&q.get("thumbnail").mid){t=l.getBaseUrl()+"/api/media/streammedia/id/"+q.get("thumbnail").mid+"/type/thumb/key/m_thumb/update/"+q.get("thumbnail").preview_fingerprint}else{t=l.getBaseUrl()+"/api/media/streammedia/model/idea/model_id/"+q.get("mid")+"/type/thumb/key/m_thumb/update/"+c.getDateInMilliSec(q.get("update"))}r=k.createElement("div",{styles:{"text-align":"left"},html:(t?'<img style="min-height: 170px; margin-bottom: 5px; width: 228px;" src="'+t+'" />':'<div style="padding-top: 10px;"></div>')+'<div class="idea-tooltip-title" style="font-size: 18px; line-height: 32px; padding: 0 10px;">'+q.get("title")+'</div><div class="idea-tooltip-author" style="padding: 0 10px; margin-top: 10px;">'+q.get("author").nickname+"</div>"});return r}}});f=j.extend({name:"pipeline-view",config:null,out:false,zoom:0,maxIdeasByStatus:15,singleIdeaModel:null,ideaCollection:null,statusCollection:null,_createContent:function(){var N=this,P=N.config,T=N.statusCollection,r=P.height,C=P.heightDiff,Y=P.className,v=P.outClickable,Z=P.containerId,M,Q=(P.legend===true?true:false),H,t,S,K=[],X,V,U,G,I,A,z,J,D,L,O,q=1000,s,u,x,w,F,y,W,B;if(T&&T.hasBeenFetched()){M=T.slice();if(this.container&&this.container.getParent()&&this.container.getParent().getSize().width>0){if(this.container.getParent().getSize().width!==0){q=this.container.getParent().getSize().width}}P.width=q;H=o.createElementNS("http://www.w3.org/2000/svg","svg");H.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");H.setAttribute("viewBox","0 0 "+q+" "+(r+(Q?55:0)));H.setAttribute("preserveAspectRatio","none meet");H.setAttribute("class","svg-content");H.setAttribute("width","100%");H.setAttribute("height",(r+(Q?55:0)));H.setAttribute("id",Z+"_pipeline");H.setAttribute("xmlns","http://www.w3.org/2000/svg");H.setAttribute("transform","scale(1)");if(k.Utils.Client.Engine.ie10===true){H.setAttribute("style","overflow: hidden;")}U=o.createElementNS("http://www.w3.org/2000/svg","g");U.setAttribute("id","w_"+Z+"_status_titles");M.forEach(function(aa){G=o.createElementNS("http://www.w3.org/2000/svg","polygon");A=Math.floor(q/M.length*(aa.get("status_nb")-1));z=Math.floor(q/M.length*aa.get("status_nb"));if(M.length===aa.get("status_nb")){z--}G.setAttribute("points",A+",0 "+z+",0 "+z+","+r+" "+A+","+r);G.setAttribute("shape",true);G.setAttribute("class",Y);G.setAttribute("id","w_"+Z+"_"+aa.get("mid")+"_status");G.setAttribute("fill",aa.get("color"));G.setAttribute("name",aa.get("title"));if(!v){G.setAttribute("style","cursor:pointer;")}H.appendChild(G);if(h&&Q){B=o.createElementNS("http://www.w3.org/2000/svg","title");B.appendChild(o.createTextNode(aa.get("title")));G.appendChild(B);u=z-A;F=o.createElementNS("http://www.w3.org/2000/svg","g");F.setAttribute("id","w_"+Z+"_status_title_group");F.setAttribute("clip-path","url(#w_"+Z+aa.get("mid")+"_clip_mask)");if(u>80){x=o.createElementNS("http://www.w3.org/2000/svg","clipPath");x.setAttribute("id","w_"+Z+aa.get("mid")+"_clip_mask");w=o.createElementNS("http://www.w3.org/2000/svg","rect");w.setAttribute("x",A+5);w.setAttribute("y",r+25-13);w.setAttribute("width",u-10);w.setAttribute("height",33);x.appendChild(w);I=o.createElementNS("http://www.w3.org/2000/svg","text");I.setAttribute("x",A+u/2);I.setAttribute("y",r+25);I.setAttribute("id","w_"+Z+"_"+aa.get("mid")+"_status_title");I.setAttribute("text-anchor","middle");I.setAttribute("class","status-title");I.appendChild(o.createTextNode(aa.get("title")));F.appendChild(I);F.appendChild(x)}W=o.createElementNS("http://www.w3.org/2000/svg","title");W.appendChild(o.createTextNode(aa.get("title")));F.appendChild(W);y=o.createElementNS("http://www.w3.org/2000/svg","text");y.setAttribute("x",A+u/2);y.setAttribute("y",r+25+15);y.setAttribute("id","w_"+Z+"_"+aa.get("mid")+"_status_title_count");y.setAttribute("text-anchor","middle");y.setAttribute("class","status-title");y.setAttribute("title",aa.get("title"));F.appendChild(y);U.appendChild(F)}});if(h&&Q){H.appendChild(U)}var E=o.createElementNS("http://www.w3.org/2000/svg","text");E.setAttribute("x",q/2);E.setAttribute("y",r+25);E.setAttribute("id","w_"+Z+"_zoomed_status");E.setAttribute("text-anchor","middle");E.setAttribute("class","status-title");E.appendChild(o.createTextNode(""));H.appendChild(E);var R=(m.Engine.firefox?1:0);t=o.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d","M0,0 Q"+(q/2.5)+","+C+" "+(q+R)+","+(C-R)+" Q"+(q+R)+",0 "+(q+R)+",-"+R);t.setAttribute("class","curve-shape");t.setAttribute("id",Z+"_top_curve");t.setAttribute("shape",true);H.appendChild(t);S=o.createElementNS("http://www.w3.org/2000/svg","path");S.setAttribute("d","M0,"+(r+R)+" Q"+(q/2.5)+","+(r-C)+" "+(q+R)+","+(r-C+R)+" Q"+(q+1)+","+r+" "+(q+1)+","+(r+R));S.setAttribute("class","curve-shape");S.setAttribute("id",Z+"_bottom_curve");S.setAttribute("shape",true);H.appendChild(S);if(!v){if(h){L=k.createElement("span",{"class":"fonticon fonticon-lightbulb-thumbs-up checked",events:{click:function(){N._viewOut();if(this.hasClassName("fonticon-lightbulb-thumbs-up")){this.removeClassName("fonticon-lightbulb-thumbs-up");this.removeClassName("checked");this.addClassName("fonticon-lightbulb-thumbs-down")}else{this.addClassName("fonticon-lightbulb-thumbs-up");this.addClassName("checked");this.removeClassName("fonticon-lightbulb-thumbs-down")}}}});this._inAndOutButtonTooltip=new n({target:L,body:g.ViewOutIdeas})}else{for(X=0;X<3;X++){K[X]=o.createElementNS("http://www.w3.org/2000/svg","circle");K[X].setAttribute("cx",q/2-15+15*X);K[X].setAttribute("cy","10");K[X].setAttribute("r","3");K[X].setAttribute("fill","lightGrey");H.appendChild(K[X])}J=k.extendElement(o.createElementNS("http://www.w3.org/2000/svg","rect"));J.setAttribute("x",q/2-27);J.setAttribute("y",0);J.setAttribute("width",50);J.setAttribute("height",20);J.setAttribute("fill","transparent");J.setAttribute("style","cursor:pointer;");J.setAttribute("name","viewOut");H.appendChild(J);this._inAndOutButtonTooltip=new n({target:J,offset:{x:27},body:g.ViewOutIdeas});if(Q){D=k.createElement("span",{"class":"fonticon fonticon-help"});O='<div style="margin-bottom:5px;"><b>'+g.InnovationPipeline+"</b></div>";for(V=0;V<M.length;V++){O=O+'<div style="min-height: 25px;"><div style="float: left; border: 1px solid #D8D8D8; margin-right:10px; display: inline-block; height: 20px; width: 20px; background-color:'+M[V].get("color")+';"></div><div style="padding-top: 3px;">'+M[V].get("title")+(M[V].get("is_mature")?" ("+g.Mature+")":"")+"</div></div>"}new n({target:D,body:O,position:"left"})}}}s={html:[k.extendElement(H),{"class":"pipeline-icon-bar",html:[(D?D:null),(L?L:null)]}]};return s}},drawIdeas:function(){var r=this,t=function(v){v=v.toString();var y=v.length,x=parseInt(v[0],10),w;for(w=1;w<y;w++){x+=parseInt(v[w],10)}return x},q=function(v){var y=0,w,x;if(v.length===0){return y}for(w=0;w<v.length;w++){x=v.charCodeAt(w);y=((y<<5)-y)+x;y|=0}return y},s=function(w){var A=4,z=(q(w.get("mid"))%2?r.config.heightDiff:r.config.height/2)+A,y=(q(w.get("mid"))%2?r.config.height/2:r.config.height-r.config.heightDiff)-A,x=Math.abs(q(w.get("mid"))).toString();if(w.get("out")==="1"){var v=window.ds&&window.ds.isiPad?15:18;if(r.config.height<500){v=v/2}z=v/2+A;y=r.config.height/2-A}while(x.length!==1){x=t(x).toString()}return Math.floor(x/10*(y-z+1)+z)};r.container.getElements(".idea-circle").forEach(function(v){v.destroy()});if(r.ideaCollection){var u=this.ideaCollection.slice();u.sort(function(w,v){return new Date(w.get("update"))-new Date(v.get("update"))});r.statusCollection.forEach(function(M,C,y){var B=0,T=[],N=[],U,O,P=0,z=C;T=u.filter(function(w){return w.get("status_id")===M.get("mid").toString()});if(T.length>0){for(var F=T.length;F--;){U=N[N.length-1];O=T[F];if(!(U&&U.date===O.get("crdate").substring(0,10))){U={date:O.get("crdate").substring(0,10),ideas:[],ideasZoom:[],ideasOut:[]};N.push(U)}if(B<r.maxIdeasByStatus){if(O.get("out")!=="1"){U.ideas.push(O);B++}}if(O.get("out")!=="1"){U.ideasZoom.push(O)}else{U.ideasOut.push(O)}}var S=0,V=0,L=0,A=T.length,D=T.filter(function(w){return w.get("out")==="1"}).length,Q=y.length,E=parseInt(M.get("status_nb")),I=r.config.width/Q,H=(E-1)*I,J=H,K=50,G=(r.config.width/Q/2>K?r.config.width/Q/2:K),v=(E===1?K:G+K),R=r.config.width-(E!==1&&E!==y.length?2:1)*G-(2*K),x;N.forEach(function(w){if(w.ideas.length>0){H+=S;S=I*(w.ideas.length/(A<r.maxIdeasByStatus?A:r.maxIdeasByStatus));w.ideas.forEach(function(Y,W,X){x=Math.floor(H+(W+1)*S/(X.length+1));if(k.is(x)){r.addIdea(r.getElement("svg"),Y,x,s(Y),false,I,z)}})}if(w.ideasZoom.length>0){v+=V;V=R*(w.ideasZoom.length/T.filter(function(W){return W.get("out")!=="1"}).length);w.ideasZoom.filter(function(W){return W.get("out")!=="1"}).forEach(function(Y,W,X){x=v+(W+1)*V/(X.length+1);x=Math.floor(x);if(k.is(x)){r.addIdea(r.getElement("svg"),Y,x,s(Y),true,I,z)}})}if(w.ideasOut.length>0){J+=L;L=I*(w.ideasOut.length/T.filter(function(W){return W.get("out")==="1"}).length);w.ideasOut.filter(function(W){return W.get("out")==="1"}).forEach(function(Y,W,X){x=J+(W+1)*L/(X.length+1);x=Math.floor(x);if(k.is(x)){r.addIdea(r.getElement("svg"),Y,x,s(Y),false,I,z)}})}})}});if(r._parentView&&r._parentView.model){r._parentView.model.getNbIdeasPerStatus({onComplete:function(){r._parentView.model.getStatus().forEach(function(v){r._createStatusTooltip(v)})}})}}},_createStatusTooltip:function(r){var u=this,t,q,v=r.get("mid"),s=r.get("nb_ideas");if(u.container){if(!h){if(this.getControl("statusTooltip_"+v)){this.removeControl("statusTooltip_"+v)}if(u.zoom===0&&u.out===false){t=k.extendElement(u.container.getElement("#w_"+u.config.containerId+"_"+v+"_status"));q=s+(s===0?" ideas":(s===1?" idea":" ideas"))+" in status: "+r.get("title");if(t){this.addControl("statusTooltip_"+v,new n({target:t,anchor:"mouse",body:q,delay:{show:500}}))}}}else{if(this.config.legend){t=u.container.getElement("#w_"+u.config.containerId+"_"+v+"_status_title_count");t.setContent("("+s+")"+(r.get("is_mature")?" ("+g.Mature+")":""))}}}},addSingleIdea:function(t){var u,x=t.getAttributes(),w,v,s,r,q;if(this.statusCollection.length>1){for(w=0;w<this.statusCollection.length;w++){if(x.status_id===this.statusCollection.at(w).get("mid").toString()){x.status_nb=parseInt(this.statusCollection.at(w).get("status_nb"),10)}}q=o.createElementNS("http://www.w3.org/2000/svg","circle");q.setAttribute("cx",(x.status_nb-0.5)*(this.config.width/this.statusCollection.length));q.setAttribute("cy",this.config.height/2);q.setAttribute("r",10);q.setAttribute("title",x.title);q.setAttribute("class","idea-circle");q.setAttribute("id","w_"+this.config.containerId+"_"+x.mid+"_idea");q.setAttribute("fill","#FFFFFF");this.container.firstChild.appendChild(q);this.singleIdeaModel=t;this.initial_status_nb=x.status_nb;this.initial_out=(x.out==="1"?true:false);this.current_status_nb=this.initial_status_nb;this.current_out=this.initial_out;if(this.initial_out===true){u=this.container.firstChild.childNodes;for(v=0,s=u.length;v<s;v++){if(u[v].getAttribute("shape")==="true"){u[v].setAttribute("transform","translate(0,"+(this.config.height/2-this.config.heightDiff/2)+")")}}q.cy.baseVal.value=(parseInt((x.status_nb-1)*this.config.heightDiff/this.statusCollection.length,10)+parseInt(x.status_nb*this.config.heightDiff/this.statusCollection.length,10))/2+20}}},setIdeaCollection:function(q){var r=this;if(r.ideaCollection){r.stopReactingTo(r.ideaCollection)}r.ideaCollection=q;r.reactTo(r.ideaCollection,["onChange:status_id","onChange:out"],function(){if(r.zoom!==0){r._zoomStatus(r,r.zoom).call()}r.drawIdeas()});if(r.config&&r.config.collectionEventsForAutoRefresh){r.reactTo(r.ideaCollection,r.config.collectionEventsForAutoRefresh,function(){r.drawIdeas()})}r.drawIdeas()},onRedraw:function(){if(this.ideaCollection){this.drawIdeas()}else{if(this.singleIdeaModel){this.addSingleIdea(this.singleIdeaModel)}}},showIdeaTooltip:function(q,s){var v=this,w=null,t={},u;function x(){q.removeEvent("mouseout",r);k.extendElement(window.document).removeEvent("click",r)}function r(){clearTimeout(w);t.showTooltip=false;x()}!k.Utils.Client.Features.touchEvents&&q.addEvent("mouseout",r);!k.Utils.Client.Features.touchEvents&&k.extendElement(window.document).addEvent("click",r);t.target=q;t.callback=x;w=setTimeout(function(){t.model=s;u=v.createIdeaTooltip(t);k.Utils.Client.Features.touchEvents&&u.getContent().addEvent("click",function(){p.getInstance().reset({contentId:s.get("mid"),contentType:s.getModelName(),communityId:s.getCommunity().get("mid")})})},500)},createIdeaTooltip:function(q){var r=this,s;if(q.showTooltip!==false){s=r.addControl("tooltip_"+r.cid+"_"+q.model.cid,new n({className:"idea-pipeline-tooltip",target:q.target,position:"left",offset:{x:-(q.target.getAttribute("r")?parseInt(q.target.getAttribute("r")):0),y:(q.target.getAttribute("r")?parseInt(q.target.getAttribute("r")):0)},body:[new e({model:q.model,widget:this._widget}),{"class":"social-features-wrapper"}],delay:{show:500},events:{onShow:function(){r.getControl("tooltip_"+r.cid+"_"+q.model.cid).getBody().getElement(".social-features-wrapper").setHTML(r.addChildView("socialFeatures_"+r.cid+"_"+q.model.cid,{model:q.model,comments:true,forceCommentFetchIfNotDoneYet:false,commentsNumberAtInit:0,socialToolbarMode:"light",Class:"DS/SwymUIComponents/script/feature/community/content/social-interactions/social-toolbar-view",modelName:q.model.getModelName(),enableShare:false,widget:r._widget}));this.updatePosition()},onHide:function(){if(r.getChildView("socialFeatures_"+r.cid+"_"+q.model.cid)){r.removeChildView("socialFeatures_"+r.cid+"_"+q.model.cid)}r.removeControl("tooltip_"+r.cid+"_"+q.model.cid)}}}));if(q.showTooltip!==false&&k.extendElement(q.target).isInjected(document.body)){s.show()}else{s.destroy()}}if(q.callback){q.callback()}return s},addIdea:function(u,t,y,w,C,x,B){var z=this,D=t.getAttributes(),v=k.extendElement(o.createElementNS("http://www.w3.org/2000/svg","circle")),s=window.ds&&window.ds.isiPad?4:6,q=window.ds&&window.ds.isiPad?15:18,A=y-(Math.floor(x)*B);if(z.config.height<500){q=q/2}if(!D.nb_endorse){D.nb_endorse=0}if(!D.nb_comments){D.nb_comments=0}s=(s+(parseInt(D.nb_comments,10)*2)+(parseInt(D.nb_endorse,10)*2)<q?s+(parseInt(D.nb_comments,10)*2)+(parseInt(D.nb_endorse,10)*2):q);if(!C){if(A<=s){y=s+(B*x)+2}if((x-A)<=s){y=((B+1)*x)-s-2}}v.setAttribute("r",s);v.setAttribute("cx",y);v.setAttribute("cy",w);v.setAttribute("id","w_"+z.config.containerId+"_"+D.mid+"_idea"+(C?"_zoom":""));v.setAttribute("fill","#FFFFFF");v.setAttribute("class","idea-circle"+(D.out==="1"?" out":"")+(C?" zoom":" notzoom"));v.setAttribute("name",D.title);v.setAttribute("status",D.status_title);v.addEvent("mouseenter",function(){z.showIdeaTooltip(v,t)});v.addEvent("click",function(){if(k.Utils.Client.Features.touchEvents){z.showIdeaTooltip(v,t)}else{p.getInstance().reset({contentId:this.get("mid"),contentType:this.getModelName(),communityId:this.getCommunity().get("mid")})}}.bind(t));if(z.out){if(!C&&D.out==="1"){z._showIdea(v)}else{z._hideIdea(v)}}else{if(D.out==="1"){z._hideIdea(v)}else{if(C){if(z.zoom!==0&&z.zoom===parseInt(D.status_nb,10)){z._showIdea(v)}else{z._hideIdea(v)}}else{if(z.zoom===0){z._showIdea(v)}else{z._hideIdea(v)}}}}if(u){u.appendChild(v)}},_diff:function(r,q){return(r/1000)*q},_updateZoomedStatusNbIdeas:function(q){var s=this.getElement("#w_"+this.config.containerId+"_zoomed_status"),t=this.getElement("#w_"+this.config.containerId+"_status_titles"),r;if(this.out===true){s.setContent("");s.hide();if(t){t.hide()}}else{if(q){r=q.get("nb_ideas");s.setContent(q.get("title")+(r?" ("+r+")":" (0)"));if(t){t.hide()}s.show()}else{s.setContent("");s.hide();if(t){t.show()}}}},_zoomStatus:function(q,r){return function(){if(!q.out){var z,y=10,C=0,s=0,F=5000,B=null,A=q.statusCollection.slice(),D=q.container.getElements("polygon"),x,v,t;q.stopRight=false;q.stopLeft=false;if(q.zoom===0){q.zoom=r}else{q.zoom=0}if(q.zoom!==0){var w=A[r-1],G=w.get("title",{escapeHTML:false}),E,u;q._updateZoomedStatusNbIdeas(w);q.dispatchEvent("ZoomIdeaStatus",{status_title:G,out:false});E=function(){F+=300;if(q.rightMax>q.xRight){q.xRight+=q._diff(F,y);if(q.rightMax<q.xRight){q.xRight=q.rightMax}s=-((q.config.width/A.length*r)-q.xRight);q.stopRight=false}else{if(q.stopRight===false){q.stopRight=true;s=-((q.config.width/A.length*r)-q.rightMax)}}if(q.leftMin<q.xLeft){q.xLeft-=q._diff(F,y);if(q.leftMin>q.xLeft){q.xLeft=q.leftMin}C=(q.config.width/A.length*(r-1))-q.xLeft;q.stopLeft=false}else{if(q.stopLeft===false){q.stopLeft=true;C=(q.config.width/A.length*(r-1))-q.leftMin}}if(q.stopRight&&q.stopLeft){clearInterval(z)}else{for(x=0;x<A.length;x++){if(D[x].getAttribute("shape")==="true"){B=D[x];if(r===parseInt(A[x].getAttributes().status_nb,10)){B.setAttribute("points",q.xLeft+",0 "+q.xRight+",0 "+q.xRight+","+parseInt(q.config.height,10)+" "+q.xLeft+","+parseInt(q.config.height,10))}else{if(parseInt(A[x].getAttributes().status_nb,10)<r){B.setAttribute("points",parseInt((q.config.width/A.length*(A[x].getAttributes().status_nb-1))-C,10)+",0 "+parseInt((q.config.width/A.length*A[x].getAttributes().status_nb)-C,10)+",0 "+parseInt((q.config.width/A.length*A[x].getAttributes().status_nb)-C,10)+","+parseInt(q.config.height,10)+" "+parseInt((q.config.width/A.length*(A[x].getAttributes().status_nb-1))-C,10)+","+parseInt(q.config.height,10))}else{if(parseInt(A[x].getAttributes().status_nb,10)>r){B.setAttribute("points",parseInt((q.config.width/A.length*(A[x].getAttributes().status_nb-1))+s,10)+",0 "+parseInt((q.config.width/A.length*A[x].getAttributes().status_nb)+s,10)+",0 "+parseInt((q.config.width/A.length*A[x].getAttributes().status_nb)+s,10)+","+parseInt(q.config.height,10)+" "+parseInt((q.config.width/A.length*(A[x].getAttributes().status_nb-1))+s,10)+","+parseInt(q.config.height,10))}}}}}}};u=function(){q.xRight=parseInt((q.config.width/A.length)*r,10);q.leftMin=(r===1)?0:(q.config.width/A.length/2>50?parseInt(q.config.width/A.length/2,10):50);q.xLeft=parseInt((q.config.width/A.length)*(r-1),10);q.rightMax=parseInt((q.config.width)-(r===A.length?0:(q.config.width/A.length/2>50?q.config.width/A.length/2:50)),10);z=setInterval(E,y)};u();q.ideaCollection.forEach(function(H){if((H.get("out")==="1"&&q.out===true)||(H.get("out")!=="1"&&q.out===false)){v=q.container.getElement("#w_"+q.config.containerId+"_"+H.get("mid")+"_idea");t=q.container.getElement("#w_"+q.config.containerId+"_"+H.get("mid")+"_idea_zoom");if(parseInt(H.get("status_nb"),10)===r){this._hideIdea(v);this._showIdea(t)}else{this._hideIdea(v);this._hideIdea(t)}}},q)}else{q._updateZoomedStatusNbIdeas();q.dispatchEvent("ZoomIdeaStatus",{status_title:null,out:false});for(x=0;x<A.length;x++){if(D[x].getAttribute("shape")==="true"){B=D[x];B.setAttribute("points",parseInt((q.config.width/A.length)*(A[x].getAttributes().status_nb-1),10)+",0 "+parseInt((q.config.width/A.length)*A[x].getAttributes().status_nb,10)+",0 "+parseInt((q.config.width/A.length)*A[x].getAttributes().status_nb,10)+","+q.config.height+" "+parseInt((q.config.width/A.length)*(A[x].getAttributes().status_nb-1),10)+","+q.config.height)}}q.ideaCollection.forEach(function(H){v=q.container.getElement("#w_"+q.config.containerId+"_"+H.get("mid")+"_idea");t=q.container.getElement("#w_"+q.config.containerId+"_"+H.get("mid")+"_idea_zoom");if((H.get("out")==="1"&&q.out===true)||(H.get("out")!=="1"&&q.out===false)){this._showIdea(v)}else{this._hideIdea(v)}this._hideIdea(t)},q)}}}},_showIdea:function(q){if(q){q.removeClassName("hidden")}},_hideIdea:function(q){if(q){q.addClassName("hidden")}},_viewOut:function(){var z=this,r=z.container,q=r.getElements("polygon"),A=q.concat(r.getElements("path")),y,x=10,w,B,v,u;if(z.zoom!==0){z._zoomStatus(z,z.zoom).call()}z.out=!z.out;u=z.out;w=(u?-600:600);var t=r.getElements(".idea-circle.notzoom, .idea-circle.out");t.forEach(function(C){if(C.isHidden()){z._showIdea(C)}else{z._hideIdea(C)}});z._inAndOutButtonTooltip.setBody((u?g.ViewInIdeas:g.ViewOutIdeas));q.forEach(function(C){C.setAttribute("style",(u?"":"cursor:pointer;"))});z._updateZoomedStatusNbIdeas(null);z.dispatchEvent("ZoomIdeaStatus",{status_title:null,out:u});B=function(){var C;if(w>0){w+=50;z.translate-=z._diff(w,x);if(z.translate>0){for(C=0;C<A.length;C++){if(A[C].getAttribute("shape")==="true"){A[C].setAttribute("transform","translate(0,"+z.translate+")")}}}if(z.translate<0){clearInterval(y);for(C=0;C<A.length;C++){if(A[C].getAttribute("shape")==="true"){A[C].setAttribute("transform","translate(0,0)")}}z.ideaCollection.forEach(function(D){v=z.container.getElement("#w_"+z.config.containerId+"_"+D.get("mid")+"_idea");if(D.get("out")!=="1"&&v){this._showIdea(v)}},z)}}else{w-=50;z.translate+=(-1)*z._diff(w,x);if(z.translate<(33+z.config.height/2)){for(C=0;C<A.length;C++){if(A[C].getAttribute("shape")==="true"){A[C].setAttribute("transform","translate(0,"+z.translate+")")}}}if(z.translate>(33+z.config.height/2)){clearInterval(y);for(C=0;C<A.length;C++){if(A[C].getAttribute("shape")==="true"){A[C].setAttribute("transform","translate(0,"+(33+z.config.height/2)+")")}}z.ideaCollection.forEach(function(D){v=r.getElement("#w_"+z.config.containerId+"_"+D.get("mid")+"_idea");if(D.get("out")==="1"){this._showIdea(v)}},z)}}};var s=function(){if(z.out){z.translate=0}else{z.translate=z.config.height/2-z.config.heightDiff/2}y=setInterval(B,x)};s()},setup:function(s){var r,q=this._parent.apply(this,arguments);if(s&&s.config){r=s.config}else{r={}}if(s&&s.config&&k.is(s.config.maxIdeasByStatus)){this.maxIdeasByStatus=s.config.maxIdeasByStatus}if(r&&r.statusCollection&&(this.statusCollection!==r.statusCollection)){if(this.statusCollection){this.stopReactingTo(this.statusCollection,"onEdit")}this.statusCollection=r.statusCollection;this.reactTo(this.statusCollection,["onEdit"],function(){if(this.ideaCollection){this.ideaCollection.fetch({onComplete:function(){this.refresh()}.bind(this)})}else{if(this.singleIdeaModel){this.refresh()}}}.bind(this))}this.config=r;this.addEventOnce("onInjected",function(){this.refresh()},this);return q},setConfigAttribute:function(q,r){this.config[q]=r},bindEvents:function(){var t=this.container.getElements("polygon"),q,r,s;if(t.length>0){if(this.config.outClickable===false){r=this.getElement("rect");if(r){r.addEvent("click",this._viewOut.bind(this))}for(q=0;q<t.length;q++){t[q].addEvent("click",this._zoomStatus(this,q+1))}}}}});return f});define("DS/SwymUIComponents/script/feature/core/ui-components/layout/column-view",["UWA/Core","UWA/Utils/Client","DS/SwymUICore/script/lib/view/generic/swym-view"],function(d,c,b){d.extendElement(document.body);var a=b.extend({viewWrapperClass:"views-wrapper",init:function(){this._requestParentHeightAlignment=this._requestParentHeightAlignment.bind(this);this._parent.apply(this,arguments)},_createContent:function(){return this.elements.viewsWrapper=d.createElement("div",{"class":this.viewWrapperClass})},_requestParentHeightAlignment:function(){this.dispatchEvent("onRequestForParentsHeightAlignment",[this])},getViewsWrapper:function(){return this.elements.viewsWrapper},onRedraw:function(){this.elements.viewsWrapper.addEvent("resize",this._requestParentHeightAlignment)}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/interest/user-interest-read-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/interest/model/interest-model","DS/WebappsUtils/Console"],function(d,c,e,a){var b=c.extend({name:"interest-read-view",_modelClass:e,_modelEventsForAutoRefresh:["onChange"],_createContent:function(){var f="";if(this.model.collection.getAssociated("user").isCurrentUser()){f='<span class ="fonticon fonticon-1-5x cursor-pointer fonticon-trash"></span>'}return this.model.get("title")+f}});return b});define("DS/SwymUIComponents/script/feature/community/community/view/community-dummy-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view"],function(c,b){var a=b.extend({name:"community-dummy-view",nbItems:1,setup:function(d){this.nbItems=d.nbItems?d.nbItems:this.nbItems;this._parent.apply(this,arguments)},update:function(d){this.nbItems=d.nbItems?d.nbItems:this.nbItems;this.refresh()},_createContent:function(){var f=[],d=0,e=c.createElement("div",{"class":"community-dummy-view",html:[{tag:"div","class":"community-dummy-thumbnail"},{tag:"div","class":"community-dummy-title"}]});while(d<this.nbItems&&d<100){f.push(c.clone(e));d+=1}return f}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/macro/user-column-details-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/macro/user-column-details-view","DS/WebappsUtils/Console","DS/UIKIT/Popover"],function(f,b,e,a,d){console.log("in the usercolumn details view");var c=b.extend({name:"user-column-details-view",domEvents:{"click .user-completion-container:not(button)":"_activateCompletionInfo"},setup:function(){this.listenTo(this.model,{onPassportSynced:this.refresh});return this._parent.apply(this,arguments)},_activateCompletionInfo:function(){console.log("completion info to be displayed there");var g=this.getChildView("profileCompletion");if(g){g.getChildView("mainView").toggleInfoOnCompletion()}},_createContent:function(){var l=this.model;if(l){var g=l.getAssociated("links"),i=l.isEditableByPassport("company")||l.isEditableByPassport("zip")||l.isEditableByPassport("country_code")||l.isEditableByPassport("address")||l.isEditableByPassport("city");g.sort();var h=this.model.isCurrentUser()?this.addChildView("profileCompletion",{_title:e.Profilecompletion,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_mainView:"DS/SwymUIComponents/script/feature/core/user/view/user-completion-view",_userModel:l,_model:l,_otherIcon:"info-circled",_hasBackground:true}):{},n=this.addChildView("Summary",{_title:e.Summary,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_userModel:l,_model:l,_hasPencilIcon:true,_mainView:"DS/SwymUIComponents/script/feature/core/user/view/summary/user-summary-view",_defaultMessage:e.AddSummary,_checkEmptyAttributes:["tenant_more_about_me"],_hasBackground:true}),p=this.addChildView("Links",{_title:e.Websites,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_userModel:l,_model:l,_hasPlusIcon:true,_mainView:"DS/SwymUIComponents/script/feature/core/link/view/link-view",_defaultMessage:e.Addawebsite,_collection:g,_iconSection:"link",_hasBackground:true}),o=this.addChildView("Location",{_title:e.Location,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_userModel:l,_model:l,_hasPencilIcon:i,_mainView:"DS/SwymUIComponents/script/feature/core/user/view/location/user-location-view",_iconSection:"map",_hasBackground:true}),j=this.addChildView("mail",{_title:e.Mail,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_userModel:l,_model:l,_hasPencilIcon:l.isEditableByPassport("email"),_mainView:"DS/SwymUIComponents/script/feature/core/user/view/mail/user-mail-view",_iconSection:"mail",_hasBackground:true,_defaultMessage:e.AddMail,_checkEmptyAttributes:["email"]}),m=this.addChildView("phone",{_title:e.Phone,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_userModel:l,_model:l,_hasPencilIcon:this.model.isEditableByPassport("tel"),_mainView:"DS/SwymUIComponents/script/feature/core/user/view/phone/user-phone-view",_iconSection:"phone",_checkEmptyAttributes:["tel"],_defaultMessage:e.AddPhone,_hasBackground:true}),k=f.createElement("div",{html:[{"class":"col-xs-12 user-completion-container cursor-pointer",html:h},{"class":"col-xs-12 user-summary-container",html:n},this.model.isCurrentUser()?{"class":"col-xs-12",html:j}:{},this.model.isCurrentUser()?{"class":"col-xs-12",html:m}:{},{"class":"col-xs-12 links-container",html:p},{"class":"col-xs-12 user-location-container",html:o}]});return k}}});return c});define("DS/SwymUIComponents/script/feature/core/link/view/account-link-edit-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/link/view/link-edit-view","DS/SwymUICore/script/feature/core/link/model/link-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Form"],function(f,c,b,e,a){var d=e.extend({});return d});define("DS/SwymUIComponents/script/feature/core/ui-components/sortable/sortable-list-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","UWA/Controls/Drag","DS/SwymUICore/script/utils/utils"],function(e,b,d,a){var c=b.extend({name:"sortable-list-view",_expanded:true,_mode:"full",init:function(f){this.itemView=f.itemView;this.itemClassName=f.itemClassName;this.collection=f.collection;this.onRemove=f.onRemove;this.onChange=f.onChange;this.addPlaceholder=f.addPlaceholder;this.reorderPlaceholder=f.reorderPlaceholder;this.removePlaceholder=f.removePlaceholder;this.defaultPlaceholder=f.defaultPlaceholder;this.ghostBuilder=f.ghostBuilder;this.isAllowedToDrop=f.isAllowedToDrop;this.forbiddenPlaceholder=f.forbiddenPlaceholder;this.viewAllPlaceholder=f.viewAllPlaceholder;this.limit=f.limit;this.contentType=f.contentType;this.contentId=f.contentId;return this._parent.apply(this,arguments)},setMode:function(f){if(f==="restricted"){this._mode=f}else{this._mode="full"}},setCollection:function(f){this.collection=f;this.refresh()},appendNewItem:function(g){var f=g.get("position"),j=this.container.getElement(".draggable-list"),i=j.getChildren(),h=e.createElement("div",{"class":"draggable-sortable-item thread-view "+this.itemClassName,"data-content-id":g.get("mid"),"data-content-type":g.get("users")?"direct-message":"community",styles:this._expanded?"":{display:"none"},html:this.addChildView("sortable-item-"+g.get("mid"),new this.itemView({model:g}))});if(f&&i.hasOwnProperty(f-1)){j.insertBefore(h,i[f-1])}else{j.appendChild(h)}this.defaultZone.hide()},removeItem:function(g){var f=this.container.querySelector('.draggable-sortable-item[data-content-id="'+g+'"]');f&&f.destroy();if(this.container.getElementsByClassName("draggable-sortable-item").length===0){this.defaultZone.show()}},isEmpty:function(){return false},displayNextPage:function(){var g=this.container.getElementsByClassName("draggable-sortable-item"),h,f=0,i=false;for(h in g){if(g.hasOwnProperty(h)&&g[h].isHidden()){if(f<=this.limit){g[h].show();f+=1}else{i=true}}}this._expanded=!i?true:false;return f<this.limit},viewAllAction:function(){if(this.viewAllPlaceholder){var f=this.container.getElementsByClassName("draggable-sortable-item"),g;for(g in f){if(f.hasOwnProperty(g)&&f[g].isHidden()){f[g].show()}}this._expanded=true;this.viewAll.hide()}},isExpanded:function(){return this._expanded},_addPersistentPlaceholder:function(f){this.persistentPlaceholder=e.createElement("div",{"class":"placeholder "+this.itemClassName,html:this.placeHolderHtml});if(f.placeholder&&f.placeholder.isInjected()){this.persistentPlaceholder.inject(f.placeholder,"before")}else{this.persistentPlaceholder.inject(this.sortableContainer)}},_createContent:function(){var h=this,g,f=0;h.placeHolderHtml=[{tag:"span","class":"fonticon fonticon-plus fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:h.addPlaceholder}];h.itemCssSelector="."+h.itemClassName;h.defaultZone=e.createElement("div",{"class":"default-drop-zone",html:[{tag:"span","class":"fonticon fonticon-drag-drop fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:h.defaultPlaceholder}]});h.forbiddenZone=e.createElement("div",{"class":"forbidden-zone",html:[{tag:"span","class":"fonticon fonticon-block fonticon-3x"},{tag:"span","class":"drop-zone-placeholder",html:h.forbiddenPlaceholder}]});h.pushBottomZone=e.createElement("div",{"class":"push-bottom-zone",html:[{tag:"span","class":"fonticon fonticon-plus fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:"Add favorite here"}]});h.trashZone=e.createElement("div",{"class":"draggable-sortable-trash",html:[{tag:"span","class":"fonticon fonticon-trash fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:h.removePlaceholder}]});h.viewAll=h.viewAllPlaceholder?e.createElement("div",{"class":"view-all",html:h.viewAllPlaceholder,events:{click:h.viewAllAction.bind(h)}}):"";if(h.collection.length>0){g=[h.collection.map(function(i){var j="";if(!h.limit||h.limit&&f<h.limit){f+=1}else{j={display:"none"}}return e.createElement("div",{"class":"draggable-sortable-item thread-view "+h.itemClassName,"data-content-id":h.contentId?h.contentId(i):i.get("mid"),"data-content-type":h.contentType?h.contentType:"community",styles:j,html:h.addChildView("sortable-item-"+i.get("mid"),new h.itemView({model:i}))})})];h.defaultZone.hide()}if(h._mode==="restricted"){h.defaultZone.hide()}h._expanded=h.limit&&h.collection.length>h.limit?false:true;h.forbiddenZone.hide();h.pushBottomZone.hide();g=[h.forbiddenZone,h.defaultZone,h.sortableContainer=e.createElement("div",{"class":"draggable-list",html:g}),h.trashZone,h.pushBottomZone,!h._expanded?h.viewAll:""];h.isDragState=false;h.dragMoveComponent&&h.dragMoveComponent.destroy();h.dragMoveComponent=new d.Move({container:document.body,zones:[h.sortableContainer,h.trashZone,h.pushBottomZone],delegate:h.itemCssSelector+", "+h.itemCssSelector+" *",centerHandles:true,handles:h._handles.bind(h),move:h._move.bind(h),fixed:h._fixed.bind(h),enter:h._enter.bind(h),leave:h._leave.bind(h),drop:h._drop.bind(h),stop:h._stop.bind(h),start:h._start.bind(h)});return g},_start:function(f){var g=f.target.getClosest(this.itemCssSelector);if(g.hasClassName("draggable-sortable-item")&&this._mode==="restricted"){return false}},_handles:function(f){var g=this,i,h=[{tag:"span","class":"fonticon fonticon fonticon-drag-drop fonticon-2x"},{tag:"span","class":"drop-zone-placeholder",html:g.reorderPlaceholder}],j=f.target.getClosest(g.itemCssSelector);g.isFromDraggableList=j.hasClassName("draggable-sortable-item");g.isDragState=g.isAllowed=true;g.hasBeenAdded=g.hasBeenDropped=false;g.dispatchEvent("onDragStart",f);g.defaultZone.hide();i=g.ghostBuilder(f);i=i?i:j;if(!g.isAllowedToDrop(i)&&!g.isFromDraggableList){g.isAllowed=false;g.container.addClassName("forbidden");g.forbiddenZone.show()}(!f.placeholder||(!f.placeholder.isInjected()&&!g.persistentPlaceholder.isInjected()))&&g.isAllowed&&g._mode==="full"&&g._addPersistentPlaceholder(f);if(g.isFromDraggableList&&g.isAllowed){g.trashZone.setStyle("display","block");g.trashZone.setStyle("opacity",1)}if(!g.isFromDraggableList&&g.isAllowed&&g._mode==="restricted"){g.container.addClassName("restricted-mode");g.pushBottomZone.show()}f.placeholder=e.createElement("div",{"class":"placeholder hover-placeholder "+g.itemClassName,html:g.isFromDraggableList?h:g.placeHolderHtml});g.oldHandlesHTML=i;g.currentHandles=a.cloneNode(i,true);e.extendElement(g.currentHandles);i.hide();g.currentHandles.addClassName("dragged custom-ghost no-rich-tooltip");g.currentHandles.inject(document.body.getParent()).show();g.currentHandles.style.width=g.container.offsetWidth+"px";return g.currentHandles},_move:function(f){f.refreshCache()},_fixed:function(g,f){return(f.hasClassName("draggable-sortable-trash")||f.hasClassName("default-drop-zone"))?true:false},_enter:function(f){if(this.isAllowed&&this._mode==="full"){if(f.zone.hasClassName("draggable-list")){this.persistentPlaceholder&&this.persistentPlaceholder.destroy();return f.placeholder}else{!f.placeholder.isInjected()&&!this.persistentPlaceholder.isInjected()&&this._addPersistentPlaceholder(f)}if(f.zone.hasClassName("draggable-sortable-trash")){f.zone.addClassName("hover-trash")}}else{if(this.isAllowed&&this._mode==="restricted"){if(f.zone.hasClassName("push-bottom-zone")){f.zone.addClassName("hover-placeholder")}}}},_leave:function(f){if(this.isAllowed&&this._mode==="full"){if(f.zone.hasClassName("draggable-sortable-trash")){f.zone.removeClassName("hover-trash")}if(f.zone.hasClassName("draggable-list")){this._addPersistentPlaceholder(f)}}else{if(this.isAllowed&&this._mode==="restricted"){if(f.zone.hasClassName("push-bottom-zone")){f.zone.removeClassName("hover-placeholder")}}}},_drop:function(g){this.hasBeenDropped=true;if(this.isAllowed){var h=0,i,f;if(g.zone.hasClassName("push-bottom-zone")&&this._mode==="restricted"){this.onChange(g.handles,this.sortableContainer.getChildren().length);this.hasBeenAdded=true}else{if(g.zone.hasClassName("draggable-sortable-trash")){this.onRemove(g.handles)}else{if(g.zone.hasClassName("draggable-list")){i=this.sortableContainer.getChildren();f=g.target.getClosest(this.itemCssSelector);if(g.handles.getClosest(this.itemCssSelector).hasClassName("draggable-sortable-item")&&i.indexOf(f)<i.indexOf(g.placeholder)){h=-1}this.isFromDraggableList&&this.oldHandlesHTML.destroy();this.onChange(g.handles,i.indexOf(g.placeholder)+h);this.hasBeenAdded=true}}}}},_stop:function(f){var g=f.handles.getClosest(this.itemCssSelector);this.dispatchEvent("onDragStop",f);if(!this.hasBeenDropped){f.handles.destroy()}if(this.isAllowed){this.trashZone.setStyle("opacity",0);this.trashZone.removeClassName("hover-trash");this.trashZone.hide();this.persistentPlaceholder&&this.persistentPlaceholder.destroy();this.pushBottomZone.hide();this.pushBottomZone.removeClassName("hover-trash");f.placeholder.destroy();f.handles.destroy();if(this.sortableContainer.getChildren().length===0){this.defaultZone.show()}}else{if(g){g.removeClassName("dragged");g.setStyles({left:null,top:null})}this.container.removeClassName("forbidden");this.forbiddenZone.hide();f.handles.destroy()}if(!this.hasBeenAdded){this.oldHandlesHTML.show()}this.isFromDraggableList=this.isDragState=this.hasBeenAdded=false},showItemsView:function(){this.getElements(".thread-view > *:first-child").forEach(function(f){f.show()})},destroy:function(){this.dragMoveComponent.destroy();return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/core/user/view/idcard/user-idcard-bottom-bar",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Button","DS/WebappsUtils/Console","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/edit-all-bar/edit-all-bar","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/idcard/user-idcard-bottom-bar","DS/UWPClientCode/PublicAPI","DS/WAFData/WAFData"],function(g,e,f,b,d,i,a,h){var c={};var j=e.extend({_idcardInstance:null,name:"user-idcard-bottom-bar",setup:function(k){k=k||{};if(k.idcardInstance){this._idcardInstance=k.idcardInstance}else{throw new Error("idcard undefined for user-idcard-bottom-bar")}return this._parent.apply(this,arguments)},_createContent:function(){return{"class":"idcard-bottom-bar",html:[this.addControl("idcard-bottom-save-button",new f({value:d.validate,className:"saveButton primary",events:{onClick:function(k){var p=this._idcardInstance._controls.editView,q=this.getControl("idcard-bottom-save-button");if(q){q.load()}if(p){var m=p.getControl("idcard1-form"),n=m.validate(),l=this._idcardInstance.model,o=l.getChanges("first_name"),t=l.getChanges("last_name"),s=true,r={};if(o){s=o.trim()}if(t){s=s&&t.trim()}if(n&&l&&s){if(o||t){if(o){r.firstName=o}if(t){r.lastName=t}l.updatePassportFields({data:r,onComplete:function(x,w){this._idcardInstance.switchToViewMode();var u=l.getChanges("first_name");if(u!==undefined){l.set("first_name",u.escapeHTML())}u=l.getChanges("last_name");if(u!==undefined){l.set("last_name",u.escapeHTML())}q.load(false);var y=this._idcardInstance.options.attributesMapping.title.call(l),v=this._idcardInstance.getElement(".title-section span");if(window.ds&&window.ds.env!=="3DD"){this.alert("success",i.personalInfoUpdated);require(["DS/TopBar/TopBar"],function(z){z.set({userName:l.getNickname().unescapeHTML()})}.bind(this))}else{if(window.ds&&window.ds.env==="3DD"){if(window.widget){widget.onRefresh();widget.setTitle(l.getNickname().unescapeHTML())}}}if(y&&v){v.textContent=y}if(window.ds&&(window.ds.env==="3DD")){require(["DS/PlatformAPI/PlatformAPI"],function(z){z&&z.publish("profile:update")})}}.bind(this)})}else{this.alert("info",i.noChangeDetected);q.load(false)}}else{q.load(false);this.alert("error",i.pleaseFillTheFieldsCorrectly);return n}}}.bind(this)}})),new f({value:d.cancel,className:"cancelButton default",events:{onClick:function(k){this._idcardInstance.switchToViewMode()}.bind(this)}})]}}});return j});define("DS/SwymUIComponents/script/lib/ckeditor/customlink/plugin",["DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/lib/ckeditor/customlink/customlink"],function(a,b){CKEDITOR.plugins.add("customlink",{init:function(c){if(c._.menuItems.link){delete c._.menuItems.link}c.addCommand("customlink",new CKEDITOR.dialogCommand("customlinkDialog"));c.ui.addButton("CustomLink",{label:b.InsertALink,command:"customlink",toolbar:"links"});CKEDITOR.dialog.add("customlinkDialog",this.path+"dialogs/customlink.js");c.on("doubleclick",function(d){var e=d.data.element;if(e.is("a")){d.data.dialog="customlinkDialog"}},null,null,100)}})});define("DS/SwymUIComponents/script/feature/core/user/view/mail/user-mail-edit-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UIKIT/Input/Text","DS/UIKIT/Form","DS/WebappsUtils/Console"],function(g,f,d,e,c,a){var b=f.extend({_modelClass:d,name:"user-mail-edit-view",_createContent:function(){var h=this.model,j=h.getPassportAttributeConstraints("email");var i=this.addControl("form-aboutme",new c({fields:[g.merge({type:"email",value:h.get("email",{escapeHTML:false}),events:{onChange:function(){h.addChanges("email",this.getValue())}}},j)]}));return i}});return b});define("DS/SwymUIComponents/script/lib/creation-statistics-persistence",["UWA/Core","UWA/Class/Events","DS/SwymUICore/script/lib/model/model-manager","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/utils/localstorage-utils"],function(i,m,h,g,j,f,l){var d=null,b=j.getInstance(),n=5,e="creation",k="visit",a={post:[],media:[],idea:[],iquestion:[],survey:[],wiki:[]},c=m.extend({_localStorageData:null,_getTenantId:function(){var o,p,q=window.widget;if(q&&q.getPreference("url")){o=q.getPreference("url").id}else{p=g.getInstance();if(p&&p.get("config")){o=p.get("config").tenant.online_instance_id}else{throw new Error("No tenant found")}}return o},_getLocalStorageKey:function(){var o=this._getTenantId(),p=[o,"lastPostedCommunities"].join(":");return p},populateModelFromLocalStorage:function(){var o=this._getLocalStorageKey(),p=l.getItem(o);this._localStorageData=i.extend(a,p);this._migrateLocalStorageData()},_saveToLocalStorage:function(){var o=this._getLocalStorageKey();l.setItem(o,this._localStorageData)},_migrateLocalStorageData:function(){var q,r=false;for(var p in this._localStorageData){q=this._localStorageData[p];for(var o=q.length-1;o>=0;o--){if(typeof q[o]==="string"){r=true;q.splice(o,1)}}}if(r){this._saveToLocalStorage()}},_removeFromLocalStorage:function(){var o=this._getLocalStorageKey();l.removeItem(o)},_onPublishing:function(r){var s=false,o=r.getCommunity(),u=o.get("mid"),t=r.getModelName(),p=o.get("title",{escapeHTML:false}),q=this._localStorageData[t];if(q){if(!q[0]||q[0].communityId!==u||q[0].status!==e){if(q.length===n){q.pop()}q=this._removeCommunity(q,u);q.unshift({communityId:u,status:e,communityTitle:p});s=true}if(s===true){this._saveToLocalStorage();this.dispatchEvent("CommunitiesUpdated",[t])}}},_onCommunityChange:function(z){if(z&&z.communityId){var B=new f({mid:z.communityId});if(!B.hasBeenFetched()){B.addEvent("onSync",function(){this._onCommunityChange(z)}.bind(this))}else{var C=false,w=B.get("mid"),D=B.get("title",{escapeHTML:false}),A=this._localStorageData,v=false,x=false,t=0,p=[],s=0,o=[];for(var y in A){p=A[y];switch(y){case"post":x=B.canCreatePosts();break;case"media":x=B.canCreateMedia();break;case"idea":x=B.canCreateIdeas();break;case"iquestion":x=B.canCreateQuestions();break;case"survey":x=B.canCreateSurveys();break;case"wiki":x=B.canCreateWikiPages();break}v=!this._areCommunitiesAllWithStatusCreation(p);if(v&&x&&this._getStatusOfCommunityInlist(p,w)!==e){p=this._removeCommunity(p,w);if(p.length<n){p.push({communityId:w,status:k,communityTitle:D})}else{for(var u=0,r=p.length;u<r;u++){if(p[u].status==="VISITED"){t=u;break}}p.splice(t,0,{communityId:w,status:k,communityTitle:D});p.pop()}A[y]=p;C=true;o.push(y)}}if(C){this._saveToLocalStorage();for(var q=0,r=o.length;q<r;q++){this.dispatchEvent("CommunitiesUpdated",[o[q]])}}}}},_getStatusOfCommunityInlist:function(r,t){var o,q=null;for(var s=0,p=r.length;s<p;s++){o=r[s];if(o.communityId===t){q=o.status;break}}return q},_removeCommunity:function(o,q){for(var p=o.length-1;p>=0;p--){if(o[p]&&o[p].communityId===q){o.splice(p,1);break}}return o},_areCommunitiesAllWithStatusCreation:function(q){var p=true;if(q.length===n){for(var r=0,o=q.length;r<o;r++){if(q[r].status!==e){p=false;break}}}else{p=false}return p},clear:function(){this._localStorageData=i.clone(a)},init:function(){this._parent.apply(this,arguments);if(!this._onPublishingBound){this._onPublishingBound=this._onPublishing.bind(this);h.addListenerOnPublishing(this._onPublishingBound)}if(!this._onCommunityChangeBound){this._onCommunityChangeBound=this._onCommunityChange.bind(this);if(b.addListener("onCommunityChange",this._onCommunityChangeBound,this,true)===true){this._onCommunityChangeBound()}}this.populateModelFromLocalStorage()},getRecentCommunitiesForContentType:function(o){var p=this._localStorageData[o]||[];return i.clone(p)},removeCommunitiesForContentType:function(q,p){var o=this._localStorageData[q];p.forEach(function(r){o=this._removeCommunity(o,r.communityId)}.bind(this));this._saveToLocalStorage();this.dispatchEvent("CommunitiesUpdated",[q])}});return{getInstance:function(){if(d===null){d=new c()}return d}}});define("DS/SwymUIComponents/script/feature/core/ui-components/view-mode-switcher/view-mode-switcher",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/ui-components/view-mode-switcher/view-mode-switcher","DS/UIKIT/Tooltip","DS/SwymUICore/script/lib/view/generic/swym-view","DS/WebappsUtils/Console","DS/SwymUICore/script/utils/localstorage-utils"],function(g,f,e,c,b,d){var a=c.extend({name:"view-mode-switch",_context:null,_mode:null,_modes:{whatsNew:["list","tiles"],communityMediaTab:["small","large"]},_classPrefix:{whatsNew:"box-",communityMediaTab:"wrapper-"},_layoutClasses:{whatsNew:{list:["col-lg-12","col-md-12","col-sm-12","col-xs-12"],tiles:["col-lg-4","col-md-6","col-sm-6","col-xs-12"]},communityMediaTab:{small:["col-lg-2","col-md-3","col-sm-4","col-xs-6"],large:["col-lg-3","col-md-4","col-sm-6","col-xs-12"]}},_target:null,_dimensions:null,attributes:{styles:{position:"absolute",top:"5px",right:"25px"}},_createContent:function(){var h=null;if(this._context==="whatsNew"){h=g.createElement("div",{"class":"view-toolbar",html:[{tag:"div",styles:{background:"transparent",display:"inline-block"},html:{tag:"span","class":"apply_tiles_mode fonticon fonticon-2x fonticon-layout"+(this._mode!=="tiles"?" unselect-view":""),styles:{margin:"0"}}},{tag:"div",styles:{background:"transparent",display:"inline-block","margin-left":"0px"},html:{tag:"span","class":"apply_list_mode fonticon fonticon-2x fonticon-menu"+(this._mode!=="list"?" unselect-view":""),styles:{margin:"0"}}}]});var i=g.Utils.Client.Features.touchEvents;if(!i){this.addControl("tilesModeTooltip",new e({target:h.getElement(".apply_tiles_mode"),body:f.TilesView,position:"bottom"}));this.addControl("listModeTooltip",new e({target:h.getElement(".apply_list_mode"),body:f.ListView,position:"bottom"}))}}return h},init:function(h){try{h=h||{};if(h.target){this.setTarget(h.target)}this._dimensions=(h.dimensions)?h.dimensions:null;this._context=h.viewModeContext||"whatsNew";this._mode=this.isModeValid(h.mode)?h.mode:this._modes[this._context][0];return this._parent.apply(this,arguments)}catch(i){b.error("Error initializing view mode switch: "+i.message);return false}},applyMode:function(){var p,s,n,l,w,x,h,u,v,t=this._target,k=t.container,m=t.getModelViews(),q=this._modes[this._context],y=this._classPrefix[this._context],r=this._layoutClasses[this._context],o=r[this._mode];if(!k.hasClassName(y+this._mode)){for(p=0,s=q.length;p<s;p++){k.removeClassName(y+q[p])}k.addClassName(y+this._mode)}for(p=0,s=m.length;p<s;p++){w=m[p];h=w.container;u=h.className;for(n=0,l=q.length,v=[];n<l;n++){x=q[n];if(x!==this._mode){v=v.concat(r[x])}}u=u.replace(new RegExp(v.join("|").replace(/-/g,"\\-"),"g"),"");u+=(" "+o.join(" "));h.setAttribute("class",u.replace(/\s{1,}/g," "))}return this._mode},bindEvents:function(){this._modes[this._context].forEach(function(h){this.getElement(".apply_"+h+"_mode").addEvent("click",this.setMode.bind(this,h))},this);return true},isModeValid:function(h){if(h&&this._modes[this._context].indexOf(h)>-1){return true}return false},getMode:function(){return this._mode},setMode:function(k){if(!this.isModeValid(k)){throw new Error("Mode is not valid")}if(this._mode!==k){var j=null,i,h=this.getElement(".apply_"+k+"_mode");if(this._context==="whatsNew"){j=this.getElement(".apply_"+(k==="tiles"?"list":"tiles")+"_mode")}else{if(this._context==="communityMediaTab"){j=this.getElement(".apply_"+(k==="large"?"small":"large")+"_mode");document.cookie="mediaListMode="+k+"; path=/"}}if(j){j.addClassName("unselect-view")}if(h){h.removeClassName("unselect-view")}this.dispatchEvent("onBeforeModeChange",[k]);this._mode=k;this.applyMode();this.dispatchEvent("onModeChange",[this,this._mode]);if(this._context==="whatsNew"){i=d.getItem("viewModes");if(!i){i={}}i[this._context]=k;d.setItem("viewModes",i)}}return this},setTarget:function(h){if(h&&h.container){this._target=h}else{throw new Error("Provided target is invalid")}return this._target},getImagesReloadOptionsForTarget:function(){var h=(this.getMode()==="tiles"?{size:"xl"}:{});return h}});return a});define("DS/SwymUIComponents/script/feature/core/education/view/education-read-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-read-view","DS/SwymUICore/script/feature/core/education/model/education-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/date","DS/UIKIT/DropdownMenu","DS/SwymUICore/script/utils/i18n"],function(g,e,h,f,c,b,d){var a=f.extend({_modelEventsForAutoRefresh:["onChange:place","onChange:date_begin","onChange:date_end","onChange:degree","onChange:not_finished","onChange:description","onChange:field_of_study","onChange:school_name"],_modelClass:h,name:"education-read-view",_createContent:function(){var k=this.model.collection.getAssociated("user").isCurrentUser(),n=k?'<span class="fonticon fonticon-2x cursor-pointer fonticon-down-open"></span>':"",j=this.model.get("degree")?d.replace(e.degreein,{degree:this.model.get("degree"),fieldOfStudy:this.model.get("field_of_study")}):this.model.get("field_of_study"),i=this.model.get("place")?"("+this.model.get("place")+")":"",m=this.model.get("not_finished")=="1"?'<span class="profile-date-experience">'+e.since+" "+c.textDate(this.model.get("date_begin"))+"</span>":'<span  class="profile-date-experience">'+c.textDate(this.model.get("date_begin"))+" - "+c.textDate(this.model.get("date_end"))+"</span>",l=g.createElement("div",{html:'<span class="profile-title-experience">'+j+"</span>"+n+'<br><span class="profile-location-experience">'+this.model.get("school_name")+" "+i+"</span>"+m+'<span class="profile-description-experience">'+(this.model.get("description",{breakline:true})||"")+"</span>"});this.addControl("dropdown",new b({target:l.getElement(".fonticon-down-open"),items:[{text:e.Edit,fonticon:"pencil"},{text:e.Delete,fonticon:"trash"}],events:{onClick:function(p,o){if(o.fonticon==="pencil"){this.model.dispatchEvent("onPencilIconClicked")}else{if(o.fonticon==="trash"){this.model.dispatchEvent("onTrashIconClicked")}}}.bind(this)}}));return l}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/phone/user-phone-edit-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UIKIT/Form","DS/WebappsUtils/Console"],function(f,e,d,b,a){var c=e.extend({_modelClass:d,name:"user-phone-edit-view",_createContent:function(){var g=this.model,i=g.getPassportAttributeConstraints("tel");var h=this.addControl("form-aboutme",new b({fields:[f.merge({type:"text",value:g.get("tel",{escapeHTML:false}),events:{onChange:function(){g.addChanges("tel",this.getValue())}}},i)]}));return h}});return c});define("DS/SwymUIComponents/script/feature/core/tenant/view/tenant-settings-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/tenant-settings-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button"],function(f,c,e,d,g,a){var b=e.extend({name:"tenant-settings",model:null,_el:null,_newOptions:null,domEvents:{"click .save-tenant-settings-button":"onSaveEditButtonClick","click .cancel-tenant-settings-button":"onCancelButtonClick","change .options-radio":"onRadioChange","change .options-checkbox":"onCheckboxChange","change .options-reverse-checkbox":"onReverseCheckboxChange"},attributes:{styles:{padding:"10px"}},_createContent:function(){var i=this.model,h=this.options,j;if(i){if(!this._controls["save-tenant-settings-button"]){this.addControl("save-tenant-settings-button",new a({className:"primary save-tenant-settings-button",value:c.Save}));this.addControl("cancel-tenant-settings-button",new a({className:"default cancel-tenant-settings-button",value:c.Cancel}))}j=[[{html:[{tag:"label",html:c.Share},this.addControl("share_facebook",new g({name:"share_facebook",type:"checkbox",value:"Facebook",checked:h.share_facebook,className:"primary indent-option options-checkbox"})),this.addControl("share_linkedin",new g({name:"share_linkedin",type:"checkbox",value:"Linkedin",checked:h.share_linkedin,className:"primary indent-option options-checkbox"})),this.addControl("share_twitter",new g({name:"share_twitter",type:"checkbox",value:"Twitter",checked:h.share_twitter,className:"primary indent-option options-checkbox"}))]},{tag:"label",html:c.CreateACommunity},this.addControl("create_a_community_1",new g({name:"create_a_community",type:"radio",label:c.ForPlatformAdministratorsOnly,value:"admins_only",checked:(!h.plan_a_community&&!h.allow_add_community_for_everyone),className:"primary indent-option options-radio"})),(d.getInstance().isFeatureActivated("activate_community_request")?this.addControl("create_a_community_2",new g({name:"create_a_community",type:"radio",label:c.PlanCommunity,value:"plan_a_community",checked:h.plan_a_community,className:"primary indent-option options-radio"})):""),this.addControl("create_a_community_3",new g({name:"create_a_community",type:"radio",label:c.ForAllUsers,value:"allow_add_community_for_everyone",checked:h.allow_add_community_for_everyone,className:"primary indent-option options-radio"})),{tag:"label",html:c.ActivateUserCustomization},this.addControl("user_picture_upload",new g({name:"block_userpicture_upload",type:"checkbox",value:c.ProfilePicture,checked:!h.block_userpicture_upload,className:"primary indent-option options-reverse-checkbox"}))],this._controls["cancel-tenant-settings-button"],this._controls["save-tenant-settings-button"]];return j}},setup:function(i){var h=this._parent.apply(this,arguments);this._newOptions={};if(i){this.settings=i.settings||{};this.options=i.options||{}}return h},onCancelButtonClick:function(){this.model.removeChanges();this._newOptions={};this.refresh()},onSaveEditButtonClick:function(){if(this.model.hasVirtuallyChanged()){this.mask();this.model.save({id:this.model.get("mid")},{onComplete:function(){this.unmask();this.alert("success",c.Yoursettingshasbeensaved)}.bind(this),onFailure:function(){this.unmask();this.alert("error",c.Errorwhilesavingyoursettings)}.bind(this)})}var h=(Object.keys(this._newOptions).length===0);if(!h){this.mask();this.model.editOptions({data:this._newOptions,onComplete:function(k,j){this.unmask();this.options=j.result;this._newOptions={};var i=d.getInstance();i.updateTenantAttributes(j.result);this.alert("success",c.Yoursettingshasbeensaved)}.bind(this),onFailure:function(){this.unmask();this.alert("error",c.Errorwhilesavingyoursettings)}.bind(this)})}},onRadioChange:function(h){var j=[],i=h.target;if(i.name==="create_a_community"){delete this._newOptions.plan_a_community;delete this._newOptions.allow_add_community_for_everyone;switch(i.value){case"plan_a_community":j.push({name:"plan_a_community",value:i.checked});j.push({name:"allow_add_community_for_everyone",value:!i.checked});break;case"allow_add_community_for_everyone":j.push({name:"allow_add_community_for_everyone",value:i.checked});j.push({name:"plan_a_community",value:!i.checked});break;default:j.push({name:"plan_a_community",value:false});j.push({name:"allow_add_community_for_everyone",value:false});break}j.forEach(function(k){if(k.value!==this.options[k.name]){this._newOptions[k.name]=k.value}},this)}},onCheckboxChange:function(h){this._newOptions[h.target.name]=h.target.checked;if(this._newOptions[h.target.name]===this.options[h.target.name]){delete this._newOptions[h.target.name]}},onReverseCheckboxChange:function(h){this._newOptions[h.target.name]=!h.target.checked;if(this._newOptions[h.target.name]===this.options[h.target.name]){delete this._newOptions[h.target.name]}}});return b});define("DS/SwymUIComponents/script/feature/core/user/view/user-group/user-group-nbmembers-view",["i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/users-group-tile-view"],function(a){return{getUserGroupMembersText:function(b){var d=parseInt(b.get("nb_members"),10),c;if(!(d>0)){d=0}switch(d){case 0:c=a.get("noMember");break;case 1:c=a.get("1member");break;default:c=a.get("Nmembers",{nbMembers:d});break}return c}}});define("DS/SwymUIComponents/script/utils/content-creation-types-manager",["UWA/Core","DS/SwymUICore/script/lib/pub-sub","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/utils","DS/Logger/Logger"],function(a,e,o,b,p,g,s){var d="post",f="iquestion",l="idea",q="media",r="survey",i="wiki",c="message",m="comment",j=(window.ds&&window.ds.swymIM===true)?[c,m,d,q,l,f,r,i]:[d,q,l,f,r,i],n=[c,m,d,q],k=null,t={},h=e.extend({_types:null,_isCurrentTypeSelectedByUser:false,_currentType:null,_previousType:null,_currentCommentSubjectContentType:null,_communityMode:null,_programmaticallyChanged:false,getDefaultContentType:function(){var u=null;if(this._types.length>0){u=this._types[0]}return u},_setIsCurrentTypeSelectedByUser:function(u){this._isCurrentTypeSelectedByUser=Boolean(u)},isCurrentTypeSelectedByUser:function(){return this._isCurrentTypeSelectedByUser},getCurrentCommentSubjectContentType:function(){return this._currentCommentSubjectContentType},_setCurrentCommentSubjectContentType:function(u){if(u){u=u.toLowerCase()}if(u!==this._currentCommentSubjectContentType){this._currentCommentSubjectContentType=u;this.dispatchEvent("onCommentSubjectContentTypeChange",{commentSubjectContentType:this._currentCommentSubjectContentType},true)}},getPreviousContentType:function(){return this._previousType},getCurrentContentType:function(){return this._currentType},_setCurrentContentType:function(x,w,v,A){var z=this._currentType,y=(this._types.indexOf(x)>=0),u=y&&(x!==z);if(u){this._previousType=this._currentType;this._currentType=x}if(y&&v===true){this.dispatchEvent("onContentTypeIconChange",{oldType:z,newType:x},true)}if((y&&A===true)||(u&&(w!==true))){this.dispatchEvent("onCurrentContentTypeChange",{forceFocus:A},true)}if(u){return this._currentType}return false},getContentTypes:function(){return a.clone(this._types)},getAllPossibleContentTypes:function(){return a.clone(j)},init:function(){var u=this._parent.apply(this,arguments);this._types=a.clone(j);this._currentType=this._types[0];this.onContextChangeBound=this.onContextChange.bind(this);this._onFeedModeChange=this._onFeedModeChange.bind(this);this._context=o.getInstance();this._context.addListener("onContextChange",this.onContextChangeBound,this,true);this._context.addListener("onFeedModeChange",this._onFeedModeChange);return u},_onFeedModeChange:function(u){var w=u.feedMode,x=this._types.indexOf(c),v=this._types.indexOf(m);if(v>=0&&(w===o.WHATSNEW_MODE)){this._types.splice(v,1)}if((x>=0)&&((w===o.WHATSNEW_MODE))){this._communityMode=w;this._types.splice(x,1)}else{if((x<0)&&((w===o.TIMELINE_MODE))){this._communityMode=w;this._types.unshift(c)}}this.setContentTypeRequest({type:this._types[0],silent:true});this.dispatchEvent("onContentTypesChange",{contentTypes:a.clone(this._types)},true)},onContextChange:function(){var u,v,z,x,y,A=false,B=a.clone(this._types),D=null,w;this._communityMode=this._context.feedMode;if(!this._context.isContentContext()){if((this._context.isCommunityContext()||this._context.isDirectMessageContext())){if(this._context.isDirectMessageContext()){v=this._context.getDirectMessagePageContext();z=new b({id:this._context.communityId});switch(v){case o.COMMUNITY_BLOG:D=d;break;case o.COMMUNITY_MEDIA:D=q;break;default:}if(D){this._types=[D]}else{this._types=[];for(x=0,y=n.length;x<y;x++){w=n[x];if(this._communityMode===o.TIMELINE_MODE||(this._communityMode===o.WHATSNEW_MODE&&w!==c&&w!==m)){this._types.push(w)}}}}else{u=this._context.getCommunityPageContext();z=new b({id:this._context.communityId});if(z.creationRightsAvailable()===false){z.addEventOnce("onSync",this.onContextChangeBound);return}z.removeEvent("onSync",this.onContextChangeBound);switch(u){case o.COMMUNITY_BLOG:D=d;break;case o.COMMUNITY_IDEAS:D=l;break;case o.COMMUNITY_QUESTIONS:D=f;break;case o.COMMUNITY_SURVEYS:D=r;break;case o.COMMUNITY_WIKI:D=i;break;case o.COMMUNITY_MEDIA:D=q;break;default:}if(D){if(this.isContentCreationAllowed(D,z)){this._types=[D]}else{this._types=[]}}else{this._types=[];for(x=0,y=j.length;x<y;x++){if(this.isContentCreationAllowed(j[x],z)){if((this._communityMode===o.TIMELINE_MODE)||((this._communityMode===o.WHATSNEW_MODE)&&(j[x]!==c)&&(j[x]!==m))){this._types.push(j[x])}}}}}}else{var C=this.getAllPossibleContentTypes();if(window.ds&&window.ds.swymIM===true){C.splice(0,2)}this._types=C}}if(A!==true){if(B.length!==this._types.length){A=true}else{for(x=0,y=B.length;x<y;x++){if(this._types.indexOf(B[x])<0){A=true;break}}}}if(A===true){if((this._types.indexOf(this._currentType)<0)||((window.ds&&window.ds.swymIM===true)&&(this._context.previousAttributes.path==="home")&&this._context.isCommunityContext())||(this._context.isDirectMessageContext()&&this._context.isPreviousContextACommunity())||(this._context.isCommunityContext()&&!this._context.isDirectMessageContext()&&this._context.isPreviousContextADM())){this.setContentTypeRequest({type:this._types[0],resetUserAction:true})}this.dispatchEvent("onContentTypesChange",{contentTypes:a.clone(this._types)},true);s.log("new _types",this._types)}},isContentCreationAllowed:function(w,v){var u=false;if(w){switch(w.toLowerCase()){case"comment":u=true;break;case"message":u=(!v||(v&&(v.canCreateMessages()===true)));break;case"post":u=(!v||(v&&(v.canCreatePosts()===true)));break;case"media":u=(!v||(v&&(v.canCreateMedia()===true)));break;case"question":case"iquestion":u=(!v||(v&&(v.canCreateQuestions()===true)));break;case"idea":case"ideation":u=(!v||(v&&(v.canCreateIdeas()===true)));break;case"survey":u=(!v||(v&&(v.canCreateSurveys()===true)));break;case"wiki":case"wikipage":u=(!v||(v&&(v.canCreateWikiPages()===true)));break}}return u},setContentTypeRequest:function(u){if(u.userAction||u.resetUserAction||!this.isCurrentTypeSelectedByUser()){if(u.userAction){this._setIsCurrentTypeSelectedByUser(u.userAction)}else{this._setIsCurrentTypeSelectedByUser(false)}this._programmaticallyChanged=Boolean(u.programmaticallyChanged);this._setCurrentContentType(u.type,(u.silent||false),u.updateIcon,u.forceFocus);this._setCurrentCommentSubjectContentType(u.commentSubjectContentType)}},wasProgrammaticallyChanged:function(){return this._programmaticallyChanged},destroy:function(){this._context.removeListener("onCommunityChange",this.onCommunityChangeBound);this._context.removeListener("onContextChange",this.onContextChangeBound);this._context.removeListener("onFeedModeChange",this._onFeedModeChange);this._parent.apply(this,arguments)}});t.POST=d;t.IDEA=l;t.QUESTION=f;t.MEDIA=q;t.SURVEY=r;t.MESSAGE=c;t.COMMENT=m;t.WIKI=i;t.ALL_TYPES=j;t.getInstance=function(){if(k===null){k=new h()}return k};return t});define("DS/SwymUIComponents/script/utils/content-upload-error",["DS/UWPClientControls/PlatformNotify","i18n!DS/SwymUIComponents/assets/nls/utils/content-upload-error"],function(a,c){var b={printErrorMessage:function(d,e){var f=c.anunexpectederroroccurred;switch(d&&d.errorcode){case"ERROR_MEDIA_TYPE_MISMATCH":case"ERROR_FILE_EXTENSION_MISMATCH":f=c.ERROR_FILE_EXTENSION_MISMATCH;break;case"ERROR_FILE_FORMAT_UNAUTHORIZED":f=c.ERROR_FILE_FORMAT_UNAUTHORIZED;break;case"ERROR_FILE_SIZE_EXCEEDED":f=c.ERROR_FILE_SIZE_EXCEEDED;break;case"ERROR_PICTURE_RESOLUTION_EXCEEDED":f=c.ERROR_PICTURE_RESOLUTION_EXCEEDED;break;case"ERROR_MEMBER_CSV_FORMAT_MISMATCH":f=c.ERROR_MEMBER_CSV_FORMAT_MISMATCH;break;case"ERROR_MEMBER_CSV_MAX_LINE_REACH":f=c.ERROR_MEMBER_CSV_MAX_LINE_REACH;break;default:switch(e){case"csv":f=c.anerroroccurredduringtheoperation;break;case"media":f=c.CertainmediacouldnotbeuploadedPleasetryagain;break;default:break}break}a.info(f)}};return b});define("DS/SwymUIComponents/script/feature/core/search/view/user-search-factory",["UWA/Core","UWA/Class","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/request/data","DS/UIKIT/Autocomplete","DS/UWPClientCode/I18n","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/user-search-view","DS/WebappsUtils/Console","UWA/Class/Promise"],function(f,a,e,m,c,g,l,i,k,d,b,h){var j="/api/user/search",n=a.extend({_defaultValue:null,_communityId:null,_mailAllowed:false,_multiSelect:false,_label:"",_events:{},_disabled:false,_pendingUsersAllowed:false,_loginsToExcludeFromSearch:[],_getConfiguration:function(){var o=this;return{filterEngine:function(r,q){var p=o;if(p._loginsToExcludeFromSearch.length>0){q=q.filter(function(s){return p._loginsToExcludeFromSearch.indexOf(s.login)===-1})}return q},templateEngine:function(q,u,p){var r=o,s=(r._mailAllowed===true&&r._isAMail(p.label))?p.label:p.login,t=c.constructUserPictureUrl(s,p.picture_update);q.addClassName("default-template people-search-template with-sub-label");q.setHTML('<img class="people-search-img" src="'+t+'"/> <div class="item-label">'+p.label+'</div> <div class="sub-label">'+(p.subLabel?p.subLabel:"")+"</div>")},remoteSearchEngine:function(r,w,v){var p,q,u,s,t=o,x;if(w.trim()!==""){p=g.getBaseUrl()+j;q={limit:5,start:0,locale:k.getCurrentLanguage()};q.query=w;if(t._communityId){q.community_id=t._communityId;q.restricttocommunity=t._restricted}x=new h(function(y){u=m.adaptService({url:p,data:q,onComplete:function(z){z=z.result;s={};s.dataset=r;s.matchingItems=z&&r.configuration.dataParser&&r.configuration.dataParser.call(this,r,z,w);y(s);if(v){v(s.matchingItems)}}.bind(this)});l.request(u)})}return x},dataParser:function(u,t,v){var p=[],r,s=o,w=f.is(s._communityId),q=s._loginsToDisableInSuggestions;t.forEach(function(x){r={label:x.nickname,nickname:x.nickname,value:x.nickname,hash_key:x.hash_key,login:x.login,ut_state:x.ut_state,subtitle:x.job_title,disabled:((q&&(q.indexOf(x.login)>=0))||Boolean(w&&!x.acc)),picture_update:x.picture_update};if((x.ut_state==="0")&&(x.nickname.trim()==="")){r.label=r.value=x.ut_invitation_email+" ("+d.Pending+")";r.disabled=!s._pendingUsersAllowed}if(x.user_tenant_status==="1"){r.label+=" ("+d.Contractor+")";r.value=r.label}p.push(r)});if(s._mailAllowed&&p.length===0){if(s._isAMail(v)){p.push({hash_key:v,label:v,value:v})}}return p}}},_isAMail:function(p){var o=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return o.test(p)},_setCommunityId:function(p,o){this._communityId=p;if(f.is(o)){this._restricted=o}},_setupConfig:function(o){var p=this;if(!o.parentSwymView&&o.mailAllowed===true){throw Error("Please provide a parentSWymView so the component can be refreshed. UIKIT controls cannot be refreshed")}if(o){if(f.is(o.community_id)){p._setCommunityId(o.community_id,o.restricted)}if(f.is(o.label)){p._label=o.label}if(f.is(o.pendingUsersAllowed)){p._pendingUsersAllowed=o.pendingUsersAllowed}if(f.is(o.parentSwymView)){p._parentSwymView=o.parentSwymView}if(f.is(o.mailAllowed)&&!p._alreadyRefreshed){p._mailAllowed=o.mailAllowed}if(f.is(o.loginsToExcludeFromSearch)){p._loginsToExcludeFromSearch=o.loginsToExcludeFromSearch}if(f.is(o.loginsToDisableInSuggestions)){p._loginsToDisableInSuggestions=o.loginsToDisableInSuggestions}if(f.is(o.defaultValue)){p._defaultValue=o.defaultValue}if(f.is(o.multiSelect)){p._multiSelect=o.multiSelect}if(f.is(o.events)){p._events=o.events}if(f.is(o.disabled)){p._disabled=o.disabled}}},_getEvents:function(){var q=this,o=q._events,s=o.onSelect,r=o.onUnselect,p=o.onInjected;o.onInjected=function(){if(q._defaultValue&&q.injected!==true){q.configuration.remoteSearchEngine(q,q._defaultValue,function(t){if(t&&t.hasOwnProperty(0)){this.onSelect(t[0])}else{this.dispatchEvent("onNoResults",q,q._defaultValue)}}.bind(this));q.injected=true}if(p){p.apply(this,arguments)}};o.onSelect=function(){this.onClickOutside();if(s){s.apply(this,arguments)}};o.onUnselect=function(){if(r){r.apply(this,arguments)}};return o},_getAutocompleteOptions:function(){this.configuration=this._getConfiguration();return{required:true,datasets:[{configuration:this.configuration}],disabled:this._disabled,typeDelayBeforeSearch:300,minLengthBeforeSearch:3,placeholder:this._mailAllowed?d.EnterAName:d.Users,label:this._label,multiSelect:this._multiSelect,events:this._getEvents()}}});return{Factory:n,getFormConfig:function(p){var q=this.Factory,o=new q();o._setupConfig(p);return f.extend({type:"autocomplete",name:"search-user-autocomplete"},o._getAutocompleteOptions())},createUserSearchControl:function(p){var q=this.Factory,o=new q();o._setupConfig(p);return new i(o._getAutocompleteOptions())}}});define("DS/SwymUIComponents/script/feature/core/user/view/interest/user-interest-edit-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/interest/model/interest-model","DS/UIKIT/Form","DS/WebappsUtils/Console"],function(e,d,f,b,a){var c=d.extend({_modelClass:f,name:"user-interest-edit-view",_createContent:function(){var g=this.model,h=this.addControl("form-aboutme",new b({fields:[{type:"text",value:g.get("title",{escapeHTML:false}),required:true,events:{onChange:function(){g.addChanges("title",this.getValue())}}}]}));return h}});return c});define("DS/SwymUIComponents/script/feature/core/tenant/view/tenant-media-max-size-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/tenant-media-max-size-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/media/model/media-file-extension-model","DS/UWPClientControls/PlatformNotify","DS/UIKIT/Form","DS/UIKIT/Spinner","DS/UIKIT/Mask"],function(h,d,f,i,k,g,a,b){var e=1024;var j=e*e;console.log("DS/SwymUIComponents/script/feature/core/tenant/view/tenant-media-max-size-view");var c=f.extend({name:"tenant-media-max-size",_mediaFileExtension:null,_platformMinSize:1*j,_platformMaxSize:null,_maxSizes:null,_form:null,_submitBtnEl:null,_submitSpinnerEl:null,_toggleSubmitSpinnerState:true,domEvents:{resize:"_onResize"},postModelSyncInit:function(){var l=this.model.get("media_upload_config");this._maxSizes=l.currentMaxUploadSize;this._renderCurrentValues();if(l.isMaxUploadSizeEditable==="1"){this._platformMaxSize=l.maxMaxUploadSize;this._form.enable()}b.unmask(this.container)},setup:function(){if(window.ds&&"3DD"!==window.ds.env){if(this.model.get("media_upload_config")){this.addEventOnce("onRender",this.postModelSyncInit.bind(this))}else{this.model.addEventOnce("onSync:read",this.postModelSyncInit.bind(this))}}this._mediaFileExtension=i.getInstance();this._submitSpinnerEl=new a({className:"small"}).show();return this._parent.apply(this,arguments)},_createContent:function(){var l="^[0-9]+$";var m=h.createElement("div",{"class":"form-group help",text:d.help});this._form=new g({className:"horizontal",grid:"2 10",fields:[{type:"text",name:"document",label:d.document,pattern:l},{type:"text",name:"video",label:d.video,pattern:l},{type:"text",name:"picture",label:d.picture,pattern:l},{type:"text",name:"sound",label:d.sound,pattern:l},{type:"text",name:"3d_model",label:d["3d_model"],pattern:l},{type:"text",name:"drawing",label:d.drawing,pattern:l}],buttons:[{type:"submit",value:d.save},{type:"reset",value:d.cancel}],events:{onValid:function(){this._validate(true)}.bind(this),onInvalid:function(){this._validate(false)}.bind(this),onReset:function(){this._form.unvalidate()}.bind(this)}});this._form.disable();return[m,this._form]},onRender:function(){b.mask(this.container);var q=this.getElement("form");var p=["doc-text","play","picture","note","database","picture"];var m=q.getElements(".form-group label");for(var o=-1,n=p.length;++o<n;){var l=h.createElement("span",{"class":"fonticon fonticon-"+p[o]});var r=h.createElement("span",{"class":"label-text",text:m[o].getText()});m[o].setContent(l);m[o].addContent(r)}this._submitBtnEl=this.getElement(".btn-primary");if(window.ds&&"3DD"===window.ds.env){this.postModelSyncInit.call(this)}},_onResize:function(){var q=this.getElement(".col-sm-offset-2");var l=q.getElement(".btn-default");var r=this.getElements(".form-group");var p=this.container.getDimensions().width-30;var o=this._submitBtnEl.getDimensions().width+l.getDimensions().width+5;if(210+1>p){for(var n=-1,m=r.length;++n<m;){if(m-2>n){r[n].setStyle("margin-bottom","5px")}}}else{for(var n=-1,m=r.length;++n<m;){if(m-2>n){r[n].setStyle("margin-bottom","15px")}}}if(p<o+1){this._submitBtnEl.setStyle("margin","5px 0 0 0");q.setStyle("padding-left","7px");this._submitBtnEl.inject(q)}else{this._submitBtnEl.setStyle("margin","0 5px 0 0");q.setStyle("padding-left",0);this._submitBtnEl.inject(q,"top")}},_convertInByte:function(l){return l*j},_convertInMByte:function(l){return l/j},_renderCurrentValues:function(){var n=this._form.getFields();for(var m=-1,l=n.length;++m<l;){if(this._maxSizes){n[m].setAttributes({placeholder:this._convertInMByte(parseInt(this._maxSizes[n[m].name],10))})}}},_validate:function(p){this._form.disable();var m=false;var o=false;var n="";var l=this._form.getFields();l.forEach(function(s){var q=s.getParent(".form-group");if(!q.hasClassName("has-error")){if(""!==s.value){var r=this._convertInByte(parseInt(s.value,10));if(this._platformMinSize>r){m=true;q.addClassName("has-error")}else{if(this._platformMaxSize[s.name]<r){o=true;q.addClassName("has-error");n+='<span class="'+this.name+'-container errMaxMediaMsg">';n+=d[s.name]+" : "+Math.floor(this._platformMaxSize[s.name]/j);n+="</span>"}}}}},this);if(m){k.error(d.errorMin+Math.floor(this._convertInMByte(this._platformMinSize)))}if(o){k.error('<span class="'+this.name+'-container errMaxMsg">'+d.errorMax+"</span>"+n)}if(p&&!m&&!o){this._submit()}else{this._form.enable()}},_submit:function(){this._toggleSubmitSpinner();var p=this._form.getValues();var q=0;var m=0;var l={};for(var o in p){if(p.hasOwnProperty(o)){if(""===p[o]){++q}else{var n=this._convertInByte(parseInt(p[o],10));if(this._maxSizes[o]===n){++q}else{l[o+"_maxsize"]=n}}++m}}if(m>q){this.model.save(l,{wait:true,onComplete:function(){for(var r in l){if(l.hasOwnProperty(r)){if("update"!==r){this._maxSizes[r.slice(0,-8)]=parseInt(l[r],10)}}}this._mediaFileExtension.set("maxSizes",this._maxSizes);this._renderCurrentValues();this._form.reset();this._toggleSubmitSpinner();this._form.enable();k.success(d.submitComplete)}.bind(this),onFailure:function(){k.error(d.submitFailure);this._form.reset();this._toggleSubmitSpinner();this._form.enable()}.bind(this)})}else{this._form.reset();this._toggleSubmitSpinner();this._form.enable()}},_toggleSubmitSpinner:function(){if(this._toggleSubmitSpinnerState){this._submitBtnEl.setContent(this._submitSpinnerEl)}else{this._submitBtnEl.setText(d.save)}this._toggleSubmitSpinnerState=!this._toggleSubmitSpinnerState},setPlatformMinSize:function(l){this._platformMinSize=l*j}});return c});define("DS/SwymUIComponents/script/feature/core/user/view/user-3dpassport-buttons-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/user-3dpassport-buttons-view","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Input/Button","DS/WebappsUtils/Console","DS/UIKIT/Input/Toggle"],function(g,e,c,h,d,j,f,a,i){var b=e.extend({_modelClass:c,name:"user-3dpassport-buttons-view",setup:function(k){k=k||{};return this._parent.apply(this,arguments)},_createContent:function(){var m=this,n=j.getApplicationConfiguration("app.urls.passport"),k=this.model,l=(h.isCloud()&&(typeof k.marketing_consent!=="undefined"))||k.passwordEditUrl||k.twoFAURL||k.adminURL||k.emailValidationURL;return l?g.createElement("div",{html:[{tag:"h4","class":"titleProfile",html:d.threeDPassport},{"class":"margin-top-20px",html:[k.passwordEditUrl?new f({value:d.resetpassword,events:{onClick:function(){window.open(n+k.passwordEditUrl)}.bind(this)}}):"",k.twoFAURL?new f({value:d.twoFAauth,events:{onClick:function(){window.open(n+k.twoFAURL)}.bind(this)}}):"",k.adminURL?new f({value:d.AdminTools,events:{onClick:function(){window.open(n+k.adminURL)}.bind(this)}}):"",k.emailValidationURL?new f({value:d.SendEmailValidation,events:{onClick:function(){window.open(n+k.emailValidationURL)}.bind(this)}}):""]},h.isCloud()&&(typeof k.marketing_consent!=="undefined")?new i({type:"checkbox",className:"primary margin-top-20px",label:d.AcceptNewsletters,checked:(k.marketing_consent==="true"||k.marketing_consent===true),events:{onClick:function(){var o=this.isChecked();k.updatePassportFields({data:{marketing_consent:o},onComplete:function(){m.alert("success",d.settingChanged)}})}}}):""]}):""}});return b});define("DS/SwymUIComponents/script/feature/community/media/edit/upload/copy-paste-upload-view",["UWA/Core","UWA/Data","DS/SwymUICore/script/lib/view/generic/swym-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/library/media-library-view","DS/Logger/Logger"],function(f,d,c,e,b){var a=c.extend({name:"copy-paste-upload",_createContent:function(){return{}},_dataURLtoFile:function(i){var g=i.split(","),k=g[0].match(/:(.*?);/)[1],h=atob(g[1]),l=h.length,j=new Uint8Array(l);while(l--){j[l]=h.charCodeAt(l)}return new Blob([j],{type:k})},_dispatchEvents:function(i,j,h){var g=this;if((i.length+j.length)===h.length){if(i.length===h.length){g.dispatchEvent("onFilesSelected",[i])}else{g.alert("warn",e.MediaProxyError);g.dispatchEvent("onFilesSelected",[i]);g.dispatchEvent("onUploadFailed",[j])}}},getAndTransformMediaPasted:function(q){var r,g,o,j,p=this,h=[],s=[];if(q.length>0&&q[0] instanceof File){this.dispatchEvent("onFilesSelected",[q])}else{for(var n=0,m=q.length;n<m;n++){o=q[n];g=o.src;r=o.mediaPastedId,j={src:g,mediaPastedId:r};if(g.startsWith("data:image")){var k=p._dataURLtoFile(g);k.lastModifiedDate=new Date();k.info=j;k.name=j.mediaPastedId+"-title.png";h.push(k);p._dispatchEvents(h,s,q)}else{this.dispatchEvent("onMediaUploadsStart");d.request(g,{type:"blob",onComplete:function(t,i){var l=new Blob([i]);l.info=t;l.lastModifiedDate=new Date();if(i.type&&i.type.split("/").length>0){l.name=t.mediaPastedId+"-title."+i.type.split("/")[i.type.split("/").length-1]}else{l.name=t.mediaPastedId+"-title.jpg"}h.push(l);p._dispatchEvents(h,s,q)}.bind(this,j),onFailure:function(t,i,l){s.push(t);if((h.length+s.length)===q.length){if(h.length===q.length){p.dispatchEvent("onFilesSelected",[h])}else{if(!t.src.startsWith("data:image")){p.alert("warn",e.MediaProxyError)}p.dispatchEvent("onFilesSelected",[h]);p.dispatchEvent("onProxyFailed",[s])}}this.dispatchEvent("onMediaUploadsFailure")}.bind(this,j)})}}}}});return a});define("DS/SwymUIComponents/script/feature/community/survey/view/answer-editor-view",["UWA/Core","UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/answer-editor-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Text"],function(f,c,d,e,b){var a=e.extend({_modelEvents:{onChange:"contentChanged",onVirtualChange:"contentChanged"},domEvents:{"change .answer-description-editor-input":"onDescriptionChange","click .answer-delete-button":"onDeleteAnswerClick"},contentChanged:function(){this.model.collection.dispatchEvent("onChange")},_createContent:function(){var h=this.model;if(h){if(h.get("is_open")!==1){var g=h.get("is_open")=="1";viewEl=f.createElement("div",{"class":"answer-wrapper",html:[this.addControl("answer-description-editor-input",new b({className:"answer-description-editor-input",placeholder:d.Answer,disabled:g,value:c.unescapeHTML(h.getChanges("description")||h.get("description")||""),events:{onChange:this.validate.bind(this)}})),!g?{"class":"answer-delete-button fonticon fonticon-trash",tag:"span",styles:{display:(this._parentView.collection.length===2?"none":"block")}}:""]});return viewEl}}},onDescriptionChange:function(g){this.model.addChanges("description",c.escapeHTML(g.target.value))},onDeleteAnswerClick:function(){if(this._parentView.collection.length>2){this._parentView.collection.remove(this.model);if(this._parentView.collection.length===2){this._parentView.getElements(".answer-delete-button").forEach(function(g){g.hide()})}else{this._parentView.getElements(".answer-delete-button").forEach(function(g){g.show()})}}},validate:function(){var g=this.getControl("answer-description-editor-input");if(g.getValue().trim()===""){g.getContent().addClassName("field-error")}else{g.getContent().removeClassName("field-error")}}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/edit-file-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/edit-file-view","UWA/Element","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/media/model/media-file-extension-model","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/error/error"],function(f,c,a,i,e,h,g,d){var b=e.extend({name:"edit-file-view",className:"container-fluid editor-border",baseUrl:null,_fileName:"",domEvents:{"click .editFile-cancel-button":"onCancel","change #form-file-file":"_filesSelected"},_modelEvents:{"onVirtualChange:userFile":"refresh"},_mediaFileExtension:null,_createContent:function(){var j=this.model;if(j){return[{tag:"span","class":"replace-file",html:[c.changeFile,{tag:"span","class":"replace-file-filename",html:this._fileName}]},{tag:"div",html:[{tag:"div","class":"btn btn-default",html:[c.browse,{tag:"input",id:"form-file-file","class":"media-uploader-file-input",type:"file",name:"media-path"}],styles:{position:"relative"}},{tag:"button",type:"button","class":"btn btn-default editFile-cancel-button",html:c.cancel}]}]}},setup:function(){this._parent.apply(this,arguments);this.baseUrl=g.getBaseUrl();this._mediaFileExtension=h.getInstance()},onCancel:function(j){if(j&&(typeof j.stopPropagation==="function")){j.stopPropagation()}if(j&&(typeof j.preventDefault==="function")){j.preventDefault()}this.model.removeChanges("userFile");this._fileName="";this.refresh()},_filesSelected:function(j){this._handleFile(j.target.files[0])},_handleFile:function(k){if(undefined===k.fileName){k.fileName=k.name}if(this._isExtensionAllowed(k)){this.file=k;this._fileName=k.fileName;this.model.addChanges("userFile",k)}else{var l=this.model.get("orig_name"),j=l.substr(l.lastIndexOf(".")+1);this.alert("error",c.fileTypeError+c.fileExtensionMustBe+j)}},_isExtensionAllowed:function(l){var n=this.model.get("orig_name"),m=l.fileName,p=this._getType(n),o=this._getType(m),j=n.substr(n.lastIndexOf(".")+1),k=m.substr(m.lastIndexOf(".")+1);if(p==="image"&&o==="image"){return true}else{return(j.toLowerCase()===k.toLowerCase())}},_getType:function(n){var r=this._mediaFileExtension.get("authorizedFormats"),q=n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase(),j=r.image,k=r.video,s=r.audio,l=r.document,o=r["3dmodel"];for(var p=-1,m=j.length;++p<m;){if(j[p]===q){return"image"}}for(var p=-1,m=k.length;++p<m;){if(k[p]===q){return"video"}}for(var p=-1,m=l.length;++p<m;){if(l[p]===q){return"document"}}for(var p=-1,m=s.length;++p<m;){if(s[p]===q){return"audio"}}for(var p=-1,m=o.length;++p<m;){if(o[p]===q){return"3dmodel"}}},onSetModel:function(k,l,j){this.reactTo(j,"onSync:update",this.onCancel)}});return b});define("DS/SwymUIComponents/script/feature/core/user/view/macro/user-aboutme-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/macro/user-aboutme-view","DS/UWPClientCode/I18n"],function(e,a,d,b){var c=a.extend({name:"useraboutme-view",_createContent:function(){var i=this.model,j=this.widget;if(i){var h=this.model.getAssociated("interests"),x=this.model.getAssociated("skills"),r=this.model.getAssociated("languages"),p=this.addChildView("languages",{_title:d.Languages,className:"languages-container",Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_mainView:"DS/SwymUIComponents/script/feature/core/user/view/language/user-language-view",_hasPlusIcon:true,_model:this.model,_userModel:this.model,_collection:r,_iconSection:"language",_defaultMessage:d.Addlanguage,_engagingUX:true,_engagingText:d.EngagingLanguage,_modelColor:"#005686"}),y=this.addChildView("skills",{_title:d.Skills,className:"skills-container",Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_mainView:"DS/SwymUIComponents/script/feature/core/user/view/skill/user-skill-view",_hasPlusIcon:true,_model:this.model,_userModel:this.model,_collection:x,_iconSection:"tools",_defaultMessage:d.Addskill,_engagingUX:true,_engagingText:d.EngagingSkill,_modelColor:"#368ec4"}),l=this.addChildView("experiences",{_title:d.professionalXP,className:"experiences-container",Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_mainView:"DS/SwymUIComponents/script/feature/core/experience/view/experience-view",_hasPlusIcon:true,_model:this.model,_userModel:this.model,_collection:this.model.getAssociated("works"),_iconSection:"briefcase",_defaultMessage:d.Addexperience,_engagingUX:true,_engagingText:d.EngagingExperience,_modelColor:"#42a2da"}),o=this.addChildView("educations",{className:"educations-container",_title:d.educationXP,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_mainView:"DS/SwymUIComponents/script/feature/core/education/view/education-view",_hasPlusIcon:true,_model:this.model,_userModel:this.model,_collection:this.model.getAssociated("schools"),_iconSection:"graduation-cap",_defaultMessage:d.Addeducation,_engagingUX:true,_engagingText:d.EngagingEducation,_modelColor:"#003c5a"}),z="DS/SwymUIComponents/script/feature/core/user/view/interest/user-interest-view",s=a.extend({_createContent:function(){var E=this.collection.length,C="";if(E>0){for(var D=0;D<E;D++){var B=this.collection.at(D),C=C+B.get("title");if(D<E-1){C=C+", "}}}return C}}),m=this.addChildView("interests",{className:"interests-container",_title:d.Interests,Class:"DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",_mainView:this.model.isCurrentUser()?z:s,_hasPlusIcon:true,_model:this.model,_userModel:this.model,_collection:h,_iconSection:"heart",_defaultMessage:d.Addinterest,_engagingUX:true,_engagingText:d.EngagingInterest,_modelColor:"#78befa"}),v=(h.length+x.length+this.model.getAssociated("schools").length+r.length+this.model.getAssociated("works").length)===0,k=x.length,n=h.length,q=r.length,u=[],w=[],A,g;if(k===0){u.push(y)}else{w.push(y)}if(q===0){u.push(p)}else{w.push(p)}if(n===0){u.push(m)}else{w.push(m)}A=[{"class":"col-md-6 col-lg-4",html:y},{"class":"col-md-6 col-lg-4",html:p},{"class":"col-xs-12 col-lg-4",html:m}];g=[{"class":"col-xs-12",html:[{"class":"col-md-6",html:l},{"class":"col-md-6",html:o}]}];if(this.model.getAssociated("works").length===0){g=[{"class":"col-xs-12",html:[{"class":"col-md-6",html:o},{"class":"col-md-6",html:l}]}]}if(u.length===1){if(this.model.isCurrentUser()===true){A=[{"class":"col-md-6 col-lg-4",html:w[0]},{"class":"col-md-6 col-lg-4",html:w[1]},{"class":"col-lg-4",html:u[0]}]}else{A=[{"class":"col-md-6",html:w[0]},{"class":"col-md-6",html:w[1]}]}}else{if(u.length===2){if(this.model.isCurrentUser()===true){A=[{"class":"col-md-6 col-lg-4",html:w[0]},{"class":"col-md-6 col-lg-4",html:u[0]},{"class":"col-md-6 col-lg-4",html:u[1]}]}else{A=[{"class":"col-xs-12 col-lg-6",html:w[0]}]}}}if(this.model.isCurrentUser()===false&&w.length===1&&(this.model.getAssociated("works").length===0||this.model.getAssociated("schools").length===0)){A=[{"class":"col-xs-12",html:[{"class":"col-md-6",html:w[0]},{"class":"col-md-6",html:(this.model.getAssociated("works").length===0)?o:l}]}];g=[]}var f=e.createElement("div",{styles:{"text-align":"center"},html:[{"class":"network-default-message",html:b.replace(d.hasnotfilledprofileyet,{firstName:this.model.get("first_name")})},{html:'<span class="fonticon fonticon-vcard fonticon-nocontent"></span>'}]}),t=[A,g];if(v===true&&this.model.isCurrentUser()===false){t=f}return t}},init:function(g){try{var f=this._parent.apply(this,arguments);this.widget=g.widget;return f}catch(h){Logger.error("Error initializing rich user view:"+h.message);return false}}});return c});define("DS/SwymUIComponents/script/feature/core/tenant/view/users-management-process-detail-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/users-management-process-detail-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/users-management-processes-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Button","DS/SwymUICore/script/utils/utils","DS/UWPClientCode/I18n"],function(h,f,c,g,a,e,d){var b=g.extend({_modelEventsForAutoRefresh:["onChange"],_asAdmin:false,_createContent:function(){var n=this,j=n.model;if(j&&j.processResults){var i='<table class="table table-hover"><tr><th>'+f.login+"</th><th>"+f.email+"</th><th>"+f.firstname+"</th><th>"+f.lastname+"</th><th>"+f.community+"</th><th>"+f.status+"</th><th>"+f.details+"</th></tr>";j.processResults.forEach(function(o){var p="";var q=[{id:0,text:f.success},{id:1,text:f.nonexistingusers},{id:2,text:f.alreadyexistingmembers},{id:3,text:f.incorrectinformationprovided},{id:4,text:f.additionofexternalmembers},{id:5,text:f.errorswhileprocessing},{id:6,text:f.usercannotberemoved},{id:7,text:f.accountcreationfailed},{id:8,text:f.additionofusertotenantfailed},{id:9,text:f.additionofuserastenantadministratorfailed},{id:10,text:f.useralreadypresentontenant},{id:11,text:f.userstatuschangefailed},{id:12,text:f.usernotfoundintenant},{id:13,text:f.userstatusisalreadychanged}];q.forEach(function(r){if(parseInt(o.details,10)==r.id){p=r.text}});i+="<tr><td>"+o.user_login+"</td><td>"+o.user_email+"</td><td>"+o.user_first_name+"</td><td>"+o.user_last_name+"</td><td>"+o.communityName+"</td><td>"+(o.result=="1"?f.success:f.failure)+"</td><td>"+p+"</td></tr>"});i+="</table>";var l;switch(Number(j.get("process"))){case 11:l=c.adduserstocommunity;break;case 14:l=c.importnewusers;break;case 13:l=c.removeusersfromcommunity;break;case 15:l=c.changeuserstatus;break;default:l="";break}var k="";if(Number(j.get("type"))==3){if(j.get("details")){k=d.replace(c.nofnsuccessful,{num1:j.get("details")[0],num2:j.get("details")[1]})}}else{if(Number(j.get("type"))==1){if(j.get("rank")){k=d.replace(c.positioninqueue,{num:j.get("rank")})}}}var m=[{styles:{border:"1px solid #d8d8d8","border-radius":"10px","margin-bottom":"10px",padding:"10px"},html:[{styles:{"margin-bottom":"20px"},html:"<b>"+j.get("processName")+"'s details:</b> ("+l+" - "+k+")"},{styles:{padding:"10px"},html:i},{html:new a({value:f.Export,events:{onClick:function(){window.open(e.getBaseUrl()+"/api/member/exportusers/id/"+this.get("real_id")+(n._asAdmin?"/as_admin/"+n._asAdmin:""))}.bind(j)}})}]}];return m}},setup:function(i){var j=this;j._parent.apply(j,arguments);if(i&&i.asAdmin){j._asAdmin=i.asAdmin}}});return b});define("DS/SwymUIComponents/script/feature/community/media/view/interactive-action-menu-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/lib/model/generic/community-content","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/interactive-media-thumbnail-view"],function(h,g,c,e,b,d,f){var a=g.extend({name:"action-menu-view",_modelClass:e,_actionMenu:null,_isModelFetched:false,setup:function(i){this._parent.call(this,i)},_createContent:function(){var k=h.createElement("span",{"class":"fonticon fonticon-1-5x fonticon-open-down"}),j=k.getElement(".fonticon-open-down"),i=[];if(j){this.addControl("MenuTooltip",new d({target:j,body:f.Menu}))}i.push({name:"goto",fonticon:"level-down",text:f.goToThisMedia,handler:function(){this._onGoToThisItem()}.bind(this)});this._actionMenu=this.addControl("dropdownMenu",new b({target:k,position:"bottom left",items:i,className:"contextual-actions",events:{onShow:this._onActionsMenuShow.bind(this)}}));return k},_onActionsMenuShow:function(){var k=this._isModelFetched,i=this.model,j=false;if(!k){var l=this._actionMenu;if(i.hasBeenFetched()){j=true}i.fetch({fromCache:j,onComplete:function(){this._buildActionsMenu();this._isModelFetched=true}.bind(this)})}else{this._buildActionsMenu()}},_buildActionsMenu:function(){var i=this.model,j=this._actionMenu,k=i.isConsideredAsA360MediaModel()===true;while(j.items.length>0){j.removeItem(0)}if(k){j.addItem({name:"play360",fonticon:"media-360",text:f.Play,handler:function(l){this.dispatchEvent("onPlay",[l])}.bind(this)})}j.addItem({name:"goto",fonticon:"level-down",text:f.goToThisMedia,handler:function(){this._onGoToThisItem()}.bind(this)});if(i.get("download_original_file")=="1"||i.get("media_type")==="document"){j.addItem({name:"download",fonticon:"download",text:f.Download,handler:function(){this._parentView.download()}.bind(this)})}},_onGoToThisItem:function(){var i=this.model,l=i.getCommunity(),o=i.get("mid"),k=i.get("title"),n=i.getModelName(),m=l.get("mid"),j=c.getInstance();j.reset({contentId:o,contentType:n,communityId:m})}});return a});define("DS/SwymUIComponents/script/feature/core/link/view/link-read-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-read-view","DS/SwymUICore/script/feature/core/link/model/link-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu"],function(g,e,b,f,c,a){var d=f.extend({_modelEventsForAutoRefresh:["onChange:url","onChange:description","onChange:title","onChange:type"],_modelClass:b,domEvents:{"click .font-social":"_onLinkClicked"},_onLinkClicked:function(){window.open(this.model.get("url",{escapeHTML:false}))},name:"link-read-view",_createContent:function(){var h=this.model.collection.getAssociated("user").isCurrentUser(),k=h?'<span class="fonticon fonticon-2x cursor-pointer fonticon-down-open"></span>':'<div style="margin-bottom: 10px;"></div>',l=this.getWebsite(this.model.get("type")),j=l.icon?l.icon:"fonticon-monitor",i="";if(this.model.isSocialLink()===true){i=g.createElement("div",{"class":"social-link",html:'<span class="fonticon cursor-pointer font-social fonticon-2x fonticon-'+this.model.getIconName()+'"></span>'+k})}else{i=g.createElement("div",{styles:{"margin-top":"20px"},html:[{html:'<span class="fonticon fonticon-link"></span><a class="user-link" href="'+this.model.get("url",{escapeHTML:true})+'">'+this.model.get("title")+"</a>"+k},{"class":"user-link-description",html:this.model.get("description",{breakline:true})||""}]})}this.addControl("dropdown",new a({target:i.getElement(".fonticon-down-open"),items:[{text:e.Edit,fonticon:"pencil"},{text:e.Delete,fonticon:"trash"}],events:{onClick:function(n,m){if(m.fonticon==="pencil"){this.model.dispatchEvent("onPencilIconClicked")}else{if(m.fonticon==="trash"){this.model.dispatchEvent("onTrashIconClicked")}}}.bind(this)}}));return i},getWebsite:function(h){var i={};switch(h){case"0":i.name=this.model.get("title");break;case"1":i.name="Facebook";i.icon="fonticon-facebook";break;case"2":i.name="Linkedin";i.icon="fonticon-linkedin";break;case"3":i.name="Viadeo";break;case"4":i.name="Youtube";break;case"5":i.name="Certification";break;case"6":i.name="Flickr";break;case"7":i.name="Google";i.icon="fonticon-gplus";break;case"8":i.name="Twitter";i.icon="fonticon-twitter";break}return i}});return d});define("DS/SwymUIComponents/script/feature/core/network/view/invitation-layer-form-view",["i18n!DS/SwymUIComponents/assets/nls/feature/core/network/view/invitation-layer-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UIKIT/Input/Text"],function(c,e,a,d,b){var f=e.extend({_modelClass:a,name:"invitation-layer-form-view",_createContent:function(){var g=d.getInstance().get("user");return[{tag:"label","for":"invitationSent",html:c.descriptionField},{html:this.addControl("inputMessage",new b({multiline:true,id:"invitationSent",rows:5,value:g.first_name+" "+g.last_name+" "+c.textByDefaultInvitation}))}]}});return f});define("DS/SwymUIComponents/script/feature/community/content/view/properties-editor-view",["UWA/Core","UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/properties-editor-view","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/context/context-model","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip"],function(g,a,b,f,c,j,d,e,i,h){var k=c.extend({name:"properties-editor-view",_withoutCategory:false,_videoThumbnailEditorIsIntanciated:false,domEvents:{"click .capture-thumbnail-button":"_onCaptureThumbnailButtonClicked","click .cancel-thumbnail-edition":"_onCancelForThumbnailEdition"},_onCancelForThumbnailEdition:function(){this.model.removeChanges("thumbnail_time_ms");this.getElement(".cancel-thumbnail-edition").hide()},_onCaptureThumbnailButtonClicked:function(){if(!this.model.hasVirtuallyChanged("userFile")){this.dispatchEvent("getPlayerStateRequest")}else{this.alert("info",b.PleaseWaitForTheNewVideoToBeProcessed)}},instantiateVideoThumbnailEditor:function(){var m=this.getElement(".thumbnail-image-editor");var l=this.addChildView("thumbnailVideoEdit",{model:this.model,autoplay:false,controls:false,Class:"DS/SwymUIComponents/script/feature/community/media/view/video-thumbnail-editor-view"});m.setContent([l.render(),{"class":"cancel-thumbnail-edition",html:b.Cancel}]);this._videoThumbnailEditorIsIntanciated=true},manageThumbnailEdition:function(m){if(m){switch(m.state){case"readyForThumbnail":var l=m.offset*1000;l=Math.round(l);this.model.addChanges("thumbnail_time_ms",l);if(!this._videoThumbnailEditorIsIntanciated){this.instantiateVideoThumbnailEditor()}this.getElement(".cancel-thumbnail-edition").show();break;default:this.alert("info",b.PauseThePlayerBeforeChoosingANewThumbnail)}}},setup:function(l){if(l.withoutCategory){this._withoutCategory=true}this.addEvent("playerStatusInfo",this.manageThumbnailEdition.bind(this));return this._parent.apply(this,arguments)},_createContent:function(){var m=this.model,o=[],l=null,n=(f.isFeatureActivated("activateSimplifiedMediaCreation")===true);if(n){l=g.createElement("span",{styles:{"margin-left":"10px"},"class":"fonticon fonticon-help-circled"});this.addControl("helpIconTooltip",new h({target:l,body:a.format(b.get("IfSelectedTheMediaWillBeDisplayedOnTheWhatsNew"),"<b>","</b>")}))}this.addControl("displayonwhatsnewCheckbox",new i({type:"checkbox",name:"displayonwhatsnew",className:"primary",label:(n?b.get("DisplayOnWhatsNew"):b.Illustration),checked:(m.get("is_illustration")===true||m.get("is_illustration")==="1")?!n:n,disabled:(this.model.get("community")["this->getCurrentUserRights"]==="1")?true:false,events:{onChange:function(){m.addChanges("is_illustration",this.isChecked()===!n)}}})).getContent().setStyle("display","inline-block");if(!this._withoutCategory){}if(!j.getInstance().isDirectMessageContext()){o.push({html:[this.getControl("displayonwhatsnewCheckbox"),l]})}if(m.get("media_type")!=="document"){o.push(this.addControl("downloadCheckbox",new i({type:"checkbox",name:"download",className:"primary",label:b.Authorizedownloadoforiginalfile,checked:(m.get("download_original_file")==="1")?true:false,events:{onChange:function(){m.addChanges("download_original_file",(this.isChecked()===true)?"1":"0")}}})))}return[(m.getModelName()==="media")?o.concat([(m.get("media_type")==="video")?{"class":"video-thumb",html:[this.addControl("captureThumbnailButton",new e({value:b.CaptureTheThumbnailFromThePlayer,disabled:false,className:"default capture-thumbnail-button"})),{"class":"thumbnail-image-editor",html:g.createElement("img",{src:this.model.get("preview").thumbnails[2].transient_url})}]}:""]):""]},resetPropertiesView:function(){this._videoThumbnailEditorIsIntanciated=false;this.refresh()},onModeChange:function(m){for(var l in this._childViews){if(this._childViews.hasOwnProperty(l)){this._childViews[l].dispatchEvent("onModeChange",[m])}}}});return k});define("DS/SwymUIComponents/script/feature/core/stats/view/daterange-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/stats/view/daterange-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/request/data","DS/UIKIT/Input/Date","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/feature/core/tenant/model/tenant-model","DS/SwymUICore/script/utils/date","DS/WebappsUtils/Console"],function(i,d,f,o,m,n,g,k,h,l,j,b,e,a){var c=f.extend({_community:null,_tenant:null,className:"daterange-view",_createContent:function(){var p=new Date(),t,r=this,s=new Date("2008","0","01");if(this._community){t=this._community.get("crdate");if(t){t=t.split(" ")[0]}}this.addControl("allButton",new g({value:d.All,events:{onClick:function(){this.getControl("startDatePicker").setDate((this._community&&t)?new Date(t.split("-")[0],t.split("-")[1]-1,t.split("-")[2]):(r._tenantModel?e.convertDate(r._tenantModel.get("crdate")):s));this.getControl("endDatePicker").setDate(p);this.dispatchEvent("bothDateChanged",[this.getControl("startDatePicker").getDate(),this.getControl("endDatePicker").getDate()])}.bind(this)}}));if(l.getInstance().isFeatureActivated("activate_export_stats")){this.addControl("exportButton",new g({className:"primary exportButton",icon:"fonticon-1-5x fonticon-export",attributes:{title:this._community?d.ExportAllTheStatisticsOfTheCommunityAvailableFromTheDateOfItsCreation:d.ExportAllTheStatisticsOfTheTenantAvailableFromTheDateOfItsCreation},events:{onClick:function(){require(["DS/SwymUICore/script/feature/core/user/model/currentuser-model"],function(u){u.getInstanceFetched(function(w){var v=o.adaptService({url:h.getBaseUrl()+"/api/analytics/addexportbatch",data:{tenant_id:this._tenant?this._tenant.id:null,community_id:this._community?this._community.get("mid"):null,as_admin:w.get("tenant_admin")==="1"},onComplete:function(){this.alert("info",d.AnEmailWillBeSentWhenAllStatisticsWillBeReadyToBeDownloaded)}.bind(this),onFailure:function(){this.alert("warning",d.AnEmailWillBeSentWhenAllStatisticsWillBeReadyToBeDownloaded)}.bind(this)});m.request(v)}.bind(this))}.bind(this))}.bind(this)}}));new k({trigger:"hover",target:this.getControl("exportButton").getContent(),position:"left"})}this.addControl("startDatePicker",new n({placeholder:d.SelectAStartDate,events:{onChange:this._onStartDateChange.bind(this)},min:(this._community&&t)?new Date(t.split("-")[0],t.split("-")[1]-1,t.split("-")[2]):(r._tenantModel?e.convertDate(r._tenantModel.get("crdate")):s),max:p})).setDate(new Date(p.getFullYear(),p.getMonth()-1,p.getDate()));this.addControl("endDatePicker",new n({placeholder:d.SelectAnEndDate,events:{onChange:this._onEndDateChange.bind(this)},min:this.getControl("startDatePicker").getDate(),max:p})).setDate(new Date(p.getFullYear(),p.getMonth(),p.getDate()));var q=[{tag:"div",styles:{display:"inline-block"},html:[{tag:"span",html:d.From},this.getControl("startDatePicker")]},{tag:"div",styles:{display:"inline-block"},html:[{tag:"span",html:d.To},this.getControl("endDatePicker")]},this.getControl("allButton"),(this.getControl("exportButton")?{"class":"export-stats-button-wrapper",html:this.getControl("exportButton")}:"")];return q},setup:function(p){var q=this;if(p){if(p.hasOwnProperty("tenant")){this._tenant=p.tenant}if(p.hasOwnProperty("community")&&p.community){this._community=p.community}else{j.getInstanceFetched(function(r){q._tenantModel=new b({id:r.get("tenant_uuid")});q._tenantModel.fetch({onComplete:function(s){var t=q.getControl("startDatePicker");if(t){t.setMinDate(e.convertDate(s.get("crdate")))}}})})}}return this._parent.apply(this,arguments)},_onStartDateChange:function(){this.dispatchEvent("startDateChanged",this.getControl("startDatePicker").getDate());if(this.getControl("endDatePicker")){this.getControl("endDatePicker").setMinDate(this.getControl("startDatePicker").getDate())}},_onEndDateChange:function(){this.dispatchEvent("endDateChanged",this.getControl("endDatePicker").getDate());if(this.getControl("startDatePicker")){this.getControl("startDatePicker").setMaxDate(this.getControl("endDatePicker").getDate())}}});return c});define("DS/SwymUIComponents/script/feature/community/community/view/community-request-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/date","DS/WebappsUtils/Console","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-request-view"],function(f,e,c,b,d){var a=e.extend({domEvents:{"click td":"_onCommunityRequestClicked"},_createContent:function(){var g=this.model,h=this._parentView.name;if(g){if(h==="community-request-collection-view"){return[{tag:"td",html:g.get("user_creator_request").nickname},{tag:"td",html:g.get("title")},{tag:"td",html:c.simpleDate(g.get("update"))}]}else{if(h==="community-history-request-collection-view"){return[{tag:"td",html:g.get("title"),"class":((g.get("status")==="0")?"":(g.get("status")==="1")?"":(g.get("status")==="2")?"":"bg-request-pending")},{tag:"td",html:c.simpleDate(g.get("update")),"class":((g.get("status")==="0")?"":(g.get("status")==="1")?"":(g.get("status")==="2")?"":"bg-request-pending")},{tag:"td",html:(g.get("status")==="0")?d.Declined:(g.get("status")==="1")?d.Created:(g.get("status")==="2")?d.UnderReview:d.NewUpdates,"class":((g.get("status")==="0")?"":(g.get("status")==="1")?"":(g.get("status")==="2")?"":"bg-request-pending")}]}}}},_onCommunityRequestClicked:function(){this.dispatchEvent("onCommunityRequestClicked",[this.model,this])}});return a});define("DS/SwymUIComponents/script/feature/community/survey/view/scale-answer-view",["DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Toggle"],function(b,c){var a=b.extend({_modelEventsForAutoRefresh:["onChange"],domEvents:{"change .scale-answer-radio":"onRadioChange","click .radio-label":"onRadioLabelClick"},_createContent:function(){var j=[],e=this.getOption("questionModel")?this.getOption("questionModel"):null,d=(e?e.get("index_min"):this.getOption("indexMin")),k=(e?e.get("index_max"):this.getOption("indexMax")),f=(e?e.get("label_min"):this.getOption("minLabel").escapeHTML()),h=(e?e.get("label_max"):this.getOption("maxLabel").escapeHTML());for(var g=d;g<k+1;g++){j.push({"class":"radio-wrapper",html:[{"class":"radio-label",html:(g+"")},this.addControl("answerToggle_"+g,new c({name:(e?e.get("mid")+"_radio":null),disabled:!e,value:g,className:"scale-answer-radio primary",label:"",checked:(e?parseInt(e.getChanges("selected_index"),10)===g:false)}))]})}return{"class":"toggles-wrapper",html:(f||h?[{"class":"min-max-label",html:""+f||""},j,{"class":"min-max-label",html:""+h||""}]:j)}},onRadioChange:function(d){this.getOption("questionModel").addChanges("selected_index",d.target.value)},onRadioLabelClick:function(d){this.getOption("questionModel").addChanges("selected_index",d.target.innerText);this.getControl("answerToggle_"+d.target.innerText).check()}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/location/user-location-edit-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UIKIT/Input/Text","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/location/user-location-edit-view","DS/UIKIT/Form","DS/UIKIT/Spinner","DS/WebappsUtils/Console"],function(i,f,c,b,e,g,d,a){var h=f.extend({_modelClass:c,name:"user-location-edit-view",_createContent:function(){var l=new d({className:"msg-animation",visible:true,animate:true,spin:true});var k=this.addControl("form-aboutme",l),j=this.model;this.container.setStyle("text-align","center");j.fetchCountries({onComplete:function(u){function r(w,v){return w.sort(function(B,A){var z=B[v];var C=A[v];return((z<C)?-1:((z>C)?1:0))})}u=r(u,"label");var q=j.getPassportAttributeConstraints("company"),p=j.getPassportAttributeConstraints("address"),n=j.getPassportAttributeConstraints("zip"),o=j.getPassportAttributeConstraints("city"),t=j.getPassportAttributeConstraints("country_code");var m=this.addControl("form-aboutme",new g({fields:[i.merge({type:"text",label:e.Company,value:(j.get("company",{escapeHTML:false})||"").unescapeHTML(),disabled:!j.isEditableByPassport("company"),events:{onChange:function(){j.addChanges("company",this.getValue())}}},q),i.merge({type:"text",label:e.Address,value:(j.get("address",{escapeHTML:false})||"").unescapeHTML(),disabled:!j.isEditableByPassport("address"),events:{onChange:function(){j.addChanges("address",this.getValue())}}},p),i.merge({type:"text",label:e.ZipCode,disabled:!j.isEditableByPassport("zip"),value:(j.get("zip",{escapeHTML:false})||"").unescapeHTML(),events:{onChange:function(){j.addChanges("zip",this.getValue())}}},n),i.merge({type:"text",label:e.City,disabled:!j.isEditableByPassport("city"),value:(j.get("city",{escapeHTML:false})||"").unescapeHTML(),events:{onChange:function(){j.addChanges("city",this.getValue())}}},o),i.merge({type:"select",label:e.Country,disabled:!j.isEditableByPassport("country_code"),value:j.get("country_code",{escapeHTML:false}),options:u,events:{onChange:function(){if(this.getSelection()[0]){j.addChanges("countryForRead",this.getSelection()[0].text)}j.addChanges("country_code",this.getSelection()[0].value)}}},t)]}));this.container.setStyle("text-align","inherit");m.inject(this.container.empty());var s=u.filter(function(v){return v.value===j.get("country_code")});if(s[0]){j.set("country",s[0].label)}}.bind(this)});return k}});return h});define("DS/SwymUIComponents/script/lib/ckeditor/ckeditor-config",["DS/CKEditor/CKEditor"],function(a){a.disableAutoInline=true;require(["DS/SwymUIComponents/script/lib/ckeditor/customlink/plugin","DS/SwymUIComponents/script/lib/ckeditor/customtable/plugin","DS/SwymUIComponents/script/lib/ckeditor/autohyperlink/plugin","DS/SwymUIComponents/script/lib/ckeditor/customtable/dialogs/customtable","DS/SwymUIComponents/script/lib/ckeditor/customlink/dialogs/customlink","DS/SwymUIComponents/script/lib/ckeditor/highlight/plugin"],function(){a.plugins.addExternal("customlink","../../SwymUIComponents/script/lib/ckeditor/customlink/","plugin.js");a.plugins.addExternal("customtable","../../SwymUIComponents/script/lib/ckeditor/customtable/","plugin.js");a.plugins.addExternal("autohyperlink","../../SwymUIComponents/script/lib/ckeditor/autohyperlink/","plugin.js");a.plugins.addExternal("highlight","../../SwymUIComponents/script/lib/ckeditor/highlight/","plugin.js")});return a});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/oembed-providers-list",[],function(){var a=(function(){return[{provider_name:"YouTube",provider_url:"http://www.youtube.com/",endpoints:[{url:"http://www.youtube.com/oembed",discovery:true}]},{provider_name:"SoundCloud",provider_url:"http://soundcloud.com/",endpoints:[{schemes:["http://soundcloud.com/*"],url:"https://soundcloud.com/oembed"}]},{provider_name:"Ted",provider_url:"https://www.ted.com",endpoints:[{schemes:["http://ted.com/talks/*"],url:"http://www.ted.com/talks/oembed.json"}]},{provider_name:"The New York Times",provider_url:"https://www.nytimes.com",endpoints:[{schemes:["https://www.nytimes.com/svc/oembed","https://nytimes.com/*","https://*.nytimes.com/*"],url:"https://www.nytimes.com/svc/oembed/json/",discovery:true}]},{provider_name:"Twitch",provider_url:"https://www.twitch.tv",endpoints:[{schemes:["http://clips.twitch.tv/*","https://clips.twitch.tv/*","http://www.twitch.tv/*","https://www.twitch.tv/*","http://twitch.tv/*","https://twitch.tv/*"],url:"https://api.twitch.tv/v4/oembed",formats:["json"]}]},{provider_name:"VEVO",provider_url:"http://www.vevo.com/",endpoints:[{schemes:["http://www.vevo.com/*","https://www.vevo.com/*"],url:"https://www.vevo.com/oembed",discovery:false}]},{provider_name:"Vimeo",provider_url:"https://vimeo.com/",endpoints:[{schemes:["https://vimeo.com/*","https://vimeo.com/album/*/video/*","https://vimeo.com/channels/*/*","https://vimeo.com/groups/*/videos/*","https://vimeo.com/ondemand/*/*","https://player.vimeo.com/video/*"],url:"https://vimeo.com/api/oembed.{format}",discovery:true}]}]}());return a});define("DS/SwymUIComponents/script/feature/core/user/view/badge-view",["UWA/Core","DS/UIKIT/Tooltip","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/i18n","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/badge-view","DS/WebappsUtils/WebappsUtils"],function(h,b,g,e,d,f,c){var a=g.extend({name:"badge-view",_contentLevels:[0,10,20],_interactionLevels:[0,15,30],_badgesConfig:{nb_comment:{color:"#368EC4",secondColor:"#005686",iconCode:"&#xe082;",icon:"comment",type:"interaction"},nb_post:{color:"#d1d4d4",secondColor:"#77797C",iconCode:"&#xe055;",icon:"newspaper",type:"content"},nb_media:{color:"#9B2C98",secondColor:"#4E164D",iconCode:"&#xe009;",icon:"picture",type:"content"},nb_question:{color:"#EA4F37",secondColor:"#844138",iconCode:"&#xe019;",icon:"help",type:"content"},nb_ideation:{color:"#00B8DE",secondColor:"#0087A3",iconCode:"&#xe123;",icon:"lamp",type:"content"},nb_answer:{color:"#57B847",secondColor:"#477738",iconCode:"&#xe019;",icon:"help",type:"interaction"}},getConfigValue:function(i){return this._badgesConfig[this._attributeName][i]},_createContent:function(){var n=this.model;if(n){var t=parseInt(n.get(this._attributeName),10),q;svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg");svgContainer.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");var j=64,u=55,i=12,m,l,s,p,o,v=9,w,k;svgContainer.setAttribute("class","svg-badge");svgContainer.setAttribute("width",j+"px");svgContainer.setAttribute("height",u+"px");svgContainer.setAttribute("xmlns","http://www.w3.org/2000/svg");badgeShape=document.createElementNS("http://www.w3.org/2000/svg","path");badgeShape.setAttribute("d",this._createBadgePath(j,u,v));badgeShape.setAttribute("fill",this.getConfigValue("color"));badgeShape.setAttribute("stroke",this.getConfigValue("color"));badgeShape.setAttribute("stroke-linejoin","round");badgeShape.setAttribute("stroke-width",v);svgContainer.appendChild(badgeShape);if(!h.Utils.Client.Engine.ie){icon=document.createElementNS("http://www.w3.org/2000/svg","text");icon.setAttribute("x",j/2);icon.setAttribute("y",u/2+9);icon.setAttribute("font-size",28);icon.setAttribute("fill","white");icon.setAttribute("class","fonticon");icon.setAttribute("font-weight","bold");icon.setAttribute("text-anchor","middle");icon.innerHTML=this.getConfigValue("iconCode");svgContainer.appendChild(icon)}if(t<(this.getConfigValue("type")==="content"?this._contentLevels[2]:this._interactionLevels[2])){m=3*j/4+4;l=3*u/4-2;if(t<(this.getConfigValue("type")==="content"?this._contentLevels[1]:this._interactionLevels[1])){w=document.createElementNS("http://www.w3.org/2000/svg","circle");w.setAttribute("cx",m);w.setAttribute("cy",l);w.setAttribute("r",i);w.setAttribute("fill",this.getConfigValue("secondColor"))}else{k=document.createElementNS("http://www.w3.org/2000/svg","polygon");k.setAttribute("x",0);k.setAttribute("y",0);k.setAttribute("width",i*2);k.setAttribute("height",i*2);k.setAttribute("fill",this.getConfigValue("secondColor"));k.setAttribute("points","12,0 14.588,2.341 18,1.607 19.07,4.929 22.392,6 21.659,9.412 24,12 21.659,14.589 22.392,18 19.07,19.071 18,22.393 14.588,21.659 12,24 9.411,21.659 6,22.393 4.929,19.071 1.607,18 2.34,14.589 0,12 2.34,9.412 1.607,6 4.929,4.929  6,1.607 9.411,2.341");w=document.createElementNS("http://www.w3.org/2000/svg","svg");s=40;p=27;w.setAttribute("x",s);w.setAttribute("y",p);w.setAttribute("width",i*2);w.setAttribute("height",i*2);w.appendChild(k)}badgeLevelValue=document.createElementNS("http://www.w3.org/2000/svg","text");badgeLevelValue.setAttribute("x",m);badgeLevelValue.setAttribute("y",l+4);badgeLevelValue.setAttribute("font-size",12);badgeLevelValue.setAttribute("fill","white");badgeLevelValue.setAttribute("font-weight","bold");badgeLevelValue.setAttribute("text-anchor","middle");badgeLevelValue.appendChild(document.createTextNode((t<10?t:"+9")));svgContainer.appendChild(w);svgContainer.appendChild(badgeLevelValue)}else{w=document.createElementNS("http://www.w3.org/2000/svg","image");s=39;p=23;w.setAttribute("x",s);w.setAttribute("y",p);w.setAttribute("width",i*2);w.setAttribute("height",30);w.setAttribute("href",c.getWebappsBaseUrl()+"SwymSCI/assets/images/badge-gold.png");svgContainer.appendChild(w)}switch(this._attributeName){case"nb_comment":o=f.ToolTipComment;break;case"nb_post":o=f.ToolTipPost;break;case"nb_media":o=f.ToolTipMedia;break;case"nb_question":o=f.ToolTipQuestion;break;case"nb_answer":o=f.ToolTipAnswer;break;case"nb_ideation":o=f.ToolTipIdeation;break}o=d.replace(o,{nickname:n.get("nickname"),number:n.get(this._attributeName)});this.addControl("badgeTooltip",new b({target:this.getContent(),body:o,delay:{show:500}}));return[h.extendElement((h.Utils.Client.Engine.ie?[{tag:"span","class":"badge-fonticon-for-ie fonticon fonticon-2x fonticon-"+this.getConfigValue("icon")},svgContainer]:svgContainer))]}},_createBadgePath:function(i,j,k){var l=function(n,o){return n+" "+o+" "},m="";k=k/2;m+="M"+l(0+k,j/2);m+="L"+l(1*i/3-k/2,j-k);m+="L"+l(2*i/3+k/2,j-k);m+="L"+l(i-k,j/2);m+="L"+l(2*i/3+k/2,0+k);m+="L"+l(1*i/3-k/2,0+k);m+="Z";return m},setup:function(i){this._attributeName=i.attributeName;this._parent.apply(this,arguments)}});return a});define("DS/SwymUIComponents/script/feature/core/stats/view/analytics-view",["UWA/Core","i18n!DS/SwymUICore/assets/nls/feature/core/stats/model/table-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/W3DXComponents/Views/GraphView","DS/SwymUICore/script/utils/date","DS/WebappsUtils/Console"],function(g,e,f,c,d,b){var a=f.extend({_modelEvents:{onRequest:"_onRequest",onSync:"unmask",onChange:"refresh",onError:"_onError"},_graph:null,_type:null,domEvents:{},_createContent:function(){var h=this.model;if(h){var i=g.createElement("div",{"class":"analytics",events:{resize:function(){if(this._graph){this._graph.reflow()}}.bind(this)}});return i}},_onRequest:function(){var h=this.model;h._attributes={};this.mask()},_onError:function(){var h=g.createElement("div",{html:e.NoDataToDisplay,styles:{"text-align":"center","line-height":"38px"}});this.container.children[0].setContent(h);this.unmask()},setup:function(h){this._parent.apply(this,arguments);this._type=this.model.getModelName()},onRender:function(){var i=this.model,h=this.getElement(".analytics");this.mask();if(this._type===c.TYPE_TABLE){h.setHTML(g.createElement("span",{html:e[i.getTitle()]}))}},onRefresh:function(){var k=this.model,h=this.getElement(".analytics"),m=[],l,j=k.getAttributes();if(this._type===c.TYPE_PIE){for(l in j){if(j.hasOwnProperty(l)&&j[l]>0){m.push([e[l],j[l]])}}this._graph=new c({type:c.TYPE_PIE,series:[{data:m}],expertOpts:{title:{text:e[k.getTitle()],style:{color:"#333"}}}}).render().inject(h)}else{if(this._type===c.TYPE_COLUMN){var o=[],n={},i;for(l in j){if(j.hasOwnProperty(l)){for(i in j[l]){if(!n.hasOwnProperty(i)){n[i]=0}n[i]+=j[l][i]}}}for(l in j){if(j.hasOwnProperty(l)){o[l]=[];for(i in j[l]){if(j[l].hasOwnProperty(i)&&n.hasOwnProperty(i)){splitedDate=i.split("-");o[l].push({x:Date.UTC(splitedDate[0],splitedDate[1]-1,splitedDate[2]),y:parseInt(k.get(l)[i]),percentage:(parseInt(k.get(l)[i])/n[i])*100})}}}}for(l in j){if(j.hasOwnProperty(l)){m.push({name:e[l],data:o[l]})}}this._graph=new c({xAxis:{type:c.XAXIS_TYPE_DATETIME},type:c.TYPE_LINE,series:m,expertOpts:{title:{text:e[k.getTitle()],style:{color:"#333"}},plotOptions:{line:{marker:{enabled:(m[0].data.length===1)?true:false}},series:{turboThreshold:(m[0].data.length>1000)?0:1000}}}}).render().inject(h)}else{if(this._type===c.TYPE_TABLE){for(l in j){if(j.hasOwnProperty(l)){if(l==="Average answer time for iQuestions"){m.push([l.escapeHTML(),d.getAverageElapsedTime(k.get(l))])}else{m.push([l.escapeHTML(),j[l]])}}}h.setHTML(g.createElement("span",{html:e[k.getTitle()]}));m.forEach(function(p){if(p.length>1&&typeof p[1]==="object"){p[0]='<a data-content-type="person" data-login="'+p[1].login+'">'+p[0]+"</a>";p[1]=p[1].counter}});this._graph=new c({type:c.TYPE_TABLE,series:[{data:m}]}).render().inject(h)}}}this.unmask()}});return a});define("DS/SwymUIComponents/script/feature/core/experience/view/experience-read-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-read-view","DS/SwymUICore/script/feature/core/experience/model/experience-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/date","DS/UIKIT/DropdownMenu"],function(g,e,b,f,d,c){var a=f.extend({_modelEventsForAutoRefresh:["onChange:place","onChange:date_begin","onChange:date_end","onChange:industry","onChange:not_finished","onChange:description","onChange:title","onChange:work_name"],_modelClass:b,name:"experience-read-view",_createContent:function(){var h=this.model.collection.getAssociated("user").isCurrentUser(),m=this.model.get("place")?" - ":"",l=this.model.get("industry")?" ("+this.model.get("industry")+")":"",k=h?'<span class="fonticon fonticon-2x cursor-pointer fonticon-down-open"></span>':"",j=this.model.get("not_finished")=="1"?'<span class="profile-date-experience">'+e.since+" "+d.textDate(this.model.get("date_begin"))+"</span>":'<span  class="profile-date-experience">'+d.textDate(this.model.get("date_begin"))+" - "+d.textDate(this.model.get("date_end"))+"</span>",i=g.createElement("div",{html:'<span class="profile-title-experience">'+this.model.get("title")+"</span>"+k+'<br><span class="profile-location-experience">'+this.model.get("work_name")+l+m+(this.model.get("place")||"")+"</span>"+j+'<span class="profile-description-experience">'+(this.model.get("description",{breakline:true})||"")+"</span>"});this.addControl("dropdown",new c({target:i.getElement(".fonticon-down-open"),items:[{text:e.Edit,fonticon:"pencil"},{text:e.Delete,fonticon:"trash"}],events:{onClick:function(o,n){if(n.fonticon==="pencil"){this.model.dispatchEvent("onPencilIconClicked")}else{if(n.fonticon==="trash"){this.model.dispatchEvent("onTrashIconClicked")}}}.bind(this)}}));return i}});return a});define("DS/SwymUIComponents/script/feature/core/ui-components/back-arrow-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/core/history/history-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/utils/navigation","i18n!DS/SwymUIComponents/assets/nls/feature/core/ui-components/back-arrow-view","i18n!DS/SwymUIComponents/assets/nls/topframe-init"],function(h,g,k,j,c,b,i,a,f,d){var e=g.extend({name:"back-arrow-view",className:"unmaximize-button",_modelText:f.Home,_modelEvents:{"onChange:title":"_onTitleChange"},domEvents:{"click .arrow":"_onClick","click .back-arrow-heading":"_onClick"},_onClick:function(){var l=j.getInstance();this.navigateToPreviousContext();l.dispatchEvent("onBack")},_getCurrentThreadFromMid:function(l){return new b({mid:l})},_getThreadLabel:function(l){return l.get("title")},_getCommunityPageNameFromContextPage:function(m){var l="";switch(m){case"blog":l=f.COMMUNITY_BLOG;break;case"media":l=f.COMMUNITY_MEDIA;break;case"ideas":l=f.COMMUNITY_IDEAS;break;case"questions":l=f.COMMUNITY_QUESTIONS;break;case"wiki":l=f.COMMUNITY_WIKI;break;case"members":l=f.COMMUNITY_MEMBERS;break;case"settings":l=f.COMMUNITY_SETTINGS;break;case"stats":l=f.COMMUNITY_STATS;break;case"mycontributions":l=f.COMMUNITY_MY_CONTRIBUTIONS;break;case"surveys":l=f.COMMUNITY_SURVEYS;break;default:break}return l},_onTitleChange:function(n){var o=j.getInstance(),m=c.getStateListing(),p=o.isInTemporaryState()?o.getData():(m&&m.previousContext),q=p&&p.path,l=this._getCommunityPageNameFromContextPage(q?o.getCommunityPageContext(q):null);this._modelText=this._getThreadLabel(n)+(l?(" - "+l):"");this.refresh()},_onContextChange:function(){var q,m,o,n=j.getInstance(),l=c.getStateListing(),p=n.isInTemporaryState()?n.getData():(l&&l.previousContext),r=p&&p.path;if(!this.isDestroyed()){if((window.ds&&window.ds.swymIM===true)&&n.isCommunityContext()&&((!r&&!n.isContentContext())||n.extractContextInfoFromRoute(r).communityId||!n.isContentContext())){o=this._getCurrentThreadFromMid(n.communityId,h.is(n.dmId));this._modelText=this._getThreadLabel(o);this.setModel(o);this.updateView()}else{if(p){if(p.contentId&&p.contentType){q=this;require([k.getModuleNameFromModelName(p.contentType)],function(s){if(q.model){o=new s({mid:p.contentId});q._modelText=q.model.get("title")+((p.editionMode===true)?(" - "+f.Edit):"");q.setModel(o);q.updateView()}})}else{if(p.communityId&&!p.contentId){m=this._getCommunityPageNameFromContextPage(p.path?n.getCommunityPageContext(p.path):null);o=this._getCurrentThreadFromMid(p.communityId,h.is(p.dmId));this._modelText=this._getThreadLabel(o)+(m?(" - "+m):"");this.setModel(o);this.updateView()}else{if(p.userHashKey){o=new i({hash_key:p.userHashKey});this._modelText=o.get("nickname");this.setModel(o);this.updateView()}else{if(this.model){this.stopListening(this.model);this.model=null}if(r.indexOf(a.SEARCH)===0){this._modelText=f.SEARCH+(p.query?(" - "+decodeURI(p.query)):"")}else{if(r.indexOf(a.ADMIN_TENANT)===0){this._modelText=d.Manage}else{if(r.indexOf(a.MY_COMMUNITIES)===0){this._modelText=f.MY_COMMUNITIES}else{if(r.indexOf(a.DISCOVER_COMMUNITIES)===0){this._modelText=f.DISCOVER_COMMUNITIES}else{if(r.indexOf(a.MY_BOOKMARKS)===0&&n.path!==a.MY_BOOKMARKS){this._modelText=f.MY_BOOKMARKS}else{this._modelText=f.Home}}}}}this.updateView()}}}}else{if(this.model){this.stopListening(this.model);this.model=null}this._modelText=f.Home;this.updateView()}}}},updateView:function(){if(!this.isRendered()){this.render()}else{this.refresh()}},_createRightButton:function(){return""},_createContent:function(){var l=h.createElement("span",{"class":"arrow",html:{"class":"fonticon fonticon-1-5x fonticon-left-open"}});this.elements.lastContext=h.createElement("span",{"class":"back-arrow-heading",html:(this.options.backArrowText?[{tag:"span","class":"no-color-effect"},this.options.backArrowText]:[this._modelText])});return[l,this.elements.lastContext,this._createRightButton()]},init:function(){this._parent.apply(this,arguments);this._onContextChange=this._onContextChange.bind(this);j.getInstance().addListener("onContextChange",this._onContextChange,this,true);j.getInstance().addListener("onTemporaryStateChange",this._onContextChange,this,true)},navigateToPreviousContext:function(){var l=j.getInstance();if(!l.isInTemporaryState()&&(l.editionMode!==true)){c.backToListing()}},destroy:function(){j.getInstance().removeListener("onContextChange",this._onContextChange);j.getInstance().removeListener("onTemporaryStateChange",this._onContextChange);return this._parent.apply(this,arguments)}});return e});define("DS/SwymUIComponents/script/feature/core/user/view/components/user-stars-edit-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/WebappsUtils/Console","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/components/user-stars-edit-view"],function(e,d,b,c){var a=d.extend({_modelEventsForAutoRefresh:["onChange"],_labelNameInput:"",setup:function(f){f=f||{};e.extend(this,f);return this._parent.apply(this,arguments)},domEvents:{"click .result-option:nth-child(2)":"_clickOnFirstStar","click .result-option:nth-child(3)":"_clickOnSecondStar","click .result-option:nth-child(4)":"_clickOnThirdStar"},_clickOnFirstStar:function(g){var f=this.getControl("form-box-view");if(f&&g!==false){f.setValue("level","1")}},_clickOnSecondStar:function(g){var f=this.getControl("form-box-view");if(f&&g!==false){f.setValue("level","2")}},_clickOnThirdStar:function(g){var f=this.getControl("form-box-view");if(f&&g!==false){f.setValue("level","3")}},_getLevelFromJSToDB:function(g){var f=parseInt(g);if(f===3){f++}return f},_createContentInputStars:function(){if(this.model._modelName==="skill"){this.labelLow=c.skillLow;this.labelMedium=c.skillMedium;this.labelHigh=c.skillHigh}else{if(this.model._modelName==="language"){this.labelLow=c.languageLow;this.labelMedium=c.languageMedium;this.labelHigh=c.LanguageHigh}}return{required:true,type:"select",label:c.Evaluation,placeholder:"",name:"level",options:[{label:this.labelLow,value:"1",selected:(this.model.getLevelFromDBToJS()===1)},{label:this.labelMedium,value:"2",selected:(this.model.getLevelFromDBToJS()===2)},{label:this.labelHigh,value:"3",selected:(this.model.getLevelFromDBToJS()===3)}],template:{setOption:function(g,j){var h='<span class="fonticon fonticon-star active-blue fonticon-1-5x"></span>',f='<span class="fonticon fonticon-star unactive-blue fonticon-1-5x"></span>',i=h;if(j===this.labelLow){i+=f+f}else{if(j===this.labelMedium){i+=h+f}else{i+=h+h}}if(i&&j.unescapeHTML().trim()){g.addContent({"class":"select-evaluation-container",html:'<div class="option-evaluation">'+j+'</div class="fonticons-select-evaluation"><div>'+i+"</div>"})}else{g.setStyle("display","none")}}.bind(this),getOption:function(f,g){console.log("template select");console.log(f);console.log(g);if(f.hasClassName("select-evaluation-container")){return f.getParent(".result-option")}}},custom:true,events:{onChange:function(){var g=this.getControl("form-box-view");if(g){var f=g.getValue("level");this.model.addChanges("level",this._getLevelFromJSToDB(f));if(f==="1"){this._clickOnFirstStar(false)}else{if(f==="2"){this._clickOnSecondStar(false)}else{this._clickOnThirdStar(false)}}}}.bind(this)}}}});return a});define("DS/SwymUIComponents/script/feature/core/ui-components/profile-element-container/profile-element-container-view",["UWA/Core","DS/SwymUICore/script/utils/i18n","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/UIKIT/Input/Button","DS/WebappsUtils/Console","DS/PubSub/PubSub"],function(h,d,g,e,b,c,a){var f=g.extend({name:"profile-container",domEvents:{"click .header-profile-element .fonticon-plus":"_onClickAddIcon","click .icon-section .fonticon-pencil":"_onClickPencilIcon","click .icon-section .other-icon":"_otherIconAction","click .engaging-div":"_onClickEngagingDiv"},_onClickEngagingDiv:function(){if(this._collection){this._onClickAddIcon()}else{this._onClickPencilIcon()}var i=this.getControl("default-view");if(i){i.hide()}},_engagingUX:false,_editAllActivated:false,_userModel:null,_hasPencilIcon:false,_hasPlusIcon:false,_title:"",_mainView:null,_model:null,_collection:null,_hasBackground:false,_otherIcon:null,_iconSection:null,_modelColor:null,_otherIconAction:function(){c.log("action to be performed on action to be clicked")}.bind(this),_defaultMessage:null,_checkEmptyAttributes:[],_additionElementInProgress:false,_onClickPencilIcon:function(){this._showHeader();this._hideIcon("pencil");var j=this.getControl("default-view");if(j){j.hide()}var k=this.getChildView("mainView"),i;if(k){i=k.getChildView("edition-switch");i.setMode("edit");i.addEvent("onRead",function(){var l=this.getControl("default-view");if(!this._collection&&this._attributesAreEmpty()){if(l){l.show()}this._hideHeader()}else{if(l){l.hide()}this._showIcon("pencil")}}.bind(this))}},_onClickAddIcon:function(){this._showHeader();if(this._additionElementInProgress!==true||this._editAllActivated===true){var k=this._collection.model,j=new k({}),i=this.getChildView("mainView");if(i){j.addEvents({onCancel:this._onAddElementPossible.bind(this),onSave:this._onAddElementPossible.bind(this)});i.addEventOnce("onRefresh",function(){i.getModelViews()[0].getChildView("edition-switch").setMode("edit")});this._collection.add(j,{at:0})}this._additionElementInProgress=true;this._showIcon("plus");if(this._editAllActivated===false){this._hideIcon("plus")}}},_onAddElementPossible:function(){if(this._collection&&this._collection.length===0){var i=this.getControl("default-view");if(i){i.show()}this._hideHeader()}else{this._showIcon("plus")}this._additionElementInProgress=false},setup:function(i){i=i||{};h.extend(this,i);if(this._rendered===true){this.refresh()}this._reactToEditAllEvent();this._addListenersToCollection();this._addListenerToView();return this._parent.apply(this,arguments)},_reactToEditAllEvent:function(){a.add("editAll",function(i){if(this.isRendered()){if(i===true){if(this._hasPencilIcon===true){this._onClickPencilIcon()}this._showIcon("plus");this._editAllActivated=true}else{if(i===false){this._editAllActivated=false}}}}.bind(this),null,true)},_postRenderOrRefresh:function(){if(this._collection&&this._collection.length===0){this._hideHeader()}if(!this._collection&&this._attributesAreEmpty()){this._hideIcon("pencil");if(this._userModel.isCurrentUser()){this._hideHeader()}}},_addListenerToView:function(){this.addEvent("onRender",this._postRenderOrRefresh);this.addEvent("onRefresh",this._postRenderOrRefresh)},_addListenersToCollection:function(){if(this._collection){this._collection.addEvent("onDestroy",function(i,k){if(k.length<=1){this._hideIcon("plus");this._hideHeader();var j=this.getControl("default-view");if(j){j.show()}}}.bind(this));this._collection.addEvent("onRemove",function(i,j){this._sendEventToUserCompletion(false,j.length,i._modelName)}.bind(this));this._collection.addEvent("onAdd",function(i,j){this._sendEventToUserCompletion(true,j.length,i._modelName)}.bind(this))}},_sendEventToUserCompletion:function(o,n,j){var l=5,i=10,k=0,m=this._userModel.get("profile_completion");if(o===true){switch(j){case"interest":case"language":case"experience":if(n<3){k=l}break;case"education":if(n<2){k=l}break;case"skill":if(n<4){k=i}break}}else{switch(j){case"interest":case"language":case"experience":if(n<2){k=-l}break;case"education":if(n<1){k=-l}break;case"skill":if(n<3){k=-i}break}}this._userModel.dispatchEvent("usercompletionUpdate",m+k)},_createFonticonCodeOther:function(i){return'<span class="fonticon cursor-pointer other-icon fonticon-'+i+'"></span>'},_createFonticonCode:function(j,i){return'<span class="fonticon fonticon-1-5x cursor-pointer fonticon-'+j+'"'+(i?'style="display:none;"':"")+"></span>"},_createFonticonCodeForSection:function(i){return'<span  class="pull-left fonticon-section-profile fonticon fonticon-2x fonticon-'+i+'"></span>'},_showIcon:function(j){var i=this.getElement(".fonticon-"+j);if(i){i.show()}},_hideIcon:function(j){var i=this.getElement(".fonticon-"+j);if(i){i.hide()}},_hideHeader:function(){var i=this.getElement(".header-profile-element");if(i){i.hide()}},_showHeader:function(){var i=this.getElement(".header-profile-element");if(i){i.show()}},_createIconsAction:function(){var i="";if(this._userModel.isCurrentUser()){if(this._hasPlusIcon===true){i+=this._createFonticonCode("plus",true)}if(this._hasPencilIcon===true){if(this._checkEmptyAttributes.length>0){if((this._userModel.isEditableByPassport(this._checkEmptyAttributes[0])===true)||(this._checkEmptyAttributes[0]==="tenant_more_about_me")){i+=this._createFonticonCode("pencil")}}else{i+=this._createFonticonCode("pencil")}}if(this._otherIcon){i+=this._createFonticonCodeOther(this._otherIcon)}}return i},_attributesAreEmpty:function(){var k=false;for(var n=0,j=this._checkEmptyAttributes.length;n<j;n++){var m=this._checkEmptyAttributes[n];if(this._model.get(m)===null||!/\S/.test(this._model.get(m))){k=true;break}}return k},_createEmptyView:function(){var k="";if(this._defaultMessage){if(this._model.isCurrentUser()){if(this._engagingUX===true){var j=this;var i=g.extend({_createContent:function(){return h.createElement("div",{"class":"engaging-div",html:[{"class":"engaging-message",html:'<div><span  style="color: #005686 !important" class="fonticon fonticon-4x fonticon-'+j._iconSection+'"></span></div><div class="engaging-flex-1"><span class="engaging-title profile-element-title">'+j._defaultMessage+'</span></br><span class="engaging-content">'+j._engagingText+'</span></div><div class="plus-container" ><span class="cursor-pointer fonticon fonticon-3x fonticon-plus"></span></div>'}]})}});k=this.addControl("default-view",new i())}else{k=this.addControl("default-view",new b({value:this._defaultMessage?this._defaultMessage:"",className:"block default default-message-profile",icon:(this._iconSection)?this._iconSection:"",events:{onClick:function(){if(this._collection){this._onClickAddIcon()}else{this._onClickPencilIcon()}k.hide()}.bind(this),onShow:function(){this.container.addClassName("button-displayed")}.bind(this),onHide:function(){this.container.removeClassName("button-displayed")}.bind(this)}}));k.show()}}else{if(this._collection&&this._collection.length===0||(!this._collection&&this._attributesAreEmpty())){this.hide()}}if(this._collection&&this._collection.length!==0||(!this._collection&&!this._attributesAreEmpty())){if(k){k.hide()}}this._hideIcon("plus");this._hideIcon("pencil")}return k},_createMainViewforCollection:function(){var i=null,j=this;if(typeof(this._mainView)==="string"){require([this._mainView],function(k){this._mainView=k;this.addChildView("mainView",{Class:e.extend({name:"profile-element-collection",modelViewClass:k,onInjected:function(){if(j._collection&&j._collection.length>0&&this.getModelViews()[0].getChildView("edition-switch").getMode()!=="edit"){j._showIcon("plus")}}}),collection:this._collection})}.bind(this));i=this.addChildView("mainView",this.createDummyView())}else{i=this.addChildView("mainView",{Class:this._mainView,collection:this._collection})}return i},_createContent:function(){if(this._hasBackground===true){this.container.className=this.container.className+" profile-background"}return[{"class":"header-profile-element",html:[{html:(this._iconSection)?this._createFonticonCodeForSection(this._iconSection):""},{html:this._title,"class":"profile-element-title pull-left margin-bottom-20px"},{"class":"icon-section",html:this._createIconsAction()}]},{"class":"clearboth"},this._collection?this._createMainViewforCollection():this.addChildView("mainView",{Class:this._mainView,model:this._model}),this._createEmptyView()]}});f.editAllMode=false;return f});define("DS/SwymUIComponents/script/feature/community/media/library/media-filters-toolbar-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/filters-toolbar-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/SwymUICore/script/lib/view/generic/swym-view","DS/PlatformAPI/PlatformAPI","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/lib/6wpanel/utils","DS/UIKIT/Tooltip"],function(g,c,d,j,f,a,e,k,m,l,i){var h=true;var b=e.extend({name:"media-filters-toolbar-view",domEvents:{"click #images-filter":"_filter","click #videos-filter":"_filter","click #media3d-filter":"_filter","click #document-filter":"_filter","click #gif-filter":"_filter","click .search-activated #search-filter":"_launchSearchCall","click #search-filter":"_enableSearchInput","click #remove-search-filter":"_disableSearchInput"},_enableSearchInput:function(){var n=this.getElement("#media_type_filters");if(n&&!n.hasClassName("search-activated")){n.addClassName("search-activated");this._removeSelectedClassRightFilter();this._currentRightFilter="";this._callOptions.data.query="#all";this._performSearchCall()}},_disableSearchInput:function(){var n=this.getElement("#media_type_filters");if(n){n.removeClassName("search-activated")}this._callOptions.data.query="#all";this._performSearchCall()},_currentLeftFilter:"",_currentRightFilter:"",_callOptions:{},_filter:function(n){this._preventAndStop(n);this.filter(n.target)},_preventAndStop:function(n){n.preventDefault();n.stopPropagation()},_launchSearchCall:function(){var n=this.container.getElement(".selected");if(n){this._currentRightFilter="";n.removeClassName("selected")}this._callOptions.data.query=this.getControl("search-input").getValue();this._performSearchCall()},setup:function(n){this._callOptions={data:{query:"#all",order_field:"update",with_synthesis:false},serviceName:"filter"};this._currentLeftFilter='community_id:"'+this.getOption("communityId")+'"';this._callOptions.data.refineUsingQuery=this._currentLeftFilter;this.collection.fetchPage(1,this.collection.getFilteringOptions(null,null,this._callOptions));return this._parent.apply(this,arguments)},_createContent:function(){var r=this.collection,n=m.getInstance(),o=n.isDirectMessageContext(),w=k.getApplicationConfiguration("app.3DDrive.enable")==="true"&&h,t=new d({id:this.getOption("communityId")}),u=[],p=!o?t.get("title",{escapeHTML:false}):c.Conversation;u.push({name:"community",text:p,selectable:true,selected:true});u.push({name:"my",text:c.MyMedia,selectable:true});u.push({name:"all",text:c.AllMedia,selectable:true});var v=!o?(c.Addmediafrom+p):c.AddmediaFromConversation;if(w){u.push({className:"divider"}),u.push({name:"drive",text:c.Drive,selectable:true})}var s=[this.addControl("button-filter",new f({value:v,className:"custom-button",dropdown:{items:u},events:{onDropdownClick:function(z,y){var x={};switch(y.name){case"all":this.getControl("button-filter").setValue(c.Addmediafrom+y.text);x.id="all-media-filter";break;case"community":this.getControl("button-filter").setValue(v);x.id="community-media-filter";break;case"my":this.getControl("button-filter").setValue(c.Addmediafrom+y.text);x.id="my-media-filter";break;case"drive":this.getControl("button-filter").setValue(c.Addmediafrom+y.text);break}if(y.name==="drive"){this.dispatchEvent("onActivateDrive",[true])}else{this.dispatchEvent("onActivateDrive",[false]);this.filter(x)}}.bind(this)}})),{id:"media_type_filters",html:[{tag:"span",id:"remove-search-filter","class":"fonticon fonticon-2x fonticon-cancel"},this.addControl("search-input",new a({placeholder:c.Search,className:"search-input",events:{onKeyDown:function(x){if(x.which==13||x.keyCode==13){this._launchSearchCall()}}.bind(this)}})),{tag:"span",id:"images-filter","class":"fonticon fonticon-2x fonticon-picture"},{tag:"span",id:"gif-filter","class":"fonticon fonticon-2x fonticon-picture-animated"},{tag:"span",id:"videos-filter","class":"fonticon fonticon-2x fonticon-video"},{tag:"span",id:"media3d-filter","class":"fonticon fonticon-2x fonticon-cube"},{tag:"span",id:"document-filter","class":"fonticon fonticon-2x fonticon-doc"},{tag:"span",id:"search-filter","class":"fonticon fonticon-2x fonticon-search"}]}];var q=g.createElement("div",{"class":"media_filters_toolbar",html:s});this._addTooltipOnRighFilter(q,"images-filter",c.Pictures);this._addTooltipOnRighFilter(q,"gif-filter",c.GIFs);this._addTooltipOnRighFilter(q,"videos-filter",c.Video);this._addTooltipOnRighFilter(q,"media3d-filter",c.ThreeDModels);this._addTooltipOnRighFilter(q,"document-filter",c.Documents);this._addTooltipOnRighFilter(q,"search-filter",c.Search);return q},_addTooltipOnRighFilter:function(p,o,n){var q=p.getElement("#"+o);if(q){new i({target:q,body:n})}},_removeSelectedClassRightFilter:function(){var n=this.container.getElement("#media_type_filters .selected");if(n){n.removeClassName("selected")}},filter:function(o){var p=o.id,q=this.container.getElement("#media_type_filters"),n=function(){var r=q.getElement(".selected");if(r){r.removeClassName("selected")}if(r!==o){o.addClassName("selected")}else{this._currentRightFilter=""}}.bind(this);switch(p){case"all-media-filter":this._currentLeftFilter="";break;case"community-media-filter":this._currentLeftFilter='community_id:"'+this.getOption("communityId")+'"';break;case"my-media-filter":this._currentLeftFilter="hash_key:"+j.getInstance().get("user").hash_key;break;case"gif-filter":this._currentRightFilter=l.getTagFilterForMedia("AnimatedPicture");n();break;case"images-filter":this._currentRightFilter=l.getTagFilterForMedia("Picture");n();break;case"videos-filter":this._currentRightFilter=[l.getTagFilterForMedia("Sound"),l.getTagFilterForMedia("Video")];n();break;case"media3d-filter":this._currentRightFilter=l.getTagFilterForMedia("3dModel");n();break;case"document-filter":this._currentRightFilter=l.getTagFilterForMedia("Document");n();break}this._performSearchCall()},showFilters:function(){var n=this.getElement("#media_type_filters");if(n){n.show()}},hideFilters:function(){var n=this.getElement("#media_type_filters");if(n){n.hide()}},_performSearchCall:function(){this._callOptions.data.refineUsingQuery=this._currentLeftFilter;this._callOptions.data.refine=this._currentRightFilter;this._callOptions.data.with_synthesis=true;this.collection.fetchPage(1,this.collection.getFilteringOptions(null,null,this._callOptions));this.dispatchEvent("onActivateInfiniteScroll",[this])}});return b});define("DS/SwymUIComponents/script/feature/community/content/edit/paragraph-formatter",["UWA/Core","UWA/Utils/Client","UWA/Event","DS/SwymUICore/script/lib/view/generic/swym-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/paragraph-formatter"],function(g,f,a,c,e){var d="paragraph-formatter",h=null;var b=c.extend({name:d+"-view",domEvents:{"click .paragraph-formatter-btn":"_onButtonClick"},className:"cke_ltr",defaultOptions:{extraEditor:null},_commandList:{"bulleted-list":{command:"bulletedlist",type:"formatting"},"numbered-list":{command:"numberedlist",type:"formatting"},blockquote:{command:"blockquote",type:"formatting"},outdent:{command:"outdent",type:"action"},indent:{command:"indent",type:"action"},table:{command:"customtable",type:"action"}},_styleList:{h1:"h1",h2:"h2",formatted:"pre"},setup:function(){var i=this._parent.apply(this,arguments),j=this;if(this.getOption("mode")==="popover"){this.setOption("editorView",this.options.extraEditor.getOption("editorView"))}else{if(this.getOption("mode")==="touch"){this.listenTo(this.options.extraEditor,"onSelectionChange",function(k){j.options.extraEditor.setOption("editionTarget",k);j.refresh()});this.setOption("editorView",this.options.extraEditor)}else{this.setOption("editorView",this.options.extraEditor)}}this.setOption("rteView",this.options.editorView.getRTEView());return i},_createContent:function(){var k,m,q=false,o=false,n=false,r=false,l=false,j=false,s=false,p=this.options.rteView,i=p.ckeditor;if(this.options.extraEditor.getOption("editionTarget")){k=this.options.extraEditor.getOption("editionTarget");q=k.match("h1")||k.getParent("h1");o=k.match("h2")||k.getParent("h2");n=k.match("ul")||k.getParent("ul");r=k.match("ol")||k.getParent("ol");l=k.match("blockquote")||k.getParent("blockquote");j=k.match("pre")||k.getParent("pre");s=k.match("table")||k.getParent("table");i.selectionChange()}m=[{"class":"paragraph-formatter-btn"+(q?" selected":""),"data-name":"h1",title:e.Heading1,html:{"class":"fonticon fonticon-text-h1"}},{"class":"paragraph-formatter-btn"+(o?" selected":""),"data-name":"h2",title:e.Heading2,html:{"class":"fonticon fonticon-text-h2"}},{"class":"paragraph-formatter-btn"+(n?" selected":""),"data-name":"bulleted-list",title:e.InsertRemoveBulletedList,html:{"class":"fonticon fonticon-list"}},{"class":"paragraph-formatter-btn"+(r?" selected":""),"data-name":"numbered-list",title:e.InsertRemoveNumberedList,html:{"class":"fonticon fonticon-list-ordered"}},{"class":"paragraph-formatter-btn"+(l?" selected":""),"data-name":"blockquote",title:e.BlockQuote,html:{"class":"fonticon fonticon-text-quote"}},{"class":"paragraph-formatter-btn"+(j?" selected":""),"data-name":"formatted",title:e.Formatted,html:{"class":"fonticon fonticon-code"}},{"class":"paragraph-formatter-btn","data-name":"outdent",title:e.DecreaseIndent,html:{"class":"fonticon fonticon-indentation-decrease"}},{"class":"paragraph-formatter-btn","data-name":"indent",title:e.IncreaseIndent,html:{"class":"fonticon fonticon-indentation-increase "}},{"class":"paragraph-formatter-btn"+(s?" selected":""),"data-name":"table",title:e.Table,html:{"class":"fonticon fonticon-table"}}];return m},_applyStyle:function(k){if(this.options){var s,r,j,l=this,o=this.container.getChildren(),p=this.options.rteView,i=p.ckeditor,q=k.getAttribute("data-name"),n=false,m={localName:"p"};if(!this.haveParagraphCommandsBeenOverridden){i.getCommand("bulletedlist").editorFocus=false;i.getCommand("numberedlist").editorFocus=false;i.getCommand("blockquote").editorFocus=false;this.haveParagraphCommandsBeenOverridden=true}if(this._styleList.hasOwnProperty(q)||this._commandList.hasOwnProperty(q)&&this._commandList[q].type!=="action"){for(r in o){if(o.hasOwnProperty(r)&&o[r].hasClassName("selected")){j=o[r].getAttribute("data-name");o[r].removeClassName("selected");if(q===j&&j!=="table"){n=true}if(this._styleList.hasOwnProperty(j)){i.removeStyle(new h.style({element:this._styleList[j]}));p.updatePlaceHolderVisibility();if(f.Engine.ie){i.focus()}}else{if(this._commandList.hasOwnProperty(j)&&this._commandList[j].type==="formatting"){i.execCommand(this._commandList[j].command)}}}}}if(!n&&g.is(q)){if(this._styleList.hasOwnProperty(q)){i.applyStyle(new h.style({element:this._styleList[q]}));p.updatePlaceHolderVisibility();if(f.Engine.ie){i.focus()}m.localName=this._styleList[q]}else{if(this._commandList.hasOwnProperty(q)){i.execCommand(this._commandList[q].command);if(this._commandList[q].type==="formatting"){m.localName=this._commandList[q].command}}}if(["indent","outdent"].indexOf(k.dataset.name)===-1){k.toggleClassName("selected");if(this.getOption("mode")==="popover"){this.options.extraEditor.updateIcon(m)}}}else{if(this.getOption("mode")==="popover"){this.options.extraEditor.updateIcon(m)}}setTimeout(function(){l.dispatchEvent("onApplyStyle")},50)}},_onButtonClick:function(l){var k=this,i=a.getElement(l);if(!i.hasClassName("paragraph-formatter-btn")){i=i.getParent(".paragraph-formatter-btn")}function j(){k._applyStyle(i);if(k.options.editorView){k.options.editorView.dispatchEvent("onContentChange")}}if(!h){require(["DS/SwymUIComponents/script/lib/ckeditor/ckeditor"],function(m){h=m.CKEditor;j()})}else{j()}}});return b});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils",["UWA/Core"],function(b){var a={convertURLPreviewToLink:function(l,q){var u=0,j=1,f=2,c=3;var n;if(q===false){n=b.createElement("div",{html:l})}else{n=l}var e,m,t,d,w;var k=0;var x=n.getElements(".external-rich-link-preview");var r=n.getElements(".rich-link-embedded-preview");var g=n.getElements(".rich-link-internal-preview");for(var s=0;s<x.length;s++){var p=x[s];k=0;t=p.getElement(".preview-thumbnail");if(t!=null){t=p.getElement(".preview-thumbnail").src}else{t="null"}e=p.getElement(".preview-title").getText();m=p.getElement(".preview-description").getText();d=p.getElement(".preview-container").dataset.url;t=t.replace(/^http:\/\//i,"https://");if(t.contains("null")){t=null}if(t!=null){if(p.getElement(".preview-thumbnail").hasClassName("preview-thumbnail-hidden")){k=j}}if(p.getElement(".preview-description").hasClassName("preview-desc-is-hidden")){if(k===j){k=c}else{k=f}}var h=document.createElement("a");h.className="preview-link";h.href=d;h.setAttribute("data-title",e);h.setAttribute("data-uri",d);h.setAttribute("data-desc",m);h.setAttribute("data-img",t);h.setAttribute("data-prefs",k);h.innerHTML="&nbsp;";p.outerHTML=h.outerHTML}for(var s=0;s<r.length;s++){var o=r[s];t="";e="";k="";m="embedded-youtube-video";d=o.children[0].dataset.url;var h=document.createElement("a");h.className="preview-link";h.href=d;h.setAttribute("data-uri",d);h.innerHTML="&nbsp;";o.outerHTML=h.outerHTML}for(var s=0;s<g.length;s++){var v=g[s];t="";e="";k=0;m="internal-content";d=v.children[0].dataset.url;if(v.getElement(".preview-thumbnail").hasClassName("preview-thumbnail-hidden")){k=j}if(v.getElement(".preview-description").hasClassName("preview-desc-is-hidden")){if(k===j){k=c}else{k=f}}var h=document.createElement("a");h.className="preview-link";h.href=d;h.setAttribute("data-title","&nbsp;");h.setAttribute("data-uri",d);h.setAttribute("data-desc","&nbsp;");h.setAttribute("data-img","&nbsp;");h.setAttribute("data-prefs",k);h.innerHTML="&nbsp;";v.outerHTML=h.outerHTML}if(q===false){return(n.innerHTML)}else{return(n)}},containsPreview:function(c){if(c instanceof HTMLElement){return Boolean(c.getElement(".rich-link-preview"))}else{throw new Error("Only an HTMLElement is accepted")}},containsYoutubePreview:function(c){if(c instanceof HTMLElement){return Boolean(c.getElement(".rich-link-embedded-preview"))}else{throw new Error("Only an HTMLElement is accepted")}},containsExternalURLPreview:function(c){if(c instanceof HTMLElement){return Boolean(c.getElement(".external-rich-link-preview"))}else{throw new Error("Only an HTMLElement is accepted")}},containsInternalURLPreview:function(c){if(c instanceof HTMLElement){return Boolean(c.getElement(".rich-link-internal-preview"))}else{throw new Error("Only an HTMLElement is accepted")}},containsURLPreview:function(c){if(c instanceof HTMLElement){return Boolean(this.containsExternalURLPreview(c)||this.containsInternalURLPreview(c))}else{throw new Error("Only an HTMLElement is accepted")}},extractLinkData:function(h){var i=h.dataset.title,j=h.dataset.desc,d=h.dataset.img,c=h.href,k=h.dataset.prefs;var e,g;var f=c.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);if(f!=null&&f.length>2&&typeof f[2]==="string"&&f[2].length>0){if(f[2]==="youtube.com"){g="youtube"}else{g="html"}e=f[2]}else{e=null}return{type:g,title:i,description:j,image:d,url:c,domain:e,prefs:k}}};return a});define("DS/SwymUIComponents/script/feature/core/user/view/phone/user-phone-read-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/WebappsUtils/Console"],function(e,d,c,b){var a=d.extend({_modelEventsForAutoRefresh:["onChange"],_modelClass:c,name:"user-phone-read-view",_createContent:function(){return e.createElement("div",{html:this.model.get("tel")})}});return a});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-model",["UWA/Core","UWA/Class/Model"],function(c,b){var a=b.extend({defaults:{type:"",title:"",description:"",image:"",url:"",prefs:""}});return a});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/social-features-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/post/model/post-model","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/community/instant-message/model/instant-message-model","DS/SwymUICore/script/feature/community/instant-comment/model/instant-comment-model"],function(g,e,a,k,i,c,b,j,f,h){var d=e.extend({_modelClass:[a,k,i,c,b,f,h],defaultOptions:{actionBar:true,actionBarViewClass:"DS/SwymUIComponents/script/feature/community/content/social-interactions/action-bar-view",actionBarViewOptions:null,comments:true,commentsViewClass:"DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-collection-view",mainCollectionViewName:"comments",commentsNumberAtInit:undefined},name:"social-features-view",setup:function(l){var m=l.widget||l._widget||window.widget;if(m){this._widget=m}else{throw new Error("No widget instance provided")}this._parent.apply(this,arguments);if(this.getOption("actionBar")===true){this._createActionBar()}if(this.getOption("comments")===true){this._createComments()}},_createComments:function(){var l=this.model.getComments();if(!l.isBeingFetched()&&!l.hasBeenFetched()){if((!this.model.hasBeenFetched()&&j.getInstance().isContentContext())||(parseInt(this.model.get("nb_comments"),10)>0)||(this.getOption("forceCommentFetchIfNotDoneYet")===true)){l.fetch({})}l.setAssociated("commented",this.model)}this.addChildView(this.getOption("mainCollectionViewName"),{collection:l,Class:this.getOption("commentsViewClass"),modelName:this.model.getModelName(),model:this.model,modelViewsToDisplay:this.getOption("commentsNumberAtInit")})},_createActionBar:function(){var l=this,n=this.getOption("actionBarViewOptions")||{},m={onCommentCreatorFocusRequest:m=function(){var o=l.getChildView(l.getOption("mainCollectionViewName"));if(o){o.focusOnCommentCreator()}l.dispatchEvent("onCommentCreatorFocusRequest")}};g.extend(n,{enableLike:false,enableShare:false});n.events=n.events||{};g.extend(n.events,m);this.addChildView("actionBar",g.extend({model:this.model,Class:this.getOption("actionBarViewClass"),modelName:this.model.getModelName(),widget:this._widget,events:m},n))},_createContent:function(){var m=this.getChildView("actionBar"),l=this.getChildView(this.getOption("mainCollectionViewName"));return[m?m:"",l?l:""]}});return d});define("DS/SwymUIComponents/script/feature/community/content/view/content-list-mobile-mixin",["UWA/Core","DS/SwymUICore/script/feature/core/mobile/app-foreground-subscriber-mixin","DS/SwymUICore/script/feature/core/context/context-model"],function(b,c,a){return b.extend({onAppBroughtToForeground:function(){if(this.isInContextToBeRefreshed()){this.refreshList()}},isInContextToBeRefreshed:function(){var e=a.getInstance(),f=e.feedMode,h=(e.isFilterableContentListsContext()&&(f===a.WHATSNEW_MODE))||(e.isHomePageContext()),g=this.container.getClosest(".center-section"),d=e.isInTemporaryState();if(h&&g&&!d){return true}return false},refreshList:function(){this.updateCollection({collectionClass:this.options.collectionClass})}},c)});define("DS/SwymUIComponents/script/feature/core/user/view/summary/user-summary-read-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/user-summary-view","DS/WebappsUtils/Console"],function(e,d,b,c,a){var f=d.extend({_modelEventsForAutoRefresh:["onChange:tenant_more_about_me"],_modelClass:b,name:"user-summary-read-view",setup:function(g){g=g||{};return this._parent.apply(this,arguments)},_createContent:function(){var g=this.model.get("tenant_more_about_me",{breakline:true});var h=e.createElement("div",{html:g});return h}});return f});define("DS/SwymUIComponents/script/feature/core/ui-components/top-back-arrow-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/core/history/history-model"],function(e,a,b,c){var d=a.extend({name:"top-back-arrow-view",className:"maximized community-header-view",domEvents:{"click .back-header-wrapper":"_onClick","click .close-header-button":"_onClick"},_onClick:function(){c.backToListing()},_createContent:function(){var g=e.createElement("div",{"class":"fonticon fonticon-2x fonticon-left-open back-header-button"}),f=e.createElement("div",{"class":"fonticon fonticon-1-5x fonticon-close close-header-button"});return[{"class":"back-header-wrapper",html:[g,{"class":"basic-information",html:[{"class":"title",html:"What's New"}]}]},f]},destroy:function(){return this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/core/ui-components/layout/back-to-top-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/item-list"],function(e,b,c,d){var a=b.extend({name:"back-to-top-view",domEvents:{click:"_goToTop"},defaultOptions:{manager:"DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager"},_createContent:function(){var g="fonticon-up-open-big",f="";if(window.ds&&window.ds.swymIM===true){g="fonticon-move-to-top"}f=e.createElement("div",{"class":"to-top",html:{"class":"fonticon fonticon-2x "+g}});if(this.getOption("manager")){this.addControl("tooltip-go-back-to-top",new c({target:f,body:this.getOption("manager").isScrollReversed?d.GoBackToBottom:d.GoBackToTop}))}return f},_goToTop:function(){var f=this.getOption("manager");if(f instanceof b){f.dispatchEvent("onScrollToTopRequest",[250]);this.hide()}else{require([f],function(g){g.dispatchEvent("onScrollToTopRequest",[250]);this.hide()}.bind(this))}},onRender:function(){this.hide()}});return a});define("DS/SwymUIComponents/script/lib/ckeditor/customtable/plugin",function(){CKEDITOR.plugins.add("customtable",{init:function(a){a.addCommand("customtable",new CKEDITOR.dialogCommand("customtableDialog"));a.ui.addButton("AddCustomTable",{label:"Table Properties",command:"customtable",toolbar:"paragraph",className:"table"});if(a.contextMenu){a.addMenuGroup("abbrGroup");a.addMenuItem("abbrItem",{label:"Table Properties",icon:"table",command:"customtable",group:"abbrGroup"});a.contextMenu.addListener(function(b){if(b.getAscendant("table",true)){return{abbrItem:CKEDITOR.TRISTATE_OFF}}})}CKEDITOR.dialog.add("customtableDialog",this.path+"dialogs/customtable.js");a.element.$.addEvent("touchforcechange",function(b){if(b.changedTouches[0].force===1){a.contextMenu.open(new CKEDITOR.dom.element(b.target))}})}})});define("DS/SwymUIComponents/script/feature/community/content/edit/abstract-content-editor-body-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view"],function(c,b){var a=b.extend({_communityId:null,setCommunityId:function(d){this.setOption("communityId",d)},getCommunityId:function(){return this.getOption("communityId")},_createContent:function(){return{}},contentChanged:function(){this.dispatchEvent("onContentChange")},getContentAttributes:function(){},isContentEmpty:function(){},resetContent:function(){},cleanDndViewEvents:function(){},resetEditorViews:function(){},refreshContent:function(){},getMediaCollectionLength:function(){},getMediaCollection:function(){},uploadMedia:function(){},addMedia:function(){},validateContent:function(){var d=true;if(this.isContentEmpty()){d=false}return d}});return a});define("DS/SwymUIComponents/script/feature/community/media/edit/upload/drag-and-drop-upload-view",["UWA/Core","UWA/Event","UWA/Utils/Client","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/community/media/model/media-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/edit/upload/drag-and-drop-upload-view","DS/Logger/Logger"],function(h,f,e,d,a,g,c){var b=d.extend({name:"drag-n-drop-upload",_dragZoneCounter:0,_dropZoneCounter:0,defaultOptions:{multipleFileUpload:true},domEvents:{"dragover .drop-zone":"_onDropZoneOver","dragenter .drop-zone":"_onDropZoneEnter","dragleave .drop-zone":"_onDropZoneLeave","drop .drop-zone":"_onDropZoneDrop"},init:function(){this._onDragZoneEnterBound=this._onDragZoneEnter.bind(this);this._onDragZoneOverBound=this._onDragZoneOver.bind(this);this._onDragZoneLeaveBound=this._onDragZoneLeave.bind(this);this._onDragZoneDropBound=this._onDragZoneDrop.bind(this);return this._parent.apply(this,arguments)},setup:function(){this._parent.apply(this,arguments)},_createContent:function(){return{tag:"div","class":"drop-zone",html:{tag:"div","class":"drop-zone-text",html:g.DropHere}}},_draggedFile:function(l){var o=l.event||l,n,k,m=o.dataTransfer.types,j=true;if(m){j=false;for(n=0,k=m.length;n<k;n++){if(m[n]==="Files"||m[n]==="text/plain"||m[n]==="Text"){j=true;break}}}return j},_draggedContentFromDragZone:function(j){var i=h.extendElement(f.getElement(j));return(i.match(".being-dragged")||i.getParent(".being-dragged"))},_isCursorTraversingDragDetectionZoneBorders:function(m,k){var i=m.relatedTarget,j,l;if(i){return(!k.contains(i)&&(k!==i))}j=h.extendElement(document.body).getSize();l=k.getBoundingClientRect();return(e.Engine.ie||(m.clientX>=j.width)||(m.clientX<=0)||(m.clientY>=j.height)||(m.clientY<=0)||(l.top<=0)||(l.left<=0)||(l.right>=Math.floor(j.width))||(l.bottom>=Math.floor(j.height)))},_onDragZoneDragStart:function(){h.extendElement(this).addClassName("being-dragged")},_onDragZoneEnter:function(i){var j,k=i.event||i;if(k.stopPropagation){k.stopPropagation()}if(!this._draggedContentFromDragZone(k)){if(k.preventDefault){k.preventDefault()}if(this._draggedFile(i)){j=this.getOption("dragDetectionZone");if(this._dragZoneCounter===0){this.container.addClassName("show-drop-zone")}if(this._isCursorTraversingDragDetectionZoneBorders(k,j)||(this._dragZoneCounter===0)){c.log("====== dragenter ========",j);this._dragZoneCounter++}}}},_onDragZoneLeave:function(i){var j,k=i.event||i;if(!this._draggedContentFromDragZone(k)){j=this.getOption("dragDetectionZone");if(k.preventDefault){k.preventDefault()}if(this._isCursorTraversingDragDetectionZoneBorders(k,j)){c.log("====== dragleave ========",j);this._dragZoneCounter--}if(this._dragZoneCounter<=0){this.container.removeClassName("show-drop-zone");this._dragZoneCounter=0}}},_onDragZoneOver:function(i){var j=i.event||i;if(j.stopPropagation){j.stopPropagation()}if(!this._draggedContentFromDragZone(j)){if(j.preventDefault){j.preventDefault()}j.dataTransfer.dropEffect="none";return false}},_onDragZoneDragEnd:function(i){h.extendElement(this).removeClassName("being-dragged")},_onDragZoneDrop:function(i){var n=i.event||i,j=true,l=n.dataTransfer.files,k=JSON.parse(n.dataTransfer.getData("text")||"{}");if(!this._draggedContentFromDragZone(n)){this._dragZoneCounter=0;if(this.container.hasClassName("show-drop-zone")){this.container.removeClassName("show-drop-zone");n.preventDefault();j=false}if(l.length===0&&k.protocol==="3DXContent"){var m=k.data&&k.data.items[0];if(m&&m.objectType!=="text/directory"){l=[];l.push(new a(m));this.dispatchEvent("on3DDriveMediaSelected",[l])}}else{this.dispatchEvent("onFilesSelected",[l])}}return j},_onDropZoneEnter:function(i){var j=i.event||i;if(!this._draggedContentFromDragZone(j)){if(j.preventDefault){j.preventDefault()}if(this._dropZoneCounter===0){this.container.addClassName("highlight-drop-zone")}this._dropZoneCounter++}},_onDropZoneLeave:function(i){var j=i.event||i;if(!this._draggedContentFromDragZone(j)){if(j.preventDefault){j.preventDefault()}this._dropZoneCounter--;if(this._dropZoneCounter<=0){this.container.removeClassName("highlight-drop-zone")}}},_onDropZoneOver:function(i){var j=i.event||i;if(j.stopPropagation){j.stopPropagation()}if(!this._draggedContentFromDragZone(j)){if(j.preventDefault){j.preventDefault()}j.dataTransfer.dropEffect="copy";return false}},_onDropZoneDrop:function(i){var k=i.event||i,j=k.dataTransfer.files;if(!this._draggedContentFromDragZone(k)){this._dropZoneCounter=0;if(this.container.hasClassName("highlight-drop-zone")){this.container.removeClassName("highlight-drop-zone")}}},addDragDetectionZone:function(i){if(i&&(i instanceof HTMLElement)&&(this.getOption("dragDetectionZone")!==i)){this.setOption("dragDetectionZone",i);i.addEvents({dragstart:this._onDragZoneDragStart,dragenter:this._onDragZoneEnterBound,dragover:this._onDragZoneOverBound,dragleave:this._onDragZoneLeaveBound,dragend:this._onDragZoneDragEnd,drop:this._onDragZoneDropBound})}},onDestroy:function(){var i;if((i=this.getOption("dragDetectionZone"))&&(i instanceof HTMLElement)){i.removeEvents({dragstart:this._onDragZoneDragStart,dragenter:this._onDragZoneEnterBound,dragover:this._onDragZoneOverBound,dragleave:this._onDragZoneLeaveBound,dragend:this._onDragZoneDragEnd,drop:this._onDragZoneDropBound});this.setOption("dragDetectionZone",null)}}});return b});define("DS/SwymUIComponents/script/feature/core/search/view/bot-search-factory",["UWA/Core","UWA/Class","DS/UIKIT/Autocomplete","DS/SwymUICore/script/feature/core/command/commands-controller","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/user-search-view","DS/WebappsUtils/Console","UWA/Class/Promise"],function(h,c,d,g,f,b,e){var a=c.extend({_defaultValue:null,_label:"",_events:{},_disabled:false,_getConfiguration:function(){var i=this;return{filterEngine:function(k,j){return j},templateEngine:function(l,m,j){var k=h.createElement("div",{html:[{"class":"bot-search-result-container",html:[{tag:"img",src:j.appIconURL},{"class":"bot-search-second-column",html:[{"class":"app-title",html:j.label},{"class":"bot-description",html:j.desc}]}]}]});l.addClassName("default-template bot-search-template");l.setHTML(k.getHTML())},remoteSearchEngine:function(m,o,p){var j={},l=i,k,n;o=o?o.toLowerCase():"";n=new e(function(q){j.dataset=m;j.matchingItems=[];g._getCommands(function(s,r){g.executeWhenNlsIsReady(function(){r.forEach(function(u){var t=g.getNlsValue(u.appId,u.desc);if(u.appName.toLowerCase().indexOf(o)>-1||(t&&t.toLowerCase().indexOf(o)>-1)){j.matchingItems.push({label:u.appName,value:u.botUsername||u.appName,desc:t,appIconURL:u.appIconURL})}});q(j)})})});return n}}},_setupConfig:function(i){var j=this;if(i){if(h.is(i.label)){j._label=i.label}if(h.is(i.defaultValue)){j._defaultValue=i.defaultValue}if(h.is(i.events)){j._events=i.events}if(h.is(i.disabled)){j._disabled=i.disabled}}},_getEvents:function(){var k=this,i=k._events,n=i.onSelect,l=i.onUnselect,j=i.onInjected,m=i.onFocus;i.onInjected=function(){if(k._defaultValue&&k.injected!==true){k.configuration.remoteSearchEngine(k,k._defaultValue,function(o){if(o&&o.hasOwnProperty(0)){this.onSelect(o[0])}else{this.dispatchEvent("onNoResults",k,k._defaultValue)}}.bind(this));k.injected=true}if(j){j.apply(this,arguments)}};i.onSelect=function(){this.onClickOutside();if(n){n.apply(this,arguments)}};i.onUnselect=function(){if(l){l.apply(this,arguments)}};return i},_getAutocompleteOptions:function(){this.configuration=this._getConfiguration();return{required:true,datasets:[{configuration:this.configuration}],disabled:this._disabled,typeDelayBeforeSearch:300,minLengthBeforeSearch:1,placeholder:f.SearchForBots,label:this._label,multiSelect:true,events:this._getEvents()}}});return{Factory:a,getFormConfig:function(j){var k=this.Factory,i=new k();i._setupConfig(j);return h.extend({type:"autocomplete",name:"search-bot-autocomplete"},i._getAutocompleteOptions())},createBotSearchControl:function(j){var k=this.Factory,i=new k();i._setupConfig(j);return new d(i._getAutocompleteOptions())}}});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-stats-view",["DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/date"],function(c,b){var a=c.extend({_modelEventsForAutoRefresh:["onChange"],_createContent:function(){var d=this.model;if(d){var e=[{tag:"td",html:d.get("title")},{tag:"td",html:d.get("nb_voters")},{tag:"td",html:b.simpleDate(d.get("start_date"),"en")},{tag:"td",html:b.simpleDate(d.get("end_date"),"en")}];return e}}});return a});define("DS/SwymUIComponents/script/feature/core/tenant/view/users-management-processes-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/users-management-processes-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Input/Button","DS/UWPClientCode/I18n"],function(f,d,e,a,c){var b=e.extend({_modelEventsForAutoRefresh:["onChange"],asAdmin:false,_createContent:function(){var k=this.model;if(k){var l="",o=Number(this.batchIds.ADD_TO_COMMUNITIES),i=Number(this.batchIds.REMOVE_FROM_COMMUNITIES),j=Number(this.batchIds.CREATE_NEW_USERS),m=Number(this.batchIds.CHANGE_USER_STATUS);switch(Number(k.get("process"))){case o:l=d.adduserstocommunity;break;case j:l=d.importnewusers;break;case i:l=d.removeusersfromcommunity;break;case m:l=d.changeuserstatus;break;default:l="";break}var h="";switch(Number(k.get("type"))){case 1:h="<b>"+d.waiting+"</b>";break;case 2:h="<b>"+d.running+"</b>";break;case 3:h="<b>"+d.completed+"</b>";break;default:h="--";break}var g="";if(Number(k.get("type"))==3){if(k.get("details")){g=c.replace(d.nofnsuccessful,{num1:k.get("details")[0],num2:k.get("details")[1]})}}else{if(Number(k.get("type"))==1){if(k.get("rank")){g=c.replace(d.positioninqueue,{num:k.get("rank")})}}}var n=[{tag:"td",html:k.get("processName")},{tag:"td",html:l},{tag:"td",html:h},{tag:"td",html:g},{tag:"td",html:(Number(k.get("type"))==3?new a({value:d.Delete,className:"link",events:{onClick:function(){var s=0;var r=Number(this.batchIds.ADD_TO_COMMUNITIES),p=Number(this.batchIds.REMOVE_FROM_COMMUNITIES),q=Number(this.batchIds.CREATE_NEW_USERS),t=Number(this.batchIds.CHANGE_USER_STATUS);switch(Number(this.model.get("process"))){case r:s=1;break;case q:s=2;break;case p:s=1;break;case t:s=2;break;default:s=0;break}this.model.deleteProcess({data:{asAdmin:this.asAdmin,processType:s},onComplete:function(){this.model.dispatchEvent("onProcessDeleted")}.bind(this),onFailure:function(){alert("failure delete")}})}.bind(this)}}):"")}];return n}}});return b});define("DS/SwymUIComponents/script/feature/core/user/view/user-picture-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/img-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUICore/script/utils/utils","DS/WebappsUtils/Console"],function(f,a,g,c,e,b){var d=a.extend({_modelEventsForAutoRefresh:["onChange:user_picture_fingerprint"],_imageRenderingOptions:null,_modelClass:g,name:"user-picture-view",defaultOptions:{displayPresence:true},_createContent:function(){var h=c.renderUserPicture(f.merge({login:this.model.get("login"),hash_key:this.model.get("hash_key"),imageUpdateTime:this.model.get("picture_update"),imageFingerprint:this.model.get("user_picture_fingerprint")},this._imageRenderingOptions||{}));if(h instanceof HTMLElement){this.elements.image=h}return h},init:function(){this._refresh=e.getDelayedSyncTask(a.prototype._refresh);return this._parent.apply(this,arguments)},onRedraw:function(){console.log("user picture rendered");if(this.getOption("displayPresence")===true){require(["DS/RTUserPresenceAPI/RTUserPresenceAPI","DS/SwymUICore/script/feature/core/config/bootstrap-model"],function(i,k){var h=k.getInstance(),j=h.get("config").tenant;if(this.model){this._userPresenceView=new i({size:"40px",login:this.model.get("login"),tenantId:j.id,noAvatar:true,username:"",swymUrl:e.getBaseUrl()});this._userPresenceView.render().inject(this.container)}}.bind(this))}},setup:function(i){var h=null;if(i){if(i.hash_key){h=f.merge({model:new g({hash_key:i.hash_key,nickname:(i.nickname?i.nickname:null)})},i)}else{h=i}}return this._parent.call(this,h)},destroy:function(){try{if(this._userPresenceView){if(typeof(this._userPresenceView.destroy)==="function"){this._userPresenceView.destroy()}this._userPresenceView=null}}catch(h){}return this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/community/media/view/small-media-list-view",["UWA/Core","UWA/Event","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUICore/script/feature/core/context/context-model"],function(e,j,c,g,a,h){var d=false,i="...";var f=g.extend({_delegateSpriteReloadToParentView:false,_createContent:function(){var k=this.model;return[a.renderMediaThumbnail(e.merge({mediaType:k.get("media_type"),imageUpdateTime:k.get("update"),imageFingerprint:k.get("preview_fingerprint"),modelId:k.get("mid"),modelName:k.getModelName(),title:k.get("title",{escapeHTML:false})},e.merge(this._imageRenderingOptions||{},this.imageReloadOptions))),{"class":"more-item",html:(d?(this._parentView.collection._totalItems>this._parentView.collection.length?"+"+(this._parentView.collection._totalItems-(this._parentView.collection.length-1)):i):i)}]}});var b=c.extend({name:"small-media-list",modelViewClass:f,domEvents:{"click img":"onItemClick"},onItemClick:function(n){var m=h.getInstance(),l=j.getElement(n),o=l.getAttribute("data-content-id"),k=l.getAttribute("data-content-type");if(o){m.set({contentId:o,contentType:k})}}});return b});define("DS/SwymUIComponents/script/feature/core/link/view/link-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-view","DS/SwymUICore/script/feature/core/link/model/link-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/link/view/link-read-view","DS/SwymUIComponents/script/feature/core/link/view/link-edit-view","DS/SwymUIComponents/script/feature/core/link/view/account-link-edit-view","DS/SwymUIComponents/script/feature/core/link/view/account-link-read-view","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/WebappsUtils/Console"],function(i,e,l,g,c,d,m,f,j,h,a,b){var k=g.extend({_modelClass:l,name:"link-view",_createContent:function(){if(this.model.isSocialLink()){this.container.addClassName("is-social-link")}var q=h.isFeatureActivated("activateAccount"),p=q?new j({model:this.model,widget:this.widget}):new d({model:this.model,widget:this.widget}),n=q?new f({model:this.model,widget:this.widget}):new m({model:this.model,widget:this.widget}),o=i.createElement("div",{html:this.addChildView("edition-switch",{Class:c,model:this.model,editView:n,readView:p,actionOnSave:function(r){var s=this.getChildView("edition-switch").getChildView("editview").getControl("form-aboutme"),t=s.validate();if(this.model.isSocialLink()){this.container.addClassName("is-social-link")}else{this.container.removeClassName("is-social-link")}if(r===true){return t}if(t){this.model.save({},{onComplete:function(v,u){this.alert("success",e.linkUpdated);v.set(v.getChanges());var w=this.getChildView("edition-switch");if(w){w.setMode("read")}}.bind(this),onFailure:function(v,u){console.log("error")}})}else{this.alert("error",e.pleaseFillTheFieldsCorrectly);return t}}.bind(this),actionOnDestroy:function(){var r=new a({closable:true,renderTo:document.body});r.confirm(e.deletewarningLink,e.deletequestionLink,function(s){if(s===true){if(this.model.isNew()===false){this.model.destroy({onComplete:function(){this.alert("success",e.linkdeletedsuccess)}.bind(this),onFailure:function(){this.alert("error",e.YourchangescouldnotbesavedPleasetryagainlater)}.bind(this)})}else{var t=this.getChildView("edition-switch");if(t){t.onCancelClick()}}}}.bind(this))}.bind(this)})});return o}});return k});define("DS/SwymUIComponents/script/feature/community/content/view/community-contributions-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/community-contributions-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/lib/collection/mixed-collection","DS/SwymUICore/script/feature/core/direct-message/model/direct-message-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/utils/utils","DS/UIKIT/Input/Button","DS/SwymUICore/script/lib/model/model-manager","DS/UIKIT/DropdownMenu"],function(j,e,f,n,c,l,k,o,b,i,h,g,a){var m=null;if(window.ds&&(ds.env==="3DD")){require(["DS/SwymUIComponents/script/utils/dnd-utils"],function(p){m=p})}var d=f.extend({_collectionClass:n,_collectionEvents:{onSync:"unmask",onError:"unmask","onChange:published":"updateModelState",onRequest:"mask"},_addScroller:false,_state:"max",_displayActions:true,_displayTitle:true,_superModal:null,_selectedModelType:null,_selectedModelId:null,name:"community-contributions-view",attributes:{styles:{padding:"0 20px"}},updateModelState:function(p){if(p.has("published")&&(parseInt(p.get("published"),10)===1)){p.set("state","published")}},onContributionEdit:function(p){b.goToContent(p.get("mid"),p.getModelName(),p.get("community").id,true,undefined,undefined,Boolean(l.getInstance().isDirectMessageContext()))},_buildDropDownMenu:function(s,r){var q=this.getControl("dropDownMenu-"+r.get("mid")),p;if(!q){q=this.addControl("dropDownMenu"+r.get("mid"),new a({className:"my-contributions-item-dropdown-menu",target:s,renderTo:window.document.body.getElement(".scroll-content"),items:[{name:"edit",text:e.Edit,fonticon:"pencil"},{name:"delete",text:e.Delete,fonticon:"trash"}],events:{onClick:function(u,t){switch(t.name){case"edit":this.onContributionEdit(r);break;case"delete":this.onContributionDelete(r);break}}.bind(this)}}))}q.show()},_onContributionDownOpenClick:function(p,q){this._buildDropDownMenu(q.target,p)},onContributionLinkClick:function(p){var s,r=false,t=p.get("mid"),q=p.getModelName();if((p.get("published")==="0")||(p.get("state").toLowerCase()==="draft")){r=true}this.dispatchEvent("onItemViewSelect",[p,r]);s=p.getRelativePath();b.goToContent(t,q,p.get("community->mid"),r,undefined,undefined,Boolean(l.getInstance().isDirectMessageContext()))},onContributionDelete:function(p){var q=this;require(["DS/SwymUIComponents/script/feature/core/modal/super-modal"],function(r){var s=new r({closable:true,renderTo:q._widget.body}),t=q.collection;s.confirm(e.Areyousureyouwanttodelete,e.Confirm,function(u){if(u===true){q.mask();p.deleteContribution({onComplete:function(){this.alert("success",e.Thiscontributionwassuccessfullydeleted);this.unmask();t.fetchPage(t._currentPage)}.bind(q),onFailure:function(){this.alert("error",e.AnerrorhasoccurredPleasetryagainlater);this.unmask()}.bind(q)})}}.bind(q))})},onContributionDrag:function(p){m.onItemDrag(this.model,p,this.view._widget)},setSelectedModel:function(p){if(p){this._selectedModelId=p.get("mid");this._selectedModelType=p.getModelName()}},getSelectedModelType:function(){return this._selectedModelType},getSelectedModelId:function(){return this._selectedModelId},selectItemView:function(p){var t=p.get("mid"),q=p.getModelName(),s=this.container.getElement('[data-model-id="'+this.getSelectedModelId()+'"][data-model-type="'+this.getSelectedModelType()+'"]'),r=this.container.getElement('[data-model-id="'+t+'"][data-model-type="'+q+'"]');if(s&&s.hasClassName("selected")){s.removeClassName("selected")}if(r&&!r.hasClassName("selected")){r.addClassName("selected")}this.setSelectedModel(p)},_createContent:function(){var r,s,w,B,q,x,y=false,z=false,C=null,t,A,p=this._state,v=this.collection,u=v.first();if(v){if(!C&&v.length>0){C=u.getCommunity();if(C.isDirectMessage()){C=new c(C.toJSON())}if(C.hasBeenFetched()===false){this.listenToOnce(C,"onSync:read",this.refresh)}else{q=C.getCommunityFeaturesAccess()}}if(q){r=j.createElement("table",{"class":"table table-hover"});v.forEach(function(D){y=false;switch(D.getModelName()){case"post":y=true;break;case"media":y=true;break;case"survey":y=q.survey_feature;break;case"iquestion":y=q.qna_feature;break;case"idea":y=q.ideation_feature;break;case"wiki":y=q.wiki_feature;break}B=r.insertRow(-1);var G=D.get("mid"),F=D.getModelName();B.dataset.modelId=G;B.dataset.modelType=F;if((p!=="max")&&(this.getSelectedModelType()===F)&&(this.getSelectedModelId()===G)){B.setAttribute("class","selected")}z=D.get("state").toLowerCase()==="published";x=j.createElement("div",{"class":"contrib-desc-container"+(y?"":" disabled"),html:[{tag:"span","class":"fonticon fonticon-2x fonticon-"+i.getIconFromModel(D)+" content-icon "+F,styles:{"float":"left","margin-right":"10px"}},{html:'<a onclick="return false;" href="'+D.getRelativePath()+'">'+(z?"":'<span class="draft-label">'+e.Draft.toUpperCase()+"</span>")+(D.get("title")?D.get("title"):("<i>"+e.NoTitleYet+"</i>"))+"</a>"}],events:y?{click:this.onContributionLinkClick.bind(this,D)}:{}});if(window.ds&&(ds.env==="3DD")){x.addEventListener("dragstart",this.onContributionDrag.bind({view:this,model:D}));x.setAttribute("draggable","true")}if(y===false){x.set("title",e.Thiscommunityfeatureiscurrentlydisabled)}B.insertCell(-1).appendChild(x);if(p==="max"){var E=z?"":'style="color:#E87B00"';B.insertCell(-1).innerHTML='<div class="td-body"'+E+">"+(z?k.prettyDate(D.get("time")):e.Draft.toUpperCase())+"</div>";if(this._displayActions===true){t=j.createElement("div",{"class":"contrib-actions td-body",html:[{tag:"span","class":"contrib-down-open"+(y?"":" disabled"),html:{tag:"span","class":"fonticon fonticon-1-5x fonticon-down-open"},events:y?{click:this._onContributionDownOpenClick.bind(this,D)}:{}},{tag:"span","class":"contrib-edit-action"+(y?"":" disabled"),html:{tag:"span","class":"fonticon fonticon-1-5x fonticon-pencil"},events:y?{click:this.onContributionEdit.bind(this,D)}:{}},{tag:"span","class":"contrib-delete-action"+(y?"":" disabled"),html:{tag:"span","class":"fonticon fonticon-1-5x fonticon-trash"},events:y?{click:this.onContributionDelete.bind(this,D)}:{}}]});B.insertCell(-1).appendChild(t)}}else{if(this._displayActions===true){t=j.createElement("div",{"class":"contrib-actions",html:[{tag:"span","class":"contrib-edit-action"+(y?"":" disabled"),html:{tag:"span","class":"fonticon fonticon-1-5x fonticon-pencil"},events:y?{click:this.onContributionEdit.bind(this,D)}:{}}]});B.insertCell(-1).appendChild(t)}}if(t&&(y===false)){t.set("title",e.Thiscommunityfeatureiscurrentlydisabled)}}.bind(this));A={html:[{tag:"div","class":"table-responsive",html:r},(p==="max")?this.addChildView("pagingToolbar",new o({collection:v})):{}]}}else{if(v.hasBeenFetched()&&v.length===0){A={"class":"dsi-noresult",styles:{margin:"10% 0","text-align":"center",width:"100%"},html:[{"class":"fonticon fonticon-5x fonticon-feather"},{html:(Boolean(l.getInstance().isDirectMessageContext())?e.get("Itseemsyoudidnotpublishanycontentinthisconversationyet"):e.Itseemsyoudidnotpublishanycontentinthiscommunityyet)},new h({value:e.StartNow,className:"link",events:{onClick:function(){var D,E=this;require(["DS/SwymUICore/script/feature/core/context/context-model"],function(G){var F=G.getInstance();if(F.isDirectMessageContext()){D={communityId:E.collection.communityId,dmId:F.dmId}}else{D={communityId:E.collection.communityId}}F.reset(D)})}.bind(this)}})]}}}}return{"class":"community-contrib-wrapper",styles:{"min-height":"50px"},html:[(this._displayTitle?{tag:"h4","class":"",html:e.MyContributions}:""),A]}},onPositionChange:function(p,q){switch(q){case"left":this.minimize();break;case"right":this.maximize();break;default:this.maximize();break}},minimize:function(){this._state="min";this.refresh()},maximize:function(){this._state="max";this.refresh()},getModelType:function(p){var q="";switch(p){case"post":q=e.Post;break;case"media":q=e.Media;break;case"iquestion":q=e.iQuestion;break;case"idea":q=e.Idea;break;case"wiki":q=e.Wiki;break;case"survey":q=e.Survey;break}return q},onPublishing:function(q){var p=false,r=false;if(this.collection&&q){if(this.collection instanceof n||q instanceof this.collection.model){p=true}if(this.collection.communityId){if(q.get("community->mid")===this.collection.communityId){r=true}}else{r=true}}if(p===true&&r===true){this.collection.resetCollection("1")}},setup:function(p){if(p){this.mode=p.mode;if(j.is(p.displayTitle)){this._displayTitle=p.displayTitle}if(j.is(p.addScroller)){this._addScroller=p.addScroller}}this._parent.apply(this,arguments);g.addListenerOnPublishing(this.onPublishing.bind(this));g.addListenerOnDraftCreation(this.onPublishing.bind(this));return this},destroy:function(){g.removeListenerOnPublishing(this.onPublishing.bind(this));g.removeListenerOnDraftCreation(this.onPublishing.bind(this));this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/community/content/view/action-menu-view",["UWA/Core","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/event-manager","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/lib/model/generic/community-content","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/community/community/collection/community-collection","DS/UIKIT/DropdownMenu","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Tooltip","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/SwymUICore/script/utils/navigation","DS/Bookmark/script/BookmarkManager","UWA/Promise","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/content-title-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-detailed-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/tenant-media-processes-view","DS/SwymUICore/script/utils/usage-tracker"],function(b,g,v,c,q,t,x,f,n,i,o,s,d,u,p,m,l,e,h,k,w,j,a,r){var y=c.extend({name:"action-menu-view",_modelClass:x,_actionMenu:null,_isModelFetched:false,_convertLayerView:null,_convertLayer:null,_limit:10,_isBookmarked:false,_bookmark:null,defaultOptions:{ReportAbuse:true,Edit:true,Delete:true,ConvertToIdea:true,FollowUnfollow:true,BookmarkUnbookmark:true,LeaveCommunity:true,RssFeed:true,pinToThisTab:true,Subscribe:true},setup:function(z){this._bootstrapModel=t.getInstance();this._parent(z)},_reportAbuse:function(){var z=this;require(["DS/SwymUIComponents/script/feature/community/report-abuse/view/report-new-abuse-view","DS/SwymUICore/script/feature/community/report-abuse/model/report-abuse-model-v2"],function(C,B){var D=z.addChildView("reportNewAbuseView",new C({model:new B(),reportedModel:z.model})),A=(window.document||z._widget);D.render(A.body).show()})},_createContent:function(){var A=this,B=b.createElement("div",{"class":"content-available-actions",html:{tag:"span","class":"fonticon fonticon-2x fonticon-down-open"}}),z=B.getElement(".fonticon-down-open");if(z){this.addControl("MenuTooltip",new u({target:z,body:k.Menu}))}A._actionMenu=A.addControl("dropdownMenu",new o({target:B,position:"bottom left",items:[{name:"loading",text:k.Loading}],className:"contextual-actions",events:{onShow:A._onActionsMenuShow.bind(A)}}));return B},_onActionsMenuShow:function(){var C=this,B=[],A,z=f.getInstance();new h(function(E,D){A=i.prototype.getBlacklistedCommunitiesCollection(C._onActionsMenuShowFetchModels.bind(C,E,D));if(A.hasBeenFetched()){C._onActionsMenuShowFetchModels(E,D)}}).then(function(){B.push(new h(function(G,F){e.isContentBookmarked(C.model.get("subject6wuri"),function(H){if(H){if(H.hasOwnProperty("message")){C.model.deleteCustomProperty("bookmark")}else{C.model.setCustomProperty("bookmark",H);C._isBookmarked=true;C._bookmark=H}}else{C.model.setCustomProperty("bookmark",false);C._isBookmarked=false}G()})}));if((C.model.getModelName()==="media")&&!z.hasBeenFetched()){B.push(new h(function(F){f.getInstanceFetched(function(){F()})}))}if(C.getOption("Subscribe")&&g.isFeatureActivated("activateSubscribe")&&C.model.getCustomProperty("currentUserSubscribed")===undefined){B.push(new h(function(G){var F={onComplete:G,onFailure:G};C.model.hasCurrentUserSubscribed(F)}))}if(B.length>0){h.all(B).then(function E(){C._buildActionsMenu()},function D(){console.log("Promises failed",arguments)})}})},_onActionsMenuShowFetchModels:function(E){var D=this,B=this._isModelFetched,z=this.model,C=this,A=false;if(!B){var F=D._actionMenu;if(z.hasBeenFetched()){A=true}z.fetch({fromCache:A,onComplete:function(){if(!C.isDestroyed()){F.removeItem(1);E();C._isModelFetched=true}}})}else{E()}},_onSubscribeToggleItemClick:function(){this.model.getCustomProperty("currentUserSubscribed")?this.model.unsubscribe():this.model.subscribe()},_addCommonActions:function(F,B,A,E){var D=this,C=!q.getInstance().isDirectMessageContext(),z=(this._widget&&this._widget.getAppName&&this._widget.getAppName()===g.getProfileAppKey());if(D.getOption("Bookmark")!==false&&g.isFeatureActivated("activateBookmarks")&&this.model.getCustomProperty("bookmark")!==undefined){F.addItem({name:"bookmark-toggle",className:"bookmark-toggle",text:D._isBookmarked?j.RemoveFromBookmarks:j.Bookmark,fonticon:D._isBookmarked?"bookmark-delete":"bookmark-add",handler:D._onBookmarkToggleItemClick.bind(D)})}if(this.getOption("Subscribe")&&g.isFeatureActivated("activateSubscribe")&&this.model.getAuthor().get("hash_key")!==this._bootstrapModel.get("user").hash_key&&this.model.getCustomProperty("currentUserSubscribed")!==undefined){F.addItem({name:"subscribe",className:"subscribe-toggle",text:this.model.getCustomProperty("currentUserSubscribed")?j.UnsubscribeToActivities:j.SubscribeToActivities,fonticon:"bell-alt",handler:D._onSubscribeToggleItemClick.bind(D)})}if((A!=="survey")&&(this.getOption("ConvertToIdea")!==false)&&C&&!z){F.addItem({name:"convertToIdea",className:"convertToIdea",text:k.ConvertToIdea,fonticon:"lamp",handler:this._onConvertToIdeaItemClick.bind(this)})}var G=(E.get("highlighted_content_uri")===B.get("subject6wuri"));if(!G&&C&&E.getUserRole()>2&&g.isFeatureActivated("activateContentHighlight")){F.addItem({name:"highlight-item",className:"highlight-item",text:k.Highlight,fonticon:"megaphone",handler:D._onHighlightItemClick.bind(D)})}if((A!=="survey")&&this.getOption("RssFeed")!==false&&this._bootstrapModel.isFeatureActivated("active_rss")&&C){F.addItem({name:"rssfeed-toggle",className:"rssfeed-toggle",text:j.SubscribeToRSSFeed,fonticon:"rss",handler:this._subscribeToRssFeed.bind(this,[E])})}if(this.getOption("ReportAbuse")!==false&&this._bootstrapModel.isFeatureActivated("activate_report_abuse_request")&&B.getAuthor().get("hash_key")!==this._bootstrapModel.get("user").hash_key&&C){F.addItem({name:"reportAbuse",className:"reportAbuse",fonticon:"flag",text:k.ReportAbuse,handler:D._reportAbuse.bind(D)})}if(this.getOption("FollowUnfollow")!==false&&C&&this._bootstrapModel.isFeatureActivated("active_community_blacklist")){F.addItem({name:"follow-toggle",className:"follow-toggle",text:(E.get("isBlacklisted"))?j.Follow:j.Unfollow,fonticon:(E.get("isBlacklisted"))?"eye":"eye-slash",handler:D._onFollowToggleItemClick.bind(D)})}if((E.getDeleteRight()===true)&&(this.getOption("LeaveCommunity")!==false)&&C){F.addItem({name:"leave",className:"leave",text:j.LeaveCommunity,fonticon:"logout",handler:this._onLeaveCommunityClick.bind(this,[E])})}},_addSpecialRightActions:function(F,C,A,D,z){var E=C.get("_acl"),B=true;if(E.update&&E.update.access&&(this.getOption("Edit")!==false)&&(A!=="survey"||(A==="survey"&&!C.hasEnded()))){if(this.model.get("_revisionToDisplay")>=0){F.addItem({name:"recover",className:"recover",text:k.RevertToThisRevision,fonticon:"ccw",handler:this._onEditItemClick.bind(this)})}else{F.addItem({name:"edit",className:"edit",text:k.Edit,fonticon:"pencil",handler:this._onEditItemClick.bind(this)})}}if(E["delete"]&&E["delete"].access===true&&(this.getOption("Delete")!==false)){if(A==="wiki"&&!this._bootstrapModel.isFeatureActivated("activate_wiki_delete")){B=false}if(B){F.addItem({name:"delete",className:"delete",text:k.Delete,fonticon:"trash",handler:this._onDeleteItemClick.bind(this)})}}if(this.getOption("pinToThisTab")!==false&&window.ds&&window.ds.env==="3DD"&&(window.widget&&widget.getAppName()===g.getMyCommunitiesAppKey())){F.addItem({name:"pinToThisTab-toggle",className:"pinToThisTab-toggle",text:j.PinToThisTab,fonticon:"publish",handler:this._pinToThisTab.bind(this,[D])})}if((A==="media")&&this.model.get("reprocessable")===true&&(C.getAuthor().isCurrentUser()||(D.getUserRole()===n.COMMUNITY_OWNER_ROLE)||(z.get("tenant_admin")==="1"))){F.addItem({name:"restartProcessing",text:a.get("Restartprocessing"),fonticon:"refresh",handler:this.model.reprocess.bind(this.model)})}},_buildActionsMenu:function(){var D=this,B=this.model,A=B.getModelName(),z=f.getInstance(),F=B.get("_acl"),C=B.getCommunity(),E=this._actionMenu;if(!F){throw new Error("No acl in the current model!")}while(E.items.length>0){E.removeItem(0)}this._addCommonActions(E,B,A,C);E.addItem({className:"divider"});this._addSpecialRightActions(E,B,A,C,z);if(E.items.length===0){E.options.target.hide()}else{E.options.target.show();E.updatePosition()}require(["DS/SwymUICore/script/utils/localstorage-utils"],function(G){if(G.getItem("enable3DPlayCollab")){E.addItem({className:"divider"});if(D.model.getModelName()==="media"&&D.model.get("media_type")==="3d_model"){E.addItem({name:"collab-toggle",className:"collab-toggle",text:"Start 3DPlay collaboration",fonticon:"users",handler:D._on3DPlayCollabClick.bind(D)})}}})},_on3DPlayCollabClick:function(){var z=this.model;require(["DS/SwymUICore/script/feature/core/direct-message/model/direct-message-model","DS/PlatformAPI/PlatformAPI","DS/SwymUIComponents/script/feature/community/media/view/media-3d-viewer"],function(B,A,C){var D=new B({mid:z.getCommunity().get("mid")});var E=new C({model:z});A.publish("fromswym.im.ds.com",{action:"start3DPlayCollab",data:{mediaTitle:z.get("title"),mediaUrl:z.get3DFileURL(),users:D.get("users"),config3DPlay:{input:E._getInputOptions(),options:E._getOptions(),widget:E._getWidgetParam()}}})})},_onEditItemClick:function(){var z=this.model,B=z.getCommunity(),E=z.get("mid"),D=z.getModelName(),C=B.get("mid"),A=q.getInstance();if(window.ds&&window.ds.env==="3DD"){l.goToContent(E,D,C,true,undefined,undefined,B.get("community_type")==="dm")}else{A.reset({contentId:E,contentType:D,communityId:C,dmId:B.get("community_type")==="dm"?C:undefined,editionMode:true})}},_onDeleteItemClick:function(){var z=this;if(z.model.getModelName()==="wiki"){if(!z.deletionTypeModal){z.addControl("onlyToggle",new p({className:"primary",checked:false,value:w.Onlythispage,name:"deletionType"}));z.deletionTypeModal=z.addControl("deletionTypeModal",new d({header:"<h4>"+w.Doyouwanttodelete+"</h4>",className:"fancy",body:[new p({className:"primary",checked:true,value:w.Thispageanditssubpages,name:"deletionType"}),z.getControl("onlyToggle")],footer:[new m({className:"primary",value:k.Confirm,events:{onClick:function(){z.deletionTypeModal.hide();z._displayConfirmationModal(!z.getControl("onlyToggle").isChecked(),(z.getControl("onlyToggle").isChecked()?w.Areyousureyouwanttodeletethispage:w.Areyousureyouwanttodeletethispageanditssubpages))}}}),new m({value:w.Cancel,events:{onClick:function(){z.deletionTypeModal.hide()}}})],closable:false}))}z.deletionTypeModal.show()}else{z._displayConfirmationModal()}},_displayConfirmationModal:function(z,C){var B=this,A=this.getControl("confirmModal")||this.addControl("confirmModal",new s({closable:true,renderTo:window.document.body||this._widget.body}));A.confirm({title:k.Confirm,message:C||k.ContentDeletionMsg,callback:function(D){if(D===true){B.model.destroy({data:(z?{mustDeleteSubpages:z}:null),onComplete:function(){var E=q.getInstance();B.alert("success",k.ContentDeleted);if(E.isContentContext()){if(E.contentType==="wiki"){E.reset({communityId:E.communityId,path:"community:"+E.communityId+"/wikiroot"})}else{E.reset({path:E.getLastAccessedContentListContext().path})}}},onFailure:function(){console.error("error",arguments);B.alert("error",k.ContentNotDeleted)}})}}})},_onConvertToIdeaItemClick:function(){var z=this;require(["DS/SwymUIComponents/script/feature/community/idea/view/idea-converter-view","DS/SwymUIComponents/script/feature/core/modal/modal","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/content-title-view","DS/UIKIT/Input/Button"],function(C,B,D,A){if(!z._convertLayerView){z._convertLayerView=z.addChildView("convertLayerView",new C({model:z.model}));z._convertLayer=z.addControl("convertLayer",new B({header:D.Contenttoidea,className:"convert-idea-modal-wrapper",body:[z._convertLayerView],footer:[z._convertLayerView.addControl("create",new A({value:D.Create,className:"primary",key:"return",events:{onClick:function(){z._convertLayerView.convertIdea(z._convertLayer,z._onIdeaCreation.bind(z))}}})),new A({value:D.Cancel,key:"esc",events:{onClick:function(){z._convertLayer.hide()}}})]}))}else{z._convertLayerView.setModel(z.model)}z._convertLayer.show()})},_onIdeaCreation:function(z){console.log("_onIdeaCreation");var A=q.getInstance();A.reset({contentId:z.get("mid"),contentType:z.getModelName(),communityId:z.getCommunity().get("mid"),editionMode:true})},_onHighlightItemClick:function(){console.log("highlight clicked");var z=this.model,A=z.getCommunity();if(z&&A){A.addChanges("highlighted_content_uri",z.get("subject6wuri"));A.save({},{onComplete:function(){this.alert("success",k.HighlightSuccess)}.bind(this),onFailure:function(){this.alert("error",k.HighlightFailure)}.bind(this)})}},_onFollowToggleItemClick:function(){var B=this,A=this.model.getCommunity(),z=this.getControl("confirmModal")||this.addControl("confirmModal",new s({closable:true,renderTo:window.document.body||this._widget.body}));if(A.get("isBlacklisted")===false){z.confirm({title:j.Hideallupdates+" "+A.get("title").unescapeHTML(),message:j.Youwillstillbe,callback:function(C){if(C===true){A.unfollow({onFailure:function(E,D){console.error("error",D)},onComplete:function(){B.alert("success",j.nownotfollowing);A.set("isBlacklisted",true);v.dispatchEvent("requestContentListUpdate",{contextPath:"home"})}})}}})}else{A.follow({onFailure:function(D,C){console.error("error",C)},onComplete:function(){B.alert("success",j.nowfollowing);A.set("isBlacklisted",false);v.dispatchEvent("requestContentListUpdate",{contextPath:"home"})}})}},_onBookmarkToggleItemClick:function(){var z,A=/^.*(\/#app.*)url.*(community=.*)/;if(this._isBookmarked){e.remove(this._bookmark);r.trackPageEvent({category:"Bookmark",label:"deleteBookmark",view:"action-menu-view",event:"click"})}else{z=g.get3DDTransientAppUrl({appId:g.getMyCommunitiesAppKey(),community:this.model.get("community->mid"),contentType:this.model.getModelName(),contentId:this.model.get("mid"),communityType:this.model.get("community").hasOwnProperty("users")?"dm":"community"});z=z.match(A);e.add({title:this.model.get("title"),subjectUri:this.model.get("subject6wuri"),serviceName:"3DSwym",linkServiceName:"3DSwym",linkUri:z.hasOwnProperty(1)&&z.hasOwnProperty(2)?z[1]+z[2]:""});r.trackPageEvent({category:"Bookmark",label:"createBookmark",view:"action-menu-view",event:"click"})}},_subscribeToRssFeed:function(){window.open(g.getBaseUrl()+this.model.getRssLink(this._limit))},_pinToThisTab:function(){if(window.ds&&window.ds.env==="3DD"&&(window.widget&&widget.getAppName()===g.getMyCommunitiesAppKey())){g.pinToDashboard({appId:g.getContentReaderAppKey(),data:{url:g.getBaseUrl(),community:this.model.get("community").id,contentId:this.model.get("mid"),contentType:this.model.get("id").split(":").shift()}})}},_onLeaveCommunityClick:function(B){var A=B[0],z=this.getControl("confirmModal")||this.addControl("confirmModal",new s({closable:true,renderTo:window.document.body||this._widget.body}));z.confirm({title:j.deletequestion,message:j.removeMyAccessToThisCommunity,callback:function(C){var D=this;if(C===true){A.deletecurrentuserfromcommunity({onComplete:function(){D.alert("success",j.Youhavebeendeletedfromthiscommunity);v.dispatchEvent("requestContentListUpdate",{contextPath:"home"})},onFailure:function(F,E){console.error("error",E)}})}}.bind(this)})}});return y});define("DS/SwymUIComponents/script/feature/direct-message/room/add-room-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/direct-message/model/direct-message-model","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/utils/navigation","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Alert","i18n!DS/SwymUIComponents/assets/nls/feature/core/share/view/share-content-view","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory","DS/SwymUICore/script/lib/model/model-manager","DS/Logger/Logger","i18n!DS/SwymUIComponents/assets/nls/feature/direct-message/direct-messages"],function(n,i,m,p,b,o,j,g,f,e,h,d,a){var k=m.MAX_NB_USERS_IN_DM-1,l=i.extend({setup:function(r){var s=this,q;this.users=r.users;p.getInstanceFetched(function(t){q=s.addControl("user-search-control",e.createUserSearchControl({mailAllowed:true,pendingUsersAllowed:true,restricted:false,multiSelect:true,itemMultiSelect:false,loginsToDisableInSuggestions:[t.get("login")],parentSwymView:s,events:{onSelect:function(u){this.dispatchEvent("onSelectUser",u)}.bind(s),onUnselect:function(u){this.dispatchEvent("onUnselectUser",u)}.bind(s),onInjected:function(){if(this.elements&&this.elements.input){this.elements.input.focus()}}}}));s.refresh()});this._parent.apply(this,arguments)},_createContent:function(){var r=this.getControl("user-search-control");var q=n.createElement("div",{html:[{tag:"label",html:f.CommunityOwner},{styles:{margin:"10px"},html:[r?r:{}]}]});return q},onInjected:function(){var s=this,r=this.getControl("user-search-control"),t=[],q;p.getInstanceFetched(function(u){if(s.users&&s.users.length>0){s.users.forEach(function(v){if(v.get("login")!==u.get("login")){q=v.get("first_name")+" "+v.get("last_name");t.push({login:v.get("login"),value:q,label:q,selected:true})}})}r.addItems(t,r.getDataset())})},getSelectedUsers:function(){return this.getControl("user-search-control").getSelection()}});var c=i.extend({setup:function(q){var r=this;this.addChildView("userSearchView",{Class:l,users:q.users?q.users:{},events:{onSelectUser:function(s){r.onUserSelected&&r.onUserSelected(s)},onUnselectUser:function(s){r.onUserRemoved&&r.onUserRemoved(s)}}});this.userLimitationReminderEl=n.createElement("div",{"class":"user-limit-text",html:a.replace(a.get("YouCanAddUptoNUsers"),{n:k})});this.addMembersAlert=new g({closable:false,closeOnClick:false,visible:true,fullWidth:true,className:"add-new-members-message",messageClassName:"primary",messages:[a.AddingNewMembersStartsANewConversation],renderTo:r.container});this.cancelConversationButton=new j({value:a.Cancel,events:{onClick:function(){r.destroy()}}});this.startConversationButton=new j({value:a.Start,disabled:true,className:"primary",events:{onClick:function(){p.getInstanceFetched(function(s){var t,x,A=[],z=s.get("login"),y=r.getChildView("userSearchView").getSelectedUsers(),u=new m();for(var v=0,w=y.length;v<w;v++){t=y[v];A.push(t.login)}if(A.indexOf(z)===-1){A.push(z)}if((A.length>1)&&(A.length<=(m.MAX_NB_USERS_IN_DM))){u.addChanges({users:A});r.startConversationButton.load();r.cancelConversationButton.setDisabled();u.save({},{onComplete:function(B){b.goToDM(B.get("mid"));B=new m(B.toJSON());h.notify("onCreate",B);r.destroy()},onFailure:function(C,B){if(B&&B.result&&B.result.id){b.goToDM(B.result.id);var D=new m(B.result);D.set("is_hidden",false);h.notify("onCreate",D);r.destroy()}else{r.startConversationButton.load(false);r.cancelConversationButton.setDisabled(false);r.alert("error",a.AnErrorOccurred)}}})}})}}});this.addControl("addRoomModal",new o({header:"<h4>"+a.StartAConversation+"</h4>",className:"fancy",body:[(q.users&&q.users.length>0)?this.addMembersAlert:"",this.getChildView("userSearchView"),this.userLimitationReminderEl],footer:[this.startConversationButton,this.cancelConversationButton],closable:true,events:{onHide:function(){r.destroy()}}}))},_createContent:function(){return this.getControl("addRoomModal")},show:function(){this.getControl("addRoomModal").show();this._parent.apply(this,arguments)},onUserSelected:function(q){if(this.getChildView("userSearchView")){var r=this.getChildView("userSearchView").getSelectedUsers().length;d.log("User selected",this.nbUsersSelected,q);this.onNbSelectedUsersChange(r)}},onUserRemoved:function(q){var r=this.getChildView("userSearchView").getSelectedUsers().length;d.log("User removed",this.nbUsersSelected,q);this.onNbSelectedUsersChange(r)},isInitialSelection:function(q){var s=this.getChildView("userSearchView").getSelectedUsers(),r=this.getOption("users")||{};s=s.map(function(t){return t.login});if(s.length===r.length-1){return r.every(function(t){return(s.indexOf(t.get("login"))>-1)||t.get("login")===q.get("login")})}else{return false}},onNbSelectedUsersChange:function(q){var r=this;p.getInstanceFetched(function(s){if(q===0||r.isInitialSelection(s)){r.startConversationButton.disable()}else{if(q<k){r.startConversationButton.enable();r.getChildView("userSearchView").container.removeClassName("hide-autocomplete");r.userLimitationReminderEl.hasClassName("error")&&r.userLimitationReminderEl.removeClassName("error");if(q===0){r.userLimitationReminderEl.setHTML(a.replace(a.get("YouCanAddUptoNUsers"),{n:k}))}else{if(q<k-1){r.userLimitationReminderEl.setHTML(a.replace(a.get("YouCanAddNMoreUsers"),{n:k-q}))}else{if(q===k-1){r.userLimitationReminderEl.setHTML(a.YouCanAddOneMoreUser)}}}}else{r.userLimitationReminderEl.addClassName("error");r.getChildView("userSearchView").container.addClassName("hide-autocomplete");if(q===k){r.userLimitationReminderEl.setHTML(a.YouCannotAddAnyMoreUsers)}else{r.startConversationButton.disable();if(q===k+1){r.userLimitationReminderEl.setHTML(a.PleaseRemoveOneUser)}else{if(q>k){r.userLimitationReminderEl.setHTML(a.replace(a.get("PleaseRemoveNUsers"),{n:q-k}))}}}}}})}});return c});define("DS/SwymUIComponents/script/feature/community/content/edit/paragraph-formatter-modal",["UWA/Core","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUIComponents/script/feature/community/content/edit/paragraph-formatter","DS/SwymUICore/script/feature/core/context/context-model"],function(e,a,d,c){var b=a.extend({_destroyed:false,_context:null,defaultOptions:{className:"paragraph-modal",closable:false},init:function(g,f){var h=this,i=e.createElement("div",{"class":"paragraph-body-wrapper",html:[{tag:"button",type:"button","class":"close",title:"Close",text:"×",events:{click:function(){h.hide()}}},this.innerView=new d({extraEditor:g.extraEditor,mode:"modal",modal:this})]});g.body=i;g.overlay=false;this._context=c.getInstance();this.innerView.listenTo(g.extraEditor,"onSelectionChange",function(j){h.hide();h.innerView.options.extraEditor.setOption("editionTarget",j);h.innerView.refresh()});this._context.addListener("onContextChange",this.hide,this);this._parent.apply(this,arguments)},destroy:function(){if(this._destroyed===false){this._destroyed=true;this._context.removeListener("onContextChange",this.hide);this.innerView.destroy();this.innerView=null;this._parent.apply(this,arguments)}}});return b});define("DS/SwymUIComponents/script/feature/community/content/edit/inline-6wtagging",["UWA/Core","DS/SocialUserMention/AbstractSocialMention","DS/SwymUIComponents/script/feature/community/content/edit/tag-autocomplete","DS/Logger/Logger"],function(d,a,e,b){var c=a.singleton({_triggerCharacter:"#",_appendTriggerCharacterToMention:false,_autocompleteClass:e,_attributeForStoringAutocompleteId:"_6wTagAutocompleteId",getMention:function(f){if(!f&&!f.object&&!f.object.predicate){throw new Error("The tag predicate is required!")}var g=d.clone(f,false);g.linksExtraAttributes=d.merge({"class":"s6m-tag-link sm-link","data-predicate":g.object.predicate},g.linksExtraAttributes);return this._parent.call(this,g)},enableFeature:function(){return this._parent.apply(this,arguments)},disableFeature:function(){return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/core/user/view/summary/user-summary-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/summary/user-summary-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/user/view/summary/user-summary-read-view","DS/SwymUIComponents/script/feature/core/user/view/summary/user-summary-edit-view","DS/WebappsUtils/Console"],function(g,e,c,f,a,d,i,b){var h=f.extend({_modelClass:c,name:"summary-view",_createContent:function(){var l=new d({model:this.model,widget:this._widget}),j=new i({model:this.model,widget:this._widget});var k=g.createElement("div",{html:this.addChildView("edition-switch",{Class:a,model:this.model,editView:j,readView:l,actionOnSave:function(m){if(m){return true}if(this.model.getChanges("user_infos")!==undefined){this.model.saveuserinfos({data:{user_infos:this.model.getChanges("user_infos")},onComplete:function(o){this.alert("success",e.alertMessage);var n=o.getChanges("user_infos");if(n!==undefined){o.set("tenant_more_about_me",n)}var p=this.getChildView("edition-switch");if(p){p.setMode("read")}}.bind(this)})}else{this.alert("info",e.noChangeDetected);return false}}.bind(this)})});return k}});return h});define("DS/SwymUIComponents/script/feature/community/community/view/community-item-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view"],function(d,c,b,e){var a=c.extend({_modelClass:b,name:"community-item-view",_modelEvents:{"onChange:last_message":"_updateLastMessage","onChange:_containsContentUnreadByCurrentUser":"_updateReadUnreadStatus"},_modelEventsForAutoRefresh:["onChange:logo_media_id","onChange:title"],init:function(f){if(f&&f.delegateSpriteReloadToParentView===false){this._delegateSpriteReloadToParentView=false}this._parent.apply(this,arguments)},_updateLastMessage:function(){var f=this.getElement(".description.details");f.setContent(this.model.getLastUnreadContentSummary()||"")},_updateReadUnreadStatus:function(){var f=this;setTimeout(function(){if(f.container.parentElement){if(f.model.get("_containsContentUnreadByCurrentUser")===true){f.container.parentElement.addClassName("with-unread-content")}else{f.container.parentElement.removeClassName("with-unread-content")}}},1)},_createContent:function(){var g=this,f=g.model;return[g.addChildView("contentThumbnail",{Class:e,model:f,className:"no-community-rich-tooltip",imageRenderingOptions:{cls:"img-community-home"},refreshOnFingerprintChange:false}),{"class":"info-section",html:[{"class":"title",html:f.get("title")},{"class":"description details"}]}]},onRedraw:function(){this._updateLastMessage()}});return a});define("DS/SwymUIComponents/script/feature/core/auto-save/recovery-modal",["UWA/Core","DS/SwymUICore/script/feature/core/auto-save/auto-save-manager","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Button","i18n!DS/SwymUIComponents/assets/nls/feature/core/auto-save/auto-save"],function(e,f,b,a,d){var c={};c.init=function(){var g=f.getInstance(),h=document.getElementsByClassName("site-container")[0];g.isAvailable(function(j){if(j){var i=new b({header:"<h4>"+d.ContentRecover+"</h4>",className:"fancy auto-save-modal",closable:false,body:d.YouHaveNotPublishedYourLastContentCreation,footer:[new a({className:"primary",value:d.Recover,events:{onClick:function(){g.restoreContent();i.destroy()}}}),new a({value:d.Ignore,events:{onClick:function(){i.destroy();g.ignore()}}})]}).inject(document.body);i.show()}if(h){h.addClassName("currentuser-call-done")}})};return c});define("DS/SwymUIComponents/script/feature/core/user/view/macro/user-settings-view",["UWA/Core","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUIComponents/script/feature/core/user/view/user-visibility-view","DS/SwymUIComponents/script/feature/core/user/view/user-privacy-policies-view","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/core/user/view/user-3dpassport-buttons-view"],function(g,b,d,i,a,f,h,c){var e=d.extend({_modelClass:i,name:"user-settings-view",_createContent:function(){var j=this.model,k=g.createElement("div",{"class":"row",styles:{padding:"10px"},html:[{"class":"col-md-6",styles:{padding:"20px","border-right":"none"},html:this.addChildView("visibilitySettings",{Class:a,model:j})},{styles:{padding:"20px"},"class":"col-md-6",html:[this.addChildView("passport-buttons",{Class:c,model:j})]},{styles:{padding:"20px"},"class":"col-md-6",html:[h.isCloud()&&j.dppConsent?this.addChildView("privacy-policies",{Class:f,model:j}):{}]}]});return k}});return e});define("DS/SwymUIComponents/script/feature/core/user/view/interest/user-interest-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/interest/user-interest-view","DS/SwymUICore/script/feature/core/interest/model/interest-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/user/view/interest/user-interest-read-view","DS/SwymUIComponents/script/feature/core/user/view/interest/user-interest-edit-view","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/WebappsUtils/Console"],function(h,f,e,g,d,a,j,b,c){var i=g.extend({_modelClass:e,name:"user-interest-view",_createContent:function(){var l=new a({model:this.model,widget:this._widget}),k=new j({model:this.model,widget:this._widget});return this.addChildView("edition-switch",{Class:d,doNotReactToEditAllEvent:true,model:this.model,editView:k,readView:l,actionOnSave:function(n){var o=this.getChildView("edition-switch").getChildView("editview").getControl("form-aboutme"),p=o.validate(),m=this.model.isNew();if(n===true){return p}if(p){this.model.save({},{onComplete:function(r,q){var s=m?f.interestCreated:"";this.alert("success",s);r.set(r.getChanges());var t=this.getChildView("edition-switch");if(t){t.setMode("read")}}.bind(this),onFailure:function(r,q){if(q.errorcode==="IllegalArgumentException"){this.alert("error",f.interestDuplicate);this.destroy()}}.bind(this)})}else{this.alert("error",f.pleaseFillTheFieldsCorrectly);return p}}.bind(this),actionOnDestroy:function(){var m=new b({closable:true,renderTo:this._widget.body});m.confirm(f.deletewarning,f.deletequestion,function(n){if(n===true){if(this.model.isNew()===false){this.model.destroy({onComplete:function(){this.alert("success",f.InterestDeletedSucess)}.bind(this),onFailure:function(){this.alert("error",f.YourchangescouldnotbesavedPleasetryagainlater)}.bind(this)})}else{var o=this.getChildView("edition-switch");if(o){o.onCancelClick()}}}}.bind(this))}.bind(this)})}});return i});define("DS/SwymUIComponents/script/feature/core/user/view/location/user-location-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/location/user-location-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/user/view/location/user-location-read-view","DS/SwymUIComponents/script/feature/core/user/view/location/user-location-edit-view","DS/WebappsUtils/Console"],function(g,e,d,f,a,c,i,b){var h=f.extend({_modelClass:d,name:"location-view",_createContent:function(){var l=new c({model:this.model,widget:this._widget}),j=new i({model:this.model,widget:this._widget});var k=g.createElement("div",{html:this.addChildView("edition-switch",{Class:a,model:this.model,editView:j,readView:l,actionOnSave:function(n){var p=this.getChildView("edition-switch").getChildView("editview").getControl("form-aboutme"),q=p.validate(),m={},o=this.model;if(n){return q}if(q){if(o.getChanges("zip")!==undefined){m.zip=o.getChanges("zip")}if(o.getChanges("address")!==undefined){m.address=o.getChanges("address")}if(o.getChanges("city")!==undefined){m.city=o.getChanges("city")}if(o.getChanges("country_code")!==undefined){m.country=o.getChanges("country_code")}if(o.getChanges("company")!==undefined){m.company=o.getChanges("company")}if(Object.keys(m).length>0){o.updatePassportFields({data:m,onComplete:function(s,u){var r=s.fields;this.alert("success",e.personalInfoUpdated);if(o.getChanges("zip")!==undefined){o.set("zip",r.zip.value)}if(o.getChanges("address")!==undefined){o.set("address",r.address.value)}if(o.getChanges("city")!==undefined){o.set("city",r.city.value)}if(o.getChanges("country_code")){o.set("country_code",o.getChanges("country_code"));o.set("countryForRead",o.getChanges("countryForRead"))}if(o.getChanges("company")!==undefined){o.set("company",r.company.value)}var t=this.getChildView("edition-switch");if(t){t.setMode("read")}o.removeChanges(["zip","address","city","country_code","company"])}.bind(this)})}else{return false}}else{this.alert("error",e.pleaseFillTheFieldsCorrectly);return q}}.bind(this)})});return k}});return h});define("DS/SwymUIComponents/script/feature/community/community/view/community-creation-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-creation-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory","DS/SwymUICore/script/utils/navigation","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/lib/model/model-manager","DS/WebappsUtils/Console"],function(j,d,h,e,c,a,k,i,g,l,f,b){var m=h.extend({_modelClass:e,name:"community-creation-view",_currentUser:null,_createContent:function(){var o=this,n=this.model;if(n){n.addChanges("hash_key",this._currentUser.hash_key);this.addControl("communityCreationForm",new i({fields:[{type:"text",name:"title",pattern:"(?:\\s*[^\\s]+\\s*)+",maxlength:255,label:d.Title,required:true,events:{onChange:function(){n.addChanges("title",this.getValue().trim())},onKeyDown:function(){this.getContent().getParent(".form-group").removeClassName("has-error")}}},{type:"textarea",name:"description",label:d.Description,pattern:"(?:\\s*[^\\s]+\\s*)+",maxlength:250,required:true,events:{onChange:function(){n.addChanges("description",this.getValue().trim())}}},c.getFormConfig({label:d.CommunityOwner,defaultValue:this._currentUser.first_name+" "+this._currentUser.last_name,events:{onSelect:function(p){n.addChanges("hash_key",p.hash_key);b.log("community owner has changed")},onNoResults:function(p,q){console.warn("No result founds",p,q);require(["DS/UWPClientControls/PlatformNotify"],function(r){r.error(d.CurrentUserNotFound)});o.getControl("createButton").disable()}}})]}));this.addControl("cancelButton",new g({value:d.Cancel,events:{onClick:function(){this.getControl("communityCreationModal").hide()}.bind(this)}}));this.addControl("createButton",new g({value:d.Create,className:"primary",events:{onClick:function(){var p=this.getControl("communityCreationForm");if(p.validate()){n.checktitleuniqueness({onComplete:function(r,q){if(q.result===true){this.getControl("cancelButton").setDisabled();this.getControl("createButton").load();r.save({},{onComplete:function(s){this.alert("success",d.communityhasbeencreated);var s=new e(s.toJSON());if(s.get("owner").hash_key===o._currentUser.hash_key){f.notify("onCreate",s);if(!(this._widget&&this._widget.getAppName()==="X3DOPSW_AP")){a.goToCommunity(s.get("mid"),a.COMMUNITY_SETTINGS)}}this.getControl("communityCreationModal").hide()}.bind(this),onFailure:function(){this.alert("error",d.AnerroroccurredwhilecreatingthecommunityPleasetryagainorcontactyouradministrator);this.getControl("cancelButton").setDisabled(false);this.getControl("createButton").load(false)}.bind(this)})}else{this.getControl("communityCreationForm").getFields()[0].getParent(".form-group").addClassName("has-error");this.alert("error",d.similarCommunityNameAlreadyExists)}}.bind(this)})}}.bind(this)}}));return this.addControl("communityCreationModal",new k({header:"<h4>"+d.CreateACommunity+"</h4>",className:"fancy",body:[this.getControl("communityCreationForm")],footer:[this.getControl("createButton"),this.getControl("cancelButton")],closable:true,events:{onHide:function(){this.destroy()}.bind(this)}}))}},setup:function(){this._currentUser=l.getInstance().get("user");this._parent.apply(this,arguments)},show:function(){this.getControl("communityCreationModal").show()}});return m});define("DS/SwymUIComponents/script/feature/core/search/view/user-and-users-group-search-factory",["UWA/Core","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory","DS/SwymUICore/script/feature/core/user/collection/user-and-users-group-collection","DS/WebappsUtils/WebappsUtils","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UWPClientCode/I18n"],function(g,f,b,e,c,d){var a=f.Factory.extend({_getConfiguration:function(){var h=this,i=this._parent.apply(this,arguments);return g.merge({templateEngine:function(k,l,j){k.addClassName("default-template people-search-template with-sub-label");k.setHTML('<img class="'+((j.type==="users_group")?"users-group-default-picture":"people-search-img")+'" src="'+((j.type==="users_group")?(e.getWebappsBaseUrl()+"SwymUIComponents/assets/s.gif"):j.preview_url)+'"/> <div class="item-label">'+j.label+'</div> <div class="sub-label">'+(j.subLabel?j.subLabel:"")+"</div>")},remoteSearchEngine:function(k,l,m){var j=this;if(l.trim()!==""){if(!this._userAndUsersGroupCollection){this._userAndUsersGroupCollection=new b([],{limit:5,mode:"searchbyname"})}return new Promise(function(o,n){j._userAndUsersGroupCollection.fetchPage(1,{data:{query:l,locale:d.getCurrentLanguage()},onComplete:function(){var q=j._userAndUsersGroupCollection.toJSON(),p={dataset:k,matchingItems:q&&k.configuration.dataParser&&k.configuration.dataParser.call(this,k,q,l)};o(p);if(m){m(p.matchingItems)}},onFailure:function(){n({})}})})}return},dataParser:function(n,m,o){var k,j=[],l=h;m.forEach(function(p){k={uri:p.subject6wuri,label:p["ds6w:label"],nickname:p["ds6w:label"],value:p["ds6w:label"],preview_url:p.preview_url};j.push(k)});if(l._mailAllowed&&(j.length===0)&&l._isAMail(o)){j.push({uri:o,label:o,value:o,preview_url:c.constructUserPictureUrl(o,"")})}return j}},i)}});return g.merge({Factory:a},f)});define("DS/SwymUIComponents/script/feature/core/user/view/phone/user-phone-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/phone/user-phone-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/user/view/phone/user-phone-read-view","DS/SwymUIComponents/script/feature/core/user/view/phone/user-phone-edit-view","DS/WebappsUtils/Console"],function(h,f,d,g,b,e,a,c){var i=g.extend({_modelClass:d,name:"mail-view",_createContent:function(){var j=new e({model:this.model,widget:this._widget}),l=new a({model:this.model,widget:this._widget});var k=h.createElement("div",{html:this.addChildView("edition-switch",{Class:b,model:this.model,editView:l,readView:j,actionOnSave:function(n,m){var o=this.getChildView("edition-switch").getChildView("editview").getControl("form-aboutme"),p=o.validate();if(n===true){return p}if(p){if(this.model.getChanges("tel")!==undefined){this.model.updatePassportFields({data:{telephone:this.model.getChanges("tel")},onComplete:function(t,s){this.alert("success",f.alertMessage);var q=this.model.getChanges("tel");if(q!==undefined){this.model.set("tel",q)}var r=this.getChildView("edition-switch");if(r){r.setMode("read")}this.model.removeChanges("tel")}.bind(this)})}else{if(!m){this.alert("info",f.noChangeDetected)}return false}}else{this.alert("error",f.pleaseFillTheFieldsCorrectly);return p}}.bind(this)})});return k}});return i});define("DS/SwymUIComponents/script/feature/community/members/view/small-members-list-view",["UWA/Core","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/feature/core/context/context-model"],function(h,f,g,c,d,e){var a=d.extend({_createContent:function(){var i=this.model;return c.renderUserPicture(h.merge({login:i.get("login"),hash_key:i.get("hash_key"),imageUpdateTime:i.get("picture_update"),imageFingerprint:i.get("user_picture_fingerprint"),dataIsLink:true},this._imageRenderingOptions||{}))}});var b=g.extend({name:"small-members-list",modelViewClass:a,setup:function(){var i=this;i._parent.apply(i,arguments);require(["DS/SwymUICore/script/lib/event-manager"],function(j){i.listenTo(j,"onCommunityMembersUpdate",function(m){var l=e.getInstance(),k=m.filter(function(n){if(n instanceof f){return n}});i.collection.reset(l.isDirectMessageContext()?k:k.slice(0,5))})})}});return b});define("DS/SwymUIComponents/script/feature/core/user/view/mail/user-mail-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/mail/user-mail-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/user/view/mail/user-mail-read-view","DS/SwymUIComponents/script/feature/core/user/view/mail/user-mail-edit-view","DS/WebappsUtils/Console"],function(g,d,c,e,a,i,h,b){var f=e.extend({_modelClass:c,name:"mail-view",_createContent:function(){var j=new i({model:this.model,widget:this._widget}),l=new h({model:this.model,widget:this._widget});var k=g.createElement("div",{html:this.addChildView("edition-switch",{Class:a,model:this.model,editView:l,readView:j,actionOnSave:function(n,m){var o=this.getChildView("edition-switch").getChildView("editview").getControl("form-aboutme"),p=o.validate();if(n===true){return p}if(p){if(this.model.getChanges("email")){this.model.updatePassportFields({data:{email:this.model.getChanges("email")||this.model.get("email")},onComplete:function(t,s){this.alert("success",d.alertMessage);var r=this.model.getChanges("email");if(r!==undefined){this.model.set("email",r)}var q=this.getChildView("edition-switch");if(q){q.setMode("read")}this.model.removeChanges("email")}.bind(this)})}else{if(!m){this.alert("info",d.noChangeDetected)}return false}}else{this.alert("error",d.pleaseFillTheFieldsCorrectly);return p}}.bind(this)})});return k}});return f});define("DS/SwymUIComponents/script/feature/community/content/edit/replied-content-view",["UWA/Core","UWA/Event","UWA/String","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/event-manager","DS/SwymUICore/script/utils/im-core-utils","DS/SwymUICore/script/utils/i18n","DS/SwymUIComponents/script/utils/content-creation-types-manager","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/replied-content-view"],function(a,w,e,d,t,p,k,m,l){var g=p.TYPES.POST_MODEL_TYPE_TABLE,f=p.TYPES.IDEA_MODEL_TYPE_TABLE,r=p.TYPES.QUESTION_MODEL_TYPE_TABLE,s=p.TYPES.MEDIA_MODEL_TYPE_TABLE,j=p.TYPES.WIKI_MODEL_TYPE_TABLE,n=p.TYPES.SURVEY_MODEL_TYPE_TABLE,h=p.TYPES.POST_MODEL_TYPE,q=p.TYPES.IDEA_MODEL_TYPE,o=p.TYPES.QUESTION_MODEL_TYPE,c=p.TYPES.MEDIA_MODEL_TYPE,i=p.TYPES.WIKI_MODEL_TYPE,b=p.TYPES.SURVEY_MODEL_TYPE,u=function(y){var x;switch(y.toLowerCase()){case h.toLowerCase():case g.toLowerCase():x="post";break;case q.toLowerCase():case f.toLowerCase():x="idea";break;case o.toLowerCase():case r.toLowerCase():x="iquestion";break;case c.toLowerCase():x="media";break;case b.toLowerCase():case n.toLowerCase():x="survey";break;case i.toLowerCase():case j.toLowerCase():x="wiki";break;default:break}return x};var v=d.extend({name:"replied-content-view",defaultOptions:{creationMode:false},className:"hidden",domEvents:{"click .fonticon-close":"cancel"},cancel:function(){this.model=null;this.refresh();this._typesManager.setContentTypeRequest({type:"message",updateIcon:true,forceFocus:true})},_replyToIMCreateContent:function(){var x="",y,z;if(this.model){y=this.model.getAssociated("author");z=this.model.getInstantMessage();x=[{"class":"replied-message",html:[{tag:"span","class":"replied-message-content",html:[{tag:"span","class":"fonticon fonticon-chat-alt"},{tag:"a","data-content-type":"person","data-login":y.get("login")||"",html:y.getNickname()},{tag:"span","class":"semi-colon",html:":"},{tag:"span","class":"ellipsis-text",html:z.get("richMessage")||""}]}]},this.getOption("creationMode")===true?{"class":"fonticon fonticon-close"}:""]}return x},_getCommentedNls:function(){var z=this.model.get("message_details->subject_model"),y=this.model.has("message_details->parent_uri"),x="";if(z){switch(z.toLowerCase()){case"post":x=y?l.RepliedOnPost:l.CommentedOnPost;break;case"ideation":x=y?l.RepliedOnIdea:l.CommentedOnIdea;break;case"wiki":x=y?l.RepliedOnWiki:l.CommentedOnWiki;break;case"question":x=y?l.RepliedOnQuestion:l.CommentedOnQuestion;break;case"media":x=y?l.RepliedOnMedia:l.CommentedOnMedia;break}}return x},_getSubjectLink:function(){var x=this.model,z=x.getCommunity().get("mid"),A=x.getCommunity().isDirectMessage(),y={tag:"a","class":"link","data-content-id":x.get("message_details->subject_id"),"data-content-type":u(x.get("message_details->subject_model")),html:x.get("message_details->subject_title")};if(A){y["data-dm-id"]=z}else{y["data-community-id"]=z}return y},_replyToCommentCreateContent:function(){var x="",y,z,A=this._typesManager.getCurrentCommentSubjectContentType();if(this.model){y=this.model.getAssociated("author");z=this.model.getInstantComment();x=[{"class":"comment-reply-first-line",html:[{"class":"comment-reply-message",html:[{tag:"span","class":"fonticon fonticon-comment"},{"class":"reply-action",html:l.ReplyTo},{tag:"a","data-content-type":"person","data-login":y.get("login")||"",html:y.getNickname()},{"class":"reply-action",html:this._getCommentedNls()},this._getSubjectLink()]},{"class":"fonticon fonticon-close"}]},{"class":"comment-reply-second-line "+A,html:z.get("content")||""}]}return x},_createContent:function(){var y="";if(this.model){var x=this.model.get("message_type");if(x==="INTERNAL_EVENT"){this.container.addClassName("comment");y=this._replyToCommentCreateContent()}else{if(x==="INSTANT_MESSAGE"||this.getOption("creationMode")===false){this.container.removeClassName("comment");y=this._replyToIMCreateContent()}}}return y},setup:function(){var x=this;this._typesManager=m.getInstance();if(this.getOption("creationMode")===true){this.listenTo(t,"onEventReply",function(y){if(y&&y.model){this.container.removeClassName("hidden");this.setModel(y.model)}}.bind(this))}return this._parent.apply(this,arguments)}});return v});define("DS/SwymUIComponents/script/feature/community/wiki/view/revision-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/view/revision-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/date","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip"],function(i,d,f,g,b,j,e,h,a,l,k){var m=g.extend({name:"revision-description-view",_currentRevisionAttributes:null,_modelEventsForAutoRefresh:["onSync"],_createContent:function(){var q=this,p=q.model,n,o,r=q._parentView.getControl("show-diff-checkbox").isChecked();q.currentRev=q._parentView.currentRev;n=p.getRevisionData(q.currentRev,r);o=n&&n.revision_description;if(o){o=o.escapeHTML()}return{id:"revision_description_wrapper",html:[{"class":"current-revision",html:d.Currentrevisiondescription},{"class":"current-revision",html:[f.by+" ",{tag:"a","class":"link","data-content-type":"person","data-hash-key":n.last_publisher.hash_key,"data-login":n.last_publisher.login,html:n.last_publisher.first_name+" "+n.last_publisher.last_name},' - <span class="revision-date">'+e.prettyDate(n.update)+"</span>"]},{"class":"current-revision",styles:{display:(!o||o===""?"none":"")},id:"revision_description",html:o}]}}});var c=g.extend({_modelClass:b,name:"revision-view",currentRev:-1,_modelEventsForAutoRefresh:["onSync:update","onSync"],_modelEvents:{"onSync:read":"unmask","onChange:nb_revisions":"onLastButtonClick"},domEvents:{"click .prev-first-button":"onFirstButtonClick","click .next-last-button":"onLastButtonClick","click .prev-button":"onPrevButtonClick","click .next-button":"onNextButtonClick","click .revert-button":"onRevertButtonClick"},onSetModel:function(){var o=this.model,p=this.getControl("prev-first-button"),n=this.getControl("prev-button"),s=this.getControl("next-button"),r=this.getControl("next-last-button"),q=this.getControl("revert-button"),t=this.getControl("show-diff-checkbox");if(!p){p=this.addControl("prev-first-button",new h({className:"default prev-first-button",icon:"to-start"}))}if(!n){n=this.addControl("prev-button",new h({className:"default prev-button",icon:"fast-backward"}))}p.enable();n.enable();if(!s){s=this.addControl("next-button",new h({className:"default next-button",icon:"fast-forward",disabled:true}))}if(!r){r=this.addControl("next-last-button",new h({className:"default next-last-button",icon:"to-end",disabled:true}))}s.disable();r.disable();if(!this.getControl("prev-first-button-tooltip")){this.addControl("prev-first-button-tooltip",new k({target:this.getControl("prev-first-button").getContent(),body:d.FirstRevision}))}if(!this.getControl("prev-button-tooltip")){this.addControl("prev-button-tooltip",new k({target:this.getControl("prev-button").getContent(),body:d.PreviousRevision}))}if(!this.getControl("next-button-tooltip")){this.addControl("next-button-tooltip",new k({target:this.getControl("next-button").getContent(),body:d.NextRevision}))}if(!this.getControl("next-last-button-tooltip")){this.addControl("next-last-button-tooltip",new k({target:this.getControl("next-last-button").getContent(),body:d.LastRevision}))}if(!q){q=this.addControl("revert-button",new h({className:"default revert-button",icon:"ccw",value:d.Revert}))}q&&q.hide();if(!t){t=this.addControl("show-diff-checkbox",new l({type:"checkbox",className:"show-diff-checkbox primary",checked:false,id:"show-diff-checkbox",label:d.Showdifferences,events:{onChange:function(){o.goToNthRevision(this.currentRev,{diff:this.getControl("show-diff-checkbox").isChecked()})}.bind(this)}}))}t.setCheck(false);this.currentRev=o.getCurrentRevision()},_createContent:function(){var s=this,p=s.model,n=0,r;if(p.hasBeenFetched()){if(this._getNbRevisions()!==this._getRevisionNumber()){var u=this.getControl("next-button"),t=this.getControl("next-last-button");if(u){u.enable()}if(t){t.enable()}}if(this._getRevisionNumber()===1){var o=this.getControl("prev-button"),q=this.getControl("prev-first-button");if(o){o.disable()}if(q){q.disable()}}n=parseInt(p.get("nb_revisions"),10)+(p.get("is_minor_edit")==="0"?1:0);if(n>1){s.container.removeClassName("hidden");r=i.createElement("div",{"class":"revision-view-wrapper",html:{"class":"revision-panel",html:[{"class":"heading",html:{"class":"wikitree-header",html:{"class":"revision-counter-panel",styles:{"margin-bottom":"10px"},html:s._computeWidgetTitle()}}},{"class":"player",html:[s.getControl("prev-first-button"),s.getControl("prev-button"),s.getControl("next-button"),s.getControl("next-last-button")]},{html:[s.getControl("show-diff-checkbox"),s.addChildView("revisionDescription",{Class:m,model:p})]},s.getControl("revert-button")]}});s._setWidgetTitle(s._computeWidgetTitle())}else{s.container.addClassName("hidden")}}return r},onRender:function(){this._setWidgetTitle(this._computeWidgetTitle())},_getNbRevisions:function(){return parseInt(this.model.get("nb_revisions"),10)+(this.model.get("is_minor_edit")==="0"?1:0)},_getRevisionNumber:function(){return((this.currentRev===-1)?parseInt(this._getNbRevisions(),10):(parseInt(this.currentRev,10)+1))},_computeWidgetTitle:function(){var p="",o=this._getRevisionNumber(),n=this._getNbRevisions();p='<span class="fonticon fonticon-rotate-ccw"></span>'+d.Revision+(o===parseInt(n,10)&&o===1?"":" ("+o+" / "+parseInt(n,10)+")");return p},_setWidgetTitle:function(n){if(this.getElement(".revision-counter-panel")){this.getElement(".revision-counter-panel").setHTML(n)}},onFirstButtonClick:function(){this.mask();this.currentRev=0;this._setWidgetTitle(this._computeWidgetTitle());this.getControl("prev-first-button").disable();this.getControl("prev-button").disable();this.getControl("next-button").enable();this.getControl("next-last-button").enable();if(this.model.get("_acl").update.access&&this.getControl("revert-button")){this.getControl("revert-button").show()}this.model.goToFirstRevision({diff:this.getControl("show-diff-checkbox").isChecked()})},onLastButtonClick:function(){this.mask();this.currentRev=-1;this._setWidgetTitle(this._computeWidgetTitle());this.getControl("prev-first-button").enable();this.getControl("prev-button").enable();this.getControl("next-button").disable();this.getControl("next-last-button").disable();if(this.getControl("revert-button")){this.getControl("revert-button").hide()}if(this.model.get("nb_revisions")>0){this.model.goToLastRevision({diff:this.getControl("show-diff-checkbox").isChecked()})}},onPrevButtonClick:function(){this.mask();if(this.currentRev===-1){this.currentRev=parseInt(this.model.get("nb_revisions"),10)-1;if(this.model.get("is_minor_edit")==="1"){this.currentRev--}}else{this.currentRev--}this._setWidgetTitle(this._computeWidgetTitle());if(parseInt(this.currentRev,10)===0){this.getControl("prev-first-button").disable();this.getControl("prev-button").disable()}else{this.getControl("prev-first-button").enable();this.getControl("prev-button").enable()}this.getControl("next-button").enable();this.getControl("next-last-button").enable();if(this.model.get("_acl").update.access&&this.getControl("revert-button")){this.getControl("revert-button").show()}this.model.goToNthRevision(this.currentRev,{diff:this.getControl("show-diff-checkbox").isChecked()})},onNextButtonClick:function(){this.mask();this.currentRev++;var n=parseInt(this.model.get("nb_revisions"),10);if(this.model.get("is_minor_edit")==="1"){n--}if(this.currentRev===n){this.currentRev=-1}this._setWidgetTitle(this._computeWidgetTitle());if(this.currentRev===-1){this.getControl("next-button").disable();this.getControl("next-last-button").disable();if(this.getControl("revert-button")){this.getControl("revert-button").hide()}}else{this.getControl("next-button").enable();this.getControl("next-last-button").enable();if(this.model.get("_acl").update.access&&this.getControl("revert-button")){this.getControl("revert-button").show()}}this.getControl("prev-first-button").enable();this.getControl("prev-button").enable();this.model.goToNthRevision(this.currentRev,{diff:this.getControl("show-diff-checkbox").isChecked()})},onRevertButtonClick:function(){var n=this.addControl("confirmModal",new a({closable:false,renderTo:this._widget.body}));n.confirm(d.Areyousureyouwanttorevertthepagetothisrevision,d.Confirm,function(o){if(o===true){this.mask();this.model.revert({onComplete:function(){this.alert("success",d.Thepagehasbeenrevertedtotheselectedrevision);this.nbRevisions++;this.onLastButtonClick();this.unmask()}.bind(this),onFailure:function(){this.unmask();this.alert("error",d.Anerroroccuredwhilerevertingthepage)}.bind(this)})}}.bind(this))},setup:function(){var o=this,n=o._parent.apply(o,arguments);o.stopReactingTo(o.model,"onRevisionReceived");o.reactTo(o.model,"onRevisionReceived",function(){o.getChildView("revisionDescription")&&o.getChildView("revisionDescription").refresh();o.unmask()});return n}});return c});define("DS/SwymUIComponents/script/feature/core/experience/view/experience-view",["i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-view","DS/SwymUICore/script/feature/core/experience/model/experience-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/experience/view/experience-read-view","DS/SwymUIComponents/script/feature/core/experience/view/experience-edit-view","DS/SwymUIComponents/script/feature/core/modal/super-modal"],function(f,b,h,g,d,c,a){var e=h.extend({_modelClass:b,name:"experience-view",_createContent:function(){var j=new d({model:this.model,widget:this._widget}),i=new c({model:this.model,widget:this._widget});return this.addChildView("edition-switch",{Class:g,model:this.model,editView:i,readView:j,actionOnSave:function(l){var m=this.getChildView("edition-switch").getChildView("editview").getControl("form-aboutme"),n=m.validate(),k=this.model.isNew();if(l===true){return n}if(n){return this.model.save({},{onComplete:function(p,o){var q=k?f.experiencecreated:f.experienceUpdated;this.alert("success",q);p.set(p.getChanges());var r=this.getChildView("edition-switch");if(r){r.setMode("read")}}.bind(this),onFailure:function(p,o){console.log("error")}})}else{this.alert("error",f.pleaseFillTheFieldsCorrectly);return n}}.bind(this),actionOnDestroy:function(){var k=new a({closable:true,renderTo:document.body});k.confirm(f.deletewarning,f.deletequestion,function(l){if(l===true){if(this.model.isNew()===false){this.model.destroy({onComplete:function(){this.alert("success",f.experienceDeletedSuccess)}.bind(this),onFailure:function(){this.alert("error",f.YourchangescouldnotbesavedPleasetryagainlater)}.bind(this)})}else{var m=this.getChildView("edition-switch");if(m){m.onCancelClick()}}}}.bind(this))}.bind(this)})}});return e});define("DS/SwymUIComponents/script/feature/core/education/view/education-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/experience/view/experience-view","DS/SwymUICore/script/feature/core/education/model/education-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/education/view/education-read-view","DS/SwymUIComponents/script/feature/core/education/view/education-edit-view","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/WebappsUtils/Console"],function(h,f,a,g,d,e,j,b,c){var i=g.extend({_modelClass:a,name:"education-view",_createContent:function(){var m=new e({model:this.model,widget:this.widget}),k=new j({model:this.model,widget:this.widget});var l=h.createElement("div",{html:this.addChildView("edition-switch",{Class:d,model:this.model,editView:k,readView:m,actionOnSave:function(o){var p=this.getChildView("edition-switch").getChildView("editview").getControl("form-aboutme"),q=p.validate(),n=this.model.isNew();if(o===true){return q}if(q){return this.model.save({},{onComplete:function(s,r){var t=n?f.educationcreated:f.educationUpdated;this.alert("success",t);s.set(s.getChanges());var u=this.getChildView("edition-switch");if(u){u.setMode("read")}}.bind(this),onFailure:function(s,r){console.log("error")}})}else{this.alert("error",f.pleaseFillTheFieldsCorrectly);return q}}.bind(this),actionOnDestroy:function(){var n=new b({closable:true,renderTo:document.body});n.confirm(f.educationdeletewarning,f.educationdeletequestion,function(o){if(o===true){if(this.model.isNew()===false){this.model.destroy({onComplete:function(){this.alert("success",f.educationDeletedSuccess)}.bind(this),onFailure:function(){this.alert("error",f.YourchangescouldnotbesavedPleasetryagainlater)}.bind(this)})}else{var p=this.getChildView("edition-switch");if(p){p.onCancelClick()}}}}.bind(this))}.bind(this)})});return l}});return i});define("DS/SwymUIComponents/script/feature/core/stats/view/static-stats-collection-view",["DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/stats/collection/stats-collection","DS/SwymUIComponents/script/feature/core/stats/view/analytics-view"],function(c,d,b){var a=c.extend({_collectionClass:d,name:"static-stats-collection-view",modelViewClass:b,bodyAttributes:{tag:"div",styles:{"overflow-x":"hidden"}},modelViewsCfg:{attributes:{"class":(ds&&(ds.env==="3DD"))?"graph col-xs-12 col-md-6 col-sm-6 col-lg-4":"graph"}}});return a});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-st-sprite",["DS/SocialToolbar/Utils/Sprite","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/feature/core/user/model/user-model"],function(a,b,c){a.constructor.prototype.renderUserPicture=function(e){var d=new b({imageRenderingOptions:{cls:"swym-user-picture"+(e.cls?(" "+e.cls):"")},model:new c({login:e.login,username:""})});d.render();return d}});define("DS/SwymUIComponents/script/feature/core/share/view/share-content-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/share/view/share-content-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Alert","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Toggler","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/request/data","UWA/Utils/Client","i18n!DS/SwymUICore/assets/nls/feature/community/community/model/community-model"],function(a,j,n,b,s,q,t,o,c,i,l,k,p,m,g,e,f,r,h){var d=n.extend({setup:function(w){var y=this,v=this.model,x=(v?(v.getModelName()==="community"?v:v.getCommunity()):null),z=(x?x.get("mid"):null);e.isUsersGroupFeatureAvailable(function(A){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SwymUIComponents/script/feature/core/search/view/user-and-users-group-search-factory"],function(B,C){B.getPlatformConfig({platformId:q.getInstance().get("config").tenant.online_instance_id,key:"share",onComplete:function(D){y.addControl("user-search-control",(A?C:t).createUserSearchControl({mailAllowed:D,pendingUsersAllowed:true,community_id:(x&&x.getVisibility()===h.Secret?z:null),restricted:false,multiSelect:true,parentSwymView:y,events:{onSelect:function(E){this.dispatchEvent("onSelectUser",arguments)}.bind(y),onUnselect:function(E){this.dispatchEvent("onUnselectUser",arguments)}.bind(y)}}));y.refresh()}})})});this._parent.apply(this,arguments)},_createContent:function(){var v=this.model,x=(v?(v.getModelName()==="community"?v:v.getCommunity()):null),z=this.cid,y=this.getControl("user-search-control");var w=a.createElement("div",{html:[{tag:"label",html:j.CommunityOwner,"for":"communityowner"+z},{styles:{margin:"10px"},html:[(x&&x.getVisibility()===h.Secret?{html:j.SecretCommunityContent,"class":"secret-community-message"}:""),y?y:{},{styles:{"margin-top":"10px"}}]}]});return w}});var u=b.extend({_modelClass:s,name:"share-content-view",modal:null,shareFb:false,shareLinkedin:false,shareTwitter:false,communityId:0,contentId:0,contentType:null,url:null,shareTitle:"",shareMsg:"",serverModelName:null,selectedToggle:null,selectedUsersArray:[],setup:function(w){var z=true,A=this;A._parent.apply(A,arguments);A.selectedUsersArray=[];if((w.shareOnSocialNetworks===true)||(w.shareOnSocialNetworks===false)){z=w.shareOnSocialNetworks}var F,v=q.getInstance();if((F=v.get("config").tenant)&&(z===true)){A.shareFb=F.share_facebook;A.shareLinkedin=F.share_linkedin;A.shareTwitter=F.share_twitter}var x=A.model;var C=x.getModelName();switch(C){case"post":case"media":case"wiki":case"iquestion":case"idea":case"survey":A.contentType=C;A.contentId=x.get("mid");if(x.get("community")&&(x.get("community").id)||x.get("community").mid){A.communityId=x.get("community").id||x.get("community").mid}break;case"im-event":A.contentType="message";A.contentId=x.get("mid");if(x.get("community")&&(x.get("community").id)||x.get("community").mid){A.communityId=x.get("community").id||x.get("community").mid}break;case"community":A.communityId=x.get("mid");break}switch(C){case"post":A.shareTitle=j.Sharethispost;A.serverModelName="Post";break;case"media":A.shareTitle=j.Sharethismedia;A.serverModelName="Media";break;case"wiki":A.shareTitle=j.Sharethiswiki;A.serverModelName="WikiTree";break;case"iquestion":A.shareTitle=j.Sharethisiquestion;A.serverModelName="iQuestion";break;case"idea":A.shareTitle=j.Sharethisidea;A.serverModelName="Ideation";break;case"community":A.shareTitle=j.Sharethiscommunity;A.serverModelName="community";break;case"survey":A.shareTitle=j.Sharethissurvey;A.serverModelName="Poll";break;case"im-event":A.shareTitle=j.Sharethismessage;A.serverModelName="InstantMessage";break}var D={appId:e.getMyCommunitiesAppKey()};if(A.communityId&&A.contentType&&A.contentId){a.merge(D,{community:A.communityId,contentType:A.contentType,contentId:A.contentId,communityType:o.getInstance().isDirectMessageContext()?"dm":"community"})}else{if(A.communityId){a.merge(D,{community:A.communityId})}}if(window.ds&&window.ds.env==="3DD"){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(G){G.getServiceUrl({serviceName:"3DDashboard",platformId:v.get("config").tenant.online_instance_id,onComplete:function(H){A.url=e.get3DDTransientAppUrl(a.merge(D,{origin:H}));if(A.fakeUrlInput){A.fakeUrlInput.setValue(A.url||j.ShareUrlCannotBeComputed)}}})})}else{var y=new Date().getTime(),E="/#community:"+A.communityId+(A.contentId?"/"+A.contentType+":"+A.contentId:"");A.urlForLinkedin=e.getBaseUrl()+"?"+y+E;A.url=e.getBaseUrl()+E;if(A.fakeUrlInput){A.fakeUrlInput.setValue(A.url||j.ShareUrlCannotBeComputed)}}A.shareButton=new k({value:j.Share,className:"primary share",disabled:true,events:{onClick:function(){A.dispatchEvent("onShare")}}});A.cancelButton=new k({value:j.Cancel,className:"default cancel",events:{onClick:function(){A.modal.hide()}}});var B=A.addChildView("userSearchView",{Class:d,model:this.model});B.addEvent("onSelectUser",A.onSelectUser.bind(A));B.addEvent("onUnselectUser",A.onUnselectUser.bind(A))},onSelectUser:function(v){var w=e.isFeatureActivated("activateUsersGroup")?v.uri:v.hash_key;if(this.selectedUsersArray.indexOf(w)<0){this.selectedUsersArray.push(w);this.shareButton.enable()}},onUnselectUser:function(w){var x=e.isFeatureActivated("activateUsersGroup")?w.uri:w.hash_key,v=[];this.selectedUsersArray.forEach(function(y){if(y!=x){v.push(y)}});this.selectedUsersArray=v},createBody:function(){var y=this;var w=UWA.createElement("nav",{id:"share-tabs-navigation","class":"tab",html:[{tag:"a","class":"tab-item",html:'<span class="fonticon fonticon-users-add "></span>'+j.ShareWithUsers},{tag:"a","class":"tab-item",html:'<span class="fonticon fonticon-link "></span>'+j.ShareByLink},(this.shareLinkedin||this.shareFb||this.shareTwitter)?{tag:"a","class":"tab-item",html:'<span class="fonticon fonticon-share-alt "></span>'+j.ShareOnSocialNetworks}:{}]});var v=UWA.createElement("section",{id:"share-tabs-section",html:[{tag:"section","class":"hide",html:[{tag:"div","class":"share-user",html:[{tag:"span",html:j.ShareThisContentWithAnyUserOfYour3DEXPERIENCEPlatform,styles:{margin:"10px"}},this.getChildView("userSearchView"),{tag:"div",styles:{margin:"10px"},"class":"share-message",html:(y.shareMsg=new p({name:j.Message,placeholder:j.EnterAMessage,multiline:true,rows:4}))}]}]},{tag:"section","class":"hide",html:[{tag:"span",html:j.AnyoneWithTheFollowingLinkWillAccessThisContent,styles:{margin:"10px"}},{"class":"share-url-input",html:[this.fakeUrlInput=new p({value:this.url||j.ShareUrlCannotBeComputed,className:"left-text"}),new k({value:j.CopyLink,buttonClassName:"default",className:"right-button default",events:{onClick:function(){var A=y.fakeUrlInput.elements.input;if(r.Platform.ios){var z=document.createRange(),B;z.selectNodeContents(A);B=window.getSelection();B.removeAllRanges();B.addRange(z);A.setSelectionRange(0,999999)}else{A.focus();A.select()}document.execCommand("copy");require(["DS/UWPClientControls/PlatformNotify"],function(C){C.success(j.LinkHasBeenCopiedInYourClipboard)});y.modal.hide();return false}}})]}]},{tag:"section","class":"hide share-social-networks",html:[(this.shareLinkedin)?{tag:"div","class":"share-option linkedin",html:[this.linkedinShareToggle=new k({value:j.ShareToLinkedin,icon:"linkedin",className:"default large-icon"})]}:"",(this.shareFb)?{tag:"div","class":"share-option facebook",html:[this.fbShareToggle=new k({value:j.ShareToFb,icon:"facebook",className:"default large-icon"})]}:"",(this.shareTwitter)?{tag:"div","class":"share-option twitter",html:[this.twitterShareToggle=new k({value:j.ShareToTwitter,icon:"twitter",className:"default large-icon"})]}:""]}]});var x=UWA.createElement("div",{"class":"share-tabs",html:[w,v]});if(this.linkedinShareToggle){this.linkedinShareToggle.addEvent("onClick",this.onShare.bind(this,this.linkedinShareToggle))}if(this.fbShareToggle){this.fbShareToggle.addEvent("onClick",this.onShare.bind(this,this.fbShareToggle))}if(this.twitterShareToggle){this.twitterShareToggle.addEvent("onClick",this.onShare.bind(this,this.twitterShareToggle))}return x},onShare:function(x,z){var w=this.selectedToggle;if(w===0){this.shareButton.load();var y=this.selectedUsersArray;var v=s.adaptService({url:e.getBaseUrl()+"/api/notification/send",data:{type:this.serverModelName,recipient_hash:y.join(";"),"do":"share",message:this.shareMsg.getValue(),related_model_id:(this.serverModelName==="InstantMessage")?this.model.get("subject6wuri"):this.model.get("mid")},onComplete:this.onShareSuccessful.bind(this),onFailure:this.onShareFailed.bind(this)});f.request(v)}else{if(this.linkedinShareToggle&&(x===this.linkedinShareToggle)){window.open("https://www.linkedin.com/shareArticle?mini=true&url="+escape(this.urlForLinkedin),"_blank","width=600,height=343,resizable=yes")}else{if(this.fbShareToggle&&(x===this.fbShareToggle)){window.open("http://www.facebook.com/sharer.php?u="+escape(this.url),"_blank","width=600,height=268,resizable=yes")}else{if(this.twitterShareToggle&&(x===this.twitterShareToggle)){window.open("https://twitter.com/intent/tweet?url="+escape(this.url),"_blank","width=600,height=343,resizable=yes")}}}this.modal.hide()}},onShareSuccessful:function(){this.modal.hide();this.shareButton.load(false);var v=this.alert("success",j.Sharesuccessful)},onShareFailed:function(v){var x=j.Sharefailed,w=v&&v.errorcode;if(w&&(w==="ERROR_COMMUNITY_SHARE_CONTENT_NOT_AUTHORIZED")){x=j.Shareaccesserror}this.shareButton.load(false);this.alert("error",x)},onShareToggle:function(v,x){this.selectedToggle=x;if(this.modal){var w=this.modal.getFooter();switch(x){case 0:w.show();break;case 1:w.hide();break;case 2:w.hide();break;default:console.log("share toggle index not found");break}}},launchModal:function(){var v=this;this.modal=this.addControl("shareContentModal",new c({renderTo:window.widget&&window.widget.body,closable:true,header:"<h4>"+this.shareTitle+"</h4>",body:this.createBody(),footer:[this.shareButton,this.cancelButton],events:{onHide:function(){this.modal.destroy();this.destroy()}.bind(this),onShow:function(){new g({container:document.querySelector("#share-tabs-navigation"),bind:document.querySelector("#share-tabs-section"),events:{onToggle:function(w,x){v.onShareToggle(w,x)}}})}.bind(this)}})).inject(document.body).show()}});return u});define("DS/SwymUIComponents/script/utils/media-utils",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/WAFData/WAFData","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/utils/media-utils-v0","DS/SwymUIComponents/script/utils/media-utils-v1","DS/Logger/Logger"],function(h,c,k,i,e,d,b){function l(n){var m=new c({mid:n});return m}function g(m){var n;if(typeof m.get==="function"){n=m.get("processing_version")}else{n=m.processing_version||m.preview_media_processing_version}return n}function j(){return(window.ds&&(window.ds.env==="MOBILE"))}var f={};f.MEDIA_THUMBNAIL=c.MEDIA_THUMBNAIL;f.PICTUREVIEW_V0=c.PICTUREVIEW_V0;f.PICTUREVIEW_V1=c.PICTUREVIEW_V1;f.MEDIA_TYPE={PICTURE:"picture",IMAGE:"picture",SOUND:"sound",AUDIO:"sound",VIDEO:"video",DRAWING:"drawing",DOCUMENT:"document","3D_MODEL":"3d_model","3DMODEL":"3d_model"};f.MEDIA_PROCESSING_STATUS=c.MEDIA_PROCESSING_STATUS;f.CONTENT_SECTION_MAX_WIDTH=740;f.CONTENT_SMALL_IMAGE_MAX_WIDTH_RATIO=31/100;f.CONTENT_SMALL_IMAGE_MAX_WIDTH=Math.ceil(f.CONTENT_SECTION_MAX_WIDTH*f.CONTENT_SMALL_IMAGE_MAX_WIDTH_RATIO);f.CONTENT_LARGE_IMAGE_MIN_WIDTH=Math.max(f.PICTUREVIEW_V0.DIMENSIONS.SMALL.WIDTH,f.CONTENT_SMALL_IMAGE_MAX_WIDTH);f.isPictureViewAvailable=function(p){var n,o,m;if(p){n=l(p);o=g(n);if(parseInt(o,10)===1){m=d.isPictureViewAvailable(n)}else{m=e.isPictureViewAvailable(n)}}return m};f.getBestMediaViewConfig=function(r,n,o,m){var p,q,s;if(r){p=l(r);q=g(p)}if(parseInt(q,10)===1){s=d.getBestMediaViewConfig(p,n,o,m)}else{s=e.getBestMediaViewConfig(p,n,o,m)}return s};f.getLargestMediaDisplayDimensions=function(m){var n,o;n=g(m);if(parseInt(n,10)===1){o=d.getLargestMediaDisplayDimensions(m)}else{o=e.getLargestMediaDisplayDimensions(m)}return o};f.getMediaViewerModuleByMediaType=function(m,q,o){var n=null,p="DS/SwymUIComponents/script/feature/community/media/view/";if(!q||(o&&o.prevent3DPlayInstantiation===true)||(window.ds&&window.ds.env==="3DSearch")){q="view"}if(window.ds&&window.ds.env==="3DSearch"){m="picture"}switch(m){case"picture":case"drawing":n=p+"picture-viewer";break;case"animatedPicture":if(j()){n=p+"animated-picture/mobile/gif-video-viewer";break}case"video":case"sound":n=p+"video-viewer";break;case"document":n=p+"document-viewer";break;case"3d_model":if(o&&o.prevent3DPlayInstantiation===true){n=p+"picture-viewer"}else{n=p+"media-3d-viewer"}break;default:break}if(q==="edit"){if(m==="picture"){n="DS/SwymUIComponents/script/feature/community/media/editor/view/image-editor-view"}}if(q==="360Activated"){if(m==="picture"){n=p+"media-360-viewer"}}return n};f.getMediaViewerModule=function(n,o,m){if(!n){throw new Error("No media model provided")}if(!(n instanceof c)){throw new Error("The provided model is not a MediaModel")}return f.getMediaViewerModuleByMediaType(n.get("media_type"),o,m)};f.getImageRenderingOptionsForMedia=function(m,x,t,w,v){var u,n,p={},s,q,r,o;if(m&&x&&t&&w){m=parseInt(m,10);x=parseInt(x,10);if(m&&x){if((m<t)&&(x<w)){p={extraAttributes:{styles:{width:m+"px",height:x+"px","background-color":"#e2e4e3"},"data-styles-to-remove-after-load":"width, height, background-color"}}}else{r=m/x;o=t/w;if(r<=o){if(x>w){q=w}else{q=x}s=q*(r)}else{if(m>t){s=t}else{s=m}q=s/(r)}p={extraAttributes:{styles:{"max-height":w+"px","max-width":t+"px",width:s+"px",height:q+"px","background-color":"#e2e4e3"},"data-styles-to-remove-after-load":"width, height, background-color"}}}if(v&&p&&p.extraAttributes&&(u=p.extraAttributes.styles)){u["background-image"]='url("'+i.getMediaDefaultThumbnail(v)+'")';u["background-size"]="contain";u["background-position"]="center center";n=p.extraAttributes["data-styles-to-remove-after-load"];if(n){p.extraAttributes["data-styles-to-remove-after-load"]=n.concat(", background-image, background-size, background-position");p.extraAttributes["data-media-width"]=s;p.extraAttributes["data-media-height"]=q}}}}return p};f.request3DSAAuthentification=function(o){var t=o&&o.authenticationUrl,n=o&&o.successCallback,r=o&&o.failureCallback,s=0,q=function(u){var v=(u.returnresponse&&u.returnresponse.code)?u.returnresponse.code:null;if(v===200){b.log("3DSA authentification successful");n&&n()}else{b.log("3DSA response contains an error");r&&r()}},p=function(){s++;b.error("Basic user info failure call, nbFailure:",s);if(s<2){b.error("Basic user info extra call");k.authenticatedRequest(t,m)}else{b.error("No more Basic user info call");if(r){r()}}},m={method:"GET",type:"json",onComplete:q,onFailure:p};k.authenticatedRequest(t,h.extend(m,o))};f.getBestDimensionsDisplayForVideo=function(q,t,s){if(q.get("media_type")==="video"||q.get("media_type")==="animatedPicture"){if(t&&s){var p,m,o=parseInt(q.get("width"),10),r=parseInt(q.get("height"),10),n=o/r;if(o>s||r>t){if(o/s>r/t){p=Math.min(o,s)}else{p=t*n;m=t}}else{p=o;m=r}return p>=244?{height:m,width:p}:{height:244/n,width:244}}else{b.error("_getBestDimensionsDisplayForVideo - Please provide a valid container height and container width")}}else{b.error("_getBestDimensionsDisplayForVideo requires a media of type Video")}};var a=function(n,m){var o=null;if(n&&m){o=n.getChanges(m)||n.get(m)}return o};f.getImageTagFromMedia=function(o,r){if(!h.is(r,"function")){throw new Error("A callback is expected")}var m=a(o,"media_type"),n=a(o,"preview_fingerprint"),p=(m==="video"||m==="3d_model"?"520px":"320px");if(a(o,"mid")){r.call(this,h.createElement("img",{"data-media-id":a(o,"mid"),"data-fingerprint":n?n:undefined,"data-media-type":m,"data-source":"swym",styles:(m!=="picture"?{width:p}:{})}))}else{if(m==="picture"){var q="DS/SwymUIComponents/script/feature/community/media/edit/thumbnail/upload-progress-media-thumbnail-view";require([q],function(s){s.renderUploadingMedia(o,function(t,v){var u=h.createElement("img",{"data-media-type":"picture","data-new_media":"true","data-media_cid":o.cid});u.onload=function(){if(u.height){u.setStyles({width:u.width+"px",height:u.height+"px"})}else{u.set({src:i.getMediaDefaultThumbnail("picture")});u.setStyles({width:p})}r.call(this,u)};if(v){u.set({src:v})}else{if(h.is(o.getChanges().userFile.type)&&o.getChanges().userFile.type==="image/tiff"){u.onload=null;u.set({src:i.getMediaDefaultThumbnail("picture")});u.setStyles({width:p});r.call(this,u)}}}.bind(this))}.bind(this))}else{if(a(o,"objectId")){r.call(this,h.createElement("img",{src:o.get("displayPreview",{escapeHTML:false}),"class":"text-editor-media-placeholder","data-new_media":"true","data-media_cid":o.cid,styles:{width:p}}))}else{r.call(this,h.createElement("img",{src:i.getMediaDefaultThumbnail(m),"class":"text-editor-media-placeholder","data-media-type":m,"data-new_media":"true","data-media_cid":o.cid,styles:{width:p}}))}}}};f.generateBestThumbnailForContentView=function(m,x,s,B){var o,r,A,p,w,v,z,q,n,u,y=B&&B.imgTag,t={};m=parseInt(m,10);x=parseInt(x,10);if(!m){m=f.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.WIDTH}if(!x){x=m/u}if(!s&&!y){throw new Error("Both Model and Image tag are missing from arguments")}if(s){z=s.get("media_type");q=s.get("mid");n=s.get("preview_fingerprint")}else{z=B.mediaType;q=B.mediaId;n=B.previewFingerprint}p=f.getBestMediaViewConfig(q,m,x,"whats-new-mode");A=p.size;w=p.width;v=p.height;r=p.spriteKey;o=p.spriteType;t["data-size"]=y&&y.getAttribute("data-size");if(!t["data-size"]){delete t["data-size"]}t["data-position"]=y&&y.getAttribute("data-position");if(!t["data-position"]){delete t["data-position"]}return{mediaId:q,mediaType:z,previewType:p.previewType,useVariableSizeSprite:true,width:w,height:v,widthToDisplay:m,heightToDisplay:x,spriteKey:r,spriteType:o,imageFingerprint:n,sizeCategory:A,url:p.url,extraAttributes:t}};f.generateImageReloadOptionsForMedia=function(v){var n,o,m,p,t,u,q,s,r;o=v.mediaId;m=parseInt(v.mediaWidth,10)||0;t=parseInt(v.mediaHeight,10)||0;p=m?(m/t):(4/3);r=parseInt(v.containerWidth,10)||0;s=parseInt(v.containerHeight,10)||(r&&(r/p));n=f.getBestMediaViewConfig(o,r,s,"whats-new-mode");u=n.size;if(n.previewType==="picture"){q={size:u,imageKind:"picture"}}else{q={size:u,imageKind:"thumb"}}return q};f.getPreviewThumbnail=function(r){var z,v,m,D,u,n,t,o,w=parseInt(r.container.getSize().width),C=r.containerHeight||parseInt(r.container.getSize().height),q=r.model,B=q.get("media_type"),A={};if(B!=="sound"){m=parseInt(q.get("width"),10);u=q.get("ratio",{escapeHTML:false})||"4/3";z=parseInt(u.split("/")[0]);v=parseInt(u.split("/")[1]);D=m*v/z;if((B==="picture")&&r.useOriginal&&w>=m&&C>=D){A=q.get("play").download_original_url;A.url=A.transient_url}else{o=q.get("mid");n=f.getBestMediaViewConfig(o,w,C);if(n.previewType==="picture"&&q.get("play")&&q.get("play").view){t=q.get("play").view}else{t=q.get("preview").thumbnails}for(var p=0,s=t.length;p<s;p++){if(t[p].alias===n.size){A=t[p];break}}A.url=n.url}}return A};return f});define("DS/SwymUIComponents/script/feature/community/media/view/document-default-viewer",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Spinner","DS/SwymUIComponents/script/utils/media-utils"],function(d,c,b,e){var a=c.extend({name:"document-default-viewer",_getDownloadUrl:function(){if(!this._downloadUrl&&this.model){var f=this.model,g=f.get("play");this._downloadUrl=g&&g.download_original_url&&g.download_original_url.transient_url_as_attachment}return this._downloadUrl||""},_createContent:function(){var g=this.model,f=null;if(g.get("preview")!==undefined){f=e.getPreviewThumbnail(this).url;return d.createElement("div",{"class":"docpreview",html:[{tag:"a",href:this._getDownloadUrl(),target:"_blank",download:"",styles:{outline:"none"},html:{tag:"img",styles:{"margin-left":"35%",width:"30%","margin-bottom":"5px",border:"1px solid #C4C4C4"},src:f}}]})}else{return{styles:{"text-align":"center",height:"40px",margin:"10px"},html:new b({className:"msg-animation",visible:true,animate:true,spin:true})}}}});return a});define("DS/SwymUIComponents/script/feature/community/content/view/media-download-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/content-details-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils","DS/UIKIT/Input/Button","DS/Logger/Logger","DS/SwymUICore/script/utils/localstorage-utils","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Text","DS/SwymUICore/script/lib/request/data","DS/SwymUICore/script/lib/model/generic/swym-model"],function(j,f,g,d,i,k,h,a,b,l,c,m,n){var e=g.extend({_modelClass:d,_modelEventsForAutoRefresh:["onChange:download_original_file","onSync:read"],name:"media-download-view",domEvents:{"click #download-link":"_onDownloadLink","click .kindle-button":"_onKindleBtnClick"},_sendMail:function(){var p=localStorage.getItem("kindleUrl");var o=n.adaptService({url:"api/media/sendtomail/id/"+this.model.get("mid")+"/email/"+p,method:"GET",onComplete:function(){this.alert("success","The pdf file was successfully sent to your kindle app!")}.bind(this)});m.request(o)},_onKindleBtnClick:function(){var o=localStorage.getItem("kindleUrl"),q=this;if(!o){var r=this.addControl("input-kindle",new c({placeholder:"Enter your Kindle url..."}));var p=new l({className:"kindle-url-modal",closable:false,header:"<h4>Send the pdf file to your kindle</h4>",body:{html:[this.getControl("input-kindle")]},renderTo:this._widget?this._widget.body:document.body,footer:[this.addControl("ok-btn",new h({value:"Ok",className:"primary add-link",key:"return",events:{onClick:function(){console.log("text:",r);localStorage.setItem("kindleUrl",r.getValue());p.hide();this._sendMail()}.bind(q)}}))]});p.show()}else{this._sendMail()}},_createContent:function(){var p=[],o=this.model;if(o.hasBeenFetched()&parseInt(o.get("download_original_file"),10)===1||o.get("media_type")==="document"){p=j.createElement("div",{"class":"download-wrapper",html:[(o.get("media_type")==="3d_model")?{"class":"download-3dfile-icon",html:[{"class":"wrapper-3dfile-formats",html:this.createDownloadUIFor3DModel()}]}:{html:[{tag:"button","class":"btn btn-primary",id:"download-link",html:f.Download},k.isFeatureActivated("activateSendToKindle")?{tag:"img",alt:"kindle-btn",styles:{"margin-top":"10px",cursor:"pointer"},src:"webapps/SwymUIComponents/assets/kindle-btn.png","class":"kindle-button"}:{}]}]})}return p},createDownloadUIFor3DModel:function(){var r=this.model,p=r.get("status"),s=null;if(r.get("play")&&r.get("play")["3d_streams"]){s=r.get("play")["3d_streams"];var u=r.get("play").download_original_url;if(u&&u.authorized_by_owner==="1"){s.push(j.merge(u,{alias:u.format}))}if(p===i.MEDIA_PROCESSING_STATUS.OK){var o={className:"primary"};if(s.length>1){var t={},v=[];var x=function(y){t[y.alias]=y.transient_url_as_attachment};s.forEach(x);for(var w in t){v.push({text:w})}o=j.merge(o,{value:f.DownloadAs,dropdown:{items:v},events:{onDropdownClick:function(z,y){if(y.text){window.open(t[y.text],"_self")}else{a.log("item value is undefined")}}}})}else{o=j.merge(o,{value:f.Download,events:{click:function(){window.open(s[0].transient_url_as_attachment,"_self")}}})}var q=new h(o);return q}}},_onDownloadLink:function(){var o=this.model,p=window.ds&&(window.ds.env==="MOBILE"),r=o.get("play").download_original_url.transient_url_as_attachment,q=o.get("play->download_original_url->transient_url",{escapeHTML:false}),s=o.get("play->download_original_url->format");if(p){require(["DS/SwymUICore/script/feature/core/mobile/communication-manager"],function(t){t.sendOpenMediaRequest({transientURL:q,extension:s})})}else{window.open(r,"_blank")}this.dispatchEvent("onMediaDownload");return false}});return e});define("DS/SwymUIComponents/script/feature/community/content/view/content-viewer-view",["DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/utils/media-utils"],function(c,d){var b=c.extend({}),a=c.extend({name:"content-viewer-view",className:"container-fluid",mediaDescription:null,defaultOptions:{bodyViewMode:"view",innerBodyViewMode:"",prevent3DPlayInstantiation:false},setModel:function(f,e){e=e||{};e.refresh=false;return this._parent.call(this,f,e)},setup:function(g){var h=this,f=g.model||this.model;if(f){var e=this._parent.apply(this,arguments);if(!g){g={}}this._addBodyView();if(f.getModelName()==="media"){this.listenTo(this.model,"onChange:media_type",this._addBodyView);this.listenTo(this.model,{"onSync:read":function(){var i=this.getChildView("mediaDetailsView");if(i){i.refresh()}}});this.addChildView("mediaDetailsView",{model:f,Class:"DS/SwymUIComponents/script/feature/community/media/view/media-details-view",widget:this._widget,showDownloadButton:true})}if(this._rendered===true&&g.refresh!==false){this.refresh()}return e}},_addBodyView:function(){var e=this._getBodyViewClass();if(e){this.addChildView("bodyView",{model:this.model,Class:e,viewMode:this.getOption("bodyViewMode"),innerBodyViewMode:this.getOption("innerBodyViewMode")})}},_getBodyViewClass:function(){var e,f=this.model;if(f&&f.getModelName()==="media"){e=d.getMediaViewerModule(f,null,{prevent3DPlayInstantiation:this.options.prevent3DPlayInstantiation});if(!e){e=b}}else{if(f&&f.getModelName()==="survey"){e="DS/SwymUIComponents/script/feature/community/survey/view/legacy-survey-view"}else{e="DS/SwymUIComponents/script/feature/community/content/view/content-body-view"}}return e},_createContent:function(){var f="",e=this.model;if(e){f=[this.getChildView("bodyView"),(this.model.getModelName()==="media"?this.getChildView("mediaDetailsView"):"")]}return f},editComment:function(f,e){this.model.dispatchEvent("CommentEditing",[f,e])}});return a});define("DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager",["UWA/Core","UWA/Class/Options","DS/SwymUICore/script/lib/pub-sub","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-definition","DS/WebappsUtils/Console"],function(d,f,i,g,c,b){var e=0;function h(j,m,l,n){var k;if(j===0){return null}else{k=l[m[j-1]];if(k&&k.container&&n.contains(k.container)){return k}else{return h(j-1,m,l,n)}}}var a=i.singleton(f,{_alreadyCleanedManager:null,_taggingContextManager:null,_realTimeEventManager:null,defaultOptions:{layoutView:null,pageModulesPath:null,resetLayout:false},_createView:function(l,p,j,o,n,k){var m=this,q=d.extend({},this.getOption("viewsDefaultParams"));if(!n.getChildView(l)&&(k.layoutPath===g.getInstance().getLayoutPath())){k=k||{};d.extend(q,o[l]);if(q&&q.Class){if(!n.isDestroyed()){n.addChildView(l,q,{callback:function(t){var s=k.containerSelector?n.container.getElement(k.containerSelector):n.container,r=h(j,p,n.getChildViews(),s);if(r){t.inject(r.container,"after")}else{t.inject(s,"top")}if((typeof(k.callback)==="function")){k.callback.call(m,t,l)}if(t.isVisible()){m.dispatchEvent("onViewShow",[t])}}})}}else{b.warn("Child view definition is incorrect. The class is missing.")}}},_handleChildViewsVisibility:function(j,m,o,l,k){var n=j.getChildViews();if(!m){m={}}Object.keys(n).forEach(function(p){var q=n[p];if(!m[p]){q.hide();this.dispatchEvent("onViewHide",[q])}else{q.show();this.dispatchEvent("onViewShow",[q])}},this);(l||Object.keys(m)).forEach(function(r,v,p){if(m[r]){var s,t,x,q=null,w=null,u=j.getChildViews()[r];if(!u){s=k?d.extend({},k):{};if(o){x=o[r];if(x){s.containerSelector=x.containerSelector;w=x.widthThreshold}}if(d.is(w,"number")){s.callback=function(){if(d.is(k.callback,"function")){return k.callback.apply(this,arguments)}};t=this._createView.bind(this,r,p,v,m,j,s);q=function(){if(document.body.getSize().width>w){document.body.removeEvent("resize",q);t();return true}};if(q()!==true){document.body.addEvent("resize",q,false,e);this.addEventOnce("onViewCreationRequest:"+r,t,this,false,e);++e}}else{this._createView(r,p,v,m,j,s)}}else{if(k&&(typeof(k.callback)==="function")){if(u.name==="dummy-view"){j.addEventOnce("onChildViewAdd:"+r,(function(y){k.callback.call(this,y,r)}).bind(this))}else{k.callback.call(this,u,r)}}}}},this)},_onContextChange:function(){var k=g.getInstance(),m=k.getLayoutPath(),l=c.getNode(m),j=l.layoutDefinition;if((l.failedToFindRequestedNode===false)||(l.initialLayoutRoute.endsWith("/edit"))||(k.path.indexOf("/comment")>=0)||(k.path.indexOf("/reply")>=0)||(k.path.indexOf("/answer")>=0)||(k.path.indexOf("/message")>=0)){this._handleChildViewsVisibility(this.options.layoutView,c.getRootViewsDefinition(m),j,null,{layoutPath:m,callback:function(p,n){var o=j[n];if(m===g.getInstance().getLayoutPath()){this._handleChildViewsVisibility(p,o.views,null,o.viewsOrder,{layoutPath:m,containerSelector:o.viewsContainerSelector})}}})}},setTaggingContextManagerInstance:function(j){this._taggingContextManager=j},getTaggingContextManagerInstance:function(){return this._taggingContextManager},setRealTimeEventManager:function(j){this._realTimeEventManager=j},getRealTimeEventManager:function(){return this._realTimeEventManager},applyLayoutDefinition:function(j){var k=this;if(!j.pageModulesPath){throw new Error("Root path of page modules is required")}this.setOptions(j);c.getTree({pageModulesPath:this.options.pageModulesPath,reset:this.options.resetLayout,callback:function(l){d.extendElement(document.body);if(d.is(j.layoutSetupFunction,"function")){j.layoutSetupFunction.call()}g.getInstance().addListener("onContextChange",k._onContextChange,k,true)}})},clean:function(){if(!this._alreadyCleanedManager){this.removeEvents();this.stopListening();delete this.options;g.getInstance().removeListener("onContextChange",this._onContextChange);this._taggingContextManager=null;this._realTimeEventManager=null;this._alreadyCleanedManager=true}}});return a});define("DS/SwymUIComponents/script/feature/community/wiki/view/wiki-tree-expanded-modal",["UWA/Core","UWA/Utils/Client","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUICore/script/feature/community/wiki/model/wikitree-model","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-view","DS/SwymUIComponents/script/utils/content-creation-types-manager","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/feature/core/context/context-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/edit/wiki-creator-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/view/wikitree-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/content-creation-view"],function(i,l,f,j,g,c,o,m,b,a,e,d,h,n){var k=j.extend({_destroyed:false,_context:null,defaultOptions:{className:"wiki-tree-expanded",closable:true},init:function(q){var r=this,p,s;if(q&&q.communityId&&q.widget){s=new g({community_id:q.communityId},{autoPopulate:true});this.innerView=new o({addScroller:true,model:s,widget:q.widget,moveOnlyCurrentNode:q.moveOnlyCurrentNode,creation:q.creation,editable:false,events:{onInit:function(){this.reactTo(this,"currentPageChange",function(t){if(t.dontSetModel!==true&&r){r.hide()}})}}});q.contentId&&s.setCurrentPage(new c({mid:q.contentId}));p=q.enterEditMode&&!l.Platform.ios&&!l.Platform.android;q.header="<h4>"+d.Wikitree+"</h4>";q.body=(q.mode==="edit"?this.innerView:[{"class":"wiki-tree-expanded-modal-toolbar",styles:{"text-align":"right"},html:[q.addWiki?new f({value:n.Addawiki,className:"link",icon:"doc-add",events:{onClick:function(){r.hide();r._createWikiPage()}}}):"",(q.addWiki&&p)?"|":"",p?new f({value:h.Enterwikitreeeditmode,className:"link",icon:"pencil",events:{onClick:function(){this.setValue((r.innerView.editable?h.Enterwikitreeeditmode:h.Exitwikitreeeditmode));r.innerView.toggleEdit()}}}):""]},this.innerView]);q.renderTo=q.widget.body;if(q.mode==="edit"){this.innerView.toggleEdit()}}this._parent.apply(this,arguments)},_createWikiPage:function(){var q=this,p=e.getInstance();b.dispatchEvent("hideLayout");var r=new Promise(function(s){if(p.getCommunityContentListContext()==="wiki"){return s()}p.addOnce("onContextChange",s);a.goToCommunity(q.options.communityId,e.COMMUNITY_WIKI)});r.then(function(){var s=m.getInstance();setTimeout(function(){s.setContentTypeRequest({type:"wiki",updateIcon:true,forceFocus:true,userAction:true})},100)})},destroy:function(){if(this._destroyed===false){this._destroyed=true;this.innerView.destroy();this.innerView=null;this._parent.apply(this,arguments)}}});return k});define("DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager"],function(i,e,f,a){var j={UNDEFINED:-1,SUMMARY:0,DETAILED:1,EDIT:2},b={SUMMARY:"summaryView",DETAILED:"detailedView",EDIT:"editView"},g=function(k,l){if(this.getOption(l)!==undefined){k[l]=this.getOption(l)}},h=f.extend({name:"dummy-item-view",_createContent:function(){return i.createElement("div",{"class":"dummy-content-view",html:[{tag:"div","class":"dummy-content-header"},{tag:"div","class":"dummy-content-author-picture"},{tag:"div","class":"dummy-content-author-section"},{tag:"div","class":"dummy-content-line"},,{tag:"div","class":"dummy-content-line"},,{tag:"div","class":"dummy-content-line"},,{tag:"div","class":"dummy-content-line"}]})}}),d=["comments","showAnswers","ActionMenuClass","iconCls","socialToolbarMode","showAuthorSection","onAfterSocialToolbarRendered"],c=e.extend({MODES:j,defaultOptions:{iconCls:"",mode:j.UNDEFINED,summaryViewClass:"DS/SwymUIComponents/script/feature/community/content/view/content-summary-view",detailedViewClass:"DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view",editViewClass:"DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view",summaryViewOptionsAttributes:d,detailedViewOptionsAttributes:d,editViewOptionsAttributes:["iconCls"],summaryViewEvents:undefined,detailedViewEvents:undefined,editViewEvents:undefined,comments:true,showAnswers:true},name:"content-in-feed-view",className:"community-content-wrapper content-item",_createSummaryView:function(){var l=this.model,n=this,m=null,k={Class:this.getOption("summaryViewClass"),model:l};this.getOption("summaryViewOptionsAttributes").forEach(function(o){g.call(n,k,o)});if(this.getOption("summaryViewEvents")!==undefined){k.events=this.getOption("summaryViewEvents")}if(l){m=this.addChildView("summaryView",k)}return m},_createDetailedView:function(){var m=this.model,n=this,k=null,l={Class:this.getOption("detailedViewClass"),model:m};this.getOption("detailedViewOptionsAttributes").forEach(function(o){g.call(n,l,o)});if(this.getOption("detailedViewEvents")!==undefined){l.events=this.getOption("detailedViewEvents")}if(m){k=this.addChildView("detailedView",l)}return k},_createEditView:function(){var l=this.model,m=this,n=null,k={Class:this.getOption("editViewClass"),model:l};if(l){this.mask();this.getOption("editViewOptionsAttributes").forEach(function(o){g.call(m,k,o)});if(this.getOption("editViewEvents")!==undefined){k.events=this.getOption("editViewEvents")}n=this.addChildView("editView",{Class:"DS/SwymUICore/script/lib/view/generic/swym-view"});l.fetch({fromCache:true,onComplete:function(){m.unmask();m.addChildView("editView",k)},onFailure:function(){m.unmask()}})}return n},onRedraw:function(){if(this.isMasked()){this.mask()}},_createContent:function(){var k=this.model;if(k){switch(this.getOption("mode")){case j.DETAILED:return this._createDetailedView();case j.EDIT:return this._createEditView();case j.SUMMARY:default:return this._createSummaryView()}}},_switchToModeView:function(o){var n,m,l;if(this.getOption("mode")===j[o]){return false}this.setOption("mode",j[o]);if(!this._rendered){this.render()}else{l=b[o];m=this.getChildView(l);for(var k in b){if(b.hasOwnProperty(k)&&(k!==l)){n=this.getChildView(b[k]);if(n){n.hide()}}}if(!m){m=this._createContent()}if(!this.container.contains(m.container)){m.inject(this.container)}m.show();m.refresh()}return this},switchToDetailedView:function(){if(this._switchToModeView("DETAILED")){this.container.removeClassName("edit-mode");this.container.addClassName("full-content");a.dispatchEvent("onSetInstanceTagsRequest",[this.model])}},switchToEditView:function(){if(this._switchToModeView("EDIT")){this.container.addClassName("edit-mode");this.container.addClassName("full-content");a.dispatchEvent("onSetInstanceTagsRequest",[this.model])}},switchToSummaryView:function(){if(this._switchToModeView("SUMMARY")){this.container.removeClassName("edit-mode");this.container.removeClassName("full-content")}},onUnMaximize:function(){this.switchToSummaryView()},createDummyView:function(k){return new h(k)}});return c});define("DS/SwymUIComponents/script/feature/core/ui-components/list/item-list",["UWA/Core","UWA/Event","UWA/Array","UWA/Class/View","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/utils/scrollview-utils","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUIComponents/script/utils/dnd-utils","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/utils","DS/UIKIT/Spinner","DS/SwymUIComponents/script/feature/core/ui-components/list/dynamic-grid","DS/SwymUICore/script/feature/core/context/context-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/item-list"],function(i,j,c,a,l,q,b,o,k,h,f,d,m,g){var p=null;var n={layout:"small",offset:25,verticalOffset:25,align:"left"};var e=l.extend({name:"item-list",className:"item-list fade-in-animation",_containerWidth:null,_delegateSpriteReloadToParentView:false,_onlyBodyUpdateOnIncrementalRefresh:true,_toBeTemporarilyRemovedFromDomOnRefresh:false,_linkGeneration:true,_collectionEvents:{onRequest:"_onRequest",onSync:"_onSync","onSync:read":"_refreshIfEmpty","onSync:filter":"unmask","onError:filter":"unmask",onServerFilteringRequest:"_onServerFilteringRequest",onRemove:"_removeModelView"},_modelsBeforeCommentCallMutualizerDiff:null,_nbCommentCallsToMutualize:0,_removeModelView:function(r){},itemViewSelector:"",defaultOptions:{maximizeItemViewOnSelection:false,debounceDelay:50,mutualizeCommentsInitCalls:false,commentCallMutualizerOptions:null,sendCollectionTagsToTagger:undefined},domEvents:{resize:"_onResize"},_refreshIfEmpty:function(){if(this.collection&&this.collection.length===0){this.refresh()}},setup:function(r){this.view=r.view||a;if(r.useDynamicGrid){this._useDynamicGrid=r.useDynamicGrid}this._dynamicGridOptions=this.getOption("dynamicGridOptions")||{};this._dynamicGridOptions.handledView=this;this._dynamicGridOptions.modelViewsAsItems=true;this.newItems=[];if(this._useDynamicGrid){this._syncGrid=h.debounce(this._syncGrid,this.options.debounceDelay)}this._parent.apply(this,arguments);var s=this;s.reactTo(b,{onPullToRefresh:s.onPullToRefresh.bind(s),onInfiniteScroll:s.onInfiniteScroll.bind(s),GetItemListCollection:function(){if(s.isVisible()){if(s.collection){b.dispatchEvent("ReturnItemListCollection",s.collection)}else{s.addEventOnce("onSetCollection",function(){b.dispatchEvent("ReturnItemListCollection",s.collection)})}}}})},modelViewsCfg:function(){var r={};if(this._useDynamicGrid){return{attributes:i.extend(r,{styles:{opacity:"0"}})}}else{return{attributes:r}}},_getNbCommentCallsToMutualize:function(){return this._nbCommentCallsToMutualize},_onRequest:function(r,t,s){if(r===this.collection){if(s&&s.reset===true){this.requestInfiniteScrollActivation();if(r.hasBeenFetched()){this.mask()}}this._modelsBeforeCommentCallMutualizerDiff=this.collection.toArray()}},_onSync:function(r,x,t){var w=this,v,u=this._modelsBeforeCommentCallMutualizerDiff,s=function(){if(v>0){p.openCallWindow(i.extend({nbInitCallsToMutualize:v,tenantId:k.getInstance().get("config").tenant.online_instance_id,serviceUrl:k.getInstance().get("3dcommentUrl")||h.getBaseUrl(),commentsNumberAtInit:2},w.getOption("commentCallMutualizerOptions")))}};if((r===this.collection)&&(this.getOption("mutualizeCommentsInitCalls")===true)){v=0;this.collection.forEach(function(z){var y=z.getModelName();if((y!=="survey")&&u&&u.indexOf(z)===-1){++v}});this._nbCommentCallsToMutualize=v;this._modelsBeforeCommentCallMutualizerDiff=this.collection.toArray();if(v>0){if(p){s()}else{require(["DS/SocialToolbar/CallMutualizer"],function(y){p=y;s()})}}}},_onServerFilteringRequest:function(){var r=m.getInstance(),s=(this.collection.exaleadFilters.length>0||this.collection.exaleadQuery!=="#all");r.dispatchEvent("onFilteringChange",[s],true);b.dispatchEvent("onScrollToTopRequest")},_getIncrementallyCreatedModelViewContainer:function(t,r){var s=this.container&&this.container.getElements(".container-column")||[];if(s.length>0){return s[r%s.length]}else{return this._parent.apply(this,arguments)}},_createContent:function(){var t,w,s,r=m.getInstance(),v=this.collection,u={padding:"30% 0","text-align":"center",width:"100%"};if(v){if(v.length===0){if(!v.hasBeenFetched()){w=this.addControl("spinner",new f());w.show();w.getContent().setStyles(u);t=w}else{if(v.lastCalledService==="filter"){s=g.NoSearchResultToDisplay}else{s=v.getCollectionName()==="mixed-collection"?(r.isDirectMessageContext()?g.EngageConversation:g.Engage)+"</br></br>"+g.Start:g.ThereIsNothingToDisplayYet}t=i.createElement("div",{"class":"dsi-noresult",styles:u,html:{tag:"span",styles:{color:"#B4B6BA","font-size":"16px"},html:s}});if(v.getCollectionName()==="mixed-collection"){b.dispatchEvent("onCommunityWhatsnewEmpty")}}}else{t=this._parent.apply(this,arguments)}return t}},onPullToRefresh:function(r){if(this.isVisible()&&this.collection){q.onPullToRefresh.apply({collection:this.collection,scrollView:r})}},onInfiniteScroll:function(r){if(this.isVisible()&&this.collection){q.onInfiniteScroll.apply({collection:this.collection,scrollView:r})}},hasStructureDummyViews:function(r){var v=Object.keys(r._childViews),u=v.length,s=false,w=null;if(r===this){v=v.slice(-r.collection.getLimit());u=v.length}if(u===0&&r.name==="dummy-view"){s=true}else{for(var t=0;t<u;t++){w=r.getChildView(v[t]);s=s||this.hasStructureDummyViews(w)}}return s},_updateBodyCompletelyWithModelViews:function(){this._parent.apply(this,arguments);if(this._useDynamicGrid===true){this._syncGrid()}},_updateBodyIncrementalyWithModelViews:function(){this._parent.apply(this,arguments);if(this._useDynamicGrid===true){this._syncGrid({incrementalUpdateForExistingColumns:true})}},_syncGrid:function(s){if(this._useDynamicGrid!==true){if(this.hasStructureDummyViews(this)){setTimeout(function(){this._syncGrid(s)}.bind(this),100);return false}if(Object.keys(this._childViews).length===0){return false}}var u=this,t=this.container,r=function(v){if(v&&(v.length>0)){v.forEach(function(w){w.setStyle("opacity",1)})}};if(t){if(!u.dyngrid){u.dyngrid=new d(t,i.merge(u._dynamicGridOptions,n));if(u.collection){u.collection.addEvent("onReset",u.dyngrid.setCollectionHasBeenReset.bind(u.dyngrid,true))}u.addEvent("onSetCollection",u.dyngrid.setCollectionHasBeenReset.bind(u.dyngrid,true));u.dyngrid.render(false,r,s)}else{u.dyngrid.fetchItems();u.dyngrid.render(false,r,s)}}},_onResize:h.debounce(function(){var r=this.container?this.container.getSize().width:null;if(this._useDynamicGrid&&r){if(this._containerWidth!==r){this._syncGrid();this._containerWidth=r}else{this._syncGrid({incrementalUpdateForExistingColumns:true})}}},200),requestInfiniteScrollActivation:function(){b.dispatchEvent("onInfiniteScrollActivationRequest")},onItemSelect:function(s,r){if(s){this.setOption("selectedItemView",s);s.dispatchEvent("onItemSelect",[r]);if(this.options.maximizeItemViewOnSelection){s.listenToOnce(this,"onUnMaximize",function(){s.dispatchEvent("onUnMaximize")});this.maximize(this)}}},onItemClick:function(t){var r,s,u;if(this.itemViewSelector){u=j.getElement(t);if(window.getSelection().toString().length>0){return null}if(u&&(t&&t.target&&t.target.tagName&&t.target.tagName.toLowerCase()!=="a")){t.preventDefault();t.stopPropagation();s=u.getClosest(this.itemViewSelector);r=this.getModelViews?c.detect(this.getModelViews(),function(v){return v.container===s}):this;this.dispatchEvent("onItemSelect",[r,{event:t}])}}},onItemDragStart:function(t){var r,s,u;if(this.itemViewSelector){u=j.getElement(t);if(u){s=u.getClosest(this.itemViewSelector);r=this.getModelViews?c.detect(this.getModelViews(),function(v){return v.container===s}):this;this.dispatchEvent("onItemDrag",[r,t,this._widget])}}},onItemDrag:function(s,t){var r=s.model;o.onItemDrag(r,t,this._widget)},maximize:function(){b.dispatchEvent("onMaximizeRequest",arguments)},unMaximize:function(){b.dispatchEvent("onUnMaximizeRequest",[this])},createItemView:function(r){return this._createModelView(r)},sendCollectionTagsToTagger:function(){if(this.options.sendCollectionTagsToTagger!==false){b.dispatchEvent("onSetInstanceTagsRequest",[this.collection,this.options.taggerSuffix])}},show:function(){if(this.container){this.requestInfiniteScrollActivation();this.container.addClassName("fade-in-animation")}this._parent.apply(this,arguments)},onUnMaximize:function(){this.setOption("selectedItemView",null)},onSetCollection:function(){this.sendCollectionTagsToTagger();return this._parent.apply(this,arguments)},onShow:function(){this.sendCollectionTagsToTagger();return this._parent.apply(this,arguments)}});return e});define("DS/SwymUIComponents/script/feature/community/media/view/interactive-media-thumbnail-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/interactive-media-thumbnail-view","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUIComponents/script/feature/community/media/view/video/player-behaviors","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/feature/core/mobile/utils","DS/SwymUICore/script/utils/utils","DS/UIKIT/Spinner","DS/Logger/Logger"],function(i,f,l,c,h,b,j,d,a){var g=300,e=window.ds&&(window.ds.env==="MOBILE"),k=l.extend({name:"interactive-media-thumbnail-view",_autoplay:false,_interactionActivated:false,_lightboxContext:false,_displayNext:false,_displayPrevious:false,_useOriginalMediaDimensions:false,_displayIconsOnTopRightCorner:false,domEvents:{click:"_interactAfterClickOnThumbnail"},_modelEvents:{"onChange:userFile":"refresh"},setup:function(m){this._parent.apply(this,arguments);this._autoplay=c.getAutoPlayBehavior(m.autoplay,this.model.get("media_type"));if(window.ds&&window.ds.env==="3DSearch"){this.model.set("media_type","picture")}if(m.useOriginalMediaDimensions){this._useOriginalMediaDimensions=m.useOriginalMediaDimensions}if(m.displayIconsOnTopRightCorner){this._displayIconsOnTopRightCorner=m.displayIconsOnTopRightCorner&&(this.model.get("media_type")!=="sound")}if(this.model.get("media_type")==="video"){this._useOriginalMediaDimensions=true}if(m&&(m.delegateSpriteReloadToParentView!==undefined)){this._delegateSpriteReloadToParentView=m.delegateSpriteReloadToParentView;this._bufferImagesReload=false}if(m&&(m.imageReloadOptions!==undefined)){this.imageReloadOptions=m.imageReloadOptions}if(m&&(m.imageRenderingOptions!==undefined)){this._imageRenderingOptions=m.imageRenderingOptions}if(m.displayNext){this._displayNext=m.displayNext}if(m.displayPrevious){this._displayPrevious=m.displayPrevious}if(m.forcePlayInContext){this._lightboxContext=m.forcePlayInContext}this.listenTo(this.model,{"onChange:media_type":this.onRender})},onLoadAnnotationRequestCallback:function(m){var n=this.getChildView("mediaView");if(n&&(n.name==="media-3d-viewer")){n.dispatchEvent("onLoadAnnotationRequestCallback",m)}},_onAnnotationShared:function(m){this.dispatchEvent("onAnnotationShared",m)},_displayMediaView:function(){var o=this,m=this.model,r=m.get("media_type"),n=this.getElement(".thumbnail-icon-overlay")||this.getElement(".sound-thumbnail .fonticon-play"),q=this.getChildView("interactive-action-menu"),p=this.getElement("img[data-content-id]")||this.getElement(".sound-thumbnail")||this.getElement("img[data-type]")||this.getElement(".img-full-picture");if((r==="3d_model"||r==="picture")&&this._lightboxContext===true){p=this.container.parentElement}if(n){n.remove()}if(r==="3d_model"&&q){q.hide()}require([h.getMediaViewerModule(m,"360Activated")],function(w){if(!this.isDestroyed()){var z=p.offsetHeight,v=p.offsetWidth,u=this._useOriginalMediaDimensions?m.get("width"):v,t=this._useOriginalMediaDimensions?m.get("height"):z,x,A=this.addChildView("mediaView",new w({model:m,height:t,width:u,isLightboxContext:this._lightboxContext,events:{onAnnotationShared:this._onAnnotationShared.bind(this),onRefreshRequest:function(){A.destroy();o._interactionActivated=false;o.refresh()}}})),y,s=this.container.getSize();A.addEventOnce("mediaViewReady",function(){this.dispatchEvent("onMediaReady");y=this.container.parentElement;if((r==="video"||r==="animatedPicture")&&y.offsetHeight>0&&y.offsetWidth>0){if(y&&y.offsetHeight>=s.height&&y.offsetWidth>=s.width){x=h.getBestDimensionsDisplayForVideo(m,y.offsetHeight,y.offsetWidth)}else{x=h.getBestDimensionsDisplayForVideo(m,s.height,s.width)}if(x&&x.height){this.container.setStyle("height",x.height+"px")}if(x&&x.width){this.container.setStyle("width",x.width+"px");this.container.setStyle("height",(x.width*t/u)+"px")}}if(r==="3d_model"){this.getElement(".interactive-media-wrapper").removeClassName("cursor-pointer")}a.log("the media is ready");if(this._spinnerElement){this._spinnerElement.remove()}if((["sound"].indexOf(r)>-1)&&v){this.container.style.width=v+"px"}else{if((["3d_model"].indexOf(r)>-1)){if(this._useOriginalMediaDimensions){this.container.style.width=m.get("width")+"px"}else{this.container.style.width="100%"}}}p.hide();this.container.addClassName("media-initialized")}.bind(this));if(!p||!this.container.contains(p)){p=this.getElement("img")||this.getElement(".sound-thumbnail")}if(p){A.inject(p,"after")}if(r!=="document"){A.hide()}this.addEvent("onMediaDownload",function(){A.dispatchEvent("onMediaDownload")});this._interactionActivated=true}}.bind(this))},play:function(){this._play()},_play:function(){this._interactionActivated=true;var q=this.getElement(".thumbnail-icon-overlay")||this.getElement(".sound-thumbnail .fonticon-play")||this.getElement(".thumbnail-icon-play-360"),r=this.getElement("img[data-content-id]")||this.getElement(".sound-thumbnail")||this.getElement("img[data-type]");if(this.model.get("media_type")==="3d_model"&&this._lightboxContext===true){r=this.container.parentElement}if(q){q.remove()}if(r&&!this._spinnerElement){this._spinnerElement=i.createElement("div",{"class":"spinner-thumbnail",html:new d({className:"msg-animation",visible:true,animate:true,spin:true})}).inject(r,"before")}var p=this.model,o=p.get("status"),n=(p.get("format_3dsa")==="3dxml")||(p.get("media_file_ext")==="3dxml")||(p.get("fileName")&&p.get("fileName").endsWith(".3dxml")),m=(p.get("media_file_ext")==="pdf")||(p.get("fileName")&&p.get("fileName").endsWith(".pdf"));if((o===h.MEDIA_PROCESSING_STATUS.KO||o===h.MEDIA_PROCESSING_STATUS.READY)&&!n&&!m){this._displayErrorMessage(o,r)}else{if((o!==h.MEDIA_PROCESSING_STATUS.OK||!n||(n&&!p.get("format_3dsa")))&&!p.isConsideredAsA360MediaModel()&&!m){setTimeout(function(){p.fetch({onComplete:function(t){if(!this.isDestroyed()){var s=t.get("status");if(s===h.MEDIA_PROCESSING_STATUS.OK||(n&&s!==h.MEDIA_PROCESSING_STATUS.KO)){if(t.get("media_type")!=="animatedPicture"||t.isMediaAPlayableGIF()){this._displayMediaView()}else{this._spinnerElement.remove();this._spinnerElement=null}}else{this._displayErrorMessage(s,r)}}}.bind(this)})}.bind(this),1)}else{this._displayMediaView()}}},_displayErrorMessage:function(m,p){var o,n;this._interactionActivated=false;if(m===h.MEDIA_PROCESSING_STATUS.KO){o=f.AnErrorOccuredWhileProcessing;n="error"}else{o=f.ThisMediaHasNotBeenProcessedYet;n="warn"}this.alert(n,o);this._getIconOverlay().inject(p,"before");this._spinnerElement.remove();this._spinnerElement=null},download:function(){this._download()},_download:function(){var n,m=this.model;if(e){b.openMediaInNativeMobileDevice(m,true)}else{this._downloadUrl=j.getBaseUrl()+"/api/media/streammedia/id/"+this.model.get("mid")+"/type/original/output/download/";n=j.getClientInformation();if((n.isIphone||n.isIpad)&&n.isSafari&&this._myNewWindow&&this._myNewWindow.location){this._myNewWindow.location=this._downloadUrl}else{if(window.ds&&window.ds.env==="3DD"){window.open(this._downloadUrl,"_blank")}else{window.open(this._downloadUrl,"_self")}}}this._interactionActivated=false},_isViewerOpeningNeeded:function(){var n=this.model,o=n.get("media_type"),m=false;if(i.is(n.get("play"))&&n.get("play").download_original_url.format==="pdf"){m=true}if(e){return b.shouldBePlayedInLightbox(o)}else{return n.get("user_access")!==false&&this._lightboxContext===false&&(o!=="document"||m)&&(o!=="3d_model")&&(this.container.offsetWidth<g||o==="picture"||o==="drawing"||m)}},_initalizeWindowTrickForSafari:function(){var m=j.getClientInformation();if(this.model.has("media_file_ext")&&this.model.get("media_file_ext")!=="pdf"&&m.isSafari&&(m.isIphone||m.isIpad)){this._myNewWindow=window.open("","_blank")}},_interactAfterClickOnThumbnail:function(q){var m=q.target.getParent(".interactive-media-thumbnail-view-container");if(m&&m.getParent().tagName==="A"&&!q.target.hasClassName("thumbnail-icon-play-360")&&!q.target.hasClassName("fonticon-open-down")){return}if(q.target.hasClassName("fonticon-open-down")){q.preventDefault();q.stopPropagation();return}if(q.target.dataset.deletedMedia==="true"){this.alert("info",f.get("Thismediahasbeendeleted"));return}var p=this.model,r=p.get("media_type");this._shouldActivateAutoplay=true;if(r==="document"&&!i.is(p.get("play"))){q.preventDefault();q.stopPropagation();this._initalizeWindowTrickForSafari();p.fetch({onComplete:function(){if(!this.isDestroyed()){this._interactAfterClickOnThumbnail(q)}}.bind(this)})}else{var n=false;i.extendElement(q.target);if(!q.target.hasClassName("arrow-navigation")&&!q.target.hasClassName("thumbnail-navigation")){q.stopPropagation()}else{n=true}var o=this._isViewerOpeningNeeded();if(o===true){if(r==="picture"&&!p.isConsideredAsA360MediaModel()){this._shouldActivateAutoplay=false}q.preventDefault();this.dispatchEvent("onOpenInViewerRequest",[p,this])}if(this._interactionActivated===false&&o===false&&n===false){if(e&&b.isFormatNativelyPlayable(r)){b.openMediaInNativeMobileDevice(p)}else{switch(r){case"document":q.stopPropagation();if(p.get("play").download_original_url.format!=="pdf"){this._download()}break;case"picture":break;case"3d_model":if(window.ds.env==="3DSearch"){break}case"animatedPicture":case"video":case"sound":q.stopPropagation();this._play();break}}}}},_getSoundThumbnail:function(){return{"class":"thumbnail sound-thumbnail"}},getFileExtension:function(){var m="",n=this.model.get("userFile");if(i.is(this.model.get("media_file_ext"))){m=this.model.get("media_file_ext")}else{if(i.is(this.model.get("play"))){m=this.model.get("play").download_original_url.format}else{if(n&&n.fileName&&n.fileName.match(/.pdf$/i)){m="pdf"}}}return m},_getIconOverlay:function(){var o="",n=this.getFileExtension(),m=this.model.get("media_type"),p=this.model.isMediaAPlayableGIF();if((m==="animatedPicture")&&e){o=i.createElement("span",{"class":("fonticon thumbnail-icon-overlay fonticon-4x fonticon-picture-animated")})}else{if(["video","3d_model","sound"].indexOf(m)>-1||(m==="document"&&n!=="pdf")||p){o=i.createElement("span",{"class":("fonticon thumbnail-icon-overlay fonticon-4x fonticon-"+((m==="document")?"download":"play"))})}}return o},_getIconsOverlayTopRightCorner:function(){var n="",m=this.model,o=[];o.push(this.addChildView("interactive-action-menu",{Class:"DS/SwymUIComponents/script/feature/community/media/view/interactive-action-menu-view",model:this.model,events:{onPlay:function(p){console.log("media 360 to be played");this._interactAfterClickOnThumbnail(p)}.bind(this)}}));n=i.createElement("div",{"class":"icons-top-right-container",html:o});return n},_getDisplayPrevious:function(){var m="";if(this._displayPrevious===true){m={"class":"thumbnail-previous thumbnail-navigation",html:'<span class="fonticon arrow-navigation fonticon-4x fonticon-left-open "></span>'}}return m},_getDisplayNext:function(){var m="";if(this._displayNext===true){m={"class":"thumbnail-next thumbnail-navigation",html:'<span class="fonticon arrow-navigation fonticon-4x fonticon-right-open "></span>'}}return m},_addSpecialAttributesForEditionMode:function(p){var o=null,n,m;n=p.getAttribute("data-position");m=p.getAttribute("data-size");if(n){p.removeAttribute("data-position");o=o||{};o["data-position"]=n}if(m){p.removeAttribute("data-size");o=o||{};o["data-size"]=m}if(o){this.container.setAttributes(o)}},_createContent:function(){var n="",q=i.createElement("div",{"class":"thumbnail-overlay"}),t=this._getDisplayPrevious(),r=this._getDisplayNext(),v=this._getIconOverlay(),o=this._displayIconsOnTopRightCorner?this._getIconsOverlayTopRightCorner():"",s=this.model,x;this._previousNextContainer="";if(!s.has("media_type")&&s.lastCalledService!=="read"&&s.get("user_access")!==false){a.log("no media type is defined !");t="";r="";s.fetch({onFailure:function(){a.log("get media has failed - probably due to access rights");if(!this.isDestroyed()){s.set("media_type","");this.refresh()}}.bind(this),onComplete:function(){if(!this.isDestroyed()){this.removeControl("fullscreenSpinner");this.refresh()}}.bind(this)})}else{var m,A,y,z,w,p=s.get("mid"),u=s.get("media_type");if(h.isPictureViewAvailable(p)&&this._lightboxContext===true){if(s.get("preview")){m=parseInt(s.get("width"),10);A=parseInt(s.get("height"),10);w=this.container.parentElement.getDimensions();y=w&&parseInt(w.width,10);z=w&&parseInt(w.height,10);this._imageRenderingOptions=h.getImageRenderingOptionsForMedia(m,A,y,z);if(this._imageRenderingOptions.hasOwnProperty("extraAttributes")){this._imageRenderingOptions.extraAttributes["data-styles-to-remove-after-load"]="";this.imageReloadOptions=h.generateImageReloadOptionsForMedia({mediaId:p,mediaType:u,mediaWidth:m,mediaHeight:A,containerWidth:y,containerHeight:z})}this._delegateSpriteReloadToParentView=false;n=this._parent();if(this.container){this.container.parentElement.addEvent("resize",function(){var D=this.container.parentElement.getElement(".media-360-viewer-container"),B=this.container.parentElement.getElement(".video-viewer-container"),C=this.container.parentElement.getElement(".media-3dplay-viewer-container");if(!this._interactionActivated&&!D&&!B&&!C){this.refresh()}}.bind(this))}}else{t="";r="";n=this.addControl("fullscreenSpinner",new d({className:"msg-animation",visible:true,animate:true,spin:true}));this.model.fetch({onComplete:function(){if(!this.isDestroyed()){this.removeControl("fullscreenSpinner");this.refresh()}}.bind(this),onFailure:function(){a.log("get media has failed - probably due to access rights");if(!this.isDestroyed()){this.removeControl("fullscreenSpinner");s.set("media_type","");this.refresh()}}.bind(this)})}}else{if(s.get("status")!==h.MEDIA_PROCESSING_STATUS.OK&&(s.get("format_3dsa")==="3dxml"||(s.get("fileName")&&s.get("fileName").contains(".3dxml")))){n=this._create3DXMLThumbnail()}else{n=this._parent()}}}if(t||r){this._previousNextContainer=i.createElement("div",{"class":"thumbnail-previous-next ",html:[t,r]});this._previousNextContainer.addClassName("thumbnail-navigation")}if(n&&i.is(n.getAttribute,"function")){this._addSpecialAttributesForEditionMode(n)}if(v&&s.get("media_type")!=="picture"){q.setContent([this._previousNextContainer,v,o,n])}else{q=[this._previousNextContainer,v,o,n]}x=i.createElement("div",{"class":"interactive-media-wrapper",html:q});if(!(this._lightboxContext===true&&!r)&&s.get("user_access")!==false){x.addClassName("cursor-pointer")}else{x.setStyle("cursor","default")}return x},_create3DXMLThumbnail:function(){return i.createElement("img",i.merge({src:j.getMediaDefaultThumbnail("3d_model"),"data-type":"MediaNoPicture",styles:{width:"100%"}},this._imageRenderingOptions&&this._imageRenderingOptions.extraAttributes||{}))},onRender:function(){var p=this.model,n=p.get("media_type"),q=true;if(i.is(window.widget)&&i.is(widget.getAppName)&&widget.getAppName()===j.getContentReaderAppKey()){q=false}if(p.has("media_type")){this.container.addClassName(n+"-container");if(n==="3d_model"){this.container.addClassName("ds-3d_model-container")}if(n==="document"&&!i.is(p.get("play"))&&(this._autoplay===true||this._lightboxContext===true)){p.fetch({onComplete:function(){if(!this.isDestroyed()){this.onRender()}}.bind(this)})}if(this._lightboxContext===true&&n==="3d_model"){var m=this.container.parentElement.offsetHeight,o=m*4/3;this.container.setStyle("width",o+"px")}if(this._autoplay===true&&(q||n==="animatedPicture")&&(["animatedPicture","video","3d_model","sound"].indexOf(n)>-1)||((this._autoplay===true||this._lightboxContext===true)&&i.is(p.get("play"))&&p.get("play").download_original_url.format==="pdf")){this._play()}}},onRefresh:function(){if(this.container){this.container.removeClassName("media-initialized")}},onDestroy:function(){console.log("debuuger destroyed")},updateModel:function(){this.model.fetch({onComplete:function(){if(!this.isDestroyed()){this.refresh()}}.bind(this)})}});return k});define("DS/SwymUIComponents/script/feature/core/network/view/invitation-layer-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/network/view/invitation-layer-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/macro/user-app-view","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUIComponents/script/feature/core/network/view/invitation-layer-form-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/SwymUICore/script/feature/core/sprite/sprite"],function(j,e,b,l,n,h,d,k,g,c,a){var i={};i.userLoginInvitationAlreadySent=[];var m=h.extend({name:"user-idcard-bottom-bar",_createContent:function(){return{"class":"idcard-bottom-bar",html:[this.addControl("invite-button",new g({value:e.Invite,className:"saveButton primary",events:{onClick:function(){var p=this.getControl("invite-button");if(p){p.load()}var o=this._parentView.getChildView("invitation-form").getControl("inputMessage");if(o){this.model.sendInvitation({data:{message:o.getValue(),groupIdProfessionnal:l.getInstance().getAssociated("groups").getIdGroupProfessional()},onComplete:function(s,q){if(this._parentView.callbackSave){this._parentView.callbackSave()}this.alert("success",e.addSuccess);var r=this.container.parentElement.parentElement;r.destroy()}.bind(this)})}}.bind(this)}})),new g({value:e.cancel,className:"cancelButton default",events:{onClick:function(){var p=this.container.parentElement.parentElement,q=p.getElement(".invitation-inline-active"),o=p.getElement(".add-connection-active .tile-container");p.removeClassName("invitation-inline");q.destroy();o.show()}.bind(this)}})]}}});var f=h.extend({_modelClass:d,_invitationAlreadySent:null,name:"invitation-layer-view",launch:function(s,r,t){if(this.model&&i.userLoginInvitationAlreadySent.indexOf(this.model.get("login"))>-1){this.alert("info",b.alreadySentInvitation)}else{this.callbackSave=s;var p=new g({className:"default",value:e.cancel,events:{onClick:function(){var z=this.getControl("invitation-modal");z.hide()}.bind(this)}}),u=this.addControl("saveButton",new g({className:"primary",value:e.Invite,disable:true,events:{onClick:function(){var z=this.getChildView("invitation-form"),A;if(z){A=z.getControl("inputMessage")}u.load();this.model.sendInvitation({data:{message:A?A.getValue():"",groupIdProfessionnal:l.getInstance().getAssociated("groups").getIdGroupProfessional()},onComplete:function(C,B){i.userLoginInvitationAlreadySent.push(C.get("login"));if(s){s()}w.hide();this.alert("success",e.addSuccess)}.bind(this)})}.bind(this)}})),q=l.getInstance().getAssociated("groups");if(q.isEmpty()){q.setAssociated("currentUser",l.getInstance());q.fetch({onComplete:function(){u.enable()}})}else{u.enable()}var x=this.addChildView("invitation-form",new n({model:this.model})),o=this.addChildView("user-tile-view-invitation",new i.userTileViewClass({model:this.model}));if(r===true){t.addClassName("invitation-inline");var y=j.createElement("div",{"class":"invitation-inline-active",html:[o,x,this.addChildView("invitation-bottom-bar",new m({model:this.model}))]});y.inject(t)}else{var w=this.addControl("invitation-modal",new k({body:"",closable:false,footer:[u,p]})),v=w.getBody();o.inject(v);x.inject(v);w.inject(document.body);w.show()}}}});require(["DS/SwymUIComponents/script/feature/core/user/view/small-user-tile-view"],function(o){i.userTileViewClass=o});return f});define("DS/SwymUIComponents/script/feature/community/content/view/author-section-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/date","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/community/content/view/content-small-view-factory","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view","DS/SwymUICore/script/utils/i18n"],function(f,e,d,h,a,g,c,i){var b=e.extend({name:"content-author-section",_modelEventsForAutoRefresh:["onSync","onChange:author","onChange:community"],_getAuthorPicture:function(j){var k=j.getAuthor();return k.get("login")&&this.addChildView("userPicture",{tagName:"span",Class:"DS/SwymUIComponents/script/feature/core/user/view/user-picture-view",model:k,imageRenderingOptions:{format:"normal"}})},_getPeopleLink:function(j){var k=j.getAuthor();return f.createElement("a",{tag:"a","class":"link","data-content-type":"person","data-login":(j.get("ut_state")==="9")?"anonymous":k.get("login"),html:k.getNickname()})},_getAuthorView:function(j){return f.createElement("span",{"class":"content-detail-author",html:[c.by+" ",this._getPeopleLink(j)]})},_getThreadLink:function(k){var j=k.getCommunity(),l=h.getInstance();return !l.isDirectMessageContext()&&(f.is(l.contentType)||l.path==="home"||f.is(l.userHashKey))?f.createElement("span",{"class":"content-detail-thread",html:{tag:"a","class":"link","data-content-type":"community","data-content-id":j.get("mid"),html:j.get("title")}}):""},_getActivityDate:function(j){return f.createElement("span",{"class":"content-detail-activity-date",html:"- "+d.prettyDate((j.getModelName()==="wiki"||j.getModelName()==="media")?(j.get("update")||j.getPublishingDate()):j.getPublishingDate())})},_getModificationDate:function(k){var l,j=k.get("moderation_status"),m=j==="updated_by_author"?c.Edited:j==="updated"?c.Moderated:null;l=m?f.createElement("span",{"class":"content-detail-moderation-status",html:"- "+m}):{};m&&this._addModerationTooltip(k,l);return l},_getMultiContributorsView:function(k){var l=f.createElement("span",{"class":"multi-contributors fonticon fonticon-users"}),m=this.getChildView("nbContributors"),j;m&&this.removeChildView("nbContributors");j=f.createElement("span",{"class":"content-detail-author",html:[c.by+" ",this.addChildView("nbContributors",{Class:a.getViewClass("nbContributors"),model:k})]});return[l,j]},_addModerationTooltip:function(k,l){var j=k.get("moderation_status"),m=j==="updated_by_author"?c.EditedTooltip:j==="updated"?c.ModeratedTooltip:null;this.addControl("moderation-status-tooltip",new g({target:l,body:i.replace(m,{prettyDate:d.prettyDate(k.get("moderation_date"))}),position:"bottom"}))},setup:function(j){this.mode=j.mode;this._parent.call(this,j)},_createContent:function(){var j=this.model,k;k=this.mode==="simple"?[this._getPeopleLink,this._getActivityDate]:this.mode==="multiContributors"?[this._getMultiContributorsView,this._getThreadLink,this._getActivityDate,this._getModificationDate]:[this._getAuthorPicture,this._getAuthorView,this._getThreadLink,this._getActivityDate,this._getModificationDate];return k.map(function(l){return l.apply(this,[j])}.bind(this))}});return b});define("DS/SwymUIComponents/script/feature/community/content/utils/content-media-renderer",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/community/media/view/interactive-media-thumbnail-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/lib/collection/generic/swym-collection","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUICore/script/utils/utils","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils"],function(l,k,c,j,e,i,a,m,b,d){var g={},f=null,h=k.extend({name:"content-media-renderer",defaultOptions:{createMediaView:{inContent:true,position:"previous"},mediaViewClass:c,mediaInContentSelector:"img[data-media-id]",mediaIdAttributeInContent:"data-media-id",dataAttributesInContent:["creation_source"]},replaceStreammediaUrl:function(n){var o=/src=".+?\/streammedia\/.+?"/gi;return n.replace(o,['src="',d.getWebappsBaseUrl(),'SwymUIComponents/assets/thumb.png"'].join(""))},_createMediaViews:function(s,n,A){var p,q,y,z,x={content:n},o=[],v=[],r={},t=this,u=(A.createMediaView!==undefined)?A.createMediaView:t.getOption("createMediaView"),w=A.mediaViewClass||t.getOption("mediaViewClass");if(s&&(s.length>0)){s.forEach(function(B){p=B.getAttribute(t.getOption("mediaIdAttributeInContent"));if(p){r.id=p;r.community_id=B.dataset.communityId;r.media_type=B.dataset.mediaType;r.media_file_ext=B.dataset.fileExtension?B.dataset.fileExtension:null;o.push(new e(r))}else{b.error("The id is not present for this media",B)}})}if(o.length>0){z=new i(o);if(u!==false){if(u&&(u.inContent===true)&&(u.position==="previous")){s.forEach(function(B){p=B.getAttribute(t.getOption("mediaIdAttributeInContent"));if(p&&(n.contains(B))&&(q=(z.get("media:"+p)||z.get(p)))){v.push(new w(q).render().inject(B,"before"))}})}else{y=this._createMediaCollectionView(z,A);if(u&&(u.inContent===true)){if((u.position==="top")||(u.position==="bottom")||(u.position==="before")||(u.position==="after")){y.inject(n,u.position)}else{throw new Error("The content media could not be injected. Unknown position.")}}}}}s.forEach(function(B){B.destroy()});if(A.toReturn!==undefined){if(A.toReturn.mediaCollection===true){x.mediaCollection=z}if(A.toReturn.mediaZone===true){x.mediaZone=y}if(A.toReturn.mediaViews===true){x.mediaViews=v}return x}else{return n}},_createMediaCollectionView:function(o,n){var p,q=j.extend({bodyAttributes:{"class":"content-media-collection-view media-zone"},modelViewClass:n.mediaViewClass||this.getOption("mediaViewClass")});p=new q(o);return p},_renderMedia:function(p,n){var o,q;if(typeof p==="string"){p=this.replaceStreammediaUrl(p)}else{throw new Error("The content to be processed should be a string")}o=l.createElement("div",{html:p});q=o.getElements(n.mediaInContentSelector||this.getOption("mediaInContentSelector"));o=this._createMediaViews(q,o,n);if(o instanceof HTMLElement){if(o.childNodes.length===1){o=o.childNodes[0];if(o instanceof HTMLElement){o=l.extendElement(o)}}}return o},process:function(o,n){if(o){return this._renderMedia(o,n||{})}}});g.getInstance=function(){if(!f){f=new h()}return f};return g});define("DS/SwymUIComponents/script/feature/community/content/utils/content-renderer",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/community/content/utils/content-media-renderer"],function(g,c,a){var f=null,b={},e=(function(){var h,i=c.extend({processText:function(j){return j}});return{getInstance:function(){if(!h){h=new i()}return h}}})(),d=c.extend({name:"content-renderer",_contentView:null,_contentViewModel:null,_renderers:null,defaultOptions:{contentAttributeInModel:"content",contentRenderers:["text","media"],textRenderer:e,mediaRenderer:a},setup:function(){var h,j,i=this;this._parent.apply(this,arguments);this._renderers=this._renderers||{};j=this.getOption("contentRenderers");j.forEach(function(k){if(!i._renderers[k]&&(h=i.getOption(k+"Renderer"))){i._renderers[k]=h.getInstance()}});this._parent.apply(this,arguments)},reset:function(){for(var h in this._renderers){if(this._renderers.hasOwnAttribute(h)){this._renderers[h].destroy()}}},renderMedia:function(i,h){return this._renderers.media.process(i,h)},renderText:function(i,h){return this._renderers.text.processText(i,h)},render:function(j,i){var k,l,m,h=i||{};if(j){for(k in this._renderers){if(this._renderers.hasOwnProperty(k)){m="render"+k.substr(0,1).toUpperCase()+k.substr(1);l=this[m](l||j,h)}}}else{l=j}return l}});b.getInstance=function(){if(!f){f=new d()}return f};return b});define("DS/SwymUIComponents/script/feature/community/media/view/smart-lightbox-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/interactive-media-thumbnail-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/utils","DS/UIKIT/Tooltip","DS/Logger/Logger","DS/SwymUIComponents/script/feature/community/media/view/abstract-lightbox-view"],function(e,c,j,i,d,f,g,a,h){var b=h.extend({name:"lightbox-media-view",_isAutoplayActivated:true,_shouldBeDestroyed:true,_displayArrows:false,domEvents:{"click .thumbnail-previous":"_goToPreviousMedia","click .thumbnail-next":"_goToNextMedia","click .thumbnail-previous-next":"_goToNextMediaIfPicture","click .title .text":"_goToDetailedViewMedia","click .play-360-experience":"_play360Experience","click .fonticon-download":"_downloadMedia",click:"_destroy"},_play360Experience:function(){var l=this.getChildView("interactive-thumbnail");if(l){l.play()}var k=this.getElement(".play-360-experience");if(k){k.destroy()}},_downloadMedia:function(k){var l=this.getChildView("interactive-thumbnail");if(l){l.download()}},_goToDetailedViewMedia:function(l){a.log("go to detailed media");var k=this.model,n=window.widget||this._widget,m=(window.ds&&window.ds.env==="3DSwym");if(!m&&n&&n.getAppName()!==f.getMyCommunitiesAppKey()){require(["DS/SwymUICore/script/utils/navigation"],function(o){o.showTransientWidget(f.getMyCommunitiesAppKey(),"",{community:k.getCommunity().get("mid"),contentId:k.get("mid"),contentType:k.getModelName(),url:f.getBaseUrl()})})}else{this._context=i.getInstance();this._context.reset({contentId:k.get("mid"),contentType:k.getModelName(),communityId:k.get("community").mid})}this.destroy()},_destroy:function(k){a.log("in the destroy");if(this._shouldBeDestroyed===true&&!k.target.hasClassName("thumbnail-previous-next")&&!k.target.hasClassName("play-360-experience")&&!k.target.hasClassName("fonticon-download")&&!k.target.hasClassName("text")){if(this._touch){this._touch.destroy()}this.destroy()}this._shouldBeDestroyed=true},_goToNextMediaIfPicture:function(k){if(this.model.get("media_type")==="picture"){this._goToNextMedia(k)}},_goToNextMedia:function(n,m){a.log("go to next media");this._shouldBeDestroyed=false;this._isAutoplayActivated=false;var k,l;if(e.is(m,"number")){k=m}else{k=this.collection.indexOf(this.model)}if(k<this.collection.length-1){l=this.collection.at(k+1);if(l.get("_deleted")===true){return this._goToNextMedia(n,k+1)}else{this.setModel(l)}}else{a.log("we loop; we should go to the first media of the list");this.setModel(this.collection._models[0])}},_goToPreviousMedia:function(n,m){a.log("go to previous media");this._shouldBeDestroyed=false;this._isAutoplayActivated=false;var l,k;if(e.is(m,"number")){l=m}else{l=this.collection.indexOf(this.model)}if(l>0){k=this.collection.at(l-1);if(k.get("_deleted")===true){return this._goToPreviousMedia(n,l-1)}else{this.setModel(k)}}else{a.log("we loop; we should go to the last media of the list");this.setModel(this.collection._models[this.collection.length-1])}},onSetModel:function(l,k,m){if(this._touch){if(m.get("media_type")!=="3d_model"){this._touch.set({enable:true})}}},_mediaCollection:null,setup:function(k){if(typeof k.isAutoplayActivated!=="undefined"){this._isAutoplayActivated=k.isAutoplayActivated}if(this.model.isConsideredAsA360MediaModel()){this._isAutoplayActivated=false}this.imageReloadOptions={size:"xl"};if(k.collection){this._mediaCollection=k.collection}if(e.Utils.Client.Features.touchEvents&&this.collection&&this.collection.length>1){require(["DS/UIKIT/Touch"],function(l){this._touch=l(this.container,{drag:false,transform:false});this._touch.on("swipeleft",function(m){this._goToNextMedia()}.bind(this));this._touch.on("swiperight",function(m){this._goToPreviousMedia()}.bind(this))}.bind(this))}return this._parent.apply(this,arguments)},getContentView:function(){var k="",l=0;if(this.collection){if(this.collection.length>1){this._displayArrows=true}k=this.collection.indexOf(this.model),l=this.collection.length}return this.addChildView("interactive-thumbnail",{Class:"DS/SwymUIComponents/script/feature/community/media/view/interactive-media-thumbnail-view",model:this.model,forcePlayInContext:true,autoplay:this._isAutoplayActivated,displayNext:this._displayArrows,displayPrevious:this._displayArrows,delegateSpriteReloadToParentView:false,events:{onMediaReady:function(){if(this._touch&&this.model.get("media_type")==="3d_model"){this._touch.set({enable:false})}}.bind(this)}})},removeContentView:function(){this.removeChildView("interactive-thumbnail")}});return b});define("DS/SwymUIComponents/script/feature/community/members/view/member-tile-view",["UWA/Core","i18n!DS/SwymUICore/assets/nls/feature/core/user/collection/member-collection","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/user-tile-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/member-set-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/user-search-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/context/context-model","DS/UIKIT/DropdownMenu","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUIComponents/script/feature/core/user/view/badge-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/utils/utils"],function(k,i,e,c,n,g,f,a,m,b,l,h,j){var d=g.extend({name:"member-tile-view",className:"swym-tile",domEvents:{"click .action-toolbar .role + .fonticon-down-open":"_onToolbarClick"},defaultOptions:{displayBadges:true},_modelEventsForAutoRefresh:["onChange:relation"],_onToolbarClick:function(o){if(this._isCurrentUserOwner()){o.stopPropagation();if(o.target.getParent().className.indexOf("action-toolbar")>-1||o.target.getParent().className.indexOf("role")>-1){var p=this.getControl("dropdownMenu");if(p){p.show()}}}},_isCurrentUserOwner:function(){return parseInt(this.model.getAssociated("community").get("this").getCurrentUserRights,10)>=3},_isCurrentUserMainOwner:function(){if(this.model.getAssociated("community").get("owner")&&this.model.getAssociated("community").get("owner").hasOwnProperty("hash_key")){return this.model.get("hash_key")===this.model.getAssociated("community").get("owner").hash_key}else{return false}},_getExtraClassForAccountActivation:function(){return"member-tile"},_getTileWrapperExtraAttributes:function(){return{"class":this._getExtraClassForAccountActivation()}},_createPictureView:function(){return""},_displayBasicInfo:function(){return""},_createBadges:function(){return(((this.getOption("displayBadges")!==false)&&l.getInstance().isFeatureActivated("active_stats_info_on_community_members"))?{"class":"badges-container",html:[(this.model.get("nb_comment")>0?this.addChildView("badgeComment",{Class:b,model:this.model,attributeName:"nb_comment"}):""),(this.model.get("nb_post")>0?this.addChildView("badgePost",{Class:b,model:this.model,attributeName:"nb_post"}):""),(this.model.get("nb_media")>0?this.addChildView("badgeMedia",{Class:b,model:this.model,attributeName:"nb_media"}):""),(this.model.get("nb_question")>0?this.addChildView("badgeQuestion",{Class:b,model:this.model,attributeName:"nb_question"}):""),(this.model.get("nb_answer")>0?this.addChildView("badgeAnswer",{Class:b,model:this.model,attributeName:"nb_answer"}):""),(this.model.get("nb_ideation")>0?this.addChildView("badgeIdea",{Class:b,model:this.model,attributeName:"nb_ideation"}):"")]}:"")},_createActionToolbar:function(){var o="",p=this.model;if(this._isCurrentUserOwner()&&!this._isCurrentUserMainOwner()){o=k.createElement("span",{"class":"fonticon fonticon-down-open"});h.getInstanceFetched(function(q){if(q.get("hash_key")===p.get("hash_key")){o.hide()}})}return o},_createContent:function(){var r,p=this.model,q=f.getInstance(),o=null;if(p&&p.id){o=this._createActionToolbar();r=k.extend({html:[this._createPictureView(),this._displayBasicInfo(),this._createBadges()]},this._getTileWrapperExtraAttributes());if(o){this._buildDropDownMenu(o)}return[r,(!q.isDirectMessageContext())?{"class":"action-toolbar",html:[{"class":"role",html:'<span style="font-weight: bold;">'+this._getCurrentRoleName()+"</span>"},(o?o:"")]}:""]}},_getCurrentRoleName:function(){var o=this.model;return(o.get("relation")==="3"?(this._isCurrentUserMainOwner()?c.MainOwner:c.Owner):(o.get("relation")==="2"?c.Author:c.Contributor))},_getInlineActionsUpdate:function(p){var o=null;switch(p){case"1":o=[{name:"author",text:i.Setasauthor,fonticon:"user"},{name:"owner",text:i.Setasowner,fonticon:"user"},{name:"delete",text:i.Delete,fonticon:"trash"}];break;case"2":o=[{name:"contributor",text:i.Setascontributor,fonticon:"user"},{name:"owner",text:i.Setasowner,fonticon:"user"},{name:"delete",text:i.Delete,fonticon:"trash"}];break;case"3":o=[{name:"contributor",text:i.Setascontributor,fonticon:"user"},{name:"author",text:i.Setasauthor,fonticon:"user"},{name:"delete",text:i.Delete,fonticon:"trash"}];break;default:break}return o},_buildDropDownMenu:function(o){var p=this._getInlineActionsUpdate(this.model.get("relation"));this.addControl("dropdownMenu",new a({target:o,position:"bottom right",offset:{x:17,y:8},items:p,events:{onClick:function(t,x){var v,s=this,q=x.name,y=undefined,u=this.model.get(this.model.getModelIdAttribute(),{escapeHTML:false});if(q==="contributor"||q==="author"||q==="owner"){switch(q){case"contributor":y="1";break;case"author":y="2";break;case"owner":y="3";break}var r=";update,"+u+","+y;if(r.length>0){s.mask();v=s._parentView.collection.getAssociated("owned");v.action("editmembers",{data:{settings_members:r},onComplete:function(){s.alert("success",e.Yourchangeshavebeensaved);s.model.set("relation",y);s.refresh();s.unmask()},onFailure:function(A,z){require(["DS/SwymUICore/script/feature/core/error/error"],function(B){B.displayError(z&&z.errorcode)});s.refresh();s.unmask()}})}}else{if(q==="delete"){var w=";delete,"+u;if(w.length>0){s.mask();v=s._parentView.collection.getAssociated("owned");v.action("editmembers",{data:{settings_members:w},onComplete:function(){s.alert("success",e.Yourchangeshavebeensaved);s.dispatchEvent("memberDeleted",[s.model])},onFailure:function(A,z){require(["DS/SwymUICore/script/feature/core/error/error"],function(B){B.displayError(z&&z.errorcode)});s.refresh();s.unmask()}})}}}}.bind(this)}}))}});return d});define("DS/SwymUIComponents/script/feature/community/community/view/community-request-become-author-modal-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-become-author-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/WebappsUtils/Console"],function(h,e,g,b,a,f,d){var c=g.extend({name:"community-request-become-author-modal-view",_createContent:function(){var k=this.model,l=this;if(k){var j=new a({value:e.Send,className:"primary create",events:{onClick:function(){this.load();l.model.changerolerequest({data:{message:l.message},onComplete:function(){i.destroy();l.alert("success",e.yourRequestHasBeenSent)}})}}}),m=new a({value:e.cancel,events:{onClick:function(){i.hide()}}}),n=h.createElement("div",{html:new f({multiline:true,placeholder:e.placeholder+" "+e.placeholderInfo,id:"messageToSend",rows:5,value:"",events:{onChange:function(){l.message=this.getValue()}}})}),i=this.addControl("shareModal",new b({footer:[j,m],header:e.roleRequestFor+" "+k.get("title",{escapeHTML:false}),draggable:true,closable:true,maximizable:false,events:{onHide:function(){this.destroy()}}}));i.setBody([n]);return i}},show:function(){this.getControl("shareModal").show()}});return c});define("DS/SwymUIComponents/script/feature/community/community/view/request-become-author-view",["UWA/Core","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/community/community/view/community-request-become-author-modal-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/community-selector-view"],function(g,a,d,c,e,f){var b=d.extend({name:"request-become-author-view",className:"content-item",domEvents:{"click .become-author":"_onBecomeAuthorClick"},setup:function(){this._parent.apply(this,arguments);this.context=c.getInstance()},_createContent:function(){return g.createElement("div",{"class":"no-creation-rights err-msg",styles:{"word-break":"normal","overflow-wrap":"break-word","word-wrap":"break-word","padding-top":"13px"},html:{tag:"span",html:[{tag:"span","class":"fonticon fonticon-feather",styles:{"margin-right":"10px"}},{tag:"a","class":"become-author",html:f.BecomeAuthor}]}})},_onBecomeAuthorClick:function(){var h=new a({id:this.context.communityId});var i=new e({model:h});i.render(document.body).show()}});return b});define("DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-buttons-view",["UWA/Core","UWA/Utils/Client","DS/UIKIT/DropdownMenu","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/edit/wiki-creator-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-detailed-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/view/wikitree-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/content-creation-view","DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-view","DS/SwymUIComponents/script/utils/content-creation-types-manager","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/community/wiki/model/wikitree-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/context/context-model"],function(b,u,p,f,t,m,k,j,i,r,a,o,d,g,l,c,q,n,e,s,h){var v=c.extend({_mode:"view",editable:false,_modelEvents:{onSync:"refresh"},domEvents:{"click .fonticon-doc-add":"_createWikiPage","click .fonticon-resize-full":"_expandTree"},_createWikiPage:function(){var x=this,w=h.getInstance();d.dispatchEvent("hideLayout");var y=new Promise(function(A,z){if(window.ds.swymIM===true&&w.getCommunityContentListContext()==="wiki"){return A()}w.addOnce("onContextChange",function(){A()});l.goToCommunity(x.model.get("mid"),window.ds.swymIM===true?h.COMMUNITY_WIKI:undefined)});y.then(function(A){var z=o.getInstance();setTimeout(function(){z.setContentTypeRequest({type:"wiki",updateIcon:true,forceFocus:true,programmaticallyChanged:true,userAction:true})},100)})},_buildDropDownMenu:function(y){var x=this,w=[];w.push({name:"rss",text:j.SubscribeToRSSFeed,fonticon:"rss"});if(s.getInstance().isFeatureActivated("activate_wiki_move")&&!u.Platform.ios&&!u.Platform.android&&x.model&&x.model.getUserRole()>=n.COMMUNITY_OWNER_ROLE){w.push({name:"edit",text:(x.editable?i.Exitwikitreeeditmode:i.Enterwikitreeeditmode),fonticon:(x.editable?"erase":"pencil")})}if(w.length>0&&y){x.addControl("dropdownMenu",new p({target:y,renderTo:window.document.body.getElement(".scroll-content"),position:"bottom right",offset:{x:17,y:8},items:w,events:{onClick:function(A,z){switch(z.name){case"rss":window.open(g.getBaseUrl()+"/rss/filter/feed/community_id/"+x.model.get("mid")+"/model/wiki/");break;case"edit":x.editable=!x.editable;z.elements.icon.setAttribute("class",(x.editable?"fonticon fonticon-erase":"fonticon fonticon-pencil"));z.elements.content.setHTML((x.editable?i.Exitwikitreeeditmode:i.Enterwikitreeeditmode));x.dispatchEvent("WikiEditToggle");break;case"create":x._createWikiPage();break}}}}))}else{if(y){y.hide()}}},_createContent:function(){var y=this,x,w,z,A;if(y.model){w=b.createElement("span",{"class":"fonticon fonticon-down-open"});z=(y.model.canCreateWikiPages()&&y._mode==="view"?b.createElement("span",{"class":"fonticon fonticon-doc-add"}):null);A=(y.getOption("creation")!==true?b.createElement("span",{tag:"span","class":"fonticon fonticon-resize-full"}):null);x={"class":"wiki-action-bar",html:[(z?z:null),(A?A:null),(y._mode==="view"?w:null)]};if(y._mode==="view"){y._buildDropDownMenu(w)}if(z){y.addControl("addPageIconTooltip",new t({target:z,body:r.Addawiki}))}if(A){y.addControl("expandTreeIconTooltip",new t({target:A,body:k.Expand}))}}return x},_expandTree:function(){var B=this,y,x,z=!u.Platform.ios&&!u.Platform.android,A=B.getControl("treeModal"),C=B.getChildView("wikiTreeViewExpanded"),D,w;if(!A){D=new e({community_id:B.model.get("mid")},{autoPopulate:true});w=D.getCommunity();y=z&&w.canCreateWikiPages();x=z&&w.canReorganizeWikiPages();C=B.addChildView("wikiTreeViewExpanded",{addScroller:true,model:D,Class:a,widget:B._widget,moveOnlyCurrentNode:B.getOption("moveOnlyCurrentNode"),creation:B.getOption("creation"),events:{onInit:function(){B.reactTo(this,"currentPageChange",function(E){if(E.dontSetModel!==true&&B.getControl("treeModal")){B.getControl("treeModal").hide()}})}}});D.setCurrentPage(new q({mid:h.getInstance().getData().contentId}));A=B.addControl("treeModal",new f({header:"<h4>"+k.Wikitree+"</h4>",className:"wiki-tree-expanded",body:(B._mode==="edit"?C:[{"class":"wiki-tree-expanded-modal-toolbar",styles:{"text-align":"right"},html:[y?this.addControl("add-wiki-btn",new m({value:r.Addawiki,className:"link",icon:"doc-add",events:{onClick:function(){B.getControl("treeModal").hide();B._createWikiPage()}}})):null,(y&&x)?"|":"",x?this.addControl("wikitree-edit-btn",new m({value:i.Enterwikitreeeditmode,className:"link",icon:"pencil",events:{onClick:function(){this.setValue((C.editable?i.Enterwikitreeeditmode:i.Exitwikitreeeditmode));C.toggleEdit()}}})):""]},C]),closable:true,renderTo:B._widget.body}));if(B._mode==="edit"){C.toggleEdit()}}A.show()},setup:function(w){var x=this;if(w&&w.mode){x._mode=w.mode}return x._parent.apply(x,arguments)}});return v});define("DS/SwymUIComponents/script/feature/core/user/view/add-member-panel-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/member-set-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/user-search-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/SwymUIComponents/script/feature/core/search/view/bot-search-factory","DS/SwymUICore/script/utils/utils","DS/UWPClientCode/I18n"],function(f,c,h,e,a,d,i,g,j){var b=e.extend({name:"add-member-panel-view",_asAdmin:false,_mailAllowed:true,_userCollection:null,setup:function(l){var k;if(l&&f.is(l.asAdmin)){this._asAdmin=l.asAdmin}if(l&&f.is(l.mailAllowed,"boolean")){this._mailAllowed=l.mailAllowed}k=this._parent.apply(this,arguments);if(!this.collection){throw new Error("Member collection is required")}return k},_parseUserData:function(k){if((k.ut_state==="0")&&(k.nickname.trim()==="")){k.nickname=k.ut_invitation_email}if(k.user_tenant_status==="1"){k.nickname+=" ("+h.Contractor+")"}return k},_findPotentialMembers:function(l){var k=this;if(this.collection){if(!this._userCollection){this._userCollection=new a([],{communityId:this.collection.getAssociated("owned").get("mid"),limit:10,mode:"searchbyname"})}if(!l.onComplete){throw new Error("onComplete option is missing")}return this._userCollection.fetch({data:l.data,onComplete:function(n,m){m.result.forEach(k._parseUserData);l.onComplete.call(this,m&&m.result)},onFailure:l.onFailure})}},_getBasicOptions:function(){var k=this;return{categories:[{id:"contributor",name:c.Contributor},{id:"author",name:c.Author,isDefault:"true"},{id:"owner",name:c.Owner}],minLength:3,unlockDistinctClick:true,getSuggestions:function(n,l,m){if(!n){return}if(this._suggestRequest){this._suggestRequest.cancel()}if(l[n]){m(l[n])}else{this.options.suggestRequestData[this.options.suggestTextAttribute]=n;this._suggestRequest=k._findPotentialMembers({data:this.options.suggestRequestData,onComplete:function(o){m(JSON.stringify(o||[]))}});return this._suggestRequest}},suggestDistinction:function(m){var n,l=false;if(m.is_member===true){n=parseInt(m.acc,10);switch(n){case 1:l=c.Contributor;break;case 2:l=c.Author;break;case 3:l=c.Owner;break;default:break}return l}},saveProcess:function(q){var p,r,l,m="";for(var n=0;n<q.length;n++){p=q[n];switch(p.categoryId){case"contributor":r=1;break;case"author":r=2;break;case"owner":r=3;break;default:continue}m=m+";"+(p.prevDistinction?"update":"add")+","+p.selection+","+r}var o=k.getControl("bot-search-control");if(o&&o.getValue()){o.getValue().split(";").forEach(function(s){m=m+";add,"+s+",1"})}if(m.length>0){l=k.collection.getAssociated("owned");l.action("editmembers",{data:{settings_members:m,as_admin:(k._asAdmin?k._asAdmin:false)},onComplete:function(){this.collection.dispatchEvent("onRefreshing");e.prototype.alert("success",c.Yourchangeshavebeensaved)}.bind(k),onFailure:function(s,t){console.log("this is a failure");if(q.length>1&&t.errorcode==="ERROR_COMMUNITY_MAIN_OWNER_CHANGE_ROLE_FORBIDDEN"){this.collection.dispatchEvent("onRefreshing")}}.bind(k)})}}}},_onEmailAddress:function(k){if(f.is(this._mailAllowed,"function")){this._mailAllowed=this._mailAllowed()}if(f.is(this._mailAllowed)){return{nickname:k,"ds6w:label":k,hash_key:k}}return null},_getExtraOptions:function(){return{suggestUrl:g.getBaseUrl()+"/api/user/search",suggestRequestData:{locale:j.getCurrentLanguage(),as_admin:this._asAdmin},suggestTextAttribute:"query",suggestFormat:"{nickname}",suggestKey:"hash_key",labelFormat:"{nickname}",onEmailAddress:this._onEmailAddress.bind(this)}},getOptionsForW3DXAddMemberPanelView:function(){return f.extend(this._getBasicOptions(),this._getExtraOptions())},_getAddPanelBot:function(){return f.createElement("div",{"class":"add-bot-panel",html:[{tag:"h4",html:c.Addbots},this.addControl("bot-search-control",i.createBotSearchControl({events:{onSelect:function(k){console.log("A bot has been selected")}.bind(this)}}))]})},_createContent:function(){var k;if(this.collection){k=new d(this.getOptionsForW3DXAddMemberPanelView());k.show();if(this._childViews&&this._childViews.w3dxAddMemberPanelView){if(typeof this._childViews.w3dxAddMemberPanelView.destroy==="function"){this._childViews.w3dxAddMemberPanelView.destroy()}else{throw new Error('The old child view "members" cannot be destroyed')}}this._childViews.w3dxAddMemberPanelView=k;return[k,g.isFeatureActivated("activateBots")?this._getAddPanelBot():""]}throw new Error("User Collection does not exist")}});return b});define("DS/SwymUIComponents/script/feature/community/community/view/community-signup-request-view",["i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-signup-request-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Button","DS/UIKIT/Form"],function(e,g,f,b,a,d){var c=g.extend({_modelClass:f,name:"community-signup-request-view",_createContent:function(){var j=this.model;if(j){var k=this.addControl("cancelButton",new a({value:e.Cancel,events:{onClick:function(){this.getControl("communitySignupModal").hide()}.bind(this)}}));var i=this.addControl("sendButton",new a({value:e.Send,className:"primary",events:{onClick:function(){var l=this;if(l.getControl("communitySignupForm").validate()){l.getControl("sendButton").setDisabled();l.getControl("cancelButton").setDisabled();l.getControl("communitySignupForm").setDisabled();require(["DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/request/data"],function(n,o){var m=n.adaptService({url:"/api/notification/joincommunity",data:{community_access_wish:l.getControl("communitySignupForm").getValue("community_access_wish"),related_model_id:j.get("mid")},onComplete:function(){this.getControl("communitySignupModal").hide();this.alert("success",e.AnEmailHasBeenSentToTheCommunityAdministrators)}.bind(l)});o.request(m)})}}.bind(this)}}));var h=this.addControl("communitySignupModal",new b({closable:true,header:"<h4>"+e.CommunitySignupRequestFor+" "+j.get("title")+"</h4>",body:this.addControl("communitySignupForm",new d({fields:[{type:"textarea",name:"community_access_wish",placeholder:e.PleaseExplainTheReasonsWhyYouWantToJoinThisCommunity,rows:4,required:true},{type:"html",html:e.ThisInformationWillBeSentToTheCommunityOwnersInAdditionToYourFirstNameLastNameJobTitleCompanyCountryAndEmail}]})),footer:[i,k],events:{onHide:function(){this.destroy()}.bind(this)}}));return h}},show:function(){this.getControl("communitySignupModal").show()}});return c});define("DS/SwymUIComponents/script/feature/core/user/view/edit-all-bar/edit-all-bar",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/UIKIT/Input/Button","DS/PubSub/PubSub","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/edit-all-bar/edit-all-bar"],function(g,d,e,i,f,b){var c={};var h=d.extend({name:"edit-all-bar",_createContent:function(){var j=this;return{"class":"bottom-bar",html:[new e({value:b.validate,className:"saveButton primary",events:{onClick:function(p){this.load();var q=true,k,o={};for(var m=f.instances.length,n=0;n<m;n++){k=f.instances[n];if(k){q=q&&k._actionOnSave(true)}}if(q){for(var m=f.instances.length,n=0;n<m;n++){k=f.instances[n];if(k){if(k.model){o=k.model.getChanges();delete o.countryForRead}if((k.model&&Object.keys(o).length>0)||(k.model.getModelName()==="language")){console.log("edit all bar call is done");k._actionOnSave(false,true)}}}setTimeout(this.load.bind(this,false),1000);c.hide()}else{j.alert("error",b.pleaseFillTheFieldsCorrectly);setTimeout(this.load.bind(this,false),1000)}}}}),this.addControl("cancel-button",new e({value:b.cancel,className:"cancelButton default",events:{onClick:function(o){var p=true,k;for(var m=f.instances.length,n=0;n<m;n++){k=f.instances[n];if(k&&k.isRendered()){k.onCancelClick()}}c.hide()}.bind(this)}}))]}}});var a=null;c.getEditAllBarInstance=function(){if(a===null){a=new h();a.render(document.body.getElement(".user-app-view-with-scroll-container"))}return a};c.show=function(){var k=this.getEditAllBarInstance(),j=document.body.getElement(".user-app-view-with-scroll-container");k.show();i.dispatch("editAll",true,true);if(j){j.addClassName("edit-all-activated");j.removeClassName("edit-all-deactivated");j.setStyle("margin-bottom","50px")}};c.hide=function(){if(a!==null){var k=this.getEditAllBarInstance(),j=document.body.getElement(".user-app-view-with-scroll-container");k.hide()}if(j){if(j.hasClassName("edit-all-activated")){i.dispatch("editAll",false,true)}j.removeClassName("edit-all-activated");j.addClassName("edit-all-deactivated");j.setStyle("margin-bottom","0px")}};return c});define("DS/SwymUIComponents/script/feature/core/user/view/user-completion-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/user-completion-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/user/view/edit-all-bar/edit-all-bar","DS/WebappsUtils/Console","DS/PubSub/PubSub"],function(e,b,c,h,d,g,a,i){var f=c.extend({_modelClass:h,name:"user-completion-view",className:"",setup:function(j){j=j||{};e.extend(this,j);i.add("editAll",function(k){if(k===false&&this.getControl("edit-all-button")){this.getControl("edit-all-button").show()}}.bind(this));this._addListenerToModel();return this._parent.apply(this,arguments)},_addListenerToModel:function(){this.model.addEvent("usercompletionUpdate",function(j){if(this.model){this.model.set("profile_completion",j)}if(this.refresh){this.refresh()}}.bind(this))},_createContent:function(){return[this._buildFillProfilPercent(this.model.get("profile_completion")),this._buildInfoOnCompletion(),this._buildButtonEditAll()]},toggleInfoOnCompletion:function(){var j=this.getElement(".profile-completion-info");if(j){j.toggleClassName("hidden")}},_buildInfoOnCompletion:function(){return'<div class="profile-completion-info hidden">'+b.CompletionDetailBody+"</div>"},_buildButtonEditAll:function(){return this.addControl("edit-all-button",new d({value:b.editAll,className:"edit-all-button default",icon:"pencil",events:{onClick:function(j){g.show()}.bind(this)}}))},_buildFillProfilPercent:function(p){var j=Math.ceil((p)/5),n="",o=20-j,l="",m="";for(var k=-1;++k<j;){if(j>18&&(k===j-2||k===j-1)){if(k===j-2){n=n+='<span style="word-wrap: normal; text-align : right; width : 9%;" class="profile-completion-elm"> <b> '+p+"%</b></span>"}else{if(k===j-1){if(k===19){l="border-bottom-right-radius: 5px; border-top-right-radius: 5px;";m="last-element"}n=n+='<span style="word-wrap: normal; '+l+' width : 3%;" class="profile-completion-elm '+m+' "> &nbsp;</span>'}}}else{n+="<span "+((k===0)?'style="border-bottom-left-radius: 5px; border-top-left-radius: 5px; width : 3%;"':"")+' class="profile-completion-elm"> &nbsp;</span>'}}for(k=-1;++k<o;){if(k===o-1){n+='<span style="border-bottom-right-radius: 5px; border-top-right-radius: 5px; width: 3%;" class="last-element profile-completion-elm-empty"> &nbsp;</span>'}else{if(k===o-2){n+='<span style="word-wrap: normal; width : 9%;" class="profile-completion-elm-empty"> <b> '+p+"%</b></span>"}else{n+='<span class="profile-completion-elm-empty"> &nbsp;</span>'}}}return n}});return f});define("DS/SwymUIComponents/script/feature/core/user/view/member-set-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/member-set-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/user-search-view","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/W3DXComponents/MemberSet","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/W3DXComponents/Views/Layout/GridView","DS/W3DXComponents/Views/Layout/TableView","DS/W3DXComponents/Views/Item/TileView","DS/SwymUIComponents/script/feature/core/user/view/add-member-panel-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/error/error","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/utils/scrollview-utils","DS/SwymUICore/script/feature/core/context/context-model","DS/UWPClientCode/I18n","DS/WebappsUtils/Console","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WebappsUtils/WebappsUtils"],function(a,l,y,m,s,f,g,n,C,e,j,x,k,d,o,p,b,u,w,h,v,i,z,r,c){var t=function(G){var I,F=null,H,E=this,D=E.getChildView("members");if(D&&D.currentViewId){H=D.contentsViews[D.currentViewId];E.mask();I=function(){E.unmask();G.removeEvent("onFailure",F);z.info("syncCb, collection.hasNext():",G.hasNext());if(H.scrollView){if(G.hasNext()){H.scrollView.useInfiniteScroll(true)}else{H.scrollView.useInfiniteScroll(false)}}};F=function(){E.unmask();u.displayError();G.removeEvent("onSync",I)};G.addEventOnce("onSync",I);G.addEventOnce("onFailure",F);h.onPullToRefresh.call(H)}};var B=function(G,E){var H=null,F,D=G.getAssociated("owned");if(((F=D.getUserRole())&&(F>=3))||E===true){H=new C([{id:"addmember",title:l.AddMember,icon:"user-add",context:true,overflow:false}])}else{H=new C()}return H};var q=function(D){var E=null,F=b.getDelayedSyncTask(function(){if(this.isDestroyed!==true){}},100);return{itemViewOptions:{templateHelpers:{imgAttrs:function(){switch(this.model.getModelName()){case"user":return p.getUserPictureAttributes({format:"normal",login:this.model.get("login"),hash_key:this.model.get("hash_key"),imageFingerprint:this.model.get("user_picture_fingerprint")});case"users-group":return{"class":"users-group-default-picture"};default:return{}}}},events:{onClick:function(){if(this.name==="row"&&(this.model.getModelName()==="user")){m.goToProfile({login:this.model.get("login"),hash_key:this.model.get("hash_key")})}},onRender:function(){if(this.container.hasClassName("tile-container")&&E){F.call(E)}},onActionClick:function(J,I){var K,G=I.model.get("id"),N,P="",H=this.model.get(this.model.getModelIdAttribute(),{escapeHTML:false}),M=this.model.get("id"),L=this;if(G==="contributor"||G==="author"||G==="owner"){switch(G){case"contributor":P="1";break;case"author":P="2";break;case"owner":P="3";break;default:z.log(G+" is not defined.")}K=";update,"+H+","+P;if(K.length>0){N=E.collection.getAssociated("owned");N.action("editmembers",{data:{settings_members:K,as_admin:(D&&D._asAdmin?D._asAdmin:false)},onComplete:function(){L.model.set("relation",P);L.model.updateActions(D._asAdmin);J.render();s.prototype.alert("success",l.Yourchangeshavebeensaved)}})}}else{if(G==="delete"){var O=";delete,"+H;if(O.length>0){N=E.collection.getAssociated("owned");N.action("editmembers",{data:{settings_members:O,as_admin:(D&&D._asAdmin?D._asAdmin:false)},onComplete:function(){var Q=E.collection;Q.remove(L.model);s.prototype.alert("success",l.Yourchangeshavebeensaved)}})}}else{z.log(G+" is not take in charge.")}}}}},events:{onRender:function(){if(this.container.hasClassName("grid-scroll-container")){E=this;F.call(E)}},onInfiniteScroll:h.onInfiniteScroll,onPullToRefresh:h.onPullToRefresh}}};var A=s.extend({name:"member-set-view",attributes:{styles:{height:"100%"}},_asAdmin:false,_mailAllowed:true,_userCollection:null,domEvents:{"click .memberset-view .tile-header":"userPhotoClick"},defaultOptions:{addMemberPanelViewClass:d},setup:function(E){var G=this,F,D;if(E&&a.is(E.asAdmin)){G._asAdmin=E.asAdmin}if(E&&a.is(E.mailAllowed)){G._mailAllowed=E.mailAllowed}D=G._parent.apply(G,arguments);G.collection.addEvent("onRefreshing",t.bind(G,G.collection));if(G._asAdmin!==true){F=v.getInstance();F.addListener("onCommunityChange",G.onCommunityChange,G,true)}G._bootstrapModel=w.getInstance();if(G._mailAllowed===true){r.getPlatformConfig({platformId:G._bootstrapModel.get("config").tenant.online_instance_id,key:"share",onComplete:function(H){if(H===false){G._mailAllowed=H}}})}return D},onCommunityChange:function(F){var D,E;D=new o({id:F.communityId});E=D.getUserRole();if((E!==undefined)&&(E!==null)){this.onCommunitySync(D)}else{this.listenTo(D,"onSync",function(){this.onCommunitySync(D);this.stopListening(D,"onSync")})}},onCommunitySync:function(D){var G=v.getInstance(),F=D.getUserRole(),E=this.getChildView("members");G.removeListener("onCommunityChange",this.onCommunityChange);if((F>=3)&&E&&E.actionsView&&E.actionsView.collection&&(E.actionsView.collection.length===0)){E.actionsView.collection.add({id:"addmember",title:l.AddMember,icon:"user-add",context:true,overflow:false})}},_getContentsHeaders:function(){return[{property:"user_name",label:l.Name},{property:"subtitle",label:l.Role},{property:"company",label:l.Company},{label:l.Actions,actions:true}]},_getItemViewAttributesMapping:function(){return{user_name:function(){return this.model.getNickname()},company:"company",title:function(){var D=this.model;return('<a data-content-type="person" data-hash-key="'+D.get("hash_key")+'"'+(D.get("login")?(' data-login="'+D.get("login")+'"'):"")+">"+D.getNickname()+"</a>")},content:function(){var E=this.model,G,I,D,F,H;G=(E.get("nb_post")&&E.get("nb_post")!=="0")?"<span class='input'><span class='input_nb'>"+E.get("nb_post")+"</span><span class='fonticon fonticon-newspaper'></span></span>":"";I=(E.get("nb_comment")&&E.get("nb_comment")!=="0")?"<span class='input'><span class='input_nb'>"+E.get("nb_comment")+"</span><span class='fonticon fonticon-comment'></span></span>":"";D=(E.get("nb_media")&&E.get("nb_media")!=="0")?"<span class='input'><span class='input_nb'>"+E.get("nb_media")+"</span><span class='fonticon fonticon-picture'></span></span>":"";F=(E.get("nb_question")&&E.get("nb_question")!=="0")?"<span class='input'><span class='input_nb'>"+E.get("nb_question")+"</span><span class='fonticon fonticon-help'></span></span>":"";H=(E.get("nb_answer")&&E.get("nb_answer")!=="0")?"<span class='input'><span class='input_nb'>"+E.get("nb_answer")+"</span><span class='fonticon fonticon-check'></span></span>":"";return G+I+D+F+H},subtitle:function(){var E=undefined,F=0,D=this.model;if(D){F=parseInt(D.get("relation"),10);switch(F){case 1:F=l.Contributor;break;case 2:F=l.Author;break;case 3:F=l.Owner;if(D.collection&&D.collection.getAssociated("owned")&&D.collection.getAssociated("owned").get("owner")){E=D.collection.getAssociated("owned").get("owner").hash_key}if(D.get("hash_key")===E){F=l.MainOwner}break}}return F},image:function(){return f.constructUserPictureUrl(this.model.get("login"),this.model.get("user_picture_fingerprint"),this.model.get("hash_key"))}}},_createContent:function(){var E=this,J,K=this.collection,D,G,F,I=this.getOption("addMemberPanelViewClass");if(K){if((D=K.getAssociated("owned"))&&D.get("mid")){E.reactTo(D,"onChange:main_owner_hash_key",function(N,L){var M=K.findWhere({mid:"user:"+L});if(M){K.getAssociated("owned").set("owner",M.getAttributes())}this.collection.dispatchEvent("onRefreshing")})}G=q(this);J=this.addChildView("addMemberPanelView",new I({asAdmin:this._asAdmin,mailAllowed:function(){return E._mailAllowed},collection:this.collection}));F=new n({collection:K,actions:{collection:B(K,this._asAdmin)},slidepanel:{view:e,viewOptions:J.getOptionsForW3DXAddMemberPanelView()},events:{onActionClick:function(M,L,O){var N=O.model.get("id");switch(N){case"addmember":this.togglePanel();break;default:z.log(N+" is not permitted.");break}}},contents:{headers:this._getContentsHeaders(),itemViewOptions:{mapping:this._getItemViewAttributesMapping(),templateHelpers:G.itemViewOptions.templateHelpers,events:G.itemViewOptions.events},events:G.events}});if(this._childViews&&this._childViews.members){if(typeof this._childViews.members.destroy==="function"){this._childViews.members.destroy()}else{throw new Error('The old child view "members" cannot be destroyed')}}this._childViews.members=F;var H=a.createElement("div",{"class":"memberset-view",styles:{height:"100%",width:"100%"},html:[F]});return H}throw new Error("User Collection does not exist")},userPhotoClick:function(){var D=arguments[0],E=D.target.dataset.hashKey;if(E&&window.ds&&window.ds.env==="3DSwym"){m.goToProfile({hash_key:E})}},onRedraw:function(){this.renderMemberSetView()},renderMemberSetView:function(){if(this._childViews&&this._childViews.members){this._childViews.members.render()}}});return A});define("DS/SwymUIComponents/script/feature/community/community/view/community-signup-request-launcher",["DS/SwymUIComponents/script/feature/community/community/view/community-signup-request-view"],function(c){var b=null;var a={show:function(d){var e;if(b&&b.model&&b.model.equals(d)){b.show()}else{e=new c({model:d});e.render(document.body);e.show();if(b&&!b.isDestroyed()){b.destroy()}b=e}}};return a});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-st-utils",["DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/feature/core/user/model/user-model"],function(b,c){var a={};a.renderUserPicture=function(){var e=this.model,d=new b({imageRenderingOptions:{cls:e.get("parentCommentUri")?"reply-author":"comment-author"},model:new c({login:e.get("author")?e.get("author").login:e.get("login"),username:""})});d.render();this.components.add(d);return d};return a});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-interactor-view",["DS/SocialToolbar/Views/InteractorView","DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-st-utils"],function(a,b){a.prototype._renderUserPicture=function(){return b.renderUserPicture.apply(this,arguments)}});define("DS/SwymUIComponents/script/feature/core/user/view/user-mini-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/WebappsUtils/Console"],function(e,d,c,b){var a=d.extend({model:null,_el:null,_createContent:function(){var f=this.model;if(f){var h=this.addChildView("userPicture",{Class:c,model:f,imageRenderingOptions:{format:"mini"}});var g=[{html:{"class":"user-mini-table",tag:"table",html:{tag:"tr",html:[{tag:"td",html:{styles:{"margin-right":"10px"},html:h}},{styles:{"vertical-align":"middle"},tag:"td",html:{tag:"span","class":"content-details nickname-elm",styles:{"border-left":"none"},html:{tag:"a",html:f.getNickname(),"data-content-type":"person","data-hash-key":f.get("hash_key")||"","data-login":f.get("login")||""}}}]}}}];return g}}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/users-mini-list-view",["UWA/Core","UWA/Event","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUIComponents/script/feature/core/user/view/user-mini-view","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUICore/script/feature/core/sprite/sprite","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/users-mini-list-view"],function(f,i,d,c,h,j,e,g,k,b){var a=d.extend({title:"",showViewMore:true,collection:null,_viewMoreModal:null,_createContent:function(){var l=this,m=this.addControl("viewMoreBtn",new e({className:"link",value:b.Viewmore,attributes:{styles:{width:"100%"}},events:{onClick:function(){if(!this._viewMoreModal){this._viewMoreModal=l.addControl("moreModal",new g({closable:true,header:this.title,body:[{html:this.addChildView("usersList",{collection:this.collection,Class:c,modelViewClass:j,modelViewsCfg:{attributes:{"class":"float-left",styles:{"margin-bottom":"10px","min-width":"50%"}},modal:this._viewMoreModal}})},{html:'<div style="clear:both;"></div>'}],events:{onShow:function(){document.body.addEvent("click",l._hideModal)},onHide:function(){document.body.removeEvent("click",l._hideModal)}}})).inject(this._widget.body)}this._viewMoreModal.show()}.bind(this)}}));return[{html:this.addChildView("usersView",{collection:this.collection,Class:c,modelViewClass:h,modelName:this.model.getModelName(),modelViewsCfg:{imageRenderingOptions:{format:"mini"},attributes:{"class":"float-left",styles:{"margin-right":"5px"}}}})},'<div style="clear:both;"></div>',(this.showViewMore?{styles:{"margin-top":"10px"},html:m}:"")]},init:function(){this._hideModal=function(l){var m=this.getControl("viewMoreBtn"),n=i.getElement(l);if(this._viewMoreModal&&m&&n!==m.elements.container){this._viewMoreModal.hide()}}.bind(this);return this._parent.apply(this,arguments)},setup:function(l){this._parent.apply(this,arguments);if(l.title){this.title=l.title}if(l.collection){this.collection=l.collection}if(l.showViewMore){this.showViewMore=l.showViewMore}return this}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/shared-contacts-small-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/contacts-small-view","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUIComponents/script/feature/core/user/view/user-mini-view","DS/SwymUICore/script/feature/core/sprite/sprite"],function(e,c,g,b,d,i,a,f,j,l){var h=i.extend({_imageRenderingOptions:{format:"mini"},defaultOptions:{displayPresence:false},_createContent:function(){var m=this._parent();this.addControl("tooltip",this._createTooltip(m,this.model));return m},_createTooltip:function(p,m){if(m){var n=m.get("company"),o=m.get("job_title"),s=m.get("city"),r=m.get("country"),q={html:[{html:{tag:"b",html:m.get("nickname")}},n?{html:n}:{},o?{html:o}:{},s?{html:s}:{},r?{html:r}:{}]};return new g(e.merge({target:p,position:"bottom",body:e.createElement("div",q).getHTML()},this.options.tooltipOptions))}return false}}),k=d.extend({_collectionClass:a,modelViewClass:h,domEvents:{"click .view-more-link":"_viewMoreLinkClicked"},name:"shared-contacts-small-view",limit:5,showMore:true,showBorder:true,tooltipOptions:null,_viewMoreLinkClicked:function(){if(!this._viewMoreModal){this._viewMoreModal=new f({closable:true,header:c.SharedContacts,body:[{html:new d({collection:this.collection,modelViewsCfg:{attributes:{"class":"float-left",styles:{"margin-bottom":"10px","min-width":"50%"}},modal:this._viewMoreModal},modelViewClass:j})},{html:'<div style="clear:both;"></div>'}],events:{onShow:function(){setTimeout(function(){document.body.addEvent("click",m)},0)},onHide:function(){document.body.removeEvent("click",m);this.destroy()}}}).inject(document.body);var m=function(){this.hide()}.bind(this._viewMoreModal)}this._viewMoreModal.show()},_getSharedContacts:function(){var m=this,n;if(this.model&&this.collection){n=this.model.get("ut_state");if(e.is(n)){if((n!=2)&&(n!=3)){this.collection.goToPage(1,{onFailure:function(){this.hide()}.bind(this)})}else{this.hide()}}else{this.listenToOnce(this.model,"onChange:ut_state",this._getSharedContacts)}}},_createContent:function(){var t,v,m,u,p=this.model,s="",n=[],q=this.collection;if(!q&&p){u=p.isCurrentUser();if(!u){q=p.getAssociated("contactsSharedWithCurrentUSer");this.setCollection(q,{refresh:false});if(!q.hasBeenFetched()){this._getSharedContacts()}}}if(q){t=q.length;if(!q.hasBeenFetched()){v=this.addControl("spinner",new b());v.show();s={"class":"flex-display",styles:{"justify-content":"center"},html:v}}else{if(t>0){this.removeControl("spinner");for(var o=0,r=Math.min(this.limit,t);o<r;o++){m=this._createModelView(q.at(o));n.push(this.addChildView(this.MODEL_VIEWS_INDEX_PREFIX+m.cid,m))}s=[{styles:{"font-size":"11px","font-weight":"bold"},html:c.SharedContacts},n];if(t>this.limit&&this.showMore===true){s.push({"class":"dsi-communityhome-link",styles:{clear:"both","float":"right","margin-right":"10px"},html:{tag:"a","class":"dsi-communitylink-all view-more-link",html:c.ViewMore}})}s={"class":this.showBorder?"border-top":"",html:s}}}}return s},setup:function(m){if(m){if(m.showMore===false){this.showMore=false}if(m.limit){this.limit=m.limit}if(m.hasOwnProperty("showBorder")){this.showBorder=m.showBorder}if(m.tooltipOptions){this.modelViewsCfg=this.modelViewsCfg||{},this.modelViewsCfg.tooltipOptions=m.tooltipOptions}}return this._parent.apply(this,arguments)}});return k});define("DS/SwymUIComponents/script/feature/community/media/view/uploader/dropzone-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/dropzone-view","UWA/Utils","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/community/media/model/media-file-extension-model","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/media/view/media-tooltip-view","DS/SwymUICore/script/lib/model/model-manager","DS/SwymUICore/script/feature/community/media/model/media-model","DS/WebappsUtils/Console","DS/Bookmark/script/BookmarkManager"],function(l,g,e,j,n,m,i,k,d,c,o){var h=(window.ds&&(window.ds.env==="3DD"));var b=e.Client.Platform.ios||e.Client.Platform.android,a=e.Client.Features.dragAndDrop&&!b&&(!h||h&&m.isCORSActivated());var f=j.extend({name:"dropzone",_mediaFileExtension:null,_dropzoneDragCounter:0,typeAllowed:null,dragItem:null,mode:null,domEvents:a?{"dragenter .media-uploader-dropzone":"_dragenter","dragover .media-uploader-dropzone":"_dragover","dragleave .media-uploader-dropzone":"_dragleave","drop .media-uploader-dropzone":"_drop","change .media-uploader-file-input":"_filesSelected"}:{"change .media-uploader-file-input":"_filesSelected"},_createContent:function(){var t=this,r=this.typeAllowed==="all"||this.typeAllowed==="file",p=this.mode==="bookmark"?g.DropYourContent:((a)?g.DropYourFilesFrom:g.DropYourFilesFromClick),s={tag:"div","class":"btn btn-default",html:[g.Browse,l.merge({multiple:"multiple",tag:"input","class":"media-uploader-file-input",type:"file",name:"userFile"})],styles:{position:"relative",top:"-3px"}},q={tag:"span","class":"fonticon fonticon-1-5x fonticon-help-circled",styles:{width:"38px",height:"38px",color:"#b4b6ba",position:"relative",cursor:"pointer"}},u=l.createElement("div",{"class":"drop-files-zone media-uploader-dropzone",html:[{tag:"div","class":"drop-files-zone-text",html:p},r?s:"",(r&&!l.Utils.Client.Features.touchEvents)?q:""]});this._widget.addEvent("ContentDragStarted",function(v){t.dragItem=v}.bind(this));this._widget.addEvent("ContentDragEnded",function(v){t.dragItem=null}.bind(this));return u},setup:function(p){this._parent.apply(this,arguments);this._mediaFileExtension=n.getInstance();this.showCollection=p.showCollection;this.performAdditionalChecks=p.performAdditionalChecks;this.typeAllowed=p.typeAllowed?p.typeAllowed:"all";this.mode=p.mode?p.mode:"media";if(!this._mediaFileExtension.hasBeenFetched()){this.mask();this.reactTo(this._mediaFileExtension,"onDocumentedFileExtensionsCreated",function(){this.unmask()})}},_dragleave:function(q){var p=this.container.getElement(".drop-files-zone-text");q.stopPropagation();q.preventDefault();this._dropzoneDragCounter--;if((this._dropzoneDragCounter===0)){if(this.container.hasClassName("dragover")){this.container.removeClassName("dragover")}else{if(this.container.hasClassName("dragoverForbidden")){this.container.removeClassName("dragoverForbidden")}}}if((this._dropzoneDragCounter===0)&&p){c.log("====== dragleave dropzone =========   ",p);if(p.hasClassName("dragover")){p.removeClassName("dragover")}else{if(p.hasClassName("dragoverForbidden")){p.removeClassName("dragoverForbidden")}}}},_dragenter:function(q){var p=this.container.getElement(".drop-files-zone-text"),r=this._checkDropAllowed(q.dataTransfer);q.stopPropagation();q.preventDefault();if((this._dropzoneDragCounter===0)&&!this.container.hasClassName("dragover")&&!this.container.hasClassName("dragoverForbidden")){if(r){this.container.addClassName("dragover")}else{this.container.addClassName("dragoverForbidden")}}if((this._dropzoneDragCounter===0)&&p&&!p.hasClassName("dragover")&&!this.container.hasClassName("dragoverForbidden")){c.log("====== dragenter dropzone =========   ",p);if(r){p.addClassName("dragover")}else{p.addClassName("dragoverForbidden")}}this._dropzoneDragCounter++},_dragover:function(p){p.stopPropagation();p.preventDefault()},_drop:function(v){v.stopPropagation();v.preventDefault();this._dropzoneDragCounter=0;var t=v.dataTransfer,s=t.files,p=JSON.parse(t.getData("text")||"{}"),r=true;if(s.length===0&&p.protocol==="3DXContent"&&this.mode!=="bookmark"){var u=p.data&&p.data.items[0],q=new d(u);if(u&&u.objectType!=="text/directory"){s=[];q.addChanges("is_illustration",false);s.push(q);this.dispatchEvent("on3DDriveMediaSelected",[s])}else{r=false}}else{this._handleFiles(s)}if(r){this.container.getElement(".drop-files-zone-text").removeClassName("dragover").removeClassName("dragoverForbidden");this.container.removeClassName("dragover").removeClassName("dragoverForbidden")}},_filesSelected:function(p){var q=p.target.files;if(q.length>0){this._handleFiles(q)}else{return false}},_handleFiles:function(q){if(this.mode==="bookmark"&&this.dragItem){var p=this.dragItem.data.items[0];o.add({title:p.displayName,subjectUri:p.subjectUri,serviceName:"3DSwym",linkServiceName:"3DSwym",linkUri:p.urlContent["3DD"]})}else{if(q&&(q.length>0)){if(l.is(this.performAdditionalChecks,"function")){this.performAdditionalChecks(q)}else{this.dispatchEvent("onFilesSelected",q);this.resetInputField()}}}},_checkDropAllowed:function(r){if(this.typeAllowed!=="all"){if(this.dragItem&&this.dragItem.protocol===this.typeAllowed){return true}if(r.items&&r.items[0]){var q=r.items[0],p=q.kind;if(p===this.typeAllowed||p==="string"){return true}}else{if(r.types&&r.types[0]){var p=r.types&&r.types[0];if(p==="Files"){p="file"}if(p===this.typeAllowed||p==="string"){return true}}}}else{return true}return false},resetInputField:function(){this.getElement(".media-uploader-file-input").value=""},enableBrowseButton:function(){this.getElement(".btn").removeClassName("disabled")},disableBrowseButton:function(){this.getElement(".btn").addClassName("disabled")},onRender:function(){if(this.getElement(".fonticon")){var p=this.addChildView("mediaTooltipView",new i({model:this._mediaFileExtension,target:this.getElement(".fonticon")}));p.addEvent("render",this.unmask)}}});return f});define("DS/SwymUIComponents/script/feature/core/user/view/user-tile-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/user-search-view","DS/SwymUIComponents/script/feature/community/members/view/member-tile-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/utils/utils"],function(g,d,f,b,e,c){var a=f.extend({name:"user-tile-view",defaultOptions:{displayBadges:true},_modelEventsForAutoRefresh:["onChange:nb_answer","onChange:nb_comment","onChange:nb_media","onChange:nb_post","onChange:nb_question"].concat(f.prototype._modelEventsForAutoRefresh),_getExtraClassForAccountActivation:function(){var h=this._parent.apply(this,arguments),i=c.isFeatureActivated("activateAccount");return(i?"ux-user-tile":"user-tile")+(h?(" "+h):"")},_createActionToolbar:function(){var h=this._parent.apply(this,arguments),i=this.model;if(h){e.getInstanceFetched(function(j){if(j.get("hash_key")===i.get("hash_key")){h.hide()}})}return h},_createPictureView:function(){return this.addChildView("userPicture",{Class:b,model:this.model,className:"member-picture",imageRenderingOptions:{format:"square"}})},_displayBasicUserInfoNewUXTile:function(){var h=this.model;return{html:[{"class":"user-name member-name",html:('<a data-content-type="person" data-hash-key="'+(h.get("hash_key")?h.get("hash_key"):"")+'"data-login="'+(h.get("login"))+'" class="link" >'+h.getNickname()+(h.isPendingUser()?" ("+d.Pending+")":"")+"</a>")},{"class":"user-info",html:((h.has("job_title")&&h.get("job_title").trim()!=="")?h.get("job_title"):"")+((h.has("company")&&h.get("company").trim()!=="")?((h.has("job_title")&&h.get("job_title").trim()!=="")?", ":"")+h.get("company"):"")}]}},_displayBasicUserInfoOldTile:function(){var h=this.model;return{styles:{"text-align":"center"},html:[{"class":"user-name member-name",html:('<a data-content-type="person" data-hash-key="'+(h.get("hash_key")?h.get("hash_key"):"")+'"data-login="'+(h.get("login"))+'" class="link" >'+h.getNickname()+(h.isPendingUser()?" ("+d.Pending+")":"")+"</a>")},{styles:{margin:"10px 0","font-style":"italic"},html:((h.has("job_title")&&h.get("job_title").trim()!=="")?h.get("job_title"):"")+((h.has("company")&&h.get("company").trim()!=="")?((h.has("job_title")&&h.get("job_title").trim()!=="")?", ":"")+h.get("company"):"")}]}},_displayBasicInfo:function(){var h=c.isFeatureActivated("activateAccount");return(h?this._displayBasicUserInfoNewUXTile():this._displayBasicUserInfoOldTile())},_getTileWrapperExtraAttributes:function(){return{"class":"no-rich-tooltip "+this._getExtraClassForAccountActivation(),"data-content-type":"person","data-hash-key":this.model.get("hash_key"),"data-login":this.model.get("login")}}});return a});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-status-admin-view",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/DropdownMenu","DS/UWPClientControls/PlatformNotify","DS/SwymUICore/script/feature/community/idea/collection/status-collection","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/request/data","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/idea/view/pipeline-view","DS/SwymUICore/script/lib/model/generic/swym-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-status-admin-view","UWA/Utils/Client"],function(j,h,a,e,k,c,n,b,g,m,i,l,o,f,d){return g.extend({name:"idea-status-admin",defaultOptions:{asAdmin:false},_statusCollection:null,_statusDeletion:[],domEvents:{"click .add-button":"_onAddStatusButtonClick","click .save-status-edition-button":"_onSaveStatusButtonClick","click .cancel-status-edition-button":"_onCancelButtonClick"},_createContent:function(){var s=[],p=false,q=[],r;if(this._statusCollection&&this._statusCollection.length>0){this._statusDeletion=[];this.addChildView("pipelineView",new l({widget:this._widget,config:{height:150,heightDiff:30,className:"",outClickable:true,curveColor:"#f4f5f6",containerId:this._widget.id,legend:false,statusCollection:this._statusCollection}}));this._statusCollection.forEach(function(t){q.push(this._pushStatus(t.toJSON()));if(t.get("is_mature")){p=true}s.push({selected:(t.get("is_mature")?true:false),label:t.get("title",{escapeHTML:false}),value:t.get("mid")})}.bind(this));if(p===false){s[s.length-1].selected=true}this.addControl("matureStatusSelect",new a({options:s,className:"margin-0",placeholder:false,events:{onChange:function(u){var t=u.target.value;this._statusCollection.forEach(function(v){if(t!==""){if(t==v.get("mid")){v.set("is_mature",true)}else{v.set("is_mature",false)}this.dispatchEvent("hasChanged",true)}}.bind(this))}.bind(this)}}));r={styles:{padding:"10px","min-height":"50px"},html:[this.getChildView("pipelineView"),{styles:{padding:"10px 0px",height:"53px",clear:"both"},html:["<b>"+f.StatusList+"</b> ("+f.Youcannotgetlessthanthreestatus+")",{styles:{"float":"right"},html:[new h({className:"primary add-button",value:f.Add})]}]},{"class":"status-panel",styles:{clear:"both","margin-bottom":"10px"},html:q},{styles:{clear:"both","margin-bottom":"10px"},"class":"mature-status-panel",html:[{html:'<div style="margin-bottom: 5px;"><b>'+f.MatureStatusTitle+"</b></div>"},this.getControl("matureStatusSelect")]}]};if(this._widget){this._widget.onResize=function(){if(this.getChildView("pipelineView")){this.getChildView("pipelineView").refresh()}}.bind(this)}}return r},_rdnColor:function(z){var w=this._statusCollection.length,p,x,A;if(z==="pastel"){p=(Math.round(Math.random()*127)+127).toString(16);x=(Math.round(Math.random()*127)+127).toString(16);A=(Math.round(Math.random()*127)+127).toString(16);return"#"+p+x+A}var t=function(D){var r="0123456789ABCDEF";return String(r.substr((D>>4)&15,1))+r.substr(D&15,1)},C=0,q=128,s=127,y=Math.PI*2/this._statusCollection.length,u=(Math.sin(y*(w+1)+2+C)*s+q),v=(Math.sin(y*(w+1)+C)*s+q),B=(Math.sin(y*(w+1)+4+C)*s+q);return"#"+t(u)+t(v)+t(B)},_deleteStatus:function(s,p,q){var r=this,t=r.getControl("matureStatusSelect");s.remove();s.destroy();r._statusCollection.remove(p);t.remove(p.get("mid").toString());t.getValue()[0];if(p.get("is_mature")&&q){t.select(q)}else{if(p.get("is_mature")){t.select(r._statusCollection.at(r._statusCollection.length-1).get("mid"))}}r._statusCollection.forEach(function(v,u){v.set("status_nb",u+1)});r.getChildView("pipelineView").refresh();if(r._statusCollection.length<4){if(i.isFeatureActivated("activateMoveStatusAndNewPipeline")){r._refreshStatusPanel()}else{r.getElements(".delete-button").forEach(function(u){u.hide()})}}r.dispatchEvent("hasChanged",true)},_moveLeft:function(p){var q=this,r=parseInt(p.get("status_nb"),10);q._statusCollection.forEach(function(s){if(parseInt(s.get("status_nb"),10)===(r-1)){s.set("status_nb",r)}});p.set("status_nb",r-1);q._statusCollection.sort();q.getChildView("pipelineView").refresh();q._refreshStatusPanel();q.dispatchEvent("hasChanged",true)},_moveRight:function(p){var q=this,r=parseInt(p.get("status_nb"),10);q._statusCollection.forEach(function(s){if(parseInt(s.get("status_nb"),10)===(r+1)){s.set("status_nb",r)}});p.set("status_nb",r+1);q._statusCollection.sort();q.getChildView("pipelineView").refresh();q._refreshStatusPanel();q.dispatchEvent("hasChanged",true)},_pushStatus:function(t){var u=this;if(!t){t={mid:new Date().getTime(),title:f.Status+" "+(u._statusCollection.length+1),status_nb:u._statusCollection.length+1,color:u._rdnColor("pastel"),new_status:true,is_mature:false};u._statusCollection.add(t);u.getControl("matureStatusSelect").add({label:t.title,value:t.mid})}var r=i.isFeatureActivated("activateMoveStatusAndNewPipeline"),x,q=this.addControl("statusEditPanel"+t.mid,j.createElement("div",{styles:{"margin-bottom":"10px"},"class":"col-lg-3 col-md-4 col-sm-6 col-xs-12",html:{html:[new e({className:"title-textfield",value:(t&&t.title?t.title:null),placeholder:f.Title}),{tag:"input",placeholder:f.Color,"class":(d.Engine.name==="safari"&&d.Platform.ios&&d.Platform.ipad===true?"color-input":"btn color-input color-textfield"),type:"color",name:"favcolor",value:(t&&t.color?t.color:"")},(r?x=new h({icon:"chevron-down",className:"default down-button"}):{tag:"span","class":"fonticon fonticon-erase delete-button"})]}}));var w=u._statusCollection.get("status:"+t.mid);if(r){var v=[{text:f.Movetoleft,fonticon:"expand-left",name:"move-left",disabled:(parseInt(w.get("status_nb"),10)===1),handler:function(){u._moveLeft(w)}},{text:f.Movetoright,fonticon:"expand-right",name:"move-right",disabled:(parseInt(w.get("status_nb"),10)===u._statusCollection.length),handler:function(){u._moveRight(w)}},{text:f.Delete,fonticon:"trash",name:"delete",disabled:(u._statusCollection.length<4),handler:function(){u._onDeleteStatusButtonClick(w,q)}}];var s=u.addControl("dropdownMenu-"+w.get("mid"),new c({target:x.getContent(),items:v,position:"top"}))}else{if(u._statusCollection.length<4){q.getElement(".delete-button").hide()}q.getElement(".delete-button").addEvent("click",function(){u._onDeleteStatusButtonClick(w,q)})}var p=q.getElement(".color-input");if(p&&p.style){q.getElement(".color-input").style.backgroundColor=w.get("color")}p.addEvent("change",function(){var y=p.value;this.statusModel.set("color",y);u.getChildView("pipelineView").refresh();if(p&&p.style){p.style.backgroundColor=y}u.dispatchEvent("hasChanged",true)}.bind({statusModel:w}));q.getElement(".title-textfield").addEvent("change",function(){u.getElements(".title-textfield").forEach(function(C,A,z){var B=true;z.forEach(function(D,E){if(C.value.trim()===D.value.trim()&&A!==E){C.getParent().addClassName("has-error");B=false}});if(B&&C.value.trim()!==""){C.getParent().removeClassName("has-error")}else{C.getParent().addClassName("has-error");n.error(f.Pleasecheckyourform)}});this.statusModel.set("title",q.getElement(".title-textfield").value);var y=[];u.getControl("matureStatusSelect").getOptions().forEach(function(z){y.push({value:z.getAttribute("value"),label:z.getText(),selected:z.selected})});y[parseInt(this.statusModel.get("status_nb"),10)-1].label=q.getElement(".title-textfield").value;u.getControl("matureStatusSelect").remove();u.getControl("matureStatusSelect").add(y)}.bind({statusModel:w}));return q},_onDeleteStatusButtonClick:function(t,p){var u=this,r=t,v=null,w=null;if(u._statusCollection.length>3){if(u._statusCollection.at(r.get("status_nb")-2)){v=u._statusCollection.at(r.get("status_nb")-2).get("mid")}if(u._statusCollection.at(r.get("status_nb"))){w=u._statusCollection.at(r.get("status_nb")).get("mid")}if(r.get("new_status")!==true){var x=this.addControl("myModal",new k({header:f.Confirm,body:'<div style="margin-bottom:10px;">'+f.Inwhichstatusdoyouwanttoputtheideaswhichareinstatus+" <b>"+r.get("title")+'</b></div><div><form style="margin-left:30px;" id="new_status_panel">'+(v?'<span id="prev_radio_wrapper"></span><label class="cursor-pointer" for="prev_status">'+u._statusCollection.get("status:"+v).get("title")+"</label></br>":"")+(w?'<span id="next_radio_wrapper"></span><label class="cursor-pointer" for="next_status">'+u._statusCollection.get("status:"+w).get("title")+"</label>":"")+"</form></div>"+(r.get("is_mature")?'<div style="margin-top:10px; font-style: italic;">'+f.NoteMature+" </div>":""),footer:[new h({value:f.OK,className:"primary",key:"return",events:{onClick:function(){var z=null,y;if(x.getContent().getElement("#new_status_panel").getElement("#prev_status")&&x.getContent().getElement("#new_status_panel").getElement("#prev_status").checked){z=x.getContent().getElement("#new_status_panel").getElement("#prev_status").value}else{if(x.getContent().getElement("#new_status_panel").getElement("#next_status")&&x.getContent().getElement("#new_status_panel").getElement("#next_status").checked){z=x.getContent().getElement("#new_status_panel").getElement("#next_status").value}}if(z){for(y=0;y<u._statusDeletion.length;y++){if(u._statusDeletion[y].new_status_id==this.get("mid")){u._statusDeletion[y].new_status_id=z}}u._deleteStatus(p,this,z);u._statusDeletion.push({deleted_status_id:this.get("mid"),new_status_id:z});x.hide();x.destroy()}}.bind(r)}}),new h({value:f.Cancel,key:"esc",events:{onClick:function(){x.hide();x.destroy()}}})]}));x.show();if(v){new UWA.Controls.Input.Radio({attributes:{id:"prev_status",name:"new_status",value:u._statusCollection.get("status:"+v).get("mid")}}).inject(x.getContent().getElement("#prev_radio_wrapper"))}if(w){new UWA.Controls.Input.Radio({attributes:{id:"next_status",name:"new_status",value:u._statusCollection.get("status:"+w).get("mid")}}).inject(x.getContent().getElement("#next_radio_wrapper"))}}else{var q=false,s;for(s=0;s<u._statusDeletion.length;s++){if(u._statusDeletion[s].new_status_id==r.get("mid")){q=true}}if(q){var x=this.addControl("myModal2",new k({header:f.Confirm,body:'<div style="margin-bottom:10px;">'+f.Inwhichstatusdoyouwanttoputtheideaswhichareinstatus+"<b>"+r.get("title")+'</b></div><div><form style="margin-left:30px;" id="new_status_panel">'+(v?'<span id="prev_radio_wrapper"></span><label class="cursor-pointer" for="prev_status">'+u._statusCollection.get("status:"+v).get("title")+"</label></br>":"")+(w?'<span id="next_radio_wrapper"></span><label class="cursor-pointer" for="next_status">'+u._statusCollection.get("status:"+w).get("title")+"</label>":"")+"</form></div>"+(r.get("is_mature")?'<div style="margin-top:10px; font-style: italic;">'+f.NoteMature+"</div>":""),footer:[new h({value:f.OK,className:"primary",key:"return",events:{onClick:function(){var z=null,y;if(x.getContent().getElement("#new_status_panel").getElement("#prev_status")&&x.getContent().getElement("#new_status_panel").getElement("#prev_status").checked){z=x.getContent().getElement("#new_status_panel").getElement("#prev_status").value}else{if(x.getContent().getElement("#new_status_panel").getElement("#next_status")&&x.getContent().getElement("#new_status_panel").getElement("#next_status").checked){z=x.getContent().getElement("#new_status_panel").getElement("#next_status").value}}if(z){for(y=0;y<u._statusDeletion.length;y++){if(u._statusDeletion[y].new_status_id==this.get("mid")){u._statusDeletion[y].new_status_id=z}}x.hide();x.destroy()}u._deleteStatus(p,r,z)}.bind(r)}}),new h({value:f.Cancel,key:"esc",events:{onClick:function(){x.hide();x.destroy()}}})]}));x.show();if(v&&u._statusCollection.get("status:"+v)){new UWA.Controls.Input.Radio({attributes:{id:"prev_status",name:"new_status",value:u._statusCollection.get("status:"+v).get("mid")}}).inject(x.getContent().getElement("#prev_radio_wrapper"))}if(w&&u._statusCollection.get("status:"+w)){new UWA.Controls.Input.Radio({attributes:{id:"next_status",name:"new_status",value:u._statusCollection.get("status:"+w).get("mid")}}).inject(x.getContent().getElement("#next_radio_wrapper"))}}else{u._deleteStatus(p,r)}}}},_onCancelButtonClick:function(){this.mask();this._statusDeletion=[];this.getChildView("pipelineView").statusCollection.fetch({onComplete:function(){this.getControl("matureStatusSelect").remove();var r=[],p=false,q=[];this.getElement(".status-panel").setContent("");this._statusCollection.forEach(function(s){q.push(this._pushStatus(s.toJSON()));if(s.get("is_mature")){p=true}r.push({selected:(s.get("is_mature")?true:false),label:s.get("title",{escapeHTML:false}),value:s.get("mid")})}.bind(this));if(p==false){r[r.length-1].selected=true}j.createElement("div",{html:q}).inject(this.getElement(".status-panel"));this.getControl("matureStatusSelect").add(r);this.getChildView("pipelineView").refresh();this.unmask()}.bind(this)})},_onAddStatusButtonClick:function(){var p=this,q=p._pushStatus();q.inject(p.getElement(".status-panel"));p.getChildView("pipelineView").refresh();if(p._statusCollection.length>3){if(i.isFeatureActivated("activateMoveStatusAndNewPipeline")){p._refreshStatusPanel()}else{p.getElements(".delete-button").forEach(function(r){r.show()})}}this.dispatchEvent("hasChanged",true)},_refreshStatusPanel:function(q){var s=this,p=[],r=(s._statusCollection.length>3);s._statusCollection.forEach(function(t,u,v){if(u===0){s.getControl("dropdownMenu-"+t.get("mid")).disableItem("move-left")}else{if(u===(v.length-1)){s.getControl("dropdownMenu-"+t.get("mid")).disableItem("move-right")}else{s.getControl("dropdownMenu-"+t.get("mid")).enableItem("move-left");s.getControl("dropdownMenu-"+t.get("mid")).enableItem("move-right")}}if(r){s.getControl("dropdownMenu-"+t.get("mid")).enableItem("delete")}else{s.getControl("dropdownMenu-"+t.get("mid")).disableItem("delete")}p.push(s.getControl("statusEditPanel"+t.get("mid")))});s.getElement(".status-panel").setContent("");j.createElement("div",{html:p}).inject(s.getElement(".status-panel"))},pipelineValidation:function(){var p=true,q=false;this._ideaStatusArray=[];this._statusCollection.forEach(function(t,s,v){if(t.get("title").trim()===""||t.get("color").trim()==""){p=false}if(t.get("is_mature")){q=true}v.forEach(function(w){if(t.get("title")===w.get("title")&&t.get("mid")!==w.get("mid")){p=false}});var u=t.toJSON(),r={id:u.mid,title:u.title,status_nb:s+1,color:u.color,new_status:u.new_status,is_mature:u.is_mature};this._ideaStatusArray.push(r)},this);!q&&n.error(f.SomethingWentWrongWithYourMatureStatusPleaseSelectAgainAMatureStatus);!p&&n.error(f.IdeaStatusTitleMustBeUnique);return(p==true&&q==true)},saveStatus:function(){this.mask();var p=o.adaptService({url:"/api/Ideation/updatestatus",data:{community_id:this.model.get("mid"),status_list:this._ideaStatusArray,status_deletion:this._statusDeletion,as_admin:this.getOption("asAdmin")},onComplete:function(r){if(r.result){this._statusDeletion=[];if(this._confirmationModal){this._confirmationModal.hide()}this._statusCollection.reset(r.result);this.getControl("matureStatusSelect").remove();var s=[],q=[];this.getElement(".status-panel").setContent("");this._statusCollection.forEach(function(t){q.push(this._pushStatus(t.toJSON()));s.push({value:t.get("mid"),label:t.get("title"),selected:(t.get("is_mature")?true:false)})}.bind(this));j.createElement("div",{html:q}).inject(this.getElement(".status-panel"));this.getControl("matureStatusSelect").add(s);this._statusCollection.dispatchEvent("onEdit");this.dispatchEvent("onStatusSaveCallback",true)}this.unmask()}.bind(this),onFailure:function(q){this.dispatchEvent("onStatusSaveCallback",false);if(q&&q.errorcode==="ERROR_UPDATING_IDEA_STATUSES_WITHOUT_MATURE"){n.error(f.ErrorUpdatingIdeaStatusesWithoutMature)}else{n.error(f.Errorwhilesavingyournewstatuslist)}this.unmask()}.bind(this)});m.request(p)},_onSaveStatusButtonClick:function(){if(this.pipelineValidation()){if(!this._confirmationModal){this._confirmationModal=this.addControl("myModal3",new k({header:f.Confirm,body:"<div>"+f.Areyousureyouwanttoupdatestatuslist+"<div>",footer:[new h({value:f.OK,className:"primary",key:"return",events:{onClick:this.saveStatus.bind(this)}}),new h({value:f.Cancel,key:"esc",events:{onClick:function(){this._confirmationModal.hide()}.bind(this)}})]}))}this._confirmationModal.show()}else{n.error(f.Pleasecheckyourform)}},setup:function(q){var p=this._parent.apply(this,arguments);this._statusCollection=this.model.getStatus();this.reactTo(this._statusCollection,"onSync","refresh");return p}})});define("DS/SwymUIComponents/script/feature/core/tenant/view/settings-tab-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/swym-control-center-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/tenant/view/tenant-media-max-size-view","DS/SwymUIComponents/script/feature/community/idea/view/idea-status-admin-view","DS/SwymUIComponents/script/feature/core/tenant/view/tenant-settings-view","DS/SwymUIComponents/script/feature/core/tenant/view/tenant-stats-view","DS/SwymUICore/script/feature/community/idea/collection/status-collection","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/UIKIT/Input/Button"],function(g,b,f,i,k,c,h,a,j,d,e){return f.extend({name:"settings-tab-view",_tenantSettings:null,_tenantMediaMaxSize:null,_tenantStats:null,setup:function(){this._parent.apply(this,arguments);this._init();this._tenantSettings.handler();this._tenantMediaMaxSize.handler();this._tenantStats.handler()},_init:function(){var l=this;l._tenantSettings={handler:function(){l._tenantSettings.wrapperEl=g.createElement("div",{"class":"settings-tenant-settings-wrapper col-md-4"});g.createElement("h4",{html:b.Features}).inject(l._tenantSettings.wrapperEl);l.model.listOptions({onComplete:function(n,m){l._tenantSettings.view=new c({model:l.model,options:m.result});l._tenantSettings.view.render(l._tenantSettings.wrapperEl);console.log("in settings-tab-view tenant-model listOptions onComplete")}})}};l._tenantMediaMaxSize={handler:function(){l._tenantMediaMaxSize.view=new i({model:l.model});l._tenantMediaMaxSize.wrapperEl=g.createElement("div",{"class":"settings-tenant-media-max-size-wrapper col-md-4"});g.createElement("h4",{html:b.Maximummedia}).inject(l._tenantMediaMaxSize.wrapperEl);l._tenantMediaMaxSize.view.render(l._tenantMediaMaxSize.wrapperEl)}};l._tenantStats={handler:function(){l._tenantStats.wrapperEl=g.createElement("div",{"class":"settings-tenant-stats-wrapper col-md-4"});g.createElement("h4",{html:b.Usage}).inject(l._tenantStats.wrapperEl);l.model.getTenantInfo({onComplete:function(){console.log("in settings-tab-view tenant-model getTenantInfo onComplete");l._tenantStats.view=new h({model:l.model});l._tenantStats.view.render(l._tenantStats.wrapperEl)}})}}},_createContent:function(){return[g.createElement("div",{html:[this._tenantSettings.wrapperEl,this._tenantMediaMaxSize.wrapperEl,this._tenantStats.wrapperEl]})]}})});define("DS/SwymUIComponents/script/feature/core/tenant/view/community-users-management-home-view",["UWA/Core","DS/SwymUICore/script/feature/core/user/model/currentuser-model","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/community-users-management-home-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/collection/community-collection","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/utils/content-upload-error","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/SwymUICore/script/utils/utils","DS/WAFData/WAFData"],function(j,m,e,g,b,n,a,h,f,k,c,i,l){var d=g.extend({name:"community-users-management-home-view",model:null,_el:null,_currentUser:null,_addUsersToCommunitiesModal:null,_removeUsersFromCommunitiesModal:null,_exportListOfCommunityUsersModal:null,_selectedFile:null,_confirmModal:null,_communityCollection:null,_communitySelectOptions:null,_currentModal:null,_asAdmin:false,domEvents:{"click .add-users-to-communities":"onAddUsersToCommunities","click .remove-users-from-communities":"onRemoveUsersFromCommunities","click .export-list-of-community-users":"onExportListOfCommunityUsers"},_filesSelected:function(r){var s=r.target.files;if(s.length){for(var p=-1,o=s.length;++p<o;){var q=s[p];if(undefined===q.fileName){q.fileName=q.name}this.view._selectedFile={browserFileData:q}}this.view.getControl(this.mode+"-csv-file-input").elements.text.removeClassName("field-error")}},_resetForm:function(o,p){o.getControl(p+"-form").reset();o.getControl(p+"-form").unvalidate();if(p!=="export"){o.getControl(p+"-csv-file-input").setValue("");o.getControl(p+"-csv-file-input").elements.text.removeClassName("field-error");o._selectedFile=null}o._currentModal.hide()},_createContent:function(){if(!this._controls["add-users-to-communities"]){if(n.getInstance().isFeatureActivated("activate_import_community_users")){this.addControl("add-users-to-communities",new f({className:"primary add-users-to-communities",value:(!this.model?e.adduserstocommunities:e.adduserstothiscommunity)}))}this.addControl("remove-users-from-communities",new f({className:"primary remove-users-from-communities",value:(!this.model?e.removeusersfromcommunities:e.removeusersfromthiscommunity)}));if(n.getInstance().isFeatureActivated("activate_export_community_users")){this.addControl("export-list-of-community-users",new f({className:"primary export-list-of-community-users",value:e.exportListOfCommunityUsers}))}}var o=j.createElement("div",{styles:{padding:"0 10px 10px 10px","min-height":"48px"},html:[this._controls["remove-users-from-communities"],(n.getInstance().isFeatureActivated("activate_import_community_users")?this._controls["add-users-to-communities"]:""),(n.getInstance().isFeatureActivated("activate_export_community_users")?this._controls["export-list-of-community-users"]:"")]});return o},onRender:function(){if(!this.model){this.mask()}},_createModal:function(t,p){var o=this;var s=[];if(p.hideName!==true){s.push({type:"text",name:"name-input",pattern:"(?:\\s*[^\\s]+\\s*)+",label:e.name,required:true})}if(!o.model){s.push({type:"select",name:"communities-select",className:"communities-select",label:e.Selectacommunity,required:true,multiple:(p.hideFile===true?false:true),options:this._communitySelectOptions})}if(p.hideRole!==true){s.push({type:"select",name:"role-select",label:e.selectrole,required:true,options:(t==="export"?[{value:0,label:e.all,selected:true},{value:1,label:e.contributor},{value:2,label:e.author},{value:3,label:e.owner}]:[{value:1,label:e.contributor,selected:true},{value:2,label:e.author},{value:3,label:e.owner}])});if(t==="add"){s.push({type:"html",html:'<div style="font-style: italic;">'+(!o.model?e.rolechangeinfo:e.rolechangeinfosingle)+"</div>"})}}if(p.hideFormat!==true){s.push({type:"select",name:"format-select",label:e.Format,required:true,options:[{value:"csv",label:"CSV"},{value:"xls",label:"MS Excel (.xls)"}]})}var r=new h({fields:s});var q=this.addControl(t+"Modal",new k({closable:true,header:"<h4>"+p.title+"</h4>",className:t+"-users-modal",body:[(p.hideWarning===true?"":{html:'<div style="margin-bottom:10px;">'+e.oncesubmittedthisformwillbesenttotheservertobeprocessed+"<br/>"+e.detailsandresultsofthisprocesscanbeviewedonthepage+"</div>"}),this.addControl(t+"-form",r),(p.hideFile===true?"":j.createElement("div",{"class":"upload-csv-file-container",html:[this.addControl(t+"-csv-file-input",new j.Controls.Input.File({className:"csv-file-input",type:"file",placeholder:e.selectcsv,events:{onChange:this._filesSelected.bind({view:this,mode:t})}})),new f({className:"see-example-button default",value:e.seeExample,events:{onClick:function(){window.open(i.getBaseUrl()+"/api/community/getimportmembercsvsample/import-community-members-sample.csv")}}})]})),(p.hideFile===true?"":{styles:{"margin-top":"10px","font-style":"italic"},html:(t==="add"?e.formatofthecontentsofthecsvfile+"<br/>"+e.formatofthecontentsofthecsvfileSecondLine:e.formatofthecontentsofthecsvfile+"<br/>"+e.thecsvfileshouldcontaininthefollowingorder+": <br/> <b>"+e.login+", "+e.email+"</b> <br/> "+e.thecsvfilecancontainafirstlinewithcolumntitlesbutonlyinEnglish)})],footer:[new f({className:"primary",value:e.submit,events:{onClick:function(){var u=this.view;if(this.mode!=="export"){if(u.getControl(this.mode+"-form").validate()&&this.view._selectedFile){u._confirmModal.confirm(e.oncelaunchedprocesscannotbecanceleddoyouwishtocontinue,e.confirm,function(B){if(B===true){var D=new FormData(),F=new XMLHttpRequest(),C=i.getBaseUrl()+"/api/member/addbatch",E=function(I,H){if(this.mode==="add"){this.view._addUsersToCommunitiesModal.hide()}else{this.view._removeUsersFromCommunitiesModal.hide()}if(I.currentTarget){I=I.currentTarget.responseText}var G;if(typeof I==="object"){G=JSON.parse(H)}else{G=JSON.parse(I)}if(G.errorcode){a.printErrorMessage(G,"csv")}else{this.view.alert("success",e.processaddedmsg);this.view.getControl(this.mode+"-form").reset();this.view.getControl(t+"-csv-file-input").setValue(null)}this.view._currentUser.dispatchEvent("refreshUserManagementProcesses")}.bind(this);D.append("processName",this.view.getControl(this.mode+"-form").getValue("name-input"));D.append("communityId",u.model.get("mid"));D.append("operationType",this.mode);D.append("userType",4);D.append("as_admin",u._asAdmin);if(this.mode==="add"){D.append("roleId",this.view.getControl(this.mode+"-form").getValue("role-select"))}D.append("file-path",(this.view._selectedFile?this.view._selectedFile.browserFileData:""));if(ds&&(ds.env==="3DD")){l.authenticatedRequest(C,{data:D,method:"POST",timeout:60000,onComplete:E,onFailure:E})}else{F.addEventListener("load",E);F.open("POST",C,true);F.send(D)}}}.bind({view:u,mode:this.mode}))}else{if(!this.view._selectedFile){this.view.getControl(t+"-csv-file-input").elements.text.addClassName("field-error")}this.view.alert("warn",e.Pleasecheckyourform)}}else{if(u.getControl(this.mode+"-form").validate()){var x=function(G){var I=function(P){var O=typeof P,L;if(O==="object"&&!P){return"null"}if(O==="object"){if(!P.constructor){return"object"}var K=P.constructor.toString();if(L=K.match(/(\w+)\(/)){K=L[1].toLowerCase()}var N=["boolean","number","string","array"];for(var M in N){if(N.hasOwnProperty(M)){if(K===N[M]){O=N[M];break}}}}return O};var E=I(G);var B=null,C="";switch(E){case"function":B="";break;case"undefined":B="N";break;case"boolean":B="b:"+(G?"1":"0");break;case"number":B=(Math.round(G)===G?"i":"d")+":"+G;break;case"string":B="s:"+G.length+':"'+G+'"';break;case"array":case"object":B="a";var D=0;var F="";var J;for(var H in G){if(G.hasOwnProperty(H)){C=I(G[H]);if(C==="function"){continue}J=(H.match(/^[0-9]+$/)?parseInt(H,10):H);F+=x(J)+x(G[H]);D++}}B+=":"+D+":{"+F+"}";break}if(E!=="object"&&E!=="array"){B+=","}return B};var y=null;var w=u.getControl(this.mode+"-form").getValue("role-select");if((w>0)&&(w<4)){y=[{type:"team_role_filter",values:w}]}else{if(w===0){y=[]}}var z;if(u.model){z=u.model.get("mid")}else{z=u.getControl(this.mode+"-form").getValue("communities-select")}var v=i.getBaseUrl()+"/api/community/getteamfile/as_admin/"+u._asAdmin+"/community_id/"+z;if(y){v+="/filters/"+encodeURI(x(y))}var A=u.getControl(this.mode+"-form").getValue("format-select");if(A){v+="/format/"+A}window.open(v);u._exportListOfCommunityUsersModal.hide()}else{this.view.alert("warn",e.Pleasecheckyourform)}}}.bind({view:this,mode:t})}}),new f({value:e.cancel,events:{onClick:function(){o._resetForm(o,t)}}})]}));switch(t){case"add":o._addUsersToCommunitiesModal=q;break;case"remove":o._removeUsersFromCommunitiesModal=q;break;case"export":o._exportListOfCommunityUsersModal=q;break}return q},onAddUsersToCommunities:function(){if(this._addUsersToCommunitiesModal){this._addUsersToCommunitiesModal.show()}else{this._createModal("add",{title:(!this.model?e.adduserstocommunities:e.adduserstothiscommunity),hideFormat:true}).show()}this._currentModal=this._addUsersToCommunitiesModal},onRemoveUsersFromCommunities:function(){if(this._removeUsersFromCommunitiesModal){this._removeUsersFromCommunitiesModal.show()}else{this._createModal("remove",{title:(!this.model?e.removeusersfromcommunities:e.removeusersfromthiscommunity),hideRole:true,hideFormat:true}).show()}this._currentModal=this._removeUsersFromCommunitiesModal},onExportListOfCommunityUsers:function(){if(this._exportListOfCommunityUsersModal){this._exportListOfCommunityUsersModal.show()}else{this._createModal("export",{title:e.exportListOfCommunityUsers,hideWarning:true,hideName:true,hideFile:true}).show()}this._currentModal=this._exportListOfCommunityUsersModal},setup:function(o){var p=this;p._parent.apply(p,arguments);p._currentUser=m.getInstance();if(o&&o.asAdmin){p._asAdmin=o.asAdmin}if(!p.model){p._communitySelectOptions=[];p._pageIndex=1;p._communityCollection=new b([],{mode:"tenant-communities",pageMode:"start",limit:500});p._communityCollection.fetchPage(p._pageIndex);p._communityCollection.addEvent("onAfterPageChange",function(){var s=this._models;for(var r=0,q=s.length;r<q;r++){p._communitySelectOptions.push({label:s[r].get("title",{escapeHTML:false}),value:s[r].get("mid")})}if(this.getNbLoadedModels()<this.getTotalItems()){p._pageIndex++;p._communityCollection.fetchPage(p._pageIndex)}else{p.unmask()}},p._communityCollection)}p._confirmModal=new c({closable:false,renderTo:p._widget.body})}});return d});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/internal-rich-link-preview-model",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-model"],function(c,b){var a=b.extend({defaults:{communityName:"",communityID:"",tenantURL:"",authorName:"",authorID:"",answerValidated:"",mediaType:""}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/media-details-view",["UWA/Core","UWA/Utils/Client","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/content-details-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/model/generic/community-content","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils"],function(g,f,d,e,b,h,c){var a=e.extend({_modelClass:b,_modelEventsForAutoRefresh:["onChange"],name:"media-details-view",_showDownloadButton:false,setup:function(i){if(i){if(typeof i.showDownloadButton!=="undefined"){this._showDownloadButton=i.showDownloadButton}}this._parent.apply(this,arguments)},onRender:function(){this._addDownloadButtonView()},onRefresh:function(){this._addDownloadButtonView()},_addDownloadButtonView:function(){if(this._showDownloadButton===true){var i=this.addChildView("media-download-view",{Class:"DS/SwymUIComponents/script/feature/community/content/view/media-download-view",model:this.model,events:{onInit:function(k){this.listenTo(k,"onMediaDownload",this._onMediaDownload.bind(this))}.bind(this)}}),j=this.container.getElement(".media-right");if(i&&j){i.inject(j)}}},_onMediaDownload:function(){this.dispatchEvent("onMediaDownload")},_createContent:function(){var j=this.model,i=null,k=null,l=null,m;if(j){m=(j.get("status")===h.MEDIA_PROCESSING_STATUS.OK);if(m){i=this.getOriginalNameDetails();k=this.getResolutionDetails();l=this.getDurationDetails()}return[this.getMediaDescription(),{"class":"media-globals",html:[{"class":"media-left",html:(m?[{"class":"media-details-title",html:d.Properties},{"class":"media-display-flex",html:[{"class":"media-label-details",html:[i.label,k.label,l.label]},{"class":"media-content-details",html:[i.value,k.value,l.value]}]}]:this.getRelatedPost())},{"class":"media-right"}]},m?this.getRelatedPost():""]}else{return""}},getMediaDescription:function(){var i=this.model;if(i.has("content")&&i.get("content")!==""){return{"class":"description content-body",html:i.get("content",{stripTags:true})}}else{return""}},getOriginalNameDetails:function(){var j,i=this.model;if(i.get("orig_name")){j=c.prettySize(i.get("size"));return{label:{"class":"media-details-label",html:d.FileDetails},value:{html:(i.get("download_original_file")==="1"||i.get("media_type")==="document")?i.get("orig_name")+(j?(" ("+j+")"):""):i.get("orig_name")}}}else{return{label:"",value:""}}},getResolutionDetails:function(){var i=this.model;if(i.get("media_type")==="video"||i.get("media_type")==="picture"){return{label:{"class":"media-details-label",html:d.Resolution},value:{html:i.get("width")+"x"+i.get("height")+((" ("+i.get("ratio")+")")||"")}}}else{return{label:"",value:""}}},getDurationDetails:function(){var i=this.model;if((i.get("media_type")==="video"||i.get("media_type")==="sound")&&i.get("duration")){return{label:{"class":"media-details-label",html:d.Length},value:{html:i.get("duration")}}}else{return{label:"",value:""}}},getRelatedPost:function(){var k=this.model;if(k.get("related_post_count")&&k.get("related_post_count")!==0&&k.get("related_post")){var j=k.get("related_post").map(function(m){return{html:[{tag:"span","class":"fonticon fonticon-newspaper"},{tag:"a","class":"related-post-link","data-content-id":m.c_post_id,"data-content-type":"post","data-community-id":m.community_id,html:m.post_title.escapeHTML()}]}});var i={"class":"wraper_related_post",html:j};var l={"class":"media-details-title",html:d.Relatedposts};return[l,i]}else{return""}}});return a});define("DS/SwymUIComponents/script/feature/community/post/post-view",["UWA/Core","DS/SwymUICore/script/feature/community/post/model/post-model","DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view"],function(d,a,c){var b=c.extend({_modelClass:a,name:"post-view",defaultOptions:{iconCls:"newspaper",summaryViewClass:"DS/SwymUIComponents/script/feature/community/post/view/post-summary-view",detailedViewClass:"DS/SwymUIComponents/script/feature/community/post/view/post-detailed-view",editViewClass:"DS/SwymUIComponents/script/feature/community/post/edit/post-edit-view"}});return b});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/embedded-rich-link-processing-utils",["UWA/Core","UWA/Ajax","UWA/Data","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/oembed-providers-list","DS/UIKIT/Alert","DS/Logger/Logger"],function(f,d,c,e,b){var a={getOEmbedJson:function(h,i){var g="http://www.youtube.com/oembed?url="+h+"&format=json";c.request(g,{proxy:"ajax",type:"json",onComplete:function(j,k){console.log("getEmbedInformation onComplete",arguments);i(createModelFromJson(j,h))}})}};return a});function createModelFromJson(a,b){return{type:"video",title:a.title,image:a.thumbnail_url,iframe:a.html,url:b}}function getHostName(b){var a=b.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);if(a!=null&&a.length>2&&typeof a[2]==="string"&&a[2].length>0){return a[2]}else{return null}}define("DS/SwymUIComponents/script/feature/community/wiki/wiki-view",["UWA/Core","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view"],function(c,d,b){var a=b.extend({_modelClass:d,name:"wiki-view",className:"community-content-wrapper content-item new",defaultOptions:{iconCls:"book-open",detailedViewClass:"DS/SwymUIComponents/script/feature/community/wiki/view/wiki-detailed-view",editViewClass:"DS/SwymUIComponents/script/feature/community/wiki/edit/wiki-edit-view"},_createDetailedView:function(){var e=this;this.setOption("detailedViewEvents",{onScrollToElement:function(f){e.dispatchEvent("onScrollToElement",f)}});return e._parent.apply(e,arguments)}});return a});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-home-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/idea/collection/idea-collection","DS/SwymUICore/script/feature/community/idea/collection/status-collection","DS/SwymUICore/script/lib/model/model-manager","DS/SwymUIComponents/script/feature/community/idea/view/pipeline-view"],function(g,d,b,a,e,h){var f=false,i,c=d.extend({name:"idea-home-view",_refreshEvents:["onSort","onReset","onRemove"],_height:130,_className:"status",_outClickable:false,_communityId:null,_statusCollection:null,_fullIdeaCollectionInstance:null,_initPipeline:function(){var k,j;if(this.taggingContextManager){k=this.taggingContextManager.getActiveProxiesManagers();if(k){for(j in k){if(k.hasOwnProperty(j)){this.onTaggerFilteringRequest(k[j].getActiveFilters())}break}}}},_createContent:function(){var j={"class":"svg-pipeline",styles:{flex:"0 0 auto",margin:"0px 10px"},html:this.getChildView("pipelineView")};if(this.getChildView("pipelineView")){this.getChildView("pipelineView").mask()}return j},_resetIdeaCollection:function(){var j=this;if(this._fullIdeaCollectionInstance){this._fullIdeaCollectionInstance.resetCollection(1,{serviceName:"read",onComplete:function(){j.dispatchEvent("onTotalIdeasChanged",j._countNbIdeas())}})}},_onPublishing:function(k){try{var j=false,n=false,l;if(this._fullIdeaCollectionInstance&&k instanceof this._fullIdeaCollectionInstance.model){j=true;l=this._fullIdeaCollectionInstance.communityId;if(l){if(k.get("community->mid")===l){n=true}}else{n=true}}if(j===true&&n===true){this._resetIdeaCollection()}}catch(m){return false}},onTaggerFilteringRequest:function(n){var o="ds6w:what/ds6w:status",l=this.getChildView("pipelineView"),p,k,m,j;if(this.taggingContextManager){for(p in this.taggingContextManager._activeProxiesManagers){break}m=this.taggingContextManager._activeProxiesManagers[p]._proxy.getCurrentFilter().localfilters;k=m&&m.hasOwnProperty(o)&&m[o];if(k&&l){j=l.statusCollection&&l.statusCollection.find(function(q){return k&&q.get("title")===k[0].object});if(j&&l.zoom!==j.get("status_nb")){l._zoomStatus(l,j?j.get("status_nb"):0).call()}}else{if(l.zoom>0){l._zoomStatus(l,0).call()}}}},setup:function(m){var o=this,n,l,j=this._parent.apply(this,arguments);this.taggingContextManager=m.taggingContextManager;if(this.model&&this.model.get("mid")){if(this._communityId!==this.model.get("mid")){this._communityId=this.model.get("mid");this._statusCollection=this.model.getStatus();this._fullIdeaCollectionInstance=new b([],{mode:"community-full-list",communityId:this._communityId,limit:999,fetchTagsSeparatelyOnRefresh:false});this._fullIdeaCollectionInstance.fetch();var k=this.addChildView("pipelineView",new h({widget:this._widget,config:{height:this._height,heightDiff:this._height/4,className:this._className,outClickable:this._outClickable,curveColor:this._curveColor,containerId:this.cid,statusCollection:this._statusCollection,collectionEventsForAutoRefresh:this._refreshEvents,legend:true}}));if(m.taggingContextManager){n=m.taggingContextManager.getActiveProxiesManagers();if(n){for(l in n){if(n.hasOwnProperty(l)){n[l].getClient()&&n[l].getClient().addEvent("onServerFilteringRequest",o.onTaggerFilteringRequest,o);this.listenTo(n[l],"onClientChange",function(p){p.addEvent("onServerFilteringRequest",o.onTaggerFilteringRequest,o)});break}}}}if(i){window.removeEventListener("resize",i)}i=function(){if(f===false){f=true;setTimeout(function(){if(!k.isDestroyed()){k.refresh();k._zoomStatus(k,k.zoom).call()}f=false},800)}};window.addEventListener("resize",i);if(m.taggingContextManager){this.listenTo(k,"ZoomIdeaStatus",function(s){var u;for(u in m.taggingContextManager._activeProxiesManagers){break}var t=[],q;if(s){if(s.status_title){q=g.createElement("div",{html:s.status_title}).getText();t.push({object:q,type:"string"})}else{if(s.out){q="ds6w:status.swym_inactive";t.push({object:q,type:"string"})}}if(t.length>0){var p;if(g.is(m.taggingContextManager._activeProxiesManagers[u]._proxy.getCurrentFilter().localfilters)){p=m.taggingContextManager._activeProxiesManagers[u]._proxy.getCurrentFilter().localfilters["ds6w:what/ds6w:status"]}if(!p||(p&&p["0"].object!==q)){m.taggingContextManager._activeProxiesManagers[u]._proxy.setLocalFilter({"ds6w:what/ds6w:status":t})}}else{var r=m.taggingContextManager._activeProxiesManagers[u]._proxy.getCurrentFilter().localfilters;delete r["ds6w:what/ds6w:status"];m.taggingContextManager._activeProxiesManagers[u]._proxy.clearLocalFilter(r?false:true);if(r){m.taggingContextManager._activeProxiesManagers[u]._proxy.setLocalFilter(r)}}}})}this.model.getNbIdeasPerStatus({onComplete:function(){o._onStatusCollectionFetch()}});e.addListenerOnPublishing(this._onPublishing.bind(this));e.addListenerOnDestroy(this._resetIdeaCollection.bind(this));return j}}},_countNbIdeas:function(){var j=0;this._statusCollection.forEach(function(k){j+=k.get("nb_ideas")});return j},_onStatusCollectionFetch:function(){this.getChildView("pipelineView").refresh();this.getChildView("pipelineView").mask();if(this._fullIdeaCollectionInstance.hasBeenFetched()){this.dispatchEvent("onTotalIdeasChanged",this._countNbIdeas());this._fullIdeaCollectionInstance.collectionPostProcess(this._statusCollection);this.getChildView("pipelineView").setIdeaCollection(this._fullIdeaCollectionInstance);this._initPipeline();this.getChildView("pipelineView").unmask()}else{this._fullIdeaCollectionInstance.addEventOnce("onSync",function(){this.dispatchEvent("onTotalIdeasChanged",this._countNbIdeas());this._fullIdeaCollectionInstance.collectionPostProcess(this._statusCollection);this.getChildView("pipelineView").setIdeaCollection(this._fullIdeaCollectionInstance);this._initPipeline();this.getChildView("pipelineView").unmask()}.bind(this))}},onDestroy:function(){e.removeListenerOnPublishing(this._onPublishing.bind(this));e.removeListenerOnDestroy(this._resetIdeaCollection.bind(this))}});return c});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-pipeline-modal",["DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUIComponents/script/feature/community/idea/view/idea-home-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/context/context-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/pipeline-view"],function(g,b,f,a,d,e){var c=g.extend({_modal:null,init:function(h){var j=this,i=typeof(h)==="object"?h:{communityId:h},k=i.communityId;this._parent.call(this,i);this._modal=this.addControl("modal",new b({className:"ideas-pp-modal",header:e.get("IdeasPipeline"),body:j.addChildView("ideaHomeView",new f({addScroller:true,model:new a({mid:k}),taggingContextManager:i.taggingContextManager,events:{onTotalIdeasChanged:function(l){j._modal.setHeader("<h4>"+e.get("IdeasPipeline")+'<span class="counter">'+l+"</span></h4>")}}}))}));d.getInstance().addOnce("onContextChange",j.destroy,j,false)},show:function(){this._modal&&this._modal.show()},hide:function(){this._modal&&this._modal.hide()},destroy:function(){this.removeControl("modal");return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/external-rich-link-processing-utils",["UWA/Data","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/oembed-providers-list","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/rich-link-preview/external-rich-link-processing-utils"],function(b,d,c){var a={_parseHtml:function(j,l,e){var t=/<meta[^>]*?property\s*="?og:(image|description|title)"?[^<]*?>/ig;var s=[];var w,p,m;var u;for(var q=0;q<3;q++){u=t.exec(l);if(u!=null){s.push(u)}else{break}}for(var q=0;q<s.length;q++){var k=s[q];var g=new DOMParser();var o=k[0].replace(/&nbsp;/g," ");var r=o.length;var n=o.charAt(r-2);if(n!="/"){var o=o.substring(0,r-1)+"/"+o.substring(r-1)}var f=g.parseFromString(o,"text/xml");switch(f.firstChild.getAttribute("property")){case"og:title":w=f.firstChild.getAttribute("content");break;case"og:description":p=f.firstChild.getAttribute("content");break;case"og:image":m=f.firstChild.getAttribute("content");m=m.replace(/^http:\/\//i,"https://");break}}if(typeof w==="undefined"){var h=/<title>?[\s\S].*?[\s\S]<\/title>/ig;var v=l.match(h);w=v.toString().replace(/<[^>]*>/g,"")}if(typeof m==="undefined"){m="null"}return{type:"html",title:w,description:p,image:m,url:j,domain:getHostName(j)}},getURLInformation:function(e,f){b.request(e,{proxy:"ajax",onFailure:function(){require(["DS/UWPClientControls/PlatformNotify"],function(g){g.warn(c.urlNotReachable)})},onComplete:function(g,k){console.log("getURLInformation onComplete",k);var h,j=Object.keys(k);var l=j.length;var i={};while(l--){h=j[l];i[h.toLowerCase()]=k[h]}if((i["content-type"]).match(/text\/html/g)||(i["content-type"]).match(/application\/xhtml/g)){f(a._parseHtml(e,g,k))}}})}};return a});function getHostName(b){var a=b.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);if(a!=null&&a.length>2&&typeof a[2]==="string"&&a[2].length>0){return a[2]}else{return null}}define("DS/SwymUIComponents/script/feature/community/media/edit/thumbnail/content-edition-media-thumbnail-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/edit/thumbnail/content-edition-media-thumbnail-view"],function(d,e,b,c){var a=e.extend({name:"media-edition-thumbnail-view",domEvents:{"click .fonticon-trash":"removeThumbnail"},_justUploaded:function(){if(this.getOption("uploadStatus")==="justUploaded"){return true}return false},_createContent:function(){var f=this._parent();f.setAttribute("draggable","false");return[f,{tag:"span","class":"fonticon fonticon-2x fonticon-trash top-right"},(this._justUploaded()?{tag:"span","class":"fonticon fonticon-2x fonticon-check bottom-right dot success"}:"")]},removeThumbnail:function(){var f;if(this._justUploaded()){f=this.model;f.destroy()}this.dispatchEvent("onRemoveRequest",[this.model]);this.destroy()},onRender:function(){var f,g;if(this.getOption("uploadStatus")==="justUploaded"){f=this.getElement(".fonticon-check");f&&this.addControl("newlyUploadedTooltip",new b({target:f,body:c.NewlyUploaded}))}g=this.getElement(".fonticon-trash");g&&this.addControl("removeMediaTooltip",new b({target:g,body:c.RemoveMedia}))}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/uploadPicture-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/uploadPicture-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Button","DS/UWPClientControls/PlatformNotify","DS/SwymUICore/script/utils/utils","DS/UIKIT/Input/File","UWA/Controls/Flash","DS/WebappsUtils/WebappsUtils"],function(i,c,k,e,d,j,f,l,h,g,b,a){var m=e.extend({_modelClass:k,name:"uploadPicture-view",launch:function(s){var z=this.model,v=this,x=s,o=new f({value:c.UploadPicture,className:"primary"}),G=new f({value:c.TakeApicture,className:"primary"}),D=new f({value:c.UploadPicture,className:"primary"}),p=new f({value:c.TakePhoto,className:"primary"}),w=new f({value:c.PreviewScreenshot,className:"primary"}),H=this.addControl("ok-button",new f({value:c.ok,className:"primary",events:{onClick:function(){this.getControl("modal-control").hide()}.bind(this)}}));var F=this.addControl("modal-control",new j({header:c.ChangePicture,body:"",closable:true,footer:[o,G],events:{onHide:function(){if(B){B.getTracks()[0].stop();if(B&&B.stop){B.stop();B=null}}}}}));w.addEvent("onClick",function(){F.dispatchEvent("onUploading",false)});o.addEvent("onClick",function(){F.dispatchEvent("onUpload")});G.addEvent("onClick",function(){F.dispatchEvent("onTake")});D.addEvent("onClick",function(){F.dispatchEvent("onUploading",true)});p.addEvent("onClick",function(){var I=false;if(isNaN(y)){y=E.videoHeight/(E.videoWidth/A)}n.width=A;n.height=y;n.getContext("2d").drawImage(E,0,0,A,y);var J=n.toDataURL("image/png");q.setAttribute("src",J);if(!I){F.setFooter([this,w]);I=true}});var t=new g({buttonPosition:"right",placeholder:c.selectAFile,buttonText:c.browse,attributes:{accept:"image/*"},events:{onChange:function(I){this.fileToUpload=I.target.files[0]}.bind(this)}});var u=new i.createElement("img",{styles:{"margin-left":"35%",width:"123px",height:"123px"},alt:c.MyImage,src:"#"});var q=new i.createElement("img",{styles:{"float":"right"},"class":"webcamtarget"});var A=150,y=0,B,r=false,n=new i.createElement("canvas",{id:"canvas"}),E=new i.createElement("video",{id:"video"}),v=this;F.addEventOnce("onUpload",function(){this.setBody(t);this.elements.body.setStyle("height",null);this.setFooter(D)});var C=this.launchPhotobooth;F.addEventOnce("onTake",function(){this.setFooter();this.setBody([E,q]);this.elements.body.setStyle("height",null);if(!navigator.mediaDevices){C(this)}else{navigator.mediaDevices.getUserMedia({video:true,audio:false}).then(function(I){if(I.addEventListener){I.addEventListener("ended",function(){this.setBody(c.camAlreadyRunning);this.elements.body.setStyle("height",null);this.setFooter(H)}.bind(this))}if(I.getVideoTracks()[0].readyState==="live"||!I.getVideoTracks()[0].readyState){B=I;E.srcObject=B;E.onloadedmetadata=function(J){E.play()}}else{this.setBody(c.camAlreadyRunning);this.elements.body.setStyle("height",null);this.setFooter(H)}}.bind(this))["catch"](function(I){console.error("error message dispatched by native API : ",I);this.setBody(c.noCamAvailable);this.elements.body.setStyle("height",null);this.setFooter()}.bind(this));E.addEventListener("canplay",function(){if(!r){y=E.videoHeight/(E.videoWidth/A);E.setAttribute("width",A);E.setAttribute("height",y);this.setAttribute("width",A);this.setAttribute("height",y);r=true}}.bind(n),false);this.setFooter(p)}});F.addEvent("onUploading",function(M){var J=this.getBody().getElement(".text-error"),K=v.fileToUpload,I=new FileReader();if(J){J.remove()}I.onload=function(N){this.setBody(u);this.elements.body.setStyle("height",null);z.uploadpreviewpicture({data:{base64_encoded:true,file_content:N.target.result},onComplete:function(P,O){u.setAttribute("src",h.getBaseUrl()+"/api/user/getpreviewpicture/filekey/"+O.result);this.setFooter();var Q=new f({value:c.Save,className:"primary"});Q.addEvent("onClick",function(){var T,S=t.getValue(),R=null;if(S!==""){R=S.split("\\");T=R[R.length-1]}else{T="uploadPicture.jpg"}this.dispatchEvent("onCreating",[O.result,T])}.bind(this));this.setFooter([Q])}.bind(this),onFailure:function(){l.error(c.anErrorOccuredPleaseTryLater)}})}.bind(this);if(!M){this.setFooter();var L={target:{result:q.getAttribute("src")}};I.onload(L)}else{if(M){if(K){if(K.type.indexOf("image/")>-1){this.setFooter();I.readAsDataURL(K)}else{J=i.createElement("p",{"class":"text-error",html:c.pleaseUploadAnImage});this.getBody().grab(J,"top")}}else{J=i.createElement("p",{"class":"text-error",html:c.pleaseSelectAfile});this.getBody().grab(J,"top")}}}});F.addEventOnce("onCreating",function(I,J){this.setBody(c.pleaseWait);this.elements.body.setStyle("height",null);this.setFooter();z.uploadpicture({data:{filekey:I,filename:J},onComplete:function(L,K){if(K.errorcode!==undefined){l.error(c.anErrorOccuredPleaseTryLater);F.hide()}else{require(["DS/SwymUICore/script/utils/date"],function(M){L.set("picture_update",M.getCurrentDate());L.set("user_picture_fingerprint",M.getCurrentDate())});this.hide();if(x){x(L)}}}.bind(this),onFailure:function(){l.error(c.anErrorOccuredPleaseTryLater)}})});F.show()},launchPhotobooth:function(q){var r="http://www.adobe.com/go/getflashplayer";var p="<p>To view this page ensure that Adobe Flash Player version 10.0.0 or greater is installed.</p>";p+='<a href="'+r+'">"'+c.GetAdobeFlashplayer+'"</a>';var o=new i.createElement("div",{id:"photoboothContainer",styles:{width:"233px",height:"291px","margin-left":"105px",border:"1px solid #CCCCCC"},html:'<div id="photoboothWrapper">'+p+"</div>"});q.setFooter();q.elements.body.getElement("#video").remove();q.elements.body.grab(o,"bottom");ds.photobooth={createWebcamPreview:function(v){var t="data:image/png;base64,"+v[0];q.elements.body.getElement("#photoboothContainer").remove();var s=q.elements.body.getElement(".webcamtarget");if(s){s.setAttribute("src",t);s.setStyle("float","none");s.setStyle("margin-left","25%");q.elements.body.setStyle("height","320px")}var u=new f({value:c.UploadPicture,className:"primary"});u.addEvent("onClick",function(){q.dispatchEvent("onUploading",false)});q.setFooter([u])}};var n=new b({url:a.getWebappsBaseUrl()+"SwymUIComponents/assets/swf/photobooth.swf",width:"233",height:"291",className:"photoboothWrapper",flashVars:"noCamDetected="+c.noCamDetected+"&camAlreadyRunning="+c.camAlreadyRunning+"&webcamError="+c.webcamError+"&allowWebcam="+c.allowWebcam,allowScriptAccess:"always",bgcolor:"#ffffff",allowfullscreen:false,quality:"high"});if(n.getFlashVersion().major>=10){o.setContent(n)}}});return m});define("DS/SwymUIComponents/script/feature/community/survey/view/answer-result-collection-view",["DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/survey/collection/answer-collection","DS/SwymUIComponents/script/feature/community/survey/view/answer-result-view","UWA/Object"],function(c,e,d,b){var a=c.extend({_collectionClass:e,modelViewClass:d,surveyRedraw:function(){setTimeout(function(){var f=b.keys(this._childViews);f.forEach(function(g){this._childViews[g].dispatchEvent("surveyRedraw")},this)}.bind(this),5)},onRefresh:function(){this.surveyRedraw()}});return a});define("DS/SwymUIComponents/script/feature/community/report-abuse/view/report-abuse-view",["i18n!DS/SwymUIComponents/assets/nls/feature/community/report-abuse/view/report-new-abuse-view","UWA/Core","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/SwymUICore/script/utils/utils"],function(f,i,j,k,g,a,d,c,h){var b=k.getInstance(),l=j.getInstance();var e=g.extend({_lastSubjectUri:null,_contentInfo:null,domEvents:{"click .content-link":"_onContentLinkClick"},_updateContentInfo:function(){var n,m,o=this.model;this._lastSubjectUri=o.get("subjectUri");n=o.get("subjectUrl",{escapeHTML:false})||o.get("linkUri",{escapeHTML:false});n=n.replace(/&#47;/g,"/");this._contentInfo=b.extractContextInfoFromRoute(n);if(!this._contentInfo.communityId&&this._contentInfo.contentId&&o.get("contextUri")){m=o.get("contextUri").split(":");if(m.length>1){this._contentInfo.communityId=m[m.length-1]}}return this._contentInfo},getModelName:function(){var m="",o=this.model,n=o.get("model")||o.get("subjectType")||"";switch(n.toLowerCase()){case"qnaquestion":case"iquestion":case"question":m=f.Iquestion;break;case"post":m=f.Post;break;case"media":m=f.Media;break;case"wiki":case"wikitree":m=f.Wiki;break;case"survey":case"poll":m=f.Survey;break;case"qnaanswer":case"answer":m=f["Iq-answer"];break;case"ideation":case"idea":m=f.Idea;break;case"qnacomment":case"comment":m=f.Comment;break;case"instantmessage":m=f.Message;break}return m},getContentType:function(){var n="",m=this.model;this._updateContentInfo();n=this._contentInfo.contentType||"";return n},getContentId:function(){var m=this.model;return this._updateContentInfo().contentId||""},getCommunityId:function(){var m=this.model;return this._updateContentInfo().communityId||""},getReportType:function(){var o,m="",n=this.model;o=n.get("reasons");if(i.is(o,"array")){m=n.get("reasons").map(function(p){return f.get(p)}).join(" & ")}return m},_createContent:function(){var m=this.model;if(m){this._confirmModal=new c({closable:false,renderTo:this._widget.body});var n=m.getAssociated("author");return[{tag:"td",html:'<a data-content-type="person"'+(n.get("login")?(' data-login="'+n.get("login")+'"'):"")+(n.get("hash_key")?(' data-hash-key="'+n.get("hash_key")+'"'):"")+">"+n.getNickname()+"</a>"},{tag:"td",html:d.simpleDate(m.get("creationDate"))},{tag:"td",html:this.getModelName()},{tag:"td",html:'<a class="content-link" data-content-type="'+this.getContentType()+'" data-content-id="'+this.getContentId()+'"  data-community-id="'+this.getCommunityId()+'" >'+m.get("subjectTitle")+"</a>"},{tag:"td",html:this.getReportType()},{tag:"td",html:m.get("description")}]}},_displayConfirmationModal:function(m,n){if(m){this._confirmModal.confirm(f.Youdont,f.Confirm,function(o){if(o===true){m.setAccess({onComplete:function(){m.set("tenant_su","1");a.goToUrl(n)}})}})}else{throw new Error("Current user instance is expected")}},_onContentLinkClick:function(r){r.stopPropagation();r.preventDefault();var p,q=this,o=this.model,n=this.getContentType(),m={mid:q.getContentId()};this._updateContentInfo();p=b.computeRoute(this._contentInfo);require(["DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/lib/model/generic/swym-model"],function(t,s){(t.getInstanceFetched(function(u){if(u.get("tenant_su")==="1"){a.goToUrl(p)}else{require([s.getModuleNameFromModelName(n),"DS/SwymUICore/script/feature/community/community/model/community-model"],function(x,w){if(!q.isDestroyed()){if(n==="instantmessage"){var v=h.extractDataFromSubject6wURI(o.get("subjectUri"));x=w;m.mid=v.extraAttrs?v.extraAttrs.mid:""}(new x(m,{autoPopulate:true,onPopulate:function(y){if(!q.isDestroyed()){if(n==="instantmessage"||(y&&y.get("_acl")&&y.get("_acl")["update"].access===true&&y.get("_acl")["delete"].access===true)){a.goToUrl(p)}else{q._displayConfirmationModal(u,p)}}},onFailure:function(){q._displayConfirmationModal(u,p)}}))}})}}))})}});return e});define("DS/SwymUIComponents/script/feature/community/media/view/uploader/upload-manager-view",["UWA/Core","UWA/Element","UWA/Class/Events","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/upload-manager-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/community/media/model/media-file-extension-model","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils","DS/UWPClientCode/I18n","DS/WAFData/WAFData","UWA/Utils"],function(j,a,n,d,f,b,m,i,h,o,l,c){var g=n.extend({init:function(p){this.file=p.file}});var e=(window.ds&&(ds.env==="3DD"));var k=43200000;return f.extend({name:"upload-manager-view",_authorizedFilesTypes:null,_ajaxUploadService:"/api/media/addmedia",_formUploadService:"/html/media/addmedia",_mediaFileExtension:null,_communityId:null,_preUploadErrors:null,_createContent:function(){var p=[];return p},setup:function(p){this._parent.apply(this,arguments);if(undefined!==p.communityId){this._communityId=p.communityId}if(undefined!==p.showCollection){this._showCollection=p.showCollection}if(p.autoPublish===true){this.autoPublish=true}if(undefined!==p.ajaxUploadService){this._ajaxUploadService=p.ajaxUploadService}if(undefined!==p.formUploadService){this._formUploadService=p.formUploadService}if(undefined!==p.authorizedFilesTypes){this._authorizedFilesTypes=p.authorizedFilesTypes}},setCommunityId:function(p){this._communityId=p},getCommunityId:function(){return this._communityId},checkFiles:function(s,v){var u=[];var p=[];this._preUploadErrors=[];for(var r=-1,q=s.length;++r<q;){var t=s[r];if(undefined===t.fileName){t.fileName=t.name}p.push({browserFileData:t,customData:{}})}this._getFilesOkToBeUploaded(p,function(w){for(r=0,q=w.length;r<q;r++){u.push(new g({file:w[r]}))}v(u)})},uploadMedia:function(x,z,w){var q,v=this,s="0",u=this.autoPublish===true?"1":"0",y,t;if(undefined===w||!w.hasOwnProperty("title")){y=x.file.customData.title}else{y=w.title}var r=new FormData();if(undefined===w||!w.hasOwnProperty("fileName")){t=x.file.browserFileData.fileName}else{t=w.fileName}r.append("fileName",t);if(undefined===w||!w.hasOwnProperty("userFile")){r.append("userFile",x.file.browserFileData)}else{r.append("userFile",w.userFile)}r.append("title",y);if(undefined!==w){for(var p in w){if(w.hasOwnProperty(p)){if("title"!==p&&"fileName"!==p&&"userFile"!==p){r.append(p,w[p])}}}}if("/api/media/addmedia"===this._ajaxUploadService){r.append("published",u);r.append("category_id",s);r.append("description","");r.append("download_original_file","0");r.append("is_illustration","true");r.append("community_id",this._communityId)}q=h.getBaseUrl()+this._ajaxUploadService;if(e){l.authenticatedRequest(q,{data:r,method:"POST",timeout:k,onTimeout:function(){var B=o.replace(d.MEDIA_UPLOAD_TIMEOUT,{Title:y,FileName:t});v.alert("error",B);x.dispatchEvent("uploadFailed")},onComplete:function(C){var B=JSON.parse(C);v.onMediaLoaded(B,x,z)}})}else{var A=new XMLHttpRequest();if(A.upload&&A.upload.addEventListener){A.upload.addEventListener("progress",function(B){x.dispatchEvent("uploadProgress",B)}.bind(this))}A.ontimeout=function(){var B=o.replace(d.MEDIA_UPLOAD_TIMEOUT,{Title:y,FileName:t});v.alert("error",B);x.dispatchEvent("uploadFailed")};A.open("POST",q,true);A.timeout=k;A.send(r);if(A.addEventListener){A.addEventListener("load",function(C){var B=JSON.parse(C.target.responseText);v.onMediaLoaded(B,x,z)},false)}}},onMediaLoaded:function(p,r,s){var q,t;if(undefined!==p.errorcode){this.dispatchEvent("uploadFailed");r.dispatchEvent("uploadFailed");this._displayUploadErrorMsg(p)}else{t=p.result.id;if("/api/media/addmedia"===this._ajaxUploadService){q=new b({id:t},{autoPopulate:true,onComplete:function(u){this.dispatchEvent("mediaLoaded",[u])}.bind(this)})}else{this.dispatchEvent("mediaLoaded")}r.dispatchEvent("fileIsUploaded",q);if(s===true){this.dispatchEvent("multipleUploadComplete")}}},_getMediaFileExtension:function(){if(!this._mediaFileExtension){this._mediaFileExtension=m.getInstance()}return this._mediaFileExtension},populateMediaFileExtension:function(p){if(!p){console.error("Please provide a callback !")}m.getInstance(function(){this._mediaFileExtension=m.getInstance();if(p){p()}}.bind(this))},_getFilesOkToBeUploaded:function(u,t){var H=[],v=this,E=0;for(var F=-1,w=u.length;++F<w;){var I=u[F],K=I.browserFileData.fileName,B=K.substring(K.lastIndexOf(".")+1,K.length).toLowerCase(),p=this._getType(B),G=null;if(K.lastIndexOf(".")!==-1){G=K.substring(0,K.lastIndexOf("."))}else{G=K}I.customData={title:G,extension:B,type:p};I.customData.customId=I.customData.title;if(p===null){this._preUploadErrors.push({fileName:K,errorType:"fileType"});E++;r();continue}if(null!==this._authorizedFilesTypes){var J=false;for(var D=-1,z=this._authorizedFilesTypes.length;++D<z;){if(p===this._authorizedFilesTypes[D]){J=true}}if(!J){this._preUploadErrors.push({fileName:K,errorType:"fileType"});E++;r();continue}}var s=this._getMediaFileExtension().get("maxSizes"),q=s[p],C=this._getMediaFileExtension().get("maxpixels"),A=C.picture;if(p==="image"){q=s.picture}if(p==="audio"){q=s.sound}if(p==="3dmodel"){q=s["3d_model"]}if(I.browserFileData.size>parseInt(q,10)){this._preUploadErrors.push({fileName:K,errorType:"fileSize",fileType:p,maxSizeInKBytes:parseInt(q,10)/1048576});E++;r();continue}if((p==="picture")&&(I.customData&&I.customData.extension&&(I.customData.extension!=="tiff"&&I.customData.extension!=="tif"))){var x=window.URL,L=new Image();function y(M,N){L.onload=function(){console.log("Width:"+this.width+"   Height: "+this.height);if(this.width*this.height>A){v._preUploadErrors.push({fileName:N,errorType:"resolution",maxResolutionInMPixels:parseInt(A,10)/1000000})}else{H.push(M)}E++;r()};L.src=x.createObjectURL(M.browserFileData)}y(I,K)}else{E++;H.push(I);r()}function r(){if(E===w){if(v._preUploadErrors.length>0){v.dispatchEvent("uploadFailed");v._displayPreUploadErrors()}t(H)}}}},_getType:function(t){var t=t?t.toLowerCase():"",r,q,s=this._getMediaFileExtension().get("authorizedFormats"),p=s.image;for(r=-1,q=p.length;++r<q;){if(p[r]===t){return i.MEDIA_TYPE.IMAGE}}p=s.video;for(r=-1,q=p.length;++r<q;){if(p[r]===t){return i.MEDIA_TYPE.VIDEO}}p=s.audio;for(r=-1,q=p.length;++r<q;){if(p[r]===t){return i.MEDIA_TYPE.AUDIO}}p=s.drawing;for(r=-1,q=p.length;++r<q;){if(p[r]===t){return i.MEDIA_TYPE.DRAWING}}p=s.document;for(r=-1,q=p.length;++r<q;){if(p[r]===t){return i.MEDIA_TYPE.DOCUMENT}}p=s["3dmodel"];for(r=-1,q=p.length;++r<q;){if(p[r]===t){return i.MEDIA_TYPE["3DMODEL"]}}return null},_displayPreUploadErrors:function(){var q="";if(this._preUploadErrors.length===1){q+=this._createErrorMessage(this._preUploadErrors[0])}else{for(var p=this._preUploadErrors.length-1;p>=0;p--){q+="<li>"+this._createErrorMessage(this._preUploadErrors[p])+"</li>"}q=j.createElement("ul",{html:q})}this.alert("error",q)},_displayUploadErrorMsg:function(q){var p;if(q.errorcode==="ERROR_FILE_UPLOAD_ERROR"){p=d.get("Yourfileiseitheremtpyorexceedsthemaximumallowedsize")}else{p=d.replace(d.get("Anerroroccuredduringupload"),{errorcode:q.errorcode})}this.alert("error",d.get("Uploadfailed")+":"+p)},_createErrorMessage:function(q){var p="";if(q.errorType==="fileSize"){p=d.replace(d.get("FileSizeError"),{FileName:q.fileName,FileType:q.fileType,maxSizeInKBytes:q.maxSizeInKBytes})}else{if(q.errorType==="fileType"){p=d.replace(d.get("FileTypeError"),{FileName:q.fileName})}else{if(q.errorType==="resolution"){p=d.replace(d.get("FileResolutionError"),{FileName:q.fileName,maxResolution:q.maxResolutionInMPixels})}}}return p}})});define("DS/SwymUIComponents/script/feature/community/media/edit/upload/upload-manager",["UWA/Core","UWA/Class","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/community/media/view/uploader/upload-manager-view","DS/SwymUICore/script/feature/community/media/model/media-file-extension-model","DS/Logger/Logger"],function(b,n,l,h,a,r){function i(w,x){var v=new FileReader();v.onload=function(E){var z=new DataView(E.target.result);if(z.getUint16(0,false)!==65496){return x(-2,w)}var D=z.byteLength,F=2;while(F<D){var y=z.getUint16(F,false);F+=2;if(y===65505){if(z.getUint32(F+=2,false)!==1165519206){return x(-1,w)}var A=z.getUint16(F+=6,false)===18761;F+=z.getUint32(F+4,A);var B=z.getUint16(F,A);F+=2;for(var C=0;C<B;C++){if(z.getUint16(F+(C*12),A)===274){return x(z.getUint16(F+(C*12)+8,A),w)}}}else{if((y&65280)!==65280){break}else{F+=z.getUint16(F,false)}}}return x(-1,w)};v.readAsArrayBuffer(w.slice(0,64*1024))}function c(){return window.orientation||null}function p(y,x,z){var v=new FileReader(),w=b.createElement("img");v.onload=(function(A){return function(G){try{var K,L,J,H,I,C,D,F=1,E=G.target.result;A.src=E;A.onload=function(){I=this.height;H=this.width;K=b.createElement("canvas");L=K.getContext("2d");if((x===k)||(x===t)||(x===j)||(x===d)){C=K.width=I;D=K.height=H}else{if((x===s)||(x===q)||(x===g)){C=K.width=H;D=K.height=I}}L.translate(C/2,D/2);switch(x){case k:F=-1;case j:F*=m;L.rotate(F*Math.PI/180);break;case q:F=-1;case g:F*=e;L.rotate(F*Math.PI/180);break;case t:F=-1;case d:F*=o;L.rotate(F*Math.PI/180);break}if((x===j)||(x===k)||(x===t)||(x===d)){C=H;D=I}L.translate(-C/2,-D/2);if((x===s)||(x===k)||(x===t)||(x===q)){J=true;L.translate(C,0);L.scale(-1,1)}L.drawImage(A,0,0);z({dataURI:K.toDataURL()})}}catch(B){r.warn("exception")}}})(w);v.readAsDataURL(y)}var f=1,s=2,g=3,q=4,t=5,d=6,k=7,j=8,e=180,o=90,m=-90,u=h.extend({_uploaders:null,setup:function(v){this._parent.apply(this,arguments);this._uploaders={};if(v&&v.uploaders){for(var w in v.uploaders){if(v.uploaders.hasOwnProperty(w)){if(v.uploaders[w].Class){this.addUploader(w,v.uploaders[w])}}}}},getUploader:function(v){return this._uploaders[v]},addUploader:function(w,v){var y,x=this;if(v){if(v instanceof l){x._uploaders[w]=v;x.listenTo(x._uploaders[w],"onFilesSelected",x._filesSelected);x.listenTo(x._uploaders[w],"onProxyFailed",x._proxyFailed);x.listenTo(x._uploaders[w],"on3DDriveMediaSelected",x._3DDriveMediaSelected)}else{if(typeof v.Class==="string"){require([v.Class],function(z){delete v.Class;x.addUploader(w,new z(v||{}))})}else{if(v.Class.prototype instanceof l){y=new v.Class(v.options||{});this.addUploader(w,y)}}}}},_filesSelected:function(w){if(w.length>0){var v=a.getInstance();if(!v.get("authorizedFormats")){this.listenToOnce(v,"onDocumentedFileExtensionsCreated",this._handleFiles.bind(this,w))}else{this._handleFiles(w)}}else{return false}},_3DDriveMediaSelected:function(v){if(v.length>0){this.dispatchEvent("on3DDriveMediaSelected",[v])}},_proxyFailed:function(v){if(v.length>0){this.dispatchEvent("onProxyFailed",[v])}},_handleFiles:function(x){var v,y,w=this;if(x&&(x.length>0)){this.checkFiles(x,function(A){if(A.length>0){for(var B=0,z=A.length;B<z;B++){y=A[B];if(y.file&&(y=y.file.browserFileData)&&(y.type==="image/jpeg")){i(y,function(C,D){if(C>f){r.log("Image has an EXIF orientation tag",C,D);p(D,C,function(E){if(E&&E.dataURI){D.dataURI=E.dataURI;D.treated=true;w.onReadyForUpload(A)}})}else{D.treated=true;w.onReadyForUpload(A)}})}else{y.treated=true;w.onReadyForUpload(A)}}}})}},render:function(){},onReadyForUpload:function(z){var A,w,v,x,y;y=z.reduce(function(B,C){return B+((C.file&&C.file.browserFileData&&(C.file.browserFileData.treated===true))?1:0)},0);if(y===z.length){for(A=0,w=z.length;A<w;A++){v=z[A];x={title:v.file.customData.title,media_type:v.file.customData.type,fileName:v.file.fileName||v.file.browserFileData.fileName,userFile:v.file.browserFileData.dataURI?v.file.browserFileData.dataURI:v.file.browserFileData};v.attributes=x}this.dispatchEvent("onUpload",[z])}},onDestroy:function(){var v,w=this._uploaders;for(v in w){if(w.hasOwnProperty(v)){this.stopListening(w[v],"onUpload")}}}});return u});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/internal-rich-link-preview-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-view","DS/SwymUICore/script/utils/utils"],function(d,a,c){var b=a.extend({className:"rich-link-internal-preview",rendered:false,getIcon:function(){switch(this.model.get("type")){case"posts":return{icon:"newspaper",className:"post-icon-color"};break;case"post":return{icon:"newspaper",className:"post-icon-color"};break;case"idea":return{icon:"lightbulb",className:"idea-icon-color"};break;case"iquestion":if(this.model.get("answerValidated")){return{icon:"i-question",className:"iquestion-validated-icon-color"}}else{return{icon:"i-question",className:"iquestion-icon-color"}}break;case"survey":return{icon:"clipboard",className:"survey-icon-color"};break;case"media":return{icon:c.getMediaIconName(this.model.get("mediaType")),className:"media-icon-color"};break;case"wiki":return{icon:"book-open",className:"wiki-icon-color"};break}},domEvents:{"click .preview-close":"_deletePreview","click .preview-container":"_redirectTo",resize:"onResize"},_redirectTo:function(e){if(e.target.className.includes("toAuthor")){e.stopPropagation();return null}if(e.target.className.includes("toCommunity")){e.stopPropagation();return null}if(e.target.className.includes("preview-close")||e.target.className.includes("preview-toggle")){e.stopPropagation();return null}else{e.stopPropagation();window.open(this.model.get("tenantURL"))}},_deletePreview:function(e){e.stopPropagation();this.destroy()},onResize:function(){var h,f,g,e;if(this.rendered){h=this.container;f=h&&h.hasClassName("rich-link-internal-preview")&&h.offsetWidth;g=this.container.getElement(".preview-title");e=this.container.getElement(".preview-description");if(f){if(f<650){if(!(g.classList.contains("two-lines-title"))){g.classList.add("two-lines-title")}if(!(e.classList.contains("single-line-description"))){e.classList.add("single-line-description")}}else{if(f>=650){if((g.classList.contains("two-lines-title"))){g.classList.remove("two-lines-title")}if((e.classList.contains("single-line-description"))){e.classList.remove("single-line-description")}}}}}},render:function(){this.container.setContent({"data-url":this.model.get("tenantURL"),tag:"div",style:"padding-bottom:1px",html:[{tag:"div","class":"preview-container",contenteditable:false,"data-url":this.model.get("url"),html:[{tag:"div","class":"icon-type-container "+this.getIcon().className,html:[{tag:"span","class":"fonticon fonticon-"+this.getIcon().icon}]},{tag:"img",contenteditable:false,"class":(this.model.get("prefs")==="1"||this.model.get("prefs")==="3")?("preview-thumbnail-hidden preview-thumbnail no-media-layout-editor"):("preview-thumbnail no-media-layout-editor"),src:this.model.get("image")},,{tag:"div","class":"preview-data-container",html:[{tag:"div","class":"preview-menu",html:[(this.options.editable===true)?this.createPreferencesMenu(this.model):"",(this.options.editable===true)?this.createDeleteIcon():""]},{tag:"div","class":"preview-title-container",html:[{tag:"div","class":"preview-title crop-title",html:(this.model.get("title").length>=63?(this.formatTitle(this.model.get("title"))):this.model.get("title"))+"<i class='fonticon fonticon-"+this.getIcon()+"'>"}]},{tag:"div","class":"preview-domain",html:[{tag:"span","class":"preview-domain",html:"by <a class='toAuthor' href='#people:"+this.model.get("authorID")+"'>"+this.model.get("authorName")+"</a> in <a class='toCommunity' href='#community:"+this.model.get("communityID")+"'>"+this.model.get("communityName")+"</a>"}]},{tag:"span","class":(this.model.get("prefs")==="2"||this.model.get("prefs")==="3")?("preview-desc-is-hidden preview-description no-media-layout-editor"):("preview-description no-media-layout-editor crop-description"),html:(this.model.get("description").length>=150?(this.model.get("description").replace(/^(.{150}[^\s]*).*/,"$1")):this.model.get("description"))}]},{tag:"span","class":"url",html:{tag:"a",href:this.model.get("domain")}}]}]});this.rendered=true;return this}});return b});define("DS/SwymUIComponents/script/feature/community/content/edit/content-type-selector",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/utils/content-creation-types-manager","DS/UIKIT/DropdownMenu","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/content-creation-view","DS/Logger/Logger"],function(k,h,m,a,f,b){var l=m.POST,g=m.QUESTION,q=m.IDEA,n=m.MEDIA,j=m.SURVEY,e=m.MESSAGE,p=m.COMMENT,o=m.WIKI,i={},c=[];i[l]="newspaper";i[q]="lamp";i[g]="help";i[e]="chat-alt";i[n]="picture";i[j]="clipboard";i[o]="book-open";i[p]="comment";c.push({});c[0][e]={fonticon:i[e],className:e,name:e,description:f.Message,text:f.Message};c.push({});c[1][l]={fonticon:i[l],className:l,name:l,description:f.Post,text:f.Post};c.push({});c[2][n]={fonticon:i[n],className:n,name:n,text:f.ThreeDPhotoVideo,description:f.ThreeDPhotoVideo};c.push({});c[3][q]={fonticon:i[q],className:q,name:q,text:f.Idea,description:f.Idea};c.push({});c[4][g]={fonticon:i[g],className:g,name:g,text:f.Question,description:f.Question};c.push({});c[5][j]={fonticon:i[j],className:j,name:j,text:f.Survey,description:f.Survey};c.push({});c[6][o]={fonticon:i[o],className:o,name:o,text:f.Wiki,description:f.Wiki};var d=h.extend({_typesManager:null,_contentIconEl:null,name:"content-type-selector",iconCls:i,defaultOptions:{typeIsChangeable:true},currentItems:[],contentTypeSelector:null,getCurrentContentType:function(){return this._typesManager.getCurrentContentType()},_getIconWrapperCls:function(){return this.iconCls[this.getCurrentContentType()]},_createContent:function(){return{"class":"content-type-selector-wrapper"+((this._typesManager._types&&this._typesManager._types.length<=1)?" no-dropdown-available":""),html:{"class":"content-icon "+this.getCurrentContentType(),html:[{tag:"span","class":"fonticon fonticon-2x fonticon-"+this._getIconWrapperCls()},{tag:"span","class":"fonticon fonticon-down-open",styles:{width:"14px","vertical-align":"top",display:(this.hideSelector())?"none":""}},{tag:"span","class":"fonticon fonticon-2x fonticon-plus"}]}}},init:function(){var r=this._parent.apply(this,arguments);this.onContentTypesChangeBound=this.onContentTypesChange.bind(this);this.onCurrentContentTypeChangeBound=this.onCurrentContentTypeChange.bind(this);this.changeContentTypeIconBound=this.changeContentTypeIcon.bind(this);this._typesManager=m.getInstance();this.setCurrentItems(this._typesManager.getContentTypes());this._typesManager.addEvent("onContentTypesChange",this.onContentTypesChangeBound,this,true);this._typesManager.addEvent("onContentTypeIconChange",this.changeContentTypeIconBound,this,true);this._typesManager.addEvent("onCommentSubjectContentTypeChange",this._onCommentSubjectContentTypeChange.bind(this),this,true);return r},setup:function(){return this._parent.apply(this,arguments)},setCurrentItems:function(r){this.currentItems=r},hideSelector:function(){return((this.options.typeIsChangeable===false)||(this.currentItems.length<=1))},onContentTypesChange:function(r){if(r&&r.contentTypes){this.setCurrentItems(k.clone(r.contentTypes));this.refresh()}else{throw new Error("No content types provided")}},_onCommentSubjectContentTypeChange:function(r){if(this.container){var s=this.container.getElement(".content-icon");if(s){s.setAttributes({"data-comment-subject-content-type":r.commentSubjectContentType})}}},onCurrentContentTypeChange:function(){this.refresh()},onRedraw:function(){var s=this,t=this.getElement(".content-type-selector-container"),r=this.getElement(".content-icon");this.contentTypeSelector&&this.contentTypeSelector.destroy();this.contentTypeSelector=new a({target:r,className:"type-selector",items:[],removeOnHide:false,renderTo:t,events:{onClick:function(v,u){b.log(u);s._typesManager.setContentTypeRequest({type:u.name,updateIcon:true,userAction:true})}}});this.updateItemsInContentTypeDropDownMenu();if(this.hideSelector()){this.contentTypeSelector.getContent().setStyle("visibility","hidden")}else{this.contentTypeSelector.getContent().setStyle("visibility","")}},changeContentTypeIcon:function(s){var t,v,r,u;if(s.oldType!==s.newType){t=this.getElement(".content-icon"),v="fonticon-"+this.iconCls[s.oldType],r="fonticon-"+this.iconCls[s.newType],u=t&&t.getElement("."+v);if(t){t.hasClassName(s.oldType)&&t.removeClassName(s.oldType);t.addClassName(s.newType);if(u){u.removeClassName(v);u.addClassName(r)}}if(this.contentTypeSelector){this.contentTypeSelector.enableItem(s.oldType);this.contentTypeSelector.disableItem(s.newType)}}},updateItemsInContentTypeDropDownMenu:function(){if(this.contentTypeSelector){c.forEach(function(r){var s=Object.keys(r)[0];if((this.contentTypeSelector.getItem(s))){this.contentTypeSelector.removeItem(s)}},this);c.forEach(function(r){var s=Object.keys(r)[0];if((this.currentItems.indexOf(s)>=0)&&(!this.contentTypeSelector.getItem(s))){this.contentTypeSelector.addItem(r[s])}},this);this.contentTypeSelector.disableItem(this.getCurrentContentType())}},destroy:function(){this._typesManager.removeEvent("onContentTypesChange",this.onContentTypesChangeBound);this._typesManager.removeEvent("onContentTypeIconChange",this.changeContentTypeIconBound);this._parent.apply(this,arguments)}});d.POST=l;d.IDEA=q;d.QUESTION=g;d.MEDIA=n;d.SURVEY=j;d.WIKI=o;return d});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/embedded-rich-link-preview-model",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-model"],function(c,b){var a=b.extend({defaults:{iframe:""}});return a});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-transfer-form-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-transfer-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/community/idea/collection/collab-space-collection","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UWPClientCode/I18n","DS/SwymUICore/script/feature/community/idea/collection/license-collection"],function(i,f,g,k,j,b,h,a,c,e,l){var d=g.extend({name:"idea-transfer-form-view",_isMature:false,_isCommunityOwner:false,_objectToTransfer:"",_modelEvents:{"onChange:status_id":"_statusIdChanged","onChange:out":"refresh"},domEvents:{"click .transfer-button":"_onTransferButtonClick"},_createContent:function(){var o=this,n;if(o._isCommunityOwner&&o._licenseCollection&&o._licenseCollection.length>0&&(o.getControl("cspacesSelect").getOptions(false).length>0)&&o._isMature&&(o.model.get("out")==="0"||o.model.get("out")===false)){if(!o.getControl("transfertButton")){o.addControl("transfertButton",new h({className:"transfer-button default",value:e.replace(f.TransferyourideatoanEnoviaobject,{object:f.get(o._objectToTransfer)})}))}if(o._licenseCollection.length>1){var m=[];o._licenseCollection.forEach(function(p){m.push({value:p.get("type"),label:p.get("label")})});m[0].selected=true;if(!o.getControl("objectSelect")){o.addControl("objectSelect",new a({placeholder:f.Whatdoyouwanttocreate,options:m,events:{onChange:function(){var p=this.getValue()[0];if(p!==""){o._objectToTransfer=p;o.getControl("transfertButton").show();if(o.getControl("cspacesSelect").getOptions(false).length>1){o.getControl("cspacesSelect").show()}else{o.getControl("cspacesSelect").hide()}o.getControl("transfertButton").getContent().setText(e.replace(f.TransferyourideatoanEnoviaobject,{object:f.get(o._objectToTransfer)}))}else{o.getControl("transfertButton").hide();o.getControl("cspacesSelect").hide();o._objectToTransfer=""}}}}))}else{o.getControl("objectSelect").remove();o.getControl("objectSelect").add(m)}}n=i.createElement("div",{styles:{margin:"0 10px 10px"},html:[(o._licenseCollection.length>1?{styles:{"margin-bottom":"10px"},"class":"object-type-select-wrapper",html:o.getControl("objectSelect")}:""),{styles:{"margin-bottom":"10px"},"class":"collab-space-select-wrapper",html:o.getControl("cspacesSelect")},o.getControl("transfertButton")]});o.showWidget()}else{o.hideWidget()}return n},_displayObjectTransferWrapper:function(m){this.dispatchEvent("DisplayObjectTransferWrapper",m)},_getCollabSpaceCollectionCallback:function(m){var o=this,p=[],n=o.getControl("cspacesSelect");if(m.length>0){m.forEach(function(q){p.push({label:q.get("label"),value:q.get("value")})});p[0].selected=true;n.add(p);if(p.length>1){n.show()}else{n.hide()}o.refresh()}else{o.hideWidget()}},_getLicenseCollectionCallback:function(m){var n=this;n._licenseCollection=m;if(m.length>0){n._objectToTransfer=m.at(0).get("type");var o=b.getCollabSpaceCollection({_tenantInfos:n._tenantInfos,onComplete:n._getCollabSpaceCollectionCallback.bind(n),onFailure:function(){console.error("The call to the service /resources/bps/cspaces?tenant="+n._tenantInfos.online_instance_id+" failed",arguments);n.hideWidget()}});if(o.length>0){n._getCollabSpaceCollectionCallback(o)}}else{n.hideWidget()}},_statusIdChanged:function(){var m=this;m._isMature=m._statusCollectionInstance.ideaIsMature(m.model);if(m._isCommunityOwner&&m._isMature){l.getInstance(m._getLicenseCollectionCallback.bind(m))}else{m.hideWidget()}},setup:function(n){var m=this._parent.apply(this,arguments),o=this;o._isCommunityOwner=n.isCommunityOwner;o.addControl("cspacesSelect",new a({options:[],className:"margin-0",placeholder:f.Selectasecuritycontext,styles:{display:"none"},events:{onChange:function(){if(this.getValue()[0]!==""){this.elements.choices.removeClassName("field-error")}else{this.elements.choices.addClassName("field-error")}}}}));o._tenantInfos=k.getInstance().get("config").tenant;o.addControl("confirmModal",new c({closable:true,renderTo:o._widget.body}));o._statusCollectionInstance=o.model.getCommunity().getStatus();if(o._statusCollectionInstance.hasBeenFetched()){o._statusIdChanged()}o.reactTo(o._statusCollectionInstance,"onSync:read",o._statusIdChanged,o);return m},_getProcessedContent:function(){var t=this,r=t.model,y;t._statusCollectionInstance.forEach(function(z){if(r.get("status_id")==z.get("mid")){y=z.get("title")}});var v=r.get("content")+"<p>"+f.Originalidea+' <a target="_blank" href="'+j.getBaseUrl()+r.getRelativePath()+'">'+r.get("title")+"</a> "+f.instatus+' "'+y+'"</p>',x=i.createElement("div",{html:v}),n=x.getElements("img[data-media-id]"),m,p,w,o,u,q,s;for(q=0,s=n.length;q<s;q++){m=n[q];o=m.attributes;p=m.dataset.mediaId;w=m.dataset.communityId;m.removeAttribute("style");m.removeAttribute("alt");u=document.createAttribute("style");u.value="width: 300px;";o.setNamedItem(u);if(p){if(w){u=document.createAttribute("onclick");u.value="window.open('"+j.getBaseUrl()+"/#community:"+w+"/media:"+p+"')";o.setNamedItem(u)}if(!o.getNamedItem("src")){u=document.createAttribute("src");u.value=j.getBaseUrl()+"/api/media/streammedia/id/"+p+"/type/picture/key/o1/";o.setNamedItem(u)}}}return x},_onTransferButtonClick:function(){var m=this;if(m.getControl("cspacesSelect").getValue()[0]!==""){this.getControl("confirmModal").confirm(e.replace(f.Areyousureyouwanttotransferthisideatoaobject,{object:f.get(m._objectToTransfer)}),f.Confirm,function(n){if(n===true){m.getControl("transfertButton").load();var p=l.getCompliantObjectData(m._objectToTransfer).Model,o=new p();o.setAssociated("idea",m.model);o.saveObject({collabSpace:m.getControl("cspacesSelect").getValue()[0],processedContent:m._getProcessedContent(),onComplete:function(r){if(r.success===true){m.alert("success",e.replace(f.Yourobjecthasbeencreated,{object:f.get(m._objectToTransfer)}));m.dispatchEvent("IdeaTransfer",false);m.hide();m.getControl("transfertButton").load(false);if(m._parentView){m._parentView.getChildView("ideaTransferredLinkView").setLinkedModel(r.linkModel);m._parentView.getChildView("ideaTransferredLinkView").show();m._parentView.getChildView("ideaTransferredLinkView").refresh()}}else{var s=e.replace(f.ObjectcreationfailledYoudonthavetherequiredrights,{object:f.get(m._objectToTransfer)});if(i.is(r.errorID)){var q=l.getCompliantObjectData(m._objectToTransfer);if(q.errors&&q.errors[r.errorID]){s=f.get(q.errors[r.errorID])}}m.alert("error",s);m.getControl("transfertButton").load(false)}},onFailure:function(s,r){var t=e.replace(f.AnerroroccurredwhilecreatingyourobjectPleasetryagainorcontactyouradministrator,{object:f.get(m._objectToTransfer)});if(i.is(r.error)&&r.error.code==="401"){t=e.replace(f.ObjectcreationfailledYoudonthavetherequiredrights,{object:f.get(m._objectToTransfer)})}if(i.is(r.errorID)){var q=l.getCompliantObjectData(m._objectToTransfer);if(q.errors&&q.errors[r.errorID]){t=f.get(q.errors[r.errorID])}}m.alert("error",t);m.getControl("transfertButton").load(false)}})}})}else{m.getControl("cspacesSelect").elements.choices.addClassName("field-error");m.alert("warn",f.Pleaseselectasecuritycontext)}},showWidget:function(){if(this._parentView){this._parentView.ideaTransferFormViewDisplayed=true;this._parentView.dispatchDisplayEvent()}},hideWidget:function(){if(this._parentView){this._parentView.ideaTransferFormViewDisplayed=false;this._parentView.dispatchDisplayEvent()}}});return d});define("DS/SwymUIComponents/script/feature/community/media/edit/thumbnail/upload-progress-media-thumbnail-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/edit/thumbnail/upload-progress-media-thumbnail-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/edit/thumbnail/content-edition-media-thumbnail-view"],function(k,f,j,l,m,d,h){var g="5%",i="0.9",a=function(o,n){var p=null;if(o&&n){p=o._changes[n];if(!p){p=o.get(n)}}return p},b=function(p,o,n){p&&p.set("width",o)&&p.set("height",n)},c=function(n,w){var p,q,v,t,o,r;q=a(n,"userFile");if((a(n,"media_type")===j.MEDIA_TYPE.PICTURE)&&(!q||!q.type||(q.type!=="image/tiff"))){o=k.createElement("img",{"data-media-type":n.get("media_type")||""});o.className="uploading-img";if(k.is(q,"string")&&(t=k.createElement("div").setHTML(q).getText())&&(v=t.split(","))&&(v[0]==="data:image/png;base64")){var u=new Image();u.onload=function(){b(n,u.width,u.height)}.bind(this);u.src=t;o.setStyles({"background-image":"url("+t+")","background-size":"cover","background-position":"center center",display:"block"});w.call(this,o,t)}else{o.file=q;p=new FileReader();p.onload=(function(x,y){return function(A){var B=A.target.result,z=new Image();z.onload=function(){b(y,z.width,z.height)}.bind(this);z.src=B;x.setStyles({"background-image":"url("+B+")","background-size":"cover","background-position":"center center",display:"block"});w.call(this,x,B)}})(o,n);p.readAsDataURL(q)}}else{if(a(n,"objectId")){var s=n.get("displayPreview",{escapeHTML:false});o=k.createElement("img");o.setStyles({"background-image":"url("+s+")","background-size":"cover","background-position":"center center",display:"block"});w.call(this,o,s)}else{r=k.createElement("span");r.className="uploading-img default-img fonticon-3x fonticon-"+l.getMediaIconName(n);w.call(this,r,null)}}},e=f.extend({name:"upload-progress-media-thumbnail-view",_modelEvents:{onUploadProgress:"onProgressUpdate","onRequest:create":"onStartUpload","onRequest:update":"onStartUpload","onRequest:patch":"onStartUpload","onError:create":"refresh","onError:update":"refresh","onError:patch":"refresh"},_modelEventsForAutoRefresh:[],_objectURL:null,domEvents:{"click .fonticon-trash":"removeThumbnail"},setup:function(){this._parent.apply(this,arguments)},_createContent:function(){var n=this.model;return[{"class":"uploading-thumbnail"},n.isUploading()?this.createProgressMarkup():[{tag:"span","class":"fonticon fonticon-2x fonticon-trash top-right"},{tag:"span","class":"fonticon bottom-right dot "+(n.getCustomProperty("uploadRequest")&&n.getCustomProperty("uploadRequest").status===3?"warning fonticon-attention":"pending fonticon-refresh"),title:(n.getCustomProperty("uploadRequest")&&n.getCustomProperty("uploadRequest").status===3?d.Mediauploadfailed:d.Mediauploadpending)}]]},onRender:function(){var n,o,p;n=this.getElement(".fonticon-attention");n&&this.addControl("mediauploadfailedTooltip",new m({target:n,body:d.Mediauploadfailed}));p=this.getElement(".fonticon-refresh");p&&this.addControl("mediauploadpendingTooltip",new m({target:p,body:d.Mediauploadpending}));o=this.getElement(".fonticon-trash");o&&this.addControl("removeMediaTooltip",new m({target:o,body:h.RemoveMedia}))},createProgressMarkup:function(){return{"class":"progress-wrap",html:[{"class":"progress-bar",styles:{width:g}}]}},onStartUpload:function(){var o=this.container?this.container.getElement(".uploading-thumbnail"):null,n=this.container?this.container.getElement(".fonticon-trash"):null,p=this.container?this.container.getElement(".fonticon.dot"):null;if(o){k.createElement("div",this.createProgressMarkup()).inject(o,"after")}if(p){p.remove()}if(n){n.remove()}},removeThumbnail:function(){this.dispatchEvent("onRemoveRequest",[this.model])},onUploadComplete:function(){this.setProgressStatus("100%")},onProgressUpdate:function(o){var n=Math.round((o.loaded*100*i)/o.total)+"%";this.setProgressStatus(n)},setProgressStatus:function(n){var o;o=this.getElement(".progress-bar");if(o){o.setStyle("width",n)}},renderUploadingMedia:c,onRedraw:function(){var n=this;this.renderUploadingMedia(this.model,function(o){n.container.getElement(".uploading-thumbnail").appendChild(o)})},onDestroy:function(){if(this._objectURL){window.URL.revokeObjectURL(this._objectURL)}this.stopListening(this.model,"onSync:create",this.onUploadComplete)}});e.renderUploadingMedia=c;return e});define("DS/SwymUIComponents/script/feature/core/tenant/view/tenant-media-processes-view",["i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/tenant-media-processes-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUICore/script/utils/date","UWA/Element","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils"],function(e,f,h,c,b,g,d){var a=f.extend({_modelEventsForAutoRefresh:["onChange"],domEvents:{"click a.link-restart":"_onRestartMediaProcessingButtonClick","click a.link-dl-log":"_onDlLogClick","click a.link-dl-orig":"_onDlOrigClick"},_onRestartMediaProcessingButtonClick:function(){var i=this;this.model.reprocess({onComplete:function(){var j=i.getChildView("mediaThumbnail");if(j){j.refresh()}}})},_onDlLogClick:function(){window.open([d.getBaseUrl(),"/api/media/get3dsalogzip/id_media/",this.model.get("mid")].join(""))},_onDlOrigClick:function(){window.open([d.getBaseUrl(),"/api/media/streammedia/id/",this.model.get("mid"),"/type/original/output/download/admin/true/"].join(""))},_createContent:function(){var i=this.model,k,j,l=d.getClientInformation();if(i){switch(i.get("status")){case g.MEDIA_PROCESSING_STATUS.OK:k=e.processed;break;case g.MEDIA_PROCESSING_STATUS.KO:k=e.error;break;case g.MEDIA_PROCESSING_STATUS.NOT_PROCESSED:k=e.nonprocessed;break;case g.MEDIA_PROCESSING_STATUS.READY:k=e.readytoprocess;break;default:k=i.get("status");break}j=[{tag:"td",html:i.get("mid")+""},{tag:"td",html:c.simpleDate(i.get("crdate"))},{tag:"td",html:i.get("media_type")},{tag:"td",html:{styles:{width:"70px",cursor:"pointer"},"data-content-id":i.get("mid"),"data-content-type":"media","data-community-id":i.get("community").mid,"data-edition-mode":i.get("published")==="0",html:this.addChildView("mediaThumbnail",{Class:h,model:i,imageReloadOptions:{isAdmin:true}})}},{tag:"td",html:i.get("title")},{tag:"td",html:i.get("created_by")||i.get("author->nickname")},{tag:"td",html:k},{tag:"td",html:(i.get("reprocessable")===true?new b("a",{html:e.Restartprocessing,"class":"link-restart"}):"")},l.isIos?"":{tag:"td",html:(((i.get("status")===g.MEDIA_PROCESSING_STATUS.KO||i.get("status")===g.MEDIA_PROCESSING_STATUS.OK)&&i.get("conversionLogged")===true)?new b("a",{html:e.Downloadprocessinglogs,"class":"link-dl-log"}):"")},{tag:"td",html:new b("a",{html:e.Downloadoriginalmedia,"class":"link-dl-orig"})}];return j}}});return a});define("DS/SwymUIComponents/script/feature/core/tenant/view/tenant-media-processes-collection-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/tenant-media-processes-collection-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/media/collection/media-collection","DS/SwymUIComponents/script/feature/core/tenant/view/tenant-media-processes-view","DS/SwymUICore/script/utils/utils"],function(g,f,e,d,b,c){var a=e.extend({_collectionClass:d,_collectionEvents:{onRequest:"mask",onSync:"unmask",onError:"unmask"},modelViewClass:b,attributes:{tag:"table","class":"table-container"},bodyAttributes:{tag:"tbody"},modelViewsCfg:{attributes:{tag:"tr"}},imageReloadOptions:{isAdmin:true},_createContent:function(){var i=c.getClientInformation(),h=i.isIos?"":"<th></th>";return[{tag:"thead",html:"<th>"+f.ID+"</th><th>"+f.Date+"</th><th>"+f.Type+"</th><th>"+f.Preview+"</th><th>"+f.Title+"</th><th>"+f.Owner+"</th><th>"+f.Status+"</th>"+h+"<th></th><th></th>"},this._parent.apply(this,arguments)]}});return a});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/embedded-rich-link-preview-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-view"],function(c,a){var b=a.extend({className:"rich-link-embedded-preview",rendered:false,domEvents:{resize:"onResize"},onResize:function(){var g,e,h,f,d;g=this.container;e=g.getElement("iframe");if(this.rendered&&g&&e){h=e.width;f=e.height;d=(h/f);e.style.height=(e.offsetWidth/d)+"px";if((this.options)&&(this.options.previewSize)&&(typeof this.options.previewSize.height!=="undefined")){e.style.height=this.options.previewSize.height+"px";e.style.width=this.options.previewSize.height*d+"px"}else{e.style.minHeight="150px";e.style.minWidth=150*d+"px"}}},render:function(){this.container.setContent({html:this.model.iframe,"class":"embedded-preview-container","data-url":this.model.url});this.onResize();this.rendered=true;return this}});return b});define("DS/SwymUIComponents/script/feature/community/media/view/media-home-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/date","DS/SwymUICore/script/utils/navigation"],function(g,f,h,c,e,b,d){var a=f.extend({_modelClass:c,_modelEventsForAutoRefresh:["onChange"],name:"media-home-view",domEvents:{click:function(i){if(this.clickHandler){this.clickHandler(this.model)}else{d.goToContent(this.model.get("mid"),"media",this.model.get("community->mid"))}}},_createContent:function(){var j=this.dimensions,i=this.model;if(i){return{"class":"thumb-wrap",html:[{"class":"date-detail",html:{tag:"span",html:b.prettyDate(i.get("update"))}},this.addChildView("mediaThumbnail",{Class:h,model:i,imageRenderingOptions:{width:j.width,height:j.height}}),{"class":"details",styles:{padding:"5px 8px 0 5px"},html:[{"class":"thumb-origin-picto"},{"class":"timeAndViews",html:i.get("author->nickname")},{tag:"p","class":"timeAndViews",html:[{tag:"span",html:[{"class":"bulleimg",styles:{margin:"0 3px 0 0",border:"0"}},String(i.get("nb_comments"))]},{tag:"span",html:[{"class":"endorseimg",styles:{margin:"0 3px 0 10px",border:"0"}},String(i.get("nb_endorse"))]}]}]},{"class":"detail-hidden titleicon",html:{title:i.get("title"),html:[{tag:"span","class":"fonticon fonticon-"+e.getMediaIconName(i)},{tag:"span",styles:{"line-height":"25px","word-break":"normal","overflow-wrap":"break-word","word-wrap":"break-word"},html:i.get("title")}]}}]}}},setup:function(i){if(g.is(i,"object")){this.setCurrentViewMode(i.currentViewMode);this.setDimensions(i.dimensions);if(i.clickHandler){this.clickHandler=i.clickHandler}}return this._parent(i)},setCurrentViewMode:function(i){this.currentViewMode=i;return this.currentViewMode},setDimensions:function(i){this.dimensions=i;return this.dimensions},getCssClassMediaType:function(l,k){if(typeof l==="string"){var j=new RegExp("(_)","g"),i=["i_",l.replace(j,"")].join("");if(k===1){i="i_smart_object"}return i}else{return""}}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/user-network-tile-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/user/view/user-tile-view","DS/UIKIT/DropdownMenu","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UWPClientCode/I18n","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/member-set-connections-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/PubSub/PubSub"],function(e,c,a,b,i,d,f,h){var g=c.extend({domEvents:{"click .action-toolbar":"_onToolbarClick","click .user-tile":"_onUserClick"},setup:function(j){if(j.modelUser){this._modelUser=j.modelUser}},_onUserClick:function(j){if(j.target.hasClassName("action-toolbar")){j.stopPropagation()}else{this._parent.apply(this,arguments)}},_onToolbarClick:function(j){j.stopPropagation();var k=this.getControl("dropdownMenu");if(k){k.show()}},_buildDropDownMenu:function(j){this.addControl("dropdownMenu",new a({target:j,position:"bottom right",offset:{x:17,y:8},items:[{name:"delete",fonticon:"trash",text:d.deleteheader}],events:{onClick:function(m,l){var k=new b({closable:true,renderTo:this._widget.body});k.confirm(i.replace(d.deleteconnectionLink,{nickname:this.model.get("nickname")}),d.deleteheader,function(n){if(n===true){this.model.deleteuserfromnetwork({onComplete:function(p,o){this.destroy();h.dispatch("refreshNetwork",[p,false],true);this.alert("success",p.get("nickname")+d.hasBeenRemovedfromyournetwork)}.bind(this)})}}.bind(this))}.bind(this)}}))},_createContent:function(){var j=this.model,k="";if(this._modelUser.isCurrentUser()){k=e.createElement("span",{"class":"action-toolbar network fonticon fonticon-2x fonticon-down-open"});this._buildDropDownMenu(k)}return{"class":"member-tile "+this._getExtraClassForAccountActivation(),html:[k,this.addChildView("userPicture",{Class:f,className:"member-picture",model:j,imageRenderingOptions:{format:"square"}}),this._displayBasicInfo()]}}});return g});define("DS/SwymUIComponents/script/feature/community/content/view/thumbnail-in-content-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/lib/model/generic/community-content","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUIComponents/script/utils/media-utils"],function(g,h,d,a,e,c,f){var b=h.extend({widthToDisplay:320,heightToDisplay:null,existingImg:null,name:"thumbnail-in-content",setup:function(k){this._parent.apply(this,arguments);this.existingImg=k.existingImg;if(this.existingImg){var i=this.existingImg.getStyle("width"),n=this.existingImg.getStyle("height"),j=this.existingImg.getAttribute("data-size"),l=this.existingImg.getAttribute("data-position"),m={};if(i){this.widthToDisplay=parseInt(i,10)}if(n){this.heightToDisplay=parseInt(n,10)}if(j){m["data-size"]=j}if(l){m["data-position"]=l}if(j||l){this._imageRenderingOptions=this._imageRenderingOptions||{};this._imageRenderingOptions.extraAttributes=g.extend(this._imageRenderingOptions.extraAttributes||{},m)}}if(this._imageRenderingOptions){if(this._imageRenderingOptions.widthToDisplay){this.widthToDisplay=this._imageRenderingOptions.widthToDisplay}if(this._imageRenderingOptions.heightToDisplay){this.heightToDisplay=this._imageRenderingOptions.heightToDisplay}}},_createContent:function(){var i=f.generateBestThumbnailForContentView(this.widthToDisplay,this.heightToDisplay,this.model,{imgTag:this.existingImg});if(!this.heightToDisplay){this.heightToDisplay=i.height}var j=c.renderMediaThumbnail(g.merge(i,g.merge(this._imageRenderingOptions||{},this.imageReloadOptions)));return j},refresh:function(){}});return b});define("DS/SwymUIComponents/script/feature/community/survey/view/answer-view",["UWA/Core","UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/answer-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/survey/view/scale-answer-view","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle"],function(g,d,e,f,c,b,h){var a=f.extend({_modelEventsForAutoRefresh:["onChange"],domEvents:{"change .survey-is-open":"onTextfieldChange","change .answer-radio":"onRadioChange"},_createContent:function(){var k=this.model;if(k){if(!this._controls["answer-checkbox"]){this.addControl("answer-checkbox",new UWA.Controls.Input.Checkbox({className:"answer-checkbox",attributes:{checked:(k.get("selected")===true?true:false),name:"checkbox_answer_"+k.get("mid"),id:"answer_"+k.get("mid")}}))}var j=this._parentView.collection.getAssociated("question").get("type"),i=d.unescapeHTML(k.get("custom_text")||"");var l=g.createElement("div",{html:[{tag:"div",styles:{"margin-bottom":"10px","padding-bottom":"10px"},html:[(j=="Multiple"?this._controls["answer-checkbox"]:""),(j=="Single"?this.addControl("openRadio",new UWA.Controls.Input.Radio({className:"answer-radio",attributes:{checked:(k.get("selected")===true?true:false),name:"radio_answer_"+k.get("questionId"),id:"answer_"+k.get("mid")}})):""),(j=="Scale"?{html:new c({model:k,questionModel:this._parentView.collection.getAssociated("question")})}:""),(parseInt(k.get("is_open"),10)===1?(j==="Open"?this.addControl("openText",new b({multiline:true,className:"multiline survey-is-open",allowBlank:false,value:(i||"")})):['<label class="cursor-pointer" for="answer_'+k.get("mid")+'">'+e.Other+"</label>",this.addControl("openText",new b({className:"survey-is-open",allowBlank:false,value:i||"",disabled:(k.get("selected")===true?false:true)}))]):(j==="Scale"?"":'<label class="cursor-pointer" for="answer_'+k.get("mid")+'">'+(k.get("description")?k.get("description"):"")+"</label>"))]}]});return l}},onTextfieldChange:function(i){this.model.set("custom_text",d.escapeHTML(i.target.value))},onRadioChange:function(i){this._parentView.collection.forEach(function(k,j){k.set("selected",false)});this.model.set("selected",true)}});return a});define("DS/SwymUIComponents/script/feature/core/network/view/network-list-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/ui-components/list/item-list","DS/SwymUIComponents/script/feature/core/user/view/user-network-tile-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/member-set-connections-view","DS/UWPClientCode/I18n"],function(f,b,a,d,c){var e=b.extend({name:"community-members-view",modelViewsCfg:function(g){var h=this._parent.apply(this,arguments);return f.merge({modelUser:this._modelUser},h)},modelViewClass:a,setup:function(g){g.useDynamicGrid=true;if(g.modelUser){this._modelUser=g.modelUser}this._parent.apply(this,arguments)},_createContent:function(){var i="",l=this.collection;if(l&&l.length===0){var g=false,n=this._modelUser.get("user_in_network")=="1";if(!this._modelUser.isCurrentUser()&&this._modelUser.get("connected_user_to_user")==="new"){g=true}var h=this._modelUser.isCurrentUser()?d.currentUserNoContact:g?c.replace(d.getBackToYouSoon,{firstName:this._modelUser.get("first_name")}):n?c.replace(d.useralreadyinyournetwork,{firstName:this._modelUser.get("first_name")}):c.replace(d.otherUserNoContact,{firstName:this._modelUser.get("first_name")}),m=this._modelUser.isCurrentUser()?"user-add":g?"users":n?"users":"user-add";if(this._modelUser.get("ds_user")==="5"){m="users";h=d.noConnection}var j=[{"class":"network-default-message",html:h},{html:'<span class="fonticon fonticon-'+m+' fonticon-nocontent"></span>'}];var k=(g||this._modelUser.get("ds_user")==="5")?"":" cursor-pointer";i=f.createElement("div",{"class":"network-view no-connection-engaging"+k,styles:{"text-align":"center",height:"100%",width:"100%"},html:j})}else{i=this._parent.apply(this,arguments)}return i}});return e});define("DS/SwymUIComponents/script/feature/core/ui-components/layout/sticky-column-view",["UWA/Core","UWA/Utils/Client","DS/SwymUIComponents/script/feature/core/ui-components/layout/column-view"],function(e,d,c){var b=document.body.getSize(),a=c.extend({_lastTop:"",_wheelTimeout:null,name:"sticky-column-view",defaultOptions:{widget:null},domEvents:{"wheel .views-wrapper":"_triggerScrollingOnWholePage"},_ignoreMouseEvents:function(){var f=this.elements&&this.elements.viewsWrapper;if(f){f.addClassName("ignore-mouse-events")}},_stopIgnoringMouseEvents:function(){var f=this.elements&&this.elements.viewsWrapper;if(f){f.removeClassName("ignore-mouse-events")}},_triggerScrollingOnWholePage:function(f){if(this._wheelTimeout){clearTimeout(this._wheelTimeout)}this._ignoreMouseEvents();this._wheelTimeout=setTimeout(this._stopIgnoringMouseEvents,1000)},init:function(){this.updatePositioning=this.updatePositioning.bind(this);this.onWindowResize=this.onWindowResize.bind(this);this._stopIgnoringMouseEvents=this._stopIgnoringMouseEvents.bind(this);this._parent.apply(this,arguments);document.body.addEvent("resize",this.onWindowResize)},updatePositioning:function(p){var n,k="",j,l=this.getOption("widget"),m,i,g,f=this.elements.viewsWrapper,h=f.getSize(),o=this.container&&this.container.parentElement;if(f&&o){g=o.getBoundingClientRect();n=h.height-(l&&(window.ds.env==="3DSwym")?(l.body.getSize().height-(document.documentElement.clientWidth<969?0:39)):b.height);if(n<=0){f.style.position="";if(d.Platform.ios){f.style["-webkit-transform"]=""}f.style.transform="";this._lastTop=0}else{if((p&&p.syncWithMainScroller===true)&&this._mainScrollerContent){this._parentLastBoundingRect=g;m=-this._mainScrollerContent.scrollTop}else{i=f.getBoundingClientRect();j=g.top-(this._parentLastBoundingRect&&this._parentLastBoundingRect.top||0);this._parentLastBoundingRect=g;if(j<0){k="down"}else{if(j>0){k="up"}}if(k==="up"){if(i.top===0){k=""}}else{if(k==="down"){if(i.top<-n){k=""}}}if((k!=="down")&&(k!=="up")){return}m=(this._lastTop||0)+j}if(m>0){m=0}else{if(m<-n){m=-n}}if(m!==this._lastTop){this._lastTop=m;if(d.Platform.ios){f.style["-webkit-transform"]="translate3d(0px,"+this._lastTop+"px,0px)"}f.style.transform="translate3d(0px,"+this._lastTop+"px,0px)"}}}},onParentHeightAlignment:function(){b=document.body.getSize();this.updatePositioning({syncWithMainScroller:true})},onWindowResize:function(){b=document.body.getSize();this.updatePositioning()},onInjected:function(){var f=false,g=this;this._mainScrollerContent=this.container.getParent(".scroller-content");if(this._mainScrollerContent){this.onMainContentScroll=function(){if(window.requestAnimationFrame){if(!f){window.requestAnimationFrame(function(){g.updatePositioning();f=false})}f=true}else{g.updatePositioning()}};this._mainScrollerContent.addEvent("scroll",this.onMainContentScroll)}},destroy:function(){if(this._mainScrollerContent){this._mainScrollerContent.removeEvent("scroll",this.onMainContentScroll)}this._mainScrollerContent=null;document.body.removeEvent("resize",this.onWindowResize);return this._parent.apply(this,arguments)}});return a});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/internal-rich-link-processing-utils",["UWA/Core","UWA/Ajax","UWA/Data","DS/SwymUICore/script/lib/request/data","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/oembed-providers-list","DS/UIKIT/Alert","DS/Logger/Logger"],function(g,d,c,e,f,b){var a={getSearchData:function(i,k,m){console.log("Internal Link");var h;var l;var j=getHostName(i);if(i.contains("#app")){l=i.match(/contentType=(.*(?=\&))/i)[1];h=i.match(/contentId=(.*(?=))/i)[1];j=i.match(/content:url=(.*?(?=&))/i)[1];j=j.replace(/%3A/g,":").replace(/%2F/g,"/").replace(/%2e/g,".").replace(/https:\/\//g,"")}else{if(i.contains("post")){l="posts";h=i.match(/post:([^\/]{0,})/i)[1]}else{if(i.contains("iquestion")){l="iquestion";h=i.match(/iquestion:([^\/]{0,})/i)[1]}else{if(i.contains("idea")){l="idea";h=i.match(/idea:([^\/]{0,})/i)[1]}else{if(i.contains("wiki")){l="wiki";h=i.match(/wiki:([^\/]{0,})/i)[1]}else{if(i.contains("media")){l="media";h=i.match(/media:([^\/]{0,})/i)[1]}else{if(i.contains("survey")){l="survey";h=i.match(/survey:([^\/]{0,})/i)[1]}}}}}}}e.request({url:"https://"+j+"/api/exalead/search?xrequestedwith=xmlhttprequest",data:{legacyFormat:false,query:"#all",contentType:l,refineUsingQuery:"id:"+h,nresults:1,start:0},onComplete:function(s,q){if(s.nhits!=0){var A=s.hits[0].metas;var x,w,v,y,r,p,o,n,z;for(var t=0;t<A.length;t++){if(A[t].name==="id"){if(h!=A[t].value){require(["DS/UWPClientControls/PlatformNotify"],function(B){B.warn("Un problème est survenu. Impossible de générer le preview")});break}}if(A[t].name==="title"){x=A[t].value}if(A[t].name==="name"){w=A[t].value}if(A[t].name==="ds6w_58_community"){v=A[t].value}if(A[t].name==="enhanced_summary"){y=A[t].value.replace(/<[^>]+>/g," ")}if(A[t].name==="preview_url"){r=A[t].value}if(A[t].name==="preview_media_type"){z=A[t].value}if(A[t].name==="qna_answer_status"){if(A[t].value==="ds6w:status.swym_validated"){n=true}}if(A[t].name==="hash_key"){p=A[t].value}if(A[t].name==="community_id"){o=A[t].value}if(l==="survey"){y="Check out this survey"}if(typeof r==="undefined"){r="null"}}var u={type:l,title:x,description:y,image:r,tenantURL:i,communityName:v,communityID:o,authorName:w,authorID:p,answerValidated:n,mediaType:z};m(u)}else{var u={type:"noAccess",title:"Le preview n'a pas pu être généré."};m(u)}}})}};return a});function getHostName(b){var a=b.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);if(a!=null&&a.length>2&&typeof a[2]==="string"&&a[2].length>0){return a[2]}else{return null}}define("DS/SwymUIComponents/script/feature/core/user/view/small-user-tile-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/small-user-tile-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/core/network/view/invitation-layer-view","DS/UIKIT/Tooltip","DS/W3DXComponents/Views/Item/TileView","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/sprite/sprite","UWA/Class/Model","DS/W3DXComponents/Collections/ActionsCollection","DS/WebappsUtils/WebappsUtils"],function(j,e,h,d,b,m,k,n,f,i,a,o,g,c){var l=h.extend({_modelClass:d,name:"user-tile-view",className:"swym-tile",_addConnection:false,_nicknameIsALink:true,_invitationAlreadySent:null,setup:function(p){p=p||{};if(p.addConnection){this._addConnection=true}if(p.nicknameIsALink!==undefined){this._nicknameIsALink=p.nicknameIsALink}return this._parent.apply(this,arguments)},removeSuggestion:function(){var p=this;this.model.removeSuggestion({onComplete:function(v,q){if(q.result.status==="completed"){var v,x=[],s=p.model.collection;if(!s.idsToFilterArr){for(var u=0,r=s._models.length;u<r;u++){x.push(s._models[u].get("ID"))}s.idsToFilterArr=x}if(!s.memory||s.memory.length===0){var w=new b([],{mode:"getpeoplefamiliartocurrentuser",limit:6});w.fetch({data:{idsToFilterArr:s.idsToFilterArr},onComplete:function(A){if(A.length>0){for(var z=0,y=A._models.length;z<y;z++){s.idsToFilterArr.push(A._models[z].get("ID"));A._models[z].collection=s}s.memory=A._models;v=s.memory.shift();p.setModel(v)}else{if(Object.keys(p._parentView._childViews).length===1){p.model.collection.dispatchEvent("noMoreRecommendation")}p.destroy()}}})}else{var t=s.memory.indexOf(v);if(t>-1){s.memory.splice(t,1)}v=s.memory.shift();p.setModel(v)}}}})},invitLayer:function(){this.model.getInvitationStatus({onComplete:function(r,q){this._invitationStatus=q.result;if(this._invitationStatus.connected_user_to_user=="new"){this.alert("info",e.alreadySentInvitation)}else{if(this._invitationStatus.user_in_network=="0"){var s=new k({model:this.model});var p=function(){this._invitationAlreadySent=true}.bind(this);if(this._invitationAlreadySent!==true){var t=this.container.getElement(".tile-container");if(t){t.hide()}s.launch(p,true,this.container)}else{this.alert("info",e.alreadySentInvitation)}}else{console.log("User is in network. Swym back end API got an error !!!")}}}.bind(this)})},_createContent:function(){var r;if(m.getInstance().isFeatureActivated("activate_user_network")){r=new g([{id:"invitemember",title:e.InviteMember,icon:"user-add",context:true,overflow:false},{id:"removemember",title:e.removefromsuggestions,icon:"cancel-squared",context:true,overflow:false}])}var p=new o({title:function(){var s='<a data-login="'+(this.model.get("login")?this.model.get("login"):"")+'" data-content-type="person" data-hash-key="'+(this.model.get("hash_key")?this.model.get("hash_key"):"")+'" class="link">'+this.model.get("nickname")+"<a>",t='<a" class="link">'+this.model.get("nickname")+"<a>";return this._nicknameIsALink?s:t}.bind(this),imgAttrs:function(){return a.getUserPictureAttributes({format:"normal",cls:"width-60px",hash_key:this.model.get("hash_key"),imageUpdateTime:this.model.get("picture_update"),dataIsLink:this._nicknameIsALink})}.bind(this),image:function(){return d.constructUserPictureUrl(this.model.get("login"),this.model.get("picture_update"),this.model.get("hash_key"),"normal")}.bind(this)});if(this._addConnection===true&&m.getInstance().isFeatureActivated("activate_user_network")){p.actions=r}var q=new f({model:p,events:{onActionClick:function(s,u){var t=u.model;if(t&&this._addConnection===true){if(t.id==="removemember"){this.removeSuggestion()}else{this.invitLayer()}}}.bind(this),onClick:function(){if(this._addConnection===true){this.invitLayer()}}.bind(this)}});return j.createElement("div",{"class":(this._addConnection===true)?"add-connection-active":"",html:q.render()})}});return l});define("DS/SwymUIComponents/script/feature/community/community/view/community-card-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/core/context/context-model","i18n!DS/SwymUICore/assets/nls/feature/community/community/model/community-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-detailed-view","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUIComponents/script/feature/community/community/view/community-signup-request-launcher","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/community/view/community-request-become-author-modal-view","DS/UIKIT/DropdownMenu","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UIKIT/Input/Button","DS/UIKIT/Spinner","DS/SwymUICore/script/lib/event-manager","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-card-view"],function(a,r,b,k,p,l,g,c,m,f,t,d,e,n,q,j,h,u,s,i){var v,o={};o[l.Public]="fonticon fonticon-globe";o[l.Private]="fonticon fonticon-lock-open";o[l.Secret]="fonticon fonticon-lock";v=r.extend({_modelClass:b,_modelEvents:{"onSync:setlogo":"refresh","onChange:title":"refresh","onChange:description":"refresh","onChange:owner":"refresh","onChange:access":"refresh","onChange:is_favorite":"refresh"},domEvents:{'click *[data-content-type="person"][data-hash-key]':"_onUserClick","click .card-thumbnail-title-bar .fonticon-down-open":"_onToolbarClick","click .community-action-toolbar.discover-communities":"_stopPropagate","click .title .fonticon.fonticon-down-open":"_onOpenIconClick"},name:"community-card-view",className:"swym-tile col-extralg-2 col-lg-3 col-md-4 col-sm-6 col-xs-12",isListUsage:false,showActionToolbar:false,_requestToBecomeAuthor:function(){var w=this.addControl("requestBecomeAuthorModal",new e({model:this.model}));w.render(document.body);w.show()},_onUserClick:function(w){w.stopPropagation();w.preventDefault();require(["DS/SwymUICore/script/utils/link-builder-utils"],function(x){x.displayProfile(w)})},_onToolbarClick:function(w){w.stopPropagation();var x=this.getControl("dropdownMenu");if(x){x.show()}},_stopPropagate:function(w){w.stopPropagation()},_onOpenIconClick:function(w){w.stopPropagation()},_favorite:function(){this.model.updateFavorite(true)},_unfavorite:function(){this.model.updateFavorite(false)},_follow:function(){this.model.set("isBlacklisted",false);this.refresh();this.model.follow({onComplete:function(){this.alert("success",g.nowfollowing);u.dispatchEvent("requestContentListUpdate",{contextPath:"home"})}.bind(this),onFailure:function(){this.alert("error",g.NowFollowingErrorMsg);this.model.set("isBlacklisted",true);this.refresh()}})},_unfollow:function(){this.model.set("isBlacklisted",true);this.refresh();this.model.unfollow({onComplete:function(){this.alert("success",g.nownotfollowing);u.dispatchEvent("requestContentListUpdate",{contextPath:"home"})}.bind(this),onFailure:function(){this.alert("error",g.NowNotFollowingErrorMsg);this.model.set("isBlacklisted",false);this.refresh()}})},_onLeaveCommunityClicked:function(){var w=this.addControl("removeConfirmationModal",new q({closable:true,renderTo:this._widget.body}));w.confirm({title:g.deletequestion,message:g.removeMyAccessToThisCommunity,callback:function(x){if(x===true){this.model.deletecurrentuserfromcommunity({onComplete:function(){this.alert("success",g.Youhavebeendeletedfromthiscommunity);if(this.model&&this.model.collection){this.model.collection.remove(this.model)}}.bind(this),onFailure:function(z,y){if(y.errorcode==="ERROR_TRY_TO_LEAVE_COMMUNITY_WITH_IMPLICIT_ROLE"){this.alert("error",i.ErrorTryToLeaveCommunity)}}.bind(this)})}}.bind(this)})},setup:function(w){var y=this;y._parent(w);var x=p.getInstance();if(w){if(typeof w.isListUsage!=="undefined"){y.isListUsage=w.isListUsage}if(typeof w.showActionToolbar!=="undefined"){y.showActionToolbar=w.showActionToolbar}y._displayAccessors=(typeof w.displayAccessors!=="undefined")?w.displayAccessors:false;y._responsive=(typeof w.responsive!=="undefined"&&w.responsive)?w.responsive:false;if(!y.isListUsage){y.container.addClassName("community-idcard")}}y._context=x;y.onCommunityChange=y.onCommunityChange.bind(y);if(y.isListUsage===false){x.addListener("onCommunityChange",y.onCommunityChange,y,true)}},onCommunityChange:function(w){if(w&&w.communityId){this.setModel(new b({id:w.communityId}))}},_displaySprite:function(){var w=(this.isListUsage===false)?{size:"l"}:{};var x=this.getChildView("communityLogo");if(!x||!x.getInitialModel().equals(this.model)){return this.addChildView("communityLogo",new f({model:this.model,imageRenderingOptions:w}))}else{return x}},_getLogoURL:function(){return k.constructThumbnailUrl("community",this.model.get("mid"),"l_thumb",this.model.get("preview_fingerprint"))},_addBadge:function(w,x,y){return a.createElement("span",{"class":"badge badge-corporate "+y,html:w?{tag:"span","class":w}:(x?x:"")})},_createContent:function(){var z,B,x=this.model,A=this,w=[],y=a.createElement("span",{"class":"fonticon fonticon-2x fonticon-down-open"});if(x&&x.get("owner")){B=x.get("user_access")!=="0",z=x?x.hasDefaultLogo():null;A.roleBadge=B&&A._addBadge(false,x.getTranslatedRole(),"role");A.followBadge=B&&A._addBadge("fonticon fonticon-"+(x.get("isBlacklisted")?"eye-off":"eye"),null,"blacklist");A.favoriteBadge=x.get("is_favorite")&&A._addBadge("fonticon fonticon-favorite-on",null,"favorite");A.visibilityBadge=A._addBadge(o[x.getVisibility()],null,"visibility");A.joinCommunityButton=!B&&a.createElement("div",{"class":"community-action-toolbar discover-communities",html:A.addControl("join-button",new j({value:g.Join,className:"small primary",icon:"login",events:{onClick:function(){m.show(A.model)}}}))});w=a.createElement("div",{"class":"card card-thumbnail"+(B?" draggable-community":""),"data-is-link":false,"data-content-id":x.get("mid"),html:[{tag:"img","class":"card-img logo","data-content-type":"community","data-content-id":x.get("mid"),src:this._getLogoURL()},{tag:"div","class":"card-block card-thumbnail-title-bar",html:[{tag:"h4","class":"card-title","data-content-type":"community","data-content-id":x.get("mid"),html:[{tag:"li","class":"fonticon fonticon-users-alt"},x.get("title")]},{tag:"h5","class":"card-subtitle",html:[{tag:"span","class":"owner-subtitle","data-content-type":"person","data-hash-key":x.get("owner").hash_key,"data-login":x.get("owner").login,html:x.getMainOwner()?x.getMainOwner().getNickname():""},!B?"":y]}]},{tag:"div","class":"card-footer",html:[A.roleBadge,A.visibilityBadge,A.followBadge,A.favoriteBadge,A.joinCommunityButton]}]});A.roleBadge&&A.addControl("RoleTooltip",new s({target:A.roleBadge,body:i.Role+" : "+x.getTranslatedRole()}));A.followBadge&&A.addControl("FollowTooltip",new s({target:A.followBadge,body:x.get("isBlacklisted")?i.UnfollowedCommunity:i.FollowedCommunity}));A.favoriteBadge&&A.addControl("FavoriteTooltip",new s({target:A.favoriteBadge,body:i.FavoriteCommunity}));A.visibilityBadge&&A.addControl("VisibilityTooltip",new s({target:A.visibilityBadge,body:x.getVisibility()}));A.addControl("MenuTooltip",new s({target:y,body:i.Menu}));c.getInstanceFetched(this._buildDropDownMenu(y))}else{w=a.createElement("div",{styles:{margin:"auto","text-align":"center",height:"40px"},html:new h({className:"msg-animation",visible:true,animate:true,spin:true})})}return w},getBecomeAuthorView:function(){var w=this.getChildView("becomeAuthorView");if(!w){w=this.addChildView("becomeAuthorView",{Class:"DS/SwymUIComponents/script/feature/community/community/view/request-become-author-view"})}return w},destroy:function(){p.getInstance().removeListener("onCommunityChange",this.onCommunityChange);return this._parent.apply(this,arguments)},_buildDropDownMenu:function(y){var x=this.model.get("isBlacklisted"),w=[];if(t.getInstance().isFeatureActivated("active_community_blacklist")){w.push({name:x?"follow":"unfollow",text:x?g.Follow:g.Unfollow,fonticon:"eye"})}w.push({name:this.model.get("is_favorite")?"unfavorite":"favorite",text:this.model.get("is_favorite")?g.RemoveFromFavorites:g.AddAsFavorite,fonticon:this.model.get("is_favorite")?"favorite-off":"favorite-on"});if(this.model.get("role")==="Contributor"&&t.getInstance().isFeatureActivated("activate_community_change_role_request")){w.push({name:"becomeAuthor",text:g.BecomeAuthor,fonticon:"user"})}if(this.model.getDeleteRight()===true){w.push({name:"leave",text:g.LeaveCommunity,fonticon:"logout"})}if(w.length>0){this.addControl("dropdownMenu",new n({target:y,renderTo:window.document.body.getElement(".scroll-content"),position:"bottom right",offset:{x:17,y:8},items:w,events:{onClick:function(A,z){switch(z.name){case"leave":this._onLeaveCommunityClicked();break;case"follow":this._follow();break;case"unfollow":this._unfollow();break;case"favorite":this._favorite();break;case"unfavorite":this._unfavorite();break;case"becomeAuthor":this._requestToBecomeAuthor();break}}.bind(this)}}))}else{y.hide()}}});return v});define("DS/SwymUIComponents/script/feature/community/community/view/community-list-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/ui-components/list/item-list","DS/SwymUIComponents/script/feature/community/community/view/community-card-view"],function(d,a,c){var b=a.extend({name:"community-list",modelViewClass:{community:c},modelViewsCfg:function(){var e=this._parent.apply(this,arguments);return d.merge({isListUsage:true,showActionToolbar:true},e)},setup:function(e){e.useDynamicGrid=false;this._parent.apply(this,arguments)}});return b});define("DS/SwymUIComponents/script/feature/core/user/view/add-member-panel-view-v2",["UWA/Core","DS/SwymUIComponents/script/feature/core/user/view/add-member-panel-view","DS/SwymUICore/script/feature/core/user/collection/user-and-users-group-collection"],function(d,c,b){var a=c.extend({name:"add-member-panel-view-v2",_userAndUsersGroupCollection:null,setup:function(f){var e=f?d.clone(f,false):{};return this._parent.call(this,e)},_getExtraOptions:function(){return{suggestUrl:"",suggestRequestData:{as_admin:null},suggestTextAttribute:"query",suggestFormat:"{ds6w_58_label}",suggestKey:"subject6wuri",labelFormat:"{ds6w_58_label}",onEmailAddress:this._onEmailAddress.bind(this)}},_findPotentialMembers:function(e){var f=this;if(!this._userAndUsersGroupCollection){this._userAndUsersGroupCollection=new b([],{communityId:this.collection.getAssociated("owned").get("mid"),limit:10,mode:"searchbyname"})}if(!e.onComplete){throw new Error("onComplete option is missing")}return this._userAndUsersGroupCollection.fetch({data:e.data,onComplete:function(i,g){if(i.length===0&&f._isAMail(e.data.query)){var h=[{"ds6w:label":e.data.query,subject6wuri:e.data.query,ds6w_58_label:e.data.query}];e.onComplete.call(this,h)}else{e.onComplete.call(this,i.toJSON())}},onFailure:e.onFailure})},_isAMail:function(f){var e=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(f)}});return a});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-stats-collection-view",["i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/survey-stats-collection-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/survey/collection/survey-collection","DS/SwymUIComponents/script/feature/community/survey/view/survey-stats-view"],function(e,d,c,b){var a=d.extend({_collectionClass:c,modelViewClass:b,attributes:{tag:"table","class":"survey-stats table table-hover"},bodyAttributes:{tag:"tbody"},modelViewsCfg:{attributes:{tag:"tr","class":"cursor-pointer"}},_createModelView:function(){var f=this._parent.apply(this,arguments);f.container.addEvent("click",function(g){this.collectionView.dispatchEvent("surveyClicked",[this.modelView.model])}.bind({collectionView:this,modelView:f}));return f},_createContent:function(){if(this.collection.hasBeenFetched()&&this.collection.length===0){return e.Thereisnosurveyinthiscommunity}else{if(this.collection.hasBeenFetched()&&this.collection.length!==0){return[{tag:"thead",html:"<th>"+e.Title+"</th><th>"+e.NbVoters+"</th><th>"+e.StartDate+"</th><th>"+e.EndDate+"</th>"},this._parent.apply(this,arguments)]}}},setup:function(f){this._parent.apply(this,arguments)}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/media-zone-view",["UWA/Core","DS/SwymUICore/script/lib/collection/generic/swym-collection","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/feature/community/media/view/interactive-media-thumbnail-view","DS/Logger/Logger"],function(m,i,j,n,d){var k=120,e=2,b=1,h=6,a="show-all",g=function(o){return"show-"+o+"-thumbnails"},c=function(o){return"row-with-"+o+"-thumbnails"},l=n.extend({_interactAfterClickOnThumbnail:function(){d.log("on click");var p,q,o,r=false,s=this.container.getClosest(".media-zone");if(s&&s.contains(this.container)&&(this.container.dataset.remainingMedia)){for(p=b;p<=h;p++){q=g(p);if(s.hasClassName(q)){o=s.getElement(".media-thumbnail-view-container:nth-child(1n+"+p+")");if(o&&(this.container===o)){s.removeClassName(q);s.addClassName(a);s.addClassName(c(p));r=true}break}}}if(r===false){this._parent.apply(this,arguments)}}}),f=j.extend({name:"media-zone-view",resizeTimeout:null,_delegateSpriteReloadToParentView:false,_collectionClass:i,imageReloadOptions:{size:"m",imageKind:"thumb"},bodyAttributes:{"class":"content-media-collection-view media-zone"},domEvents:{resize:"_updateRemainingThumbnailsCounter"},modelViewClass:l,nbThumbnailsShowingCurrently:null,modelViewsCfg:function(){return{events:{onOpenInViewerRequest:function(){this.dispatchEvent("onOpenInViewerRequest",arguments)}.bind(this)}}},_updateRemainingThumbnailsCounter:function(t){var q,u,o,r,s=this.nbThumbnailsShowingCurrently,p=this.container,v=p.getElement(".media-zone");if(p&&v&&(u=p.getSize().width)&&(u>0)){o=parseInt(((u+e)/(k+e)),10);if(!v.hasClassName(a)){d.log("width",u,"nbThumbnails",o);if(t===true){s=null;for(q=b;q<=h;q++){r=g(q);if(v.hasClassName(r)){v.removeClassName(r)}}}if(!s){this.nbThumbnailsShowingCurrently=o;v.addClassName(g(o))}else{if(s!==o){d.log("old",s,"new",o,"cid",this.cid);v.removeClassName(g(s));this.nbThumbnailsShowingCurrently=o;v.addClassName(g(o))}}}else{for(q=b;q<=h;q++){r=c(q);if(v.hasClassName(r)){if(q!==o){v.removeClassName(r)}else{break}}}r=c(o);if(!v.hasClassName(r)){v.addClassName(r)}}}},onRedraw:function(){var p,o,s,r,q=this.getModelViews();if(q&&((o=q.length)>0)){if(this.collection.length!==o){d.error("Thumbnails don't match the collection length")}for(p=0;p<o;p++){s=q[p];r=o-p-1;if(r>0){s.container.dataset.remainingMedia="+"+r}}}this._updateRemainingThumbnailsCounter(true)}});return f});define("DS/SwymUIComponents/script/feature/community/media/view/simple-content-media-view",["UWA/Core","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/media/view/media-zone-view","DS/SwymUIComponents/script/feature/community/content/utils/content-media-renderer","DS/SwymUIComponents/script/feature/community/media/view/smart-lightbox-view","DS/SwymUICore/script/lib/collection/generic/swym-collection"],function(g,b,f,e,a,d,h){var c=f.extend({name:"content-media-display-manager",_mediaRenderer:null,_mediaCollection:null,_modelEvents:{"onSync:update":"onModelUpdate"},_modelClass:b,defaultOptions:{contentAttributeInModel:"content"},setup:function(){this._parent.apply(this,arguments);this.setupMedia()},onModelUpdate:function(){var i,j;if(this._mediaRenderer){j=this._mediaRenderer.process(this.model.get(this.getOption("contentAttributeInModel")),{createMediaView:false,toReturn:{mediaCollection:true}})||{};this._mediaCollection=j.mediaCollection;if(i=this.getChildView("media-zone")){if(this._mediaCollection){i.setCollection(this._mediaCollection)}else{this.destroy()}}}},setupMedia:function(){var k,i,j;this._mediaRenderer=a.getInstance();k=this.model.get(this.getOption("contentAttributeInModel"));j=this._mediaRenderer.process(k,{createMediaView:false,toReturn:{mediaCollection:true}});this._mediaCollection=j?j.mediaCollection:null;if(this._mediaCollection&&(this._mediaCollection.length>0)){i=this.addChildView("media-zone",{Class:e,collection:this._mediaCollection})}else{i=this.addChildView("media-zone",{Class:e,collection:new h()})}this.listenTo(i,"onOpenInViewerRequest",this.onOpenInViewerRequest)},_createContent:function(){return this.getChildView("media-zone")},getMediaZoneView:function(){return this.getChildView("media-zone")},onOpenInViewerRequest:function(i){var j=arguments[1]._shouldActivateAutoplay||false;new d({collection:this._mediaCollection,model:i,isAutoplayActivated:j}).injectInDom()},onDestroy:function(){this.stopListening(this.getChildView("media-zone"))}});return c});define("DS/SwymUIComponents/script/feature/community/question/view/validated-answers-view",["UWA/Core","DS/SwymUICore/script/feature/community/iquestion/model/iq-answer-model","DS/SwymUICore/script/feature/community/iquestion/collection/iq-answer-collection","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUIComponents/script/feature/community/media/view/simple-content-media-view","DS/SwymUIComponents/script/feature/community/content/utils/content-renderer","DS/SwymUICore/script/utils/date","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view","DS/SwymUIComponents/script/feature/community/question/question-view-mixin"],function(i,m,b,g,f,k,a,l,e,d,h){var j=g.extend({_modelClass:m,className:"validated-answer-section",name:"validated-answer-view",setup:function(){this._parent.apply(this,arguments);this._contentRenderer=l.getInstance()},renderContent:function(){var n=this.model,o=n.get("answer");o=this._contentRenderer.render(o,{createMediaView:false});return o},getContentMediaView:function(){var n=this.getChildView("content-media-display-manager");if(!n){n=this.addChildView("content-media-display-manager",new a({model:this.model,contentAttributeInModel:"answer"}))}return n},_createContent:function(){var q=this.model,r=q.getAuthor(),p=this.renderContent(),n=this.getContentMediaView(),o=q.getAssociated("answeredFor");return[{tag:"div","data-content-id":o.get("mid"),"data-content-type":o.getModelName(),"data-community-id":o.get("community->mid"),"class":"validated-answer answer-summary",html:[p,n]},{"class":"answer-author-section",html:[this.addChildView("userPicture",{tagName:"span",Class:k,model:r,imageRenderingOptions:{format:"normal"}}),{tag:"span","class":"link","data-content-type":"person","data-hash-key":r.get("hash_key"),"data-login":r.get("login"),html:r.getNickname()},{tag:"span","class":"content-detail",html:d.by},{tag:"span","class":"content-detail",html:"-"},{tag:"span","class":"content-detail activity-date",html:e.prettyDate(q.get("pubdate"))}]}]}}),c=f.extend({_collectionClass:b,modelViewClass:j});return c.extend(h)});define("DS/SwymUIComponents/script/feature/core/user/view/language/user-language-edit-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/user/view/components/user-stars-edit-view","DS/SwymUICore/script/feature/core/language/model/language-model","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/components/user-stars-edit-view","DS/UIKIT/Form","DS/UIKIT/Spinner","DS/SwymUICore/script/feature/core/language/collection/language-list-collection"],function(h,g,e,f,b,d,c){var a=g.extend({_modelClass:e,name:"user-language-edit-view",_languagesOptions:[],_getForm:function(){var i=this.model;if(!i.get("mid")&&!i.get("language_id")){i.set("language_id",this._languagesOptions[0].value)}return new b({fields:[{type:"select",options:this._languagesOptions,label:f.Language,value:i.get("language_id"),required:true,events:{onChange:function(){var k=this.options.options,n;for(var m=0,j=k.length;m<j;m++){n=k[m];if(n.value===this.getValue()[0]){break}}if(n.lang_english!==i.get("lang_english")){i.addChanges("language_id",n.value);i.addChanges("lang_native",n.lang_native);i.addChanges("lang_english",n.lang_english);i.addChanges("translated",n.translated)}}}},this._createContentInputStars(),{type:"textarea",label:f.Details,value:i.get("description",{escapeHTML:false}),name:"details",events:{onChange:function(){i.addChanges("description",this.getValue())}}}]})},_createContent:function(){this.container.setStyle("text-align","center");var i=this.addControl("form-box-view",new d({className:"msg-animation",visible:true,animate:true,spin:true})),j=this,k=new c([],{mode:"getlanglist"});k.fetchOnce({onComplete:function(u){this._languagesOptions=new Array();u.sort();var m=u._models,A=function(l){return l.get("mid")&&(l.get("iso_code")===this.get("iso_code"))?true:false},x=j.model?j.model.collection.getAssociated("user").getAssociated("languages"):[],p=x.clone();for(var s=0,q=m.length;s<q;s++){var t=m[s],w=(t.get("translated"))?t.get("translated"):t.get("lang_english");if(!p.find(A,t)||(this.model.get("mid")&&t.get("iso_code")===this.model.get("iso_code"))){this._languagesOptions.push({label:w+" ("+t.get("lang_native")+")",value:""+t.get("mid"),lang_native:t.get("lang_native"),lang_english:t.get("lang_english"),translated:w})}}for(var r=0,q=x.length;r<q;r++){var t=x.at(r),v=u.where({iso_code:t.get("iso_code")});t.set("translated",v[0].get("translation"))}if(j.container){if(!j.model.get("mid")){var z="",y=[],o=this.model.collection.filter(function(l){return l.get("language_id")!=j.model.get("language_id")});for(var s=0,q=this._languagesOptions.length;s<q;s++){z=this._languagesOptions[s].value;y=o.filter(function(l){return l.get("language_id")===z});if(y.length===0){z=this._languagesOptions[s];break}}j.model.set({lang_english:z.lang_english,iso_code:z.value,lang_native:z.lang_native,language_id:z.value})}j.container.setStyle("text-align","inherit");var n=j._getForm();i=j.addControl("form-box-view",n);n.inject(j.container);j.dispatchEvent("onLanguageRefresh",[j])}}.bind(this)});return i}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/language/user-language-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/language/user-language-view","DS/SwymUICore/script/feature/core/language/model/language-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/ui-components/box-view/box-view","DS/SwymUIComponents/script/feature/core/user/view/language/user-language-edit-view","DS/SwymUIComponents/script/feature/core/modal/super-modal"],function(i,e,f,h,b,g,c,a){var d=h.extend({_modelClass:f,name:"language-view",_createContent:function(){var l=new g({model:this.model,widget:this._widget}),j=new c({model:this.model,widget:this._widget,_labelNameInput:"language test to pick"}),k=i.createElement("div",{html:this.addChildView("edition-switch",{Class:b,model:this.model,editView:j,readView:l,actionOnSave:function(n){var o=this.getChildView("edition-switch").getChildView("editview").getControl("form-box-view"),p=o.validate(),m=this.model.isNew();if(n===true){return p}if(p){if(m||Object.keys(this.model.getChanges()).length){this.model.save({},{onComplete:function(s,q){var t=m?e.languageCreated:e.languageUpdated;this.alert("success",t);s.set(s.getChanges());var r=this.getChildView("edition-switch");if(r){r.setMode("read")}}.bind(this),onFailure:function(){console.log("error")}})}}else{this.alert("error",e.pleaseFillTheFieldsCorrectly);return p}}.bind(this),actionOnDestroy:function(){var m=new a({closable:true,renderTo:this._widget.body});m.confirm(e.deletewarning,e.deletequestion,function(n){if(n===true){if(this.model.isNew()===false){this.model.destroy({onComplete:function(){this.alert("success",e.languageDeletedSucess)}.bind(this),onFailure:function(){this.alert("error",e.YourchangescouldnotbesavedPleasetryagainlater)}.bind(this)})}else{var o=this.getChildView("edition-switch");if(o){o.onCancelClick()}}}}.bind(this))}.bind(this)})});return k}});return d});define("DS/SwymUIComponents/script/feature/core/network/view/multi-invitation-layer-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory","DS/UIKIT/Form","i18n!DS/SwymUIComponents/assets/nls/feature/core/network/view/invitation-layer-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/components/user-search-config","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/UIKIT/Input/Button","DS/SwymUICore/script/feature/core/notification/collection/notification-collection","DS/UWPClientCode/I18n"],function(h,a,f,c,l,i,j,e,b,d,m,k){var g=e.extend({name:"multi-invitation-layer-view",_createContent:function(){var p=j.getInstance().get("user"),o=this,n=[{"class":"edit-content edit-style",html:this.addControl("autocomplete-form",new f({fields:[a.getFormConfig({loginsToExcludeFromSearch:[p.login],label:l.People,excludePendingUsers:true,parentSwymView:this,multiSelect:true}),{type:"textarea",name:"message",label:c.Message,value:p.first_name+" "+p.last_name+" "+c.textByDefaultInvitation}]}))},{"class":"actionBar edit-style",html:[new d({value:c.Invite,className:"saveButton primary",events:{onClick:function(){var q=o.getControl("autocomplete-form");if(q){var r=q.validate(),s=q.autocompletes[0],x=s.getSelection(),z=[];if(r){this.load();for(var w=0,u=x.length;w<u;w++){z.push(x[w].hash_key)}var t=i.getInstance().getAssociated("groups"),y=new m([],{mode:"sendInvitations"}),v=function(){var A="",E="",B=z.length,D=0;for(var C=0,B;C<B;C++){A=new b({hash_key:z[C]});A.getInvitationStatus({onComplete:function(H,F){D++;var I=F.result,G=true;if(I.user_in_network=="0"&&I.connected_user_to_user!=="new"){E+=H.get("hash_key")+";";G=false}if(D===B){if(G===true){o.alert("info",c.alreadyInNetwork);this.load(false)}else{y.sendInvitations({data:{message:q.getField("message").value,groupIdProfessionnal:i.getInstance().getAssociated("groups").getIdGroupProfessional(),hash_keys:E},onComplete:function(){q.reset();q.setValue("message",p.first_name+" "+p.last_name+" "+c.textByDefaultInvitation);this.load(false);o.hide();o.alert("success",c.invitationsSent)}.bind(this),onFailure:function(){console.log("sendinvitations failed")}})}}}.bind(this)})}}.bind(this);if(t.isEmpty()){i.getInstanceFetched(function(A){t.setAssociated("currentUser",A);t.fetch({onComplete:function(){v()}})})}else{v()}}else{o.alert("error",c.Pleasefillthefieldscorrectly)}}}}}),new d({value:c.cancel,className:"cancelButton default",events:{onClick:function(){var r=o.getControl("autocomplete-form");if(r){r.reset();r.setValue("message",p.first_name+" "+p.last_name+" "+c.textByDefaultInvitation)}o.hide();var q=o._parentView.getElement(".no-connection-engaging");if(q){q.show()}}}})]}];return n}});return g});define("DS/SwymUIComponents/script/feature/core/user/view/macro/user-connections-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/macro/user-connections-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/core/network/collection/request-collection","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/SwymUIComponents/script/feature/core/network/view/request-received-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view","DS/SwymUICore/script/feature/core/network/model/network-model","DS/SwymUIComponents/script/feature/core/user/view/small-user-tile-view","DS/PubSub/PubSub","DS/WebappsUtils/Console","DS/SwymUIComponents/script/feature/core/network/view/multi-invitation-layer-view","DS/SwymUICore/script/feature/core/sprite/sprite","DS/UIKIT/Accordion","DS/SwymUICore/script/utils/i18n","DS/SwymUICore/script/feature/community/community/collection/community-collection","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/macro/user-app-view","DS/SwymUIComponents/script/feature/core/network/view/invitation-layer-view","DS/UIKIT/Spinner","DS/UIKIT/Tooltip","DS/SwymUICore/script/feature/community/community/model/community-model","DS/W3DXComponents/Views/Item/TileView","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/feature/core/network/view/network-list-view","UWA/Class/Model","DS/SwymUICore/script/utils/navigation","DS/WebappsUtils/WebappsUtils"],function(a,s,B,b,k,v,o,n,C,D,A,w,E,d,G,x,y,h,r,m,i,g,p,c,u,q,f,e,l,z,t,j){var F=b.extend({_modelClass:u,name:"community-tile-view",_createContent:function(){var K=this.model;var I=new z({title:function(){return'<a href="'+K.getRelativePath()+'">'+K.get("title")+"</a>"},imgAttrs:function(){return y.getMediaThumbnailAttributes({id:K.get("mid"),communityLogo:true,imageUpdateTime:K.get("settings_update")||K.get("update"),cls:"dsi-communities-home-list-picture",modelId:K.get("mid"),modelName:"community"})},image:function(){return v.constructThumbnailUrl(K.getModelName(),K.get("mid"),"m_thumb")},subtitle:e.prettyDate(K.get("update")),content:K.get("description")});var J=new q({model:I,events:{onClick:function(){t.goToCommunity(this.model.get("mid"))}.bind(this)}});return a.createElement("div",{html:J.render()})}});var H=b.extend({_modelClass:k,name:"userconnections-view",domEvents:{"click #connectionsMemberSetView .icon-section .fonticon-user-add":"_addInviteMultiLayer","click .network-view.cursor-pointer":"_onEmptyNetworkClick","click .fonticon-info-circled":"_onInfoSharedCommunitiesClick"},_onInfoSharedCommunitiesClick:function(){var I=this.getControl("tooltip-shared-communities");if(I){I.show()}},_onEmptyNetworkClick:function(){if(this.model.isCurrentUser()){this._addInviteMultiLayer()}else{if(this.model.get("connected_user_to_user")!=="new"){var J=new g({model:this.model}),I=function(){this._invitationAlreadySent=true}.bind(this);if(this._invitationAlreadySent!==true){J.launch(I)}else{this.alert("info",i.alreadySentInvitation)}}}},_addInviteMultiLayer:function(){var K=this.getChildView("multi-layer-invite"),J,I=this.getElement(".no-connection-engaging");if(K){K.show()}else{K=this.addChildView("multi-layer-invite",new x()),J=this.getElement(".multi-layer-invit-target");if(J){K.render(J)}}if(I){I.hide()}},_createContent:function(){var I=this.model;if(I){if(I.isCurrentUser()){this._preparePeopleYouMightKnow()}this._prepareNetwork();d.add("refreshPendingInvitations",function(){this._prepareReceivedRequests()}.bind(this));d.add("refreshNetwork",function(J,K){if(this.model){J.getRelativePath=this.model.getRelativePath}if(this._users){if(K===true){this._users.add(J)}else{if(K===false){this._users.remove(J)}}var M=this.getElement(".profile-element-title"),L=this._getNetworkTitle();if(M&&L){M.setText(L)}}}.bind(this),null,true);return a.createElement("div",{html:[I.isCurrentUser()?{"class":"col-sm-4 col-md-3 second-column",html:[{id:"connectionsReceivedRequest"},{id:"peopleyoumightknow"}]}:{"class":"col-sm-4 col-md-3 second-column",html:[{"class":"sharedContactsContainer"},{"class":"sharedCommunitiesContainer"}]},{"class":"col-sm-8 col-md-9",id:"connectionsMemberSetView"}]})}},_prepareSharedContacts:function(){var J=new n([],{mode:"getmysharedcontacts",limit:1});var I=D.extend({modelViewClass:E});J.fetch({data:{hash_key:this.model.get("hash_key")},onComplete:function(O){var M=this.getElement(".sharedContactsContainer"),N=O.length;if(N>0){if(M){var L=new I({collection:O});var K=new h({className:"filled profile-background",items:[{title:(N===1)?s.OnePersonInCommon:r.replace(s.ManyPersonsInCommon,{number:O.length}),content:[L.render()],selected:true}],events:{onClose:function(P){P.content.style.marginTop="-"+P.content.offsetHeight+"px"}}});K.inject(M)}}}.bind(this)})},_prepareSharedCommunities:function(){var I=new m([],{mode:"my-communities-people",limit:5,hash_key:this.model.get("hash_key")});var J=D.extend({modelViewClass:F});I.addEventOnce("onAfterPageChange",function(N){var K=this.getElement(".sharedCommunitiesContainer"),L=N.length;if(L>0){if(K){var Q=new J({collection:N}),S=new A({widget:this._widget,collection:N}),P=a.createElement("div",{styles:{clear:"both"}});K.grab(P);S.render(K);var M=new h({className:"filled profile-background",items:[{title:(L===1)?s.OneSharedCommunity:r.replace(s.ManySharedCommunities,{number:N.getTotalItems()}),content:[Q.render(),P,S.render()],selected:true}],events:{onClose:function(T){T.content.style.marginTop="-"+T.content.offsetHeight+"px"}}});M.inject(K);var R=K.getElement(".accordion-title"),O=a.createElement("span",{"class":"fonticon cursor-pointer fonticon-info-circled"});if(R){O.inject(R);this.addControl("tooltip-shared-communities",new c({target:O,body:s.privateandsecretonly}))}}}else{if(K){K.hide();this._checkIfEmpyLeftColumn()}}}.bind(this));I.goToPage(1)},_preparePeopleYouMightKnow:function(){var K=new n([],{mode:"getpeoplefamiliartocurrentuser",limit:6}),J=D.extend({modelViewClass:E}),I=B.extend({_createContent:function(){var L=a.createElement("div",{styles:{"margin-top":"15px","text-align":"center"},html:s.nosuggestion});return L}});K.addEvent("noMoreRecommendation",function(){var M=this.getElement("#peopleyoumightknow");if(M){var L=new I();L.render(M)}}.bind(this));K.fetch({onComplete:function(O){var N=this.getElement("#peopleyoumightknow");if(N){var M;if(O.length>0){M=new J({collection:O,modelViewsCfg:{addConnection:true}})}else{M=new I()}M.addEvent("onRender",function(){});var L=new h({className:"filled profile-background",items:[{title:s.peopleyoumayknow,content:[M.render()],selected:true}],events:{onClose:function(P){P.content.style.marginTop="-"+P.content.offsetHeight+"px"}}});L.inject(N)}}.bind(this)})},_collectionReceivedRequestView:D.extend({name:"user-sentrequests-collection-view",modelViewClass:C}),_prepareReceivedRequests:function(){var I=new o([],{mode:"receivedRequests",limit:5,Hashkey:this.model.get("hash_key")});I.fetch({onComplete:function(N){N.setAssociated("groups",this._groups);N.setAssociated("users",this._users);var L=new this._collectionReceivedRequestView(N),K=this.getElement("#connectionsReceivedRequest"),M=N.length;if(M!==0){if(K){L.addEvent("onRender",function(){});var J=new h({className:"filled profile-background",items:[{title:(M===1)?s.OnePendingInvitation:r.replace(s.ManyPendingInvitations,{number:N.length}),content:[L.render()],selected:true}],events:{onClose:function(O){O.content.style.marginTop="-"+O.content.offsetHeight+"px"}}});J.inject(K.empty())}}else{var K=this.getElement("#connectionsReceivedRequest");if(K){K.hide();this._checkIfEmpyLeftColumn()}}}.bind(this)})},_prepareNetwork:function(){if((this.model.get("ut_state")!=2)&&(this.model.get("ut_state")!=3)){new w({id:this.model.get("hash_key"),hash_key:this.model.get("hash_key")}).fetch({onComplete:function(I){this._drawNetwork(I)}.bind(this)})}},_checkIfEmpyLeftColumn:function(){var I=this.getElement(".sharedContactsContainer"),K=this.getElement(".sharedCommunitiesContainer");if(I&&K&&I.getStyle("display")==="none"&&K.getStyle("display")==="none"){I.parentElement.hide();var J=this.getElement("#connectionsMemberSetView");if(J){J.className="col-md-12"}}},_getNetworkTitle:function(){var J="",I=this._users.length;if(I===1){J=r.replace(s.contact,{number:I})}else{if(I===0){if(this.model.isCurrentUser()===true){J=s.addAContact}}else{J=r.replace(s.contacts,{number:I})}}return J},_drawNetwork:function(L){this._users=L.getAssociated("users"),this._groups=L.getAssociated("groups");var J=this.getElement("#connectionsMemberSetView");if(J){var I=this.addChildView("network-view",new l({modelUser:this.model,widget:this._widget,collection:this._users}));I.render(J);var K=a.createElement("div",{styles:{overflow:"auto"},html:[{"class":"profile-element-title pull-left",html:this._getNetworkTitle()},(this.model.isCurrentUser()===true)?{"class":"icon-section",html:' <span class="fonticon fonticon-2x cursor-pointer fonticon-user-add"></span>'}:{},{"class":"multi-layer-invit-target col-lg-6 col-lg-offset-3 col-md-offset-2 col-md-8"}]});K.inject(J,"top")}if(this.model.isCurrentUser()){this._prepareReceivedRequests()}else{if(this._users.length>0){this._prepareSharedContacts()}else{J=this.getElement(".sharedContactsContainer");if(J){J.hide()}}this._prepareSharedCommunities()}}});return H});define("DS/SwymUIComponents/script/feature/core/ui-components/community-contextual-action-menu",["DS/UIKIT/DropdownMenu","DS/SwymUICore/script/feature/core/context/context-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-tile-view","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/usage-tracker","i18n!DS/SwymUIComponents/assets/nls/feature/core/share/view/share-content-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","i18n!DS/SwymUIComponents/assets/nls/feature/core/ui-components/community-contextual-action-menu","UWA/Promise"],function(a,i,e,f,j,d,b,h,g){var c=a.extend({position:"left",defaultOptions:{maxItemsBeforeScroll:20,responsiveMode:true,scrollMode:true},_context:null,_widget:null,_pipelineModal:null,_destroyed:false,_contentCreated:false,init:function(k){k.items=[{name:"loading",text:h.Loading}];k.className="community-contextual-action-menu";this.model=k.model;if(!k.target){throw new Error("The target must be specified!")}this._widget=k.widget;this._parent.call(this,k);this._context=i.getInstance();this._onFeedModeChange=this._onFeedModeChange.bind(this);this._onContextChange=this._onContextChange.bind(this);this._updateCenterColumnContentMode(this._context.feedMode);this._context.addListener("onFeedModeChange",this._onFeedModeChange);this._context.addListener("onContextChange",this._onContextChange)},_onContextChange:function(){var k=this._context.getCommunityPageContext(),l=this.getSelectedItems().pop();if(k){this.items&&this.getItem(k)&&this.toggleSelection(this.getItem(k))}else{if(l){l.elements.container.removeClassName("selected");l.selected=false}}if(this._context.getCommunityPageContext()===i.COMMUNITY_IDEAS){this.items&&this.getItem("pipeline")&&this._showItem(this.getItem("pipeline"))}else{this.items&&this.getItem("pipeline")&&this._hideItem(this.getItem("pipeline"))}if(this._context.getCommunityPageContext()===i.COMMUNITY_MEDIA){this.items&&this.getItem("gallery")&&this._showItem(this.getItem("gallery"))}else{this.items&&this.getItem("gallery")&&this._hideItem(this.getItem("gallery"))}this._updateCenterColumnContentMode(this._context.feedMode)},_unselectItem:function(){var k=this.getSelectedItems().pop();if(k){k.elements.container.removeClassName("selected");k.selected=false}},_updateCenterColumnContentMode:function(m){var n=m,l="",k=!this._destroyed&&this.getContent();if(k){switch(n){case i.TIMELINE_MODE:l="timeline";break;case i.WHATSNEW_MODE:l="whatsnew";break;default:break}k.dataset.centerColumnContentMode=l}},_onFeedModeChange:function(k){this._updateCenterColumnContentMode(k.feedMode)},_communityPageHandler:function(k){if(this._context.getCommunityPageContext()===k){this._unselectItem();this._navigateTo("")}else{this._navigateTo(k)}},_addItems:function(){var l=this,k=this.model.getCommunityFeaturesAccess(),m=l.model.get("community_type")==="dm";while(this.items.length>0){this.removeItem(0)}if(m&f.isFeatureActivated("activateConversationTopic")){this.addItem({text:h.SetTopic,fonticon:"chat-alt",name:"topic",handler:function(){l._showTopicModal()}})}if(f.isFeatureActivated("activateSubscribe")&&this.model.getCustomProperty("currentUserSubscribed")!==undefined){this.addItem({text:l.model.getCustomProperty("currentUserSubscribed")?h.UnsubscribeToNewContent:h.SubscribeToNewContent,fonticon:"bell-alt",name:"subscribe",handler:this._onSubscribeClick.bind(this)})}this.addItem({text:e.Mycontributions,fonticon:"feather",name:i.COMMUNITY_MY_CONTRIBUTIONS,handler:function(){l._navigateTo(i.COMMUNITY_MY_CONTRIBUTIONS)}});if(!m){this.addItem({text:e.SubscribeToRSSFeed,fonticon:"rss",name:"rss",handler:function(){var p=i.getInstance(),q=l.model.get("mid"),n={ideas:"ideation",media:"media",question:"iquestion",blog:"post",surveys:"survey"},r=this._context.getCommunityPageContext(),o=f.getBaseUrl()+"/rss/feed/whatsnew/community_id/"+q;if(r==="wiki"){o=f.getBaseUrl()+"/rss/filter/feed/community_id/"+q+"/model/wiki/"}else{if(n[r]){o=f.getBaseUrl()+"/rss/feed/whatsnew/model/"+n[r]+"/community_id/"+q}}window.open(o)}});this.addItem({text:d.Share,fonticon:"forward",name:"share",handler:function(){require(["DS/SwymUIComponents/script/feature/core/share/view/share-content-view"],function(n){l._shareView=new n({model:l.model,widget:l._widget});l._shareView.launchModal()})}})}if(window.ds&&window.ds.env==="3DD"&&(window.widget&&widget.getAppName()===f.getMyCommunitiesAppKey())){this.addItem({text:e.PinToThisTab,fonticon:"publish",name:"pin",handler:function(){var n={appId:f.getMyCommunitiesAppKey(),data:{url:f.getBaseUrl()}};if(l.model.get("users")){n.data[l.model.get("users")?"dm":"community"]=l.model.get("mid")}f.pinToDashboard(n)}})}if(k.stats_feature){this.addItem({text:e.Statistics,fonticon:"chart-bar",name:i.COMMUNITY_STATS,handler:function(){l._navigateTo(i.COMMUNITY_STATS)}})}this.addItem({text:e.membersPluralUp,fonticon:"users",name:i.COMMUNITY_MEMBERS,handler:function(){l._navigateTo(i.COMMUNITY_MEMBERS)}});if(window.ds&&window.ds.swymIM===true){this.addItem({text:e.postsPluralUp,fonticon:"newspaper",name:i.COMMUNITY_BLOG,selectable:true,handler:l._communityPageHandler.bind(l,i.COMMUNITY_BLOG)})}this.addItem({text:e.mediaPluralUp,fonticon:"picture",name:i.COMMUNITY_MEDIA,selectable:true,handler:l._communityPageHandler.bind(l,i.COMMUNITY_MEDIA)});this.addItem({text:e.galleryPluralUp,fonticon:"picture",name:"gallery",handler:function(){l._navigateTo("gallery")}});if(k.ideation_feature){this.addItem({text:e.ideasPluralUp,fonticon:"lamp",name:i.COMMUNITY_IDEAS,selectable:true,handler:l._communityPageHandler.bind(l,i.COMMUNITY_IDEAS)});this.addItem({text:e.ideasPipeline,fonticon:"lamp",name:"pipeline",handler:function(){require(["DS/SwymUIComponents/script/feature/community/idea/view/idea-pipeline-modal"],function(n){var o=i.getInstance().communityId;if(o){l._pipelineModal=new n({communityId:o,widget:l._widget,taggingContextManager:b.getTaggingContextManagerInstance()});l._pipelineModal.show()}})}})}if(k.qna_feature){this.addItem({text:e.questionsPluralUp,fonticon:"help",name:i.COMMUNITY_QUESTIONS,selectable:true,handler:l._communityPageHandler.bind(l,i.COMMUNITY_QUESTIONS)})}if(k.survey_feature){this.addItem({text:e.surveysPluralUp,fonticon:"clipboard",name:i.COMMUNITY_SURVEYS,selectable:true,handler:l._communityPageHandler.bind(l,i.COMMUNITY_SURVEYS)})}if(k.wiki_feature){this.addItem({text:e.wikiUp,fonticon:"book-open",name:i.COMMUNITY_WIKI,selectable:true,handler:l._communityPageHandler.bind(l,i.COMMUNITY_WIKI)})}if(k.settings_feature&&!l.model.get("users")){this.addItem({text:e.Settings,fonticon:"cog",name:i.COMMUNITY_SETTINGS,handler:function(){l._navigateTo(i.COMMUNITY_SETTINGS)}})}if(window.ds&&ds.swymIM===true){this.addItem({text:h.get("Contents"),fonticon:"view-big-tile",name:"whatsnew-content",handler:function(){j.trackPageEvent({category:"SwitchWhatsNewTimeline",label:"switchToWhatsNew",view:"community-contextual-action-menu",event:"click"});this._context.reset({feedMode:i.WHATSNEW_MODE,path:this._context.path})}});this.addItem({text:h.get("Timeline"),fonticon:"comment",name:"timeline-content",handler:function(){j.trackPageEvent({category:"SwitchWhatsNewTimeline",label:"switchToTimeline",view:"community-contextual-action-menu",event:"click"});this._context.reset({feedMode:i.TIMELINE_MODE,path:this._context.path})}})}},_navigateTo:function(k){var l=this._context;l.reset({dmId:l.dmId,communityId:l.communityId,path:(l.dmId?"dm":"community")+":"+l.communityId+"/"+k});b.dispatchEvent("onScrollToTopRequest")},_onSubscribeClick:function(){this.model.getCustomProperty("currentUserSubscribed")?this.model.unsubscribe():this.model.subscribe()},_drawMenu:function(){this._addItems();this._onContextChange();this.updatePosition()},_getDataPromises:function(){var l=this,k=[];k.push(new g(function(m){if(!l.model.hasBeenFetched()){l.model.addEventOnce("onSync",function(){m()})}else{m()}}));if(f.isFeatureActivated("activateSubscribe")&&this.model.getCustomProperty("currentUserSubscribed")===undefined){k.push(new g(function(m){l.model.hasCurrentUserSubscribed({onComplete:m,onFailure:m})}))}return k},onShow:function(){var k=this,l=null;if(!this._contentCreated){l=this._getDataPromises();g.all(l).then(function(){if(k._destroyed!==true){k._drawMenu();k.dispatchEvent("MenuDrawn")}});this._contentCreated=true}else{this.updateItem({id:"subscribe",text:k.model.getCustomProperty("currentUserSubscribed")?h.UnsubscribeToNewContent:h.SubscribeToNewContent});this.updatePosition()}},_hideItem:function(k){if(k){k.elements.container.addClassName("hidden")}},_showItem:function(k){if(k){k.elements.container.removeClassName("hidden")}},_showTopicModal:function(){var k=this.model;require(["DS/SwymUIComponents/script/feature/core/conversation/view/topic-modal"],function(m){var l=new m({model:k});l.inject(document.body).show()})},_enforceMaxItemsBeforeScroll:function(m){var k,l=m.items.filter(function(n){return !n.elements.container.hasClassName("hidden")});l=l.filter(function(n){if(n.elements.container.getStyle("display")==="none"){n.elements.container.addClassName("hidden");return true}});k=this._parent.apply(this,arguments);l.forEach(function(n){n.elements.container.removeClassName("hidden")});return k},updatePosition:function(){var l=this.getOption("target"),k;if(l){k=l.getSize();if(k.width===0&&k.height===0){this.hide();return}}return this._parent.apply(this,arguments)},destroy:function(){this._destroyed=true;this._widget=null;this._shareView=null;this._pipelineModal=null;this._context.removeListener("onFeedModeChange",this._onFeedModeChange);this._context.removeListener("onContextChange",this._onContextChange);return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/community/community/view/community-tile-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/feature/core/context/context-model","i18n!DS/SwymUICore/assets/nls/feature/community/community/model/community-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-detailed-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-become-author-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-tile-view","i18n!DS/SwymUIComponents/assets/nls/feature/core/share/view/share-content-view","DS/UWPClientCode/I18n","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUIComponents/script/feature/community/community/view/community-signup-request-launcher","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/community/view/community-request-become-author-modal-view","DS/UIKIT/DropdownMenu","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UIKIT/Input/Button","DS/UIKIT/Spinner","DS/UIKIT/Scroller","DS/SwymUICore/script/lib/event-manager","DS/SwymUIComponents/script/feature/core/ui-components/community-contextual-action-menu"],function(a,v,b,s,p,j,d,l,m,u,e,q,i,c,w,f,g,o,t,n,k,x,y,h){var z,r={};r[p.Public]="fonticon fonticon-globe";r[p.Private]="fonticon fonticon-lock-open";r[p.Secret]="fonticon fonticon-lock";z=v.extend({_modelClass:b,_modelEvents:{"onSync:setlogo":"refresh","onChange:title":"refresh","onChange:description":"refresh","onChange:owner":"refresh","onChange:access":"refresh"},domEvents:{'click *[data-content-type="person"][data-hash-key]':"_onUserClick","click .community-action-toolbar.my-communities":"_onToolbarClick","click .community-action-toolbar.discover-communities":"_stopPropagate","click .title .fonticon.fonticon-down-open":"_onOpenIconClick"},name:"community-tile-view",className:"swym-tile",isListUsage:false,showActionToolbar:false,_requestToBecomeAuthor:function(){var A=this.addControl("requestBecomeAuthorModal",new g({model:this.model}));A.render(document.body);A.show()},_onUserClick:function(A){A.stopPropagation();A.preventDefault();require(["DS/SwymUICore/script/utils/link-builder-utils"],function(B){B.displayProfile(A)})},_onToolbarClick:function(A){A.stopPropagation();var B=this.getControl("dropdownMenu");if(B){B.show()}},_stopPropagate:function(A){A.stopPropagation()},_onOpenIconClick:function(A){A.stopPropagation()},_follow:function(){this.model.set("isBlacklisted",false);this.refresh();this.model.follow({onComplete:function(){this.alert("success",j.nowfollowing);y.dispatchEvent("requestContentListUpdate",{contextPath:"home"})}.bind(this),onFailure:function(){this.alert("error",j.NowFollowingErrorMsg);this.model.set("isBlacklisted",true);this.refresh()}})},_unfollow:function(){this.model.set("isBlacklisted",true);this.refresh();this.model.unfollow({onComplete:function(){this.alert("success",j.nownotfollowing);y.dispatchEvent("requestContentListUpdate",{contextPath:"home"})}.bind(this),onFailure:function(){this.alert("error",j.NowNotFollowingErrorMsg);this.model.set("isBlacklisted",false);this.refresh()}})},_onLeaveCommunityClicked:function(){var A=this.addControl("removeConfirmationModal",new t({closable:true,renderTo:this._widget.body}));A.confirm({title:j.deletequestion,message:j.removeMyAccessToThisCommunity,callback:function(B){if(B===true){this.model.deletecurrentuserfromcommunity({onComplete:function(){this.alert("success",j.Youhavebeendeletedfromthiscommunity);this.destroy()}.bind(this)})}}.bind(this)})},setup:function(A){var C=this;C._parent(A);var B=s.getInstance();if(A){if(typeof A.isListUsage!=="undefined"){C.isListUsage=A.isListUsage}if(typeof A.showActionToolbar!=="undefined"){C.showActionToolbar=A.showActionToolbar}C._displayAccessors=(typeof A.displayAccessors!=="undefined")?A.displayAccessors:false;C._responsive=(typeof A.responsive!=="undefined"&&A.responsive)?A.responsive:false;if(!C.isListUsage){C.container.addClassName("community-idcard")}}C._context=B;C._context.removeListener("onCommunityChange",C.onCommunityChange);C.onCommunityChange=C.onCommunityChange.bind(C);if(C.isListUsage===false){B.addListener("onCommunityChange",C.onCommunityChange,C,true)}},onCommunityChange:function(A){if(A&&A.communityId){this.setModel(new b({id:A.communityId}))}},_displaySprite:function(){var A=(this.isListUsage===false)?{size:"l"}:{};var B=this.getChildView("communityLogo");if(!B||!B.getInitialModel().equals(this.model)){return this.addChildView("communityLogo",new i({model:this.model,imageRenderingOptions:A}))}else{return B}},_createContent:function(){var E,C=this.model,B=[],D,A;if(!this.elements.fonticonDown){this.elements.fonticonDown=a.createElement("span",{"class":"fonticon fonticon-down-open"})}D=this.elements.fonticonDown;if(!this.elements.fonticonDownDiv){this.elements.fonticonDownDiv=a.createElement("div",{"class":"fonticon fonticon-down-open"})}A=this.elements.fonticonDownDiv;if(C&&C.get("owner")){E=C?C.hasDefaultLogo():null;B=[(!E)?{"class":"logo no-community-rich-tooltip","data-content-type":"community","data-content-id":C.get("mid"),html:this._displaySprite()}:"",{"class":"block-except-logo no-community-rich-tooltip","data-content-type":"community","data-content-id":C.get("mid"),html:[{"class":"title",html:[C.get("title"),!this.showActionToolbar?A:""]},{"class":"subtitle",html:[{tag:"span","class":"visibility",html:[{tag:"span","class":r[C.getVisibility()]},{tag:"span",html:C.getVisibility()+" - "}]},{tag:"a","class":"link","data-content-type":"person","data-hash-key":C.get("owner").hash_key,"data-login":C.get("owner").login,html:C.getMainOwner()?C.getMainOwner().getNickname():""}]},{"class":"description",html:C.get("description",{escapeHTML:false})},((this.isListUsage===false)&&(C.getUserRole()===b.COMMUNITY_CONTRIBUTOR_ROLE))?this.getBecomeAuthorView():"",(this.showActionToolbar===true&&C.get("user_access")!=="0")?{"class":"community-action-toolbar my-communities",html:[(C.get("role")?{"class":"community-role",html:u.replace(j.Im,{spanRoleOpen:'<span class="role">',spanRoleClose:"</span>",role:C.getTranslatedRole()})}:""),{tag:"span","class":"fonticon fonticon-eye "+(this.model.get("isBlacklisted")?"":"isblue")},D]}:{},(this.showActionToolbar===true&&C.get("user_access")==="0"&&w.getInstance().isFeatureActivated("activate_community_join_request"))?{"class":"community-action-toolbar discover-communities",html:this.addControl("join-button",new n({value:j.Join,className:"small",icon:"login",events:{onClick:function(){q.show(this.model)}.bind(this)}}))}:{}]}];if(this.showActionToolbar===true){e.getInstanceFetched(this._buildDropDownMenu(D))}else{this._ctyContextualActionMenu=this.addControl("contextualActionMenu",new h({target:A,widget:this._widget,model:this.model}))}}else{B=a.createElement("div",{styles:{margin:"auto","text-align":"center",height:"40px"},html:new k({className:"msg-animation",visible:true,animate:true,spin:true})})}return B},getBecomeAuthorView:function(){var A=this.getChildView("becomeAuthorView");if(!A){A=this.addChildView("becomeAuthorView",{Class:"DS/SwymUIComponents/script/feature/community/community/view/request-become-author-view"})}return A},destroy:function(){s.getInstance().removeListener("onCommunityChange",this.onCommunityChange);return this._parent.apply(this,arguments)},_buildDropDownMenu:function(C){var B=this.model.get("isBlacklisted"),A=[];if(w.getInstance().isFeatureActivated("active_community_blacklist")){A.push({name:B?"follow":"unfollow",text:B?j.Follow:j.Unfollow,fonticon:"eye"})}if(this.model.get("role")==="Contributor"&&w.getInstance().isFeatureActivated("activate_community_change_role_request")){A.push({name:"becomeAuthor",text:j.BecomeAuthor,fonticon:"user"})}if(this.model.getDeleteRight()===true){A.push({name:"leave",text:j.LeaveCommunity,fonticon:"logout"})}if(A.length>0){this.addControl("dropdownMenu",new o({target:C,renderTo:window.document.body.getElement(".scroll-content"),position:"bottom right",offset:{x:17,y:8},items:A,events:{onClick:function(E,D){switch(D.name){case"leave":this._onLeaveCommunityClicked();break;case"follow":this._follow();break;case"unfollow":this._unfollow();break;case"becomeAuthor":this._requestToBecomeAuthor();break}}.bind(this)}}))}else{C.hide()}}});return z});define("DS/SwymUIComponents/script/feature/core/user/view/member-set-view-v2",["UWA/Core","DS/SwymUICore/script/feature/core/user/collection/user-and-users-group-collection","DS/SwymUIComponents/script/feature/core/user/view/member-set-view","DS/SwymUIComponents/script/feature/core/user/view/add-member-panel-view-v2","DS/SwymUIComponents/script/feature/core/user/view/user-group/user-group-nbmembers-view","DS/WebappsUtils/WebappsUtils"],function(g,b,d,c,f,e){var a=d.extend({name:"member-set-view-v2",defaultOptions:{addMemberPanelViewClass:c},_getItemViewAttributesMapping:function(){var h=this._parent.apply(this,arguments);return g.merge({user_name:function(){if(this.model.getModelName()==="user"){return h.user_name.apply(this,arguments)}return this.model.get("name")},title:function(){var i;if(this.model.getModelName()==="user"){return h.title.apply(this,arguments)}else{if(this.model.getModelName()==="users-group"){i=f.getUserGroupMembersText(this.model);return this.model.get("name")+" ("+i+")"}}return this.model.get("name")},content:function(){if(this.model.getModelName()==="user"){return h.content.apply(this,arguments)}return""},image:function(){if(this.model.getModelName()==="user"){return h.image.apply(this,arguments)}return e.getWebappsBaseUrl()+"SwymUIComponents/assets/s.gif"}},h)}});return a});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/action-bar-view",["UWA/Core","UWA/Utils/Client","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/social-interactions/action-bar-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/post/model/post-model","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/feature/community/iquestion/model/iq-answer-model","DS/SwymUIComponents/script/feature/community/content/view/content-small-view-factory","DS/SwymUIComponents/script/feature/core/ui-components/tooltip/responsive-button-tooltip","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/SwymUICore/script/utils/localstorage-utils","DS/Logger/Logger"],function(a,p,g,b,t,j,l,i,c,n,o,e,h,k,r,q){var m=n.LocalStorageKeyForSort,d=n.DateField,f=n.VoteField,s=b.extend({_modelClass:[t,j,l,i,n,c],name:"action-bar-view",defaultOptions:{enableLike:true,enableShare:true},_modelEventsForAutoRefresh:["onChange:current_user_endorse","onChange:nb_answers","onChange:nb_comments"],domEvents:{"click .comments > button":"_focusComment","click .share":"_share","click .answer-sort":"_onAnswerSortClick"},setup:function(u){var v=u.widget||u._widget||window.widget;if(v){this._widget=v}else{throw new Error("No widget instance provided")}this._parent.apply(this,arguments)},_onAnswerSortClick:function(u){this._buildDropDownMenu(u.target)},_buildDropDownMenu:function(v){var w,u=this.getControl("answerSortDropDownMenu");if(!u){w=r.getItem(m);u=this.addControl("answerSortDropDownMenu",new k({target:v.getParent(),bound:true,renderTo:window.document.body.getElement(".scroll-content"),items:[{name:"date",text:g.ByDate,selected:(w!==f),selectable:true},{name:"vote",text:g.ByVote,selected:(w===f),selectable:true}],events:{onClick:function(z,y){try{switch(y.name){case"date":this.changeSortingField(d);break;case"vote":this.changeSortingField(f);break}}catch(x){q.error("Could not save sort field to local storage",x)}}.bind(this)}}))}u.show()},_share:function(){var u=this.model,v=this._widget;require(["DS/SwymUIComponents/script/feature/core/share/view/share-content-view"],function(w){(new w({model:u,widget:v})).launchModal()})},_focusComment:function(){this.dispatchEvent("onCommentCreatorFocusRequest")},_createContent:function(){var y,w=this.model,x=(w.get("current_user_endorse")===true),v=g.Answer,u=this.addControl("commentButton",new h({value:v,icon:"comment"}));y=r.getItem(m)||d;if(!p.Features.touchEvents){this.addControl("commentButtonTooltip",new e({target:u.getContent(),position:"bottom",body:v,offset:{x:0,y:5}}))}this.removeControl("answerSortDropDownMenu");return[{html:[(this.options.enableLike?{html:[this.addControl("likeButton",new h({value:g.Like,icon:"thumbs-up",active:Boolean(x)})),{html:(this.addChildView("nbEndorsementsNextGen",{Class:o.getViewClass("nbEndorsementsNextGen"),model:w})),tag:"span"}],"class":"endorse"}:""),u,{html:(this.getChildView("nbAnswersNextGen")||this.addChildView("nbAnswersNextGen",{Class:o.getViewClass("nbAnswersNextGen"),model:w})),tag:"span"},(w.getModelName()==="iquestion")?{tag:"span","class":"answer-sort "+y,html:[{html:g.SortedbyVote,tag:"span","class":"answer-sort-text "+f},{html:g.SortedbyDate,tag:"span","class":"answer-sort-text "+d},{tag:"span","class":"fonticon fonticon-open-down answer-sort-dropdown"}]}:""],"class":"comments"},(this.options.enableShare?{html:this.addControl("shareButton",new h({value:g.Share,icon:"forward"})),"class":"share"}:"")]},changeSortingField:function(v){var u;r.setItem(m,v);u=this.getElement(".answer-sort");if(v===d){u.removeClassName(f)}else{if(v===f){u.removeClassName(d)}}u.addClassName(v);this.dispatchEvent("sortAnswersRequest",[v])}});return s});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/counter-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/social-interactions/action-bar-view"],function(c,b){var a=b.extend({name:"counter-view",_modelEventsForAutoRefresh:["onChange:nb_views"],domEvents:null,_createContent:function(){var d=this.model,e=parseInt(d.get("nb_views"),10);return{html:[{tag:"span","class":"fonticon fonticon-eye"},{html:(e>0)?e+"":"0",tag:"span","class":"counter"}],"class":"views"}}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/media-view",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view","DS/SwymUICore/script/utils/utils"],function(e,b,c,d){var a=c.extend({_modelClass:b,name:"media-view",defaultOptions:{iconCls:"picture",summaryViewClass:"DS/SwymUIComponents/script/feature/community/media/view/media-summary-view",detailedViewClass:"DS/SwymUIComponents/script/feature/community/media/view/media-detailed-view",editViewClass:"DS/SwymUIComponents/script/feature/community/media/edit/media-edit-view"},setup:function(){var f=d.getMediaIconName(this.model);this.setOption("iconCls",f);return this._parent.apply(this,arguments)}});return a});define("DS/SwymUIComponents/script/feature/community/media/edit/thumbnail/smart-media-edition-thumbnail-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/media/edit/thumbnail/upload-progress-media-thumbnail-view","DS/SwymUIComponents/script/feature/community/media/edit/thumbnail/content-edition-media-thumbnail-view"],function(f,e,b,d,a){var c=e.extend({_modelClass:b,name:"smart-media-edition-thumbnail-view",_modelEventsForAutoRefresh:["onRequest:create","onRequest:update","onRequest:patch","onSync:create","onSync:update","onSync:patch"],_uploadStatus:null,defaultOptions:{uploadViewClass:d,displayViewClass:a},_getUploadView:function(){var g=this.getChildView("upload");if(!g){g=this.addChildView("upload",{model:this.model,Class:this.getOption("uploadViewClass"),modelName:this.model.getModelName(),events:{onRemoveRequest:function(){this.dispatchEvent("onRemoveRequest",arguments)}.bind(this)}})}return g},_getDisplayView:function(){var g=this.getChildView("display");if(!g){g=this.addChildView("display",{model:this.model,Class:this.getOption("displayViewClass"),modelName:this.model.getModelName(),uploadStatus:this._uploadStatus,events:{onRemoveRequest:function(){this.dispatchEvent("onRemoveRequest",arguments)}.bind(this)}})}return g},_createContent:function(){var h,g=this.model;if(g.isUploading()||g.isNew()){h=this._getUploadView();if(g.isUploading()){this._uploadStatus="uploading"}else{if(g.isNew()){this._uploadStatus="toBeUploaded"}}}else{if(this._uploadStatus==="uploading"){this._uploadStatus="justUploaded"}h=this._getDisplayView()}return h}});return c});define("DS/SwymUIComponents/script/feature/community/content/edit/content-edition-media-view",["UWA/Core","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUIComponents/script/feature/community/media/edit/thumbnail/smart-media-edition-thumbnail-view","DS/SwymUIComponents/script/feature/community/content/utils/content-media-renderer","DS/SwymUIComponents/script/feature/community/media/edit/upload/upload-manager","DS/SwymUICore/script/lib/collection/generic/swym-collection","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/media/edit/upload/drag-and-drop-upload-view","DS/SwymUIComponents/script/feature/community/media/edit/upload/copy-paste-upload-view","DS/SwymUIComponents/script/feature/community/media/edit/upload/media-upload-queue","DS/SwymUICore/script/feature/core/sprite/sprite","DS/Logger/Logger","DS/SwymUIComponents/script/utils/content-upload-error","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/content-creation-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/upload-manager-view"],function(a,l,n,g,q,c,d,b,p,m,e,i,r,t,f,h){var k="320",j="520",o=function(u){return u.isUploading()},s=n.extend({name:"content-edition-media-view",modelViewClass:g,mediaUploadQueue:null,_collectionEvents:{onRemove:"_onRemove","onSync:create":"onModelUploadComplete","onError:create":"onModelUploadFailure"},_collectionEventsForAutoRefresh:["onReset","onRemove","onSort"],_collectionClass:d,_simpleContent:null,_communityId:null,_uploadManager:null,_mediaRenderer:null,_context:null,defaultOptions:{uploadManagerClass:c,contentAttributeInModel:"content",allowDragNDrop:true,dragZoneSelector:".content-edition",parentModelAssociation:null,contentModel:null},modelViewsCfg:function(){return{events:{onRemoveRequest:function(){this.removeThumbnail.apply(this,arguments)}.bind(this)}}},_onCommunityChange:function(){if(!this.isDestroyed()){if(this._context.isCommunityContext()){this._communityId=this._context.getData().communityId}else{this._communityId=null}}},imageReloadOptions:{size:"m",imageKind:"thumb"},getMediaUploadQueue:function(){return this.mediaUploadQueue},setup:function(y){var A,x,w,v,u;A=this.getOption("uploadManagerClass");this._uploadManager=new A({view:this,model:this.model});this.listenTo(this._uploadManager,"onUpload",this._receivedFilesFromUploadManager);this.listenTo(this._uploadManager,"onProxyFailed",this._proxyFailed);this.listenTo(this._uploadManager,"on3DDriveMediaSelected",this._on3DDriveMediaSelected);this.mediaUploadQueue=e();this._context=l.getInstance();this._context.addListener("onCommunityChange",this._onCommunityChange,this);this._addCopyPasteUploader();if(y.contentModel){this._simpleContent=y.contentModel;if(this._simpleContent.getModelName().contains("comment")||this._simpleContent.getModelName()==="iq-answer"){u=this._simpleContent.getAssociated(this.getOption("parentModelAssociation"));if(u.getModelName()==="iq-answer"){var z=u.getAssociated("answeredFor");v=z.getCommunity()}else{v=u.getCommunity()}}else{v=this._simpleContent.getCommunity()}this._communityId=v.get("mid")||v.id;delete y.contentModel}else{if(this._context.isCommunityContext()){this._communityId=this._context.getData().communityId}else{if(y.communityId){this._communityId=y.communityId;delete y.communityId}}}if(this._simpleContent){this._mediaRenderer=q.getInstance();w=this._mediaRenderer.process(this._simpleContent.getChanges(this.getOption("contentAttributeInModel"))||this._simpleContent.get(this.getOption("contentAttributeInModel")),{createMediaView:false,toReturn:{mediaCollection:true}});x=w&&w.mediaCollection}if(x&&(x.length>0)){this.setCollection(x)}else{this.setCollection(new d())}this._parent.apply(this,arguments)},setCommunityId:function(u){this._communityId=u},_on3DDriveMediaSelected:function(v){var w=true,x,u,y;this._uploadManager.populateMediaFileExtension(function(){for(var A=0,z=v.length;A<z;A++){x=v[A];u=x.get("title"),y=u?u.split("."):[];if(y.length===1||!this._uploadManager._getType(y[y.length-1])){w=false;break}}if(v.length>0&&w){this.addNMediaModels(v);this._dispatchMediaEvent(v)}else{if(!w){this.alert("error",h.replace(h.get("FileTypeError"),{FileName:x.get("displayType")}))}}}.bind(this))},_receivedFilesFromUploadManager:function(A){var y,z,v,u,x=[],w=A?A.length:0;r.log("_receivedFilesFromUploadManager",A);for(y=0;y<w;y++){v=A[y];u={is_illustration:(this.getOption("contentAttributeInModel")!=="media")};if(this._communityId){u.community_id=this._communityId}z=new b({});z.addChanges(a.extend(u,v.attributes));x.push(z)}this.addNMediaModels(x);if(x.length>0){this._dispatchMediaEvent(x)}},_proxyFailed:function(u){this.dispatchEvent("onCopyPaste",[u])},_dispatchMediaEvent:function(u){var x=u[0].get("userFile")||u[0].getChanges("userFile"),w=x&&x.info&&x.info.mediaPastedId,v=w?"onCopyPaste":"onDragAndDrop";this.dispatchEvent(v,[u])},_uploadMediaViaQueue:function(v){var u,w=this;v=v||{};u=v.mediaToBeUploaded||[];if(u.length>0){this.dispatchEvent("onMediaUploadsStart");this.mediaUploadQueue({mediaToBeUploaded:u,onUploadsComplete:function(){v.onUploadsComplete&&v.onUploadsComplete({mediaMarkup:w.getHTMLToBeSaved()})},onUploadsFailure:function(x){v.onUploadsFailure&&v.onUploadsFailure(x)},wait:true})}else{v.onUploadsComplete&&v.onUploadsComplete()}},addNMediaModels:function(y){var w,u,x,v=[];if(Array.isArray(y)&&(y.length>0)){this.collection.add(y);this._appendNewModelView.apply(this,arguments);this.dispatchEvent("onMediaCollectionChange",[this.collection]);if(this._communityId){for(w=0,u=y.length;w<u;w++){x=y[w];if(x.isNew()){x.set("community_id",this._communityId);v.push(x)}}this._uploadMediaViaQueue({mediaToBeUploaded:v,onUploadsFailure:function(z){r.log("onUploadsFailure");t.printErrorMessage(z,"media")}});this.dispatchEvent("newMediaAdded")}}},getCollectionLength:function(){var u=0;if(this.collection){u=this.collection.length}return u},getCollection:function(){return this.collection},_addCopyPasteUploader:function(){var v=this.getChildView("copyPaste"),u;if(!v){u=this.addChildView("copyPaste",{Class:m,events:{onMediaUploadsStart:function(){this.dispatchEvent("onMediaUploadsStart",[true])}.bind(this),onMediaUploadsComplete:function(){this.dispatchEvent("onMediaUploadsComplete")}.bind(this),onMediaUploadsFailure:function(){this.dispatchEvent("onMediaUploadsFailure")}.bind(this)}});this.addUploader("copyPaste",u)}},_getDndView:function(){var u=this.getChildView("dnd");if(!u&&(this.getOption("allowDragNDrop")===true)){u=this.addChildView("dnd",{Class:p});this._uploadManager.addUploader("dnd",u)}return u},getDndView:function(){return this._getDndView()},addUploader:function(u,v){this._uploadManager.addUploader(u,v)},getUploader:function(u){return this._uploadManager.getUploader(u)},_onRemove:function(){this.dispatchEvent("onMediaCollectionChange",[this.collection])},_appendNewModelView:function(v){var u;if((!this._body)||!(this.container.contains(this._body))){this.refresh()}else{u=this;v&&v.forEach(function(w){var x=u._createAndAddModelView(w);u._modelViewsKeys.push(u.MODEL_VIEWS_INDEX_PREFIX+x.cid);x.render({target:u._body,position:"bottom"})})}},_createContent:function(){var v,w,u=this._getDndView();w=this._parent.apply(this,arguments);v=[w,u];return v},onInjected:function(){if((this.getOption("allowDragNDrop")===true)&&(this.getOption("dragZoneSelector"))){this._getDndView().addDragDetectionZone(this.container.getClosest(this.getOption("dragZoneSelector")))}},getHTMLToBeSaved:function(){var x,D,B,H,E,G,A="",C,w,v,u,F,z,y=this.getOption("isMediaForSimpleContent")===true;for(x=0,D=this.collection.length;x<D;x++){B=this.collection.at(x);H=B.getCommunity();G=H.isDirectMessage();E=H.get("mid")||H.id;if(E){if(G){v='data-dm-id="'+E+'"'}else{v=' data-community-id="'+E+'"'}}else{v=""}if(B.get("mid")){w=' data-media-id="'+B.get("mid")+'"'}else{w=' data-new_media="true"'}w+=(' data-media_cid="'+B.cid+'"');u=(D===1&&y)?"large":"small";F=(D===1&&y)?"center":"left";C=(B.get("media_file_ext")==="pdf"||B.get("userFile")&&B.get("userFile").type==="application/pdf"||(B.get("orig_name")&&B.get("orig_name").match(/.pdf$/gi)))?"pdf":"";z=(D===1&&y)?j:k;A+=('<img data-source="swym" '+v+w+" data-position="+F+" data-size="+u+' data-media-type="'+B.get("media_type")+(C!==""?('" data-file-extension="'+C):"")+'" style="width:'+(B.get("width")||z)+"px;"+(B.get("height")?("height:"+B.get("height")+"px"):"")+'">')}return A},reset:function(){if(this.collection.length>0){this.setCollection(new d())}this.mediaUploadQueue=e()},removeThumbnail:function(u){if(u){this.collection.remove(u);if(u.isNew()){u.dispatchEvent("removeFromUploadQueue",[u])}this.dispatchEvent("onThumbnailRemoval",[u])}},onModelUploadComplete:function(){var u=this.collection.filter(o);if(u.length===0){this.dispatchEvent("onMediaUploadsComplete");r.log("Uploads complete")}else{r.log("still uploading....")}},onModelUploadFailure:function(u){this.dispatchEvent("onMediaUploadsFailure",[u])},uploadAllMediaInCommunity:function(u){var u=u||{},v=this,w=(u.communityId)||this._communityId,x=u.onUploadsFailure;if(!w){x&&x();r.error("No community found to upload media in")}else{u.mediaToBeUploaded=this.collection.filter(function(A){var y=A.isNew(),z=A.hasVirtuallyChanged();if(y&&!v._communityId){A.set("community_id",w)}return(y||z)});this._uploadMediaViaQueue(u)}},destroy:function(){this._onCommunityChange&&this._context.removeListener("onCommunityChange",this._onCommunityChange,this);this._parent.apply(this,arguments)}});return s});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-edition-media-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/content-edition-media-view","DS/SwymUIComponents/script/utils/content-upload-error","DS/Logger/Logger"],function(e,d,a,c){var b=d.extend({name:"comment-edition-media-view",onMediaUploadsFailure:function(g,f){a.printErrorMessage(f,"media")},addNMediaModels:function(g){var j;for(var h=0,f=g.length;h<f;h++){j=g[h];j.addChanges("published","1")}this._parent.apply(this,arguments)}});return b});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/social-toolbar-view",["UWA/Core","UWA/Class/Events","UWA/Promise","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/community/content/social-interactions/social-features-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-edition-media-view","DS/SwymUICore/script/feature/community/comment/model/comment-model","DS/SwymUICore/script/utils/usage-tracker","DS/WebappsUtils/WebappsUtils"],function(a,n,f,d,e,q,p,b,m,o,g){var k=null,r=false,h=false,i=p.getInstance(),l=e.getInstance();var c=n.singleton({});function j(){h=true;require(["DS/SocialToolbar/SocialToolbar","DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-st-sprite","DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-comment-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-interactor-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-comment-editor-view"],function(u,v,t,w){k=u;r=true;h=false;c.dispatchEvent("onSocialToolbarPatch")})}var s=q.extend({_modelEvents:{"onChange:subject6wuri":"refresh","onChange:status_id":"onModelStatusIdChange","onChange:out":"onOutStatusChange"},_lastSubjectUri:"",name:"social-toolbar-view",defaultOptions:{actionBar:false,comments:false,socialToolbarMode:"normal",enableShare:null,enableComment:true,enableLike:true,commentsNumberAtInit:2,showCommentsSummaryFirst:true,sendCommentsInitCallInPool:false,commentButtonClickEventIsOverrided:false,socialToolbarExtraOptions:{commentModelClass:m,commentTextAttribute:"comment",contentAttributeInModel:"comment",commentAdditionEvent:"addComment",commentAssociationToParentModel:"commented",mediaEditionViewClass:b,dragZoneSelector:".st-comment-editor"}},init:function(){this._recreateSocialToolbarOnNavigationRequest=this._recreateSocialToolbarOnNavigationRequest.bind(this);return this._parent.apply(this,arguments)},setup:function(t){if(t){t.actionBar=false;t.comments=false;this.setOptions(t)}return this._parent.apply(this,arguments)},_createContent:function(){if(!this.elements.wrapper){this.elements.wrapper=a.createElement("div",{"class":"social-toolbar-wrapper"})}return this.elements.wrapper},_share:function(){var t=this.model,u=this._widget;require(["DS/SwymUIComponents/script/feature/core/share/view/share-content-view"],function(v){(new v({model:t,widget:u})).launchModal()});o.trackPageEvent({category:"SocialToolbar",label:"share",view:"social-toolbar-view",event:"click",contentType:this.model.getModelName()})},_recreateSocialToolbarOnNavigationRequest:function(){if(this.model&&l.contentId&&(l.commentUri&&l.commentUri.indexOf(this.model.get("subject6wuri"))>=0)&&this.isVisible()&&this.getControl("socialToolbar")){this._createSocialToolbar()}},onAnnotationShared:function(u){var t=this.getControl("socialToolbar");if(t&&u&&u.annotation){t.setActiveFieldContent({media:[u.annotation],replace:false})}},_createSocialToolbar:function(u){var t,x,w,v;if(this.isVisible()){v=this.model&&this.model.get("subject6wuri");if(this.model&&this.model.get("model_uri")){v=this.model.get("model_uri")}if(this.elements&&this.elements.wrapper&&v&&((this._lastSubjectUri!==v)||(u&&u.force===true))){x=this;w=d.getBaseUrl();require(["DS/SwymUIComponents/script/lib/ckeditor/ckeditor"],function(y){if(!x.isDestroyed()){x._lastSubjectUri=v;t=i.get("user");x.addControl("socialToolbar",new k({sendInitCallInPool:x.options.sendCommentsInitCallInPool,tenantId:i.get("config").tenant.online_instance_id,"3DSwymURL":w,"3DSwymServerToken":i.getCSRFToken(),userLogin:t.login,userName:(t.first_name+" "+t.last_name),serviceURL:i.get("3dcommentUrl")||w,mode:x.options.socialToolbarMode,subjectURI:v,commentsNumberAtInit:x.options.commentsNumberAtInit,enableShare:(a.is(x.getOption("enableShare"),"boolean")?x.getOption("enableShare"):i.isFeatureActivated("activate_share")),enableComment:x.getOption("enableComment"),enableLike:x.getOption("enableLike"),enableCommentLike:d.isFeatureActivated("activateCommentsLike"),showUserProfile:function(z){require(["DS/SwymUICore/script/utils/navigation"],function(A){A.goToProfile({login:z})})},commentButtonClickEventIsOverrided:x.getOption("commentButtonClickEventIsOverrided"),enableUpload:true,RTEConfig:y.getNewCommentEditorConfig(),showCommentsSummaryFirst:x.getOption("showCommentsSummaryFirst"),sendInitCallEvenIfSubjectIsInCache:(u&&u.force===true),commentToScrollToAtInit:(l.commentUri&&l.commentUri.indexOf(v)>=0)?{commentUri:l.replyUri||l.commentUri,parentCommentUri:l.replyUri&&l.commentUri}:null,events:{onShareRequest:x._share.bind(x),onMediaClick:function(z){if(z&&(z.type==="annotation")){x.dispatchEvent("onLoadAnnotationRequest",z)}},onBeforeRender:function(){if(this.model){this.model.getSharedOptions().setOptions({swymOptions:a.merge({model:x.model,widget:this._widget||window.widget},x.getOption("socialToolbarExtraOptions"))})}else{console.error("Failed to initialize Social toolbar instance")}},onRender:function(){var z=this.model;this.dispatchEvent("onCommentCountChange",[z.getCommentsTotalCount()]);this.listenTo(z,"onChange:"+z.COMMENTS_COUNT_ATTRIBUTE,function(A,B){this.dispatchEvent("onCommentCountChange",[B])});this.dispatchEvent("onEndorsementCountChange",[z.getEndorsementsTotalCount()]);this.listenTo(z,"onChange:"+z.ENDORSEMENT_COUNT_ATTRIBUTE,function(A,B){this.dispatchEvent("onEndorsementCountChange",[B])})},onCommentCountChange:function(z){if(z>0){x.container.addClassName("is-already-commented")}else{x.container.removeClassName("is-already-commented")}},onEndorsementCountChange:function(z){if(z>0){x.container.addClassName("is-already-endorsed")}else{x.container.removeClassName("is-already-endorsed")}},onEndorseButtonClick:function(){var z=this.model.getEndorsementsTotalCount();if(z){o.trackPageEvent({category:"SocialToolbar",label:"like",view:"social-toolbar-view",event:"click",contentType:x.model.getModelName()})}else{o.trackPageEvent({category:"SocialToolbar",label:"unlike",view:"social-toolbar-view",event:"click",contentType:x.model.getModelName()})}},onCommentButtonClick:function(){if(x._onCommentButtonClick){x._onCommentButtonClick()}o.trackPageEvent({category:"SocialToolbar",label:x.model.getModelName()==="instant-message"?"reply":"comment",view:"social-toolbar-view",event:"click",contentType:x.model.getModelName()})}}})).inject(x.elements.wrapper,"bottom");l.addListener("onContextChange",x._recreateSocialToolbarOnNavigationRequest,x,false)}})}}else{this.addEventOnce("onShow",this._createSocialToolbar,this)}},onRedraw:function(){var t=this;if(a.is(this.model.getCommunity,"function")&&!this.model.isNew()){if(!r){c.addEventOnce("onSocialToolbarPatch",function(){t._createSocialToolbar()});if(!h){j()}}else{this._createSocialToolbar()}}},onModelStatusIdChange:function(){if(this.getControl("socialToolbar")&&this.model&&this.model.getModelName()==="idea"){this._createSocialToolbar({force:true})}},onOutStatusChange:function(){if(this.getControl("socialToolbar")&&this.model&&this.model.getModelName()==="idea"){this._createSocialToolbar({force:true})}},onDestroy:function(){l.removeListener("onContextChange",this._recreateSocialToolbarOnNavigationRequest);return this._parent.apply(this,arguments)}});return s});define("DS/SwymUIComponents/script/feature/community/idea/idea-view",["UWA/Core","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view"],function(d,b,c){var a=c.extend({_modelClass:b,name:"idea-view",defaultOptions:{iconCls:"lamp",summaryViewClass:"DS/SwymUIComponents/script/feature/community/idea/view/idea-summary-view",detailedViewClass:"DS/SwymUIComponents/script/feature/community/idea/view/idea-detailed-view",editViewClass:"DS/SwymUIComponents/script/feature/community/idea/edit/idea-edit-view"}});return a});define("DS/SwymUIComponents/script/feature/community/wiki/view/wiki-access-editor-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/view/wiki-properties-editor-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/UIKIT/Input/Select","DS/UIKIT/Tooltip","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory"],function(g,c,f,e,h,b,d){var a=f.extend({name:"wiki-access-editor-view",_modelEventsForAutoRefresh:["onSync:update"],domEvents:{"change .wiki-editing-editor-combo":"onWikiEditingChange","change .wiki-access-editor-combo":"onWikiVisibilityChange"},privateUserToAdd:[],privateUserToRemove:[],_communityModel:null,_wikiData:{},_onSelectUser:function(l){var m,o=this,n=o.getControl("user-search-control"),k=true,q,j,p;if(o.model){q=o.model.getAssociated("authorizedusers");p=q.findWhere({hash_key:l.hash_key});k=!g.is(p)}if(!k){j=[];for(m=0;m<o.privateUserToRemove.length;m++){if(o.privateUserToRemove[m]!==l.hash_key){j.push(o.privateUserToRemove[m])}else{k=true}}if(o.privateUserToRemove.length!==j.length){o.privateUserToRemove=j;o._addWikiChanges("users_to_remove",o.privateUserToRemove)}if(!k){o.alert("info",c.Thisuseralreadyhasaccesstothispage);n.toggleSelect(n.selectedItems.find(function(i){return i.hash_key===l.hash_key}),null,false)}}else{for(m=0;m<o.privateUserToAdd.length;m++){if(o.privateUserToAdd[m]===l.hash_key){k=false}}if(k===true&&l.hash_key){o.privateUserToAdd.push(l.hash_key);o._addWikiChanges("users_to_add",o.privateUserToAdd);j=[];for(m=0;m<o.privateUserToRemove.length;m++){if(o.privateUserToRemove[m]!=l.hash_key){j.push(o.privateUserToRemove[m])}}o.privateUserToRemove=j;o._addWikiChanges("users_to_remove",o.privateUserToRemove);n.resetInput()}else{console.log("User already in the users to add list")}}},_onUnselectUser:function(l){var n=this,o,p,k=l.hash_key||l.value;if(n.model){p=n.model.getAssociated("authorizedusers");o=p.findWhere({hash_key:l.hash_key})}var j=[];for(var m=0;m<n.privateUserToAdd.length;m++){if(n.privateUserToAdd[m]!==k){j.push(n.privateUserToAdd[m])}}if(n.privateUserToAdd.length!==j.length){n.privateUserToAdd=j;n._addWikiChanges("users_to_add",n.privateUserToAdd)}else{if(!o||(o&&o.get("is_admin")===false)){n.privateUserToRemove.push(k);n._addWikiChanges("users_to_remove",n.privateUserToRemove)}}},_createContent:function(){var m=this,k=m.model,o=g.createElement("span",{"class":"fonticon fonticon-help"}),l=g.createElement("span",{"class":"fonticon fonticon-help"}),j;if(k){m._communityModel=k.getCommunity()}if(m._communityModel&&(parseInt(m._communityModel.get("user_access"),10)>=3||parseInt(m._communityModel.getUserRole(),10)>=3)){m.privateUserToAdd=[];m.privateUserToRemove=[];var n=false;if(!k){n=true}else{if(k&&parseInt(k.get("visibility"),10)===1){n=true}else{if(m._wikiData&&parseInt(m._wikiData.visibility,10)===1){n=true}}}j=m.addControl("user-search-control",d.createUserSearchControl({multiSelect:true,community_id:(m._communityModel?m._communityModel.get("mid"):null),disabled:n,events:{onSelect:function(p){this._onSelectUser(p)}.bind(m),onUnselect:function(p){this._onUnselectUser(p)}.bind(m)}}));if(k&&parseInt(k.get("visibility"),10)!==1){k.getAssociated("authorizedusers").fetch({data:{community_id:m._communityModel.get("mid")},onComplete:function(p){var q=[];p.forEach(function(r){if(r.get("is_admin")!==true){q.push({value:r.get("hash_key"),label:r.get("nickname"),selected:true})}});if(q.length>0){m.getControl("user-search-control").reset();m.getControl("user-search-control").addItems(q,m.getControl("user-search-control").getDataset(0))}}})}m.addControl("helpEditingIconTooltip",new b({target:o,body:c.PageEditingTooltip}));m.addControl("helpAccessIconTooltip",new b({target:l,body:c.NotePrivatewillseteverysubpageofthispageasprivate+"</br>"+c.Forprivatewikipages}));var i=k&&(k.get("locked")==="1"||k.get("locked")===true||k.get("locked")===1);this.dispatchEvent("displayAccessIcon",true);return[{"class":"properties",html:[{"class":"access-row",html:[{"class":"access-label",html:[c.Pageediting,o]},m.addControl("editingSelect",new h({placeholder:false,className:"wiki-editing-editor-combo",options:[{selected:i?false:true,label:c.Enablepageediting,value:"1"},{selected:i?true:false,label:c.Disablepageediting,value:"2"},{label:c.Enablepageandsubpagesediting,value:"3"},{label:c.Disablepageandsubpagesediting,value:"4"}]}))]},(!k||(k&&k.get("is_root"))!==true?{"class":"access-row",html:[{"class":"access-label",html:[c.Pageaccess,l]},m.addControl("accessSelect",new h({placeholder:false,className:"wiki-access-editor-combo",disabled:(k&&parseInt(k.get("visibility"),10)===0?true:false),options:[{selected:(!k||(k&&parseInt(k.get("visibility"),10)===1))?true:false,label:c.Public,value:"1"},{selected:(k&&parseInt(k.get("visibility"),10)!==1)?true:false,label:c.Private,value:"2"}]})),j]}:null)]}]}this.dispatchEvent("displayAccessIcon",false);return""},_addWikiChanges:function(l,k){var j=this,i=j.model;if(i){i.addChanges(l,k)}else{j._wikiData[l]=k}j.dispatchEvent("onContentChange")},_removeWikiChanges:function(l,k){var j=this,i=j.model;if(i){i.removeChanges(l)}else{if(g.is(j._wikiData[l])){delete j._wikiData[l]}}},getWikiData:function(){var j=this,i=j.model;if(i){return i.getChanges()}else{return j._wikiData}},getCommunityId:function(){return this._communityModel&&this._communityModel.get("mid")},setCommunityId:function(j){var i=this;if(!i.model&&j&&j!==""&&(!i._communityModel||(i._communityModel&&i._communityModel.get("mid")!==j))){i._communityModel=new e({id:j},{autoPopulate:true});i.refresh()}},resetEditorViews:function(){if(!this.model){this._wikiData={}}this.refresh()},onWikiEditingChange:function(j){var i=this;switch(j.target.value){case"1":i._addWikiChanges("locked","0");i._removeWikiChanges("lockedAll");break;case"3":i._addWikiChanges("locked","0");i._addWikiChanges("lockedAll",true);break;case"2":i._addWikiChanges("locked","1");i._removeWikiChanges("lockedAll");break;case"4":i._addWikiChanges("locked","1");i._addWikiChanges("lockedAll",true);break}},onWikiVisibilityChange:function(j){var i=this;i._addWikiChanges("visibility",j.target.value);i.getControl("user-search-control").setDisabled(j.target.value!=="2")}});return a});define("DS/SwymUIComponents/script/feature/community/survey/view/answer-collection-view",["DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/survey/collection/answer-collection","DS/SwymUIComponents/script/feature/community/survey/view/answer-view"],function(c,d,b){var a=c.extend({_collectionClass:d,modelViewClass:b});return a});define("DS/SwymUIComponents/script/feature/community/wiki/view/private-user-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/view/private-user-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UWPClientCode/I18n"],function(g,e,f,c,a,d){var b=f.extend({model:null,_el:null,_confirmModal:null,mode:"view",_createContent:function(){var i=this.model;if(i){this._confirmModal=new a({closable:false,renderTo:this._widget.body});userPic=this.addChildView("userPicture",{Class:c,model:i,imageRenderingOptions:{format:"mini"}});var j=[{styles:{"float":"left",margin:"10px",padding:"10px",border:"2px solid #D8D8D8",width:"200px","max-height":"55px",overflow:"hidden"},html:{styles:{width:"100%"},tag:"table",html:{tag:"tr",html:[{tag:"td",styles:{"vertical-align":"top"},html:{styles:{"margin-right":"10px"},html:userPic}},{styles:{"vertical-align":"top"},tag:"td",html:i.get("nickname")},(i.get("is_admin")!=true?{tag:"td",styles:{"vertical-align":"top"},html:'<div class="delete-icon" style="cursor: pointer; padding: 7px 0 0 10px; float:right;">X</div>'}:"")]}}}];var h=g.createElement("div",{html:userPic});return j}},bindEvents:function(){var h=this.container.getElement(".delete-icon");if(h){h.addEvent("click",function(){this._confirmModal.confirm(d.replace(e.Areyousure,{nickname:this.model.get("nickname")}),e.Confirm,function(i){if(i==true){this.dispatchEvent("privateUserRemoved",this.model)}}.bind(this))}.bind(this))}}});return b});define("DS/SwymUIComponents/script/feature/community/wiki/view/private-users-collection-view",["DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/SwymUIComponents/script/feature/community/wiki/view/private-user-view"],function(d,b,c){var a=d.extend({_collectionClass:b,modelViewClass:c,_createModelView:function(){var e=this._parent.apply(this,arguments);e.addEvent("privateUserRemoved",function(f){this.dispatchEvent("privateUserRemoved",f)},this);return e}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/skill/user-skill-edit-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/user/view/components/user-stars-edit-view","DS/SwymUICore/script/feature/core/skill/model/skill-model","DS/UIKIT/Form","DS/WebappsUtils/Console","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/components/user-stars-edit-view"],function(g,f,e,c,b,d){var a=f.extend({_modelClass:e,name:"user-skill-edit-view",_createContent:function(){var h=this.model,i=this.addControl("form-box-view",new c({fields:[{type:"text",label:d.Skill,value:h.get("title",{escapeHTML:false}),required:true,events:{onChange:function(){h.addChanges("title",this.getValue())}}},this._createContentInputStars(),{type:"textarea",multiline:true,rows:4,label:d.Details,value:h.get("description",{escapeHTML:false}),name:"details",events:{onChange:function(){h.addChanges("description",this.getValue())}}}]}));return i}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/skill/user-skill-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/skill/user-skill-view","DS/SwymUICore/script/feature/core/skill/model/skill-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/ui-components/edit-view-mode-switcher/edit-view-mode-switcher","DS/SwymUIComponents/script/feature/core/ui-components/box-view/box-view","DS/SwymUIComponents/script/feature/core/user/view/skill/user-skill-edit-view","DS/SwymUIComponents/script/feature/core/modal/super-modal"],function(i,d,f,g,b,e,h,a){var c=g.extend({_modelClass:f,name:"skill-view",_createContent:function(){var k=new e({model:this.model,widget:this._widget}),j=new h({model:this.model,widget:this._widget,_labelNameInput:"nls to be added"});return this.addChildView("edition-switch",{Class:b,model:this.model,editView:j,readView:k,actionOnSave:function(m){var n=this.getChildView("edition-switch").getChildView("editview").getControl("form-box-view"),o=n.validate(),l=this.model.isNew();if(m===true){return o}if(o){this.model.save({},{onComplete:function(r,p){var s=l?d.skillCreated:d.skillUpdated;this.alert("success",s);r.set(r.getChanges());var q=this.getChildView("edition-switch");if(q){q.setMode("read")}}.bind(this),onFailure:function(q,p){if(p.errorcode==="IllegalArgumentException"){this.alert("error",d.skillDuplicate);this.destroy()}console.log("error")}.bind(this)})}else{this.alert("error",d.pleaseFillTheFieldsCorrectly);return o}}.bind(this),actionOnDestroy:function(){var l=new a({closable:true,renderTo:this._widget.body});l.confirm(d.deletewarning,d.deletequestion,function(m){if(m===true){if(this.model.isNew()===false){this.model.destroy({onComplete:function(){this.alert("success",d.SkillDeletedSucess)}.bind(this),onFailure:function(){this.alert("error",d.YourchangescouldnotbesavedPleasetryagainlater)}.bind(this)})}else{var n=this.getChildView("edition-switch");if(n){n.onCancelClick()}}}}.bind(this))}.bind(this)})}});return c});define("DS/SwymUIComponents/script/feature/community/community/view/logo-edit-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/logo-edit-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/community/media/view/uploader/dropzone-view","DS/SwymUIComponents/script/feature/community/media/edit/upload/upload-manager","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/community/collection/community-collection","DS/SwymUICore/script/feature/community/media/collection/media-collection","DS/SwymUIComponents/script/feature/community/media/view/media-home-view","DS/SwymUIComponents/script/feature/core/ui-components/view-mode-switcher/view-mode-switcher","DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button"],function(a,h,n,g,c,b,q,f,r,i,k,m,p,l,j){var d=new k({attributes:{styles:{position:"relative","float":"right"}},mode:"small"});var e=q.extend({_collectionEvents:{onRequest:"mask",onSync:"unmask"},_modeSwitch:d,name:"default-thumbnail-collection-view",modelViewClass:i});var o=n.extend({defaultOptions:{asAdmin:false},type:"community",name:"logo-edit-view",attributes:{tag:"div"},_dropzoneView:null,_uploadManager:null,_superModal:null,setup:function(t){this._parent.apply(this,arguments);this.previousUploadedFileList={};if(typeof t.showCollection!=="undefined"){this._showCollection=t.showCollection}if(t.type){this.type=t.type}if(t.mode){this.mode=t.mode}if(t.model){this.model=t.model}this._dropzoneView=this.addChildView("dropzoneView",new g({model:t.community,showCollection:this._showCollection,performAdditionalChecks:this._checkLogoFile.bind(this),typeAllowed:"file"}));if(this.type==="tenant"){this._communityCollection=new f([],{mode:"listmypublicprivatecommunities",limit:999});this.addControl("communitySelect",new l({options:[],className:"margin-0",placeholder:h.Selectacommunity,events:{onChange:function(v){this.getChildView("uploadManager").setCommunityId(v.target.value)}.bind(this)}}));this._communityCollection.addEvent("onAfterPageChange",function(w){var v=[];w.forEach(function(x,y){v.push({selected:(y===0?true:false),value:x.get("mid"),label:x.get("title",{escapeHTML:false})})}.bind(v));this.getControl("communitySelect").add(v);this.getChildView("uploadManager").setCommunityId(v[0].value);this._dropzoneView.unmask()}.bind(this));this._communityCollection.fetchPage(1)}if(typeof t.mediaCollectionLimit!=="undefined"){this._mediaCollectionLimit=t.mediaCollectionLimit}this._superModal=new p({closable:true,renderTo:this._widget.body});this._uploadManager=this.addChildView("uploadManager",new c({view:this,model:this.model,authorizedFilesTypes:["image","picture"]}));this._uploadManager.addUploader("dropzone",this._dropzoneView);this.reactTo(this._uploadManager,"onUpload",this.onMediaLoaded);this.reactTo(this._uploadManager,"uploadFailed",this.onUploadFailed);if(this._showCollection){var s=new r([],{asAdmin:this.getOption("asAdmin"),communityId:(this.type==="community"?this.getChildView("uploadManager").getCommunityId()||this.model.get("mid"):null),mode:(this.type==="community"?"communityMedia":"tenantMedia"),limit:this._mediaCollectionLimit||24});this._collection=s;this._collection.onServerFilteringRequest(null,null,{data:{query:"media_type:picture"}});var u=this.addChildView("collectionView",new e({className:"col-lg-7 col-md-12 padding-0",collection:this._collection,modelViewsCfg:{dimensions:{width:320,height:240},clickHandler:this._checkLogoSelection.bind(this)}}));d.setTarget(u);this.addChildView("pagingToolbar",new m({_currentPage:null,className:"col-lg-7 col-md-12 padding-0",collection:this._collection}));s.addEvent("onAfterPageChange",u.refresh);s.fetchPage(1)}if(this._rendered){this.refresh()}return this},onRender:function(){if(this.type==="tenant"){if(this._communityCollection.hasBeenFetched()===true){this._dropzoneView.unmask()}else{this._dropzoneView.mask()}}},_createContent:function(){var s=this;return[{"class":"col-lg-9 col-md-12 padding-0",html:[{tag:"div","class":"section-title",html:'<span style="font-weight: bold;">'+h.EditCommunityLogo+"</span>"},{tag:"div","class":(s._showCollection)?"col-lg-5 col-md-12 padding-0":"col-md-12 padding-0",html:[s.getControl("communitySelect"),s.getChildView("dropzoneView"),s.getChildView("uploadManager"),new j({value:h.Resettodefaultthumbnail,attributes:{styles:{width:"100%"}},events:{onClick:function(){var t={reset_to_default:true,as_admin:this.getOption("asAdmin")};s._superModal.confirm(h.Areyousureyouwanttoresetthethumbnailtothedefaultone,h.Confirmation,function(u){if(u===true){if(s.type==="community"){s.dispatchEvent("logoSelected",[t])}else{s.dispatchEvent("tenantLogoSelected",[t])}}}.bind(s))}}})]},s.getChildView("collectionView"),s.getChildView("pagingToolbar"),{"class":"clearfix"},{"class":"error-div"}]},{"class":"col-lg-3 col-md-12 padding-0",html:[{html:'<div class="help-box">'+(s.type!=="community"?h.HelpLogoTenant:h.HelpLogo)+"</div>"}]},{html:'<div style="clear: both;"></div>'}]},_checkLogoFile:function(s){if(s&&(s.length===1)){this._superModal.confirm(h.Areyousureyouwanttouploadthisfileanduseitaslogo,h.Confirmation,function(t){if(t===true){this._dropzoneView.mask();this._dropzoneView.dispatchEvent("onFilesSelected",s);this._dropzoneView.resetInputField()}}.bind(this))}else{this._superModal.alert(h.Onlyonefilecanbeaddedasthelogoofthecommunity)}},_checkLogoSelection:function(t){var s=(this.type==="community")?{logo_media_uri:t.get("subject6wuri"),as_admin:this.getOption("asAdmin")}:{media_id:t.get("mid")};this._superModal.confirm(h.Areyousureyouwanttosetthismediaasthelogoofthecommunity,h.Confirmation,function(u){if(u===true){if(this.type==="community"){this.dispatchEvent("logoSelected",[s])}else{this.dispatchEvent("tenantLogoSelected",[s])}}}.bind(this))},onMediaLoaded:function(v){if(v.length>=0){var w=this.getChildView("uploadManager").getCommunityId()||this.model.get("mid"),t=v[0],u=new b({}),s={is_illustration:(this.getOption("contentAttributeInModel")!=="media")};if(w){s.community_id=w}u.addChanges(a.extend(s,t.attributes));u.save({published:1,notify:"publish",as_admin:this.getOption("asAdmin")},{onComplete:function(y){var x=(this.mode==="community")?{logo_media_uri:y.get("subject6wuri"),as_admin:this.getOption("asAdmin")}:{media_id:y.get("mid")};this._collection.fetchPage(1);if(this.mode==="community"){this.dispatchEvent("logoLoaded",[x])}else{this.dispatchEvent("tenantLogoLoaded",[x])}this._dropzoneView.unmask()}.bind(this),onFailure:function(){this.onUploadFailed()}.bind(this)})}},onUploadFailed:function(s){this._dropzoneView.unmask()}});return o});define("DS/SwymUIComponents/script/feature/community/community/view/community-settings-view",["UWA/Core","UWA/Event","UWA/Utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-settings-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-status-admin-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/community/view/community-visibility-settings-view","DS/SwymUIComponents/script/feature/community/community/view/community-feature-settings-view","DS/SwymUIComponents/script/feature/community/community/view/logo-edit-view","DS/SwymUIComponents/script/feature/community/idea/view/idea-status-admin-view","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/utils/date","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button"],function(a,y,h,k,l,b,r,c,p,f,e,j,n,d,u,t,o,m){var s=function(A,z){var B;if(!(B=A.getChanges(z))){B=A.get(z,{escapeHTML:false})}return B};var q=b.extend({_modelClass:n,_modelEvents:{"onChange:description":"refresh"},domEvents:{"change textarea":"onChange","keyup textarea":"onChange"},_createContent:function(){var z=this.model,A=s(z,"description");return[{tag:"h5",html:k.Description},this.addControl("input",new t({name:"description",placeholder:k.Enteradescriptionforthecommunity,value:A?A.unescapeHTML():"",className:"title-editor-input",rows:3,multiline:true}))]},onChange:function(z){var A=y.getElement(z).value;if(z&&z.target&&(A=z.target.value)!==undefined){this.model.addChanges("description",A)}},setFocus:function(){this.getControl("input").focus()}});var v=r.extend({defaultOptions:{asAdmin:false},init:function(){this._parent.apply(this,arguments);this.collection.as_admin=this.getOption("asAdmin");this.collection.goToPage(1,{data:{usersOnly:true}});return this},_modelClass:n,_createContent:function(){var G=this.collection.getAssociated("owned"),A=G.getAssociated("owner"),B;if(this.collection.length<=0){B=[{value:A.get("hash_key"),selected:true,label:A.get("nickname")}]}else{B=[];var D,z,I,C,H,E,F=this.collection.length;for(D=0;D<F;D++){z=this.collection.at(D);I=z.get("hash_key");C=z.get("ut_state")==="0";H=z.get("ut_invitation_email");E=z.get("nickname").replace(/&#x27;/g,"'");if(C===true){if(E.trim()===""){B.push({value:I,label:H+" ("+k.Pending+")",disabled:true})}else{B.push({value:I,label:E+" ("+k.Pending+")",disabled:true})}}else{if(I===A.get("hash_key")){B.push({value:I,selected:true,label:E})}else{B.push({value:I,label:E})}}}}return[{tag:"h5",html:k.MainOwner},this.addControl("select",new o({name:"stats",hidePlaceholder:true,placeholder:k.Selectacommunitymainowner,options:B,events:{onChange:function(K){var L;if(K&&K.target&&(L=K.target.value)){var J=L;G.addChanges("main_owner_hash_key",J)}else{G.removeChanges("main_owner_hash_key")}}}}))]}});var w=r.extend({community:null,init:function(z){this.community=z&&z.community;this._parent.apply(this,arguments);this.collection.fetch();return this},_modelClass:n,attributes:{tag:"div"},_createContent:function(){var C,E,F=[],D,B,A=this.community,G=this.collection,z=G.length;if(z>0){for(C=0;C<z;C++){E=G.at(C);D=E.get("mid");B=E.get("title",{escapeHTML:false});if(D===s(A,"type_id")){F.push({value:D,selected:true,label:B})}else{F.push({value:D,label:B})}}}return[{tag:"h5",html:k.Type},this.addControl("select",new o({hidePlaceholder:true,placeholder:k.Selectacommunitytype,options:F,events:{onChange:function(H){var I;if(H&&H.target&&(I=H.target.value)){A.addChanges("type_id",I)}}}}))]},destroy:function(){this.community=null;return this._parent.apply(this,arguments)},setSelectValue:function(z){if(this.getControl("select")){this.getControl("select").select(z)}}});var g=b.extend({defaultOptions:{asAdmin:false},_modelClass:n,_modelEvents:{onVirtualChange:"onVirtuallyChanged"},_statusChanged:false,_onCancel:function(){this.dispatchEvent("onCancel")},statusSaved:function(z){if(z===true){this.setStatusChanged(false);this.saveCommunitySettings(true)}},setStatusChanged:function(A){this._statusChanged=A;var z=this.container.getElement(".save-changes");this.enableCancel();if(A===true&&z){z.setHTML(k.Youvemadchanges)}else{if(z){z.setHTML("")}}},setup:function(){this.saveButtonView=this.addControl("saveButton",new m({className:"primary",value:k.Apply,events:{onClick:this.onSave.bind(this)}}));this.reactTo(this.saveButtonView,"enableSave",this.enableSave);this.reactTo(this.saveButtonView,"disableSave",this.disableSave);this._parent.apply(this,arguments)},enableSave:function(){var z=this.saveButtonView;z.enable();if(this.model.hasVirtuallyChanged()){this.onVirtuallyChanged()}},enableCancel:function(){if(!(a.is(this._widget)&&a.is(this._widget.getAppName)&&this._widget.getAppName()===c.getControlCenterAppKey())){if(this.resetButtonView&&this.resetButtonView.isDisabled()){this.resetButtonView.enable()}}},disableSave:function(){var z=this.saveButtonView;z.disable()},onVirtuallyChanged:function(){if(this.model.hasVirtuallyChanged()){if(this.saveButtonView&&!this.saveButtonView.isDisabled()){var z=this.container.getElement(".save-changes");if(z){z.setHTML(k.Youvemadchanges)}this.enableCancel()}}else{if(this.saveButtonView&&!this.saveButtonView.isDisabled()){var z=this.container.getElement(".save-changes");if(z){z.setHTML("")}if(!(a.is(this._widget)&&a.is(this._widget.getAppName)&&this._widget.getAppName()===c.getControlCenterAppKey())){if(this.resetButtonView&&!this.resetButtonView.isDisabled()){this.resetButtonView.disable()}}}}},saveCommunitySettings:function(C){var z=this.model;var B=z.getChanges(),A=Object.keys(B).length;if(A!==0){z.save({as_admin:this.getOption("asAdmin")},{onComplete:function(){this.dispatchEvent("onCommunitySettingsSaved",[this.model]);this.alert("success",k.Yourchangeshavebeensaved)}.bind(this),onFailure:function(F,E){var D="";if(E.errorcode==="ERROR_COMMUNITY_CREATION_TITLE_UNIQUENESS"){D=k.communityTitleAlreadyExist}else{D=k.YourchangescouldnotbesavedPleasetryagainlater}this.alert("error",D)}.bind(this)})}else{if(!C){this.alert("info",k.noChangesApplied);this.dispatchEvent("onCommunitySettingsSaved",[z])}else{this.alert("success",k.Yourchangeshavebeensaved)}}},onSave:function(){if(this._statusChanged){this.dispatchEvent("saveStatus")}else{this.saveCommunitySettings(false)}},_createContent:function(){var z=this,A=this.model;return[{"class":"save-container col-xs-12",html:[{"class":"reset-button",html:(this.resetButtonView=this.addControl("resetButton",new m({value:k.Cancel,events:{onClick:function(){var B=z.getElement(".save-changes");if(B){B.setHTML("")}z.dispatchEvent("onCancel")}}})))},{"class":"apply-button",html:[this.saveButtonView]},{"class":"save-changes",html:""}]}]}});var i=b.extend({defaultOptions:{asAdmin:false},_modelClass:n,_createContent:function(){var z=this.addChildView("statusAdmin",new j({asAdmin:this.getOption("asAdmin"),widget:this._widget,model:this.model}));this.reactTo(z,"hasChanged",function(A){this.dispatchEvent("hasChanged",A)},this);this.reactTo(z,"onStatusSaveCallback",function(A){this.dispatchEvent("onStatusSaveCallback",A)},this);return[{tag:"h5",html:k.Ideastatusmanagement},z]}});var x=b.extend({defaultOptions:{asAdmin:false},_modelClass:n,_scrollerContentSelector:".settings-body-int-wrapper",_modelEvents:{onRequest:"mask",onSync:"unmask",onError:"unmask","onVirtualChange:description":"onDescVirtualChange","onVirtualChange:title":"onTitleVirtualChange"},attributes:{"class":"settings"},_onCancel:function(){var A=null,z=this.model;z.removeChanges();this.refresh();for(A in this._childViews){if(this._childViews.hasOwnProperty(A)){this._childViews[A].refresh()}}this.dispatchEvent("onCancel");if(this.getChildView("statusAdminContainerView")){this.getChildView("statusAdminContainerView").getChildView("statusAdmin")._onCancelButtonClick()}this.alert("info",k.yourChangesHaveBeenCancelled)},_saveStatus:function(){var z=this.getChildView("statusAdminContainerView").getChildView("statusAdmin").pipelineValidation();if(z){this.getChildView("statusAdminContainerView").getChildView("statusAdmin").saveStatus()}else{this.alert("error",l.Pleasecheckyourform)}},onTitleVirtualChange:function(A,B){var z=A.validateField("title",B);this.dispatchEvent("communityTitleValidationToggle",[z]);if(z==="err-empty"){this.alert("error",k.Thecommunitytitlecannotbeempty)}else{if(z==="err-length"){this.alert("error",k.Thelengthofthecommunitytitlecannotbemorethan255characters)}}},onDescVirtualChange:function(B,C){var A,z=this.getChildView("description");if((A=B.validateField("description",C))){if(z&&z.container){z.container.addClassName("has-error")}if(A==="err-empty"){this.alert("error",k.Thecommunitydescriptioncannotbeempty)}}else{if(z&&z.container&&z.container.hasClassName("has-error")){z.container.removeClassName("has-error")}}},_createLogoEditView:function(){var z=this.addChildView("logoEditView",{asAdmin:this.getOption("asAdmin"),showCollection:true,widget:this._widget,className:"editor-border",attributes:{styles:{display:"none"}},Class:e,model:this.model,mode:this.options.mode,mediaCollectionLimit:12});this.reactTo(z,"tenantLogoSelected",function(){z.mask()});this.reactTo(z,"logoLoaded",this.onLogoLoaded);this.reactTo(z,"logoSelected",this.setCommunityLogo);return z},setup:function(C){this._parent.apply(this,arguments);var B=this.model,E=this;E.reactTo(B,"onValidationFailure",function(F,G){if(G==="description:err-empty"){E.getChildView("description").setFocus()}});E.reactTo(B,"onSync:editmembers",function(){B.getPossibleMainOwners().refresh()});var z=this.addChildView("featureView",{className:"feature-settings section col-xs-12 col-sm-12 feature-section",Class:f,model:B});this.reactTo(z,"enableSave",this.enableSave);this.reactTo(z,"disableSave",this.disableSave);var D=this.addChildView("saveView",{asAdmin:this.getOption("asAdmin"),className:"save section",Class:g,model:B});this.reactTo(D,"onCancel",this._onCancel);this.reactTo(D,"onCommunitySettingsSaved",this.onCommunitySettingsSaved);this.reactTo(D,"saveStatus",this._saveStatus);this._createLogoEditView();var A=this.addChildView("statusAdminContainerView",{asAdmin:this.getOption("asAdmin"),className:"status-admin section col-xs-12 col-sm-12 feature-section",Class:i,model:B});this.reactTo(A,"hasChanged",function(F){D.setStatusChanged(F)},this);this.reactTo(A,"onStatusSaveCallback",function(F){D.statusSaved(F)},this)},showEditLogoView:function(){var z=this.getChildView("logoEditView");if(z&&z.container){z.unmask();if(z.container.style&&z.container.style.display==="none"){z.container.show()}else{z.container.hide()}}},onLogoLoaded:function(z){this.setCommunityLogo(z)},onSetModel:function(){if(this.getChildView("featureView")){this.getChildView("featureView").setModel(this.model)}if(this.getChildView("statusAdminContainerView")){this.getChildView("statusAdminContainerView").setModel(this.model)}if(this.getChildView("saveView")){this.getChildView("saveView").setModel(this.model)}},setCommunityLogo:function(z){this.model.action("setlogo",{data:z,onComplete:function(){var A={};if(!this.model.changedAttributes().preview_fingerprint){A.preview_fingerprint=h.getCheckSum(h.getUUID())}A.logo_media_id=z.media_id||null;A.update=d.getCurrentDate();this.model.set(A);this.dispatchEvent("communityLogoSaved");this.showEditLogoView();this.alert("success",k.Yourlogohasbeenset)}.bind(this)})},onCommunitySettingsSaved:function(){this.getChildView("featureView").refresh()},enableSave:function(){var z=this.getChildView("saveView");if(z){z.dispatchEvent("enableSave")}},disableSave:function(){var z=this.getChildView("saveView");if(z){z.dispatchEvent("disableSave")}},_createContent:function(){var z=this.model;if(z){if(this.getChildView("logoEditView")){if(this.getChildView("logoEditView").model!==this.model){this.getChildView("logoEditView").destroy();this._createLogoEditView()}}return{"class":"settings-view section",styles:{height:"100%"},html:[{"class":"settings-body-wrapper",styles:{height:"calc(100% - 60px)"},html:{"class":"settings-body-int-wrapper",styles:{height:"100%"},html:{"class":"settings-body",html:[this.getChildView("logoEditView"),this.addChildView("description",{Class:q,className:"description-settings section col-xs-12 col-sm-12",model:z}),this.addChildView("ownerView",{collection:z.getPossibleMainOwners(),Class:v,className:"main-owner-settings section col-xs-12 col-sm-12",modelName:z.getModelName(),asAdmin:this.getOption("asAdmin")}),this.addChildView("visibilityView",{className:"visibility-settings section",Class:p,model:z}),this.getChildView("featureView"),this.getChildView("statusAdminContainerView")]}}},{"class":"settings-footer",html:[this.getChildView("saveView")]}]}}}});return x});define("DS/SwymUIComponents/script/feature/community/content/edit/paragraph-formatter-popover",["DS/UIKIT/Popover","DS/SwymUIComponents/script/feature/community/content/edit/paragraph-formatter"],function(d,c){var b=100,f=300,e="paragraph-formatter",a=d.extend({defaultOptions:{className:"flex-display "+e,position:"bottom",delay:{show:b,hide:f},extraEditor:null},init:function(h,g){var i=this;h.body=this.innerView=new c({extraEditor:h.extraEditor,mode:"popover",events:{onApplyStyle:function(){i.dispatchEvent("onApplyStyle")}}});this._parent.apply(this,arguments)},show:function(){var g=this,h=this.elements;if(!h){return}if(!this.isVisible){this.isVisible=true;this.inject(this.options.target);this.elements.container.addClassName("in");if(this.options.animate){setTimeout(function(){if(g.elements&&g.isVisible){g.dispatchEvent("onShow")}},150)}else{this.dispatchEvent("onShow")}}return this},destroy:function(){if(this._destroyed===false){this._destroyed=true;this.innerView.destroy();this.innerView=null;this._parent.apply(this,arguments)}}});return a});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-transferred-link-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-transfer-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UWPClientCode/I18n","DS/SwymUICore/script/feature/community/idea/collection/license-collection","DS/SwymUICore/script/feature/community/idea/collection/collab-space-collection"],function(g,d,e,i,f,b,c,j,a){var h=e.extend({name:"idea-transferred-link-view",domEvents:{"click .delete-button":"_onDeleteButtonClick"},_linkedModel:null,_deleted:false,_error:false,_isCommunityOwner:false,enoviaServerUrl:null,_createContent:function(){var n=this,m;if(n._linkedModel&&n.enoviaServerUrl){var k=n.enoviaServerUrl+"/common/emxSecurityContextSelection.jsp?objectId="+n._linkedModel.get("content_key")+"&tenant="+n._tenantInfos.online_instance_id,l=n._linkedModel.get("type").replace("enovia_","");if(n._isCommunityOwner&&!n.getControl("deleteTransferredObjectButton")){n.addControl("deleteTransferredObjectButton",new f({className:"delete-button default",value:d.Deletethislink}))}m=g.createElement("div",{html:[{styles:{"margin-bottom":"10px"},html:(n._deleted?c.replace(d.Yourobjecthasbeendeleted,{atag:'<a target="_blank" href="'+k+'">'+n._linkedModel.get("content_title")+"</a>",object:d.get(l)}):(n._error?{"class":"alert-message alert-warning",styles:{margin:"0px",position:"relative"},html:c.replace(d.AnerroroccuredwhilecontactingtheEnoviaserverbutyou,{object:d.get(l)})+' <a target="_blank" href="'+k+'">'+n._linkedModel.get("content_title")+"</a>"}:c.replace(d.ThisideahasbeenusedtocreatethisEnoviaobject,{object:d.get(l)})+' <a class="transferred-object-title" target="_blank" href="'+k+'">'+n._linkedModel.get("content_title")+"</a>"))},(n._isCommunityOwner?{styles:{margin:"10px 0"},html:n.getControl("deleteTransferredObjectButton")}:"")]});if(n._parentView){n._parentView.ideaTransferredLinkViewDisplayed=true;n._parentView.dispatchDisplayEvent()}}else{if(n._parentView){n._parentView.ideaTransferredLinkViewDisplayed=false;n._parentView.dispatchDisplayEvent()}}return m},_getLinksCallback:function(){var k=this;k.model.getAssociated("links").forEach(function(l){j.getCompliantObjects().forEach(function(m){if(l.get("type")==="enovia_"+m.type){k.setLinkedModel(l);var n=j.getCompliantObjectData(m.type).Model,o=new n({id:l.get("content_key")});o.fetchObject({onComplete:function(p){k._deleted=p.get("deleted");k.refresh();if(k._parentView){k._parentView.getChildView("ideaTransferFormView").hide()}},onFailure:function(){k._error=true;k.refresh();if(k._parentView){k._parentView.getChildView("ideaTransferFormView").hide()}}})}})})},setLinkedModel:function(k){this._linkedModel=k;this._error=false;this._deleted=false},setup:function(l){var k=this._parent.apply(this,arguments),m=this;m._tenantInfos=i.getInstance().get("config").tenant;a.getSpaceServerUrl(function(n){m.enoviaServerUrl=n;m.refresh()});m._isCommunityOwner=l.isCommunityOwner;m.addControl("confirmModal",new b({closable:true,renderTo:m._widget.body}));if(!m.model.getLinks().hasBeenFetched()){m.reactTo(m.model.getLinks(),"onSync:read",m._getLinksCallback)}else{m._getLinksCallback()}return k},_onDeleteButtonClick:function(){var l=this,k=l._linkedModel.get("type").replace("enovia_","");this.getControl("confirmModal").confirm(c.replace(d.DeleteInfos,{object:d.get(k)}),d.Confirm,function(m){if(m===true){l._linkedModel.destroy({onComplete:function(){l.setLinkedModel(null);l.hide();var n=true;var o=g.clone(l.model.get("_acl"));o.update.access=n;o["delete"].access=n;l.model.set("_acl",o);l.model.set("acl_status",n);l.dispatchEvent("IdeaTransfer",n);if(l._parentView){l._parentView.getChildView("ideaTransferFormView").show()}}})}})},_displayTransferredObjectWrapper:function(k){this.dispatchEvent("DisplayTransferredObjectWrapper",k)}});return h});define("DS/SwymUIComponents/script/feature/community/media/editor/view/cropbox-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/media/editor/view/control-point-view","DS/WebappsUtils/Console"],function(e,d,b,a){var c=d.extend({name:"cropbox",xOrigin:null,yOrigin:null,centralRectElt:null,width:null,height:null,widgetId:null,svgWrapper:null,pointCoords:null,domEvents:{"mousedown svg.cropbox-svg-wrapper":"onMouseDown","mouseup svg.cropbox-svg-wrapper":"onMouseUp"},setup:function(f){console.info("setup, config:",f);if(f.width){this.width=Math.floor(f.width)}else{throw new Error("A width is required for the cropbox view.")}if(f.height){this.height=Math.floor(f.height)}else{throw new Error("A height is required for the cropbox view.")}if(f.widgetId){this.widgetId=f.widgetId}this.pointCoords=[]},_createContent:function(){return'<svg class="cropbox-svg-wrapper" height="'+this.height+'" width="'+this.width+'" xmlns="http://www.w3.org/2000/svg" version="1.1"><g class="rect-group"></g><g class="cp-group"></g></svg>';return e.createElement("div",{"class":"container-svg-wrapper",html:'<svg class="cropbox-svg-wrapper" height="'+this.height+'" width="'+this.width+'" xmlns="http://www.w3.org/2000/svg" version="1.1"><g class="rect-group"></g><g class="cp-group"></g></svg>'})},onRender:function(){this.container.setStyles({height:this.height+"px",width:this.width+"px",position:"relative",top:"-"+this.height+"px"});this.svgWrapper=this.getElement("svg.cropbox-svg-wrapper");this.rectGroup=this.getElement("g.rect-group");this.cpGroup=this.getElement("g.cp-group");var g=Math.floor(this.width*0.25/2);var f=Math.floor(this.height*0.25/2);this.pointCoords.push([g,f]);a.log("cropbox------> width:"+this.width+", height: "+this.height+", horizontalMargin: "+g+", verticalMargin: "+f);this.pointCoords.push([this.width-g,f]);this.pointCoords.push([g,this.height-f]);this.pointCoords.push([this.width-g,this.height-f]);this.drawLayer(this.pointCoords,true);this.drawControlPoints(this.pointCoords)},onMouseDown:function(g){a.log("cropbox onMouseDown");var f=g.target;this.draggedControlPoint=this.getClickedControlPoint(f);if(this.draggedControlPoint){this.draggedControlPoint.onMouseDown(g);this.svgWrapper.addEvent("mousemove",this.onMouseMove.bind(this))}},onMouseUp:function(f){if(this.draggedControlPoint){a.log("cropbox onMouseDown");this.draggedControlPoint.onMouseUp(f);this.svgWrapper.removeEvent("mousemove",this.onMouseMove)}},getClickedControlPoint:function(j){for(var g=-1,f=this.controlPoints.length;++g<f;){var h=this.controlPoints[g];if(h.isControlPoint(j)){return h}}return null},createSVGElement:function(f,g){var h=document.createElementNS("http://www.w3.org/2000/svg",f);for(var i in g){h.setAttribute(i,g[i])}this.rectGroup.appendChild(h);return h},updateSVGElement:function(g,f){for(var h in f){g.setAttribute(h,f[h])}},drawLayer:function(m,p){var i;var n=m[0];var g=m[1];var f=m[2];var o=n[1];if(p){this.leftRect=this.createSVGElement("rect",{width:n[0],height:this.height,x:0,y:0,"class":"media-editor-cropbox-dark-rectangle"})}else{this.updateSVGElement(this.leftRect,{width:n[0]})}if(p){this.topMiddleRect=this.createSVGElement("rect",{width:g[0]-n[0],height:o,x:n[0],y:0,"class":"media-editor-cropbox-dark-rectangle"})}else{this.updateSVGElement(this.topMiddleRect,{width:g[0]-n[0],height:o,x:n[0]})}if(p){this.rightRect=this.createSVGElement("rect",{width:this.width-g[0],height:this.height,x:g[0],y:0,"class":"media-editor-cropbox-dark-rectangle"})}else{this.updateSVGElement(this.rightRect,{width:this.width-g[0],x:g[0]})}var h=f[1]-n[1];if(p){this.centralRect=this.createSVGElement("rect",{width:g[0]-n[0],height:h,x:n[0],y:n[1],"class":"media-editor-cropbox-bright-rectangle"});this.centralRectElt=this.getElement(".media-editor-cropbox-bright-rectangle");this.centralRectSetup()}else{this.updateSVGElement(this.centralRect,{width:g[0]-n[0],height:h,x:n[0],y:n[1]})}var l=this.height-f[1];if(p){this.bottomMiddleRect=this.createSVGElement("rect",{width:g[0]-n[0],height:l,x:f[0],y:f[1],"class":"media-editor-cropbox-dark-rectangle"})}else{this.updateSVGElement(this.bottomMiddleRect,{width:g[0]-n[0],height:l,x:f[0],y:f[1]})}var k=(g[0]-n[0])/3;i={x1:n[0]+k,y1:n[1],x2:n[0]+k,y2:f[1]};if(p){i["class"]="media-editor-cropbox-line";this.leftVerticalLine=this.createSVGElement("line",i)}else{this.updateSVGElement(this.leftVerticalLine,i)}i={x1:n[0]+k*2,y1:n[1],x2:n[0]+k*2,y2:f[1]};if(p){i["class"]="media-editor-cropbox-line";this.rightVerticalLine=this.createSVGElement("line",i)}else{this.updateSVGElement(this.rightVerticalLine,i)}var j=(f[1]-n[1])/3;i={x1:n[0],y1:n[1]+j,x2:g[0],y2:n[1]+j};if(p){i["class"]="media-editor-cropbox-line";this.topHorizontalLine=this.createSVGElement("line",i)}else{this.updateSVGElement(this.topHorizontalLine,i)}i={x1:n[0],y1:n[1]+j*2,x2:g[0],y2:n[1]+j*2};if(p){i["class"]="media-editor-cropbox-line";this.bottomHorizontalLine=this.createSVGElement("line",i)}else{this.updateSVGElement(this.bottomHorizontalLine,i)}},centralRectSetup:function(){this.centralRectElt.setStyle("cursor","move");var g=function(i){f()};var f=function(){a.log("stopDrag");this.centralRectBeingDragged=false;this.centralRectElt.removeEvents();this.centralRectElt.addEvent("mousedown",h.bind(this))}.bind(this);var h=function(i){a.info("central rect onMouseDown");this.centralRectBeingDragged=true;this.centralRectElt.oldX=i.clientX;this.centralRectElt.oldY=i.clientY;this.centralRectElt.addEvent("mouseup",g.bind(this));this.centralRectElt.addEvent("mousemove",this.centralRectOnMove.bind(this))}.bind(this);this.centralRectElt.addEvent("mousedown",h.bind(this))},centralRectOnMove:function(k){if(this.centralRectBeingDragged){var g=k.clientX-this.centralRectElt.oldX;var f=k.clientY-this.centralRectElt.oldY;this.centralRectElt.oldX=k.clientX;this.centralRectElt.oldY=k.clientY;if(this.pointCoords[0][0]+g>0&&this.pointCoords[1][0]+g<this.width){for(var h=0;h<4;h++){this.pointCoords[h][0]+=g}}if(this.pointCoords[0][1]+f>0&&this.pointCoords[2][1]+f<this.height){for(var h=0;h<4;h++){this.pointCoords[h][1]+=f}}var j=this.controlPoints[0].width;this.updateControlPointCoordinates("NW",this.pointCoords[0][0],this.pointCoords[0][1]);this.updateControlPointCoordinates("NE",this.pointCoords[1][0]-j,this.pointCoords[1][1]);this.updateControlPointCoordinates("SW",this.pointCoords[2][0],this.pointCoords[2][1]-j);this.updateControlPointCoordinates("SE",this.pointCoords[3][0]-j,this.pointCoords[3][1]-j);this.drawLayer(this.pointCoords,false)}},updateControlPointCoordinates:function(j,f,l){for(var h=-1,g=this.controlPoints.length;++h<g;){var k=this.controlPoints[h];if(j===k.type){k.setCoordinate("x",f);k.setCoordinate("y",l);break}}},updateControlPointCoordinate:function(h,l,j){for(var g=-1,f=this.controlPoints.length;++g<f;){var k=this.controlPoints[g];if(h===k.type){k.setCoordinate(l,j);break}}},drawControlPoints:function(g){var j=new b({pointCoord:g[0],type:"NW",svgWrapper:this.svgWrapper,renderTo:this.cpGroup,events:{ControlPointMoved:this.onControlPointMoved.bind(this)}});var h=new b({pointCoord:g[1],type:"NE",svgWrapper:this.svgWrapper,renderTo:this.cpGroup,events:{ControlPointMoved:this.onControlPointMoved.bind(this)}});var f=new b({pointCoord:g[2],type:"SW",svgWrapper:this.svgWrapper,renderTo:this.cpGroup,events:{ControlPointMoved:this.onControlPointMoved.bind(this)}});var i=new b({pointCoord:g[3],type:"SE",svgWrapper:this.svgWrapper,renderTo:this.cpGroup,events:{ControlPointMoved:this.onControlPointMoved.bind(this)}});this.controlPoints=[j,h,f,i]},onMouseMove:function(g){a.log("cropbox onMouseMove");if(this.draggedControlPoint){var f=true;var h=this.draggedControlPoint.getCoordsInSvgSpace(g);a.log("newCoords:",h);switch(this.draggedControlPoint.type){case"NW":if(h.x>=this.pointCoords[1][0]-2*this.draggedControlPoint.width){f=false}else{if(h.y>=this.pointCoords[2][1]-2*this.draggedControlPoint.width){f=false}else{if(h.x<0){f=false}}}break;case"NE":if(h.x<=this.pointCoords[0][0]+2*this.draggedControlPoint.width){f=false}else{if(h.y>=this.pointCoords[3][1]-2*this.draggedControlPoint.width){f=false}}break;case"SW":if(h.x>=this.pointCoords[3][0]-2*this.draggedControlPoint.width){f=false}else{if(h.y<=this.pointCoords[0][1]+2*this.draggedControlPoint.width){f=false}}break;case"SE":if(h.x<=this.pointCoords[0][0]+2*this.draggedControlPoint.width){f=false}else{if(h.y<=this.pointCoords[0][1]+2*this.draggedControlPoint.width){f=false}}break}if(f){this.draggedControlPoint.onMouseMove(g)}}},onControlPointMoved:function(g){var f=parseInt(g.rect.getAttribute("x"),10);var i=parseInt(g.rect.getAttribute("y"),10);var h;switch(g.type){case"NW":h=0;this.pointCoords[2][0]=f;this.pointCoords[1][1]=i;this.updateControlPointCoordinate("NE","y",i);this.updateControlPointCoordinate("SW","x",f);this.pointCoords[h][0]=f;this.pointCoords[h][1]=i;break;case"NE":h=1;this.pointCoords[3][0]=f+g.width;this.pointCoords[0][1]=i;this.updateControlPointCoordinate("NW","y",i);this.updateControlPointCoordinate("SE","x",f);this.pointCoords[h][0]=f+g.width;this.pointCoords[h][1]=i;break;case"SW":h=2;this.pointCoords[0][0]=f;this.pointCoords[3][1]=i+g.width;this.updateControlPointCoordinate("NW","x",f);this.updateControlPointCoordinate("SE","y",i);this.pointCoords[h][0]=f;this.pointCoords[h][1]=i+g.width;break;case"SE":h=3;this.pointCoords[1][0]=f+g.width;this.pointCoords[2][1]=i+g.width;this.updateControlPointCoordinate("NE","x",f);this.updateControlPointCoordinate("SW","y",i);this.pointCoords[h][0]=f+g.width;this.pointCoords[h][1]=i+g.width;break}this.drawLayer(this.pointCoords,false)},getInfos:function(){return{left:this.pointCoords[0][0],top:this.pointCoords[0][1],width:this.pointCoords[1][0]-this.pointCoords[0][0],height:this.pointCoords[2][1]-this.pointCoords[0][1]}}});return c});define("DS/SwymUIComponents/script/feature/community/media/edit/media-creator-body-view",["UWA/Core","UWA/String","DS/UIKIT/Tooltip","DS/UIKIT/Input/Toggle","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/content/edit/abstract-content-editor-body-view","DS/SwymUIComponents/script/feature/community/media/view/uploader/dropzone-view","DS/SwymUIComponents/script/feature/community/content/edit/content-edition-media-view","DS/SwymUIComponents/script/feature/community/media/edit/upload/media-upload-queue","DS/SwymUICore/script/feature/core/context/context-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/properties-editor-view"],function(e,b,g,h,d,f,i,a,l,j,k){var c=f.extend({_publishEnabled:false,_titleContent:null,_content:null,_context:null,_communityId:null,_uploadsOngoing:false,_modelEvents:{"onSync:read":"refresh"},name:"media-creator-body-view",domEvents:{},_createContent:function(){var m=null;if(d.isFeatureActivated("activateSimplifiedMediaCreation")){m=e.createElement("span",{styles:{"margin-left":"10px"},"class":"fonticon fonticon-help-circled"});this.addControl("helpIconTooltip",new g({trigger:"touch",target:m,body:b.format(k.get("IfSelectedTheMediaWillBeDisplayedOnTheWhatsNew"),"<b>","</b>")}));this.addControl("highSemanticMediaCheckBox",new h({type:"checkbox",label:k.get("DisplayOnWhatsNew"),checked:true,name:"displayonwhatsnew",className:"primary"})).getContent().setStyle("display","inline-block")}return{html:[this._getDropZoneView(),d.isFeatureActivated("activateSimplifiedMediaCreation")?{"class":"display-on-whatsnew-section",styles:{padding:"0 10px"},html:[this.getControl("highSemanticMediaCheckBox"),m]}:null,this._getMediaEditionView()]}},_getDropZoneView:function(){var m=this.getChildView("dropzoneView");if(!m){m=this.addChildView("dropzoneView",new i({widget:this._widget,model:this._community,showCollection:false,typeAllowed:"file"}))}return m},_focusOnDescription:function(){var m=this.getElement(".media-description");if(!m.hasClassName("focused")){m.addClassName("focused")}},_focusOutDescription:function(){var m=this.getElement(".media-description");if(m.hasClassName("focused")){m.removeClassName("focused")}},_onKeyup:function(n){var m=n.srcElement||n.target,o=m.innerText||m.innerHTML;if(!o&&!m.hasClassName("show-placeholder")){m.addClassName("show-placeholder")}else{if(o&&m.hasClassName("show-placeholder")){m.removeClassName("show-placeholder")}}},_createDescZone:function(){var m=e.createElement("div",{"class":"media-description show-placeholder",contenteditable:"true","data-placeholder":"Please enter a description.."});return m},_getMediaEditionView:function(){var o=this,n,m=this.getChildView("mediaEdition");if(!m){n={communityId:this.getCommunityId()||undefined,Class:a,contentAttributeInModel:"media",allowDragNDrop:false};m=this.addChildView("mediaEdition",n);m.addUploader("dropzoneView",this._getDropZoneView());this.listenTo(m,{onMediaCollectionChange:this.onMediaCollectionChange.bind(this),onMediaUploadsStart:function(){o.onMediaUploadsStart();this.dispatchEvent("onMediaUploadsStart")},onMediaUploadsComplete:function(){o.onMediaUploadsComplete();this.dispatchEvent("onMediaUploadsComplete")},onMediaUploadsFailure:function(){o.onMediaUploadsComplete();this.dispatchEvent("onMediaUploadsFailure")},onDragAndDrop:function(){this.dispatchEvent("onDragAndDrop",arguments)}})}return m},onMediaUploadsStart:function(){this._uploadsOngoing=true},onMediaUploadsComplete:function(){this._uploadsOngoing=false},areUploadsOngoing:function(){return this._uploadsOngoing},getContentAttributes:function(){var m;if(d.isFeatureActivated("activateSimplifiedMediaCreation")){if(this.getControl("highSemanticMediaCheckBox")){m=!this.getControl("highSemanticMediaCheckBox").isChecked()}else{m=true}}else{m=false}return{is_illustration:m}},isContentEmpty:function(){return this.getMediaCollectionLength()===0},resetContent:function(){if(d.isFeatureActivated("activateSimplifiedMediaCreation")){var m=this.getControl("highSemanticMediaCheckBox");if(m){m.setCheck(true)}}this._getMediaEditionView().reset()},refreshContent:function(n,m){if(m){this._getMediaEditionView().setCollection(m);this._getMediaEditionView().refresh()}},onMediaCollectionChange:function(){this.dispatchEvent("onContentChange")},getMediaCollectionLength:function(){return this._getMediaEditionView().getCollectionLength()},getMediaCollection:function(){return this._getMediaEditionView().getCollection()},uploadMedia:function(n){var m=this;if(this.areUploadsOngoing()){this.addEventOnce("onMediaUploadsComplete",function(){setTimeout(function(){m.saveMedia(n)},100)})}else{this.saveMedia(n)}},saveMedia:function(s){var p,m,o,q,n,r=new l();if(s&&(o=s.mediaToBeUploaded)&&(m=o.length)){for(p=0;p<m;p++){q=o[p];if(n=q.getCustomProperty("changesToBeSaved")){q.addChanges(n);q.deleteCustomProperty("changesToBeSaved")}}}r(s)},addMedia:function(){},destroy:function(){this._context.removeListener("onCommunityChange",this.onCommunityChange)},onCommunityChange:function(m){if(this._context&&(this._context.communityId||this._context.dmId)){var n=this._context.path.startsWith("dm:");this.resetContent()}},setup:function(){var m=this;m._context=j.getInstance();m._context.removeListener("onCommunityChange",m.onCommunityChange);m.onCommunityChange=m.onCommunityChange.bind(m);m._context.addListener("onCommunityChange",m.onCommunityChange,m,true);return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/community/media/editor/view/image-editor-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/media/editor/collection/operation-collection","DS/SwymUICore/script/feature/community/media/editor/model/operation-model","DS/SwymUIComponents/script/feature/community/media/editor/view/cropbox-view","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/utils/media-utils","UWA/Utils/Client","DS/WebappsUtils/Console","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Tooltip","DS/Controls/Slider","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/editor/view/image-editor-view"],function(l,j,d,i,b,m,k,e,a,c,n,h,g){var f=j.extend({name:"image-editor-view",domEvents:{"click .editor-toolbar button":"buttonClicked"},canvasCopy:[],currentOperationIndex:null,previousBrightnessValue:null,lastBrightnessOperationId:null,originalImageUsedInEditor:false,bnwDone:false,setup:function(){this._parent.apply(this,arguments);this.listenTo(this,"saveMediaEdited",this.saveOriginalMediaToModel);this._operations=new d();this.currentOperationIndex=0;this.previousBrightnessValue=0;this.keypressCropHandlerBound=this.keypressCropHandler.bind(this);return this},_createContent:function(){var r=this.options.isInLightbox?this._parentView.getElement(".content").getSize().width:this._parentView.container.getSize().width,s=this.options.isInLightbox?this._parentView.getElement(".content").getSize().height-100:this._parentView.container.getSize().height,t=this.model,o=null,q=t.getChanges("width")||t.get("width"),x=t.getChanges("height")||t.get("height"),p=parseInt(q,10),y=parseInt(x,10),u=p/y,w;if(this.options.isInLightbox){if((p<=r)&&(y<=s)){o=p;this.originalImageUsedInEditor=true}else{if((p>r)&&(y>s)){if((r/s)>(p/y)){o=s*u}else{o=r}}else{if((p<r)&&(y>s)){o=s*u}else{if((p>r)&&(y<s)){o=r}}}}}else{if(p>=r||!p){o=r}else{if(p<r){o=p;if(y<s){this.originalImageUsedInEditor=true}}else{if(r===0){o=960}}}}this.imageWidth=this.options.isInLightbox?o:o-30;var v=p/y;this.imageHeight=v?this.imageWidth/v:null;w=l.createElement("div",{html:[{tag:"div","class":"editor-toolbar",html:['<button id="undo" disabled class="undo-btn btn btn-default"></button>','<button id="redo" disabled class="redo-btn btn btn-default"></button>','<button id="crop" class="crop-btn btn btn-default"></button>','<button id="rotate" class="rotate-btn btn btn-default"></button>','<button id="bnw" class="bnw-btn btn btn-default"></button>','<button id="flip" class="flip-btn btn btn-default"></button>',l.createElement("span",{"class":"brightness-bar",html:[{tag:"img",src:c.getWebappsBaseUrl()+"SwymUIComponents/assets/media/media-editor/brightness-icon.png",alt:""},this._getBrightnessControl()]})]},{tag:"div","class":"canvas-editor-container",styles:{"min-height":this.options.isInLightbox?0:this.imageHeight},html:[{tag:"img",id:"editor-img","class":"img-responsive",styles:{"border-radius":0}},{tag:"canvas",id:"editor-canvas",styles:{display:"none"},width:this.options.isInLightbox?"none":this.imageWidth}]}]});this.addControl("undoButtonTooltip",new n({target:w.getElement(".undo-btn"),body:g.Undo}));this.addControl("redoButtonTooltip",new n({target:w.getElement(".redo-btn"),body:g.Redo}));this.addControl("cropButtonTooltip",new n({target:w.getElement(".crop-btn"),body:g.Crop}));this.addControl("rotateButtonTooltip",new n({target:w.getElement(".rotate-btn"),body:g.Rotate}));this.addControl("bnwButtonTooltip",new n({target:w.getElement(".bnw-btn"),body:g.Bnw}));this.addControl("flipButtonTooltip",new n({target:w.getElement(".flip-btn"),body:g.Flip}));this.addControl("brightnessBarTooltip",new n({target:w.getElement(".brightness-bar"),body:g.Brightness}));return w},_getBrightnessControl:function(){var o=this.getControl("brightnessSlider");if(!o){o=this.addControl("brightnessSlider",new h({minValue:-40,maxValue:40,stepValue:1,value:0,domId:"brightness"}));o.addEventListener("endEdit",this.brightnessChange.bind(this))}return o},getBase64FromImgFile:function(p,r){var o=new FileReader(),q=this,r=r.bind(q);o.onload=function(){var s=o.result;r(s)};o.readAsDataURL(p)},onRedraw:function(){var t=this.model;if(this.options.isNewMedia){var q=t.getChanges("userFile")||t.get("userFile");if(typeof q==="string"){this.createNewImgTag(q)}else{this.getBase64FromImgFile(q,function(y){t.addChanges("userFile",y);this.createNewImgTag(y)})}}else{var r,p,o=t.get("width"),x=t.get("height");if(this.options.isInLightbox){var w=k.generateImageReloadOptionsForMedia({mediaId:t.get("mid"),mediaType:t.get("media_type"),mediaWidth:o,mediaHeight:x,containerWidth:this._parentView.container.getSize().width,containerHeight:document.body.getSize().height});var s,u,v=t.get("play").view;for(s=0,u=v.length;s<u;s++){if(v[s].alias===w.size){r=v[s].transient_url;p=v[s].size.split("x");if(o>=x){this.imageWidth=p[0];this.imageHeight=this.imageWidth*x/o}else{this.imageHeight=p[1];this.imageWidth=this.imageHeight*o/x}}}}else{r=k.getPreviewThumbnail({model:t,useOriginal:true,container:this._parentView.container,containerHeight:document.body.getSize().height}).url}this.createNewImgTag(r)}},createNewImgTag:function(o){this.canvasEl=this.getElement("canvas");this.context=this.canvasEl.getContext("2d");var q=new Image(),p=this;q.crossOrigin="use-credentials";q.src=o;q.width=this.imageWidth;q.height=this.imageHeight;q.onload=function(){if(!p.isDestroyed()){var r;p.saveFirstPictureStateAsCanvas(this);if(!p.options.isNewMedia){p.imageHeight=this.height}r=p.getElement("#editor-canvas");if(r){r.parentElement.setStyle("min-height","0px");r.setAttribute("height",p.imageHeight);r.setAttribute("width",p.imageWidth)}p.context.drawImage(this,0,0,p.imageWidth,p.imageHeight);p.refreshImgTag();p.setSize(p.imageWidth,p.imageHeight)}}},refreshImgTag:function(){this.getElement("#editor-img").src=this.getElement("#editor-canvas").toDataURL()},_getImageAsDataUrl:function(){return this.getElement("#editor-canvas").toDataURL()},saveFirstPictureStateAsCanvas:function(o){var p=l.createElement("canvas",{id:"original-canvas",width:o.width,height:o.height,styles:{display:"none"}});p.getContext("2d").drawImage(o,0,0,o.width,o.height);this._operations.add(new i({type:"originalCanvas",id:this.currentOperationIndex,canvas:p}))},buttonClicked:function(o){o.stopPropagation();o.preventDefault();var p=o.target;switch(p.id){case"undo":this.undoOperation();break;case"redo":this.redoOperation();break;case"crop":this.startCrop();break;case"rotate":case"bnw":case"flip":this.addAndExecuteOperation(p.id);break}},setViewCanvas:function(p){var o=this.getElement("#editor-canvas");o.height=p.height;o.width=p.width;o.getContext("2d").drawImage(p,0,0)},brightnessChange:function(s){var q=s.dsModel||s.target,p=q.value,r=[],o=this._operations.at(this.currentOperationIndex).get("type");if(this.lastBrightnessOperationId!==null||o==="brightness"){this._operations.remove(this._operations.at(this.lastBrightnessOperationId));this.setViewCanvas(this._operations.at(this.lastBrightnessOperationId-1).getCanvas());r=this._operations.getOperationsAfterBrightness(this.lastBrightnessOperationId);this.currentOperationIndex=this._operations.length-1;this.replayOperationsWithoutBrightness(r)}this.addAndExecuteOperation("brightness",{brightness:p})},replayOperationsWithoutBrightness:function(q){for(var p=0,o=q.length;p<o;p++){this.addAndExecuteOperation(q[p].get("type"),l.merge({replay:true},q[p].get("params")))}},addAndExecuteOperation:function(o,v){var r,u=null,t=false,q=this.getElement("#"+o);q.disabled=true;if(v&&v.brightness){u=v.brightness}if(v&&v.replay){t=v.replay}if(v&&v.canvas&&(v.canvas instanceof HTMLCanvasElement)){r=v.canvas}else{r=this.getElement("canvas")}this.currentOperationIndex++;if(this._operations.at(this.currentOperationIndex)){this._operations.resetCollection(this.currentOperationIndex)}var p=new i({id:this.currentOperationIndex,type:o,brightnessValue:u,params:v});if(o==="brightness"){this.lastBrightnessOperationId=this.currentOperationIndex}this._operations.add(p);this.executeOperation(p,r);var s=l.createElement("canvas",{width:r.width,height:r.height});s.getContext("2d").drawImage(r,0,0);p.setCanvas(s);this.model.dispatchEvent("onPictureHasChanged",[true,this._getImageAsDataUrl()],this.model);if(!t){this.refreshImgTag()}this.updateUndoRedoButtons(this.currentOperationIndex);q.disabled=false},executeOperation:function(p,q){var o=q.getContext("2d");switch(p.get("type")){case"crop":this.cropOperation(q,o,p);break;case"rotate":this.rotateOperation(q,o);break;case"bnw":this.bnwOperation(q,o);break;case"flip":this.flipOperation(q,o);break;case"brightness":this.brightnessOperation(q,o,p.get("brightnessValue"));break}},makeCanvasCopy:function(o){var p=l.createElement("canvas",{width:o.width,height:o.height});p.getContext("2d").drawImage(o,0,0);return p},rotateOperation:function(p,q){var o=this.makeCanvasCopy(p),r=Math.PI/2;p.width=o.height;p.height=o.width;q.save();q.translate(o.height,0);q.rotate(r);q.drawImage(o,0,0);q.restore();this.setSize(p.width,p.height)},flipOperation:function(p,q){var o=this.makeCanvasCopy(p);q.save();q.scale(-1,1);q.translate(-p.width,0);q.fillStyle="#FFFFFF";q.clearRect(0,0,p.width,p.height);q.drawImage(o,0,0);q.restore()},bnwOperation:function(p,s){var x=s.getImageData(0,0,p.width,p.height);for(var t=0;t<x.data.length;t+=4){var w=x.data[t];var u=x.data[t+1];var o=x.data[t+2];var q=w+u+o;q/=3;x.data[t]=q;x.data[t+1]=q;x.data[t+2]=q}s.putImageData(x,0,0);this.bnwDone=true;this.getElement("#bnw").disabled=true},brightnessOperation:function(q,r,t){var p=r.getImageData(0,0,q.width,q.height),o=(t/100)*255;for(var s=0;s<p.data.length;s+=4){p.data[s]=p.data[s]+o;p.data[s+1]=p.data[s+1]+o;p.data[s+2]=p.data[s+2]+o}r.putImageData(p,0,0)},undoOperation:function(){if(this.currentOperationIndex>0){var p=this.getElement("canvas"),q=p.getContext("2d"),o=this._operations.at(this.currentOperationIndex).get("type"),r=this._operations.at(this.currentOperationIndex-1).getCanvas();this.setCanvasDimensions(p,{width:r.width,height:r.height});if(o==="crop"){this.setSize(r.width,r.height)}q.drawImage(r,0,0);this.refreshImgTag();if(o==="bnw"){this.bnwDone=false;this.getElement("#bnw").disabled=false}if(o==="brightness"){this.lastBrightnessOperationId=null;this.getElement("#brightness").value=0}this.currentOperationIndex--;if(this.currentOperationIndex===0){this.model.dispatchEvent("onPictureHasChanged",[false,this._getImageAsDataUrl()],this.model)}this.setSize(p.width,p.height)}this.updateUndoRedoButtons(this.currentOperationIndex)},redoOperation:function(){if(this.currentOperationIndex<this._operations.length){var o=this.getElement("canvas"),q=o.getContext("2d"),p=this._operations.at(this.currentOperationIndex+1),r=p.get("type"),s=p.getCanvas();this.setCanvasDimensions(o,{width:s.width,height:s.height});q.drawImage(s,0,0);this.refreshImgTag();switch(r){case"bnw":this.bnwDone=true;this.getElement("#bnw").disabled=true;break;case"brightness":this.lastBrightnessOperationId=this.currentOperationIndex;this.getElement("#brightness").value=p.get("brightnessValue");break;case"crop":this.setSize(s.width,s.height);break;default:break}this.currentOperationIndex++;this.model.dispatchEvent("onPictureHasChanged",[true,this._getImageAsDataUrl()],this.model);this.setSize(o.width,o.height)}this.updateUndoRedoButtons(this.currentOperationIndex)},setCanvasDimensions:function(o,p){o.width=p.width;o.height=p.height},updateUndoRedoButtons:function(o){var p=this.getElement("#undo"),q=this.getElement("#redo"),r=this._operations.length-1;if(o>0&&true===p.disabled){p.disabled=false}if(o===0&&false===p.disabled){p.disabled=true}if(o<r){q.disabled=false}if(o===r){q.disabled=true}},applyEditOperationsOnOriginalMedia:function(u){var r,o,t=this,q=this.model,p=new Image(),s=this.options.isNewMedia?q.getChanges("userFile"):q.get("play").download_original_url.transient_url;p.crossOrigin="use-credentials";p.onload=function(){var v=l.createElement("canvas",{width:p.width,height:p.height});var w=v.getContext("2d");w.drawImage(p,0,0,p.width,p.height);for(r=0,o=t.currentOperationIndex+1;r<o;r++){t.executeOperation(t._operations.at(r),v)}u(v)};p.src=s},saveOriginalMediaToModel:function(){if(this.originalImageUsedInEditor===true){this.saveCanvasToModel(this.getElement("canvas"))}else{this.applyEditOperationsOnOriginalMedia(this.saveCanvasToModel.bind(this))}},getMediaFileExtension:function(){var o=this.model,p,q;if(o.has("media_file_ext")){p=o.has("media_file_ext")}else{if(o.has("preview_media_file_ext")){p=o.has("preview_media_file_ext")}else{q=o.get("orig_name")||o.get("fileName")||o.getChanges("fileName");p=q?q.substring(q.lastIndexOf(".")+1):undefined}}return p},saveCanvasToModel:function(p){this._parentView.unmask();var o=this.model;if(["jpeg","jpg"].indexOf(this.getMediaFileExtension())>=0){o.addChanges("userFile",p.toDataURL("image/jpeg"))}else{o.addChanges("userFile",p.toDataURL())}o.addChanges("width",p.width);o.addChanges("height",p.height);if(!this.options.isInLightbox){o.dispatchEvent("mediaFileSavedToModel")}else{this._parentView.dispatchEvent("mediaEdited",[{isNewMedia:this.options.isNewMedia,model:this.model}])}},startCrop:function(){var p=this.getElement("#editor-img");this.getElement(".editor-toolbar").addClassName("crop-mode");var o=this.getElement(".canvas-editor-container");this.cropView=new b({widgetId:this._widget?this._widget.id:null,width:p.width,height:p.height});this.cropView.render(o);this.disableButtons();this.addCropButtons();this.addCropKeyboardShortcuts()},keypressCropHandler:function(o){a.log("event.keyCode: "+o.keyCode);if(13===o.keyCode){this.applyCrop()}if(27===o.keyCode){this.cancelCrop()}},addCropKeyboardShortcuts:function(){a.warn("addCropKeyboardShortcuts");var o=l.extendElement(document.body);o.addEvent("keyup",this.keypressCropHandlerBound)},removeCropKeyboardShortcuts:function(){a.warn("removeKeyboardShortcuts");var o=l.extendElement(document.body);o.removeEvent("keyup",this.keypressCropHandlerBound)},disableButtons:function(){var r=this.getElements("button.btn.btn-default");for(var p=0,o=r.length;p<o;p++){r[p].setAttribute("disabled",true)}var q=this.getElement("#brightness");q.setAttribute("disabled",true)},addCropButtons:function(){var o=this.getElement(".editor-toolbar");l.createElement("button",{"class":"apply-crop-btn btn btn-default",events:{click:this.applyCrop.bind(this)}}).inject(o);l.createElement("button",{"class":"cancel-crop-btn btn btn-default",events:{click:this.cancelCrop.bind(this)}}).inject(o)},applyCrop:function(){this.cropView.destroy();this.addAndExecuteOperation("crop",this.cropView.getInfos());this.updateToolbarAfterCrop();this.removeCropKeyboardShortcuts();this.getElement(".editor-toolbar").removeClassName("crop-mode")},cancelCrop:function(){this.cropView.destroy();this.updateToolbarAfterCrop();this.updateUndoRedoButtons(this.currentOperationIndex);this.removeCropKeyboardShortcuts();this.getElement(".editor-toolbar").removeClassName("crop-mode")},updateToolbarAfterCrop:function(){this.getElement("button.apply-crop-btn").remove();this.getElement("button.cancel-crop-btn").remove();var r=this.getElements("button.btn.btn-default");for(var p=0,o=r.length;p<o;p++){if(r[p].getAttribute("class")==="bnw-btn btn btn-default"){if(!this.bnwDone){r[p].disabled=false}}else{r[p].disabled=false}}var q=this.getElement("#brightness");q.disabled=false},cropOperation:function(s,o,r){var B,D,C,v,z=this.makeCanvasCopy(s),x=this.getElement("#editor-canvas"),A=x.getSize().width,u=this.getElement("#editor-img"),w=u.getSize().width,t,q=r.params;if(A!==w){t=A/w;q.width*=t;q.height*=t;q.left*=t;q.top*=t}if(this.getElement("#editor-canvas")!==s){var y=r.get("beforeCropCanvas");var p=(s.width/y.width);B=q.width*p;D=q.height*p;C=q.left*p;v=q.top*p}else{B=q.width;D=q.height;C=q.left;v=q.top;r.set("beforeCropCanvas",this.makeCanvasCopy(s));this.setSize(B,D)}s.width=B;s.height=D;o.drawImage(z,-C,-v)},setSize:function(p,o){if(!this.options.isInLightbox){p+=22;o+=22}if(p<560){p=560}o+=50;this.container.setStyles({width:p,height:o})},onSetModel:function(p,q,o){this.reactTo(o,"saveEditedMediaFileToModel",this.saveOriginalMediaToModel);this.reactTo(o,"onNewMediaUploaded",this.onRedraw);this.reactTo(o,"onSync:update",this.onRedraw)}});return f});define("DS/SwymUIComponents/script/feature/community/media/edit/content-edit-media-lightbox",["UWA/Core","UWA/Event","UWA/Utils/Client","DS/SwymUIComponents/script/feature/community/media/view/abstract-lightbox-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/media-lightbox","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/edit/content-edit-media-lightbox","DS/SwymUIComponents/script/feature/community/media/editor/view/image-editor-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button"],function(j,k,c,a,f,i,d,h,b,g){var e=a.extend({name:"content-edit-media-lightbox",_viewToUpdate:null,displayActionsOnHeader:false,titleInteraction:false,getContentView:function(){var l=this._getImageEditor();return[l,this._createPublishBar()]},_getImageEditor:function(){var l=this.getChildView("imageEditorView");if(!l){l=this.addChildView("imageEditorView",{Class:"DS/SwymUIComponents/script/feature/community/media/editor/view/image-editor-view",model:this.model,isNewMedia:this.options.isNewMedia,isInLightbox:true})}return l},removeContentView:function(){var l=this.getChildView("imageEditorView");if(l){l.destroy()}},setup:function(l){this._parent.apply(this,arguments);if(l.hasOwnProperty("viewToUpdate")){this._viewToUpdate=l.viewToUpdate}this.addEvent("mediaEdited",this._onMediaEdited)},_onMediaEdited:function(l){this.destroy();if(this._viewToUpdate){this._viewToUpdate.dispatchEvent("mediaEdited",l)}},_saveNewMediaEdited:function(){if(this.options.isNewMedia){this.getChildView("imageEditorView").dispatchEvent("saveMediaEdited");this.mask()}else{var l=new b({renderTo:window.document&&window.document.body}),m=this;l.confirm(f.DefinitiveChangement,f.AreYouSure,function(n){if(n){m.getChildView("imageEditorView").dispatchEvent("saveMediaEdited");m._viewToUpdate.mask();m.mask()}})}},_createPublishBar:function(){return{"class":"publish-section",html:{"class":"right-elements",html:[{tag:"div","class":"buttons",html:[this.addControl("publishButton",new g({value:i.Publish,className:"primary publish-button",icon:"check",events:{onClick:function(){if(this.getChildView("imageEditorView").currentOperationIndex){this._saveNewMediaEdited()}else{this.destroy()}}.bind(this)}})),this.addControl("cancelButton",new g({value:i.Cancel,className:"default btn-cancel",styles:{width:""},icon:"wrong",events:{onClick:function(){this.destroy()}.bind(this)}}))]}]}}}});return e});define("DS/SwymUIComponents/script/feature/core/user/view/bot-tile-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/user-search-view","DS/SwymUIComponents/script/feature/community/members/view/member-tile-view","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/feature/core/command/commands-controller","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUICore/assets/nls/feature/core/user/collection/member-collection"],function(g,c,f,e,d,b,a){return f.extend({name:"bot-tile-view",_appIconUrl:"",domEvents:{"click .member-tile":"_onDoNothing"},_onDoNothing:function(){},_createPictureView:function(){var h=this;if(!h._appIconUrl){d._getCommands(function(j,i){i.forEach(function(k){if(k.botUsername===h.model.get("uri")){h._appIconUrl=k.appIconURL;h.refresh()}})})}return h._appIconUrl?g.createElement("div",{"class":"bot-picture",html:[{tag:"img",src:h._appIconUrl}]}):""},_getCurrentRoleName:function(){return a.Bot||"Bot"},_getInlineActionsUpdate:function(h){return[{name:"delete",text:a.Delete,fonticon:"trash"}]},_displayBasicInfo:function(){var h=this.model;return{styles:{"text-align":"center"},html:[{"class":"user-name member-name",html:("<a>"+h.get("first_name")+"</a>")},{styles:{margin:"10px 0","font-style":"italic"},html:((h.has("job_title")&&h.get("job_title").trim()!=="")?h.get("job_title"):"")+((h.has("company")&&h.get("company").trim()!=="")?((h.has("job_title")&&h.get("job_title").trim()!=="")?", ":"")+h.get("company"):"")}]}}})});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-transfer-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/idea/view/idea-transferred-link-view","DS/SwymUIComponents/script/feature/community/idea/view/idea-transfer-form-view"],function(e,d,c,b){var a=d.extend({name:"idea-transfer-view",ideaTransferFormViewDisplayed:false,ideaTransferredLinkViewDisplayed:false,_createContent:function(){var g=this,f;f=e.createElement("div",{html:[g.getChildView("ideaTransferredLinkView"),g.getChildView("ideaTransferFormView")]});return f},dispatchDisplayEvent:function(){if(this.ideaTransferredLinkViewDisplayed===false&&this.ideaTransferFormViewDisplayed===false){this.dispatchEvent("DisplayEvent",false)}else{this.dispatchEvent("DisplayEvent",true)}},_onCommunityModelSyncRead:function(){var g=this,f=g.getChildView("ideaTransferredLinkView"),h=g.getChildView("ideaTransferFormView"),i=(parseInt(g.model.getCommunity().get("this").getCurrentUserRights)>=3);if(!f){f=g.addChildView("ideaTransferredLinkView",new c({isCommunityOwner:i,model:g.model,widget:g._widget}))}else{f.setModel(g.model)}if(i){if(!h){h=g.addChildView("ideaTransferFormView",new b({isCommunityOwner:i,model:g.model,widget:g._widget}))}else{h.setModel(g.model)}g.reactTo(h,"IdeaTransfer",function(j){g.dispatchEvent("IdeaTransfer",j)})}g.reactTo(f,"IdeaTransfer",function(j){g.dispatchEvent("IdeaTransfer",j)});g.refresh()},_onModelSyncRead:function(){var f=this;if(f.model.getCommunity().get("this")){f._onCommunityModelSyncRead()}else{f.model.getCommunity().addEventOnce("onSync:read",f._onCommunityModelSyncRead,f)}},setup:function(g){var f=this._parent.apply(this,arguments),h=this;if(!e.is(h.model.get("acl_status"))){h.model.addEventOnce("onSync:read",h._onModelSyncRead,h)}else{h._onModelSyncRead()}return f}});return a});define("DS/SwymUIComponents/script/feature/community/community/view/community-new-request-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-new-request-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-creation-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/community/model/community-request-model","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select"],function(j,e,c,i,f,k,b,m,l,h,g,a){var d=i.extend({_modelClass:k,_mode:null,name:"community-new-request-view",_createContent:function(){var o=this.model,q=this._mode;if(o){var p=(q==="edit")?{tag:"div",styles:{padding:"10px","margin-bottom":"10px"},"class":"bg-request-pending",html:o.get("additional_comment")}:null;var r=i.extend({_modelClass:k,attributes:{tag:"div","class":"first-step"},_createContent:function(){return{html:[p,this.addControl("firstForm",new h({fields:[{type:"text",name:"title",maxlength:255,label:e.communityName,placeholder:e.chooseName,value:(q==="edit")?(o.get("title",{escapeHTML:false})):"",required:true,events:{onChange:function(){o.addChanges("title",this.getValue().trim())}}},{type:"radio",name:"visiblity",label:e.Public,checked:(q==="edit"&&o.get("access")==="1")?true:false,events:{onChange:function(){o.addChanges("intranet_access",1)}}},{type:"radio",name:"visiblity",label:e.Private,checked:(q==="edit"&&o.get("access")==="0")?true:false,events:{onChange:function(){o.addChanges("intranet_access",0)}}},{type:"radio",name:"visiblity",label:e.Secret,checked:(q==="edit")?((o.get("access")==="4")?true:false):true,events:{onChange:function(){o.addChanges("intranet_access",4)}}}]}))]}}.bind(this)});var n=i.extend({_modelClass:k,attributes:{tag:"div","class":"second-step"},_createContent:function(){var x=this,w=m.getInstance().get("user");if(q!=="edit"&&o.isNew()){o.addChanges("primary_community_owner_hash_key",w.hash_key)}else{o.addChanges("primary_community_owner_hash_key",o.get("primary_community_owner_user_hash_key"))}return{html:[p,this.addControl("secondForm",new h({fields:[{type:"textarea",name:"description",maxlength:250,label:e.communityDescription,placeholder:e.giveDescription,value:(q==="edit")?(o.get("description",{escapeHTML:false})):"",required:true,events:{onChange:function(){o.addChanges("description",this.getValue().trim())}}},{type:"textarea",name:"benefits",maxlength:250,label:e.expectedBenefits,placeholder:e.keyBenefits,value:(q==="edit")?(o.get("benefits",{escapeHTML:false})):"",required:true,events:{onChange:function(){o.addChanges("benefits",this.getValue().trim())}}},b.getFormConfig({label:e.communityOwner,defaultValue:(q==="edit")?o.get("primary_community_owner").nickname:w.first_name+" "+w.last_name,events:{onSelect:function(y){if(y.ut_state==="0"){this.resetInput();o.addChanges("primary_community_owner_hash_key",w.hash_key);x.alert("error",c.Apendingusercannotbechosenasacommunitymainowner)}else{o.addChanges("primary_community_owner_hash_key",y.hash_key)}}}})]}))]}}.bind(this)});var s=this.addControl("previousButton",new g({value:e.Previous,events:{onClick:function(){this.getControl("requestModal").setHeader("<h4>"+e.communityCreationRequest+" (1/2)</h4>");this.getControl("previousButton").hide();this.getControl("nextButton").show();this.getControl("sendButton").hide();this.getChildView("secondStep").hide();this.getChildView("firstStep").show()}.bind(this)}}));var u=this.addControl("nextButton",new g({value:e.Next,events:{onClick:function(){if(this.getControl("firstForm").validate()){if(o.getChanges("title")&&o.getChanges("title")!==""){o.checktitleuniqueness({onComplete:function(x,w){if(w.result===true){this.getControl("requestModal").setHeader("<h4>"+e.communityCreationRequest+" (2/2)</h4>");this.getControl("previousButton").show();this.getControl("nextButton").hide();this.getControl("sendButton").show();this.getChildView("firstStep").hide();this.getChildView("secondStep").show()}else{this.getControl("firstForm").getFields()[0].getParent(".form-group").addClassName("has-error");this.alert("error",e.similarCommunityNameAlreadyExists)}}.bind(this)})}else{if(!o.isNew()&&o.getChanges("title")!==""){this.getControl("requestModal").setHeader("<h4>"+e.communityCreationRequest+" (2/2)</h4>");this.getControl("previousButton").show();this.getControl("nextButton").hide();this.getControl("sendButton").show();this.getChildView("firstStep").hide();this.getChildView("secondStep").show()}}}}.bind(this)}}));var t=this.addControl("sendButton",new g({value:(q==="edit")?e.Update:e.Send,className:"primary",events:{onClick:function(){if(this.getControl("secondForm").validate()){if(o.isNew()&&o.getChanges("description")&&o.getChanges("benefits")&&o.getChanges("primary_community_owner_hash_key")){this.getControl("previousButton").setDisabled();this.getControl("sendButton").load();o.save({},{onComplete:function(){this.getControl("requestModal").hide();this.alert("success",e.thankYouWeAreGoingToAnalizeYourRequest)}.bind(this)})}else{if(!o.isNew()&&q==="edit"&&o.getChanges("description")!==""&&o.getChanges("benefits")!==""){this.getControl("previousButton").setDisabled();this.getControl("sendButton").load();o.set(o.getChanges());o.action("update",{onComplete:function(){this.getControl("requestModal").hide();this.alert("success",e.thankYouWeAreGoingToAnalizeYourRequest)}.bind(this)})}}}}.bind(this)}}));if(q!=="edit"&&o.isNew()){o.addChanges("intranet_access",4)}else{o.addChanges("intranet_access",o.get("access"))}var v=this.addControl("requestModal",new l({header:"<h4>"+e.communityCreationRequest+" (1/2)</h4>",body:[this.addChildView("firstStep",{Class:r,model:o}),this.addChildView("secondStep",{Class:n,model:o})],footer:[t,s,u],closable:true,events:{onShow:function(){this.getControl("previousButton").hide();this.getControl("nextButton").show();this.getControl("sendButton").hide();this.getChildView("firstStep").show();this.getChildView("secondStep").hide()}.bind(this),onHide:function(){this.destroy()}.bind(this)}}));return v}},show:function(){this.getControl("requestModal").show()},setup:function(n){if(n){if(n.hasOwnProperty("mode")){this._mode=n.mode}}return this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/community/community/view/community-request-status-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-request-status-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/community/collection/community-request-collection","DS/SwymUIComponents/script/feature/community/community/view/community-request-view","DS/SwymUIComponents/script/feature/community/community/view/community-new-request-view","DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/navigation","DS/SwymUIComponents/script/feature/core/modal/modal"],function(g,d,f,e,b,k,j,l,i,a,h){var c=f.extend({_communityRequestCollection:null,name:"community-request-status-view",_createContent:function(){var m=i.getInstance().get("config").tenant,n,p,o;var q=e.extend({_collectionClass:b,name:"community-history-request-collection-view",modelViewClass:k,_createModelView:function(){var r=this._parent.apply(this,arguments);r.addEvent("onCommunityRequestClicked",this._onCommunityRequestClicked,this);return r},_onCommunityRequestClicked:function(s,r){if(s.get("status")==="1"){a.goToCommunity(s.get("mid"));this.getControl("communityRequestStatusModal").hide()}else{if(s.get("status")==="2"||s.get("status")==="0"){}else{if(s.get("status")==="3"){var t=new j({model:s,mode:"edit"});t.render(this._widget.body);t.show();this.getControl("communityRequestStatusModal").hide()}}}}.bind(this),attributes:{tag:"table","class":"table table-reset table-hover table-condensed",styles:{"margin-bottom":"0"}},bodyAttributes:{tag:"tbody"},modelViewsCfg:{attributes:{tag:"tr",styles:{cursor:"pointer"}}}});if(m.plan_a_community===true){if(this._communityRequestCollection&&this._communityRequestCollection.length>0){n=new q({collection:this._communityRequestCollection})}else{n=g.createElement("div",{styles:{padding:"10px","text-align":"center"},html:d.NoCommunityRequest})}p=new l({collection:this._communityRequestCollection});o=this.addControl("communityRequestStatusModal",new h({closable:true,header:"<h4>"+d.MyCommunityRequests+"</h4>",body:[n,p],events:{onHide:function(){this.destroy()}.bind(this)}}))}else{n=g.createElement("div",{styles:{padding:"10px","text-align":"center"},html:d.TheCommunityPlanningFunctionalityIsDisabled});o=this.addControl("communityRequestStatusModal",new h({closable:true,header:"<h4>"+d.MyCommunityRequests+"</h4>",body:n,events:{onHide:function(){this.destroy()}.bind(this)}}))}return o},show:function(){this.getControl("communityRequestStatusModal").show()},setup:function(m){if(m){if(m.hasOwnProperty("communityRequestCollection")){this._communityRequestCollection=m.communityRequestCollection}}return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/utils/w3dxcomponents-utils",["UWA/Core","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/utils/scrollview-utils","DS/UIKIT/Mask","DS/WebappsUtils/WebappsUtils"],function(f,g,j,h,b,e,i,c,a){var d={checkOptions:function(k){if(!k){throw new Error("Missing arguments")}if(!k.widget){throw new Error("Please provide a widget instance")}if(!k.skeleton){throw new Error("Please provide a skeleton instance")}return f.extend({},k)},getComponentSpritesReloadFn:function(){return g.getDelayedSyncTask(function(){var k;if(this.isDestroyed!==true){k={el:this.container,nonReloadedImagesOnly:true};if(this._tempModelWithLogoChanged){k.modifiedId=this._tempModelWithLogoChanged;this._tempModelWithLogoChanged=undefined}}},100)},getEmptyViewDefaultOptions:function(){return null},getComponentListeners:function(){return null},_maskViewWhenFirstPageIsRequested:function(k){if((this.collection===k)&&this.container&&this.collection&&(this.collection.getCurrentPage()===1)){c.mask(this.container)}},_unmaskView:function(k){if(this.collection===k&&this.container){c.unmask(this.container)}},getViewListeners:function(k){var n=k,m=this.reloadSprites,l=this;return{onRender:function(){if(n.view!==this){n.view=this;var o=this.collection;if(o){this.listenTo(o,{onRequest:l._maskViewWhenFirstPageIsRequested,onSync:l._unmaskView,onError:l._unmaskView})}}m.call(this,n)},onPullToRefresh:i.onPullToRefresh,onInfiniteScroll:i.onInfiniteScroll}},reloadSprites:function(l){var k=l.view;if(typeof l.reloadCmpSprites==="function"){if(k&&k.isDestroyed!==true){l.reloadCmpSprites.call(k)}}},getItemViewOptions:function(k){var m=k,l=this.reloadSprites;return{mapping:this._itemViewMapping(k),templateHelpers:{imgAttrs:this._imgAttrsForItemView},events:{onRender:function(){l.call(this,m)}}}},_imgAttrsForItemView:function(){var r,q,l,k,m,o,n=this.model;if(n instanceof h){l=n.getModelName();switch(l){case"media":r=n.get("mid");m=false;o=n.get("update")||n.get("publish_date");break;case"community":r=n.get("mid");m=true;o=n.get("settings_update")||n.get("update");break;default:r=n.get("thumbnail->mid");if(r){m=false;q=n.getAssociated("thumbnail");o=(q.get("update")||q.get("publish_date")||n.get("update")||n.get("publish_date"))}else{m=true;r=n.get("community->mid");k=n.getAssociated("community");o=(k.get("settings_update")||k.get("update")||n.get("update")||n.get("publish_date"))}break}var p={id:r,communityLogo:m,imageUpdateTime:o,imageFingerprint:n.get("preview_fingerprint"),cls:"dsi-communities-home-list-picture",modelId:n.get("mid"),modelName:l,size:"m",imageKind:"thumb"};if(this.options.as_admin){p.as_admin=this.options.as_admin}return j.getMediaThumbnailAttributes(p)}},_itemViewMappingForEndorseCount:"nb_endorse",_itemViewMappingForCommentCount:function(){var l=0,k=this.model;if(k instanceof h){if(k.getModelName()==="iquestion"){l=k.get("nb_answers")}else{l=k.get("nb_comments")}}return l},_itemViewMappingForIcon:function(){var k="";if(this.model instanceof h){k=g.getContentIconUrl(this.model)}return k},_itemViewMappingForFontIcon:function(){var l="",k=this.model;if(k instanceof h){if(k.getModelName()==="media"){l=g.getMediaIconName(k)}else{l=g.getIconFromModel(k)}}return l},_itemViewMapping:function(l){var k=(l&&l.fontIcon===true)?this._itemViewMappingForFontIcon:this._itemViewMappingForIcon;return{title:this._itemViewMappingForTitle,image:this._itemViewMappingForImage,content:this._itemViewMappingForContent,subtitle:this._itemViewMappingForSubtitle,ownerName:this._itemViewMappingForOwnerName,endorseCount:this._itemViewMappingForEndorseCount,commentCount:this._itemViewMappingForCommentCount,icon:k}},_itemViewMappingForTitle:function(){return(this.model.get("title")||"")},_itemViewMappingForContent:function(){var l="",k=this.model;if(k instanceof h){if(k.getModelName()==="community"){l=k.get("description")}else{l=k.get("summary")}}return l},_itemViewMappingForSubtitle:function(){var m,l="",k=this.model;if(k instanceof h){if(k.getModelName()==="community"){l=e.prettyDate(k.get("content_update"))}else{l=k.get("community->title");m=e.prettyDate(k.getPublishingDate());if(l){l+=(" - "+m)}else{l=m}}}return l},_itemViewMappingForOwnerName:function(){var l="",k=this.model;if(k instanceof h){if(k.getModelName()==="community"){l=k.get("owner->nickname")}else{l=k.get("author->nickname")}}return l},_itemViewMappingForImage:function(){var k=this.model;return b.constructThumbnailUrl((k.getModelName&&k.getModelName()),k.get("mid"),"m_thumb",k.get("preview_fingerprint"))},getFacetViewPanelIndex:function(l){var k=null,m=l.facetView;if(l.skeleton.displayedNodes){l.skeleton.displayedNodes.detect(function(o,n){var p;if(o.activeNode&&(p=o.activeNode.activeFacet)){if(p.views.main===m||p.views.small===m){k=n;return true}}})}else{l.skeleton.currentRouteSteps.detect(function(p,n){var o,r,q;if(p.get("isPanelRendered")){o=p.get("panelNode");q=o?o.get("activeNode"):null;r=q?q.get("activeFacet"):null;if(r&&(r.view===l.facetView)){k=n;return true}}})}return k}};return d});define("DS/SwymUIComponents/script/utils/contentset-options-utils",["UWA/Core","UWA/Array","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/Item/ActionsInlineView","DS/SwymUIComponents/script/utils/w3dxcomponents-utils","i18n!DS/SwymUIComponents/assets/nls/utils/utils","DS/W3DXComponents/ContentSet","DS/W3DXComponents/Views/EmptyView","DS/W3DXComponents/Views/Layout/ListView"],function(h,d,f,b,i,c,j,a,g){var e=h.merge({getViewList:function(m){var n,o=[],l=j.prototype.defaultOptions.contents.views,k=d.isArray(m.contentSetViewsId)?m.contentSetViewsId:["list"],p=h.is(m.defaultViewId,"string")?m.defaultViewId:m.facetViewMode?m.facetViewMode:k[0];k.forEach(function(s,q){var r={view:null,fontIcon:true,reloadCmpSprites:this.getComponentSpritesReloadFn()};n={id:s,"default":p===s,selectionMode:((window.ds&&ds.env==="3DSwym")?"":"oneToOne"),className:"hidden-empty-view",events:this.getViewListeners(r)};switch(s){case"tile":case"thumbnail":case"list":case"table":r.fontIcon=false;h.merge(n,l.detect(function(t){return t.id===s}));break;default:break}h.extend(n,{itemViewOptions:this.getItemViewOptions(r)});o.push(n)},this);return o},getContentSetOptions:function(m){var l=this.checkOptions(m),k=(l.isActions===false)?{}:this.getNewActionsViewConfig(l.hideRssIcon),n=this.getEmptyViewDefaultOptions();l.skeletonOptionsInstance=this;l.switchEvent=true;return{actions:k,contents:{emptyView:!n?a:a.extend({defaultOptions:n}),views:this.getViewList(l)},events:this.getComponentListeners(l)}},getNewActionsViewConfig:function(l){var k=[];k.push({id:"add-content",title:c.AddContent,icon:"plus",context:true,overflow:false});if(l!==true){k.push({id:"rss-feed",icon:"rss",context:true,overflow:false})}return{view:b,collection:new f(k)}}},i);return e});define("DS/SwymUIComponents/script/feature/community/report-abuse/view/report-new-abuse-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/report-abuse/view/report-new-abuse-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/report-abuse/model/report-abuse-model-v2","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/WebappsUtils/Console"],function(l,h,j,a,m,p,n,k,i,c){var e="confidentialContent",g="inappropriateBehaviour",q="personalAttacksHarassment",d="other";var b=function(s){var r=document.createElement("div");r.innerHTML=s;return r.textContent||r.innerText||""},o=function(r,s){if(r.length>s){return(r.substring(0,s)+"...")}else{return r}},f=j.extend({_modelClass:a,_reportedModel:null,name:"report-new-abuse-view",_createContent:function(){var A=this,s,w,x=h.Title,y=this.model,t=p.getInstance(),B,D,r,u=this._reportedModel,v=null,z=[],C=(u===null)?"":(u.getModelName()==="instant-message"||u.getModelName()==="comment"||u.getModelName()==="iq-answer"||u.getModelName()==="iqa-comment"?(u.get("comment")||u.get("answer")):(u.get("comment")||u.get("title")));C=l.is(C,"string")?o(b(C),50):"";if(y&&u){switch(u.getModelName()){case"iquestion":x=h.Iquestion;w="Question";break;case"post":x=h.Post;w="Post";break;case"media":x=h.Media;w="Media";break;case"wiki":x=h.Wiki;w="Wiki";break;case"survey":x=h.Survey;w="Survey";break;case"idea":x=h.Idea;w="Idea";break;case"iq-answer":x=h["Iq-answer"];w="Answer";v=u.getAssociated("answeredFor");break;case"iqa-comment":x=h["Iqa-comment"];w="Comment";v=u.getAssociated("commented").getAssociated("answeredFor");break;default:x=h.Comment;w="Comment";v=u.getAssociated("commented");if(v.getModelName()==="instant-message"){w="InstantMessage";x=h.Message}break}if(!v){v=u}B=v.get("community->mid")||t.communityId,D=v.getModelName()||t.contentType;r=v.get("mid")||t.contentId;s=(window.ds&&(ds.env==="3DD"))?m.get3DDTransientAppUrl({appId:m.getMyCommunitiesAppKey(),community:B,contentType:D,contentId:r}):(m.getBaseUrl()+v.getRelativePath());y.addChanges({subjectType:w,subjectTitle:C,subjectUri:u.get("subject6wuri"),parentCommentUri:u.get("parentCommentUri")});this.addControl("cancelButton",new i({value:h.Cancel,events:{onClick:function(E){this.getControl("reportAbuseModal").hide()}.bind(this)}}));this.addControl("confirmButton",new i({value:h.Ok,className:"primary",events:{onClick:function(){var F=this;if(this.getControl("reportAbuseForm").validate()&&z.length>0){this.getControl("confirmButton").load();this.getControl("cancelButton").setDisabled();var G="";y.addChanges("reasons",z);var E=function(){y.save({},{onComplete:function(I,H){F.getControl("reportAbuseModal").hide();F.alert("success",h.YourReportHasBeenSent)},onFailure:function(I,H){F.alert("error",h.YourReportHasNotBeenSent)}})};require(["DS/SwymUICore/script/feature/community/community/model/community-model"],function(H){(new H({mid:B},{autoPopulate:true,onPopulate:function(I){y.addChanges("contextUri",I.get("subject6wuri"));E()}}))})}}.bind(this)}}));this.addControl("reportAbuseModal",new n({header:"<h4>"+h.ReportAnAbuse+"</h4>",body:this.addControl("reportAbuseForm",new k({fields:[{type:"text",name:"page",label:h.AbusePage,value:s,disabled:true},{type:"text",name:"title",label:x,value:C,disabled:((u===null)?false:true),required:true,events:{onChange:function(E){y.addChanges("subjectTitle",this.getValue())}}},{type:"html",html:"<label>"+h.Reason+' <span class="label-field-required"> *</span></label>'},{type:"checkbox",name:"reason",label:h.ConfidentialContent,events:{onChange:function(F){if(this.isChecked()){z.push(e)}else{var E=z.indexOf(e);z.splice(E,1)}}}},{type:"checkbox",name:"reason",label:h.InappropriateBehaviour,events:{onChange:function(F){if(this.isChecked()){z.push(g)}else{var E=z.indexOf(g);z.splice(E,1)}}}},{type:"checkbox",name:"reason",label:h.PersonalAttacksHarassment,events:{onChange:function(F){if(this.isChecked()){z.push(q)}else{var E=z.indexOf(q);z.splice(E,1)}}}},{type:"checkbox",name:"reason",label:h.Other,events:{onChange:function(F){if(this.isChecked()){z.push(d)}else{var E=z.indexOf(d);z.splice(E,1)}}}},{type:"textarea",name:"comment",label:h.Comments,required:true,styles:{"max-width":"100%","min-width":"100%"},events:{onChange:function(E){y.addChanges("description",this.getValue())}}}]})),footer:[this.getControl("confirmButton"),this.getControl("cancelButton")],closable:true,events:{onHide:function(){A.destroy()}}}));return this.getControl("reportAbuseModal")}},show:function(){this.getControl("reportAbuseModal").show()},setup:function(r){if(r){if(r.hasOwnProperty("reportedModel")){this._reportedModel=r.reportedModel}}return this._parent.apply(this,arguments)}});return f});define("DS/SwymUIComponents/script/feature/community/idea/view/link-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/link-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/community/idea/model/link-model","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/utils/utils"],function(i,e,g,j,a,b,c,f,h){var d=g.extend({_modelClass:j,_modelEventsForAutoRefresh:["onChange"],_modelEvents:{"onRequest:delete":"mask","onError:delete":"unmask"},name:"link-view",_userCanDeleteLink:true,domEvents:{"click .delete-link":"onDeleteLinkClick"},_createContent:function(){var p=this.model;if(p){var w,y,m,x,t=p.get("content_title"),o=p.get("model_title"),l=p.get("url",{escapeHTML:false}),s=p.get("type"),k=p.get("model_id"),v=p.get("model"),n=null,q=p.get("ideation_id"),r=p.getAssociated("community"),u=p.get("leaf_model");if(p.get("community_accessible")===true){w=i.createElement("div",{"class":"dsi-result-direct-wrapper",html:[{tag:"a",target:"_blank","data-content-type":"community","data-content-id":r.get("mid"),html:e.Linktoacontentofthiscommunity+r.get("title")}]})}else{if(s==="internal"&&p.hasAssociation("linkedModel")){this._contentTypeUrlPart=p.get("contentTypeUrlPart");x=r.get("mid");m=p.getAssociated("linkedModel").getModelName();n=new c({id:q});w=i.createElement("div",{html:[{tag:"div","class":"dsi-result-direct-wrapper",html:[(this._userCanDeleteLink?{tag:"div","class":"delete-link",styles:{"float":"right",margin:"0 0 10px 10px"},title:e.Deletethislink,html:[{"class":"red-cancel-communities"}]}:""),{tag:"div",html:[{tag:"a","class":"content-thumbnail-link","data-type":"internal","data-content-type":m,"data-content-id":k,"data-community-id":x,href:"#",html:a.renderMediaThumbnail({width:46,height:34,id:k,modelId:k,modelName:this._contentTypeUrlPart,cls:"dsi-communities-home-list-picture"})}]},{tag:"div",html:[{tag:"span","class":"content-link",html:[{tag:"span","class":"fonticon fonticon-"+h.getIconFromModel(p.get("contentTypeUrlPart"))},{tag:"a","data-type":"internal","data-content-type":m,"data-content-id":k,"data-community-id":x,href:"#",html:o}]}]},{tag:"div","class":"link-title community-link",html:[{tag:"span",html:e.In+" "},{tag:"span",html:{tag:"a","data-type":"internal","data-content-type":"community","data-content-id":x,href:"#",html:r.get("title")}}]}]}]})}else{if(s==="external_url"){w=i.createElement("div",{"class":"dsi-result-direct-wrapper",html:[(this._userCanDeleteLink?{tag:"div","class":"delete-link",styles:{"float":"right",margin:"0 0 10px 10px"},title:e.Deletethislink,html:[{"class":"red-cancel-communities"}]}:""),{tag:"span","class":"content-link",html:{tag:"a",target:"_blank",href:l,html:t}}]})}}}return w}},onCommunityLinkClick:function(l){l.stopPropagation();l.preventDefault();var k=this.model.get("community");this._context.reset({contentId:k.mid,contentType:"community"})},onContentLinkClick:function(l){l.stopPropagation();l.preventDefault();var k=this.model;this._context.reset({contentId:k.get("model_id"),contentType:this._contentTypeUrlPart,communityId:k.get("community").mid})},onDeleteLinkClick:function(){var k=this.getControl("deleteConfirmationModal");if(!k){k=this.addControl("deleteConfirmationModal",new b({closable:false,renderTo:this._widget.body}))}k.confirm(e.Doyouwanttodeletethislink,e.Confirm,function(l){if(l===true){this.alert("success",e.Thelinkhasbeendeleted);this.model.destroy()}else{k.dispatchEvent("onCancel")}}.bind(this))},setup:function(k){if(k.hasOwnProperty("userCanDeleteLink")){this._userCanDeleteLink=k.userCanDeleteLink}this._context=f.getInstance();return this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/core/tenant/view/user-admin-view",["i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/user-admin-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/request/data","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UWPClientCode/I18n"],function(d,i,e,g,f,h,a,b){var c=e.extend({model:null,mode:"view",name:"user-admin-view",_confirmModal:null,domEvents:{"click .delete-icon":"_deleteAdmin"},_createContent:function(){if(this.model){var j=this.model,l=this.addChildView("userPicture",{Class:g,model:j,imageRenderingOptions:{format:"mini"}}),k={"class":"user-admin-item",html:[{"class":"user-admin-pic",html:l},{styles:{"float":"left"},html:'<div class="nickname" title="'+j.getNickname()+'">'+j.getNickname()+"</div>"},(j.get("is_inherited_acl")==="0"?{styles:{"float":"left",width:"17px"},html:'<div class="delete-icon" style="cursor: pointer; padding: 7px 0 0 10px; float:right;">X</div>'}:"")]};return k}},_deleteAdmin:function(){this._confirmModal.confirm(b.replace(d.Areyousure,{nickname:this.model.getNickname()}),d.Confirm,function(j){if(j===true){var k=i.adaptService.call({},{url:f.getBaseUrl()+"/api/User/unsetTenantModeratorACL",data:{hash_key:this.model.get("hash_key")},onComplete:function(){this.model.collection.remove(this.model)}.bind(this)});h.request(k)}}.bind(this))},setup:function(){this._parent.apply(this,arguments);this._confirmModal=new a({closable:false,renderTo:this._widget.body})}});return c});define("DS/SwymUIComponents/script/feature/community/idea/view/link-collection-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/idea/collection/link-collection","DS/SwymUIComponents/script/feature/community/idea/view/link-view"],function(e,c,d,b){var a=c.extend({_collectionClass:d,name:"link-collection-view",_userCanDeleteLink:true,_createContent:function(){var h,g=this.collection;if(g){var f=e.createElement("div",{"class":"comments"});g.forEach(function(i){if(i.get("type")==="internal"&&!i._associations.linkedModel.hasOwnProperty("associated")){this.collection.addEvent("onAddIdeaLink",function(j){h=new b({model:j,userCanDeleteLink:this._userCanDeleteLink,widget:this._widget});h.render({target:f})}.bind(this))}else{h=new b({model:i,userCanDeleteLink:this._userCanDeleteLink,widget:this._widget});h.render({target:f})}},this);return f}},setup:function(f){if(f.hasOwnProperty("userCanDeleteLink")){this._userCanDeleteLink=f.userCanDeleteLink}this._parent.apply(this,arguments)}});return a});define("DS/SwymUIComponents/script/feature/core/tenant/view/user-admin-collection-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/SwymUIComponents/script/feature/core/tenant/view/user-admin-view","DS/WebappsUtils/Console"],function(f,e,d,a,c){var b=e.extend({_collectionClass:d,modelViewClass:a});return b});define("DS/SwymUIComponents/script/feature/core/tenant/view/role-assignment-home-view",["UWA/Core","DS/SwymUICore/script/lib/model/generic/swym-model","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/role-assignment-home-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/collection/user-collection","DS/SwymUIComponents/script/feature/core/search/view/user-search-factory","DS/SwymUIComponents/script/feature/core/tenant/view/user-admin-collection-view","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/request/data","DS/WebappsUtils/Console"],function(j,l,g,h,d,c,e,a,i,k,b){var f=h.extend({model:null,_el:null,_confirmModal:null,_adminCollection:null,name:"role-assignment-home-view",_createContent:function(){this._confirmModal=new a({closable:false,renderTo:this._widget.body});this._adminCollection=new d([],{mode:"listtenantmoderators",limit:999,tenantId:this.model.get("tenant_uuid")});this._adminCollection.addEvent("onRemove",function(){this.alert("success",g.Admindeletedsuccessfully)},this);this._adminCollection.fetch();var m=j.createElement("div",{styles:{padding:"10px"},html:[{styles:{"margin-bottom":"10px"},html:g.AddTAdmin},this.addControl("user-search-control",c.createUserSearchControl({events:{onSelect:function(n){console.log("An element has been selected");this._confirmModal.confirm("Are you sure you want to add "+n.label+" as administrator of this tenant?",g.Confirm,function(o){if(o==true){var p=l.adaptService.call({},{url:i.getBaseUrl()+"/api/User/setTenantModeratorACL",data:{hash_key:n.hash_key},onComplete:function(s){var q=this.view,r=q.getControl("user-search-control");this.user.is_inherited_acl="0";q._adminCollection.add(this.user);if(r){r.reset()}q.alert("success",g.Adminaddedsuccessfully)}.bind({view:this,user:n}),onFailure:function(q){if(q.errorcode=="ERROR_TENANT_ACL_ALREADY_SET"){this.alert("warn",g.Thisuserisalreadyadministrator)}else{this.alert("error",g.Theadmincouldnotbeadded)}}.bind(this)});k.request(p)}}.bind(this))}.bind(this)}})),{styles:{"margin-top":"10px"},html:g.Administratorlist},{html:this.addChildView("usersList",new e({collection:this._adminCollection,widget:this._widget}))}]});return m}});return f});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/external-rich-link-preview-model",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-model"],function(c,b){var a=b.extend({defaults:{domain:"",type:"html"}});return a});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-links-view",["i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-links-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/idea/view/link-collection-view","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/feature/core/config/bootstrap-model"],function(e,f,b,g,i,a,c,k,h,j){var d=f.extend({name:"idea-links-view",modal:null,_createContent:function(){var l=this.model;if(l){var o=l.getAuthor().get("hash_key")===j.getInstance().get("user").hash_key||l.getCommunity().getUserRole()>=3,m=o;this.addChildView("linkCollectionView",{collection:l.getLinks(),Class:b,userCanDeleteLink:o,widget:this._widget});var n={html:[(m?new g({value:"+ "+e.Addalink,className:"link add-link",key:"return",events:{onClick:function(){this.linkLayer.show()}.bind(this)}}):""),{"class":"link-list-wrapper",html:this.getChildView("linkCollectionView")}]};return n}},setup:function(){var l=this._parent.apply(this,arguments),m=this;this.internalTypeCombo=new a({placeholder:e.Type,className:"margin-10-0",options:[{value:"CommunityPost",label:e.Post,selected:true},{value:"Media",label:e.Media},{value:"QnaQuestion",label:e.iQuestion},{value:"Dsi_Ideation_Ideation",label:e.Idea},{value:"Poll",label:e.Survey},{value:"Dsi_DFSTree_WikiTree",label:e.Wiki}]});this.internalIdTextfield=new c({placeholder:e.Link,className:"margin-10-0",allowBlank:false,attributes:{name:"link"}});this.externalTitleTextfield=new c({placeholder:e.Title,className:"margin-10-0",allowBlank:false,attributes:{name:"title"}});this.externalTitleTextfield.disable();this.externalUrlTextfield=new c({placeholder:e.URL,className:"margin-10-0",allowBlank:false,attributes:{name:"url"}});this.externalUrlTextfield.disable();this.addControl("internalRadio",new k({name:"link_type_radio",value:"internal",label:e.Internal,className:"primary internal-radio",checked:true,events:{onChange:function(){this.externalTitleTextfield.setValue("");this.externalUrlTextfield.setValue("");this.internalTypeCombo.enable();this.internalIdTextfield.enable();this.externalTitleTextfield.disable();this.externalUrlTextfield.disable()}.bind(this)}}));this.addControl("externalRadio",new k({name:"link_type_radio",value:"external",label:e.External,className:"primary external-radio",checked:false,events:{onChange:function(){this.internalTypeCombo.select("CommunityPost");this.internalIdTextfield.setValue("");this.internalTypeCombo.disable();this.internalIdTextfield.disable();this.externalTitleTextfield.enable();this.externalUrlTextfield.enable()}.bind(this)}}));this.linkLayer=this.addControl("linkLayer",new i({header:e.Addalink,className:"link-modal",body:{html:[this.getControl("internalRadio"),this.internalIdTextfield,this.getControl("externalRadio"),this.externalTitleTextfield,this.externalUrlTextfield]},footer:[this.addControl("add",new g({value:e.Add,className:"primary add-link",key:"return",events:{onClick:function(){if(this.getControl("internalRadio").isChecked()&&this.internalIdTextfield.getValue().trim()!==""){var r,q,o={post:"CommunityPost",media:"Media",iquestion:"QnaQuestion",idea:"Dsi_Ideation_Ideation",survey:"Poll",wiki:"Dsi_DFSTree_WikiTree"};this.getControl("add").load();var p=this.internalIdTextfield.getValue();if(p.match(/.*contentId=(.*?)(&|$)/)){r=p.match(/.*contentId=(.*?)(&|$)/);r=r&&r.hasOwnProperty(1)?r[1]:null;q=p.match(/.*contentType=(.*?)(&|$)/);q=q&&q.hasOwnProperty(1)?q[1]:null}else{if(p.match(/.*community:.*?\/.*:(.*)$/)){r=p.match(/.*community:.*?\/.*:(.*)$/);r=r&&r.hasOwnProperty(1)?r[1]:null;q=p.match(/.*community:.*?\/(.*):/);q=q&&q.hasOwnProperty(1)?q[1]:null}else{require(["DS/UWPClientControls/PlatformNotify"],function(s){s.error(e.YourInternalLinkIsNotValid);m.getControl("add").load(false)})}}if(q&&r){this.model.addLink({type:"internal",model_id:r,model:o[q]},{onComplete:function(){this.internalTypeCombo.select("CommunityPost");this.internalIdTextfield.setValue("");this.externalTitleTextfield.setValue("");this.externalUrlTextfield.setValue("");this.linkLayer.hide();this.getControl("add").load(false);this.refresh()}.bind(this),onFailure:function(t,s){this.getControl("add").load(false);if(s.errorcode=="ERROR_IDEATION_CONTENT_ALREADY_LINKED"){this.alert("error",e.Thiscontentisalreadylinkedtothisidea)}else{if(s.errorcode=="ERROR_CANNOT_LINK_IDEATION_TO_ITSELF"){this.alert("error",e.Cannotlinkanideatoitself)}else{this.alert("error",e.Thiscontentdoesntexist)}}}.bind(this)})}}else{if(this.externalUrlTextfield.getValue().trim()!==""&&this.externalTitleTextfield.getValue().trim()!==""){if(h.validateURL(this.externalUrlTextfield.getValue())===true){this.getControl("add").load();this.model.addLink({type:"external_url",url:this.externalUrlTextfield.getValue(),content_title:this.externalTitleTextfield.getValue()},{onComplete:function(){this.internalTypeCombo.select("CommunityPost");this.internalIdTextfield.setValue("");this.externalTitleTextfield.setValue("");this.externalUrlTextfield.setValue("");this.linkLayer.hide();this.getControl("add").load(false);this.refresh()}.bind(this),onFailure:function(t,s){this.getControl("add").load(false);if(s.errorcode=="ERROR_IDEATION_CONTENT_ALREADY_LINKED"){this.alert("error",e.Thiscontentisalreadylinkedtothisidea)}}.bind(this)})}else{this.alert("warn",e.Pleaseenteravalidurl)}}else{this.alert("warn",e.Pleasecheckyourform)}}}.bind(this)}})),new g({value:e.Cancel,key:"esc",events:{onClick:function(o){this.internalTypeCombo.select("CommunityPost");this.internalIdTextfield.setValue("");this.externalTitleTextfield.setValue("");this.externalUrlTextfield.setValue("");this.linkLayer.hide()}.bind(this)}})]}));this.getControl("internalRadio").check();var n=this.model.getLinks();if(!n.hasBeenFetched()){n.fetch()}return l}});return d});define("DS/SwymUIComponents/script/feature/community/media/edit/upload/file-browser-upload-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/library/media-library-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/media/view/media-tooltip-view","DS/SwymUICore/script/feature/community/media/model/media-file-extension-model","DS/Logger/Logger"],function(h,g,e,b,f,a,d){var c=e.extend({name:"file-browser-upload",_mediaFileExtension:null,defaultOptions:{multipleFileUpload:true,thumbnailMode:false},domEvents:{"change .file-browser-upload-input":"_filesSelected","click .fonticon-attach":"_onAttachmentIconClick","click .thumbnail-plus-wrapper":"_onAttachmentIconClick"},_onAttachmentIconClick:function(){var i=this.getElement(".file-browser-upload-input");if(i){i.click()}},setup:function(){this._parent.apply(this,arguments);this._mediaFileExtension=a.getInstance()},_filesSelected:function(i){var k=i.event||i,j=k.target.files;this.dispatchEvent("onFilesSelected",j)},_createFileInput:function(){var i=this.getOption("multipleFileUpload");return h.merge((i)?{multiple:"multiple"}:{},{tag:"input","class":"file-browser-upload-input",type:"file",name:"file-browser-file",styles:{display:"none"}})},_createContent:function(){var j="";if(this.getOption("thumbnailMode")===true){var i=e.extend({name:"plus-thumbnail",_createContent:function(){return{tag:"div","class":"thumbnail-plus-wrapper",html:[this.addChildView("thumbnail",{Class:"DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view",model:new b(),events:{onRender:function(k){d.log("plus-thubnail is rendered");var l=k.container.getElement("img");if(l){l.setAttribute("data-status","Reloaded")}}}}),{tag:"div","class":"icon-upload-container",html:[{tag:"div",html:{tag:"span","class":"fonticon fonticon-upload-cloud fonticon-4x"}},{tag:"div","class":"upload-label",html:[{tag:"span",html:g.UploadNewMedia},!h.Utils.Client.Features.touchEvents?{tag:"span","class":"fonticon fonticon-help"}:""]}]}]}}});j=[new i({}),this._createFileInput()]}else{j={tag:"span","class":"fonticon fonticon-attach",html:this._createFileInput()}}return j},onRender:function(){if(this.getElement(".fonticon-help")){var i=this.addChildView("mediaTooltipView",new f({model:this._mediaFileExtension,target:this.getElement(".fonticon-help")}));i.addEvent("render",this.unmask)}}});return c});define("DS/SwymUIComponents/script/feature/community/question/question-view",["UWA/Core","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view"],function(c,a,b){return b.extend({_modelClass:a,name:"question-view",getClassNames:function(){return(this._parent.apply(this,arguments)||"")+" one-column"},defaultOptions:{iconCls:"help",summaryViewClass:"DS/SwymUIComponents/script/feature/community/question/view/question-summary-view",detailedViewClass:"DS/SwymUIComponents/script/feature/community/question/view/question-detailed-view",editViewClass:"DS/SwymUIComponents/script/feature/community/question/edit/question-edit-view"}})});define("DS/SwymUIComponents/script/feature/core/user/mixin/view-with-users-group-link",["UWA/Core","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/UWPClientCode/I18n"],function(e,a,d,c){var b={_showUsersGroup:function(g){var f=this;require(["DS/i3DXRDFGroupViewer/js/GroupViewer"],function(h){var i=new h({language:c.getCurrentLanguage(),groupId:g,platformId:d.getInstance().get("config").tenant.online_instance_id});i.render();f.addControl("modal",new a({body:i,className:"group-viewer-modal"})).show()},function(){console.error("Viewer module is not present on disk!")})}};return b});define("DS/SwymUIComponents/script/feature/community/content/view/abstract-content-view",["UWA/Core","UWA/Event","DS/UIKIT/Tooltip","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/date","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/community/content/view/author-section-view","DS/SwymUIComponents/script/feature/core/user/mixin/view-with-users-group-link","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view","DS/SwymUICore/script/utils/i18n"],function(g,h,i,e,d,l,j,f,a,c,m){var k="__blank__",b=e.extend(a,{_socialFeaturesWrapperSelector:"",_contentBodySelector:"",domEvents:{"click a[data-users-group-uri]":"_onUsersGroupClick"},defaultOptions:{SocialFeaturesClassV2:"DS/SwymUIComponents/script/feature/community/content/social-interactions/social-toolbar-view",socialFeaturesViewOptions:null,ActionMenuClass:"DS/SwymUIComponents/script/feature/community/content/view/action-menu-view",comments:true,socialToolbarMode:"normal",forceCommentFetchIfNotDoneYet:false,commentsNumberAtInit:2,sendCommentsInitCallInPool:false,showCommentsSummaryFirst:true,showNonValidatedAnswersAtInit:true},BLANK_TITLE_CODE:k,_getIconWrapperCls:function(){return this.model.getModelName()},_createActionMenu:function(){var n=this.getOption("ActionMenuClass");return n?this.addChildView("",{Class:n,model:this.model}):""},_renderTitle:function(){var n=this.model.getCommunity(),o=this.model.get("community->mid"),q=n.isDirectMessage(),p={tag:"a","data-content-id":this.model.get("mid"),"data-content-type":this.model.getModelName(),html:this.model.get("title")};if(q){p["data-dm-id"]=o}else{p["data-community-id"]=o}return p},_isDraggable:function(){return true},_getIconElement:function(){var n=this.model;return{"class":"content-icon "+this._getIconWrapperCls(),"data-content-id":n.get("mid"),"data-content-type":n.getModelName(),html:{tag:"span","class":"fonticon fonticon-2x fonticon-"+this.getOption("iconCls")}}},_createTitleSection:function(){var o=this.model,t=o.get("title"),r=this._createActionMenu(),n=o.getCommunity(),q=o.get("community->mid"),s=n.isDirectMessage(),p=this._getIconElement();if(s){p["data-dm-id"]=q}else{p["data-community-id"]=q}return[{"class":"content-title-section",draggable:this._isDraggable(),html:[p,{"class":"content-title",events:{mouseenter:function(){this.getParent().draggable=false},mouseleave:function(){this.getParent().draggable=true}},html:(t===k?"":this._renderTitle())},r]}]},_createAuthorSection:function(){return this.addChildView("authorSectionView",new f({model:this.model}))},_onUsersGroupClick:function(n){return this._showUsersGroup(h.getElement(n).dataset.usersGroupUri)},onRedraw:function(){if(this._socialFeaturesWrapperSelector){var o=this,n=this.getElement(this._socialFeaturesWrapperSelector);if(n&&o.getOption("SocialFeaturesClassV2")){o._bootstrapModel.executeWhenReady(function(){o.addChildView("socialFeatures",g.extend({model:o.model,comments:o.getOption("comments"),showAnswers:o.getOption("showAnswers"),forceCommentFetchIfNotDoneYet:o.getOption("forceCommentFetchIfNotDoneYet"),Class:o.getOption("SocialFeaturesClassV2"),modelName:o.model.getModelName(),socialToolbarMode:o.getOption("socialToolbarMode"),widget:o._widget,commentsNumberAtInit:o.getOption("commentsNumberAtInit"),sendCommentsInitCallInPool:o.getOption("sendCommentsInitCallInPool"),showCommentsSummaryFirst:o.getOption("showCommentsSummaryFirst"),showNonValidatedAnswersAtInit:o.getOption("showNonValidatedAnswersAtInit"),events:{onLoadAnnotationRequest:function(q){var p=o.getOption("onLoadAnnotationRequestCallback");p&&p.call(o,q)}}},o.getOption("socialFeaturesViewOptions")||{})).inject(n,"bottom")})}}},setup:function(n){this._bootstrapModel=j.getInstance();this._parent.call(this,n)}});return b});define("DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view",["UWA/Core","UWA/Event","DS/SwymUIComponents/script/feature/community/content/view/abstract-content-view"],function(f,a,g){var d=null;if(window.ds&&window.ds.env==="3DD"){require(["DS/SwymUIComponents/script/utils/dnd-utils"],function(h){d=h})}var c="viewer-left-column",e="viewer-right-column",b=g.extend({_socialFeaturesWrapperSelector:"."+e,_contentBodySelector:".content-body-section",_contentDetailSelector:".content-detail-section",_modelEvents:{"onSync:update":"refresh","onChange:title":"updateTitleSection","onSync:read":"updateContentOwnSections"},name:"content-in-feed-detailed-view",className:"detailed-content fade-in-animation",defaultOptions:{fetchItemOnClick:true,modelFetchOptions:{fromCache:true},commentsNumberAtInit:5,sendCommentsInitCallInPool:false,showCommentsSummaryFirst:false},domEvents:{"dragstart .content-title-section":"onTitleDragStart"},onTitleDragStart:function(i){var h=this.model;d.onItemDrag(h,i,this._widget)},_renderTitle:function(){var h=this._parent.apply(this,arguments);h.tag="span";return h},_createDetailedView:function(){var i=this.model,h=null;if(i){h=this.addChildView("detailedView",{Class:"DS/SwymUIComponents/script/feature/community/content/view/content-viewer-view",className:"content-detail-section",model:i})}return h},_createViewCounter:function(){var i=this.model,h=null;if(i){h=this.addChildView("viewCounter",{Class:"DS/SwymUIComponents/script/feature/community/content/social-interactions/counter-view",model:i})}return h},_createLeftColumn:function(){return{"class":"content-body-section",html:[{"class":"content-subtitle-section",html:[this._createAuthorSection(),this._createViewCounter()]},this._createDetailedView()]}},_createContent:function(){var h=this.model;if(h){return[{"class":"viewer-header",html:this._createTitleSection()},{"class":"viewer-body",html:[{"class":c,html:this._createLeftColumn()},{"class":e}]}]}},updateTitleSection:function(){var h=this.getElement(".viewer-header");if(h){h.setContent(this._createTitleSection())}},updateContentOwnSections:function(){var h=this.getElement("."+c);if(h){h.setContent(this._createLeftColumn())}},onSetModel:function(){var h=this;if(h.getOption("fetchItemOnClick")===true){h.model.fetch(h.options&&h.options.modelFetchOptions);h.setOption("fetchItemOnClick",false)}}});b.LEFT_COLUMN_CLASS=c;b.RIGHT_COLUMN_CLASS=e;return b});define("DS/SwymUIComponents/script/feature/community/media/view/media-detailed-view",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view","DS/SwymUIComponents/script/feature/community/media/view/smart-lightbox-view","DS/SwymUIComponents/script/feature/community/media/view/media-details-view","DS/SwymUIComponents/script/feature/community/media/view/interactive-media-thumbnail-view","DS/SwymUIComponents/script/utils/media-utils","DS/WebappsUtils/Console"],function(i,j,f,a,e,g,h,b){var d=window.ds&&(window.ds.env==="MOBILE"),c=f.extend({_modelClass:j,name:"media-detailed-view",_delegateSpriteReloadToParentView:false,_bufferImagesReload:false,defaultOptions:{iconCls:"picture",onLoadAnnotationRequestCallback:function(k){var l=this&&this.getChildView("contentThumbnail");l&&l.dispatchEvent("onLoadAnnotationRequestCallback",k)}},onAnnotationShared:function(k){var l=this.getChildView("socialFeatures");l&&l.dispatchEvent("onAnnotationShared",k)},setup:function(){this._parent.apply(this,arguments);var l=this.model,n=this,k=this.model.get("media_type"),m=null;if(!this.onAnnotationSharedBound){this.onAnnotationSharedBound=this.onAnnotationShared.bind(this)}if(l){this.recalculateImageReloadOptions();this._createContentThumbnail();this.listenTo(this._getMediaDetailsView(),"onMediaDownload",function(){m.dispatchEvent("onMediaDownload")});this.listenTo(l,{"onSync:read":this._refreshDetailsView})}},_createContentThumbnail:function(){var l=this.model,k=this.model.get("media_type");this.addChildView("contentThumbnail",{Class:g,model:l,widget:this._widget,imageReloadOptions:this.imageReloadOptions,autoplay:d?false:true,useOriginalMediaDimensions:k==="video",events:{onAnnotationShared:this.onAnnotationSharedBound,onOpenInViewerRequest:function(){var n=this.getChildView("lightbox"),m=arguments[1]._shouldActivateAutoplay||false;if(!n){if(k==="picture"){this.addChildView("lightbox",new a({isAutoplayActivated:m,model:this.model})).injectInDom()}}}.bind(this)}})},_createDetailedView:function(){return[this.getChildView("contentThumbnail"),this._getMediaDetailsView()]},_getMediaDetailsView:function(){var k=this.getChildView("media-details-view");if(!k){k=this.addChildView("media-details-view",{Class:e,model:this.model,showDownloadButton:true})}return k},recalculateImageReloadOptions:function(){var m=this.model,q=m.get("mid"),p=parseInt(m.get("width"),10)||0,n=parseInt(m.get("height"),10)||0,k=m.get("media_type"),l,o;if((p&&n&&k)||(m.hasBeenFetched())){l=this.container.getDimensions();o=l&&parseInt(l.width,10);this.imageReloadOptions=h.generateImageReloadOptionsForMedia({mediaId:q,mediaType:k,mediaWidth:p,mediaHeight:n,containerWidth:o});this.imageReloadOptions.nonReloadedImagesOnly=true}else{this.listenToOnce(m,"onSync:read",this.refresh)}},_refreshDetailsView:function(){var l=this.model.get("media_type");b.log("the view should be refreshed !!!!");var k=this._getMediaDetailsView();k.refresh();if(l==="picture"){this.recalculateImageReloadOptions();this._createContentThumbnail();this.getChildView("contentThumbnail").refresh()}}});return c});define("DS/SwymUIComponents/script/feature/community/wiki/view/wiki-detailed-view",["UWA/Core","UWA/Utils/Client","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/feature/community/wiki/model/wikitree-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-view","DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-buttons-view","DS/SwymUIComponents/script/feature/community/content/view/content-small-view-factory","DS/SwymUIComponents/script/feature/community/content/view/author-section-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/edit/wiki-creator-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/content-title-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip"],function(b,s,k,e,r,p,h,a,j,d,o,u,t,n,w,l,g,c,q,v){var i="viewer-main-left-column",m="viewer-left-column",f="viewer-right-column",x=j.extend({_modelClass:k,name:"wiki-detailed-view",_modelEvents:{"onSync:update":"refresh","onChange:title":"updateTitleSection","onChange:visibility":"updateTitleSection","onChange:locked":"updateTitleSection","onSync:read":"updateContentOwnSections","onChange:mid":"setWikiRootModel"},defaultOptions:{iconCls:"book-open"},_createTreeSection:function(){var y=this,z=y.getChildView("wikiTreeView");if(!z&&y.model.getCommunity().get("mid")){y._context=r.getInstance();z=y.addChildView("wikiTreeView",{addScroller:true,model:new e({community_id:y.model.getCommunity().get("mid")},{autoPopulate:true}),Class:a,widget:y._widget,events:{onInit:function(){y.reactTo(this,"onItemViewSelect",function(C,A){var E=A.model.get("mid"),D=A.model.getModelName(),B=A.model.getCommunity().get("mid");if((y._context.contentId!==E)||(y._context.contentType!==D)||(y._context.communityId!==B)){y._context.reset({contentId:E,communityId:B,contentType:D})}})}}});z.selectItemView(y.model,false)}else{if(!y.model.getCommunity().get("mid")){y.model.addEventOnce("onSync:read",function(B){y.model=B;var A=y._createTreeSection();if(A){A.refresh()}})}}return z},_addAnchor:function(){var C=this,A=C.model,y=A.generateToc(A.get("content")),E,z=[],D=[],B;A.set("content",y);E=A.getToc();for(B=0;B<E.length;B++){if(E[B].name!=="&nbsp;"){D.push(E[B])}}if(D.length>0){for(B=0;B<D.length;B++){z.push({text:D[B].name.replace(/<(?:.|\n)*?>/gm,""),title:D[B].id})}C.anchor.show()}else{C.anchor.hide()}C.addControl("tocView",new q({items:z,className:"toc-dropdown",target:C.anchor,events:{onClick:C._onTocTitleClick.bind(C),onShow:function(){C.anchor.addClassName("checked")},onHide:function(){C.anchor.removeClassName("checked")}}}))},_createContent:function(){var z=this,y=z.model;this.anchor=b.createElement("div",{"class":"toc-button",html:'<span class="fonticon fonticon-anchor"></span>'});this.addControl("MenuTooltip",new v({target:this.anchor,body:w.Toc}));if(y.getToc()&&y.getToc().length===0){this.anchor.hide()}this._addAnchor();if(y){return[{"class":"col-md-3 "+i,html:z._createMainLeftColumn.call(z)},{"class":"col-md-9 wiki-viewer-body",html:[{"class":"viewer-header",html:z._createTitleSection.call(z)},z.anchor,{"class":"viewer-body",html:[{"class":m,html:z._createLeftColumn.call(z)},{"class":f}]}]}]}},_createAuthorSection:function(){if(this.model.get("nb_contributors")&&this.model.get("nb_contributors")>1){return this.addChildView("authorSectionView",new t({model:this.model,mode:"multiContributors"}))}else{return this._parent.call(this)}},_createTitleSection:function(){var A=this,y=this.model,C=y.get("title"),B=this._createActionMenu(),z,D;if(y.get("locked")==="1"||y.get("locked")===true||y.get("locked")===1){z=b.createElement("span",{"class":"fonticon fonticon-lock"});this.addControl("lockTooltip",new v({target:z,body:w.PageLocked}))}if(parseInt(y.get("visibility"),10)===2||parseInt(y.get("visibility"),10)===0){D=b.createElement("span",{"class":"fonticon fonticon-user-key",events:{click:function(){require(["DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/sprite/sprite","DS/SwymUIComponents/script/feature/core/user/view/user-mini-view","DS/SwymUIComponents/script/feature/core/modal/modal"],function(I,F,H,E){var J=y.getAssociated("authorizedusers");if(!J.hasBeenFetched()){J.fetch({data:{community_id:y.getCommunity().get("mid")}})}var G=A.getControl("privateUsersModal");if(!G){G=A.addControl("privateUsersModal",new E({closable:true,header:n.Peoplewhocanaccesstothisprivatepage,body:[{html:A.addChildView("usersList",{collection:J,Class:I,modelViewClass:H,modelViewsCfg:{attributes:{"class":"float-left",styles:{"margin-bottom":"10px","min-width":"50%"}},modal:G}})},{html:'<div style="clear:both;"></div>'}],events:{onShow:function(){}}}))}G.show()})}}});this.addControl("visibilityTooltip",new v({target:D,body:w.PagePrivate}))}return[{"class":"content-title-section",html:[{"class":"content-icon "+this._getIconWrapperCls(),draggable:this._isDraggable(),html:{tag:"span","class":"fonticon fonticon-2x fonticon-"+this.getOption("iconCls")}},{"class":"content-title",html:[(C===A.BLANK_TITLE_CODE?"":this._renderTitle())]},{"class":"wiki-icon-wrapper",html:[(z?z:null),(D?D:null)]},B]}]},_getBackArrowView:function(){var y=this.getChildView("backArrowView");if(!y){y=this.addChildView("backArrowView",{Class:"DS/SwymUIComponents/script/feature/core/ui-components/back-arrow-view",model:this.model})}return y},_createMainLeftColumn:function(){var A=this,y=A.model,z;if(y){z=A.addChildView("wikiTreeButtonsView",new o({model:new p({mid:A.model.getCommunity().get("mid")},{autoPopulate:true})}));if(!s.Platform.ios&&!s.Platform.android){A.reactTo(z,"WikiEditToggle",function(){if(A.getChildView("wikiTreeView")){A.getChildView("wikiTreeView").toggleEdit()}})}return{"class":"wikitree-view-wrapper-container",html:[(window.ds&&window.ds.swymIM===true?"":A._getBackArrowView()),[{"class":"wikitree-view-wrapper",styles:{"margin-right":"auto"},html:[{"class":"heading",html:[{"class":"wikitree-header",html:[{tag:"span","class":"fonticon fonticon-book-open"},{tag:"span",html:n.Wikitree}]},z]},{"class":"tree-wrapper",html:this._createTreeSection()}]}],this.addChildView("revisionView",{model:y,Class:"DS/SwymUIComponents/script/feature/community/wiki/view/revision-view"})]}}},updateContentOwnSections:function(){var z=this.getElement("."+i);if(z){z.setContent(this._createMainLeftColumn())}var y=this.getElement("."+m);if(y){y.setContent(this._createLeftColumn())}this._addAnchor()},_onTocTitleClick:function(z,y){var A=document.body.getElement("#"+y.title);if("TD"===A.parentElement.tagName){A.style.position="relative"}if(window.ds&&window.ds.swymIM===true){this.dispatchEvent("onScrollToElement",A)}else{d.dispatchEvent("onScrollToElement",A)}},_onRevisionReceived:function(y){this.model.set("content",y.attributes.message?y.attributes.message:y.attributes.content);this.model.set("title",y.attributes.title);this.getElement(".content-title-section").addClassName("diff-enabled");if(b.is(this.getElement(".content-title-section").getElement(".content-title").getElement("span"))){this.getElement(".content-title-section").getElement(".content-title").getElement("span").setHTML(y.attributes.title)}this._addAnchor()},onSetModel:function(z,A,y){this.reactTo(y,"onRevisionReceived",this._onRevisionReceived);this._parent.call(this)},setWikiRootModel:function(){var z=this.model.get("mid"),y=this.model.get("is_root");if(z&&y){var A=new k(this.model.toJSON());if(A._attributes!==this.model._attributes){window.REALWIKITREEMODEL=A;this.setModel(A,{ignoreEquality:true})}}}});return x});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-detailed-view",["UWA/Core","DS/SwymUICore/script/feature/community/survey/model/survey-model","DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view"],function(d,c,a){var b=a.extend({_socialFeaturesWrapperSelector:"",_modelClass:c,name:"survey-detailed-view",defaultOptions:{iconCls:"clipboard"},_createLeftColumn:function(){return{"class":"content-body-section",html:[{"class":"content-subtitle-section",html:this._createAuthorSection()},this._createDetailedView()]}},_createContent:function(){var e=this.model;if(e){return[{"class":"viewer-header",html:this._createTitleSection()},{"class":"viewer-body",html:[{"class":a.LEFT_COLUMN_CLASS,html:this._createLeftColumn()}]}]}}});return b});define("DS/SwymUIComponents/script/feature/community/post/view/post-detailed-view",["UWA/Core","DS/SwymUICore/script/feature/community/post/model/post-model","DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view"],function(d,b,a){var c=a.extend({_modelClass:b,name:"post-detailed-view",defaultOptions:{iconCls:"newspaper"}});return c});define("DS/SwymUIComponents/script/feature/community/question/view/question-detailed-view",["UWA/Core","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view","DS/SwymUIComponents/script/feature/community/question/question-view-mixin","DS/SwymUICore/script/feature/core/context/context-model"],function(f,c,a,e,d){var b=a.extend({_modelClass:c,name:"question-detailed-view",validated:null,defaultOptions:{iconCls:"help",SocialFeaturesClass:"DS/SwymUIComponents/script/feature/community/question/social-interactions/social-features-for-question-detailed-view",SocialFeaturesClassV2:"DS/SwymUIComponents/script/feature/community/question/social-interactions/social-features-for-question-detailed-view",socialFeaturesViewOptions:null},setup:function(g){var h=d.getInstance();if(h.answerUri&&!h.commentUri){this.setOption("socialFeaturesViewOptions",f.extend({answerToScrollTo:h.answerUri},g&&g.socialFeaturesViewOptions))}return this._parent.apply(this,arguments)}});return b.extend(e)});define("DS/SwymUIComponents/script/feature/community/media/view/media-tile-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/tenant-media-max-size-view","DS/SwymUIComponents/script/feature/community/content/view/abstract-content-view","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/content/view/author-section-view","DS/SwymUICore/script/lib/view/generic/swym-view"],function(g,b,m,k,n,f,h,e,d){var l=269,c=500,j=k.extend({name:"custom-media-thumbnail",setup:function(o){if(o&&o.delegateSpriteReloadToParentView!==undefined){this._delegateSpriteReloadToParentView=o.delegateSpriteReloadToParentView;this._bufferImagesReload=false}return this._parent.apply(this,arguments)},_createContent:function(){var o=this.model,p=parseInt(o.get("width"),10)||0;return{styles:{"max-width":"100%",width:p>0?p+"px":n.MEDIA_THUMBNAIL.DIMENSIONS.LARGE.WIDTH+"px",margin:"auto",flex:"none"},html:this._parent()}}}),i=d.extend({name:"media-selected-tile-view",_createContent:function(){return g.createElement("div",{html:'<span class="fonticon fonticon-check fonticon-4x"></span>'})}}),a=m.extend({name:"media-tile-view",_modelClass:n,_modelEventsForAutoRefresh:["onChange:title","onChange:description","onChange:update"],_showToolbar:false,defaultOptions:{canBeSelected:false,comments:false,sendCommentsInitCallInPool:true},domEvents:{click:"_onClick",resize:"_onResize","click .st-endorse-btn-wrapper":"_stopPropagate","click .st-share-btn-wrapper":"_stopPropagate","click .st-counter":"_stopPropagate",'click .link[data-content-type="person"]':"_onUserClick"},className:"swym-tile",_onClick:function(){this.dispatchEvent("onClick",[this])},_stopPropagate:function(o){o.stopPropagation()},_onUserClick:function(o){o.stopPropagation();o.preventDefault();require(["DS/SwymUICore/script/utils/link-builder-utils"],function(p){p.displayProfile(o)})},_onResize:function(){var o=this.getElement(".media-tile");if(o){if(o.getSize().width<=l){o.addClassName("without-counters")}else{o.removeClassName("without-counters")}}},_getTranslatedMediaType:function(){var o="";switch(this.model.get("media_type")){case"picture":o=b.picture;break;case"drawing":o=b.drawing;break;case"video":o=b.video;break;case"sound":o=b.sound;break;case"document":o=b.document;break;case"3d_model":o=b["3d_model"];break}return o},_createAuthorSection:function(){return this.addChildView("contentAuthorSection",new e({model:this.model,mode:"simple"}))},_createContent:function(){var o=this.model,r=g.Utils.Client.Engine.ie11,s=o.get("title"),q=o.get("content"),p=g.createElement("div",{"class":"media-tile",html:[this.getChildView("thumbnail"),{"class":"content-body-section block-except-logo",styles:{padding:"10px"},html:[s?{"class":"title",styles:r?{"font-size":"18px","line-height":"32px"}:{},html:s}:"",this._showToolbar===true?this._createActionMenu():"",this._createAuthorSection(),{"class":"visibility",html:'<span class="fonticon fonticon-1-5x fonticon-'+h.getMediaIconName(o)+'"></span>'},q?{"class":"description",html:q}:""]},{"class":"media-social-toolbar",styles:r?{"min-height":"48px"}:{}}]});return p},setup:function(C){var t={},u=this.model;if(C&&C.showToolbar){this._showToolbar=C.showToolbar}if(this._showToolbar){this._socialFeaturesWrapperSelector=".media-social-toolbar"}if(u){var z=u.get("media_type"),r=u.get("preview_fingerprint"),w=z==="picture"?parseInt(u.get("width"),10)/parseInt(u.get("height"),10):4/3,s=f.generateBestThumbnailForContentView(c,c/w,u),q=s.width,y=s.height,p=s.spriteKey,B=s.spriteType,v={styles:{width:"100%","padding-top":100/w+"%",height:"0px"}};t={Class:j,model:u,delegateSpriteReloadToParentView:C.delegateSpriteReloadToParentView,events:{onRender:function(E){if(this.getOption("canBeSelected")===true){var D=this.addChildView("media-selected",{Class:i});D.render(E.container)}}.bind(this)}};if(h.isFeatureActivated("activateSpriteRemoval")===true){var x={},o=u.get("width"),A=u.get("height");if(z&&o&&A){x={size:s.sizeCategory,imageKind:s.previewType}}else{x={size:"l",imageKind:"thumb"}}x.useSprite=false;t.imageReloadOptions=x}else{t.imageRenderingOptions={mediaId:u.get("mid"),mediaType:z,useVariableSizeSprite:true,imageFingerprint:r?r:undefined,width:q,height:y,spriteKey:p,spriteType:B,extraAttributes:v}}this.addChildView("thumbnail",t);this._parent.apply(this,arguments)}}});return a});define("DS/SwymUIComponents/script/feature/community/survey/view/answer-editor-collection-view",["DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/survey/collection/answer-collection","DS/SwymUIComponents/script/feature/community/survey/view/answer-editor-view"],function(c,d,b){var a=c.extend({_collectionClass:d,modelViewClass:b,_collectionEvents:{onChange:"_onContentChanged",onRemove:"_onRemove"},bodyAttributes:{tag:"div"},_onRemove:function(e){if(e.get("is_open")==="1"){this.dispatchEvent("onRemoveOpenAnswer")}},_onContentChanged:function(){this.dispatchEvent("onContentChange")}});return a});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-tile-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/survey-tile-view","DS/SwymUIComponents/script/feature/community/content/view/abstract-content-view","DS/SwymUICore/script/feature/community/survey/model/survey-model","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/utils/i18n","DS/SwymUICore/script/feature/core/context/context-model","DS/UIKIT/Input/Button","DS/SwymUICore/script/utils/utils"],function(e,b,j,f,g,a,i,c,d){var h=j.extend({_modelClass:f,domEvents:{"click .survey-link":"_onClick","click .title":"_onClick"},_modelEventsForAutoRefresh:["onChange:userHasAlreadyAnswered","onChange:canSeeResults"],name:"survey-tile-view",className:"swym-tile",_onClick:function(l){var k=i.getInstance();if(k){k.reset({contentId:this.model.get("mid"),contentType:this.model.getModelName(),communityId:this.model.getCommunity().get("mid")})}},setup:function(k){this.model.isansweredbyme({});this._parent.apply(this,arguments)},_createContent:function(){var o=this.model,n="",s=e.createElement("div",{styles:{"min-height":"48px"}});if(o){var r=o.get("title"),m=o.getAssociated("author"),k=o.isOpen(),p=o.hasStarted(),q=k?"open-survey":"closed-survey";if(o.has("userHasAlreadyAnswered")){var l="";if(o.get("userHasAlreadyAnswered")||!k){if(d.isFeatureActivated("activateSurveyImprovements")){if(o.get("showResultsAfterVote")===true){l=b.CheckResults}else{if(o.has("canSeeResults")){if(o.get("canSeeResults")===true){l=b.CheckResults}}else{o.canSeeResults()}}}else{l=b.CheckResults}}else{l=b.Answer}if(l){s=e.createElement("div",{styles:{"text-align":"center","margin-top":"10px"},html:this.addControl("call-to-action",new c({className:l===b.Answer?"primary":"default",value:l,icon:l===b.Answer?"":"chart-bar",events:{onClick:function(){this._onClick()}.bind(this)}}))})}}n=e.createElement("div",{"class":"survey-tile",html:[{"class":"header-tile-block",html:[this.addChildView("userPicture",{Class:g,model:m,imageRenderingOptions:{format:"square"}}),(r?{"class":"title",html:r}:""),{html:'<span class="fonticon fonticon-1-5x '+q+' fonticon-clock"></span>'+(k?b.SurveyisOpen:(p?b.SurveyisClosed:b.SurveyYetToOpen))}]},{styles:{clear:"both"}},{"class":"survey-tile-text",html:a.replace(b.authorCreatedSurvey,{nickname:'<span class="link" data-content-type="person" data-hash-key="'+m.get("hash_key")+'">'+m.getNickname()+"</span>",surveyTitle:'<span class="link survey-link">'+r+"</span>"})},(p)?s:""]})}return n}});return h});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-list-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/ui-components/list/item-list","DS/SwymUIComponents/script/feature/community/survey/view/survey-tile-view","DS/SwymUICore/script/lib/model/model-manager"],function(e,b,d,a){var c=b.extend({name:"community-survey-list",modelViewClass:d,_onPublishing:function(f){if(f.getModelName()==="survey"&&f.getCommunity().get("mid")===this.collection.communityId){this.collection.unshift(f)}},itemViewSelector:".survey-tile-view-container",domEvents:{"dragstart .survey-tile-view-container":"onItemDragStart"},modelViewsCfg:function(){var f=this._parent.apply(this,arguments);return e.merge({attributes:{draggable:true}},f)},setup:function(f){f.useDynamicGrid=true;if(!this._onPublishingBound){this._onPublishingBound=this._onPublishing.bind(this);a.addListenerOnPublishing(this._onPublishingBound)}this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/community/media/view/media-list-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/ui-components/list/item-list","DS/SwymUIComponents/script/feature/community/media/view/media-tile-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/lib/model/model-manager","DS/SwymUICore/script/utils/utils"],function(g,b,e,c,a,f){var d=b.extend({name:"community-media-list",itemViewSelector:".media-tile-view-container",domEvents:{click:"onItemClick","dragstart .media-tile-view-container":"onItemDragStart"},defaultOptions:{debounceDelay:500,commentCallMutualizerOptions:{commentsNumberAtInit:0}},imageReloadOptions:(function(){var h={nonReloadedImagesOnly:true};h.useVariableSizeSprite=true;h.selector='img[data-type="VariableSizeMediaThumbnail"]';return h}()),_onPublishing:function(h){if(h.getModelName()==="media"&&h.getCommunity().get("mid")===this.collection.communityId){this.collection.unshift(h)}},onItemClick:function(j){var i=c.getInstance(),k=j.target,h=k.getClosest(".media-tile");if(h&&h.getElement("img").getAttribute("data-content-id")&&!(k.childNodes[0]&&k.childNodes[0].className&&k.childNodes[0].className.contains("fonticon-forward"))&&!k.className.contains("fonticon-forward")&&!k.className.contains("fonticon-down-open")){i.set({contentId:j.target.getClosest(".media-tile").getElement("img").getAttribute("data-content-id"),contentType:j.target.getClosest(".media-tile").getElement("img").getAttribute("data-content-type")})}},modelViewClass:e,modelViewsCfg:function(){var h=this._parent.apply(this,arguments);if(f.isFeatureActivated("activateSpriteRemoval")===true){h.delegateSpriteReloadToParentView=false}return g.extend(h,{attributes:{draggable:true},isTileModeActivated:true,showToolbar:false},true)},setup:function(h){h.useDynamicGrid=true;if(!this._onPublishingBound){this._onPublishingBound=this._onPublishing.bind(this);a.addListenerOnPublishing(this._onPublishingBound)}this._parent.apply(this,arguments)},destroy:function(){if(this._onPublishingBound){a.removeListenerOnPublishing(this._onPublishingBound)}return this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-view",["UWA/Core","UWA/Event","UWA/Array","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-definition","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUIComponents/script/feature/core/ui-components/layout/column-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/sticky-column-view","DS/WebappsUtils/Console","DS/SwymUICore/script/feature/core/config/bootstrap-model"],function(h,l,c,a,k,f,b,g,e,d,i){var j=a.extend({className:"scroll-content",domEvents:{"animationend .fade-in-animation":"_onElementFadeIn","webkitAnimationEnd .fade-in-animation":"_onElementFadeIn"},defaultOptions:{setActiveTaggerProxyManagerUponNavigation:true,pageModulesPath:null,alignHeightToChildViews:false},_onElementFadeIn:function(n){var m=n.srcElement||n.target;if(m&&m.hasClassName("fade-in-animation")&&n.type.toLowerCase().indexOf("animationend")>=0){m.removeClassName("fade-in-animation")}},_createContent:function(){},_createProxyManager:function(p,n){var o=k.getInstance(),m=this.options.taggingContextManager.isProxyManager(p);if(!m){m=this.options.taggingContextManager.createProxyManager(p,{persistTags:!o.isContentEditionContext()||(i.getInstance().isFeatureActivated("activate_explicit_tags_thru_server")===false),client:n});return m}else{return false}},_onRequestForHeightAlignment:function(n){if(this.isVisible()){var t,q,s,p=0,o=undefined,r=this.getChildViews(),m=false;if(this.container){for(o in r){if(r.hasOwnProperty(o)){t=r[o];if(t.container&&(t instanceof g)){q=t.getViewsWrapper().getSize().height;if(t instanceof e){if(q>=p){p=q;m=true}}else{if(q>p){p=q;m=false}}}}}}if((p===0)||(m===false)){p=""}s=this.container.style.minHeight;if((!p&&s)||(p&&(parseFloat(s)!==p))){this.container.setStyle("min-height",p);this._notifyChildViewsOfHeightAlignment()}else{if(n){n.dispatchEvent("onParentHeightAlignment")}}}else{this.addEventOnce("onShow",this._onRequestForHeightAlignment)}},_notifyChildViewsOfHeightAlignment:function(){for(var m in this._childViews){if(this._childViews.hasOwnProperty(m)){this._childViews[m].dispatchEvent("onParentHeightAlignment")}}},setup:function(m){this._parent.call(this,m);if(!this.options.pageModulesPath){throw new Error('The option "pageModulesPath" is compulsory and needs to be provided!')}h.extendElement(document.body)},addChildView:function(p,m,n){if(this.getOption("alignHeightToChildViews")===true){var q=this,o=h.clone(n,false)||{},r=o.callback;o.callback=function(s){if(s instanceof g){q.reactTo(s,"onRequestForParentsHeightAlignment",q._onRequestForHeightAlignment)}if(r){return r.apply(this,arguments)}};return this._parent.call(this,p,m,o)}else{return this._parent.apply(this,arguments)}},maximize:function(n,o){var m=this.getChildView("center");if((n instanceof a)&&!n.container.hasClassName("maximized")&&m.container.contains(n.container)){this.unMaximize();this.dispatchEvent("onBeforeMaximize",[n,o]);this.container.addClassName("maximized");n.container.addClassName("maximized");n.listenToOnce(this,"onUnMaximize",function(){this.container.removeClassName("maximized");this.dispatchEvent("onUnMaximize")});n.dispatchEvent("onMaximize");this.dispatchEvent("onMaximize",[n,o])}},onRender:function(){var m=k.getInstance();b.applyLayoutDefinition({layoutView:this,resetLayout:this.getOption("resetLayout"),pageModulesPath:this.getOption("pageModulesPath"),viewsDefaultParams:{taggingContextManager:this.getOption("taggingContextManager"),widget:this._widget},layoutSetupFunction:this.getOption("layoutSetupFunction")});this.reactTo(b,{onMaximizeRequest:this.maximize,onUnMaximizeRequest:this.unMaximize,onViewShow:this.onViewShow,onViewHide:this.onViewHide,onSetInstanceTagsRequest:this.onSetInstanceTagsRequest});this.onContextChange=this.onContextChange.bind(this);if(m.addListener("onContextChange",this.onContextChange,this,true)===true){this.onContextChange()}},unMaximize:function(){if(this.container.hasClassName("maximized")){this.container.removeClassName("maximized");this.dispatchEvent("onUnMaximize")}},onViewShow:function(m,n){if(m.getOption("toBeMaximized")===true){this.maximize(m,m.getOption("maxizationOptions"))}},onViewHide:function(m,n){if(m.getOption("toBeMaximized")===true&&m.container.hasClassName("maximized")){this.unMaximize(m)}},onSetInstanceTagsRequest:function(m){var o,r,p=k.getInstance(),n,q=i.getInstance();if(window.ds&&window.ds.env==="3DSwym"){if(!q.isBootstrapConditionMet("TopFrameInit")){q.executeWhenBootstrapConditionIsMet("TopFrameInit",this.onSetInstanceTagsRequest.bind(this,m));return null}}if(this.isVisible()&&this.options.taggingContextManager&&m){n=f.parseRoute(p.getLayoutPath()).route;r=n;if((window.ds&&window.ds.env!=="3DSwym")||!n.startsWith("people")){o=this.options.taggingContextManager.isProxyManager(r);if(o){o.setClient(m)}else{this._createProxyManager(r,m)}}}},onContextChange:function(r){var q=this,p,m=["community/mycontributions","community/stats","community/settings","people/aboutme","people/connections","people/settings","community/post","community/media","community/idea","community/iquestion","community/wiki","community/survey","community/post/edit","community/media/edit","community/idea/edit","community/iquestion/edit","community/wiki/edit","community/survey/edit"],n=["community/stats","community/settings","people/aboutme","people/connections","people/settings","community/post","community/media","community/idea","community/iquestion","community/wiki","community/survey","community/post/edit","community/media/edit","community/idea/edit","community/iquestion/edit","community/wiki/edit","community/survey/edit"],o=["people","admin-tenant","search"];if(this.options.taggingContextManager&&(this.options.setActiveTaggerProxyManagerUponNavigation===true)){p=f.parseRoute(k.getInstance().getLayoutPath()).route;if(!c.detect(o,function(s){return p.match(s)})){if(window.ds&&window.ds.env==="3DSwym"){i.getInstance().executeWhenBootstrapConditionIsMet("TopFrameInit",function(){q._createProxyManager(p);q.options.taggingContextManager.setProxyManagerAsCurrent(p)})}else{q._createProxyManager(p);q.options.taggingContextManager.setProxyManagerAsCurrent(p)}}}if(m.indexOf(p)===-1){b.dispatchEvent("onInfiniteScrollActivationRequest")}else{b.dispatchEvent("onInfiniteScrollDesactivationRequest")}if(n.indexOf(p)===-1){b.dispatchEvent("onPullToRefreshActivationRequest")}else{b.dispatchEvent("onPullToRefreshDeactivationRequest")}},propagateEvents:function(){d.log("in propagateEvents",arguments)},destroy:function(){k.getInstance().removeListener("onContextChange",this.onContextChange);return this._parent.apply(this,arguments)}});return j});define("DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-with-scroll-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/W3DXComponents/Views/Layout/ScrollView","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-view"],function(h,a,g,j,f,b,i){var d=2000;var c={x:0,y:0},e=a.extend({_scrollerPositionBeforeMaximize:null,_scrollerPositionBeforeContextChange:null,_useInfiniteScroll:null,_lastScrollPosition:null,_lastScrollDownTime:null,_firstInfiniteScrollRequest:null,_needToDispatchOnInfiniteScroll:null,_managerAlreadyCleaned:null,name:"layout-with-scroll",className:"scroll-to-top",defaultOptions:{setActiveTaggerProxyManagerUponNavigation:true,taggingContextManager:null,pageModulesPath:undefined,layoutSetupFunction:null,resetLayout:false,useInfiniteScroll:true,usePullToRefresh:true,layoutExtraOptions:null},setup:function(k){if(!this._lastScrollPosition){this._lastScrollPosition={x:0,y:0}}this.onScroll=f.getDelayedSyncTask(this.onScroll.bind(this),200);this._parent.call(this,k);b.clean();b.setTaggingContextManagerInstance(this.options.taggingContextManager);this.addScrollViewWithLayout();this.addOtherViews();this.reactTo(b,{onScrollToTopRequest:this.onScrollToTopRequest,onScrollToElement:this.onScrollToElement,onInfiniteScrollActivationRequest:this.onInfiniteScrollActivationRequest,onInfiniteScrollDesactivationRequest:this.onInfiniteScrollDesactivationRequest,onPullToRefreshActivationRequest:this.onPullToRefreshActivationRequest,onPullToRefreshDeactivationRequest:this.onPullToRefreshDeactivationRequest,onPageLoadRequest:this.onPageLoadRequest});this.onContextChange=this.onContextChange.bind(this);j.getInstance().addListener("onContextChange",this.onContextChange,this,true)},addOtherViews:function(){this.addChildView("backToTopView",{Class:"DS/SwymUIComponents/script/feature/core/ui-components/layout/back-to-top-view"})},addScrollViewWithLayout:function(){var m,l=this,k={taggingContextManager:this.options.taggingContextManager,setActiveTaggerProxyManagerUponNavigation:this.options.setActiveTaggerProxyManagerUponNavigation,widget:this._widget,events:{onBeforeMaximize:function(n,o){if(l.scrollView){l._useInfiniteScroll=l.scrollView.getOption("useInfiniteScroll");if(!o||o.deactivateInfiniteScroll!==false){l.scrollView.setOption("useInfiniteScroll",false)}l._scrollerPositionBeforeMaximize=l._scrollerPositionBeforeContextChange||h.clone(c);l.scrollView.scroller&&l.scrollView.scroller.scrollTo(0,0)}},onMaximize:function(){if(l.scrollView){l.scrollView.usePullToRefresh(false)}l.dispatchEvent("onMaximize")},onUnMaximize:function(){if(l.scrollView){if(!l._scrollerPositionBeforeMaximize){l._scrollerPositionBeforeMaximize=h.clone(c)}l.scrollView.usePullToRefresh(true);l.scrollView.setOption("useInfiniteScroll",l._useInfiniteScroll);setTimeout(function(){if(l.scrollView&&l.scrollView.scroller){l.scrollView.scroller.scrollTo(-1*l._scrollerPositionBeforeMaximize.x,-1*l._scrollerPositionBeforeMaximize.y)}},0)}l.dispatchEvent("onUnMaximize")}}};if(this.options.pageModulesPath){k.pageModulesPath=this.options.pageModulesPath}if(this.options.resetLayout){k.resetLayout=this.options.resetLayout}if(this.options.layoutSetupFunction){k.layoutSetupFunction=this.options.layoutSetupFunction}if(this.options.layoutExtraOptions){h.merge(k,this.options.layoutExtraOptions)}m=this.addChildView("layout",new i(k));this.scrollView=this.addControl("scrollView",new g({view:m,useInfiniteScroll:(this.options.useInfiniteScroll!==undefined)?this.options.useInfiniteScroll:true,usePullToRefresh:(this.options.usePullToRefresh!==undefined)?this.options.usePullToRefresh:true}));this.listenTo(this.scrollView,{onPullToRefresh:this.onPullToRefresh,onInfiniteScroll:this.onInfiniteScroll})},_createContent:function(){return[this.getControl("scrollView"),this.getChildView("backToTopView")]},_dispatchOnInfiniteScrollIfNeeded:function(){var k=false;if(!this._firstInfiniteScrollRequest&&(this._lastScrollDownTime||(this.scrollView&&this.scrollView.scroller&&this.scrollView.scroller.getProgress("y")===1))){k=true;this._lastScrollDownTime=null;b.dispatchEvent("onInfiniteScroll",[this.scrollView])}return k},onContextChange:function(){if(this.isVisible()){this._lastScrollDownTime=null;this._needToDispatchOnInfiniteScroll=false;if(this.scrollView&&this.scrollView.scroller){this._scrollerPositionBeforeContextChange=this.getScrollerPosition()}b.dispatchEvent("onScrollToTopRequest")}},onPullToRefresh:function(){b.dispatchEvent("onPullToRefresh",[this.scrollView])},onInfiniteScroll:function(){if(this._firstInfiniteScrollRequest===null){this._firstInfiniteScrollRequest=true}else{this._firstInfiniteScrollRequest=false}if(!this._dispatchOnInfiniteScrollIfNeeded()){this._needToDispatchOnInfiniteScroll=true}},onScrollToTopRequest:function(k){if(this.isVisible()&&this.scrollView&&this.scrollView.scroller){this.scrollView.scroller.scrollTo(0,0,(k||0))}},onScrollToElement:function(k,l){if(this.isVisible()&&this.scrollView&&this.scrollView.scroller){this.scrollView.scroller.scrollToElement(k,null,(l||250))}},onInfiniteScrollActivationRequest:function(){if(this.isVisible()&&this.scrollView&&this.scrollViewInjected){this.scrollView.useInfiniteScroll(true)}},onInfiniteScrollDesactivationRequest:function(){if(this.isVisible()&&this.scrollView&&this.scrollViewInjected){this.scrollView.useInfiniteScroll(false)}},onPullToRefreshActivationRequest:function(){if(this.isVisible()&&this.scrollView&&this.scrollViewInjected){this.scrollView.usePullToRefresh(true)}},onPullToRefreshDeactivationRequest:function(){if(this.isVisible()&&this.scrollView&&this.scrollViewInjected){this.scrollView.usePullToRefresh(false)}},onPageLoadRequest:function(l,k){if(this.isVisible()&&this.scrollView&&this.scrollView.scroller){if(this._firstInfiniteScrollRequest===null){this._firstInfiniteScrollRequest=true}else{this._firstInfiniteScrollRequest=false}require(["DS/SwymUIComponents/script/utils/scrollview-utils"],function(m){m.onInfiniteScroll.apply({collection:l,scrollView:this.scrollView,options:k})}.bind(this))}},getScrollerPosition:function(){var k=null;if(this.scrollView&&this.scrollView.scroller){k=this.scrollView.scroller.getPosition()}return k},onScroll:function(){var m=this.getChildView("backToTopView"),k=this.getScrollerPosition(),l;if(k){l={position:k,delta:{x:k.x-this._lastScrollPosition.x,y:k.y-this._lastScrollPosition.y}};b.dispatchEvent("onScroll",[this.scrollView,l]);if((this._needToDispatchOnInfiniteScroll===true)&&(l.delta.y<0)){this._lastScrollDownTime=new Date();this._dispatchOnInfiniteScrollIfNeeded();this._needToDispatchOnInfiniteScroll=false}if(k.y===0){this.container.addClassName("scroll-to-top");m&&m.hide()}else{this.container.removeClassName("scroll-to-top");if(l&&(l.delta.y<0)&&((-1)*k.y>document.body.getSize().height)){m&&m.show()}}}this._lastScrollPosition=k},onRedraw:function(){this.renderScrollView()},renderScrollView:function(){var k=this.getControl("scrollView");if(k&&(typeof k.render==="function")){k.render();this.listenTo(k.scroller.elements.content,"scroll",this.onScroll);this.listenTo(k,"onInjected",this.onScrollViewInjected)}},onScrollViewInjected:function(){this.scrollViewInjected=true},usePullToRefresh:function(k){if(this.scrollView&&this.scrollViewInjected){this.scrollView.usePullToRefresh(k)}},destroy:function(){this.scrollView=null;j.getInstance().removeListener("onContextChange",this.onContextChange);return this._parent.apply(this,arguments)}});return e});define("DS/SwymUIComponents/script/feature/core/search/view/community-selector-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/community/community/collection/community-collection","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/lib/creation-statistics-persistence","UWA/Event","DS/UIKIT/Autocomplete","DS/WebappsUtils/Console","DS/UWPClientControls/PlatformNotify","DS/SwymUICore/script/lib/model/model-manager","i18n!DS/SwymUIComponents/assets/nls/feature/core/search/view/community-selector-view"],function(a,m,f,b,c,i,r,l,p,k,e,j){function h(t,w,v){p.log("templateEngine",arguments);var u,s;t.addClassName("default-template");t.addClassName("community-custom-template");if(!v.parent){u=a.createElement("span",{"class":"item-label"});u.setText(v.label);if(v.parentReference){u.addClassName("sub-item")}s=a.createElement("img",{"class":"item-logo"});s.src=b.constructThumbnailUrl("community",v.value,"m_thumb");s.inject(t);u.inject(t)}else{u=a.createElement("span",{"class":"item-parent-label"});u.setText(v.label);if(v.parentReference){u.setStyle("margin-left",v.parentReference.level+"em");u.addClassName("sub-item")}u.inject(t)}}var d="other-communities",g="recent-communities",n={post:"post",media:"media",idea:"ideation",wiki:"wikitree",survey:"survey",iquestion:"iquestion"},o=l.extend({onFocus:function(){p.log("onFocus",arguments);var s=this.elements;s.input.value="";this._parent.apply(this,arguments)},toggleSelect:function(s){if(!s||s.disabled){return}this.dispatchEvent("onSelect",[s])}}),q=m.extend({name:"community-selector-view",previouslySelectedCommunityLabel:null,previouslySelectedCommunityValue:null,currentlySelectedCommunityLabel:null,currentlySelectedCommunityValue:null,communityCollections:null,_contentCreationPersistence:null,domEvents:{"click .autocomplete-item":"onAutoCompleteItemClick"},onAutoCompleteItemClick:function(t){var s=a.extendElement(t.srcElement||t.target);p.log("onAutoCompleteItemClick",s);this.previouslySelectedCommunityLabel=this.currentlySelectedCommunityLabel;this.previouslySelectedCommunityValue=this.currentlySelectedCommunityValue},populateCommunityCollection:function(v){var x,u=v&&a.is(v.fetchCommunityCollection)?v.fetchCommunityCollection:true,w=this,t=v&&v.communityId||null;if(!this.communityCollections){this.communityCollections=[]}x=this.communityCollections[this.getOption("modelParam")];if(!x){x=this.communityCollections[this.getOption("modelParam")]=new f([],{mode:"communities-with-rights",limit:999,modelParam:n[this.getOption("modelParam")]})}var s=this._contentCreationPersistence.getRecentCommunitiesForContentType(this.options?this.getOption("modelParam"):"")||[];if(s.length>0){w.onCommunityListSync([],{showAlert:false,displayOnlyRecentCommunities:true,isCollectionSynced:false,communitySelected:t})}if(u){x.fetch({reset:true,onComplete:function(){w.onCommunityListSync(x,{showAlert:true,communitySelected:t})}})}else{w.onCommunityListSync(x,{showAlert:true,isCollectionSynced:false,communitySelected:t})}},setModelParam:function(t,s){if(this.getOption("modelParam")!==t){this.setOption("modelParam",t);this.populateCommunityCollection(s)}},setup:function(){var s=this;this._parent.apply(this,arguments);this._contentCreationPersistence=i.getInstance();this.listenTo(this._contentCreationPersistence,"CommunitiesUpdated",function(t){if(this.getOption("modelParam")===t){this.populateCommunityCollection({fetchCommunityCollection:false})}}.bind(this));this.addControl("communitySelector",new o({placeholder:"",disabled:true,noResultsMessage:j.NoMatchFound,typeDelayBeforeSearch:400,showSuggestsOnFocus:true,allowFreeInput:true,datasets:[{name:g,items:[],configuration:{templateEngine:h}},{name:d,items:[],configuration:{templateEngine:h}}],events:{onSelect:function(v,t){if(!t){s.currentlySelectedCommunityLabel=v.label;s.currentlySelectedCommunityValue=v.value;s.dispatchEvent("onCommunitySelectChange",[v.value])}if(v.disabled!==true){s.dispatchEvent("enablePublishRequest")}var u=this.elements.input;if(s.currentlySelectedCommunityLabel){u.placeholder=s.currentlySelectedCommunityLabel;u.value=""}},onFocus:function(){s.container&&s.container.addClassName("expanded")},onBlur:function(){s.container&&s.container.removeClassName("expanded")},onClickOutside:function(){var t=this.elements.input;if(s.currentlySelectedCommunityLabel&&t.value!==s.currentlySelectedCommunityLabel){t.value=s.currentlySelectedCommunityLabel}},onKeyUp:function(v){p.log("onKeyUp");var u=r.getElement(v),t=this.elements.input;if(u.value.length===0){this.showAll();if(s.currentlySelectedCommunityLabel){t.placeholder=s.currentlySelectedCommunityLabel}}}}}))},onCommunityListSync:function(z,C){var D=[],y=[],v=false,A=this.getControl("communitySelector"),t=this.previouslySelectedCommunityLabel,u=this.previouslySelectedCommunityValue,x=this._contentCreationPersistence.getRecentCommunitiesForContentType(this.options?this.getOption("modelParam"):"")||[],s=[],B=C&&a.is(C.isCollectionSynced)?C.isCollectionSynced:true;if(!u){u=C&&C.communitySelected||c.getInstance().getData().communityId}z.forEach(function(F){var H=F.get("mid"),G={value:H+"",label:F.get("title",{escapeHTML:false})},E=[];if(G.value===u){v=true;G.selected=true}E=x.filter(function(I){return I.communityId===H});if(E.length>0){y.push(G)}else{D.push(G)}});if(B&&y.length!==x.length){var w=[];x.forEach(function(E){w=y.filter(function(F){return F.value===E.communityId});if(w.length===0){s.push(E)}});if(s.length>0){this._contentCreationPersistence.removeCommunitiesForContentType(this.getOption("modelParam"),s)}}if(!B&&x.length>0){x.forEach(function(F,E){y.push({value:F.communityId+"",label:F.communityTitle,selected:E===0})})}if(B&&!v&&((C&&C.displayOnlyRecentCommunities!==true)||!C)){if(u){D.unshift({value:u,label:t,selected:true,disabled:true});if(C&&C.showAlert===true){k.info(j.NoCreationRightsForTheCurrentContentInTheCurrentCommunity)}this.dispatchEvent("disablePublishRequest")}else{if(y[0]){y[0].selected=true}else{D[0]&&(D[0].selected=true)}this.dispatchEvent("enablePublishRequest")}}if(D.length>0||y.length>0){if(A){A.cleanDataset(d);A.cleanDataset(g);if(y.length>0){A.addItems([{label:j.RecentCommunities,items:y}],A.getDataset(g));if(D.length>0){A.addItems([{label:j.OtherCommunities,items:D}],A.getDataset(d))}else{if(D.length===0&&C&&C.displayOnlyRecentCommunities===true){A.addItems([{label:j.OtherCommunitiesLoading,items:D}],A.getDataset(d))}}}else{A.addItems(D,A.getDataset(d))}A.enable()}this.container&&this.container.removeClassName("ask-author-rights")}else{this.container.addClassName("ask-author-rights");this.dispatchEvent("disablePublishRequest")}},getSelectedCommunity:function(){var s=this.getControl("communitySelector");return s?s.getValue():null},_createContent:function(){return this.getControl("communitySelector")},onDestroy:function(){var s=this.getControl("communitySelector");s&&s.destroy()}});return q});define("DS/SwymUIComponents/script/feature/community/media/library/library-list-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/library/media-library-view","DS/SwymUIComponents/script/feature/community/media/view/media-list-view","DS/SwymUIComponents/script/feature/community/media/view/media-tile-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUIComponents/script/feature/community/media/edit/upload/file-browser-upload-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/community/media/model/media-file-extension-model","DS/SwymUIComponents/script/feature/community/media/view/media-tooltip-view","DS/SwymUIComponents/script/feature/community/media/edit/upload/upload-manager","DS/SwymUIComponents/script/feature/community/media/edit/upload/drag-and-drop-upload-view","DS/Logger/Logger"],function(i,g,a,j,n,m,d,k,h,b,l,c){var e=n.extend({_modelName:"plus-media"}),f=a.extend({name:"library-list-view",modelViewClass:{media:j,"plus-media":m},domEvents:{"click .media-no-result":"_onEmptyMediaClick"},imageReloadOptions:{useVariableSizeSprite:true,selector:'img[data-type="VariableSizeMediaThumbnail"]',nonReloadedImagesOnly:true},onItemClick:function(){},_onEmptyMediaClick:function(){var o=this._uploadManager.getUploader("fileExplorer");if(o){o._onAttachmentIconClick()}},_mediaToBeUploadedArray:[],_mediaCollectionSelected:[],_mediaFileExtension:null,_addEmptyView:true,modelViewsCfg:function(q){var r=this._parent.apply(this,arguments),o=q.getModelName(),p={};switch(o){case"media":p={canBeSelected:true,events:{onRender:function(t){c.log("is being rendered");var x=t.container;if(x){var v="",u=false,y=t.model.get("mid");for(var w=0,s=this._mediaCollectionSelected.length;w<s;w++){v=this._mediaCollectionSelected[w];if(v.get("mid")===y){u=true;break}}if(u){x.addClassName("media-selected")}}}.bind(this),onClick:function(u){c.log("media has been clicked and selected");var t=u.container;w=u.model;if(t){t.toggleClassName("media-selected")}var x=t.hasClassName("media-selected");if(w){if(x){this._mediaCollectionSelected.push(w)}else{var w="",z=u.model.get("mid"),v=-1;for(var y=0,s=this._mediaCollectionSelected.length;y<s;y++){w=this._mediaCollectionSelected[y];if(w.get("mid")===z){v=y;break}}if(v>-1){this._mediaCollectionSelected.splice(v,1)}}}this.dispatchEvent("newMediaSelected",[this._mediaCollectionSelected])}.bind(this)}};break;case"plus-media":p={thumbnailMode:true,events:{onRender:function(s){c.log("plus media has been rendered");this._uploadManager.addUploader("fileExplorer",s)}.bind(this)}};break}return i.merge(p,r)},_collectionEvents:{onSync:"_addPlusModel"},_communityId:null,_uploadManager:null,defaultOptions:{uploadManagerClass:b,dragZoneSelector:".scroll-library-list",debounceDelay:500},setup:function(o){o.useDynamicGrid=true;var p=this.getOption("uploadManagerClass");this._uploadManager=new p({view:this,model:this.model});this._mediaFileExtension=k.getInstance();this.listenTo(this._uploadManager,"onUpload",this._newMediaUploaded);this._mediaToBeUploadedArray=[],this._mediaCollectionSelected=[],this._parent.apply(this,arguments)},_addPlusModel:function(){if(this.collection){var p=this.collection.at(0);if(!p||p.getModelName()!=="plus-media"){var o=new e({id:"fakeid",mid:"fakeid"});this.collection.add(o,{at:0});return true}}},_updateContainer:function(){if(this._addPlusModel()!==true){return this._parent.apply(this,arguments)}},_getDndView:function(){var o=this.getChildView("dnd");if(!o){o=this.addChildView("dnd",{Class:l,events:{onInjected:function(){c.log("dnd view got injected");this._getDndView().addDragDetectionZone(this.container.getClosest(this.getOption("dragZoneSelector")));var p=this.getElement(".media-no-result")?this.getElement(".media-no-result").getElement(".fonticon-help"):this.getElement(".fonticon-help");if(p){var q=this.addChildView("mediaTooltipView",new h({model:this._mediaFileExtension,target:p}))}}.bind(this)}});this._uploadManager.addUploader("dnd",o)}return o},addUploader:function(o,p){this._uploadManager.addUploader(o,p)},_isCollectionEmpty:function(){return !(this.collection&&(((this.collection.length===1)&&(this.collection.first().getModelName()!=="plus-media"))||(this.collection.length>1)))},_getEmptyContentContainer:function(){return this.container},_refreshBodyIncrementally:function(o){this._checkEmptyness(o);return this._parent.apply(this,arguments)},_createEmptyContent:function(){return i.createElement("div",{"class":"media-no-result",html:[{html:{tag:"span","class":"fonticon fonticon-upload-cloud fonticon-6x"}},{"class":"upload-label",html:[{tag:"span",html:(this.collection&&this.collection.exaleadQuery==="#all")?g.NoMediaAvailable:g.NoMediaSearch},!i.Utils.Client.Features.touchEvents?{tag:"span","class":"fonticon fonticon-1-5x fonticon-help"}:{}]}]})},_createContent:function(){var p,q=this._parent.apply(this,arguments),o=this._getDndView();p=[q,o];return p},_newMediaUploaded:function(t){var r,s,p,o,q=t?t.length:0;c.log("_newMediaUploaded",t);for(r=0;r<q;r++){p=t[r];o={title:p.file.customData.title,media_type:p.file.customData.type,fileName:p.file.fileName||p.file.browserFileData.fileName,userFile:p.dataURI?p.dataURI:p.file.browserFileData};s=new d({});s.addChanges(i.extend(o,p.attributes));this._mediaToBeUploadedArray.push(s)}this.dispatchEvent("newMediaAdded",[this._mediaToBeUploadedArray,this._mediaCollectionSelected])},sendCollectionTagsToTagger:function(){}});return f});define("DS/SwymUIComponents/script/feature/core/tenant/view/users-management-processes-collection-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/users-management-processes-collection-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/tenant/collection/users-processes-collection","DS/SwymUIComponents/script/feature/core/tenant/view/users-management-processes-view","DS/WebappsUtils/Console"],function(f,e,d,c,g,b){var a=d.extend({_collectionClass:c,modelViewClass:g,batchIds:{},attributes:{tag:"table","class":"table table-hover users-management-processes-table"},bodyAttributes:{tag:"tbody"},modelViewsCfg:{attributes:{tag:"tr","class":"cursor-pointer"}},_asAdmin:false,_createModelView:function(){var h=this._parent.apply(this,arguments);h.asAdmin=this._asAdmin;h.batchIds=this.batchIds;h.container.addEvent("click",function(i){if(i.target.getTagName()!="button"){this.collectionView.dispatchEvent("processClicked",[this.modelView.model]);this.collectionView.getModelViews().forEach(function(j){j.container.removeClassName("trSelected")});this.modelView.container.addClassName("trSelected")}}.bind({collectionView:this,modelView:h}));return h},_createContent:function(){if(this.collection.length>0){return[{tag:"thead",html:"<th>"+e.Title+"</th><th>"+e.Type+"</th><th>"+e.Status+"</th><th>"+e.Details+"</th><th></th>"},this._parent.apply(this,arguments)]}else{return e.Thereisnoprocessesresult}},setup:function(h){this._parent.apply(this,arguments);if(h&&h.batchIds){this.batchIds=h.batchIds}if(h&&h.asAdmin){this._asAdmin=h.asAdmin}}});return a});define("DS/SwymUIComponents/script/feature/core/user/view/users-group-tile-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/user/view/user-group/user-group-nbmembers-view","DS/SwymUIComponents/script/feature/community/members/view/member-tile-view","DS/SwymUIComponents/script/feature/core/user/mixin/view-with-users-group-link"],function(d,c,b,e){var a;a=b.extend(e,{name:"users-group-tile-view",defaultOptions:{displayBadges:false},domEvents:{"click .member-tile":"_onUsersGroupClick"},_createPictureView:function(){return{"class":"member-picture",html:{tag:"span","class":"fonticon fonticon-users-group fonticon-5x"}}},_displayBasicInfo:function(){var f=c.getUserGroupMembersText(this.model);return{styles:{"text-align":"center"},html:{"class":"member-name",html:this.model.get("name")+" ("+f+")"}}},_onUsersGroupClick:function(){return this._showUsersGroup(this.model.get("subject6wuri",{escapeHTML:false}))}});return a});define("DS/SwymUIComponents/script/feature/community/members/view/members-list-view",["UWA/Core","DS/SwymUIComponents/script/feature/core/ui-components/list/item-list","DS/SwymUIComponents/script/feature/core/user/view/user-tile-view","DS/SwymUIComponents/script/feature/core/user/view/users-group-tile-view","DS/SwymUIComponents/script/feature/core/user/view/bot-tile-view"],function(f,a,c,b,d){var e=a.extend({name:"community-members-list",modelViewClass:{user:c,"users-group":b,bot:d},setup:function(g){g.useDynamicGrid=true;this._parent.apply(this,arguments)},_createModelView:function(){var g=this._parent.apply(this,arguments);if(this.collection.hasAssociation("owned")){g.model.setAssociated("community",this.collection.getAssociated("owned"))}this.listenTo(g,"memberDeleted",this.onMemberDeleted);return g},onMemberDeleted:function(g){this.collection.remove([g]);this.refresh()}});return e});define("DS/SwymUIComponents/script/feature/core/tenant/view/users-management-processes-home-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/users-management-processes-home-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/core/tenant/collection/users-processes-collection","DS/SwymUIComponents/script/feature/core/tenant/view/users-management-processes-collection-view","DS/SwymUIComponents/script/feature/core/tenant/view/users-management-process-detail-view","DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view","DS/UIKIT/Tooltip","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/SwymUICore/script/lib/request/data","DS/SwymUICore/script/feature/core/user/model/currentuser-model"],function(h,c,d,l,g,e,f,m,j,a,k,i){var b=d.extend({name:"users-management-processes-home-view",model:null,_asAdmin:false,_createContent:function(){var n,o=h.Utils.Client.Features.touchEvents;if(this._usersManagementProcessesCollectionView){this._pagingToolbar=new m({collection:this._usersProcessesCollection,widget:this._widget,asAdmin:this._asAdmin});this._refreshBtn=h.createElement("span",{"class":"fonticon fonticon-2x fonticon-arrows-ccw",styles:{position:"relative","float":"right","margin-right":"15px",cursor:"pointer"},events:{click:function(){this.mask();if(this._usersManagementProcessDetailView){this._usersManagementProcessDetailView.hide()}this._usersProcessesCollection.resetCollection(1);this.unmask()}.bind(this)}});if(!o){new j({target:this._refreshBtn,body:c.Refresh,position:"bottom"})}n=h.createElement("div",{styles:{padding:"10px"},html:[{styles:{"margin-bottom":"10px"},html:[this._refreshBtn]},this._usersManagementProcessesCollectionView,this._pagingToolbar,{id:"users-management-processes-details-wrapper",html:""}]});return n}},setup:function(n){var o=this;o._parent.apply(o,arguments);if(n&&n.asAdmin){o._asAdmin=n.asAdmin}i.getInstanceFetched(function(p){p.addEvent("refreshUserManagementProcesses",function(){o._usersProcessesCollection.fetch();o.refresh()})});o._usersProcessesCollection=new g(null,{mode:"processes",community_id:(o.model?o.model.get("mid"):null),limit:10,asAdmin:o._asAdmin});o._usersProcessesCollection.addEvent("onProcessDeleted",function(){o._usersProcessesCollection.fetch();o.refresh()});o._usersProcessesCollection.addEvent("onSync",o.unmask);var n=l.adaptService.call({},{url:"api/member/getbatchids",type:"json",data:{},onComplete:function(q){var p=q.result;this._usersProcessesCollection.addEventOnce("onAfterPageChange",function(r){this._usersManagementProcessesCollectionView=new e({collection:r,batchIds:p,widget:this._widget,asAdmin:this._asAdmin});this._usersManagementProcessesCollectionView.addEvent("processClicked",function(s){if(Number(s.get("type"))===3){if(s.get("total")===0){var t=new a({renderTo:this._widget.body});t.alert(c.Errorbatch)}else{this.mask();this._showDetails(s)}}else{this._hideDetails()}}.bind(this));if(this.isRendered()){this.refresh()}this.unmask()}.bind(this));this._usersProcessesCollection.goToPage(1)}.bind(this)});k.request(n)},_hideDetails:function(n){if(this._usersManagementProcessDetailView){this._usersManagementProcessDetailView.hide()}},_showDetails:function(n){n.getResults({data:{asAdmin:this._asAdmin},onComplete:function(q,o){var p;n.processResults=o.result;if(!this._usersManagementProcessDetailView){this._usersManagementProcessDetailView=new f({model:n,widget:this._widget,asAdmin:this._asAdmin});p=this.container.getElement("#users-management-processes-details-wrapper");this._usersManagementProcessDetailView.inject(p)}else{this._usersManagementProcessDetailView.show();this._usersManagementProcessDetailView.setModel(n)}this.unmask()}.bind(this),onFailure:function(){this._usersManagementProcessesCollectionView.getModelViews().forEach(function(o){o.container.removeClassName("trSelected")});if(this._usersManagementProcessDetailView){this._usersManagementProcessDetailView.hide()}this.unmask()}.bind(this)})}});return b});define("DS/SwymUIComponents/script/feature/core/tenant/view/tenant-community-members-home-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/swym-control-center-view","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/core/user/view/member-set-view","DS/SwymUIComponents/script/feature/core/user/view/member-set-view-v2","DS/SwymUIComponents/script/feature/core/tenant/view/users-management-processes-home-view","DS/SwymUIComponents/script/feature/core/tenant/view/community-users-management-home-view","DS/PubSub/PubSub"],function(h,d,b,g,i,j,f,a,e,k,l){var c=g.extend({model:null,_currentUser:null,_addScroller:true,domEvents:{"click .become-moderator":"_becomeModerator"},_modelEvents:{"onChange:this":"refresh"},_createContent:function(){var m=[];if(this.getChildView("communityUsersManagementHomeView")){m.push(this.getChildView("communityUsersManagementHomeView"))}m.push(this.getChildView("memberSetView"));if(this.getChildView("communityUsersManagementProcessesHomeView")){m.push(h.createElement("h4",{html:d.Batchresults}));m.push(this.getChildView("communityUsersManagementProcessesHomeView"))}return h.createElement("div",{styles:{padding:"10px"},html:m})},setup:function(m){this._parent.apply(this,arguments);this._currentUser=i.getInstance();if(j.getInstance().isFeatureActivated("activate_export_community_users")||j.getInstance().isFeatureActivated("activate_import_community_users")){var n=this.addChildView("communityUsersManagementHomeView",new k({model:this.model,widget:this._widget,asAdmin:true}));n.addEvent("refreshUserManagementProcesses",function(){this._currentUser.dispatchEvent("refreshUserManagementProcesses")},this);this.addChildView("communityUsersManagementProcessesHomeView",new e({model:this.model,widget:this._widget,asAdmin:true}))}this.collection.as_admin=true;this.addChildView("memberSetView",new (b.isFeatureActivated("activateUsersGroup")?a:f)(h.merge({widget:this._widget,collection:this.collection,asAdmin:true},m)))},_becomeModerator:function(n){var m=this;n.stopPropagation();require(["i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/super-user-button-view"],function(o){m._currentUser.setAccess({onComplete:function(){m._currentUser.set("tenant_su","1");m.alert("success",o.Youenteredmoderationmode);window.location.reload()}})})}});return c});define("DS/SwymUIComponents/script/feature/community/community/view/community-edit-request-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-edit-request-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-visibility-settings-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/community/model/community-request-model","DS/SwymUIComponents/script/feature/core/modal/modal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Form","DS/WebappsUtils/Console"],function(i,d,m,g,e,j,k,h,b,l,f,a){var c=g.extend({_modelClass:j,name:"community-edit-request-view",defaultOptions:{readOnly:false},_createContent:function(){var n=this.model;if(n){var q;if(this.getOption("readOnly")===false||(n.get("additional_comment")&&this.getOption("readOnly"))){q=this.addControl("commentsForm",new f({fields:[{type:"textarea",name:"additional_comment",placeholder:d.ThisFieldIsMandatoryOnlyIfTheRequestIsNotAccepted,rows:3,required:true,disabled:this.getOption("readOnly"),value:(this.getOption("readOnly")?new String(n.get("additional_comment",{escapeHTML:false})):""),events:{onChange:function(v){n.addChanges("additional_comment",this.getValue().trim())}}}]}))}var r=g.extend({_modelClass:j,attributes:{tag:"div"},_createContent:function(){var v=UWA.createElement("div",{html:[{tag:"label",html:d.CommunityName,"for":"title"},{tag:"div",styles:{margin:"10px"},html:new b({name:"title",className:"title",disabled:true,value:new String(n.get("title",{escapeHTML:false}))})},{tag:"label",html:d.VisibilityPreferences,"for":"visibility"},{tag:"div",styles:{margin:"10px"},html:[new l({name:"visiblity",value:"Public",label:m.Public,className:"primary",disabled:true,checked:(n.get("access")==="1")?true:false}).check(),new l({name:"visiblity",value:"Private",label:m.Private,className:"primary",disabled:true,checked:(n.get("access")==="0")?true:false}),new l({name:"visiblity",value:"Secret",label:m.Secret,className:"primary",disabled:true,checked:(n.get("access")==="4")?true:false})]},{tag:"label",html:d.CommunityDescription,"for":"description"},{tag:"div",styles:{margin:"10px"},html:new b({name:"description",className:"description",multiline:true,disabled:true,value:new String(n.get("description",{escapeHTML:false}))})},{tag:"label",html:d.ExpectedBenefits,"for":"benefits"},{tag:"div",styles:{margin:"10px"},html:new b({name:"benefits",className:"benefits",multiline:true,disabled:true,value:new String(n.get("benefits",{escapeHTML:false}))})},{tag:"label",html:d.CommunityOwner,"for":"owner"},{tag:"div",styles:{margin:"10px"},html:new b({name:"owner",className:"owner",disabled:true,value:n.get("primary_community_owner").nickname})},(q?{tag:"label",html:d.GeneralCommentsRemarks,"for":"additional_comment"}:""),(q?{tag:"div",styles:{margin:"10px"},html:q}:"")]});return v}});var u,t,p,s;if(!this.getOption("readOnly")){u=this.addControl("declineButton",new h({value:d.DeclineRequest,className:"error",events:{onClick:function(){if(this.getControl("commentsForm").validate()){this.getControl("acceptButton").setDisabled();this.getControl("reviewButton").setDisabled();this.getControl("declineButton").setDisabled();n.set(n.getChanges());n.action("decline",{onComplete:function(){this.dispatchEvent("CommunityRequestRejected",n);this.getControl("editRequestModal").hide();this.alert("success",d.TheCommunityRequestHasBeenSuccessfullyDeclined)}.bind(this),onFailure:function(){}.bind(this)})}}.bind(this)}}));t=this.addControl("reviewButton",new h({value:d.SendBackForReview,events:{onClick:function(){if(this.getControl("commentsForm").validate()){this.getControl("acceptButton").setDisabled();this.getControl("reviewButton").setDisabled();this.getControl("declineButton").setDisabled();n.set(n.getChanges());n.action("sendback",{onComplete:function(){this._parentView.destroy();this.getControl("editRequestModal").hide();this.alert("success",d.TheCommunityRequestHasBeenSuccessfullySentBackForReview)}.bind(this),onFailure:function(){}.bind(this)})}}.bind(this)}}));p=this.addControl("acceptButton",new h({value:d.AcceptCreate,className:"primary",events:{onClick:function(){this.getControl("acceptButton").setDisabled();this.getControl("reviewButton").setDisabled();this.getControl("declineButton").setDisabled();n.action("accept",{onComplete:function(w,v){this.dispatchEvent("CommunityRequestAccepted",n);this.getControl("editRequestModal").hide();this.alert("success",d.TheCommunityHasBeenSuccessfullyCreated);if(v.result&&v.result.community_id){require(["DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/feature/core/user/model/currentuser-model"],function(y,x){x.getInstanceFetched(function(z){var A="settings";if(z.get("tenant_su")!=="1"){A="members"}y.goToUrl("admin-tenant/community:"+v.result.community_id+"/"+A)})})}}.bind(this),onFailure:function(){}.bind(this)})}.bind(this)}}))}else{if(n.get("status")==="1"){s=this.addControl("acceptButton",new h({value:d.Gotothiscommunity,className:"primary",events:{onClick:function(){var w=this,v=this.model;require(["DS/SwymUICore/script/utils/navigation"],function(x){w.getControl("editRequestModal").hide();x.goToUrl("admin-tenant/community:"+v.get("community_id"))})}.bind(this)}}))}}var o=this.addControl("editRequestModal",new k({header:"<h4>"+d.CommunityRequestDetails+"</h4>",body:[this.addChildView("communityRequestDetailsView",{Class:r,model:n})],footer:(this.getOption("readOnly")?(n.get("status")==="1"?[s]:null):[u,t,p]),closable:true,events:{onHide:function(){this.destroy()}.bind(this)}}));return o}},show:function(){this.getControl("editRequestModal").show()},setup:function(n){if(n){if(n.hasOwnProperty("parentView")){this._parentView=n.parentView}}return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/core/tenant/view/whats-new-tab-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/swym-control-center-view","DS/SwymUICore/script/feature/community/community/collection/community-request-collection","DS/SwymUICore/script/feature/community/report-abuse/collection/report-abuse-collection-v2","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/community/community/view/community-edit-request-view","DS/SwymUIComponents/script/feature/community/community/view/community-request-view","DS/SwymUIComponents/script/feature/community/report-abuse/view/report-abuse-view","DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view","DS/SwymUIComponents/script/feature/core/tenant/view/super-user-button-view","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/utils/navigation","DS/UIKIT/Mask"],function(k,f,b,c,g,h,m,o,n,d,p,j,l,i,a,e){return h.extend({name:"whats-new-tab-view",_communityRequest:null,_communityHistoryRequest:null,_superUserButton:null,_reportAbuse:null,_wrapperEl:null,setup:function(){this._parent.apply(this,arguments);this._init();if(m.getInstance().isFeatureActivated("activate_community_request")){this._communityRequest.handler()}if(i.isFeatureActivated("activateCommunityRequestsHistory")===true){this._communityHistoryRequest.handler()}this._superUserButton.handler();if(m.getInstance().isFeatureActivated("activate_report_abuse_management")){this._reportAbuse.handler()}},_maskSectionViewWrapper:function(q){if(q&&q.wrapperEl){e.mask(q.wrapperEl)}},_unmaskSectionViewWrapper:function(q){if(q&&q.wrapperEl){e.unmask(q.wrapperEl)}},_maskReportAbuseViewWrapper:function(){if(this._reportAbuse&&this._reportAbuse.wrapperEl){e.mask(this._reportAbuse.wrapperEl)}},_unmaskReportAbuseViewWrapper:function(){if(this._reportAbuse&&this._reportAbuse.wrapperEl){e.unmask(this._reportAbuse.wrapperEl)}},_init:function(){var q=this;q._communityRequest={CommunityRequestCollectionView:g.extend({name:"community-request-collection-view",_collectionClass:b,modelViewClass:n,_collectionEvents:{onRequest:function(){q._maskSectionViewWrapper(q._communityRequest)},onSync:function(){q._unmaskSectionViewWrapper(q._communityRequest)}},_createModelView:function(){var r=this._parent.apply(this,arguments);r.addEvent("onCommunityRequestClicked",this._onCommunityRequestClicked,this);return r},_onCommunityRequestClicked:function(s,r){var u=new o({model:s,parentView:r}),t=function(v){q._communityRequest.communityRequestCollection.remove(v);if(q._communityHistoryRequest){q._communityHistoryRequest.communityRequestCollection.refresh()}};u.render(document.body);u.show();u.addEvents({CommunityRequestAccepted:t,CommunityRequestRejected:t})},bodyAttributes:{tag:"table","class":"table-container"},modelViewsCfg:{attributes:{tag:"tr","class":"row-container"}}}),rearrangeTable:function(t){if(t.getModelViews().length>0){if(!t._body.getElement("thead")){var s=k.createElement("thead",{html:{tag:"tr","class":"report-abuse title",html:[{tag:"th",text:f.Name},{tag:"th",text:f.Communityname},{tag:"th",text:f.Date}]}}),r=k.createElement("tbody",{html:t._body.getElements("tr")});t._body.setContent([s,r])}}else{t._body.setContent(f.Thereisnopendingcommunityrequest)}q._unmaskSectionViewWrapper(q._communityRequest)},handler:function(){q._communityRequest.communityRequestCollection=new b(null,{mode:"all",limit:10});q._communityRequest.communityRequestCollectionView=new q._communityRequest.CommunityRequestCollectionView({collection:q._communityRequest.communityRequestCollection,widget:q._widget});q._communityRequest.pagingToolbar=new p({collection:q._communityRequest.communityRequestCollection});q._communityRequest.communityRequestCollection.goToPage(1);q._communityRequest.wrapperEl=k.createElement("div",{"class":"whats-new-community-wrapper",styles:{"min-height":"200px"}});q._maskSectionViewWrapper(q._communityRequest);k.createElement("h4",{html:f.Pending}).inject(q._communityRequest.wrapperEl);q._communityRequest.communityRequestCollectionView.addEvent("onRefresh",q._communityRequest.rearrangeTable);q._communityRequest.communityRequestCollectionView.render(q._communityRequest.wrapperEl);q._communityRequest.pagingToolbar.render(q._communityRequest.wrapperEl)}};q._communityHistoryRequest={CommunityRequestCollectionView:g.extend({name:"community-history-request-collection-view",_collectionClass:b,modelViewClass:n,_collectionEvents:{onRequest:function(){q._maskSectionViewWrapper(q._communityHistoryRequest)},onSync:function(){q._unmaskSectionViewWrapper(q._communityHistoryRequest)}},_createModelView:function(){var r=this._parent.apply(this,arguments);r.addEvent("onCommunityRequestClicked",this._onCommunityRequestClicked,this);return r},_onCommunityRequestClicked:function(s,r){var t=new o({model:s,parentView:r,readOnly:true});t.render(document.body);t.show()}.bind(this),bodyAttributes:{tag:"table","class":"table-container"},modelViewsCfg:{attributes:{tag:"tr","class":"row-container"}}}),rearrangeTable:function(t){if(t.getModelViews().length>0){if(!t._body.getElement("thead")){var s=k.createElement("thead",{html:{tag:"tr","class":"report-abuse title",html:[{tag:"th",text:f.Name},{tag:"th",text:f.Date},{tag:"th",text:f.Status}]}}),r=k.createElement("tbody",{html:t._body.getElements("tr")});t._body.setContent([s,r])}}else{t._body.setContent(f.Thereisnocommunityrequesttreated)}q._unmaskSectionViewWrapper(q._communityHistoryRequest)},handler:function(){q._communityHistoryRequest.communityRequestCollection=new b(null,{mode:"all",limit:10,status:[0,1]});q._communityHistoryRequest.communityRequestCollectionView=new q._communityHistoryRequest.CommunityRequestCollectionView({collection:q._communityHistoryRequest.communityRequestCollection,widget:q._widget});q._communityHistoryRequest.pagingToolbar=new p({collection:q._communityHistoryRequest.communityRequestCollection});q._communityHistoryRequest.communityRequestCollection.goToPage(1);q._communityHistoryRequest.wrapperEl=k.createElement("div",{"class":"whats-new-community-wrapper",styles:{"min-height":"200px"}});q._maskSectionViewWrapper(q._communityHistoryRequest);k.createElement("h4",{html:f.Treatedcommunitycreationrequests}).inject(q._communityHistoryRequest.wrapperEl);q._communityHistoryRequest.communityRequestCollectionView.addEvent("onRefresh",q._communityHistoryRequest.rearrangeTable);q._communityHistoryRequest.communityRequestCollectionView.render(q._communityHistoryRequest.wrapperEl);q._communityHistoryRequest.pagingToolbar.render(q._communityHistoryRequest.wrapperEl)}};q._superUserButton={handler:function(){l.getInstanceFetched(function(r){q._superUserButton.superUserButtonView=new j({model:r,widget:q._widget});q._superUserButton.wrapperEl=k.createElement("div",{"class":"whats-new-su-wrapper"});k.createElement("h4",{html:f.Community}).inject(q._superUserButton.wrapperEl);q._superUserButton.superUserButtonView.render(q._superUserButton.wrapperEl)})}};q._reportAbuse={ReportAbuseCollectionView:g.extend({_collectionClass:c,_collectionEvents:{onRequest:q._maskReportAbuseViewWrapper.bind(q),onSync:q._unmaskReportAbuseViewWrapper.bind(q)},name:"report-abuse-collection-view",modelViewClass:d,bodyAttributes:{tag:"table","class":"table-container"},modelViewsCfg:{attributes:{tag:"tr","class":"row-container"}}}),rearrangeTable:function(t){if(t.getModelViews().length>0){if(!t._body.getElement("thead")){var s=k.createElement("thead",{html:{tag:"tr","class":"report-abuse title",html:[{tag:"th",text:f.Name},{tag:"th",text:f.Date},{tag:"th",text:f.Type},{tag:"th",text:f.Title},{tag:"th",text:f.ReportType},{tag:"th",text:f.Comment}]}}),r=k.createElement("tbody",{html:t._body.getElements("tr")});t._body.setContent([s,r])}}else{t._body.setContent(f.Thereisnoreportabuse)}q._unmaskReportAbuseViewWrapper()},handler:function(){q._reportAbuse.reportAbuseCollection=new c(null,{mode:"all",limit:10,pageMode:"pageStartAtZero"});q._reportAbuse.reportAbuseCollectionView=new q._reportAbuse.ReportAbuseCollectionView({collection:q._reportAbuse.reportAbuseCollection,widget:q._widget});q._reportAbuse.pagingToolbar=new p({collection:q._reportAbuse.reportAbuseCollection});q._reportAbuse.reportAbuseCollection.goToPage(1);q._reportAbuse.wrapperEl=k.createElement("div",{"class":"whats-new-report-wrapper",styles:{"min-height":"200px"}});q._maskReportAbuseViewWrapper();k.createElement("h4",{html:f.Report}).inject(q._reportAbuse.wrapperEl);q._reportAbuse.reportAbuseCollectionView.addEvent("onRefresh",q._reportAbuse.rearrangeTable);q._reportAbuse.reportAbuseCollectionView.render(q._reportAbuse.wrapperEl);q._reportAbuse.pagingToolbar.render(q._reportAbuse.wrapperEl)}}},_createContent:function(){return[(m.getInstance().isFeatureActivated("activate_community_request")?k.createElement("div",{styles:{"padding-bottom":"20px"},html:this._communityRequest.wrapperEl}):""),(m.getInstance().isFeatureActivated("activate_community_request")?k.createElement("div",{styles:{"padding-bottom":"20px"},html:this._communityHistoryRequest.wrapperEl}):""),k.createElement("div",{"class":"row",styles:{margin:"0px"},html:[(m.getInstance().isFeatureActivated("activate_report_abuse_management")?{"class":"col-md-9",styles:{"padding-left":"0px"},html:this._reportAbuse.wrapperEl}:""),{"class":(m.getInstance().isFeatureActivated("activate_report_abuse_management")?"col-md-3":""),html:this._superUserButton.wrapperEl}]})]}})});define("DS/SwymUIComponents/script/feature/core/user/view/author-view",["UWA/Core","UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/small-user-tile-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUIComponents/script/feature/core/network/view/invitation-layer-view","DS/UIKIT/Tooltip","DS/RTUserPresenceAPI/RTUserPresenceAPI","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/navigation"],function(g,c,e,f,h,m,l,i,k,b,j,a){var d=f.extend({_modelClass:l,_modelEvents:{onChange:"refresh"},_invitationStatus:null,_invitationAlreadySent:null,imageReloadOptions:{useSprite:false},attributes:{styles:{"margin-right":"0px","margin-left":"0px","padding-bottom":"10px","padding-top":"10px"}},defaultOptions:{invitationFeature:true,pictureCls:"width-80px",userInfosResponsivenessCls:"col-xs-8"},domEvents:{"click .fonticon-user-add":"invitLayer"},name:"author-view",invitLayer:function(){if(this._invitationAlreadySent===true||this._invitationStatus.connected_user_to_user==="new"){this.alert("info",e.alreadySentInvitation)}else{new i({model:this.model}).launch(function(){this._invitationAlreadySent=true}.bind(this))}},getUserPictureView:function(){var o=j.getInstance().get("config").tenant,n=this;if(this.model.get("login")){if(!this._userPresenceView){this._userPresenceView=new b({size:"80px",login:this.model.get("login"),tenantId:o.id,username:"",swymUrl:h.getBaseUrl(),onclick:function(){a.goToProfile({login:n.model.get("login")})}})}this._userPresenceView.render();return this._userPresenceView}return this.addChildView("userPicture",{Class:m,model:this.model,imageRenderingOptions:{format:"normal",cls:this.options.pictureCls}})},_createContent:function(){var p=this.model,s,r,q,n,o=this.getUserPictureView();if(p){s=p.get("city");r=p.get("country");n=p.get("address");q=[o,{"class":"user-data-section",html:[{"class":this.options.userInfosResponsivenessCls,html:[{"class":"object-title",html:[(p.get("ut_state")==="9")?{tag:"span",html:(p.get("first_name")+p.get("last_name")||"")+" "}:{tag:"a","data-content-type":"person","data-hash-key":p.get("hash_key"),"data-login":p.get("login"),html:(p.get("nickname")||"")+" "},{tag:"span","class":"fonticon hidden"}]}]},{"class":this.options.userInfosResponsivenessCls,html:[(p.get("job_title")?{"class":"detail",html:c.unescapeHTML(p.get("job_title"))}:""),(p.get("company"))?{"class":"detail",html:c.unescapeHTML(p.get("company"))}:"",(n)?{"class":"detail",html:n}:"",(s||r)?{"class":"detail",html:(s||"")+((s&&r)?", ":"")+(r||"")}:""]}]}];return q}},_handleInvitationIconDisplay:function(){var n;if(this._rendered&&this._invitationStatus&&this._invitationStatus.user_in_network=="0"&&this.model.get("ds_user")!=="5"){n=this.getElement(".user-data-section .fonticon");if(n){n.addClassName("fonticon-user-add");n.removeClassName("hidden");if(!g.Utils.Client.Features.touchEvents){this.addControl("addTooltip",new k({target:n,body:e.addtoyourconnections,position:"bottom"}))}}}},_getUserInvitationStatus:function(){var n=this;if(this.model){if(g.is(this.model.get("ut_state"))){this.model.getInvitationStatus({set:false,onComplete:function(p,o){n._invitationStatus=o.result;n._handleInvitationIconDisplay()}})}else{this.listenToOnce(this.model,"onChange:ut_state",this._getUserInvitationStatus)}}},onSetModel:function(o,p,n){if(this.options.invitationFeature!==false&&j.getInstance().isFeatureActivated("activate_user_network")){if(!n.isCurrentUser()&&n.get("login")){this._invitationStatus=null;this._getUserInvitationStatus()}}},onRedraw:function(){if(j.getInstance().isFeatureActivated("activate_user_network")){this._handleInvitationIconDisplay()}},destroy:function(){try{this._userPresenceView&&this._userPresenceView.destroy()}catch(n){}this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/external-rich-link-preview-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/abstract-rich-link-preview-view"],function(c,a){var b=a.extend({className:"external-rich-link-preview",rendered:false,domEvents:{"click .preview-domain-link":"_redirectTo","click .preview-container":"_redirectTo",resize:"onResize"},_redirectTo:function(d){if(d.target.className.includes("preview-domain-link")){window.open("https://www."+this.model.get("domain"));return null}if(d.target.className.includes("preview-close")||d.target.className.includes("preview-toggle")){d.stopPropagation();return null}else{d.stopPropagation();window.open(this.model.get("url"))}},onResize:function(){var g,e,f,d;if(this.rendered){g=this.container;e=g&&g.hasClassName("external-rich-link-preview")&&g.offsetWidth;f=this.container.getElement(".preview-title");d=this.container.getElement(".preview-description");if(e){if(e<650){if(!(f.classList.contains("two-lines-title"))){f.classList.add("two-lines-title")}if(!(d.classList.contains("single-line-description"))){d.classList.add("single-line-description")}}else{if(e>=650){if((f.classList.contains("two-lines-title"))){f.classList.remove("two-lines-title")}if((d.classList.contains("single-line-description"))){d.classList.remove("single-line-description")}}}}}},render:function(){var d=this.model.get("description");this.container.setContent({tag:"div",style:"padding-bottom:1px",html:[{tag:"div","class":"preview-container",contenteditable:false,"data-url":this.model.get("url"),html:[{tag:"div","class":"icon-type-container external-icon-color",html:[{tag:"span","class":"fonticon fonticon-globe"}]},((this.model.get("image")!=="null")?{tag:"img",contenteditable:false,"class":(this.model.get("prefs")==="1"||this.model.get("prefs")==="3")?("preview-thumbnail-hidden preview-thumbnail no-media-layout-editor"):("preview-thumbnail no-media-layout-editor"),src:this.model.get("image")}:{}),{tag:"div","class":"preview-data-container",html:[{tag:"div","class":"preview-menu",html:[(this.options.editable===true)?this.createPreferencesMenu(this.model):"",(this.options.editable===true)?this.createDeleteIcon():""]},{tag:"div","class":"preview-title-container",html:[{tag:"div","class":"preview-title crop-title",html:(this.model.get("title").length>=63?(this.formatTitle(this.model.get("title"))):this.model.get("title"))}]},{tag:"div","class":"preview-domain",html:[{tag:"a","class":"preview-domain preview-domain-link",html:this.model.get("domain")}]},{tag:"span","class":(this.model.get("prefs")==="2"||this.model.get("prefs")==="3")?("preview-desc-is-hidden preview-description no-media-layout-editor"):("preview-description no-media-layout-editor crop-description"),html:(this.model.get("description").length>=150?(this.model.get("description").replace(/^(.{150}[^\s]*).*/,"$1")):this.model.get("description"))}]},{tag:"span","class":"url",html:{tag:"a",href:this.model.get("domain")}}]}]});this.rendered=true;return this}});return b});define("DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-generator",["UWA/Core","UWA/String","UWA/Class/Events","UWA/Class/Listener","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/external-rich-link-processing-utils","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/embedded-rich-link-processing-utils","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/internal-rich-link-processing-utils","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/external-rich-link-preview-model","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/internal-rich-link-preview-model","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/embedded-rich-link-preview-model","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/external-rich-link-preview-view","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/internal-rich-link-preview-view","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/embedded-rich-link-preview-view","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils","DS/Logger/Logger","DS/UIKIT/Spinner","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/rich-link-preview/rich-link-preview-generator"],function(b,c,n,g,p,i,k,u,m,r,h,o,d,t,s,j,e,l){function a(v){var w;if(b.is(v,"string")||(v instanceof Text)){w=b.createElement("div",{html:v});return((w.childNodes.length===1)&&(w.childNodes[0] instanceof HTMLElement)?w.childNodes[0]:w)}else{throw new Error("Only strings or text nodes are accepted")}}function q(v){return v!==c.unescapeHTML(v)}var f=g.singleton(n,{createPreview:function(E){var x=E.pastedURL,y=E.editorEl,C=E.callback,w=null,D=null,A=null;var z=b.createElement("a");z.href=x;var v=e.getBaseUrl().replace(/(^\w+:|^)\/\//,"");w=z.hostname===v;if(!w){D=(x.match("#app:X3DMCTY_AP")!==null)}A=w||D;if(getHostName(x)==="youtube.com"||getHostName(x)==="youtu.be"){var B=new r(i.getOEmbedJson(x,function(F){var G=new d({model:F,editable:true});C(G)}))}else{if(A){x&&k.getSearchData(x,y,function(F){s.log("getURLInformation callback",F);if(F.type==="noAccess"){require(["DS/UWPClientControls/PlatformNotify"],function(I){I.warn(l.contentNotIndexedYet)})}else{var G=new m(F),H=new o({model:G,editable:true});C(H)}})}else{p.getURLInformation(x,function(F){var I;s.log("getURLInformation callback",F);if(F.type==="html"){var G=new u(F),H=new h({model:G,editable:true});C(H)}else{require(["DS/UWPClientControls/PlatformNotify"],function(J){J.warn(l.unsupportedUrlType)})}})}}},createPreviewFromLink:function(F,M,G,w){var J=function(Q){var P=new j().inject(Q).show();var O=new r(i.getOEmbedJson(Q.href,function(S){var R=b.extend({model:S,editable:false},(w&&w.youtube||{})),T=new d(R);if(M){T.render().inject(F,"bottom")}else{T.render().inject(Q,"after")}if(b.Utils.Client.Engine.ie11){Q.parentElement.removeChild(Q)}else{Q.remove()}}))};var y=function(O){O.href&&k.getSearchData(O.href,F,function(P){s.log("getURLInformation callback",P);var Q=new m(P);Q.set("prefs",O.getAttribute("data-prefs"));var R=new o({model:Q,editable:G});if(M){R.render().inject(F,"bottom")}else{R.render().inject(O,"after")}if(b.Utils.Client.Engine.ie11){O.parentElement.removeChild(O)}else{O.remove()}})};var B,z;var C,N;var D,H;var x,A;var v;var E=e.getBaseUrl().replace(/(^\w+:|^)\/\//,"");if(b.is(F,"string")||(F instanceof Text)){B=a(F)}else{if(F instanceof HTMLElement){B=F}else{throw new Error("Unknown type of content")}}z=B.getElementsByClassName("preview-link");if(z.length>0){for(var K=0;K<z.length;K++){var L=b.createElement("a");L.href=z[K].href;var I=(L.hostname===E);if(getHostName(z[K].href)==="youtube.com"||getHostName(z[K].href)==="youtu.be"){J(z[K])}else{if(I){y(z[K])}else{C=new u(t.extractLinkData(z[K]));N=new h({model:C,editable:G});if(M){N.render().inject(F,"bottom")}else{N.render().inject(z[K],"after")}if(b.Utils.Client.Engine.ie11){z[K].parentElement.removeChild(z[K])}else{z[K].remove()}}}if(M){break}}return B}else{return F}}});return f});function getHostName(b){var a=b.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i);if(a!=null&&a.length>2&&typeof a[2]==="string"&&a[2].length>0){return a[2]}else{return null}}define("DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-comment-view",["UWA/Core","DS/SocialToolbar/Views/CommentView","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-st-utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/comment/view/comment-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/comment/view/comment-editor-view","DS/SwymUIComponents/script/feature/community/media/view/simple-content-media-view","DS/SwymUIComponents/script/feature/community/content/utils/content-renderer","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-generator","DS/Logger/Logger","DS/SwymUICore/script/feature/community/comment/model/comment-model"],function(a,h,r,n,x,u,e,p,w,c,t,k){var g=r.getInstance(),b=n.getInstance(),o="data-idea-status-id",q="div",i=q+"["+o+"]",z=function(){return a.createElement("div",{html:j.apply(this,arguments)}).getElement(i)},d=function(){var A=this.model,B=A?A.get("subjectUri"):"";return((A&&(!B||B.indexOf("swym")>-1)&&A.getAuthor().get("login")!==g.get("user").login)&&g.isFeatureActivated("activate_report_abuse_request")&&!this.getOption("instantMessageModel"))},v=function(){var B=this.container,C,A;if(B){C=B.getElement(".st-editor-footer");A=B.getElement(".wait-upload-message-3dcomment");if(C&&!A){A=a.createElement("div",{"class":"wait-upload-message-3dcomment",styles:{clear:"both"},html:e.PleaseWaitMediaUploadNotOver});C.addContent(A)}}},y=function(E){var B={},D,C=(this.model||this.collection).getSubject().getSharedOptions().getOption("swymOptions"),A;if(C){B[C.commentTextAttribute]=E;D=new C.commentModelClass(B,{commentType:C.model.getModelName()});D.setAssociated(C.commentAssociationToParentModel,C.model);A=this.components.addMap({contentMediaDisplayManager:new p({model:D,contentAttributeInModel:C.contentAttributeInModel,widget:C.widget})}).contentMediaDisplayManager}return A};var s=h.prototype._hasUserEditionRight;h.prototype._hasUserEditionRight=function(){var A=z.apply(this,arguments);if(A){return false}else{return s.apply(this,arguments)}};h.prototype._renderUserPicture=function(){return x.renderUserPicture.apply(this,arguments)};h.prototype._shouldActionMenuBeCreated=function(){if((this._hasUserEditionRight()===false)&&!d.call(this)||(this.model.getAuthor().get("login")!==g.get("user").login)&&b.isDirectMessageContext()){return false}else{return true}};var m=h.prototype._shouldFooterBeShown;h.prototype._shouldFooterBeShown=function(){var A=z.apply(this,arguments);if(A){return false}else{return m.apply(this,arguments)}};var f=h.prototype._createDropDownMenu;h.prototype._createDropDownMenu=function(){var A=this;f.apply(this,arguments);if(d.call(this)){this.components.get("dropdownMenu").addItem({name:"reportAbuse",text:u.ReportAbuse,fonticon:"flag",handler:function(){require(["DS/SwymUIComponents/script/feature/community/report-abuse/view/report-new-abuse-view","DS/SwymUICore/script/feature/community/iquestion/model/iqa-comment-model","DS/SwymUICore/script/feature/community/report-abuse/model/report-abuse-model-v2"],function(G,I,C){var H,L,F,J,K={comment:j.apply(A),subject6wuri:A.model.get("commentUri"),parentCommentUri:A.model.get("parentCommentUri")},E="",B=new C(),D=A.model.getSubject().getSharedOptions().getOption("swymOptions");if(D.model.getModelName()==="iq-answer"){J=D.model.getAssociated("answeredFor")}else{J=D.model}H=J.getModelName();switch(H){case"post":E="community_post_id";break;case"media":E="media_id";break;case"iquestion":E="iquestion_id";break;case"idea":E="ideation_id";break;case"wiki":E="wikitree_id";break;default:break}K[E]=J.get("mid");if(D.model.getModelName()==="iq-answer"){L=new I(K,{commentType:H})}else{L=new k(K,{commentType:H})}L.setAssociated("commented",D.model);F=new G({model:B,reportedModel:L});F.render(window.document.body||D.widget.body).show()})}})}};var j=h.prototype._getMessageToDisplay;h.prototype._getMessageToDisplay=function(){var D=j.apply(this,arguments),C=z.apply(this,arguments),J,B="",G="",F,H="",E,I,A=(this.model||this.collection).getSubject().getSharedOptions().getOption("swymOptions");if(C){J=C.getAttribute(o);if(a.is(J)){I=A.model.getCommunity();E=I.getStatus();this.listenTo(E,"onSync",this.updateMainSection);if(E&&E.length>0){F=E.findWhere({mid:J});if(F){B=F.get("color");G=F.get("title")}else{t.error("Idea status could not be found in status list!")}H=a.createElement("div",{html:[J&&G?{tag:"p","class":"status",html:[{tag:"span",html:u.StatusChangeTo+" "},{tag:"strong","class":"idea-status-comment",styles:{"background-color":B},html:G}]}:(J==="-1"?{tag:"p","class":"status",html:[{tag:"span",html:u.StatusOut}]}:""),{html:C.getHTML()}]})}}}else{H=w.getInstance().render(D,{createMediaView:false})}H=c.createPreviewFromLink(H,false,false);return H};var l=h.prototype._getMediaListToDisplay;h.prototype._getMediaListToDisplay=function(){var B=l.apply(this,arguments),C=y.call(this,j.apply(this,arguments)),A=C?C.render().container:"";return[B,A]}});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/patched-social-toolbar/patched-comment-editor-view",["UWA/Core","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SocialToolbar/Views/CommentEditorView","DS/SwymUIComponents/script/feature/community/content/utils/content-renderer","DS/SwymUICore/script/utils/localstorage-utils","DS/SwymUICore/script/utils/im-core-utils","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-generator","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils","DS/SwymUICore/script/lib/model/model-manager"],function(b,t,q,n,x,w,s,e,y,f){var g="3DSwym-",z=t.extend({_modelName:"dummy-comment-model-for-3dcomment",_associations:{community:{Class:q}},getCommunity:function(){return this.getAssociated("community")}});var d=function(){var B=this.container&&this.container.getElement(".wait-upload-message-3dcomment");if(B){B.destroy()}},p=function(G,C){var B={},F,E=this.components.get("contentEditorMediaView"),D=(this.model||this.collection).getSubject().getSharedOptions().getOption("swymOptions");if(D){if(!E||(C&&C.forceCreation===true)){B[D.commentTextAttribute]=G;F=new D.commentModelClass(B,{commentType:D.model.getModelName()});F.setAssociated(D.commentAssociationToParentModel,D.model);E=this.components.addMap({contentEditorMediaView:new D.mediaEditionViewClass({contentModel:F,contentAttributeInModel:D.contentAttributeInModel,parentModelAssociation:D.commentAssociationToParentModel,communityId:D.model.getCommunity().get("mid"),dragZoneSelector:D.dragZoneSelector,widget:D.widget})}).contentEditorMediaView;this.listenTo(E,{onMediaUploadsStart:function(){this._swymMediaUploadComplete=false},onMediaUploadsComplete:function(){this._swymMediaUploadComplete=true;d.call(this)},onCopyPaste:function(){this._triggerActionOnMediaIntoTextEditor(arguments[0],"remove")}.bind(this),onThumbnailRemoval:function(){this.placeCursorAt()}})}}return E},h=function(){var C;if(this.collection){C=this.collection._target.id+"new"}else{if(this.model){C=this.model.get("id")?this.model.get("id"):this.model.get("commentUri")}else{C=null}}var D=g+C+"-comment",B=w.getItem(D);if(B&&(B.length>0)){B=B.replace(/\n/gm,"<br />")}return B},A=function(){var B,C;if(this.collection){B=this.collection._target.id+"new"}else{if(this.model){B=this.model.get("id")?this.model.get("id"):this.model.get("commentUri")}else{B=null}}C=g+B+"-comment";w.removeItem(C)},m=function(D){var E,B=this._modelInstance?this._modelInstance.get("mid"):"",C;if(this.collection){C=this.collection._target.id+"new"}else{if(this.model){C=this.model.get("id")?this.model.get("id"):this.model.get("commentUri")}else{C=null}}if(C&&(typeof D==="string")){E=g+C+"-comment"+B;w.setItem(E,D)}};var o=n.prototype._setRteData;n.prototype._setRteData=function(C){var B=this._getEditorElement();if(B&&this.rte&&C instanceof HTMLElement){B.setContent(C);this.rte.updateElement();return}return o.apply(this,arguments)};var v=n.prototype._getMessageToDisplay;n.prototype._getMessageToDisplay=function(D){var C,F=x.getInstance().render(v.apply(this,arguments),{createMediaView:false}),E,B;if(typeof(F)==="string"){E=F;B=true}else{E=b.createElement("div",{html:F}).getHTML()}if(this.extraAllowedContent&&E){E=this._filterContent(E,this.extraAllowedContent)}F=b.createElement(B===true?"p":"div",{html:E});if(F.childNodes.length===1){F=b.extendElement(F.childNodes[0])}if(!b.is(D)&&this._isEditorEmpty({editorContent:F.outerHTML})){C=h.call(this);if(C){return C}}return F};var c=n.prototype._getMessageToSave;n.prototype._getMessageToSave=function(){var B=c.apply(this,arguments);B=y.convertURLPreviewToLink(B,false);return B};n.prototype._removeMediaIntoTextEditor=function(D,E){var C=this.rte,B;if(C){B=this.rte.editable().findOne('img[data-media-pasted-id="'+D+'"]');if(B){B.remove()}}};n.prototype._triggerActionOnMediaIntoTextEditor=function(B,C){require(["DS/SwymUICore/script/feature/community/media/model/media-model"],function(D){var G=this,E,F;if(B&&B.length>0){B.forEach(function(H){if(H instanceof D){E=H.get("userFile")||H.getChanges("userFile");F=E&&E.info&&E.info.mediaPastedId;if(C==="remove"){G._removeMediaIntoTextEditor(F)}else{if(C==="replace"){console.log("impossible use case for comments on onpremise")}}}else{G._removeMediaIntoTextEditor(H.mediaPastedId)}},this)}}.bind(this))};n.prototype._onPaste=function(B){var E=[],D=B.data&&B.data.dataTransfer&&B.data.dataTransfer._&&B.data.dataTransfer._.files,C=B.editor.dataProcessor,G=new CKEDITOR.htmlParser.filter({elements:{img:function(K){var M=Math.random().toString(36).substring(7),J=K.attributes,L={src:J.src,mediaPastedId:M};J["data-media-pasted-id"]=M;E.push(L)}}}),I=C.toHtml(B.data.dataValue,{filter:G,fixForBody:false});B.data.dataValue=I;if(E.length>0||D.length>0){var F=p.call(this,v.apply(this,arguments)),H;E=(E.length>0)?E:D;if(F){H=F.getUploader("copyPaste");if(H){H.getAndTransformMediaPasted(E)}}}};n.prototype._onOpenMediaLibraryRequest=function(){var B=this,C=(this.model||this.collection).getSubject().getSharedOptions().getOption("swymOptions");require(["DS/SwymUIComponents/script/feature/community/media/library/media-library-view"],function(E){var D=new E({communityId:C.model.getCommunity().get("mid"),widget:C.widget});D.injectInDom();this.listenTo(D,{newMediaAdded:function(H){var I=H.newMedia,G=H.existingMedia,F=B.components.get("contentEditorMediaView");if(I&&Array.isArray(I)&&(I.length>0)){F.addNMediaModels(I)}if(G&&Array.isArray(G)&&(G.length>0)){F.addNMediaModels(G)}D.destroy();B.placeCursorAt()}})}.bind(this))};var l=n.prototype._getMediaListToDisplay;n.prototype._getMediaListToDisplay=function(){var C=l.apply(this,arguments),B=p.call(this,v.apply(this,arguments),{forceCreation:true}),D=B?B.render():"";return[C,D]};var k=n.prototype._getMediaHtmlToSave;n.prototype._getMediaHtmlToSave=function(){var D=k.apply(this,arguments),B=this.components.get("contentEditorMediaView"),C=B?B.getHTMLToBeSaved():"";return D+C};var r=function(B,C){var D;if(B&&(!C||(C===B.rte))){D=B._getEditorContent();if(B._isEditorEmpty({editorContent:D})){A.call(B)}else{m.call(B,D)}}},j=n.prototype.saveComment,i=n.prototype.onRteReady,a=n.prototype.cancelEdition,u=n.prototype.saveSnapShot;CommentEditorViewOnSetRTEData=n.prototype.onSetRTEData,n.prototype.saveComment=function(){A.call(this);if(this._swymMediaUploadComplete!==false||this.components.get("contentEditorMediaView").collection.length===0){d.call(this);return j.apply(this,arguments)}else{displayWaitMessage.call(this)}};n.prototype.onRteReady=function(){var B=this;this.rte.on("change",function(){r(B,this)});return i.apply(this,arguments)};n.prototype.cancelEdition=function(){A.call(this);return a.apply(this,arguments)};n.prototype.saveSnapShot=function(){r(this);return u.apply(this,arguments)};n.prototype.onSetRTEData=function(){var B=this._getEditorElement();e.createPreviewFromLink(B,false,true);return CommentEditorViewOnSetRTEData&&CommentEditorViewOnSetRTEData()}});define("DS/SwymUIComponents/script/lib/ckeditor/autohyperlink/plugin",["UWA/Utils/Client","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-generator","DS/SwymUICore/script/utils/utils"],function(c,a,b){CKEDITOR.plugins.add("autohyperlink",{exclusion:[37,38,39,40,1114129],moveAfterAnchor:function(e){if(e.data&&this.exclusion.indexOf(e.data.keyCode)===-1){var j=e.editor.getSelection(1),d=j&&j.getRanges();if(d&&d.length===1&&d[0].collapsed){var f=d[0],g=f.startPath().contains("a"),i=f.startContainer;if(g&&i){if(i.type===CKEDITOR.NODE_ELEMENT&&f.startOffset===1||i.type===CKEDITOR.NODE_TEXT&&f.startOffset===i.getLength()){var h=i;while(h&&!h.equals(g)){if(h.getNext()!=null){return}h=h.getParent()}f.moveToPosition(g,CKEDITOR.POSITION_AFTER_END);f.select()}}}}},autoDetectLink:function(m){var t=/\bhttps?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/=]*)\b/i,h=m.editor,u=h.getSelection(),l=u?u.getRanges()[0]:null,i=null,p,s;var r=function(v){var w=v.createPreview({editorEl:h.container.$,pastedURL:q,previewGenerationTriggers:["paste"],callback:function(x){var y=new CKEDITOR.dom.element("p");h.insertElement(y);x.render().inject(y.$,"before");y.focus()}})};if(l&&m){s=l.startOffset;p=m.data&&(m.data.keyCode===13||m.data.keyCode===32||m.data.keyCode===2228237||m.name==="blur");if(m.data&&l.endContainer.$.parentNode&&l.endContainer.$.parentNode.tagName!=="A"&&p){if(l.endContainer.$.nodeValue){var j=l.endContainer.$.nodeValue.trim(),k=l.endContainer.$.parentNode,g=j.slice(0,s),q=g.split(" ").pop().trim(),n="";if(q.match(t)){i=h.getSelection().createBookmarks(true);if(s-q.length>0){if(k.innerHTML.match("&nbsp;"+q)){n="&nbsp;"}else{n=" "}}else{if(k.innerHTML.match("<br>"+q)){n="<br>"}}k.innerHTML=k.innerHTML.replace(n+q,n+'<a data-type="external" href="'+q+'">'+q+"</a>");l.moveToBookmark(i[0]);l.select();r(a)}}}else{if(m.name==="paste"&&(m.data.type==="html"||m.data.type==="text")){if(l.endContainer.$.parentNode){var q=m.data.dataTransfer.getData("Text"),k=l.endContainer.$.parentNode,e=q.match(t);if(e&&e.index===0){m.cancel();h.insertHtml('<a data-type="external" href="'+q+'">'+q+"</a>");r(a)}}}else{if(l.endContainer.$.parentNode&&l.endContainer.$.parentNode.tagName==="A"&&m.data&&this.exclusion.indexOf(m.data.keyCode)===-1&&!p){var d=l.endContainer.$.parentNode.innerText,o=m.data.domEvent.$.key,f="";if(o.length>1){f=d.substr(0,s-1)+d.substr(s)}else{f=d.substr(0,s)+o+d.substr(s)}if(f.match(t)){i=h.getSelection().createBookmarks2(true);l.endContainer.$.parentNode.outerHTML='<a data-type="external" href="'+f+'">'+d+"</a>";l.moveToBookmark(i[0]);l.select()}}}}}},init:function(d){var e=this;d.on("key",function(f){e.autoDetectLink(f);e.moveAfterAnchor(f)},null,null,1);d.on("blur",function(f){e.autoDetectLink(f);e.moveAfterAnchor(f)},null,null,1);if(!c.Engine.ie){d.on("paste",function(f){e.autoDetectLink(f);e.moveAfterAnchor(f)})}}})});define("DS/SwymUIComponents/script/utils/content-process",["UWA/Core","UWA/Array","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/utils/media-utils","DS/Logger/Logger","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-generator","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils"],function(f,a,g,e,b,d,i,h){var c={processImages:function(B,o,s,r){if(B){var E,D,C,A,z,w,q,H,n,m,t,p,v,G,y=null,x=["data-content-id","data-to-width","data-crop","data-type","data-width_for_sprite_cut","data-height_for_sprite_cut","data-status","data-to-height","data-cls-over","data-sprite-key","data-sprite_resizing","data-image-timestamp"];r=r||{};if(typeof B==="string"){G=f.createElement("div",{html:B})}else{G=B;if(o!==false){v=g.removeForFutureReinsertion(G.container||G)}}try{m=G.getElements('img[data-media-id], img[data-content-id]:not([data-type="CommunityNoPicture"])')}catch(F){m=G.getElements("img[data-media-id], img[data-content-id]")}for(E=0,A=m.length;E<A;E++){H=m[E];t=H.attributes;H.style.backgroundImage="";H.style.backgroundSize="";H.style.backgroundPosition="";H.style.backgroundRepeat="";if((H.style.height==="0px")||(H.style.height==="0")){H.style.height=""}H.style.padding="";H.style.height="";H.style.width="";H.removeAttribute("width");H.removeAttribute("height");y=t.getNamedItem("data-content-id");if(y){y=y.value;z=document.createAttribute("data-media-id");z.value=y;t.setNamedItem(z)}else{y=t.getNamedItem("data-media-id");if(y){y=y.value}}if(!y){continue}p=t.getNamedItem("data-to-width")||t.getNamedItem("width");if(p){p=p.value;if(p){if(t.getNamedItem("width")){t.getNamedItem("width").value=p}else{z=document.createAttribute("width");z.value=p;t.setNamedItem(z)}}}if((n=t.getNamedItem("data-fingerprint"))){n=n.value}else{if((q=t.getNamedItem("data-image-timestamp"))){q=q.value}}if(!p){p=parseInt(H.style.width,10)}if(r.mediaPictureUrl){w=r.mediaPictureUrl}else{var u=e.getBestMediaViewConfig(y,e.CONTENT_SECTION_MAX_WIDTH);w=u.url}if(t.getNamedItem("src")){t.getNamedItem("src").value=w}else{z=document.createAttribute("src");z.value=w;t.setNamedItem(z)}if(g.hasMediaBeenDeleted(y,r.imagesInfo,B)){H.removeAttribute("data-content-thumbnail");H.setAttribute("data-deleted-media","true")}for(C=0,D=x.length;C<D;C++){H.removeAttribute(x[C])}}if(typeof B==="string"){return G.getHTML()}if(v){v()}return G}},contentProcessTables:function(n){var m,j,o,l,k=n.getElements("table");for(l in k){if(k.hasOwnProperty(l)&&!k[l].getParent().hasClassName("responsive-table")){j=k[l].getParent();m=document.createElement("div");m.setAttribute("class","responsive-table");o=k[l].cloneNode(true);m.appendChild(o);j.replaceChild(m,k[l])}}return n},updateInlineTagsLookAccordingToTagsList:function(k,l){var j=false;switch(f.typeOf(k)){case"string":k=f.createElement("div",{html:k});j=true;break;case"element":f.extendElement(k);break;case false:default:throw new Error("The HTML content is invalid!")}if(!Array.isArray(l)){throw new Error("Tag list is missing!")}k.getElements("a.s6m-tag-link[data-predicate]").forEach(function(o){var n,p=o.getText(),m=o.dataset.predicate;if(p){if(!a.detect(l,function(q){return(q.predicate===m)&&(q.tag===p)})){o.addClassName("disabled-link")}else{o.removeClassName("disabled-link")}}});return(j===true)?k.getHTML():k},contentPostProcess:function(v,C){var z=(v&&v.container)||v;if(f.is(z,"element")){var t,r,q,p,w,y,A,j,x,o,s,m,u=["mce_href","_nodup"];if(!C||(C&&C.removeAndReinsert!==false)){m=g.removeForFutureReinsertion(z)}A=z.getElements("a");if(!C||(C&&C.imageProcessing!==false)){c.processImages(z,false,null,C)}if(C&&C.updateInlineTagsLookAccordingToTagsList===true&&C.tagList){z=c.updateInlineTagsLookAccordingToTagsList(z,C.tagList)}for(t=0,q=A.length;t<q;t++){y=A[t];s=y.attributes;j=y.dataset.type;if(j!=="internal"){x="external"}else{x="internal"}y.removeEvent("click");if(x==="external"){w=document.createAttribute("desc");w.value=y.getText();s.setNamedItem(w);if(s.getNamedItem("type")){s.getNamedItem("type").value=x}else{w=document.createAttribute("type");w.value=x;s.setNamedItem(w)}o=null;if(s.getNamedItem("url")){o=s.getNamedItem("url").value}else{w=document.createAttribute("url");o=y.innerHTML;if(!o.contains("http://")&&!o.contains("https://")){o="http://"+o}w.value=o;s.setNamedItem(w)}if(s.getNamedItem("onclick")){y.onclick=null}var B=null;if(!s.getNamedItem("href")){B=y.innerHTML;w=document.createAttribute("href");w.value=o;s.setNamedItem(w);y.innerHTML=B}if(s.getNamedItem("target")){s.getNamedItem("target").value="_blank"}else{w=document.createAttribute("target");w.value="_blank";s.setNamedItem(w)}for(r=0,p=u.length;r<p;r++){y.removeAttribute(u[r])}}}if(m){m()}d.createPreviewFromLink(z,false,false);return z}else{if(z){throw new Error("This function now expects a DOM Element")}}},ckeditorContentPreProcess:function(m,k){var j=m.element.$;b.log("Ckeditor html",j);console.log(j);var l=i.getInstance();if(l.editionMode===false){j=h.convertURLPreviewToLink(j,true)}d.createPreviewFromLink(j,false,true)}};return c});define("DS/SwymUIComponents/script/lib/ckeditor/ckeditor",["UWA/Core","DS/SwymUIComponents/script/lib/ckeditor/ckeditor-config","DS/SwymUIComponents/script/utils/content-process","DS/UWPClientCode/I18n","UWA/Utils/Client","DS/SwymUIComponents/script/lib/ckeditor/ckeditor-command-creator","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/lib/ckeditor/ckeditor"],function(a,v,u,j,t,w,d,k){var s,b=function(z,B){var y=z.config,x=y.model,A=y.modelAttribute;if(x&&A){if(typeof x.addChanges==="function"){x.addChanges(A,B||z.getData())}else{x.set(A,B||z.getData())}}},i=t.Engine.name==="safari"&&t.Platform.ios&&t.Platform.ipad===false,o="p;h1;h2;ul;li;ol;i;u;s;strong;blockquote;em;table[*]{*};caption;thead[*]{*};tbody[*]{*};th[*]{*};tr[*]{*};td[*]{*};br;figcaption;pre;b",c="font;img[width,height]{width,height,padding-top};",r=o+";a[data-type,data-content-type,data-content-id,data-community-id,data-login,data-users-group-uri,desc,url,href,target,contenteditable,data-predicate,data-desc,data-title,data-img,data-prefs](*);figure[data-size,data-position](*){*};img[data-media-pasted-id,data-content-id, data-media-id,data-community-id,data-media-type, data-file-extension, style,class,title,longDesc,src,data-size,data-position,data-media_cid,data-new_media,data-content-thumbnail,data-deleted-media](*){*};div[contenteditable,class,data-url](*);span[contenteditable,class, data-emoji-unicode](*);iframe(*){*}[*];",q={change:function(x){b(x.editor)},contentDom:function(y){var z=y.editor,B=z._.editable&&z._.editable.$.ownerDocument,x=B&&B.getElementsByTagName("body")[0];if(z.container&&z.container.$){if(z.config.skipUIKitFormControlClass===undefined){a.extendElement(z.container.$).addClassName("swym-rte")}}if(x){var A=function(){setTimeout(function(){var C=z._.editable.getData();b(y.editor,C);z.setData(C)},100)};if(x.addEventListener){x.addEventListener("drop",A,false)}else{if(x.attachEvent){x.attachEvent("ondrop",A)}}}z.editable().on("contextmenu",function(D){var E=z.getSelection();if(!(E&&!E.isLocked)){return}var C=E.getStartElement();if(!(C&&C.is&&C.getAscendant("table"))){D.cancel();D.stop()}},null,null,1)},paste:function(x){var A=x.data,y=x.editor.dataProcessor,z=new v.filter(r);z.disallow(c);var B=y.toHtml(A.dataValue,{filter:z,fixForBody:false});if(B.match("^<table.*?</table>$")){B='<div class="responsive-table">'+B+"</div>"}A.dataValue=B},customConfigLoaded:function(x){x.editor.config.removeButtons="Subscript,Superscript"},key:function(x){var B,A,y,z;if(x&&x.data&&x.data.domEvent&&x.data.domEvent.$){B=x.data.domEvent.$;A=B.key&&B.key.toLowerCase();if((A==="pageup")||(A==="pagedown")){x.cancel();z=x.editor;y=z.createRange();if(A==="pageup"){y.moveToElementEditStart(y.root)}else{y.moveToElementEditEnd(y.root)}z.getSelection().selectRanges([y]);y.scrollIntoView()}}}},l=a.extend(a.extend({},v.config),{language:j.getCurrentLanguage(),removePlugins:"elementspath,autolink",removeButtons:"Superscript",disableNativeSpellChecker:false,extraAllowedContent:r,disallowedContent:c,toolbar:[{name:"clipboard",groups:["undo"],items:["Undo","Redo"]},{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]}],contentsCss:[v.getUrl("contents.css"),require.toUrl("DS/UIKIT/UIKIT.css"),require.toUrl("DS/SwymUIComponents/SwymUIComponents.css")]}),m=a.extend(a.extend({},l),{height:350,resize_minHeight:350,autoGrow_minHeight:350,bodyClass:"content-body",extraPlugins:"customlink,indentblock,pastefromword,customtable,autohyperlink",toolbar:[{name:"clipboard",groups:["undo"],items:["Undo","Redo"]},{name:"basicstyles",groups:["basicstyles","cleanup"],items:["Bold","Italic","Underline","Strike","-","RemoveFormat"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"],items:["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote","CreateDiv","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},a.Utils.Client.Platform.ios?"/":"",{name:"links",items:["CustomLink","Unlink"]},{name:"insert",items:["Image","Table","HorizontalRule","SpecialChar"]},{name:"styles",items:["Styles","Format","Font","FontSize"]},{name:"colors",items:["TextColor","BGColor"]}]}),e=a.extend(a.extend({},l),{height:150,resize_minHeight:150,autoGrow_minHeight:150,removePlugins:(l.removePlugins?l.removePlugins+",":"")+"image",extraPlugins:"customlink,pastefromword,customtable,autohyperlink,highlight",skipUIKitFormControlClass:true,toolbar:[{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Highlight","-","RemoveFormat"]},(!i)?{name:"links",items:["CustomLink","Unlink"]}:""]}),h=a.extend(a.extend({},l),{height:150,resize_minHeight:150,autoGrow_minHeight:150,removePlugins:(l.removePlugins?l.removePlugins+",":"")+"image",extraPlugins:"customlink,pastefromword,customtable,autohyperlink,h1Style,h2Style,formattedStyle,BulletedListStyle,NumberedListStyle,BlockquoteStyle,highlight",skipUIKitFormControlClass:true,toolbar:[{name:"paragraph",groups:["paragraph","cleanup"],items:["h1Command","h2Command","BulletedListCommand","NumberedListCommand","BlockquoteCommand","formattedCommand","-","Outdent","Indent","AddCustomTable"]},"/",{name:"basicstyles",items:["Bold","Italic","Underline","Strike","Highlight","-","RemoveFormat"]},(!i)?{name:"links",items:["CustomLink","Unlink"]}:""]}),n=a.extend(a.extend({},l),{height:150,resize_minHeight:150,autoGrow_minHeight:150});var p=v.editor.prototype.setData,g=v.editor.prototype.getData,f=function(z){var x,y;if(z&&z!==this._lastSetSwymData){x=a.createElement("div",{html:z});y=('strike, small, big, h3, h4, h5, h6, tt, code, kbd, samp, var, del, ins, cite, q, hr, p[style*="text-align"], h2[style*="font-style"], h3[style*="font-style"], h3[style*="color"], span[dir]');if(x.getElement(y)){require(["DS/UWPClientControls/PlatformNotify"],function(A){A.warn(k.get("Yourcontentdisplaymayhavechanged"))})}}};w.createCommand(v);v.config=m;v.disableAutoInline=true;v.dtd.$removeEmpty.span=0;v.editor.prototype.setData=function(z,B,x){var y,A=null;if(!x){y=this.extraOptions&&this.extraOptions.view&&this.extraOptions.view.model;if(y){A={imagesInfo:y.get("thumbnails_infos")}}z=u.processImages(z,null,false,A);f.call(this,z);this._lastSetSwymData=z}return p.call(this,z,B,x)};v.editor.prototype.getData=function(y,z,x){return g.apply(this,arguments)};window.document.addEventListener("dragstart",function(x){x.dataTransfer.setData("text/html",u.processImages(x.dataTransfer.getData("text/html"),null,false))});s={CKEditor:v,getDefaultConfig:function(){return a.extend({},m)},getSimpleFormattingEditorConfig:function(){return a.extend({},e)},getNewCommentEditorConfig:function(){var x=a.extend({},e);x.removePlugins+=((x.removePlugins?", ":"")+"magicline");return x},getExtendedCommentEditorConfig:function(){return a.extend({},h)},getSurveyEditorConfig:function(){return a.extend({},n)},getDefaultListeners:function(){return q},addListeners:function(x){if(x){var y=null;for(y in q){if(q.hasOwnProperty(y)){x.on(y,q[y])}}if(x.customListeners){for(y in x.customListeners){if(x.customListeners.hasOwnProperty(y)){x.on(y,x.customListeners[y])}}}}}};v.on("dialogDefinition",function(x){var z=x.data.name;var A=x.data.definition;if(z==="image"){A.removeContents("Link");var y=A.getContents("info");y.remove("txtAlt");y.remove("txtBorder");y.remove("txtHSpace");y.remove("txtVSpace");y.remove("cmbAlign");A.onLoad=function(){var B=v.dialog.getCurrent();B.getContentElement("info","txtUrl").getElement().hide()}}});v.on("instanceReady",function(x){var y=x.editor,z=y.commands;y.removeMenuItem("paste");y.removeMenuItem("cut");y.removeMenuItem("copy");y.removeMenuItem("table");document.execCommand("enableInlineTableEditing",null,false);document.execCommand("enableObjectResizing",null,false);z.indent.editorFocus=0;z.outdent.editorFocus=0;z.table.editorFocus=0;z.customlink.editorFocus=0;z.customtable.editorFocus=0});return s});define("DS/SwymUIComponents/script/feature/community/media/view/document-viewer",["DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/utils/content-process"],function(c,d,b){var a=d.extend({_modelEventsForAutoRefresh:["onSync","onVirtualChange:content"],_modelEvents:(window.ds&&(window.ds.env==="3DD"))?{onNewMediaUploaded:"refresh"}:{},name:"document-viewer",_createContent:function(){var h=this,g="DS/SwymUIComponents/script/feature/community/media/view/",e=(this.model.get("play").download_original_url.format==="pdf")?g+"document-office-viewer":g+"document-default-viewer",f=this.addChildView("document-viewer",{Class:e,model:this.model});return f},setup:function(){this._parent.apply(this,arguments);this.addEventOnce("onRender",function(){b.contentPostProcess(this);this.dispatchEvent("mediaViewReady",this)})},onSetModel:function(){this._downloadUrl=c.getBaseUrl()+"/api/media/streammedia/id/"+this.model.get("mid")+"/type/original/output/download/"}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/picture-viewer",["UWA/Core","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/UIKIT/Spinner","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUIComponents/script/utils/content-process"],function(f,h,d,i,b,e,a){var g=null,c=d.extend({_modelEventsForAutoRefresh:["onSync:read","onSync:update","onVirtualChange:content"],_modelEvents:(window.ds&&(window.ds.env==="3DD"))?{onNewMediaUploaded:"refresh"}:{},name:"picture-viewer",widthToLoad:null,_createContent:function(){var k=this.model,j=null;if(k.get("preview")===undefined){return f.createElement("div",{styles:{margin:"auto","text-align":"center",height:"40px"},html:new b({className:"msg-animation",visible:true,animate:true,spin:true})})}else{if(this.pictureHasChanged){j=g}else{j=e.getPreviewThumbnail(this).url}return{styles:{clear:"both","padding-top":"5px","padding-bottom":"10px"},html:[{tag:"img","class":"img-responsive",src:j}]}}},init:function(j){if(j&&j.model instanceof i){this.addEvent("onRedraw",function(){a.contentPostProcess(this)});return this._parent.apply(this,arguments)}else{throw new Error("Provided argument is not an instance of Swym Class")}},setup:function(){this._parent.apply(this,arguments);this.pictureHasChanged=false;if(this.options.viewMode==="preview"){this.model.addEvent("onPictureHasChanged",this._onPictureChanged,this)}this.container.addEvent("resize",this.refresh.bind(this))},_onPictureChanged:function(k,j){this.pictureHasChanged=true;g=j}});return c});define("DS/SwymUIComponents/script/feature/community/content/view/content-summary-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/view/abstract-content-view","DS/SwymUIComponents/script/feature/community/media/view/interactive-media-thumbnail-view","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/survey-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/UIKIT/Input/Button","DS/SwymUICore/script/utils/i18n","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-generator","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils","DS/SwymUICore/script/feature/core/config/bootstrap-model"],function(a,k,g,b,o,c,h,l,i,n,f,r,q){var d=c.isFeatureActivated("activateSurveyImprovements");var m=520,e=395,p=200,j=236,s=k.extend({_socialFeaturesWrapperSelector:".content-body-section",_contentBodySelector:".content-body-section",_contentSummarySelector:".content-summary-section",name:"content-in-feed-summary-view",_modelEvents:{"onSync:create":"refresh","onChange:title":"refresh","onChange:community":"refresh","onChange:summary":"refresh","onChange:preview_fingerprint":"refresh","onChange:canSeeResults":"refresh"},defaultOptions:{sendCommentsInitCallInPool:true,showAuthorSection:true,socialToolbarMode:"normal",dynamicLayout:true,contentTypesForDynamicLayout:["post","idea","iquestion","wiki"]},_createThumbnail:function(){return{"class":"thumbnail",html:this._createThumbnailContent()}},isDynamicLayoutCompatible:function(){return(Boolean(this.getOption("dynamicLayout"))&&(this.getOption("contentTypesForDynamicLayout").indexOf(this.model.getModelName())>=0)&&(this.model.get("summary").trim()!==""))},_createSurveySummary:function(){var A="",D="",t,B=this.model,z=B.get("showResultsAfterVote")===true,w=q.getInstance().get("user"),H=(B.get("author").login===w.login)||(B.getAssociated("community").getUserRole()>2);if(B.isOpen()){if(B.get("userHasAlreadyAnswered")===false){A=n.replace(h.QuestionTitleSummary,{number:"1"});t=h.Answer;if(d){D=B.get("enhanced_summary",{escapeHTML:false})}else{var y=B.getAssociated("questions");D=y.at(0)?y.at(0).get("description"):""}}else{if(z===true){t=h.SeeTheResults;D=h.ThankYouForParticipating}else{if(c.isFeatureActivated("activateSurveyImprovements")){if(H||B.has("canSeeResults")){if(H||B.get("canSeeResults")===true){t=h.SeeTheResults;D=h.ThankYouForParticipating}else{D=h.ThankYouForParticipatingButWait}}else{B.canSeeResults()}}else{D=h.ThankYouForParticipatingButWait}}}}else{if(!B.hasStarted()){var F=B.getSurveyOpeningTimeRemaining(),v=F.minutes,x=h.SurveyOpenInMinutes;if(F.months){x=h.SurveyOpenInMonths;v=F.months}else{if(F.days){x=h.SurveyOpenInDays;v=F.days}else{if(F.hours){x=h.SurveyOpenInHours;v=F.hours}}}D=n.replace(x,{number:v+1})}else{t=h.SeeTheResults;D=h.SurveyIsClosed}}var G=B.getCommunity(),E=B.get("community->mid"),C=G.isDirectMessage(),u={"class":"content-summary survey-content-summary","data-content-id":B.get("mid"),"data-content-type":B.getModelName(),html:[{"class":"header",html:A},{"class":"survey-content-container",html:[{"class":"description",html:D},t?new i({className:t===h.Answer?"primary":"default",icon:t===h.Answer?"":"chart-bar",value:t}):{}]}]};if(C){u["data-dm-id"]=E}else{u["data-community-id"]=E}return u},_createSummary:function(){var w="";if(this.model.getModelName()==="survey"){this._socialFeaturesWrapperSelector=null;w=this._createSurveySummary()}else{var v=this.model.get("summary"),t=this.model.getCommunity(),x=t.get("mid"),u=this.model.get("enhanced_summary",{escapeHTML:false}),y=c.isFeatureActivated("activateEnhancedSummary");w={"data-content-id":this.model.get("mid"),"data-content-type":this.model.getModelName(),"data-community-id":x,"data-dm-id":(t.isDirectMessage()?x:""),"class":"content-summary"+(y?" enhanced":""),html:y?u:v}}return w},_openLightBox:function(){var t=arguments[1]._shouldActivateAutoplay||false;require(["DS/SwymUIComponents/script/feature/community/media/view/smart-lightbox-view"],function(u){new u({model:this.mediaThumbnailModel,isAutoplayActivated:t}).injectInDom()}.bind(this))},getMediaThumbnailContainerMaxHeight:function(){return e},getImageRenderingOptionsForMedia:function(x,w){var z,u,B,y,A,t,v;if(x){t=this.container.getSize(),z=x.get("media_type");u=parseInt(x.get("width"),10);B=parseInt(x.get("height"),10);y=(t&&t.width>0)?Math.min(t.width,m):m;if(this.isDynamicLayoutCompatible()){A=parseInt(this.getMediaThumbnailContainerMaxHeight(),10);y=parseInt(j,10)}else{A=parseInt(this.getMediaThumbnailContainerMaxHeight(),10)}v=o.getImageRenderingOptionsForMedia(u,B,y,A,z);if(v&&v.extraAttributes&&v.extraAttributes.styles&&v.extraAttributes.styles["max-width"]){v.extraAttributes.styles["max-width"]="100%"}}return v},getImageReloadOptionsForThumbnail:function(w,v){var u,z,t,B,y,A,x=null;if(w){u=w.get("mid");z=w.get("media_type");t=w.get("width");B=w.get("height");y=m;if(this.isDynamicLayoutCompatible()){A=parseInt(p,10);y=parseInt(j,10)}else{A=parseInt(this.getMediaThumbnailContainerMaxHeight(),10)}if(z&&t&&B){x=o.generateImageReloadOptionsForMedia({mediaId:u,mediaType:z,mediaWidth:t,mediaHeight:B,containerWidth:y,containerHeight:A})}else{x={size:"l",imageKind:"thumb"}}}return x},_createThumbnailContent:function(){this.mediaThumbnailModel=this.model;if(this.mediaThumbnailModel.getModelName()!=="media"){this.mediaThumbnailModel=new b(this.model.get("thumbnail"))}var t=this,u=this.addChildView("contentThumbnail",{Class:g,model:this.mediaThumbnailModel,widget:this._widget,delegateSpriteReloadToParentView:false,imageReloadOptions:this.getImageReloadOptionsForThumbnail(this.mediaThumbnailModel,this.model),imageRenderingOptions:this.getImageRenderingOptionsForMedia(this.mediaThumbnailModel,this.model),events:{onInit:function(){t.listenTo(this,"onOpenInViewerRequest",t._openLightBox)}}});return u},_createSummaryView:function(){var u=this.model,v=null,t=u.get("thumbnail"),w=false;if(this.isDynamicLayoutCompatible()){w=true}if(u){this.elements.summaryView=v=a.createElement("div",{"class":"content-summary-section"+(w?" dynamic":""),html:[(u.getModelName()==="media"||(t&&t.mid))?this._createThumbnail():null,this._createSummary()]});if(!u.hasFirstMedia()){f.createPreviewFromLink(v,true,false)}if(r.containsPreview(v)){this.elements.summaryView.addClassName("contains-preview")}}return v},_createContent:function(){var t=this.model;if(t){return[this._createTitleSection(),(this.getOption("showAuthorSection")?this._createAuthorSection():""),{"class":"content-body-section",html:this._createSummaryView()}]}}});s.MediaThumbnailContainerMaxHeight=e;s.MediaThumbnailContainerMaxWidth=m;s.MediaThumbnailContainerMaxHeightDynamic=p;s.MediaThumbnailContainerMaxWidthDynamic=j;return s});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-summary-view",["UWA/Core","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUIComponents/script/feature/community/content/view/content-summary-view"],function(c,b,d){var a=d.extend({_modelClass:b,name:"idea-summary-view",defaultOptions:{iconCls:"lamp"}});return a});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-summary-view",["DS/SwymUICore/script/feature/community/survey/model/survey-model","DS/SwymUIComponents/script/feature/community/content/view/content-summary-view"],function(b,c){var a=c.extend({_modelClass:b,name:"survey-summary-view",defaultOptions:{iconCls:"clipboard"},_modelEventsForAutoRefresh:["onChange:title","onChange:community","onChange:summary","onChange:preview_fingerprint","onChange:userHasAlreadyAnswered","onChange:canSeeResults"],setup:function(){this.model.isansweredbyme({});this._parent.apply(this,arguments)}});return a});define("DS/SwymUIComponents/script/feature/community/wiki/view/wiki-summary-view",["DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUIComponents/script/feature/community/content/view/content-summary-view"],function(c,b){var a=b.extend({_modelClass:c,name:"wiki-summary-view",defaultOptions:{iconCls:"book-open"}});return a});define("DS/SwymUIComponents/script/feature/community/post/view/post-summary-view",["UWA/Core","DS/SwymUICore/script/feature/community/post/model/post-model","DS/SwymUIComponents/script/feature/community/content/view/content-summary-view"],function(c,a,d){var b=d.extend({_modelClass:a,name:"post-summary-view",defaultOptions:{iconCls:"newspaper"}});return b});define("DS/SwymUIComponents/script/feature/community/content/view/content-highlight-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/view/content-summary-view","DS/UIKIT/Tooltip","DS/SwymUIComponents/script/feature/core/modal/super-modal","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view"],function(e,c,b,a,d){return c.extend({domEvents:{"click .unhighlight-icon":"_unhighlight","click .hide-icon":"_hideHighlightConfirmation"},name:"content-highlight-view",_unhighlight:function(){var f=this.model.getCommunity();f.addChanges("highlighted_content_uri","");f.save({},{onComplete:function(){this.alert("success",d.UnhighlightSuccess)}.bind(this),onFailure:function(){this.alert("error",d.UnhighlightFailure)}.bind(this)})},_hideHighlightConfirmation:function(){var g=this,f=new a({closable:true,renderTo:window.document.body||this._widget.body});f.confirm({title:d.HideHighlightConfirmationTitle,message:d.HideHighlightConfirmationModalMsg,callback:function(h){if(h===true){this._hideHighlight()}}.bind(this)})},_hideHighlight:function(){var f=this.model.getCommunity();f.hideContentHighlight({onComplete:function(){this.hide();this.alert("success",d.HideHighlightSuccess)}.bind(this),onFailure:function(){this.alert("error",d.HideHighlightFailure)}.bind(this)})},_createActionMenu:function(){var i=this.model.getCommunity(),g=i.getUserRole()>2,h=e.createElement("span",{"class":"unhighlight-icon fonticon fonticon-megaphone-off"}),f=e.createElement("span",{"class":"hide-icon fonticon fonticon-eye-off"});this.addControl("UnhighlightTooltip",new b({target:h,body:d.Unhighlight}));this.addControl("hideTooltip",new b({target:f,body:d.HideHighlight}));return g?h:f},onRedraw:function(){},_createIconBackgroundSection:function(){return{tag:"span","class":"highlight-icon-background fonticon fonticon-megaphone"}},setup:function(f){this.hide();this.model.getCommunity().isContentHighlightHidden({onComplete:function(h,g){console.log("the result is ",h,g);if(!g){this.show()}}.bind(this)});this._parent.call(this,f)},_createContent:function(){var f=this.model;if(f){this.show();return[this._createIconBackgroundSection(),this._createTitleSection(),{"class":"content-body-section",html:this._createSummaryView()}]}else{console.log("no model defined yet")}}})});define("DS/SwymUIComponents/script/feature/community/question/view/question-summary-view",["UWA/Core","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUIComponents/script/feature/community/content/view/content-summary-view","DS/SwymUIComponents/script/feature/community/question/question-view-mixin"],function(d,b,e,c){var a=e.extend({_modelClass:b,name:"question-summary-view",validated:null,defaultOptions:{SocialFeaturesClassV2:"DS/SwymUIComponents/script/feature/community/question/social-interactions/social-features-for-question-view",iconCls:"help"}});return a.extend(c)});define("DS/SwymUIComponents/script/feature/community/media/view/media-3dplay-viewer",["UWA/Core","UWA/Promise","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/media-3d-viewer","DS/UIKIT/Spinner","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/utils/content-process","DS/SwymUICore/script/feature/core/context/context-model","DS/WebappsUtils/WebappsUtils","DS/WAFData/WAFData","DS/Logger/Logger"],function(i,k,g,m,f,d,h,j,c,n,b,l,a){var e=g.extend({_playerObj:null,_modelEventsForAutoRefresh:["onSync:read","onChange:content"],_modelEvents:window.ds&&window.ds.env==="3DD"?{onNewMediaUploaded:"refresh"}:{},name:"media-3dplay-viewer",domEvents:{},on3DPlayerReadyBound:null,_createContent:function(){var o,r=this,q=this.model;if(q){if(!this._fileViewable){o=i.createElement("div",{styles:{margin:"auto","text-align":"center",height:"40px"},html:new d({className:"msg-animation",visible:true,animate:true,spin:true})})}else{this.reinitView();if(i.Utils.Client.Platform.ios){m.getInstance().executeWhenReady(function(){var t={objectId:r.model.get("mid"),serviceId:"3DSwym",envId:this.get("config").tenant.online_instance_id};require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(u){u.publish("setObject",t)})})}var s="",p={position:"relative","z-index":"0"};if(this.height){p.height=this.height+"px"}if(this.width){p.width=this.width+"px"}if(q.get("status")===h.MEDIA_PROCESSING_STATUS.KO){s=f.mediaError}else{if(!this._fileViewable){s=f.mediaNotProcessed}}o=[];if(this._fileViewable){o.push({id:"canvas-wrapper-"+this.cid,"class":"x3dplay-wrapper"+(this.height?" specific-height":""),styles:p})}if(s){o.push({"class":"warning-wrapper",styles:{margin:"15px 0px 5px 0px"},html:s})}}return o}},setup:function(o){this.addEvent("onRedraw",function(){c.contentPostProcess(this)});if(typeof o.height!=="undefined"){this.height=o.height}if(typeof o.width!=="undefined"){this.width=o.width}this._parent.apply(this,arguments);if(window.ds&&ds.env==="3DD"&&this._widget){this._widget.addEvent("contentDroppedInWidget",this.reinitView.bind(this))}this._fileViewable=this._isFileViewable();this.on3DPlayerReadyBound=this.on3DPlayerReady.bind(this);this.instantiatedInDetailedView=n.getInstance().isContentContext()},_getFullscreenOptions:function(){return{activateOnStart:true,onActivate:function(){var o=this.container.getClosest(".center-section-view-container .scroller-root");if(o){this.scrollViewElOriginalStyle=o.getStyle("transform");o.setStyle("transform","none")}var p=this.container.getClosest(".center-section-view-container .scroller-content");if(p){this.scrollContentElOriginalStyle=p.getAttribute("style");p.setAttribute("style","-webkit-overflow-scrolling:auto !important")}}.bind(this),onDeactivate:function(){var o=this.container.getClosest(".center-section-view-container .scroller-root");if(o){o.setStyle("transform",this.scrollViewElOriginalStyle)}var p=this.container.getClosest(".center-section-view-container .scroller-content");if(p){p.setAttribute("style",this.scrollContentElOriginalStyle)}}.bind(this),mode:"CUSTOM"}},onLoadAnnotationRequestCallback:function(o){var p=this._playerObj,q={clean:true},r={};if(o&&(o.type==="annotation")&&o.data&&o.data.annotationFile){r.annotation=o.data.annotationFile;if(p&&p.loadAnnotations&&p.isReady&&p.isReady()){p.loadAnnotations(r,q)}}},_onAnnotationShared:function(p){a.log("----------------------",p);var q=p.screenshot,o=p.annotation;this.dispatchEvent("onAnnotationShared",{annotation:{type:"annotation",file:q,data:{annotationFile:o}}})},_getOptions:function(){var p=this.model,q=n.getInstance(),r=p.get("ratio")?h.getPreviewThumbnail(this).url:null,o={topBar:{id:this._widget?this._widget.id:" "},loading:"autoplay",activeState:Boolean(q.isContentContext()),callback:{onAnnotationShared:this._onAnnotationShared.bind(this)}};o.fullscreen=this._getFullscreenOptions();if(r){o.splashscreen={custom:new i.createElement("div",{styles:{"background-image":"url("+r+")","background-size":"contain","background-position":"center","background-repeat":"no-repeat",height:"100%","background-color":"white"}})}}if(window.ds&&ds.env==="3DSwym"){o.topBar={id:"3DPlayTopBarProxy"};try{require("DS/TopBar/TopBar").MainMenuBar.setActiveMenuProviders(["topBarProxyDefault","3DPlayTopBarProxy"])}catch(s){require(["DS/TopBar/TopBar"],function(t){t.MainMenuBar.setActiveMenuProviders(["topBarProxyDefault","3DPlayTopBarProxy"])})}}return o},instantiate3DPlay:function(){var q=window.ds&&(window.ds.env==="MOBILE"),r,s,p;if(this._fileViewable){if(q){p=this.model;r=p.get("play->download_original_url->transient_url",{escapeHTML:false});s=p.get("play->download_original_url->format");require(["DS/SwymUICore/script/feature/core/mobile/communication-manager"],function(t){t.sendOpenMediaRequest({transientURL:r,extension:s})})}else{if(!this.getElement("#canvas-wrapper-"+this.cid)){a.error("3DPlay container does not exist!");return}var o={container:"canvas-wrapper-"+this.cid,input:this._getInputOptions(),options:this._getOptions(),widget:this._getWidgetParam()};require(["DS/3DPlayHelper/3DPlayHelper"],function(t){if(this._playerObj===null&&this.on3DPlayerReadyBound){try{i.extendElement(window.top.document).addEvent("3DPLAYREADY",this.on3DPlayerReadyBound);this._playerObj=t(o)}catch(u){a.error(u)}}}.bind(this))}}},_getWidgetParam:function(){return this._widget?this._widget:null},on3DPlayerReady:function(){this.dispatchEvent("mediaViewReady",this);this.show()},onDestroy:function(){if(this.on3DPlayerReadyBound){try{i.extendElement(window.top.document).removeEvent("3DPLAYREADY",this.on3DPlayerReadyBound)}catch(o){a.error(o)}}this.reinitView();return this._parent.apply(this,arguments)},onHide:function(){a.info("media-3d-viewer, widget.onHide");if(this.instantiatedInDetailedView){this.reinitView()}return this._parent.apply(this,arguments)},onShow:function(){},reinitView:function(){if(window.ds&&ds.env==="3DSwym"){try{require("DS/TopBar/TopBar").MainMenuBar.setActiveMenuProviders(["topBarProxyDefault"])}catch(o){require(["DS/TopBar/TopBar"],function(p){p.MainMenuBar.setActiveMenuProviders(["topBarProxyDefault"])})}}if(this._playerObj){this._playerObj.informActiveState(false);this._playerObj=null}}});return e});define("DS/SwymUIComponents/script/feature/community/media/view/media-360-viewer",["DS/SwymUIComponents/script/feature/community/media/view/media-3dplay-viewer"],function(a){var b=a.extend({name:"media-360-viewer",_isFileViewable:function(){return true},setup:function(d){var c=this.model;d.width=null;d.height=null;this._parent.apply(this,arguments)},_getMediaURL:function(){var d=this.model.get("play"),c;if(d){c=d.download_original_url.transient_url}return c},_getImageFormat:function(){var d=this.model.get("play"),c;if(d){c=d.download_original_url.format}return c},_getInputOptions:function(){return{experience:{provider:"FILE",filename:"DS/3DPlay360Experiences/3DPlay360Experience"},asset:{provider:"FILE",format:this._getImageFormat(),filename:this._getMediaURL(),requiredAuth:null,proxyurl:"none",withCredentials:true},usage:"3DSwYm"}},_getWidgetParam:function(){return null},onRedraw:function(){this.instantiate3DPlay()}});return b});define("DS/SwymUIComponents/script/feature/community/media/view/document-office-viewer",["DS/SwymUIComponents/script/feature/community/media/view/media-3dplay-viewer","DS/SwymUIComponents/script/utils/media-utils"],function(a,c){var b=a.extend({name:"document-office-viewer",_isFileViewable:function(){var d=this.model;if(d&&this._playerObj===null&&((d.get("status")===c.MEDIA_PROCESSING_STATUS.OK&&d.get("preview")!==undefined&&d.get("play")!==undefined)||(d.get("status")!==c.MEDIA_PROCESSING_STATUS.OK&&(d.get("format_3dsa")==="3dxml"||(d.get("fileName")&&d.get("fileName").contains(".3dxml")))))){return true}else{return false}},setup:function(e){var d=this.model;e.width=null;e.height=null;this._parent.apply(this,arguments)},_getDocumentURL:function(){var e=this.model.get("play"),d;if(e){d=e.download_original_url.transient_url}return d},_getDocumentFormat:function(){var e=this.model.get("play"),d;if(e){d=e.download_original_url.format}return d},_getInputOptions:function(){return{experience:{provider:"FILE",filename:"DS/3DPlayDocumentViewer/3DPlayDocumentViewer"},asset:{provider:"FILE",format:this._getDocumentFormat(),filename:this._getDocumentURL(),requiredAuth:null,proxyurl:"none",withCredentials:true,requestsOptions:{proxy:"none",withCredentials:true}},usage:"3DSwYm"}},onRedraw:function(){this.instantiate3DPlay()}});return b});define("DS/SwymUIComponents/script/feature/community/media/view/media-3d-viewer",["UWA/Core","DS/SwymUIComponents/script/feature/community/media/view/media-3dplay-viewer","DS/SwymUIComponents/script/utils/media-utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/media-3d-viewer","DS/WebappsUtils/Console"],function(e,a,f,d,c){var b=a.extend({_3dsaInitDone:false,name:"media-3d-viewer",setup:function(g){g.width=null;this._parent.apply(this,arguments)},_isFileViewable:function(){var g=this.model;if(g&&this._playerObj===null&&((g.get("status")===f.MEDIA_PROCESSING_STATUS.OK&&g.get("preview")!==undefined&&g.get("play")!==undefined)||(g.get("format_3dsa")==="3dxml"||g.get("fileName")&&g.get("fileName").contains(".3dxml")))){return true}else{return false}},_getInputOptions:function(){return{asset:{provider:"FILE",format:this.model.get3DFileFormat(),filename:this.model.get3DFileURL(),requiredAuth:null,proxyurl:"none",withCredentials:true,requestsOptions:{proxy:"none"}},usage:"3DSwYm"}},onRedraw:function(){if(!this._3dsaInitDone){c.log("media-3d-viewer - will call 3dsa");f.request3DSAAuthentification({authenticationUrl:this.model.get("play").wake_up_url,successCallback:this.instantiate3DPlay.bind(this),failureCallback:function(){c.error("basic user info is KO");require(["DS/UWPClientControls/PlatformNotify"],function(g){g.error(d.The3DFilecannotbeviewed)})}});this._3dsaInitDone=true}else{this.instantiate3DPlay()}}});return b});define("DS/SwymUIComponents/script/feature/community/media/view/video-viewer",["UWA/Core","UWA/Class","UWA/Utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/view/video-viewer","DS/SwymUIComponents/script/feature/community/media/view/video/player-behaviors","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/DSVideoJS/DSVideoJS","DS/SwymUICore/script/utils/i18n","DS/UIKIT/Spinner","DS/SwymUIComponents/script/utils/content-process","DS/SwymUIComponents/script/utils/media-utils","DS/WebappsUtils/Console"],function(l,a,f,h,e,m,j,o,p,d,c,k,b){var i=(window.ds&&(window.ds.env==="3DD")),n=a.singleton({_playerInstanceIds:[],setup:function(r){if(r&&r.id){var s=this,t=videojs(r.id),q;s._playerInstanceIds.push(r.id);if(t){t.on("play",function(){b.log("an instance is playing");for(var v=0,u=s._playerInstanceIds.length;v<u;v++){if(s._playerInstanceIds[v]!==this.id_){q=videojs(s._playerInstanceIds[v]);if(q&&q.pause&&q.loop()!==true){b.log("is player playing before being paused : ",!q.paused());q.pause()}}}});t.on("pause",function(){b.log("an instance has been paused");if(this&&this.loop()===true){b.log("instance relaunched");this.play()}})}}},hasPlayer:function(q){return(this._playerInstanceIds.indexOf(q)>-1)},remove:function(q){this._playerInstanceIds.pop(q)}}),g=j.extend({_modelEventsForAutoRefresh:[],_modelEvents:{"onVirtualChange:content":"_onVirtualChange"},_offset:null,_iOSVersionError:false,_useHTML5:false,_clientInfo:null,_onVirtualChange:function(){if(this.viewMode==="preview"){this.refresh()}},_onVideoDownload:function(){},getState:function(){var q=videojs(this._getVideoId());return{offset:q.currentTime(),state:(q.paused()&&q.hasStarted())?"readyForThumbnail":"notReadyForThumbnail"}},name:"video-viewer",_checkIOSVersion:function(){if(/iP(hone|ad)/.test(navigator.platform)){var q=(navigator.appVersion).match(/OS (\d+)_(\d+)_?(\d)?/);return parseInt(q[1],10)+"."+parseInt(q[2],10)}else{return false}},_createContent:function(){b.info("_createContent",this.model.get("status"));var q,r;if(this._clientInfo.isIos){r=this._checkIOSVersion()}if(r&&(r==="10.0"||r==="10.1")){this._iOSVersionError=true;q={"class":"video-iOS-error",html:[{"class":"fonticon fonticon-4x fonticon-attention "},{html:h.iOSDoesNotSupport3DSwymVideos}]}}else{this._useHTML5=true;q={tag:(this.model.get("media_type")==="sound")?"audio":"video","class":"video-js vjs-big-play-centered",id:this._getVideoId()}}this.dispatchEvent("mediaViewReady");return q},_getVideoId:function(){return"video"+this.cid},defaultOptions:{isLightboxContext:false},setup:function(q){this._parent.apply(this,arguments);this.height=this.model.get("height")||q.height;this._clientInfo=m.getClientInformation();this.viewMode=this.options.viewMode;if(this.viewMode==="edit"){this.options.autoplay=false}this.addEvent("onRedraw",function(){c.contentPostProcess(this)});this.addEvent("onMediaDownload",this._onVideoDownload);return this},createFileLevel:function(){var t=this.model,w=t.get("media_type"),v=t.get("nb_video_streams_3dsa"),x=t.get("play").av_streams,u=t.get("ratio"),y=[];if(w==="video"){u=(u.indexOf("Nan")!==-1)?"4:3":u.replace("/",":")}if(parseInt(v,10)>0&&w==="sound"){w="video"}for(var r=0,q=x.length;r<q;r++){var s=x[r];y.push({file:s.transient_url,format:s.format,label:(w==="video")?s.alias:"","default":(s.alias==="480p")?true:false})}this.fileUrls=y},authenticate:function(q,r){k.request3DSAAuthentification({authenticationUrl:this.model.get("play")["wake_up_url"],successCallback:q,failureCallback:r})},initVideoHTML5:function(){var C=this._getVideoId(),s=[],x=[],v={oncontextmenu:"return false;"},y=this.model,r=y.get("play").preview_scans,z=y.get("play").subtitles,D=y.get("play").chapters,A=y.get("media_type"),B="",E="",G;this.createFileLevel();for(var w=0,t=this.fileUrls.length;w<t;w++){x.push({tag:"source",src:e.getAVStream(this.fileUrls[w].file),label:this.fileUrls[w].label,res:this.fileUrls[w].label,type:((A==="sound")?"audio":"video")+"/"+((A==="sound")?"mpeg":this.fileUrls[w].format)});if(w===0&&A!=="animatedPicture"){B=this.fileUrls[w].label;E=this.fileUrls[parseInt(t/2,10)-1].label}}for(var w=0,u=z.length;w<u;w++){s.push({tag:"track",kind:"subtitles",src:z[w]?z[w].transient_url:"",label:z[w]?z[w].alias:""})}for(var w=0,u=r.length;w<u;w++){s.push({tag:"track",kind:"metadata",src:r[w]?r[w].transient_url:""})}for(var w=0,u=D.length;w<u;w++){s.push({tag:"track",src:D[w]?D[w].transient_url:"",kind:"chapters"})}if(i){v.crossoriginvjs="use-credentials"}if(this.height){v.height=this.height+""}if(A==="video"){v.poster=k.getPreviewThumbnail(this).transient_url}var F=this.getElement("video")||this.getElement("audio");if(F){F.setAttributes(v);F.addContent(x);F.addContent(s);if(A==="animatedPicture"){F.setAttribute("muted","")}}if(r[0]&&r[0].transient_url){G=r[0].transient_url.split("/");G=G.slice(0,G.length-1);G=G.join("/")+"/"}var q=videojs(C,{fluid:(A!=="sound"),controls:e.getControlsBehavior(this.options.controls,A),autoplay:e.getAutoPlayBehavior(this.options.autoplay,A),preload:"auto",loop:e.getLoopBehavior(A),controlBar:{fullscreenToggle:(A==="video")},playsinline:f.Client.Features.touchEvents&&(A==="animatedPicture"),textTrackSettings:false,plugins:(A==="video")?{thumbnails:{basePath:G},videoJsResolutionSwitcher:{"default":this.getOption("isLightboxContext")===true?B:E,dynamicLabel:true}}:{}});q.one("ready",this._onReady.bind(this));q.on("fullscreenchange",function(){var I=q.currentResolution().label;if(q.isFullscreen()){if(I!==B){this.previousRes=I;q.currentResolution(B)}var H=this.container.getClosest(".scroller-root");if(H){H.setStyle("transform",this.scrollViewElOriginalStyle)}}else{if(I!==this.previousRes){q.currentResolution(this.previousRes)}var H=this.container.getClosest(".scroller-root");if(H){this.scrollViewElOriginalStyle=H.getStyle("transform");H.setStyle("transform","none")}}}.bind(this));n.setup({id:C})},_onReady:function(){this.show()},onRender:function(){b.info("video onrendered");if(this._iOSVersionError){this.show()}else{if(this._useHTML5){this.authenticate(function(){if(!this._loaded){this._loaded=true;b.log("authenticated !");if(this.model.get("media_type")==="sound"){this.initVideoHTML5()}else{require(["DS/DSVideoJS/DSVideoResolutionSwitcherPlugin","DS/DSVideoJS/DSVideoThumbnailPlugin"],function(r,q){this.initVideoHTML5()}.bind(this))}}}.bind(this),function(){b.error("basic user info is KO");require(["DS/UWPClientControls/PlatformNotify"],function(q){q.error(h.Thevideocannotbeviewed)})}.bind(this));this.show()}}},onHide:function(){if(n.hasPlayer(this._getVideoId())){var q=videojs(this._getVideoId());if(q&&this.model.get("media_type")!=="animatedPicture"){q.pause()}}},onShow:function(){if(n.hasPlayer(this._getVideoId())){var q=videojs(this._getVideoId());if(q&&this.model.get("media_type")==="animatedPicture"){q.play().then(function(){},function(){q.controls(true)})}}},onDestroy:function(){n.remove(this._getVideoId());var q=videojs(this._getVideoId());if(q){q.dispose()}this._parent.apply(this,arguments)}});return g});define("DS/SwymUIComponents/script/feature/community/media/view/animated-picture/mobile/gif-video-viewer",["DS/SwymUIComponents/script/feature/community/media/view/video-viewer"],function(b){var a=b.extend({_playIndex:0,_maxTimesToPlay:3,name:"gif-video-viewer",initVideoHTML5:function(){var c;this._parent();c=videojs(this._getVideoId());c.on("ended",this.onAnimatedPicturePlayEnded.bind(this))},onAnimatedPicturePlayEnded:function(){var c=videojs(this._getVideoId());this._playIndex++;console.log("------",this.playIndex);if(this._playIndex===this._maxTimesToPlay){c.pause();this.playIndex=0;this.dispatchEvent("onRefreshRequest")}else{c.play()}}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/video-thumbnail-editor-view",["DS/SwymUIComponents/script/feature/community/media/view/video-viewer"],function(b){var a=b.extend({name:"video-thumbnail-editor",_modelEvents:{onVirtualChange:"_onChangeThumbnailTime"},_convertBackendDateInMs:function(e){var d=e.split(":"),c=0;if(d[0],d[1],d[2]){c=parseInt(d[0])*3600+parseInt(d[1])*60+parseInt(d[2])}return c*1000},_onChangeThumbnailTime:function(){var c=this.model.hasVirtuallyChanged("thumbnail_time_ms")?this.model.getChanges("thumbnail_time_ms"):this._convertBackendDateInMs(this.model.get("thumbnail_time")),d=videojs(this._getVideoId());if(d){d.one("play",function(){if(d.readyState()){d.currentTime(c/1000);console.log(d.readyState());d.pause()}else{d.one("loadedmetadata",function(){d.pause();d.currentTime(c/1000);console.log("has changed");console.log(d.readyState())})}});d.play()}},_onReady:function(){this._onChangeThumbnailTime()}});return a});define("DS/SwymUIComponents/script/feature/community/content/view/swym-editor-view",["UWA/Core","UWA/Event","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/utils/content-process","DS/SwymUIComponents/script/utils/media-utils","UWA/Utils/Client"],function(g,h,d,e,f,a){var b=2,i=function(j){var k=h.getElement(j);k.removeEvent("load",i)};var c=d.extend({name:"swym-editor-view",addMediaButton:null,ckeditor:null,_isSafariIpad:a.Engine.name==="safari"&&a.Platform.ios&&a.Platform.ipad===true,getImgTagToInsertIntoEditor:function(m,s){var r=null,o=this,l=null,k,n=g.extendElement(m.cloneNode()),p,j=320,q,t;n.setStyles({backgroundImage:"",backgroundSize:"",backgroundPosition:"",backgroundRepeat:""});p=n;if(!g.is(s,"function")){throw new Error("A callback is expected")}k=n.dataset.mediaId;if(!k){k=(n.getAttribute("data-content-type")==="media")&&n.getAttribute("data-content-id");if(k){n.dataset.mediaId=k}}t=n.getAttribute("data-media-type");n.removeAttribute("data-to-width");n.removeAttribute("data-to-height");if(t==="picture"){r=function(){var y,x,v,w,u;if(l){w=parseInt(l.get("width"),10);u=parseInt(l.get("height"),10)}else{w=p.naturalWidth||parseInt(p.style.width,10);u=p.naturalHeight||parseInt(p.style.height,10);if(!(w>0)){y=p.getSize();w=y.width;u=y.height}}if(u>0&&!o.isDestroyed()){x=w/u;if(w>f.PICTUREVIEW_V0.DIMENSIONS.LARGE.WIDTH||u>f.PICTUREVIEW_V0.DIMENSIONS.LARGE.HEIGHT){if(x>1){j=f.PICTUREVIEW_V0.DIMENSIONS.LARGE.WIDTH;q=j/x}else{q=f.PICTUREVIEW_V0.DIMENSIONS.LARGE.HEIGHT;j=q*x}}else{j=w;q=u}if(p.dataset.mediaId){v=f.generateBestThumbnailForContentView(j,q,null,{mediaId:p.dataset.mediaId,mediaType:"picture",mediaWidth:w,mediaHeight:u,imgTag:p});p=e.processImages(g.createElement("div",{html:p}),null,false,{mediaPictureKey:v.sizeCategory,mediaPictureUrl:v.url}).getElement("img")}p.removeEvent("load",r);p.set(g.merge(j>f.CONTENT_LARGE_IMAGE_MIN_WIDTH?{"data-size":"large","data-position":"center"}:{},{styles:{width:j,height:""}}));p.remove();p.removeClassName("loading-image");s.call(this,p,{heightToDisplay:q,widthToDisplay:j,imageWidth:w,imageHeight:u})}};if(k){require(["DS/SwymUICore/script/feature/community/media/model/media-model"],function(u){l=new u({mid:k});l.fetch({fromCache:true,onComplete:r})})}else{if(p.complete){r()}else{p.addClassName("loading-image");p.addEvent("load",r);p.inject(document.body)}}}else{p=e.processImages(g.createElement("div",{html:n}),null,false).getElement("img");j=parseInt(p.naturalWidth||p.getStyle("width")||p.width||320,10);if(j>f.CONTENT_LARGE_IMAGE_MIN_WIDTH){p.set({"data-size":"large","data-position":"center"})}s.call(this,p)}},_insertBase64ImageStyle:function(l,k,j){if(!k){throw new Error("Media CID is missing!")}if(!j){throw new Error("Image dimensions info are missing!")}this.elements["swym-b64-img-style-"+k]=g.createElement("style",{type:"text/css",id:"swym-b64-img-style-"+k,html:('.swym-b64-img[data-media_cid="'+k+'"] {    background-image: url('+l.src+");}")}).inject(document.head)},replaceBase64ImageSrcWithCSSClass:function(l,k,j){var m;if((l.dataset.mediaType==="picture")&&g.is(k,"object")){m=l.src;if(m&&m.indexOf(";base64")>=0){this._insertBase64ImageStyle(l,j.cid,k);l.addClassName("swym-b64-img");l.setAttribute("data-media_cid",j.cid);l.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+k.imageWidth+" "+k.imageHeight+'" width="'+k.imageWidth+'" height="'+k.imageHeight+'"></svg>')}}},insertMediaIntoTextEditor:function(k,p,l){var m=this,n=(k&&k.target||p),j=this.getChildView("textEditorView"),o=(j)?j.ckeditor:this.ckeditor;this.getImgTagToInsertIntoEditor(n,function(r,q){m.replaceBase64ImageSrcWithCSSClass(r,q,l);if(m._isSafariIpad===false){o.insertElement(new CKEDITOR.dom.element(r))}else{o.container.appendHtml(r.outerHTML)}})},createTagImageForEditor:function(l){var j=l.getCommunity(),m=j.get("mid"),n=j.isDirectMessage(),k={"data-media-id":l.get("mid"),"data-media-type":l.get("media_type"),"data-source":"swym","data-to-width":"320"};if(n){k["data-dm-id"]=m}else{k["data-community-id"]=m}this.insertMediaIntoTextEditor({target:g.createElement("img",k)},null,l)},hideAddMediaView:function(){var j=this.getElement(".add-media-container"),k=this.getElement(".attached-media");if(j){j.hide()}if(k){k.setContent("")}if(this.addMediaButton){this.addMediaButton.setState(2)}},updateEditor:function(){},onInjected:function(){this.dispatchEvent("onNodeInject")},onNodeInject:function(){this.updateEditor()},saveSnapShot:function(){if(!this.isDestroyed()&&this.ckeditor){this.ckeditor.fire("saveSnapshot");return this}return null},destroy:function(){var j=this;if(this.ckeditor!==null){setTimeout(function(){try{j.ckeditor.destroy(true)}catch(k){}j.ckeditor=null},0)}return this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/community/content/view/simple-editor-view",["UWA/Core","UWA/Utils/Client","i18n!DS/SwymUIComponents/assets/nls/feature/community/generic/view/simple-editor-view","DS/SwymUIComponents/script/feature/community/content/view/swym-editor-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/utils","DS/UIKIT/Scroller","DS/Logger/Logger","DS/SwymUIComponents/script/utils/content-process","DS/SocialUserMention/Utils/Generic","DS/UIKIT/Popover"],function(a,n,i,g,o,m,b,r,s,k,e,p){var c=null,l=null,d=null,q=200,u="<p><br></p>",j=42,h=10,f=j+h,t=g.extend({_modelClass:o,_modelEventsForAutoRefresh:[],name:"simple-editor-view",_editorIsUpdated:false,editionMode:false,_switchedToRTE:false,_placeholderEl:null,_iosTextarea:null,_observer:null,domEvents:{"keydown .editable-container":"_onKeydown","keyup .editable-container":"_onKeyup","mousedown .editable-container":"_onContentMousedown","cut .editable-container":"_onContentCutOrPaste","paste .editable-container":"_onContentCutOrPaste","focusin .editable-container":"_focusOnEditor","click .placeholder":"_focusOnEditor","focusout .editable-container":"_focusOutEditor",input:"_onInpuEditor"},defaultOptions:{overrideDefaultEnterBehaviour:false,modelAttr:"content",rtePlaceholder:i.StartWriting,useFocusStyle:false,focusOnEditorInit:true,mandatory:true,activateUserMention:true,activateInline6WTagging:false,cssPlaceholder:false,enableEmojis:false},init:function(){this._focusOnEditor=this._focusOnEditor.bind(this);this._focusOutEditor=this._focusOutEditor.bind(this);this.onResizeObserved=this.onResizeObserved.bind(this);this._parent.apply(this,arguments)},_onContentMousedown:function(){if(!this._onContentMouseupBound){this._onContentMouseupBound=this._onContentMouseup.bind(this)}document.body.addEvent("mouseup",this._onContentMouseupBound);this.hideRTEToolbar()},_focusOnEditor:function(){if(this.options.useFocusStyle){var v=this.container;if(!v.hasClassName("focused")){v.addClassName("focused")}}},_focusOutEditor:function(){if(this.options.useFocusStyle){var v=this.container;if(v.hasClassName("focused")){v.removeClassName("focused")}}},_onInpuEditor:function(v){var w=this.getTextArea();if((w&&n.Platform.ios)||!this.isEmptyRTEContent()){this.removePlaceholder()}},_onContentMouseup:function(w){document.body.removeEvent("mouseup",this._onContentMouseupBound);var v=window.getSelection(),x=v.toString();if((x.length>0&&x!=="\n")||(v.rangeCount>0&&!a.extendElement(w.target).match("img"))){setTimeout(this.displayContextualToolbarWRTTextSelection.bind(this),0)}else{this.hideRTEToolbar()}},setup:function(v){this._parent.apply(this,arguments)},generatePlaceholderText:function(){var v=this.options.rtePlaceholder;return v},displayContextualToolbarWRTTextSelection:function(){var C,G,F,v,A,E,x;var H=window.getSelection(),z=H.toString(),B=!(window.innerWidth>869),D=290;if(z.length>0||H.rangeCount>0){C=H.getRangeAt(0);if(z.length<=0&&H.rangeCount>0){var y=C.cloneContents();var w=document.createElement("div");w.appendChild(y);if(!y.firstChild||w.innerHTML.length<=0){return}}G=C.getBoundingClientRect();F=G.top;v=G.bottom;A=G.left;if(F>f){x=F-f}else{E=this._widget.getViewportDimensions().height;if(E-v>j){x=v+h}else{x=h}}if(B&&this.options.mode==="advancedRTE"){x-=30}if(window.innerWidth<A+D){A=window.innerWidth-D;if(A<0){A=0}}this.positionRTEToolbar(x,A);this.showRTEToolbar()}},positionRTEToolbar:function(x,w){var v=document.body.getElement("#cke_"+this.getTextAreaId());if(v){v.style.setProperty("top",x+"px","important");v.style.setProperty("left",w+"px","important");v.setStyle("position","absolute")}},_onKeydown:function(x){var z,w=x.ctrlKey||x.metaKey,y=86,v=88;if(x.keyCode===13&&!x.shiftKey){this.dispatchEvent("onEnterKeyPressed");if(this.getOption("overrideDefaultEnterBehaviour")===true){return false}else{return true}}switch(x.keyCode){case 27:this.dispatchEvent("onEscKeyPressed");break;case 8:this.dispatchEvent("onBackspaceKeyPressed");break;default:}if(w&&(x.keyCode===y||x.keyCode===v)){z=this.ckeditor?this.ckeditor.getData():"";this.dispatchEvent("onRTEContentChanged",[z])}},_onContentCutOrPaste:function(){var v=this.ckeditor,w=v?v.getData():"";if(w.length>0){setTimeout(this.dispatchEvent.bind(this,"onRTEContentChanged",[w]),100,this)}},_onKeyup:function(A){var y,C,z=A.ctrlKey||A.metaKey,x=16,v=17,w=this.ckeditor,B=w?w.getData():"";if(n.Engine.ie){this.updatePlaceHolderVisibility(B)}if(A.keyCode===x||A.keyCode===v||A.shiftKey||z){y=window.getSelection();C=y.toString();if(C.length>0||(y.rangeCount>0&&!A.target.match("img"))){this.displayContextualToolbarWRTTextSelection()}}else{this.hideRTEToolbar();this.dispatchEvent("onRTEContentChanged",[B])}},_onKeydownInCKEditor:function(v){var x,z,y,w;if(v&&v.data&&v.data.domEvent&&v.data.domEvent.$){z=v.data.domEvent.$;x=this._onKeydown(z);if(v.editor&&v.editor.getData()===""){y=v.data.keyCode;w=(y>47&&y<58)||(y>64&&y<91)||(y>95&&y<112)||(y>185&&y<193)||(y>218&&y<223);if(w){this.removePlaceholder()}}if(x===false){v.cancel()}}},_onInsertElementInCKEditor:b.getDelayedSyncTask(function(v){this.dispatchEvent("onInsertElementInCKEditor")},1000),_onChangeInCKEditor:function(v){var w=c.getDefaultListeners().change;if(v){if(w){w.call(this,v)}this.updatePlaceHolderVisibility(v.editor&&v.editor.getData());v.cancel()}},_onPasteInSimpleCKEditor:function(v){if(v&&v.editor&&v.editor.getData()===""){if(v.data&&v.data.dataValue&&v.data.dataValue.length>0){this.removePlaceholder()}}},_onPasteInCKEditor:function(v){this._onPasteInSimpleCKEditor();var A,w=v.editor.dataProcessor,x=new CKEDITOR.htmlParser.filter({elements:{img:function(B){B.remove()}}}),z=w.toHtml(v.data.dataValue,{filter:x,fixForBody:false});if(this.getOption("disableTableOnPaste")===true){var y=new CKEDITOR.filter();y.disallow("table;th;tr;tbody;thead;");z=w.toHtml(z,{filter:y,fixForBody:false})}if(this.getOption("enableEmojis")===true){A=this._detectAndWrapEmojis(z);v.data.dataValue=A.newText}else{v.data.dataValue=z}},onRTEContentChanged:e.throttle(function(v){s.log("onRTEContentChanged")},100),_detectAndWrapEmojis:function(A,w){var z=null,v=this.ckeditor.dataProcessor,x=new CKEDITOR.htmlParser.filter({text:function(D,C){var B=D,E=function(G){var F;if(G.length===1){F=G.charCodeAt(0)}F=((G.charCodeAt(0)-55296)*1024+(G.charCodeAt(1)-56320)+65536);if(F<0||isNaN(F)){F=G.charCodeAt(0)}return F.toString("16").toUpperCase()};if(C&&!C.parent.attributes["data-emoji-unicode"]){B=D.replace(/([\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2300-\u27BF]|\uD83E[\uDD10-\uDDFF])/g,function(F,G,I,H){z=C;return('<span contenteditable="false" data-emoji-unicode="'+E(G)+'">'+G+"</span>"+(((I===D.length)||(w&&w.addNonBreakableSpaceAtTheEnd===true))?"\u00A0":"\u200B"))})}if(z&&(B.match(/\u200B$/))){B=B.replace(/\u200B$/,"\u00A0")}return B}}),y=v.toHtml(A,{filter:x,fixForBody:false});console.log("how many time set the data","new data is ",y);return{text:A,newText:y,hasTextBeenAltered:Boolean(z)}},hideRTEToolbar:function(){var v=document.body.getElement("#cke_"+this.getTextAreaId());if(v){v.addClassName("hidden")}},showRTEToolbar:function(){var v=document.body.getElement("#cke_"+this.getTextAreaId());if(v&&v.hasClassName("hidden")){v.removeClassName("hidden");v.addClassName("shown")}},setFocus:function(v){if(!n.Platform.ios){if(this.ckeditor){this.ckeditor.focus()}else{var w=this.getTextArea();w&&w.focus()}this._focusOnEditor()}},switchedToRTE:function(){return this._switchedToRTE},switchToRTE:function(v,w,z){var y="",x=this.getTextArea();if(z){this.options.mode=z}if(!this.switchedToRTE()){this._switchedToRTE=true;if(!this.ckeditor&&!v){y=x?x.getHTML():""}else{if(v!==u){y=v}}if(!this.isEmptyRTEContent(y)){this.removePlaceholder()}if(w===true||this._editorIsUpdated===false){this.updateEditor(y)}}},_createInput:function(){if(n.Platform.ios&&(!this._parentView||(this._parentView&&this._parentView.options.mode!=="advancedRTE"))){return a.createElement("div",{id:this.getTextAreaId(),"class":"editable-container content-body",html:{tag:"textarea","class":"iosTextArea",styles:{opacity:"0",width:"100%",height:"38px",position:"absolute",top:"0",left:"0"}}})}else{return a.createElement("div",{id:this.getTextAreaId(),"class":"editable-container content-body",contenteditable:"false",html:n.Engine.firefox||n.Engine.ie?u:""})}},_listenClickOutside:function(w){var x,v=this.getControl("emojiPopover");if(v&&v.elements&&this._listenClickOutsideBound){x=v.elements.container.contains(w.target);if(!x){v.hide();window.removeEventListener("click",this._listenClickOutsideBound)}}},_createEmojiInput:function(){var v=a.createElement("span",{"class":"fonticon fonticon-1-5x fonticon-emoji-smile"});this.addControl("emojiPopover",new p({target:v,trigger:"touch",className:"emoji-popover",position:"top right",body:"Loading...",autoHide:false,offset:{x:3,y:5},events:{onInjected:function(){if(!this._emojiPopoverInitiated){var w=this.addChildView("emoji-selector",{Class:"DS/SwymUIComponents/script/feature/community/content/edit/emoji-selector-view",events:{onEmojiClick:this._onEmojiClick.bind(this)}});this.getControl("emojiPopover").setBody([w]);this._emojiPopoverInitiated=true}}.bind(this),onShow:function(){console.log("popover is shown");this._listenClickOutsideBound=this._listenClickOutside.bind(this);window.addEventListener("click",this._listenClickOutsideBound)}.bind(this),onHide:function(){if(this._listenClickOutsideBound){window.removeEventListener("click",this._listenClickOutsideBound);delete this._listenClickOutsideBound}}}}));return v},_insertEmoji:function(v){var w=this._detectAndWrapEmojis(v,{addNonBreakableSpaceAtTheEnd:true}).newText;this.ckeditor.insertHtml(w);this.saveSnapShot();this.dispatchEvent("onEmojiInsert",[this,v,w])},_onEmojiClick:function(w){console.log("an emoji has been selected");var v=w.unicode;if(v){if(this.ckeditor){this._insertEmoji(v);this.dispatchEvent("onRTEContentChanged")}else{this.addEventOnce("editorIsReady",function(){this._insertEmoji(v);this.placeCursorAt();this.dispatchEvent("onRTEContentChanged",[])}.bind(this));this.switchToRTE()}}},_createContent:function(){var v=[],w;this.elements.editableContainer=this._createInput();if(this.getOption("isSimpleRTE")||this.getOption("isInstantMessageRTE")){w=a.createElement("div",{"class":"editable-container-wrapper",styles:{position:"relative","min-height":this.getOption("isInstantMessageRTE")?"44px":"56px"},html:this.elements.editableContainer})}else{w=this.elements.editableContainer}v.push(this.getPlaceholderEl());if(this.getOption("enableEmojis")===true){w.addClassName("editor-with-emojis");v.push(this._createEmojiInput())}v.push(w);return v},onResizeObserved:function(){var x=this.getElement(".editable-container"),w=this.getElement(".editable-container-wrapper"),y=w&&parseInt(w.getStyle("height",10)),v=x&&x.getSize().height;if((v!==0)&&((y!==v)||(y>q))){if(v<q){w.setStyle("height",v+"px")}else{w.setStyle("height","200px")}}},bindEvents:function(){var v=this.getTextArea();if(v&&n.Engine.firefox){v.addEvents({focus:this._focusOnEditor,blur:this._focusOutEditor})}},getPlaceholderEl:function(){var v;if(this.options.cssPlaceholder!==true){if(!this._placeholderEl){v=this.generatePlaceholderText();this._placeholderEl=a.createElement("div",{"class":"placeholder",html:[{tag:"span","class":"placeholder-text",html:v},this.options.mandatory===true?{tag:"span","class":"invalid",html:" *"}:""]})}}else{if(this.elements.editableContainer){this.elements.editableContainer.dataset.placeholder=this.generatePlaceholderText();this.elements.editableContainer.addClassName("show-placeholder")}}return this._placeholderEl},onRender:function(){var w=this.getTextToBeDisplayed(),x=this.container.getElement(".editable-container"),v=n.Platform.ios;if(v&&(!this._parentView||(this._parentView&&this._parentView.options.mode!=="advancedRTE"))){this._iosTextarea=this.elements.editableContainer.innerHTML}if(a.is(this.model)){this.switchToRTE(w)}else{if(w.length>0){this.removePlaceholder();if(v){this.getTextArea().innerHTML+=w}else{this.getTextArea().innerHTML=w}}}if(!this._observer&&(this.getOption("isSimpleRTE")||this.getOption("isInstantMessageRTE"))&&x){this._observerTarget=x;this._observer=new MutationObserver(this.onResizeObserved);this._observer.observe(this._observerTarget,{characterData:true,childList:true,subtree:true})}},getTextToBeDisplayed:function(){var w="",v=this.model;if(v){w=v.hasVirtuallyChanged(this.options.modelAttr)?v.getChanges(this.options.modelAttr):v.get(this.options.modelAttr)}else{if(this.options.initialText){w="<p>"+this.options.initialText+"</p>"}}return w},enableMentions:function(){var B=this,y=null,w=this.getTextArea();if(w){var x,A=m.getInstance(),v=A.get("user"),z=function(){return{editableElement:w,containerElement:(B.getOption("isSimpleRTE")||B.getOption("isInstantMessageRTE"))?B.container:null,boundingElement:B.getOption("restrictUserMentionAutocompleteDisplayZoneToTextEditor")===true?w.parentElement:null,tenantId:A.get("config").tenant.online_instance_id,"3DSwymUrl":b.getBaseUrl(),"3DSwymServerToken":A.getCSRFToken(),linksExtraAttributes:{"data-type":"internal"},userLogin:v.login,userName:(v.first_name+" "+v.last_name),events:{onInsert:function(E){var C,D;if(E&&E.cursorPosition){B.placeCursorAt(E.cursorPosition.offset,{node:E.cursorPosition.node})}B.saveSnapShot();setTimeout(function(){if(B.ckeditor){B.dispatchEvent("onRTEContentChanged",[B.ckeditor.getData()]);B.dispatchEvent("onMentionInsert")}},0)}}}};if(l&&B.getOption("activateUserMention")!==false){x=z();y=x.linksExtraAttributes;x.linksExtraAttributes=function(C){if(C.memberType==="user"){y["data-content-type"]="person"}return y};l.enableFeature(x)}if(d&&B.getOption("activateInline6WTagging")===true&&b.isFeatureActivated("activateInline6WTagging")){d.enableFeature(z())}}},updateEditor:function(x){var v=this,w=false;this._editorIsUpdated=true;setTimeout(function(){if(!w){v.mask();w=true}},1000);require(["DS/SwymUIComponents/script/lib/ckeditor/ckeditor","DS/SocialUserMention/SocialUserMention","DS/SwymUIComponents/script/feature/community/content/edit/inline-6wtagging"],function(C,z,D){c=C;l=z;d=D;if(!v.isDestroyed()){var B=v.ckeditor,E,y=v.getTextArea(),A;if(y){y.setAttribute("contenteditable","true");v.enableMentions()}if(y&&y.isInjected()){E=x||v.getTextToBeDisplayed();if(!(B&&B.element.$===y)){if(v.options.mode==="advancedRTE"){A=c.getExtendedCommentEditorConfig(o)}else{A=c.getNewCommentEditorConfig(o)}B=v.ckeditor=c.CKEditor.inline(y,A);B.on("instanceReady",function(F){var H;if(v.options.mode==="advancedRTE"){H=document.body.getElement(".cke_editor_"+B.name);H.addClassName("cke_editor_advanced_editor")}v.hideRTEToolbar();if(v.ckeditor){if(v.ckeditor.container){v.ckeditor.container.$.removeAttribute("title")}v.dispatchEvent("editorIsReady");if(v.getOption("focusOnEditorInit")&&v.getOption("mode")!=="advancedRTE"){try{v.placeCursorAt()}catch(G){console.log(G)}}}});B.on("insertElement",v._onInsertElementInCKEditor,v,undefined,100);a.extend(B.config,{model:v.model,modelAttribute:v.options.modelAttr});B.extraOptions={view:v};B.customListeners={key:v._onKeydownInCKEditor.bind(v),change:v._onChangeInCKEditor.bind(v),paste:v._onPasteInCKEditor.bind(v),focus:function(F){if(v.container&&v.container.getElement(".editable-container")){if(v.container.getElement(".editable-container").innerHTML===u){s.log("setting cursor position on focus!");v.placeCursorAt()}}}};c.addListeners(B)}if(B){if(!v.isEmptyRTEContent(E)){B.setData(E,function(){v.mask();k.ckeditorContentPreProcess(this,{model:v.model});v.unmask();v.placeCursorAt()});v.removePlaceholder()}else{v.setFocus()}}}if(w){v.unmask()}else{w=true}}})},showPlaceholder:function(){var v=this.getPlaceholderEl();if(this.isEmptyRTEContent()){v&&v.show();this.elements.editableContainer.addClassName("show-placeholder")}},removePlaceholder:function(){var v=this.getPlaceholderEl();v&&v.hide();this.elements.editableContainer.removeClassName("show-placeholder")},updatePlaceHolderVisibility:function(w){if(!a.is(w,"string")){var v=this.getTextArea();if(v){w=v.getHTML()}}if(a.is(w,"string")){if(this.isEmptyRTEContent(w)){this.showPlaceholder()}else{this.removePlaceholder()}}},isEmptyRTEContent:function(v){var y=false,x,w=this.getTextArea();if(!a.is(v,"string")){if(w){v=w.getHTML()}else{v=""}}x=v.replace(/\s|&nbsp;|\u200B|&#8203;/gm,"").trim();if(x===u||x===""||v===this._iosTextarea||v.match('^<textarea class=\\"iosTextArea\\".+</textarea>$')){y=true}return y},getTextAreaId:function(){return"simple_editor_textarea_"+this.cid},getTextArea:function(){return this.elements.editableContainer||this.getElement("#"+this.getTextAreaId())},resetEditor:function(){this.hideRTEToolbar();if(this.ckeditor){try{this.ckeditor.setData((n.Engine.firefox||n.Engine.ie)?u:"")}catch(v){s.error(v)}this.showPlaceholder()}else{this.getTextArea()&&this.getTextArea().empty();this.showPlaceholder()}this.dispatchEvent("onResetEditor")},placeCursorAt:function(x,z){try{var w=(this.ckeditor||document).createRange(),A=(this.ckeditor||document).getSelection(),y=z&&z.node||this.getTextArea(),v,C;if(A&&y){this.setFocus(z);v=this.ckeditor?new CKEDITOR.dom.node(y):y;if(!a.is(x,"number")){C=(y.lastElementChild||y);x=C.childNodes.length;if(this.isEmptyRTEContent()){x=0}w.setStart(this.ckeditor?new CKEDITOR.dom.node(C):C,x)}else{w.setStart(v,x)}w.collapse(true);A.removeAllRanges();if(this.ckeditor){A.selectRanges([w])}else{A.addRange(w)}}}catch(B){console.log(B)}},onInjected:function(){var v=this.getElement(".editable-container-wrapper");if(!this.getControl("scroller-test"+this.cid)&&v){this.addControl("scroller-test"+this.cid,new r({element:v})).inject(this.container)}},destroy:function(){if(this.onDocumentBodyClickBound){document.body.removeEvent("click",this.onDocumentBodyClickBound)}var v=this.getTextArea();if(v){if(l){l.disableFeature({editableElement:v})}if(d&&b.isFeatureActivated("activateInline6WTagging")){d.disableFeature({editableElement:v})}}if(this.model){this.model.removeChanges(this.options.modelAttr)}this._observer&&this._observer.disconnect();this._parent.apply(this,arguments)}});return t});define("DS/SwymUIComponents/script/feature/community/content/view/simple-editor-with-media-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/view/simple-editor-view","DS/SwymUICore/script/utils/utils","DS/Logger/Logger"],function(e,d,c,b){var a=d.extend({name:"simple-editor-with-media-view",_onPasteInCKEditor:function(r){this._onPasteInSimpleCKEditor(r);var j=r.data&&r.data.dataTransfer&&r.data.dataTransfer._&&r.data.dataTransfer._.files,p,k=[],g=0,o=true,s=r.editor.dataProcessor,q=new CKEDITOR.htmlParser.filter({elements:{img:function(l){if(!l.attributes["data-media-type"]){var u=Math.random().toString(36).substring(7),i=l.attributes,t={src:i.src,mediaPastedId:u};i["data-media-pasted-id"]=u;k.push(t)}g++}}}),f=s.toHtml(r.data.dataValue,{filter:q,fixForBody:false});r.data.dataValue=f;if(k.length>0){this.dispatchEvent("onMediaPaste",k)}for(var n=0,h=k.length;n<h;n++){if(!k[n].src.startsWith("data:image")){o=false}}if(k.length===0&&j.length>0&&o){this.dispatchEvent("onMediaPaste",j)}if(this.getOption("disableTableOnPaste")===true){var m=new CKEDITOR.filter();m.disallow("table;th;tr;tbody;thead;");f=s.toHtml(f,{filter:m,fixForBody:false})}if(this.getOption("enableEmojis")===true){p=this._detectAndWrapEmojis(f);r.data.dataValue=p.newText}else{r.data.dataValue=f}if(k.length===0&&j.length===0&&g>0&&this.getOption("isInstantMessageRTE")===true){this.dispatchEvent("onSwymImgPaste")}},removeMediaIntoTextEditor:function(i,j){var g=this.getChildView("textEditorView"),h=(g)?g.ckeditor:this.ckeditor,f=h.editable().findOne('img[data-media-pasted-id="'+i+'"]');if(f){f.remove()}},replaceMediaIntoTextEditor:function(h,i){var f=this.getChildView("textEditorView"),g=(f)?f.ckeditor:this.ckeditor;this.getImgTagToInsertIntoEditor(i,function(m,l){var j=g.editable().findOne('img[data-media-pasted-id="'+m+'"]'),k;if(j){k=j.getParent();if(k){k.append(new CKEDITOR.dom.element(l))}else{console.log(m+"-no parent found-swym-editor")}j.remove()}else{console.log(m+"-no element found-swymeditor")}}.bind(this,h))},triggerActionOnMediaIntoTextEditor:function(f,g){require(["DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/feature/community/media/model/media-model"],function(l,h){var k=this,i,j;if(f&&f.length>0){f.forEach(function(m){if(m instanceof h){i=m.get("userFile")||m.getChanges("userFile");j=i&&i.info&&i.info.mediaPastedId;if(g==="remove"){k.removeMediaIntoTextEditor(j)}else{if(g==="replace"){l.getImageTagFromMedia(m,function(n){k.replaceMediaIntoTextEditor(this,n)}.bind(j))}}}else{k.removeMediaIntoTextEditor(m.mediaPastedId)}},this)}}.bind(this))}});return a});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-editor-view",["UWA/Core","UWA/Utils/Client","i18n!DS/SwymUIComponents/assets/nls/feature/community/comment/view/comment-editor-view","DS/SwymUIComponents/script/feature/community/content/view/swym-editor-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-edition-media-view","DS/SwymUIComponents/script/feature/community/content/utils/content-renderer","DS/SwymUIComponents/script/feature/community/content/view/simple-editor-with-media-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/community/comment/model/comment-model","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/localstorage-utils","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-generator"],function(j,k,f,a,n,c,o,h,g,q,b,i,l,p,m,e){var d=a.extend({_modelClass:q,_modelEventsForAutoRefresh:["onSync:update"],name:"editor-view",_modelInstance:null,_uploadComplete:true,_editorIsReady:false,_isFocused:false,_tenantId:null,defaultOptions:{itemModelClass:i,itemTextAttribute:"comment",itemAdditionEvent:"addComment",itemAssociationToParentModel:"commented",mediaEditionViewClass:c},domEvents:{'click .editable-container[contenteditable="false"]':"_focusOnEditor","click .trigger-library":"_onOpenMediaLibrary","mousedown .cancel-clickable":"cancelItemEditing","focusin .content.editable":"_focusOnEditor","click .placeholder":"_focusOnEditor","focusout .content.editable":"_focusOutEditor"},init:function(){this._focusOnEditor=this._focusOnEditor.bind(this);this._focusOutEditor=this._focusOutEditor.bind(this);return this._parent.apply(this,arguments)},bindEvents:function(){if(this.elements.contentEditable&&k.Engine.firefox){this.elements.contentEditable.addEvents({focus:this._focusOnEditor,blur:this._focusOutEditor})}},setup:function(){this._bootstrapModel=l.getInstance();this._tenantId=this._bootstrapModel.get("config").tenant.id;this._parent.apply(this,arguments);if(this.options&&this.options.itemModelInstance){this._modelInstance=this.options.itemModelInstance}},_onOpenMediaLibrary:function(){require(["DS/SwymUIComponents/script/feature/community/media/library/media-library-view"],function(t){var s;if(this.model.get("community")){s=this.model.get("community").mid}else{s=this.model.getAssociated("answeredFor").get("community").mid}var r=new t({communityId:s});r.injectInDom();this.listenTo(r,{newMediaAdded:function(w){var x=w.newMedia,v=w.existingMedia,u=this._getMediaEditionView();if(x&&Array.isArray(x)&&(x.length>0)){u.addNMediaModels(x)}if(v&&Array.isArray(v)&&(v.length>0)){u.addNMediaModels(v)}r.destroy();this.getRTEView().setFocus()}.bind(this)})}.bind(this))},_focusOnEditor:function(){var t=this.container.getElement(".cancel-message");if(!this._isFocused){this._isFocused=true;var s=this.getRTEView(),r=this.getCommentDraftFromLocalStorage();setTimeout(function(){if(k.Platform.ios&&this.container){this.container.scrollIntoView()}},100);s.switchToRTE(r);if(t){t.getElement(".cancel-on-focus").removeClassName("hidden")}}},_focusOutEditor:function(){this._isFocused=false;var r=this.container.getElement(".cancel-message");if(r){r.getElement(".cancel-on-focus").addClassName("hidden")}},getCommentDraftFromLocalStorage:function(){var s=this.model.get("id"),t=this._tenantId+"-"+s+"-comment",r=p.getItem(t);if(r&&(r.length>0)){r=r.replace(/<&nbsp;/gm,"").trim();r=r.replace(/\n/gm,"<br />")}return r},clearCommentDraftFromLocalStorage:function(){var r=this.model.get("id"),s=this._tenantId+"-"+r+"-comment";p.removeItem(s)},addCommentDraftToLocalStorage:function(t){var s,r,u;s=this.model?this.model.get("id"):null;r=this._modelInstance?this._modelInstance.get("mid"):"";if(this._tenantId&&s&&(typeof t==="string")){u=this._tenantId+"-"+s+"-comment"+r;p.setItem(u,t)}},_createMediaEditionView:function(v){var r,u,s,t=this;if(v instanceof this.getOption("itemModelClass")){r=v;s={contentModel:r,Class:this.getOption("mediaEditionViewClass"),contentAttributeInModel:this.getOption("itemTextAttribute"),parentModelAssociation:this.getOption("itemAssociationToParentModel"),dragZoneSelector:".editor-view-container",modelName:r.getModelName()}}else{if(typeof v==="string"){u=v;s={communityId:u,Class:this.getOption("mediaEditionViewClass"),contentAttributeInModel:this.getOption("itemTextAttribute"),dragZoneSelector:".editor-view-container"}}else{throw new Error("Unknown parameter provided")}}s.events={onInit:function(){t.listenTo(this,{onMediaUploadsStart:t.onMediaUploadsStart,onMediaUploadsComplete:t.onMediaUploadsComplete,onCopyPaste:t._onCopyPaste})}};return this.addChildView("mediaEdition",s)},_onCopyPaste:function(r){var s=this.getRTEView();if(s){s.triggerActionOnMediaIntoTextEditor(r,"remove")}},_getMediaEditionView:function(){var r=this.getChildView("mediaEdition");if(!r||!(r instanceof c)){var s=this.getOption("communityId")||this.model.getCommunity().get("mid");if((this.getOption("mediaEditionViewInstantiated")===true)&&s){r=this._createMediaEditionView(s)}else{r=this.addChildView("mediaEdition",new g())}}return r},onMediaUploadsComplete:function(){this._uploadComplete=true;this.deleteWaitMessage()},onMediaUploadsStart:function(){this._uploadComplete=false},onEnterKeyPressed:function(){if(this._uploadComplete){this.createItem()}else{this.addWaitMessage()}},addWaitMessage:function(){if(!this.container.getElement(".wait-upload-message")){var r=this.container;var s=j.createElement("div",{"class":"wait-upload-message",html:f.PleaseWaitToComment});r.addContent(s)}},deleteWaitMessage:function(){var r=this.container.getElement(".wait-upload-message");if(r){r.destroy()}},getRTEView:function(){var t=this.getChildView("rte"),r=this.getCommentDraftFromLocalStorage(),s=this.getOption("itemTextAttribute")==="comment"?f.WriteAComment:f.WriteAnAnswer;if(!t){t=this.addChildView("rte",{Class:h,className:"form-control",rtePlaceholder:s,modelAttr:"content",initialText:r?r:undefined,overrideDefaultEnterBehaviour:true,useFocusStyle:true,focusOnEditorInit:!r,cssPlaceholder:true});this.reactTo(t,"onEnterKeyPressed",this.onEnterKeyPressed);this.reactTo(t,"onRTEContentChanged",this.addCommentDraftToLocalStorage,this);this.reactTo(t,"onEscKeyPressed",t.resetEditor.bind(t));this.reactTo(t,"onMediaPaste",function(){var v=this._getMediaEditionView().getUploader("copyPaste"),u=arguments;if(v){v.getAndTransformMediaPasted(arguments)}}.bind(this))}return t},_createContent:function(){var t,r=this._modelInstance?this._modelInstance.getAuthor():new b(l.getInstance().get("user")),s=this.model;if(s){t=this.addChildView("userPicture",{Class:n,model:r,imageRenderingOptions:{format:"normal"}});this.elements.contentEditable=j.createElement("div",{"class":"content editable",html:[this.getRTEView(),{tag:"span","class":"trigger-library fonticon fonticon-attach"},this._getMediaEditionView()]});return j.createElement("div",{"class":"comment-editor",html:[{"class":"infos",html:t},this.elements.contentEditable]})}},getTextAreaId:function(){return"comment_editor_textarea_"+this.cid},editItem:function(s){var t=this.getRTEView();t.editionMode=true;this._modelInstance=s;var r=this.getCommentDraftFromLocalStorage();if(!t.switchedToRTE()||!t.ckeditor){this.reactTo(t,"editorIsReady",this.launchEdition);t.switchToRTE(r)}else{this.launchEdition()}this.addCancelMessage()},launchEdition:function(){var s=this.getRTEView(),r;s.removePlaceholder();if(!this._contentRenderer){this._contentRenderer=o.getInstance()}r=this._contentRenderer.render(this._modelInstance.getChanges(this.getOption("itemTextAttribute"))||this._modelInstance.get(this.getOption("itemTextAttribute")),{createMediaView:false});r=e.createPreviewFromLink(r,false,true);if(j.is(r,"string")){s.ckeditor.setData(r,function(){s.placeCursorAt()})}else{s.getTextArea().setHTML(r);s.ckeditor.updateElement();s.placeCursorAt()}s.ckeditor.setReadOnly(false);this._createMediaEditionView(this._modelInstance)},addCancelMessage:function(){if(!this.container.getElement(".cancel-message")&&!k.Features.touchEvents){var r=this.container;var s=j.createElement("div",{"class":"cancel-message",html:f.PleaseClickOnEscapeToCancel.format('<span class="cancel-on-focus">','</span><span class="cancel-clickable">',"</span>")});r.addContent(s)}},createItem:function(){var D,w,A={},y="",u=this.getOption("itemModelClass"),v=this._getMediaEditionView(),C=this,B=this.getRTEView(),H=B.getTextArea();D=H.getHTML();D=m.convertURLPreviewToLink(D,false);if(v){y=v.getHTMLToBeSaved()}if((D.replace(/<(?:.|\n)*?>|&nbsp;/gm,"").trim()!=="")||(y.length>0)){if(this._modelInstance===null){A[this.getOption("itemTextAttribute")]=D+y;A.parentId=this.model.get("mid");w=new u(A,{commentType:this.model.getModelName()});var s=function(){this.removeEvent("onError:create",x)},x=function(){var J;if(w.getModelName()==="iq-answer"){J=f.TheanswercouldnotbesavedPleasetryagain}else{J=f.ThecommentcouldnotbesavedPleasetryagain}C.alert("error",J);this.removeEvent("onSync:create",s)};w.addEventOnce("onSync:create",s);w.addEventOnce("onError:create",x);if(k.Platform.ios&&k.Engine.safari&&H){H.blur();this._focusOutEditor()}this.dispatchEvent("hideAddMediaView");this.dispatchEvent("newItemCreated",[w]);this.model.dispatchEvent(this.getOption("itemAdditionEvent"),[w]);if(v){v.reset()}this.clearCommentDraftFromLocalStorage()}else{if(this._modelInstance instanceof this.getOption("itemModelClass")){this._modelInstance.addChanges(this.getOption("itemTextAttribute"),D+y);if(this._modelInstance.getChanges()[this.getOption("itemTextAttribute")]){this._modelInstance.save({},{onComplete:function(){C.alert("success",f.Yourmodificationshavebeensuccessfullysaved);C._modelInstance=null},onFailure:function(){C.alert("error",f.Errorsavingmodifications);C.dispatchEvent("switchToEditModeRequest")}})}var r=this._parentView.container.getElement(".menu-button"),t=this._parentView.container.getElement(".infos"),G=this._parentView.container.getElement(".content"),F=this._parentView.container.getElement(".user-picture-view-container.hidden"),z=this._parentView.getElement(".content-media-display-manager-container"),I=this.container.parentElement,E=this.container.getParent(".comment-wrapper").getChildren(".editor-view-container").pop();if(F){F.removeClassName("hidden")}if(z){z.show()}r.show();t.show();G.show();E.show();I.hide()}}B.resetEditor();setTimeout(B.placeCursorAt.bind(B,null,{programmaticFocus:true}),100)}},cancelItemEditing:function(){var s;if(this._modelInstance instanceof this.getOption("itemModelClass")&&this._parentView&&this._parentView.container){var y=this._parentView.container.getElement(".menu-button"),u=this._parentView.container.getElement(".infos"),x=this._parentView.container.getElement(".content"),v=this._parentView.container.getElement(".user-picture-view-container.hidden"),z=this._parentView.getElement(".content-media-display-manager-container"),w=this.container.parentElement,t=this.container.getParent(".comment-wrapper").getChildren(".editor-view-container").pop();if(v){v.removeClassName("hidden")}if(z){z.show()}y.show();u.show();x.show();t.show();w.hide()}else{if(s=this.getChildView("mediaEdition")){s.reset()}this.clearCommentDraftFromLocalStorage()}this._modelInstance=null;var r=this.getRTEView();r.ckeditor.setData("");r.resetEditor},destroy:function(){this._parent.apply(this,arguments)}});return d});define("DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-view-with-rte",["UWA/Core","UWA/Event","UWA/String","DS/SwymUIComponents/script/feature/community/content/edit/abstract-content-editor-body-view","DS/SwymUIComponents/script/feature/community/content/view/simple-editor-with-media-view","DS/SwymUIComponents/script/feature/community/content/edit/content-edition-media-view","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils","DS/SwymUIComponents/script/utils/content-creation-types-manager","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/content-creation-view"],function(g,j,b,h,f,a,i,k,d){var e=function(l){return l.replace(/\u200B/g,"").replace(/(\u00A0|&nbsp;)(?!$)(?!<br>)(?!<\/)/g," ")},c=h.extend({_rteContent:null,_context:null,_editorIsReady:false,_modelEvents:{"onChange:content":"_setEditorContent"},name:"content-editor-body-view-with-rte",domEvents:{"click .rte-wrapper .editable-container":"onRTEFocus","focusin .rte-wrapper .editable-container":"onRTEFocus","click .rte-wrapper .placeholder":"onRTEFocus","focusin .rte-wrapper .placeholder":"onRTEFocus","blur .rte-wrapper .editable-container":"onRTEInput","keyup .rte-wrapper .editable-container":"onRTEInput","paste .rte-wrapper .editable-container":"onRTEInput","drop .rte-wrapper .editable-container":"onRTEInput","input .rte-wrapper .editable-container":"onRTEInput"},defaultOptions:{modelAttr:"content",contentEditorView:null,mediaInsertion:true},_setEditorContent:function(l){var m=this.getChildView("rte");if(m){m.switchToRTE(l||this.model.get("content"))}},_toggleMediaInsertion:function(){var l=k.getInstance(),n=l.getContentTypes().indexOf(k.MEDIA)>-1,m=this.getOption("mediaInsertion");if(m!==n){this.setOption("mediaInsertion",n);this.refresh()}},init:function(){var l=this._parent.apply(this,arguments),m=k.getInstance();if(this.getOption("rteViewOptions")&&this.getOption("rteViewOptions").isInstantMessageRTE===true){this._toggleMediaInsertion();this._toggleMediaInsertionBound=this._toggleMediaInsertion.bind(this);m.addEvent("onContentTypesChange",this._toggleMediaInsertionBound)}return l},_getMediaEditionView:function(){var m,l=this.getChildView("mediaEdition");if(!l){m={communityId:this.getCommunityId()||undefined,Class:a,contentAttributeInModel:"content",isMediaForSimpleContent:(this.name==="content-editor-body-view-with-rte"),dragZoneSelector:this.getOption("dragZoneSelector")};l=this.addChildView("mediaEdition",m);this.listenTo(l,{onMediaCollectionChange:this.onMediaCollectionChange,onMediaUploadsStart:function(){this.dispatchEvent("onMediaUploadsStart",arguments)},onMediaUploadsComplete:function(){this.dispatchEvent("onMediaUploadsComplete")},onMediaUploadsFailure:function(n){this.dispatchEvent("onMediaUploadsFailure",[n])},onDragAndDrop:function(){this.dispatchEvent("onDragAndDrop",arguments)},onCopyPaste:this._onCopyPaste})}return l},_getRTEElt:function(){return this.getElement(".rte-wrapper .editable-container")},_isRTEContentEmpty:function(){var m=true,l=b.unescapeHTML(this.getRTEContent()).trim();if(l.length>0||this.getElement(".rte-wrapper .editable-container img")){m=false}return m},isContentEmpty:function(){var l=true,m=this.getMediaCollectionLength();if(!this._isRTEContentEmpty()||(m>0)){l=false}return l},getContentAttributes:function(){var m=this.getRTEContent(),l=this._getMediaEditionView().getHTMLToBeSaved();return{content:m+l}},treatHTML:e,getRTEContent:function(){var m,l="";if(m=this._getRTEElt()){l=this.treatHTML(m.getHTML())}return l},resetContent:function(){if(this.model&&!this.model.get("mid")){this.stopReactingTo(this.model);this.model=null}this.getRTEView().resetEditor();this._getMediaEditionView().reset()},cleanDndViewEvents:function(){this._getMediaEditionView()._getDndView().destroy()},refreshContent:function(m,l){var n=this.getRTEView();if(!n.switchedToRTE()){n.switchToRTE(m.content,true,"simpleRTE")}else{n.updateEditor(m.content)}if(l){this._getMediaEditionView().setCollection(l);this._getMediaEditionView().refresh()}},getMediaCollection:function(){return this._getMediaEditionView().collection},getMediaCollectionLength:function(){return this._getMediaEditionView().getCollectionLength()},uploadMedia:function(n){var l=this._getMediaEditionView(),m=this.getMediaCollectionLength();n=n||{};if(m>0){l.uploadAllMediaInCommunity({communityId:n.communityId||this.getCommunityId(),onUploadsComplete:n.onUploadsComplete,onUploadsFailure:n.onUploadsFailure})}},addMedia:function(p){var n,l,o,m=this._getMediaEditionView();if(this.getCommunityId()){for(n=0,l=p.length;n<l;n++){o=p[n];o.set("community_id",this.getCommunityId())}}m.addNMediaModels(p)},onMediaCollectionChange:function(){this.contentChanged()},_onCopyPaste:function(l){var m=this.getRTEView();if(m){m.triggerActionOnMediaIntoTextEditor(l,"remove")}this.dispatchEvent("onCopyPaste",arguments)},_createRTESection:function(){return{"class":"rte-wrapper","data-height":"20px",html:this.getRTEView()}},_createContent:function(){return[this._createRTESection(),(this.getOption("mediaInsertion")?this._getMediaEditionView():"")]},onRTEFocus:function(l){var n=j.getElement(l),m=n.getHTML(),o=this.getRTEView();o.switchToRTE();this._rteContent=m},onRTEInput:function(l){var n=j.getElement(l),m=n.getHTML(),o=false;if(m!==this._rteContent){o=true}this._rteContent=m;o&&this.contentChanged()},getRTEView:function(){var l=this,m=this.getChildView("rte");if(!m){m=this.addChildView("rte",g.merge({Class:f,model:this.model,modelAttr:this.options.modelAttr,activateInline6WTagging:true},this.getOption("rteViewOptions")));if(m){m.addEventOnce("editorIsReady",function(){l._editorIsReady=true;l.dispatchEvent("editorIsReady")});l.listenTo(m,{onMediaPaste:function(){if(this.getOption("mediaInsertion")===true){var n=this._getMediaEditionView().getUploader("copyPaste");if(n){n.getAndTransformMediaPasted(arguments)}}else{this.alert("warn",d.MediaPasteNoRights)}}.bind(this),onEnterKeyPressed:function(){l.dispatchEvent("onEnterKeyPressed")},onSwymImgPaste:function(){l.dispatchEvent("onSwymImgPaste")},onBackspaceKeyPressed:function(){l.dispatchEvent("onBackspaceKeyPressed")},onInsertElementInCKEditor:function(){l.contentChanged()},onEmojiInsert:function(){l.contentChanged()},onMentionInsert:function(){l.contentChanged()}});m.render()}}return m},executeWhenRTEIsReady:function(l){if(this._editorIsReady===true){l.call(this)}else{this.addEventOnce("editorIsReady",l)}},validateContent:function(){var l=this._parent();if(l===false){this.container.addClassName("invalid")}else{this.container.removeClassName("invalid")}return l},destroy:function(){var l=k.getInstance();this._toggleMediaInsertionBound&&l.removeEvent("onContentTypesChange",this._toggleMediaInsertionBound);this._parent.apply(this,arguments)}});return c});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-view",["UWA/Core","UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/community/comment/view/comment-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/question/view/iq-answer-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/abstract-content-view","DS/SwymUICore/script/utils/i18n","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/core/user/view/user-picture-view","DS/SwymUIComponents/script/feature/community/report-abuse/view/report-new-abuse-view","DS/SwymUIComponents/script/feature/community/media/view/simple-content-media-view","DS/SwymUIComponents/script/feature/community/content/utils/content-renderer","DS/SwymUICore/script/feature/community/comment/model/comment-model","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUICore/script/utils/date","DS/SwymUICore/script/feature/community/report-abuse/model/report-abuse-model-v2","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/utils/content-process","DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-editor-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip"],function(a,r,g,c,v,f,b,d,m,n,t,h,q,e,w,p,l,s,j,k,i,o){var u=b.extend({_modelClass:h,_modelEventsForAutoRefresh:["onSync"],_modelEvents:{"onChange:mid":"_updateActionDropdownMenu","onChange:update":"_updateModerationDate"},_contentModelAssociation:"commented",_contentAttributeInModel:"comment",_contentCounter:"nb_comments",_showSummary:false,_contentRenderer:null,name:"comment-view",attributes:{tag:"li"},domEvents:{"keydown .edit":"_onKeydown","click .comment > .content > .content-message":"_exitSummaryMode",resize:"_checkMessageHeight"},defaultOptions:{editorViewClass:s},commentExpanded:false,_updateShowSummaryProperty:function(x){this._showSummary=(x===true);this._handleSummaryMode()},_handleSummaryMode:function(){if(this.container){if(this._showSummary===true){this.container.addClassName("summary-mode")}else{this.container.removeClassName("summary-mode")}}},_exitSummaryMode:function(){if(this._showSummary){this.commentExpanded=true;this._updateShowSummaryProperty(false)}},_checkMessageHeight:function(){if(this.container){if(this._showSummary&&this.elements&&this.elements.contentMessage&&(this.elements.contentMessage.scrollHeight>Math.ceil(parseFloat(this.elements.contentMessage.clientHeight)))){this.container.addClassName("overflowing-content")}else{this.container.removeClassName("overflowing-content")}}},setup:function(){this._parent.apply(this,arguments);this._handleSummaryMode();this._contentRenderer=t.getInstance()},_updateModerationDate:function(){var y=this.getControl("moderation-status-tooltip"),x=this.model;if(y){y.setBody(f.replace(this._getModerationTextTooltip(),{prettyDate:e.prettyDate(x.get("moderation_date"))}))}},renderContentSummary:function(C){var A,x=this.model,z=C||x.get(this._contentAttributeInModel),y=j.getInstance(),B=this._contentRenderer.render(z,{createMediaView:false});if((y.isHomePageContext()||y.isCommunityHomePageContext())&&!this._parentView._showPreviousComments&&!this.commentExpanded&&z){A=true}else{A=false;this.commentExpanded=true}this._updateShowSummaryProperty(A);if(B&&typeof(B.getHTML)==="function"){return B.getHTML()}else{return B}},renderContent:function(z){var x=this.model,y=z||x.get(this._contentAttributeInModel);y=this._contentRenderer.render(y,{createMediaView:false});return y},getContentMediaView:function(){var x=this.getChildView("content-media-display-manager");if(!x){x=this.addChildView("content-media-display-manager",new n({model:this.model,contentAttributeInModel:this._contentAttributeInModel}))}return x},_getModerationText:function(){var z=this.model,x=z.get("moderation_status"),y="",A=" - ";switch(x){case"no_moderation":break;case"updated":y=e.prettyDate(z.get("crdate"))+A+'<span class="moderation-status">'+g.Moderatedbytheadministrator+"</span>";break;case"deleted":commentHtml=commentSummary="";if(z.getModelName()==="iq-answer"){y=c.Thisanswerwasdeletedbythadministratore+A+e.prettyDate(z.get("update"))}else{y=g.Thiscommentwasdeletedbytheadministrator+A+e.prettyDate(z.get("update"))}break;case"updated_by_author":y=e.prettyDate(z.get("crdate"))+A+'<span class="moderation-status">'+g.Edited+"</span>";break;case"deleted_by_author":commentHtml=commentSummary="";if(z.getModelName()==="iq-answer"){y=c.Thisanswerwasdeletedby+A+z.getAssociated("author").getNickname()+A+e.prettyDate(z.get("update"))}else{y=g.Thiscommentwasdeletedby+A+z.getAssociated("author").getNickname()+A+e.prettyDate(z.get("update"))}break;default:break}return y},_getModerationTextTooltip:function(){var y=this.model,x=y.get("moderation_status"),z="";switch(x){case"updated":z=v.ModeratedTooltip;break;case"updated_by_author":z=v.EditedTooltip;break;default:break}return z},_createContent:function(){var A,E=this._getModerationText(),I,J,L,F,P=this._getModerationTextTooltip(),M=null,Q=null,B=this.model,C=B.getAuthor(),N=this.renderContent(),K=this.renderContentSummary(),H=this.getContentMediaView(),D,x,G=[];if(B){A=B.get("status_id");if(a.is(A)&&B.hasAssociation("commented")){var z=new q({mid:B.get("ideation_id")}).getStatus();if(A===z.get("mid")&&z.get("title")&&z.get("color")){M=z.get("color");Q=z.get("title")}else{if(!this._statusCollection){var y=B.getAssociated("commented").getCommunity();this._statusCollection=y.getStatus()}D=this._statusCollection.length;this.reactTo(this._statusCollection,"onSync","refresh");if(this._statusCollection&&D>0){for(var O=0;O<D;O++){if(this._statusCollection.at(O).get("mid")===A){M=this._statusCollection.at(O).get("color");Q=this._statusCollection.at(O).get("title")}}}else{return}}}L=B.get("moderation_status");F=a.createElement("span",{html:" - "+E});if(F.getElement(".moderation-status")){this.addControl("moderation-status-tooltip",new o({target:F.getElement(".moderation-status"),body:f.replace(P,{prettyDate:e.prettyDate(B.get("moderation_date"))}),position:"bottom"}))}I=("deleted"!==L&&"deleted_by_author"!==L&&!A&&B.get("_acl").update.access);J=("deleted"!==L&&"deleted_by_author"!==L&&!A&&B.get("_acl")["delete"].access);if(I){G.push({text:g.Edit,fonticon:"pencil",name:"edit"})}if(J){G.push({text:g.Delete,fonticon:"trash",name:"delete"})}if(L!=="deleted_by_author"&&!C.isCurrentUser()&&p.getInstance().isFeatureActivated("activate_report_abuse_request")){G.push({text:g.ReportAbuse,fonticon:"flag",name:"reportabuse"})}x=a.createElement("div",{"class":"menu-button",html:G.length>0?{tag:"span","class":"fonticon fonticon-down-open"}:""});this.addControl("actionDropdownMenu",new i({target:x,items:G,events:{onClick:function(S,R){if(R.name==="edit"){this._edit()}else{if(R.name==="delete"){this._askDeleteConfirmation()}else{if(R.name==="reportabuse"){this._reportAbuse()}}}}.bind(this)}}));this.elements.contentMessage=a.createElement("div",{"class":"content-message",html:this._showSummary?K:N});return a.createElement("div",{"class":"comment"+(A?" comment-idea-status":""),html:[this.addChildView("userPicture",{model:C,Class:d,imageRenderingOptions:{format:"normal"}}),{"class":"comment-main-body",html:[{"class":"infos",html:[{tag:"a","data-content-type":"person","data-hash-key":C.get("hash_key")||"","data-login":C.get("login")||"",html:C.getNickname()},(E?F:""),(E?"":{tag:"span",html:" - "+e.prettyDate(B.get("crdate"))})]},{"class":"content",html:[(A&&Q?{tag:"p","class":"status",html:[{tag:"span",html:g.StatusChangeTo+" "},{tag:"strong","class":"idea-status-comment",styles:{"background-color":M},html:Q}]}:(A==="-1"?{tag:"p","class":"status",html:[{tag:"span",html:g.StatusOut}]}:"")),this.elements.contentMessage,H]},(C.isCurrentUser()||I)?{"class":"edit",html:this.getChildView("commentsEditorView")||this.addChildView("commentsEditorView",{Class:"DS/SwymUICore/script/lib/view/generic/swym-view"})}:""]},x]})}},getCommentsEditorView:function(){var y=this,x=this.getChildView("commentsEditorView");if(!(x instanceof s)){x=this.addChildView("commentsEditorView",a.extend({itemModelInstance:this.model,model:this.model.getAssociated(this._contentModelAssociation),Class:this.getOption("editorViewClass"),events:{switchToEditModeRequest:function(){y._edit()}}},(this.editorOptions||{})))}return x},init:function(){return this._parent.apply(this,arguments)},_askDeleteConfirmation:function(){var y,x=new k({closable:true,renderTo:this._widget?this._widget.body:document.body});if(this.model.getModelName()==="iq-answer"){y=c.Areyousureyouwanttodeletethisanswer}else{y=g.Areyousureyouwanttodeletethiscomment}x.confirm({title:g.Confirm,message:y,callback:function(z){if(z===true){this._remove()}}.bind(this)})},_edit:function(){var H=this.getElement(".menu-button"),z=this.getElement(".infos"),F=this.getElement(".content"),D=this.getElement(".edit"),B=this.getChildView("userPicture"),I=this.getElement(".content-media-display-manager-container"),y=this.container.getParent(".comment-wrapper").getChildren(".editor-view-container").pop();var x=this._parentView.getElements(".edit"),A=this._parentView.getElements(".infos"),G=this._parentView.getElements(".content"),E=this._parentView.getElements(".menu-button");for(var C=0;C<x.length;C++){x[C].hide()}for(C=0;C<G.length;C++){G[C].show()}for(C=0;C<E.length;C++){E[C].show()}for(C=0;C<A.length;C++){A[C].show()}if(B){B.container.addClassName("hidden")}if(I){I.hide()}H.hide();z.hide();F.hide();y.hide();D.show();this.getCommentsEditorView().editItem(this.model)},_onKeydown:function(C){if(C.keyCode===27){var y=this.getElement(".menu-button"),z=this.getElement(".infos"),D=this.getElement(".content"),E=this.getElement(".edit"),x=this.getChildView("userPicture"),B=this.getElement(".content-media-display-manager-container"),A=this.container.getParent(".comment-wrapper").getChildren(".editor-view-container").pop();this.getCommentsEditorView().cancelItemEditing();if(x){x.container.removeClassName("hidden")}if(B){B.hide()}y.show();z.show();D.show();A.show();E.hide()}},_remove:function(){var x=this.model.getAssociated(this._contentModelAssociation).get(this._contentCounter);this.model.destroy({onComplete:function(){this.model.getAssociated(this._contentModelAssociation).set(this._contentCounter,x-1)}.bind(this),onFailure:function(){}.bind(this)})},_reportAbuse:function(){var y=this.model;var z=new w();var A=new m({model:z,reportedModel:y}),x=(window.document||this._widget);A.render(x.body).show()},_updateActionDropdownMenu:function(){var y=this.getControl("actionDropdownMenu"),x=null;if(a.is(y)&&a.is(y.items)){for(x in y.items){if(y.items.hasOwnProperty(x)&&y.items[x].hasOwnProperty("id")){y.enableItem(y.items[x].id)}}}},onRedraw:function(){if(this.getElement(".content")){l.contentPostProcess(this.getElement(".content"),{imageProcessing:false})}},destroy:function(){if(this._contentRenderers&&(this._contentRenderers.length>0)){this._contentRenderers.forEach(function(x){x.destroy()})}this._parent.apply(this,arguments)}});return u});define("DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-collection-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/comment/view/comment-view","DS/SwymUICore/script/utils/i18n","DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/community/comment/collection/comment-collection","DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-editor-view"],function(h,g,e,f,d,b,c){var a=f.extend({_collectionClass:d,_editorViewClass:c,_showSubsetOfModelViews:true,_modelViewsToDisplay:2,_modelViewsByPage:5,_delegateSpriteReloadToParentView:false,imageReloadOptions:{nonReloadedImagesOnly:true,optimiseUserPictures:true},_contentModelAssociation:"commented",_contentCounter:"nb_comments",_showPreviousComments:false,_collectionEventsForAutoRefresh:["onCollectionChange"],modelName:null,modelViewClass:b,bodyAttributes:{tag:"ol","class":"comments"},modelViewsCfg:function(){return{editorViewClass:this._editorViewClass}},name:"comment-collection-view",hideOnRefresh:false,domEvents:{"click .show-prev-comments > span":"showPreviousComments"},setup:function(l){var p,k,j,m=this,o=l.collection||this.collection;if(h.is(l.modelViewsToDisplay,"number")){this._modelViewsToDisplay=l.modelViewsToDisplay}if(o){var i=this._parent.apply(m,arguments);if(p=o.getAssociated(this._contentModelAssociation)){if(p.getModelName()==="iq-answer"){var n=p.getAssociated("answeredFor");j=n.getCommunity()}else{j=p.getCommunity()}k=this.addChildView("commentsEditorView",{model:p,Class:this._editorViewClass,mediaEditionViewInstantiated:true,communityId:j.get("mid")||j.id});this.listenTo(k,"newItemCreated",this.onNewItemCreated)}return i}},_beforeRefresh:function(){if(this.hideOnRefresh===true){this.hide()}},_afterRefresh:function(){this.show()},_getNlsKeyForPrevComments:function(i){var j="";if(this.collection instanceof d){j=e.replace(g.ViewPrevComments,{number:i})}else{j=e.replace(g.ViewPrevAnswers,{number:i})}return j},_createContent:function(k){var l=k?h.clone(k,false):{},n=this.collection;var j=parseInt(this._modelViewsToDisplay,10),i=this.model&&(this.model.getModelName()!=="idea")?this.model.getNbComments():n.length,m=i-j;if(i===3){this._modelViewsToDisplay=3;this._showSubsetOfModelViews=false}h.extend(l,{modelViewsToDisplay:this._modelViewsToDisplay,showSubsetOfModelViews:this._showSubsetOfModelViews,showPreviousComments:this._showPreviousComments});return{"class":"comment-wrapper",html:[((this._showSubsetOfModelViews===true)&&(m>0))?{tag:"div","class":"show-prev-comments",html:[{tag:"span","class":"blue",html:this._getNlsKeyForPrevComments((m>=this._modelViewsByPage)?((m===(this._modelViewsByPage+1))?(this._modelViewsByPage+1):this._modelViewsByPage):m)}]}:"",this._parent(l),this.getChildView("commentsEditorView")]}},_createModelView:function(){var i=this._parent.apply(this,arguments);i.addEvent("onAnyEvent",this._onCommentViewEvent,this);return i},_onCommentViewEvent:function(k,j,i){if(i&&i instanceof this.modelViewClass){switch(k){case"editCommentButtonClicked":return this.dispatchEvent(k,[j,i]);default:break}}},showPreviousComments:function(){var l=this.collection,j=parseInt(this._modelViewsToDisplay,10),i=l.length,k=i-j;this._showPreviousComments=true;if(k===(this._modelViewsByPage+1)){this._modelViewsToDisplay=this._modelViewsToDisplay+(this._modelViewsByPage+1)}else{this._modelViewsToDisplay=this._modelViewsToDisplay+this._modelViewsByPage}j=parseInt(this._modelViewsToDisplay,10);k=i-j;if(k<=0){this._showSubsetOfModelViews=false}l.getAssociated(this._contentModelAssociation).set("_modelViewsToDisplay",j);this.refresh()},onNewItemCreated:function(j){this._showPreviousComments=true;var i=parseInt(this.collection.getAssociated(this._contentModelAssociation).get(this._contentCounter),10);this.collection.getAssociated(this._contentModelAssociation).set(this._contentCounter,i+1);this._modelViewsToDisplay=parseInt(this._modelViewsToDisplay,10)+1;this.collection.add(j)},focusOnCommentCreator:function(){var i=this.getChildView("commentsEditorView");if(i){var j=i.getRTEView();if(j.switchedToRTE()){j.placeCursorAt()}else{if(h.Utils.Client.Platform.ios){j.setFocus()}else{j.switchToRTE()}}}}});return a});define("DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-view-with-advanced-rte",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-view-with-rte","DS/SwymUIComponents/script/utils/content-process","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils","UWA/Utils/Client"],function(h,b,f,g,i,c){function a(j,l){var m,k;if(h.Utils.Client.Engine.ie&&j&&j.dataset.containerWidth){m=parseInt(j.dataset.containerWidth,10);if(l&&l.getStyle("width")){k=parseInt(l.getStyle("width"),10);if(k>m){l.dataset.originalWidth=l.getStyle("width");l.setStyle("width",j.dataset.containerWidth+"px")}}}}var e="extra_text_editor",d=b.extend({name:"content-editor-body-view-with-advanced-rte",_injected:false,defaultOptions:{allowDragNDrop:true,dragZoneSelector:"",mode:"advancedRTE",rteViewOptions:{restrictUserMentionAutocompleteDisplayZoneToTextEditor:true,events:{onResetEditor:function(){var j=this.elements;if(j){for(var k in j){if(j.hasOwnProperty(k)&&(k.indexOf("swym-b64-img-style-")>=0)){j[k].destroy()}}}}}}},domEvents:{resize:"updateContainerSize"},updateContainerSize:function(){var k=this,j=this.container&&this.container.getSize();if(j&&j.width){this.container.dataset.containerWidth=j.width;this.container.getElements("img").forEach(function(l){a(k.container,l)})}},init:function(){var j=this;this._parent.apply(this,arguments);this.addEventOnce("editorIsReady",function(){if(this.getRTEView()){!c.Features.touchEvents&&this.getRTEView().placeCursorAt();require(["DS/SwymUIComponents/script/feature/community/content/edit/extra-text-editor-factory","DS/SwymUIComponents/script/feature/community/content/edit/media-layout-editor-factory"],function(l,m,k){m.activateEditorDisplay({domElt:j.getRTEView().container,editorView:j,getContent:function(){return j.model}});l.activateEditorDisplay({domElt:j.getRTEView().container,extraTextEditorId:e,editorView:j})})}});this.addEvent("mediaEdited",this._saveImageChanges.bind(this))},_saveImageChanges:function(k){var j=k.model,l=function(){this.alert("error","an error has occured");this.unmask()};if(!k.isNewMedia){j.save({published:1,notify:"publish"},{onComplete:this._updateImageTagAfterEdition.bind(this,k),onFailure:l.bind(this)})}else{this._updateImageTagAfterEdition(k)}},_updateImageTagAfterEdition:function(m){var l,r=h.createElement("div",{html:this.getRTEContent()}),n=m.model,p=n.get("mid"),o=n.cid,q=n.getChanges("userFile")||n.get("userFile"),k=n.getChanges("width")||n.get("width");l=r.getElement('img[data-media-id="'+p+'"]')||r.getElement('img[data-media_cid="'+o+'"]');l.src=q;l.setStyle("width",k);if(m.isNewMedia){var j=r.getElements("img");j.forEach(function(s){if(!s.getAttribute("data-new_media")){s.setAttribute("data-image-timestamp",new Date().getTime())}})}else{l.setAttribute("data-image-timestamp",new Date().getTime())}this.getRTEView().updateEditor(r.innerHTML);this.unmask()},_getDndView:function(){return this._getMediaEditionView().getDndView()},_createContent:function(){return[(this.getOption("allowDragNDrop")===true)?this._getDndView():null,this._createRTESection(),this.getControl(e)]},onInjected:function(){if(!this._injected&&this.getOption("allowDragNDrop")===true){this._getDndView().addDragDetectionZone(this.getOption("dragZoneSelector")?this.container.getClosest(this.getOption("dragZoneSelector")):this.container)}this._injected=true;return this._parent.apply(this,arguments)},onMediaUploadsFailure:function(k){if(k&&k.cid){var j=this.container.getElement('img[data-new_media="true"][data-media_cid='+k.cid+"]");j&&j.remove()}},getModelAttribute:function(k,j){var l=null;if(k&&j){l=k.getChanges(j)||k.get(j)}return l},getContentAttributes:function(){var l=this.getRTEContent(),n=this.getMediaCollection(),k,o,m,p,j,q=[];k=h.createElement("div",{html:l});if(n&&n.length>0){m=k.getElements('img[data-new_media="true"][data-media_cid]');m.forEach(function(r){p=r.getAttribute("data-media_cid");q.push(p);o=n.get(p);if(o){j=this.getModelAttribute(o,"mid");if(j){r.dataset.mediaId=j}if(r.src&&r.src.contains("data:image/")){r.removeAttribute("src")}r.removeAttribute("class");r.removeAttribute("data-new_media");r.removeAttribute("data-media_cid");r.removeAttribute("data-cke-saved-src")}},this);if(h.Utils.Client.Engine.ie){k.getElements("img").forEach(function(r){if(r&&r.dataset.originalWidth){r.setStyle("width",r.dataset.originalWidth)}})}n.forEach(function(r){if(r.isNew()&&q.indexOf(r.cid)===-1){n.remove(r)}},this);f.processImages(k,false,false,this.model?{imageOptions:this.model.get("thumbnails_infos")}:null);l=k.getHTML()}return{content:l}},treatHTML:function(j){return j},isContentEmpty:function(){return this._isRTEContentEmpty()},updateImgTagsLayout:function(l,t,s){if(!h.is(s,"function")){throw new Error("A callback is required")}var m=this,p=this.getRTEView(),k=0,n=l&&l[this.options.modelAttr],r=n,q=this.getMediaCollection(),j=h.createElement("div",{html:n}),o=j.getElements("img[data-media_cid]");if(t){q.reset(t.toArray())}if(o.length>0){o.forEach(function(u){var v=q.get(u.getAttribute("data-media_cid"));if(v){g.getImageTagFromMedia(v,function(w){p.getImgTagToInsertIntoEditor(w,function(z,x){var y={};p.replaceBase64ImageSrcWithCSSClass(z,x,v);if(u.dataset.size){y["data-size"]=u.dataset.size}if(u.dataset.position){y["data-position"]=u.dataset.position}z.set(y);z.inject(u,"before");setTimeout(function(){u.remove();++k;if(k===o.length){r=j.getHTML();s.call(m,r)}},0)})})}else{throw new Error("New image is not present in uploaded media collection!")}},this)}else{s.call(this,r)}},resetContent:function(){var j=(this.model?this.getModelAttribute(this.model,this.options.modelAttr):""),k=this.getRTEView();if(!k.isEmptyRTEContent(j)){this.getRTEView().updateEditor(j)}else{this.getRTEView().resetEditor()}},refreshContent:function(k,j){this.updateImgTagsLayout(k,j,function(l){var m=this.getRTEView();if(!m.switchedToRTE()){m.switchToRTE(l,true,this.options.mode)}else{m.updateEditor(l)}})},insertMediaIntoTextEditor:function(j){var k=this.getRTEView();if(j&&j.length>0){j.forEach(function(l){g.getImageTagFromMedia(l,function(m){a(this.container,m);k.insertMediaIntoTextEditor(null,m,l)})},this)}},addMedia:function(k){var j=undefined;if(k&&k.length>0){j=this._parent.apply(this,arguments);this.insertMediaIntoTextEditor(k)}return j},_onCopyPaste:function(j){var k=this.getRTEView();if(k){k.triggerActionOnMediaIntoTextEditor(j,"replace")}},onDragAndDrop:function(j){this.insertMediaIntoTextEditor(j)},onMediaCollectionChange:function(){}});return d});define("DS/SwymUIComponents/script/utils/content-media-utils",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/content/view/thumbnail-in-content-view","DS/SwymUIComponents/script/feature/community/media/view/interactive-media-thumbnail-view","DS/SwymUIComponents/script/feature/community/media/view/smart-lightbox-view","DS/SwymUIComponents/script/utils/content-process","DS/SwymUICore/script/lib/collection/generic/swym-collection","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUICore/script/utils/utils","DS/WebappsUtils/WebappsUtils"],function(i,c,j,k,a,f,e,h,g,b){var d={};d.createThumbnailInContentView=function(t,w,E){E=false;var H,n,I,q,F,r,z,A,y,u=new e(),o=w.model.get("thumbnails_infos"),s={},G=[],v=function(){var J=arguments[0],K=arguments[1]._shouldActivateAutoplay||false;new a({collection:u,model:J,isAutoplayActivated:K}).injectInDom()},D,m,x=(w.model.getDeletedContainedMediaIds&&w.model.getDeletedContainedMediaIds())||[];if(o){for(F=0,r=o.length;F<r;F++){s[o[F].media_id]=o[F]}}for(var p in w._childViews){if(w._childViews.hasOwnProperty(p)){w.removeChildView(p)}}for(F=0,r=t.length;F<r;F++){D=t[F];H=h.CONTENT_SECTION_MAX_WIDTH;y=D.dataset.mediaId;if(s&&s[y]){A=s[y];z=new c(A);var C=A.width||A.preview_original_width,B=A.height||A.preview_original_height,l;l=D.getAttribute("data-size");if(A.user_access===false){if(l==="small"){C=218;B=163}else{if(l==="large"){C=710;B=531}}}else{if(l==="small"){H=h.CONTENT_SMALL_IMAGE_MAX_WIDTH}}if(C>B){H=Math.min(H,C,h.getLargestMediaDisplayDimensions(z).width)}else{n=h.CONTENT_SECTION_MAX_WIDTH/(parseInt(C,10)/parseInt(B,10));n=Math.min(n,B,h.getLargestMediaDisplayDimensions(z).height);H=n*(parseInt(C,10)/parseInt(B,10))}I=h.generateBestThumbnailForContentView(H,n,z,{imgTag:D})}else{n=parseInt(D.style.height||D.height,10)||100;H=parseInt(D.style.width||D.width,10)||100;A={media_id:y,media_type:D.getAttribute("data-media-type"),width:H,height:n};z=new c(A);I={mediaId:y,mediaType:D.getAttribute("data-media-type"),previewType:"thumb",useVariableSizeSprite:false,widthToDisplay:H,heightToDisplay:n,sizeCategory:"s",url:c.constructThumbnailUrl("media",y)}}m=x.indexOf(y)>=0;if(m===true){A._deleted=true}u.add(z);if(E===false){delete I.useVariableSizeSprite}q={model:z,Class:k,displayIconsOnTopRightCorner:!m,events:m?null:{onOpenInViewerRequest:v}};q.imageRenderingOptions=E?i.extend(I,{cls:D.className}):I;if(g.isFeatureActivated("activateSpriteRemoval")===true){q.imageReloadOptions={size:I.sizeCategory,imageKind:I.previewType};q.delegateSpriteReloadToParentView=false}G.push(w.addChildView("thumbnailInfo"+F,q))}return G};d.canUseSprite=function(u,t){var p;if(u){var w=/<img .+? data-media-id="[A-Za-z0-9-_]+".+?" \/>/gi;var q=t.match(w);var n=q?q.length:0;var r=u.length;var x=/\(.+?\/streammediasprite\/.+?\)/gi,v=t.replace(x,"");for(var o=0,m=r;o<m;o++){var l=new RegExp('<img .+? data-media-id="'+u[o].media_id+'".+?"',"g");var s=v.match(l);if(s===null){return false}else{n-=s.length-1}}if(r===n){p=true}else{p=false}}else{p=false}return p};d.replaceStreammediaUrl=function(l){var m=/src="([^"]*)\/streammedia\/.+?"/gi;return l?l.replace(m,['src="',b.getWebappsBaseUrl(),'SwymUIComponents/assets/thumb.png"'].join("")):""};d.addMediaLightBox=function(r){var n,o,p=[];for(n=0,o=r.length;n<o;n++){var q=r[n].dataset.mediaId;if(!p.includes(q)){p.push(q)}}for(n=0,o=r.length;n<o;n++){if(!r[n]._events){i.extendElement(r[n]).addEvent("click",f._onThumbnailClick.bind(r[n],{displayedMediaId:r[n].dataset.mediaId,mediaIds:p,refModel:this.model}))}}};return d});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-status-view",["UWA/Core","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-status-view","DS/SwymUICore/script/feature/community/idea/collection/status-collection","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/UIKIT/Dropdown","DS/UIKIT/Input/Button","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/SwymUIComponents/script/feature/community/content/view/simple-editor-view","DS/UWPClientCode/I18n"],function(j,f,a,g,m,h,k,b,c,l,i,d){var e=g.extend({name:"idea-status-view",_height:12,_statusCollection:null,_maxStatusNumber:5,_modelEventsForAutoRefresh:["onChange:_acl","onChange:acl_status","onSync:updateideationstatus"],domEvents:{"click .fonticon-cancel":"_onOutPanelClick"},_createContent:function(){var u=this,x,r=u._statusCollection,y=u._height,t,w,n=10,o=u._maxStatusNumber,v,q,p,s=u.model;if(r&&r.length>1&&s.get("status_id")){t=r.slice();v=u._createCurrentStatusPanel();p=s.get("acl_status");if(s.get("out")!=="0"){x=j.createElement("div",{"class":"flat-pipeline-container",styles:{width:"100%","margin-top":"20px"},html:v})}else{u._ideaStatusArray=[];t.forEach(function(z,A,B){q=z.get("mid")===s.get("status_id");w=j.createElement("div",{"class":"idea-status"+(q?" current":"")+(p?" can-edit":""),styles:{flex:"0 0 "+(100/B.length)+"%","padding-top":n+"px",cursor:(p&&!q?"pointer":"")},html:[{"class":"idea-sub-status",styles:{height:y+"px",backgroundColor:z.get("color")}},{"class":"idea-status-title",styles:{"font-weight":(q?"bold":"")},html:z.get("title")+(z.get("is_mature")?'</br><span class="mature-label">'+f.Mature+"</span>":"")}],events:(p&&!q?{click:function(){u._changeStatus(A+1,false)}}:{})});u._ideaStatusArray.push(w)});x=j.createElement("div",{"class":(r.length>o?"more-than-x-status":""),html:[{"class":"flat-pipeline-container",html:[{"class":"flat-pipeline",html:u._ideaStatusArray},(r.length>o?"":(p?{"class":"out-panel",html:[{tag:"span","class":"fonticon fonticon-2x fonticon-cancel",title:f.Out}]}:""))]},v]})}if(!this.getControl("outPanelTooltip")&&this.container.getElement(".fonticon-cancel")){this.addControl("outPanelTooltip",new l({target:j.extendElement(this.container.getElement(".fonticon-cancel")),body:f.Out}))}if(j.is(s.get("out"))){u._createIdeaShape()}else{s.addEventOnce("onSync",u._createIdeaShape)}return x}},_onOutPanelClick:function(){if(this.model.get("out")==="0"){this._changeStatus(null,true)}},_createStatusChangeModalElements:function(){var o=this,n=o.model;o.addControl("cancelButton",new h({className:"default",value:f.Cancel,events:{onClick:function(){o.current_status_nb=o.initial_status_nb;o.current_out=o.initial_out;o.getControl("editTextarea").getTextArea().setText("");o._statusChangeModal.hide()}}}));o.addControl("saveButton",new h({className:"primary",value:f.Change,events:{onClick:function(){o.getControl("saveButton").load();n.editStatus({data:{status_id:o.current_status,out:o.current_out,status_comment:o.getControl("editTextarea").getTextArea().getHTML()},onComplete:function(){o.getControl("saveButton").load(false);o._statusChangeModal.hide();o.getControl("editTextarea").getTextArea().setText("");n.set("status_id",o.current_status.toString());n.set("status_nb",o.current_status_nb.toString());n.set("out",(o.current_out?"1":"0"));n.set("color",o.current_color);n.set("status_title",o.current_title);o.initial_status_nb=o.current_status_nb;o.initial_out=o.current_out;o.alert("success",f.Statushasbeenchanged)}})}}}));var p=o.addControl("editTextarea",new i({className:"status-change-textarea",rtePlaceholder:f.Provide,mandatory:false,cssPlaceholder:true}));p.switchToRTE()},_createIdeaShape:function(){var r=this,o=r.model;if(r._statusCollection&&r._statusCollection.length>1){var q=o.getAttributes(),n=r._statusCollection.slice(),p;if(r._ideaShape){r._ideaShape.destroy()}n.forEach(function(s){if(q.status_id===s.get("mid").toString()){q.status_nb=parseInt(s.get("status_nb"),10)}});r.initial_status_nb=q.status_nb;r.initial_out=(q.out==="1"?true:false);r.current_status_nb=r.initial_status_nb;r.current_out=r.initial_out;r._ideaShape=j.createElement("div",{"class":"idea-shape",styles:{top:(r._height/2)+"px"}});if(r.initial_out===false&&r._ideaStatusArray){r._ideaStatusArray[q.status_nb-1].appendChild(r._ideaShape)}}},_createCurrentStatusPanel:function(){var q=this,o=q.model,n=o.get("acl_status"),p=q._statusCollection.slice(),r=[],v,u=[];p.forEach(function(w,y,z){var x=false;if(w.get("mid")===o.get("status_id")){v=w;x=true}u.push({"class":"dropdown-status-element"+(n?" can-edit":""),styles:{cursor:(x||!n?"":"pointer")},html:[{"class":"dropdown-status-icon",styles:{backgroundColor:(x&&o.get("out")==="0"?"#FFFFFF":w.get("color")),"border-color":w.get("color"),"border-width":(x&&o.get("out")==="0"?"5px":"0px")}},new h({value:w.get("title",{escapeHTML:false})+(w.get("is_mature")?" "+f.Mature:""),className:"link status-button"+(x&&o.get("out")==="0"?" current":""),disabled:(x&&o.get("out")==="0")||!n})],events:(n&&!(x&&o.get("out")==="0")?{click:function(){q._changeStatus(w.get("status_nb"),false)}}:{})})});u.push({"class":"dropdown-status-element"+(n?" can-edit":""),styles:{cursor:(o.get("out")==="1"||!n?"":"pointer")},html:[{tag:"span","class":"fonticon fonticon-2x fonticon-cancel out-icon",styles:{"line-height":"20px"}},new h({value:f.Out,className:"link status-button out-button"+(o.get("out")==="1"?" current":""),disabled:(o.get("out")==="1")||!n})],events:(n&&o.get("out")==="0"?{click:function(){q._changeStatus(null,true)}}:{})});var s=new h({value:(o.get("out")!=="0"?f.Out:v.get("title",{escapeHTML:false})),className:"link status-button"});s.getContent().setStyle("background-color",(o.get("out")!=="0"?"#D8D8D8":v.get("color")));var t=j.createElement("div",{styles:{display:"inline-block",cursor:"pointer"},html:[s,{tag:"span","class":"fonticon fonticon-down-open",styles:{"line-height":"23px","vertical-align":"bottom"}}]});new m({target:t,body:{html:u},className:"status-dropdown"});return j.createElement("div",{"class":"current-status-panel",styles:{display:(o.get("out")!=="0"?"block":"")},html:[(o.get("out")!=="0"?f.Thisideais:f.Currentstatus),t]})},_changeStatus:function(o,n){var p=this;if(o===null){o=p.initial_status_nb}if(o!=p.current_status_nb||n!=p.current_out){p._statusCollection.forEach(function(q){if(o==q.get("status_nb")){p.current_status=q.get("mid");p.current_status_nb=q.get("status_nb");p.current_color=q.get("color");p.current_title=q.get("title")}});p.current_out=n;if(o!==p.initial_status_nb||n!==p.initial_out){if(!p._statusChangeModal){p._createStatusChangeModalElements();p._statusChangeModal=this.addControl("statusChangeModal",new k({header:"<h4>"+(p.current_out?f.Whyout:d.replace(f.Whyto,{status:p.current_title}))+"</h4>",className:"fancy",body:[p.getControl("editTextarea")],footer:[p.getControl("saveButton"),p.getControl("cancelButton")],closable:false}));p._statusChangeModal.show()}else{p._statusChangeModal.setHeader("<h4>"+(p.current_out?f.Whyout:d.replace(f.Whyto,{status:p.current_title}))+"</h4>");p._statusChangeModal.show()}p.getControl("editTextarea").setFocus()}}},setup:function(o){var n=this._parent.apply(this,arguments);if(o&&o.height){this._height=o.height}if(this.model.getCommunity().get("mid")){this._statusCollection=this.model.getCommunity().getStatus();this.reactTo(this._statusCollection,"onSync:read",function(){if(!this.isDestroyed()){this.refresh()}},this);if(this._statusCollection){this.stopReactingTo(this._statusCollection,"onEdit")}this.reactTo(this._statusCollection,["onEdit"],function(){if(this.model){this.refresh()}}.bind(this))}return n}});return e});define("DS/SwymUIComponents/script/feature/community/idea/view/idea-detailed-view",["UWA/Core","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUIComponents/script/feature/community/content/view/content-detailed-view","DS/SwymUIComponents/script/feature/community/idea/view/idea-status-view","DS/SwymUIComponents/script/feature/community/idea/view/idea-transfer-view","DS/SwymUIComponents/script/feature/community/idea/view/idea-links-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/idea/view/idea-detailed-view","DS/SwymUICore/script/feature/core/config/bootstrap-model"],function(f,b,e,k,a,i,d,h){var j="viewer-left-column",g="viewer-right-column",c=e.extend({_modelClass:b,name:"idea-detailed-view",defaultOptions:{iconCls:"lamp",forceCommentFetchIfNotDoneYet:true},_createStatusSection:function(){return this.addChildView("statusView",{model:this.model,Class:k,height:12,widget:this._widget})},_createTransferSection:function(){var m,l=this.getChildView("transferView");if(!l){l=this.addChildView("transferView",{model:this.model,Class:a,widget:this._widget})}m=f.createElement("div",{html:[{"class":"idea-links-title",html:d.Transfer},l]});if(l.ideaTransferredLinkViewDisplayed===false&&l.ideaTransferFormViewDisplayed===false){m.hide()}else{m.show()}this.reactTo(l,"DisplayEvent",function(n){if(n===true){m.show()}else{m.hide()}});return m},_createLinksSection:function(){var l=this.getChildView("linksView");if(!l){l=this.addChildView("linksView",{model:this.model,Class:i,widget:this._widget})}else{l.refresh()}var m=f.createElement("div",{html:[{"class":"idea-links-title",html:d.RelatedLinks},l]});this.reactTo(this.model.getAssociated("links"),"onSync",function(o){var n=this.model.getAuthor().get("hash_key")===h.getInstance().get("user").hash_key||this.model.getCommunity().getUserRole()>=3;if(this.model.hasBeenFetched()){if(o.length===0&&!n){m.hide()}else{m.show()}}else{this.reactTo(this.model,"onSync",function(p){var q=p.getAuthor().get("hash_key")===h.getInstance().get("user").hash_key||p.getCommunity().getUserRole()>=3;if(o.length===0&&!q){m.hide()}else{m.show()}},this)}},this);return m},_createLeftColumn:function(){return{"class":"content-body-section",html:[{"class":"content-subtitle-section",html:[this._createAuthorSection(),this._createViewCounter()]},{"class":"viewer-status-read-only",html:this._createStatusSection()},this._createDetailedView(),{"class":"viewer-links-transfer",html:[{"class":"viewer-links col-sm-6",html:this._createLinksSection()},{"class":"viewer-transfer col-sm-6",html:this._createTransferSection()}]}]}},_createContent:function(){var l=this.model;if(l){return[{"class":"viewer-header",html:this._createTitleSection()},{"class":"viewer-body",html:[{"class":j,html:this._createLeftColumn()},{"class":g}]}]}}});return c});define("DS/SwymUIComponents/script/feature/community/media/edit/media-editor-body-view",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/content/edit/abstract-content-editor-body-view","DS/SwymUIComponents/script/feature/community/content/view/simple-editor-view","DS/SwymUIComponents/script/feature/community/media/view/edit-file-view","DS/SwymUIComponents/script/feature/community/content/view/properties-editor-view","DS/SwymUIComponents/script/utils/media-utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/edit/media-editor-body-view"],function(f,h,a,d,g,i,e,c){var b=a.extend({_modelClass:h,name:"media-edit-view",pictureHasChanged:false,_modelEvents:{onVirtualChange:"onMediaChange",onPictureHasChanged:"onPictureHasChanged","onSync:read":"refresh"},defaultOptions:{iconCls:"picture",descriptionAttr:"content"},setup:function(){this._parent.apply(this,arguments)},domEvents:{},_createContent:function(){if(this.model&&this.model.get("media_type")){return{"class":"media-content-edition",html:[this._createMediaEditor()]}}else{return{"class":"media-content-edition",tag:"div"}}},_createMediaEditor:function(){return[{"class":"container-fluid",html:[this._getEditorWrapperContent(),this._getRTEView()]},{"class":"row container-fluid",html:[{"class":"col-md-6 col-xs-12",html:this._getMediaPropertiesView()},{"class":"col-md-6 col-xs-12",html:this._getFileUploadView()}]}]},_getRTEView:function(){var j=this.getChildView("rte");if(!j){j=this.addChildView("rte",{Class:d,model:this.model,modelAttr:this.options.descriptionAttr,rtePlaceholder:c.AddADescription,mandatory:false,useFocusStyle:true});j.switchToRTE();this.listenTo(j,"onRTEContentChanged",this.onMediaChange.bind(this))}return j},_getFileUploadView:function(){var j=this.model,k=this.getChildView("fileUploadView");if(j&&!k){k=this.addChildView("fileUploadView",{model:j,Class:g,attributes:{"class":"editor-border"}})}return k},_getMediaPropertiesView:function(){var k=this.getChildView("propertiesEditorView"),j=this.model;if(!k&&j){k=this.addChildView("propertiesEditorView",{model:j,Class:i,withoutCategory:true,attributes:{"class":"editor-border",styles:{"margin-top":"10px"}}});this.listenTo(k,"getPlayerStateRequest",this._onGetPlayerStateRequest.bind(this,k))}return k},_onGetPlayerStateRequest:function(j){var k=this._getEditorWrapperContent().getState()?this._getEditorWrapperContent().getState():null;j.dispatchEvent("playerStatusInfo",[k])},_getEditorWrapperContent:function(){var k=this.getChildView("mediaEditorView");if(!k){var j=null;j=e.getMediaViewerModule(this.model,"edit");k=this.addChildView("mediaEditorView",{model:this.model,Class:j,viewMode:"edit"})}return k},isContentEmpty:function(){return false},getContentAttributes:function(){return{}},resetContent:function(){this.model.removeChanges();this.pictureHasChanged=false;var j=(this.model?this.model.get(this.options.descriptionAttr):"");if(j){this._getRTEView().updateEditor(j)}else{this._getRTEView().resetEditor()}this._getMediaPropertiesView().resetPropertiesView();this._getFileUploadView().onCancel();this._getEditorWrapperContent().refresh()},refreshContent:function(j){this.refresh()},onPictureHasChanged:function(){this.pictureHasChanged=true;this.onMediaChange()},onMediaChange:function(){this.dispatchEvent("onContentChange")},getMediaCollectionLength:function(){},getMediaCollection:function(){},uploadMedia:function(){},addMedia:function(){}});return b});define("DS/SwymUIComponents/script/feature/community/survey/view/question-editor-view",["UWA/Core","UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/question-editor-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/survey/view/scale-answer-view","DS/SwymUIComponents/script/feature/community/survey/view/answer-editor-collection-view","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-view-with-rte","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","UWA/Controls/DataGrid","DS/SwymUICore/script/utils/utils"],function(l,c,g,h,m,e,p,i,a,o,d,n,q,k){var j=k.isFeatureActivated("activateSurveyImprovements");var b=h.extend({_modelEventsForAutoRefresh:["onChange:type"],domEvents:{"click .add-answer-button":"onAddButtonClick","change .answer-is-open-checkbox":"onAnswerIsOpenCheckboxChange","change .start-at-zero-checkbox":"onStartAtZeroCheckboxChange","keyup .min-range-size-label":"onMinRangeSizeLabelChange","keyup .max-range-size-label":"onMaxRangeSizeLabelChange","change .number-of-steps":"onNumberOfStepsChange"},contentChanged:function(){this.dispatchEvent("onContentChange")},onRemoveOpenAnswer:function(){this.getControl("answerIsOpenCheckbox")&&this.getControl("answerIsOpenCheckbox").setCheck(false)},_createContent:function(){var v=this.model,w,x=false,s;if(v){if(v.get("type")==="Single"||v.get("type")==="Multiple"){if(!this.getControl("addAnswerButton")){this.addControl("addAnswerButton",new i({className:"add-answer-button default",value:g.AddAnswer,icon:"plus"}))}if(!this.getControl("answerIsOpenCheckbox")){this.addControl("answerIsOpenCheckbox",new o({type:"checkbox",value:g.Allowanotheranswer,className:"answer-is-open-checkbox primary",attributes:{name:"is_open"}}))}v.get("answers")&&v.get("answers").forEach(function(y){x=y.is_open==="1"?true:false});x&&this.getControl("answerIsOpenCheckbox").check(true);this.addControl("answerEditorCollectionView",new e(v.getAssociated("answers")));this.listenTo(this.getControl("answerEditorCollectionView"),{onContentChange:this.contentChanged.bind(this),onRemoveOpenAnswer:this.onRemoveOpenAnswer.bind(this)});if(v.get("type")==="Multiple"){var u=this._getOptions();var t=this.addControl("maxAnswerCombo",new a({className:"max-answer-combo",options:u}));var r=this.addControl("multipleAnswerConfig",l.createElement("div",{"class":"multiple-answers-config",html:['<b class="answer-info-panel">'+g.Maximumnumberofanswerthatusercanselect+"</b>",{styles:{"margin-top":"10px"},html:this.getControl("maxAnswerCombo")}]}));if(u.length<=2){r.hide()}else{r.show()}t.addEvent("onChange",function(y){if(this.getControl("maxAnswerCombo").getValue()[0]){this.model.set("nb_answer_max",y.target.value)}},this);v.getAssociated("answers").addEvent("onRemove",function(){var y=this._getOptions();this.getControl("maxAnswerCombo").remove();this.getControl("maxAnswerCombo").add(y);if(y.length<2){r.hide()}}.bind(this))}}else{if(v.get("type")==="Scale"){if(!this.getControl("numberOfSteps")){this.addControl("numberOfSteps",new a({placeholder:g.NumberOfSteps,className:"number-of-steps",options:[{value:"2"},{value:"3"},{value:"4"},{value:"5",selected:true},{value:"6"},{value:"7"},{value:"8"},{value:"9"},{value:"10"}]}));if(v.get("index_max")){w=v.get("index_min")===0?v.get("index_max")+1:v.get("index_max");this.getControl("numberOfSteps").setValue(w.toString())}if(!v.getChanges("index_max")&&!v.get("index_max")){v.addChanges("index_max",5)}if(!v.getChanges("index_min")&&!(v.get("index_min")>=0)){v.addChanges("index_min",1)}}if(!this.getControl("startAtZero")){this.addControl("startAtZero",new o({type:"checkbox",value:g.Startatzero,className:"start-at-zero-checkbox primary",attributes:{name:"start_at_zero"}}))}v.get("index_min")===0&&this.getControl("startAtZero").check();if(!this.getControl("minRangeSizeLabel")){this.addControl("minRangeSizeLabel",new d({className:"min-range-size-label",placeholder:"Label (optional)"}))}this.getControl("minRangeSizeLabel").setValue(c.unescapeHTML(v.get("label_min")||""));if(!this.getControl("maxRangeSizeLabel")){this.addControl("maxRangeSizeLabel",new d({className:"max-range-size-label",placeholder:"Label (optional)"}))}this.getControl("maxRangeSizeLabel").setValue(c.unescapeHTML(v.get("label_max")||""));if(!this.getControl("ScaleAnswerViewPreview")){this.addControl("ScaleAnswerViewPreview",new m({indexMin:(this.getControl("startAtZero").isChecked()?0:1),indexMax:parseInt(this.getControl("numberOfSteps").getValue()[0],10)-(this.getControl("startAtZero").isChecked()?1:0),minLabel:this.getControl("minRangeSizeLabel").getValue(),maxLabel:this.getControl("maxRangeSizeLabel").getValue()}))}}}s=l.createElement("div",{html:[(v.get("type")==="Single"||v.get("type")==="Multiple"?{"class":"answer-panel",html:[{styles:{"font-weight":"bold",padding:"20px 0 10px"},html:g.AnswersTitle},this.getControl("answerEditorCollectionView"),{html:[this.getControl("answerIsOpenCheckbox")]},this.getControl("addAnswerButton"),{styles:{clear:"both"}}]}:""),(v.get("type")==="Scale"?{styles:{"margin-top":"20px"},html:[{styles:{"font-weight":"bold","margin-bottom":"10px"},html:g.NumberOfSteps},this.getControl("numberOfSteps"),this.getControl("startAtZero"),{"class":"scale-configuration",html:[{"class":"min-range-size-title",html:g.Startlabel},this.getControl("minRangeSizeLabel"),{"class":"max-range-size-title",html:g.Endlabel},this.getControl("maxRangeSizeLabel")]},{styles:{"font-weight":"bold","margin-bottom":"10px","margin-top":"20px"},html:g.Preview},{styles:{"margin-top":"20px","margin-bottom":"20px"},html:this.getControl("ScaleAnswerViewPreview")}]}:""),{html:(v.get("type")==="Multiple"?this.getControl("multipleAnswerConfig"):(v.get("type")==="Open"?'<div class="answer-info-panel">'+g.Userwritehisownanswer+"</div>":""))}]});return s}},_getOptions:function(){var r=[{value:"",label:g.AllAnswers}];var s=2;while(this.model.getAssociated("answers").length>s){r.push({selected:(this.model.get("nb_answer_max")==s?true:false),value:s,label:s+" "+g.answers});s++}return r},_updateScaleAnswerViewPreview:function(){this.getControl("ScaleAnswerViewPreview").getContent().setHTML(new m({indexMin:(this.getControl("startAtZero").isChecked()?0:1),indexMax:parseInt(this.getControl("numberOfSteps").getValue()[0],10)-(this.getControl("startAtZero").isChecked()?1:0),minLabel:this.getControl("minRangeSizeLabel").getValue(),maxLabel:this.getControl("maxRangeSizeLabel").getValue()}))},onAddButtonClick:function(){var r=this.model.addAnswer({description:"",is_open:"0"});if(this.model.get("type")=="Multiple"){this.refresh()}this.getControl("answerEditorCollectionView").getElements(".answer-delete-button").forEach(function(s){s.show()})},onAnswerIsOpenCheckboxChange:function(u){var v=this.model.getAssociated("answers"),t=v.length,s=parseInt(v.at(t-1).get("is_open"),10)===1;if(u.target.checked===true){if(!s){this.model.addAnswerIsOpen()}}else{if(s){this.model.removeAnswerIsOpen()}}if(this.model.get("type")==="Multiple"){var r=this._getOptions();this.getControl("maxAnswerCombo").remove();this.getControl("maxAnswerCombo").add(r);if(r.length<2){this.getControl("multipleAnswerConfig").hide()}else{this.getControl("multipleAnswerConfig").show()}}this.contentChanged()},onStartAtZeroCheckboxChange:function(s){var r=s.target.checked;this.model.addChanges("index_min",(r?0:1));this.model.addChanges("index_max",parseInt(this.getControl("numberOfSteps").getValue()[0],10)-(r?1:0));this._updateScaleAnswerViewPreview()},onMinRangeSizeLabelChange:function(){this.model.addChanges("label_min",this.getControl("minRangeSizeLabel").getValue());this._updateScaleAnswerViewPreview()},onMaxRangeSizeLabelChange:function(){this.model.addChanges("label_max",this.getControl("maxRangeSizeLabel").getValue());this._updateScaleAnswerViewPreview()},onNumberOfStepsChange:function(r){this.model.addChanges("index_max",parseInt(r.target.value,10)-(this.getControl("startAtZero").isChecked()===true?1:0));this._updateScaleAnswerViewPreview()}});var f=h.extend({domEvents:{"change .question-type":"onQuestionTypeChange","focusout .editable-container":"_focusOutEditor","click .fonticon-attach":"_onOpenMediaLibrary"},_modelEvents:{onVirtualChange:"contentChanged",onChange:"contentChanged"},_onOpenMediaLibrary:function(){var r=this;require(["DS/SwymUIComponents/script/feature/community/media/library/media-library-view"],function(u){var t=r.getOption("communityId");var s=new u({communityId:t});s.injectInDom();r.listenTo(s,{newMediaAdded:function(x){var y=x.newMedia,w=x.existingMedia,v=r.getRTEView()._getMediaEditionView();if(y&&Array.isArray(y)&&(y.length>0)){v.addNMediaModels(y)}if(w&&Array.isArray(w)&&(w.length>0)){v.addNMediaModels(w)}s.destroy();r.getRTEView().getRTEView().setFocus()}})})},_focusOutEditor:function(){var r=this.getChildView("rte"),s;if(r){s=r.getContentAttributes().content}if(s){this.model.addChanges("description",s)}},_createContent:function(){var u=this.model,v=this,t=[{value:"Single",label:g.Single,icon:"radiobutton-off"},{value:"Multiple",label:g.Multiple,icon:"checkbox-off"},{value:"Open",label:g.Open,icon:"view-list"},{value:"Scale",label:g.Scale,icon:"favorite-half"}],s,r,w=this.getControl("questionTypeSelector");if(!j){t.pop()}if(u){if(!w){w=this.addControl("questionTypeSelector",new a({placeholder:g.AnswerType,className:"question-type",options:t,value:u.get("type")}));w.getContent().getElements(".result-option").forEach(function(x,y){if(t[y]&&t[y].icon){x.innerHTML='<span class="fonticon fonticon-'+t[y].icon+'"></span> '+x.innerHTML}})}else{w.select(1)}if(j){r=l.createElement("span",{styles:{"margin-left":"10px"},"class":"fonticon fonticon-1-5x fonticon-help-circled"});this.addControl("helpIconTooltip",new n({target:r,className:"survey-answer-type-tooltip",body:new q({className:"mediaTooltip",columns:[{text:g.Type,dataIndex:"type"},{text:"Description",dataIndex:"text"}],data:[{type:'<span class="fonticon fonticon-radiobutton-off"></span> '+g.Single,text:g.TooltipSingle},{type:'<span class="fonticon fonticon-checkbox-off"></span> '+g.Multiple,text:g.TooltipMultiple},{type:'<span class="fonticon fonticon-view-list"></span> '+g.Open,text:g.TooltipOpen},{type:'<span class="fonticon fonticon-favorite-half"></span> '+g.Scale,text:g.TooltipScale}]})}))}s=l.createElement("div",{"class":"question-wrapper",html:[{html:[{styles:{"margin-top":"10px"},html:[this.addControl("question-delete-button",new i({className:"question-delete-button default",value:g.Remove,attributes:{styles:{display:(u.collection&&u.collection.length>1?"block":"none")}},events:{onClick:this._questionDeleteButtonClick.bind(this)}})),this.addControl("question-move-down-button",new i({className:"question-move-down-button default",value:g.Moveright,attributes:{styles:{display:(u.collection&&u.collection.length!=u.get("position")?"block":"none")}},events:{onClick:this._questionMoveDownButtonClick.bind(this)}})),this.addControl("question-move-up-button",new i({className:"question-move-up-button default",value:g.Moveleft,attributes:{styles:{display:(u.get("position")>1?"block":"none")}},events:{onClick:this._questionMoveUpButtonClick.bind(this)}}))]},{"class":"question-sub-wrapper",html:[this.getRTEView(),(j?{tag:"span","class":"fonticon fonticon-attach"}:"")]},{styles:{"font-weight":"bold",padding:"20px 0 10px"},html:[g.AnswerType,(r?r:"")]},w]},this.addChildView("questionConfiguration",new b({model:u,events:{onContentChange:v.contentChanged.bind(v)}}))]});this.addControl("helpAddMedia",new n({target:s.getElement(".fonticon-attach"),body:g.AddAMedia}));return s}},getRTEView:function(){var r=this.getChildView("rte");if(!r){r=this.addChildView("rte",{Class:p,rtePlaceholder:g.EnterYourQuestion,modelAttr:"description",useFocusStyle:true,mandatory:false,activateUserMention:true,activateInline6WTagging:false,dragZoneSelector:".question-wrapper",mediaInsertion:j});if(r.getRTEView()){r.getRTEView().updateEditor(this.model.get("description"))}this.reactTo(r,"onContentChange",this.addChangeForQuestionDescription,this)}return r},addChangeForQuestionDescription:function(){this.model.addChanges("description",this.getChildView("rte")&&this.getChildView("rte").getRTEContent())},_updateButtons:function(){var r=this._parentView.model.getAssociated("questions").length;if(r>1){this.getControl("question-delete-button").show()}else{this.getControl("question-delete-button").hide()}if(r!=this.model.get("position")){this.getControl("question-move-down-button").show()}else{this.getControl("question-move-down-button").hide()}if(this.model.get("position")>1){this.getControl("question-move-up-button").show()}else{this.getControl("question-move-up-button").hide()}},contentChanged:function(){var r=this.getChildView("rte")&&this.getChildView("rte").container;if(r&&r.hasClassName("validation-error")){r.removeClassName("validation-error")}this.dispatchEvent("onContentChange")},onQuestionTypeChange:function(r){this.model.set("type",r.target.value)},_questionMoveDownButtonClick:function(){var r=this.model.get("position");this._parentView.model.getAssociated("questions").moveDown(this._parentView.model.getAssociated("questions").at(r-1));this._parentView.getControl("surveyQuestionsList").moveTab(r-1,r);this._parentView.model.getAssociated("questions").forEach(function(s,t){this._parentView.getChildView("question-"+(s.get("mid")||s.get("unique_id")))._updateButtons()}.bind(this));this._parentView.getControl("surveyQuestionsList").tabs.forEach(function(t,s){t.setText(g.Question+" "+(s+1))})},_questionMoveUpButtonClick:function(){var r=this.model.get("position");this._parentView.model.getAssociated("questions").moveUp(this._parentView.model.getAssociated("questions").at(r-1));this._parentView.getControl("surveyQuestionsList").moveTab(r-1,r-2);this._parentView.model.getAssociated("questions").forEach(function(s,t){this._parentView.getChildView("question-"+(s.get("mid")||s.get("unique_id")))._updateButtons()}.bind(this));this._parentView.getControl("surveyQuestionsList").tabs.forEach(function(t,s){t.setText(g.Question+" "+(s+1))})},_questionDeleteButtonClick:function(){var r=this.model.get("position"),s=this._parentView;if(s.model.getAssociated("questions").length>1){s.getControl("surveyQuestionsList").removeTab(r-1);s.model.getAssociated("questions").remove(s.model.getAssociated("questions").at(r-1));s.getControl("surveyQuestionsList").selectTab(0);s.model.getAssociated("questions").forEach(function(t,u){t.set("position",u+1);s.getChildView("question-"+(t.get("mid")||t.get("unique_id")))._updateButtons()});s.getControl("surveyQuestionsList").tabs.forEach(function(u,t){u.setText("Question "+(t+1))});this.destroy()}else{this.alert("error",g.Cannotgetlessthanonequestion)}}});return f});define("DS/SwymUIComponents/script/feature/community/question/social-interactions/social-features-for-question-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/social-interactions/social-features-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/social-toolbar-view","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUICore/script/feature/community/iquestion/model/iq-answer-model","DS/SwymUICore/script/feature/community/iquestion/collection/iq-answer-collection","DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-collection-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-editor-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/utils/utils"],function(a,m,n,g,b,j,i,e,o,k,c){var l=n.extend({_modelClass:g,defaultOptions:{enableComment:false,enableShare:false}}),r=n.extend({_modelClass:g,defaultOptions:{enableComment:false,enableLike:false}});var f=b.DateField;var h=o.extend({name:"sf-answer-creator-view",defaultOptions:{itemModelClass:b,itemTextAttribute:"answer",itemAdditionEvent:"addAnswer",itemAssociationToParentModel:"answeredFor"}}),d=e.extend({_modelClass:b,_contentModelAssociation:"answeredFor",_contentAttributeInModel:"answer",_contentCounter:"nb_answers",_showSummary:false,editorOptions:{itemModelClass:b,itemTextAttribute:"answer",itemAdditionEvent:"addAnswer",itemAssociationToParentModel:"answeredFor"}}),p=i.extend({_collectionClass:j,_contentModelAssociation:"answeredFor",_editorViewClass:h,_contentCounter:"nb_answers",modelViewClass:d,name:"answer-collection-view",_collectionEventsForAutoRefresh:null,setup:function(){var s=c.getDelayedSyncTask(this.refresh.bind(this));this._collectionEvents=a.merge(this._collectionEvents,{onAdd:s,onRemove:s,onReset:s});return this._parent.apply(this,arguments)},_createContent:function(){var s=this.collection.getSortAttribute();if(s!==f){this.collection.setSortAttribute(f);this.collection.sort()}return this._parent.apply(this,arguments)}}),q=m.extend({_modelClass:g,_answerCollectionViewClass:p,defaultOptions:{comments:false,mainCollectionViewName:"nonValidatedAnswers",validatedAnswers:true,validatedAnswersViewClass:"DS/SwymUIComponents/script/feature/community/question/view/validated-answers-view",nonValidatedAnswers:true,nonValidatedAnswersViewClass:p,showAnswers:true,showNonValidatedAnswersAtInit:true,answerToScrollTo:null},name:"social-features-for-questions-view",setup:function(){this._parent.apply(this,arguments);if((this.getOption("validatedAnswers")===true)&&(this.getOption("nonValidatedAnswers")===true)&&this.getOption("showAnswers")){this._createAllAnswers({showNonValidatedAnswers:this.getOption("showNonValidatedAnswersAtInit")})}else{if(this.getOption("validatedAnswers")===true){this._createValidatedAnswers()}if(this.getOption("nonValidatedAnswers")===true&&this.getOption("showAnswers")){this._createNonValidatedAnswers()}}},_createAllAnswers:function(s){this._fetchAndShowAllAnswers(s)},_createValidatedAnswers:function(){this._fetchAndShowValidatedAnswers()},_createNonValidatedAnswers:function(){this._fetchAndShowNonValidatedAnswers()},answersNotBeenOrBeingFetched:function(){var s=this.model;return(!s.haveAnswersBeenFetched()&&!s.areAnswersBeingFetched()&&!s.haveDetailedAnswersBeenFetched()&&!s.areDetailedAnswersBeingFetched())},_fetchAndShowAllAnswers:function(t){var s=this.model;if(this.answersNotBeenOrBeingFetched()){if((!s.hasBeenFetched()&&k.getInstance().isContentContext())||(parseInt(s.get("nb_answers"),10)>0)){this.fetchAllAnswers({onComplete:function(){var u=s.getValidatedAnswerCollection();if(u&&(u.length>0)){s.set("nb_validate",1)}else{s.set("nb_validate",0)}}})}}this._showNonValidatedAnswers();if(t&&t.showNonValidatedAnswers===false){this.getChildView(this.getOption("mainCollectionViewName")).hide()}if(this.getOption("showAnswers")===true){this._showValidatedAnswers()}},fetchAllAnswers:function(t){var s=this.model;return s.fetchAllAnswers(t)},_fetchAndShowValidatedAnswers:function(){var t=this.model,s=t.getValidatedAnswerCollection();if(!s.hasBeenFetched()&&!s.isBeingFetched()){if((!t.hasBeenFetched()&&k.getInstance().isContentContext())||(parseInt(t.get("nb_answers"),10)>0)){t.fetchValidatedAnswers({onComplete:function(){if(s&&(s.length>0)){t.set("nb_validate",1)}else{t.set("nb_validate",0)}}})}}if(this.getOption("showAnswers")===true){this._showValidatedAnswers()}},_showValidatedAnswers:function(){var s=this.model.getValidatedAnswerCollection();this.addChildView("validatedAnswers",{collection:s,Class:this.getOption("validatedAnswersViewClass"),modelName:this.model.getModelName()})},_fetchAndShowNonValidatedAnswers:function(){var s=this.model,t=s.getAnswerCollection();if(!t.hasBeenFetched()&&!t.isBeingFetched()){if((!s.hasBeenFetched()&&k.getInstance().isContentContext())||(parseInt(s.get("nb_answers"),10)>0)){s.fetchAnswers()}}this._showNonValidatedAnswers()},_showNonValidatedAnswers:function(){var s=this.model.getAnswerCollection();this.addChildView(this.getOption("mainCollectionViewName"),{collection:s,Class:this.getOption("nonValidatedAnswersViewClass"),modelName:this.model.getModelName(),answerToScrollTo:this.getOption("answerToScrollTo")})},_createContent:function(){var u=this.getChildView("actionBar"),s=this.getChildView(this.getOption("mainCollectionViewName")),t=this.getChildView("validatedAnswers");return[t?t:"",u?{"class":"social-buttons-wrapper",html:[this.addChildView("socialToolbarViewWithLikeOnly",new l({model:this.model,widget:this._widget,sendCommentsInitCallInPool:this.getOption("sendCommentsInitCallInPool")})),u,this.addChildView("socialToolbarViewWithShareOnly",new r({model:this.model,widget:this._widget,sendCommentsInitCallInPool:this.getOption("sendCommentsInitCallInPool")}))]}:"",s?s:""]},onCommentCreatorFocusRequest:function(){var s=this._parent.apply(this,arguments),t=this.getChildView(this.getOption("mainCollectionViewName"));if(t){t.show()}return s}});return q});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-editor-view",["UWA/Core","UWA/Controls/TabView","DS/UIKIT/Input/Button","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/survey-editor-view","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/survey/view/question-editor-view","DS/UIKIT/Input/Number","DS/UIKIT/Input/Date","DS/UIKIT/Input/Toggle","DS/SwymUICore/script/utils/i18n","DS/SwymUICore/script/utils/utils"],function(h,m,e,b,d,c,k,i,j,l,g){var f=g.isFeatureActivated("activateSurveyImprovements");var a=d.extend({_modelEventsForAutoRefresh:["onSync"],name:"survey-editor-view",domEvents:{"change .survey-results-checkbox":"onSurveyResultsChange","change .start-hour":"onStartHourChange","change .end-hour":"onEndHourChange","change .start-minute":"onStartMinuteChange","change .end-minute":"onEndMinuteChange","click .add-question-button":"onAddButtonClick","change .survey-start-date-picker":"onSurveyStartDatePickerChange","change .survey-end-date-picker":"onSurveyEndDatePickerChange"},startDate:null,endDate:null,_createQuestionsStepPanel:function(){var r=this,o,p=r.model,s,q,n;if(p&&p.getAssociated("questions").length===0){s=p.addQuestion({createdQuestion:true,description:"",isActive:true,nb_answer_max:"0",pollId:"",type:"Single"});s.addAnswer({description:"",is_open:"0"});s.addAnswer({description:"",is_open:"0"});s.set("unique_id",(new Date()).getTime())}if(p){q=new m({className:"nav",tabScroller:true});for(n in r.getChildViews()){r.removeChildView(n)}p.getAssociated("questions").forEach(function(u,v){var w=l.replace(b.Question,{questionPosition:v+1}),x=new m.Tab({text:w,id:Math.random()});var t=r.addChildView("question-"+(u.get("mid")||u.get("unique_id")),{Class:c,model:u,communityId:r._parentView.getCommunityId(),events:{onContentChange:r.contentChanged.bind(r)}});q.addTab(x);x.setContent(t)});r.addControl("surveyQuestionsList",q);if(!r.getControl("addQuestionButton")){r.addControl("addQuestionButton",new e({className:"add-question-button default",value:b.Addquestion,icon:"plus"}))}o={"class":"questions-configuration",html:[r.getControl("addQuestionButton"),{styles:{clear:"both"}},r.getControl("surveyQuestionsList")]}}return o},_canStartDateBeChanged:function(){var p=this.model;if(parseInt(p.get("published"),10)!==1){return true}else{var r=new Date(),q=p.get("startHour"),n=p.get("startDate"),o=new Date();r.setHours(q.substring(0,2));r.setMinutes(q.substring(3,5));r.setDate(n.substring(8,10));r.setMonth(parseInt(n.substring(5,7),10)-1);r.setYear(n.substring(0,4));return o<r}},_createSurveyOptionStepPanel:function(){var o,p=this.model;this.addControl("surveyEndDatePicker",new i({className:"survey-end-date-picker"}));this.getControl("surveyEndDatePicker").setMinDate(p.getStartDate());this.getControl("surveyEndDatePicker").setDate(new Date(p.get("endDate")));this.addControl("endHourPicker",new k({min:0,max:23,step:1,className:"end-hour",value:(p.get("endHour")?parseInt(p.get("endHour").substring(0,2),10).toString():"")}));this.addControl("endMinutePicker",new k({min:0,max:45,step:15,className:"end-minute",value:(p.get("endHour")?parseInt(p.get("endHour").substring(3,5),10).toString():"")}));this.addControl("surveyStartDatePicker",new i({className:"survey-start-date-picker"}));var n=new Date();this.getControl("surveyStartDatePicker").setMinDate(n);this.getControl("surveyStartDatePicker").setDate(new Date(p.get("startDate")));this.addControl("startHourPicker",new k({min:0,max:23,step:1,className:"start-hour",value:(p.get("startHour")?parseInt(p.get("startHour").substring(0,2),10).toString():"")}));this.addControl("startMinutePicker",new k({min:0,max:45,step:15,className:"start-minute",value:(p.get("startHour")?parseInt(p.get("startHour").substring(3,5),10).toString():"")}));if(parseInt(p.get("published"),10)!==1){this.addControl("surveyResultsCheckbox",new j({type:"checkbox",value:b.Showresultsaftervotes,className:"survey-results-checkbox primary",checked:(p.get("showResultsAfterVote")===true?true:false),attributes:{name:"survey_results"},styles:{"margin-top":"5px","margin-bottom":"5px"}}))}o={"class":"survey-options",styles:{display:(f&&parseInt(p.get("published"),10)===0?"none":"")},html:[(this._canStartDateBeChanged()?{html:[{styles:{"font-weight":"bold"},html:b.Startdate},this.getControl("surveyStartDatePicker"),b.at,this.getControl("startHourPicker"),(f?":":":00"),(f?this.getControl("startMinutePicker"):"")]}:""),{styles:{"margin-top":"20px"},html:[{styles:{"font-weight":"bold"},html:b.Enddate},this.getControl("surveyEndDatePicker"),b.at,this.getControl("endHourPicker"),(f?":":":00"),(f?this.getControl("endMinutePicker"):"")]},(parseInt(p.get("published"),10)!==1?this.getControl("surveyResultsCheckbox"):"")]};return o},_createContent:function(){var n,o=this.model,p=this;if(o){n=h.createElement("div",{"class":"survey-wrapper",html:(f?[(parseInt(o.get("published"),10)!==1?p._createQuestionsStepPanel():""),p._createSurveyOptionStepPanel()]:[p._createSurveyOptionStepPanel(),(parseInt(o.get("published"),10)!==1?p._createQuestionsStepPanel():"")])})}return n},contentChanged:function(){this.dispatchEvent("onContentChange")},getFormattedDate:function(o){var p="",q=o.getMonth()+1,n=o.getDate();if(parseInt(q)<=9){q="0"+q}if(parseInt(n)<=9){n="0"+n}p+=o.getUTCFullYear();p+="-"+(q);p+="-"+n;return p},onSurveyResultsChange:function(n){this.model.addChanges("showResultsAfterVote",n.target.checked,{force:true})},onStartHourChange:function(o){var n=o.target.value,p=parseInt(this.getControl("startMinutePicker").getValue(),10);if(parseInt(n)<=9){n="0"+n}if(parseInt(p)<=9){p="0"+p}this.model.addChanges("startHour",n+":"+p,{force:true})},onEndHourChange:function(o){var n=o.target.value,p=parseInt(this.getControl("endMinutePicker").getValue(),10);if(parseInt(n)<=9){n="0"+n}if(parseInt(p)<=9){p="0"+p}this.model.addChanges("endHour",n+":"+p,{force:true})},onStartMinuteChange:function(o){var p=o.target.value,n=parseInt(this.getControl("startHourPicker").getValue(),10);if(parseInt(n)<=9){n="0"+n}if(parseInt(p)<=9){p="0"+p}this.model.addChanges("startHour",n+":"+p,{force:true})},onEndMinuteChange:function(o){var p=o.target.value,n=parseInt(this.getControl("endHourPicker").getValue(),10);if(parseInt(n)<=9){n="0"+n}if(parseInt(p)<=9){p="0"+p}this.model.addChanges("endHour",n+":"+p,{force:true})},onAddButtonClick:function(){if(this.model.getAssociated("questions").length<30){var r=this,o=this.model.addQuestion({createdQuestion:true,description:"",isActive:true,nb_answer_max:"0",pollId:"",type:"Single"});o.addAnswer({description:"",is_open:"0"});o.addAnswer({description:"",is_open:"0"});o.set("unique_id",(new Date()).getTime());var p=l.replace(b.Question,{questionPosition:o.get("position")}),q=new m.Tab({text:p}),n=this.addChildView("question-"+(o.get("mid")||o.get("unique_id")),{Class:c,model:o,events:{onContentChange:r.contentChanged.bind(r)}});this.getControl("surveyQuestionsList").addTab(q);q.setContent(n);this.getControl("surveyQuestionsList").selectTab(this.getControl("surveyQuestionsList").tabs.length-1);this.model.getAssociated("questions").forEach(function(s,t){s.set("position",t+1);this.getChildView("question-"+(s.get("mid")||s.get("unique_id")))._updateButtons()}.bind(this))}else{this.alert("error",b.Youcannotaddmorethanthirtyquestionsonasurvey)}},onSurveyStartDatePickerChange:function(){var n=this.getControl("surveyStartDatePicker").getDate(this.getControl("surveyStartDatePicker").getDate()+1);n.setDate(n.getDate()+1);this.getControl("surveyEndDatePicker").setMinDate(n);if(this.getControl("surveyEndDatePicker").getDate()<=this.getControl("surveyStartDatePicker").getDate()){var o=this.getControl("surveyStartDatePicker").getDate();o.setDate(o.getDate()+1);this.getControl("surveyEndDatePicker").setDate(o)}this.model.addChanges("startDate",this.getFormattedDate(this.getControl("surveyStartDatePicker").getDate()),{force:true});this.model.addChanges("endDate",this.getFormattedDate(this.getControl("surveyEndDatePicker").getDate()),{force:true})},onSurveyEndDatePickerChange:function(){this.model.addChanges("endDate",this.getFormattedDate(this.getControl("surveyEndDatePicker").getDate()))},validateQuestions:function(){var p=true,n=this.model.getAssociated("questions"),r=null,o=null,q=this.model;if(n.length===0){p=false;this.alert("error",b.PleaseAddAtLeastOneQuestion)}n.forEach(function(s,t){r=this.getChildView("question-"+(s.get("mid")||s.get("unique_id")));o=null;if(r){o=r.getChildView("rte")}if((h.is(s.getChanges("description"))&&s.getChanges("description").stripTags().replace(/&nbsp;/g," ").trim()==="")||(!s.getChanges("description")&&(!s.get("description")||(s.get("description")&&s.get("description").stripTags().replace(/&nbsp;/g," ").trim()==="")))){if(p===true){this.alert("error",l.replace(b.Pleasefillquestionnumber,{questionPosition:s.get("position")}));this.getControl("surveyQuestionsList").selectTab(s.get("position")-1);if(o){o.container.addClassName("validation-error")}if(s.get("type")!=="Open"&&s.get("type")!=="Scale"){r.getChildView("questionConfiguration").getControl("answerEditorCollectionView").getModelViews().forEach(function(u){u.validate()})}}p=false}else{if(o){o.container.removeClassName("validation-error")}}if(s.get("type")!=="Open"&&s.get("type")!=="Scale"){s.getAssociated("answers").forEach(function(w,u){var x=w.getChanges("description"),v=w.get("description");if((!x||/^\s*$/.test(x))&&(!v||/^\s*$/.test(v))){if(p===true){this.alert("error",l.replace(b.Pleasefillanswernumberinquestionnumber,{questionPosition:s.get("position"),answerPosition:s.hasAnOpenAnswerAdded()?u:(u+1)}));this.getControl("surveyQuestionsList").selectTab(s.get("position")-1);this.getChildView("question-"+(s.get("mid")||s.get("unique_id"))).getChildView("questionConfiguration").getControl("answerEditorCollectionView").getModelViews().forEach(function(y){y.validate()})}p=false}},this)}else{if(s.get("type")==="Scale"){if(!s.getChanges("index_max")&&!s.get("index_max")){this.alert("error","Please set the number of steps");p=false}}}},this);return p},validate:function(){var q=true,r=this.model,s=(r.getChanges("endDate")||r.get("endDate")).replace(/-/g,"/"),v=r.getChanges("endHour")||r.get("endHour"),o=(r.getChanges("startDate")||r.get("startDate")).replace(/-/g,"/"),p=r.getChanges("startHour")||r.get("startHour"),t=new Date(s+" "+v+":00").getTime(),n=new Date(o+" "+p+":00").getTime(),u=this.getControl("surveyEndDatePicker");if(parseInt(r.get("published"),10)===1){u.elements.container.removeClassName("field-error");if((t-n)<=0){q=false;if(u){u.elements.container.addClassName("field-error")}this.alert("error",b.EndDateWrong)}return q}else{u.elements.container.removeClassName("field-error");if((t-n)<=0){q=false;if(u){u.elements.container.addClassName("field-error")}this.alert("error",b.EndDateWrong);return q}q=this.validateQuestions()}return q},goToNextStep:function(){this.getElement(".survey-options").show();this.getElement(".questions-configuration").hide()},goToPreviousStep:function(){this.getElement(".survey-options").hide();this.getElement(".questions-configuration").show()}});return a});define("DS/SwymUIComponents/script/feature/community/survey/survey-view",["UWA/Core","DS/SwymUICore/script/feature/community/survey/model/survey-model","DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view"],function(d,c,b){var a=b.extend({_modelClass:c,name:"survey-view",defaultOptions:{iconCls:"clipboard",summaryViewClass:"DS/SwymUIComponents/script/feature/community/survey/view/survey-summary-view",detailedViewClass:"DS/SwymUIComponents/script/feature/community/survey/view/survey-detailed-view",editViewClass:"DS/SwymUIComponents/script/feature/community/survey/edit/survey-edit-view"},_createEditView:function(){var e=this.model,f=null;if(e){e.fetch({fromCache:true});f=this.addChildView("editView",{Class:this.getOption("editViewClass"),model:e,mode:"surveyCreator",iconCls:this.getOption("iconCls")})}return f}});return a});define("DS/SwymUIComponents/script/feature/community/content/view/content-list-view",["UWA/Core","UWA/Array","DS/SwymUICore/script/lib/event-manager","DS/SwymUIComponents/script/feature/core/ui-components/list/item-list","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/lib/model/model-manager","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/community/post/post-view","DS/SwymUIComponents/script/feature/community/media/view/media-view","DS/SwymUIComponents/script/feature/community/question/question-view","DS/SwymUIComponents/script/feature/community/idea/idea-view","DS/SwymUIComponents/script/feature/community/wiki/wiki-view","DS/SwymUIComponents/script/feature/community/survey/survey-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUIComponents/script/feature/community/content/view/content-list-mobile-mixin","DS/UIKIT/Alert","DS/UWPClientCode/I18n","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/view/content-list-view"],function(a,q,t,m,n,e,r,p,k,u,j,s,f,b,o,g,i,h){var l=(window.ds&&window.ds.env==="MOBILE"),d=n.getInstance(),c=m.extend({name:"content-list-view",modelViewClass:{post:p,media:k,iquestion:u,idea:j,survey:f,wiki:s},imageReloadOptions:{size:"xl",optimiseUserPictures:true},defaultOptions:{comments:true,showAnswers:true,realtime:true,mutualizeCommentsInitCalls:true,showAuthorSection:true},_alert:null,modelViewsCfg:function(x){var y=this._parent.apply(this,arguments),w={},v=x.getModelName();if(!this.options){w=a.clone(this.defaultOptions);if(v==="iquestion"){w.comments=false}}else{w.showAnswers=this.getOption("showAnswers");w.comments=v==="iquestion"?false:this.getOption("comments");w.showAuthorSection=this.getOption("showAuthorSection");w.socialToolbarMode=this.getOption("socialToolbarMode")||null}return a.merge(w,y)},domEvents:{"click .content-in-feed-summary-view-container .content-icon":"onItemClick","click .content-in-feed-summary-view-container .content-summary-section":"onItemClick","click .content-in-feed-summary-view-container .validated-answer":"onItemClick","dragstart .content-in-feed-summary-view-container":"onItemDragStart"},itemViewSelector:".content-in-feed-view-container",_communityId:null,_onPublishing:function(y,x){var v=y.getModelName(),C=this.collection,A=this.collection.comparator&&(!x||(x.sort!==false)),w;if(v&&(C.communityId===null||y.getCommunity().get("mid")===C.communityId)){if(C.communityId===null){var z=y.getCommunity(),B=z.get("isBlacklisted");if(B===true){if(!this._alert){this._alert=new g({className:"wp-alert",visible:true}).inject(document.body,"top")}this._alert.add({className:"primary",message:i.replace(h[y.getModelName()+"CreationMessage"],{TitleLink:'<a data-content-type="'+y.getModelName()+'" data-content-id="'+y.get("mid")+'">'+y.get("title")+"</a>"})})}else{if((v==="media"&&(y.get("is_illustration")!==true&&y.get("is_illustration")!=="1"))||(v==="wiki"&&parseInt(y.get("visibility"),10)!==2)||(v!=="media"&&v!=="wiki")){C[A?"add":"unshift"](y)}}}else{if((v==="media"&&(y.get("is_illustration")!==true&&y.get("is_illustration")!=="1"))||(v==="wiki"&&parseInt(y.get("visibility"),10)!==2)||(v!=="media"&&v!=="wiki")){w=a.is(this.collection.model.prototype.getModelName);if(!w||w&&this.collection.model.prototype.getModelName()===v){C[A?"add":"unshift"](y)}}}}},_updateCollection:function(w,v){var x=this,z,y;if(!x.isDestroyed()){x.setCollection(new w([],a.merge({communityId:d.communityId,infiniteScroll:true},x.options.collectionOptions)));z=x.collection;y=a.merge(v?a.extend({},v):{},x.options.fetchOptions||{});b.dispatchEvent("onPageLoadRequest",[z,y]);x.dispatchEvent("onPageLoadRequest",[z,y]);if(window.ds&&window.ds.env==="3DSwym"){d.dispatchEvent("onPageLoad",[],true)}}},updateCollection:function(v){var w=this;if(w.options.collectionClass){w.container.empty();if(typeof w.options.collectionClass==="string"){require([w.options.collectionClass],function(x){w._updateCollection(x,v)})}else{w._updateCollection(w.options.collectionClass,v)}}},onAfterInit:function(){if(this.options.refreshOnCommunityChange){d.removeListener("onCommunityChange",this.onCommunityChange);this.onCommunityChange=this.onCommunityChange.bind(this);d.addListener("onCommunityChange",this.onCommunityChange,this,true)}else{this.updateCollection()}},setup:function(){var v=this;this._parent.apply(this,arguments);this.addEventOnce("onInit",this.onAfterInit,this,-10);if(!this._onPublishingBound){this._onPublishingBound=this._onPublishing.bind(this);e.addListenerOnPublishing(this._onPublishingBound)}this.reactTo(t,"requestContentListUpdate",this.onRequestContentListUpdate);this.reactTo(b,{goToMainWhatsnew:function(){if(this.isVisible()){b.dispatchEvent("onScrollToTopRequest");this.updateCollection({reset:true,remove:true,add:true})}}});if(this.getOption("realtime")){require(["DS/SwymUICore/script/feature/core/realtime/realtime-updates-manager"],function(w){w.addEvent("contentPublished",v._onContentUpdate.bind(v))})}},_onContentUpdate:function(w){var v=this;v._showRealtimeAlertMessage(w)},_getBlacklistedCommunities:function(w){var v=this;require(["DS/SwymUICore/script/feature/community/community/collection/community-collection"],function(x){v._communityCollection=new x([],{mode:"my-communities-detailed",limit:999});v._communityCollection.getmyblacklist({onComplete:function(y){v._blacklistedCommunities=y;v._showRealtimeAlertMessage(w)},onFailure:function(){v._blacklistedCommunities=[];v._showRealtimeAlertMessage(w)}})})},_isInBlacklistedCommunity:function(x){var w=this,v=false;w._blacklistedCommunities.forEach(function(y){if(x.target.id.toString()===y.get("mid").toString()){v=true}});return v},_showRealtimeAlertMessage:function(w){var v=this;require(["DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/UIKIT/Alert"],function(y,x){y.getInstanceFetched(function(z){var A=z.get("login");if(A!==w.author.login){if(!v.realtimeAlert){v.realtimeAlert=new x({visible:true,autoHide:true,hideDelay:5000,icon:"up",events:{onClick:function(B){if(B.target.className.indexOf("close")<0){v.updateCollection();b.dispatchEvent("onScrollToTopRequest")}}},className:"wp-alert alert alert-root cursor-pointer"}).inject(document.body||v.container||window.body,"top")}if(v.isVisible()){if(v.realtimeAlert.getMessages().length===0){v._addRealtimeAlertMessage()}}else{v.removeEvent("onShow",v._addRealtimeAlertMessage,v);v.addEventOnce("onShow",v._addRealtimeAlertMessage,v)}}})})},_addRealtimeAlertMessage:function(){this.realtimeAlert.add({className:"primary",message:h.NewContent})},onRequestContentListUpdate:function(v){if((v.contextPath==="home")&&!this.options.refreshOnCommunityChange){if(this.isVisible()){this.updateCollection()}else{this.addEventOnce("onShow",this.updateCollection)}}},findModelView:function(v){return q.detect(this.getModelViews(),function(w){if(w&&w.model){return w.model.equals(v)}})},onItemSelect:function(){this.goToContent.apply(this,arguments);return this._parent.apply(this,arguments)},goToContent:function(w){var v=w&&w.model;require(["DS/SwymUICore/script/utils/navigation"],function(x){x.goToContent(v.get("mid"),v.getModelName(),v.get("community->mid"))})},onCommunityChange:function(){if(d.isCommunityContext()&&(this._communityId!==d.communityId)){if(this.isVisible()){this._communityId=d.communityId;this.updateCollection()}else{this.addEventOnce("onShow",this.onCommunityChange)}}},destroy:function(){d.removeListener("onCommunityChange",this.onCommunityChange);if(this.collection&&this.collection.clean){this.collection.clean()}if(this._onPublishingBound){e.removeListenerOnPublishing(this._onPublishingBound)}return this._parent.apply(this,arguments)}});if(l){c=c.extend(o)}return c});define("DS/SwymUIComponents/script/feature/core/user/view/macro/user-app-view",["UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/core/user/view/macro/user-app-view","DS/W3DXComponents/IdCard","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUIComponents/script/feature/core/user/view/uploadPicture-view","DS/SwymUIComponents/script/feature/core/network/view/invitation-layer-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/utils/navigation","DS/PubSub/PubSub","DS/SwymUIComponents/script/feature/core/user/view/edit-all-bar/edit-all-bar","DS/SwymUICore/script/utils/i18n","DS/SwymUIComponents/script/feature/core/user/view/idcard/user-idcard-bottom-bar","DS/SwymUIComponents/script/feature/core/user/view/macro/user-column-details-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/community/content/view/content-list-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-definition","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/WebappsUtils/WebappsUtils"],function(c,n,v,b,g,y,e,u,o,d,i,s,t,w,q,r,h,p,a,f){var m=q.extend({attributes:{id:"facet-target-1","class":"col-lg-9 col-md-9 col-sm-8 col-xs-12"}}),l=q.extend({attributes:{id:"facet-target-2","class":"col-lg-9 col-md-9 col-sm-8 col-xs-12"}}),k=q.extend({attributes:{id:"facet-target-3","class":"facet-profile"}}),j=q.extend({attributes:{id:"facet-target-4","class":"facet-profile"}});var x=b.extend({name:"user-app-view",_modelClass:g,_facetInstanciated:[false,false,false,false],_idCardInstance:null,_invitationStatus:null,_updateTopBar:function(){if(window.ds&&window.ds.env!=="3DD"){require(["DS/TopBar/TopBar","DS/SwymUICore/script/feature/core/user/model/currentuser-model","i18n!DS/SwymUIComponents/assets/nls/feature/core/tenant/view/super-user-button-view"],function(B,A,z){if(B){A.getInstanceFetched(function(C){var D="";if(this.model){if(C.get("login")===this.model.get("login")&&C.get("tenant_su")==="1"){D=z.Browsingallcontent}try{B.set({userName:this.model.getNickname().unescapeHTML()+D})}catch(E){console.error(E)}}}.bind(this))}}.bind(this))}},_onPeopleTabChange:function(B){var A=this.getIdCardInstance(),z=parseInt(B.tabNumber,10)||0;if(A.container&&A.getSelectedFacet()!==z){A.selectFacet(z)}},onSetInstanceTagsRequest:function(z){var A,C=r.getInstance(),E,D="";if(this.isVisible()&&this.options&&this.options.taggingContextManager&&z&&z._collectionName!=="user-collection"){A=p.parseRoute(C.getLayoutPath()).route;if((window.ds&&window.ds.env!=="3DSwym")||A.startsWith("people")){this.proxyManager=null;E=this.options.taggingContextManager.getActiveProxiesManagers();for(var B in E){if(E.hasOwnProperty(B)&&B.startsWith("people")){D=B;this.proxyManager=E[B];break}}if(!this.proxyManager){this.proxyManager=this.options.taggingContextManager.isProxyManager(D||A)}if(!this.proxyManager){this.proxyManager=this.options.taggingContextManager.createProxyManager(D||A,{persistTags:!C.isContentEditionContext(),client:z})}else{this.proxyManager.setClient(z)}}}},init:function(){this._onPeopleTabChange=this._onPeopleTabChange.bind(this);return this._parent.apply(this,arguments)},setup:function(z){if(this.model.isCurrentUser()===true){this.listenTo(this.model,{onPassportSynced:this._updateTopBar});this._updateTopBar()}this.reactTo(a,{onSetInstanceTagsRequest:this.onSetInstanceTagsRequest});this.context=r.getInstance();this.context.addListener("onPeopleTabChange",this._onPeopleTabChange,this,true);z=z||{};return this._parent.apply(this,arguments)},domEvents:{"click .facets-list .facet:nth-child(1)":"clickFirstFacet","click .facets-list .facet:nth-child(2)":"clickSecondFacet","click .facets-list .facet:nth-child(3)":"clickThirdFacet","click .facets-list .facet:nth-child(4)":"clickFourthFacet"},clickFirstFacet:function(){var z=r.getInstance();if(z.getPathFromUrl()!==this.model.getRelativePath()){o.goToUrl(this.model.getRelativePath())}},clickSecondFacet:function(){var z=r.getInstance();if(z.getPathFromUrl()!==this.model.getRelativePathToActivities()){o.goToUrl(this.model.getRelativePathToActivities())}},clickThirdFacet:function(){var z=r.getInstance();if(z.getPathFromUrl()!==this.model.getRelativePathToConnections()){o.goToUrl(this.model.getRelativePathToConnections())}},clickFourthFacet:function(){var z=r.getInstance();if(z.getPathFromUrl()!==this.model.getRelativePathToSettings()){o.goToUrl(this.model.getRelativePathToSettings())}},_createContent:function(){this._idCardInstance=this.getIdCardInstance();this._facetInstanciated=[false,false,false,false];return[{html:this.addControl("idcard",this._idCardInstance)},{id:"facet-target-1-and-2","class":"facet-profile row",styles:{"padding-top":"10px"},html:[{id:"facet-fixed-column","class":"col-lg-3 col-md-3 col-sm-4 col-xs-12"},this.addChildView("facet-target-1",new m()),this.addChildView("facet-target-2",new l())]},this.addChildView("facet-target-3",new k()),this.addChildView("facet-target-4",new j())]},displayView:function(B){var D,A=this.getElement("#facet-target-1-and-2");for(var C=1,z=5;C<z;C++){D=this.getChildView("facet-target-"+C);if(!D){throw new Error("Facet view not found")}else{if(C!==B){D.hide()}else{D.show()}}}if(B>2){A.hide()}else{A.show()}if(A){if(B===1){A.addClassName("first-tab-selected")}else{A.removeClassName("first-tab-selected")}}if(B!==2){i.hide()}},getIdCardInstance:function(){if(this._idCardInstance!==null){return this._idCardInstance}else{return this.buildIdCard()}},buildIdCard:function(){var z=this,A=this.model.isCurrentUser()===true&&u.getInstance().get("config").tenant.block_userpicture_upload===false;return new v({model:this.model,attributesMapping:{title:function(){var B=(this.get("login")&&this.isCurrentUser()===true)?(" - "+this.get("login")):"",C="";if(this.get("ut_state")==2){C="("+n.get("hasNoAccessTo3DSwymAnymore")+")"}else{if(this.get("ut_state")==3){C="("+n.get("wasRemoved")+")"}}return this.getNickname()+B+" "+C},description:function(){var E=this.get("job_title")||"",D=this.get("company")||"",G=this.get("city")||"",F=this.get("country")||"",C="",B="";if(E!==""){C=E+" - "+D}else{C=D}if(G){B="("+G+", "+F+")"}else{if(F){B="("+F+")"}}return c.unescapeHTML(C+" "+B)}},bannerUrl:function(){return f.getWebappsBaseUrl()+"SwymUIComponents/assets/profile/ProfileBanner.jpg"},thumbnail:{url:g.constructUserPictureUrl(this.model.get("login"),this.model.get("user_picture_fingerprint")),squareFormat:true,alwaysEditable:A},editableElements:[(A?"thumbnail":""),"title"],editView:"DS/SwymUIComponents/script/feature/core/user/view/idcard/user-idcard-edit-view",actions:function(){var B=[];if(this.model){if(this._invitationStatus&&!this.model.isCurrentUser()){if(this._invitationStatus.user_in_network=="0"){if(this._invitationStatus.connected_user_to_user=="new"){B=[{text:n.pendinginvitation,icon:"user-add",handler:function(){this.alert("info",n.alreadySentInvitation)}.bind(this)}]}else{if(this.model.get("ds_user")!=="5"){B=[{text:n.addToYourConnections,icon:"user-add",handler:function(){var D=new e({model:this.model}),C=function(){this._invitationAlreadySent=true}.bind(this);if(this._invitationAlreadySent!==true){D.launch(C)}else{this.alert("info",n.alreadySentInvitation)}}.bind(this)}]}}}}if(this.model.isCurrentUser()&&(this.model.isEditableByPassport("first_name")||this.model.isEditableByPassport("last_name"))){B.push({text:n.updateyourprofileinfo,icon:"pencil",handler:function(){var C=this.getIdCardInstance();if(C){C.switchToEditMode()}}.bind(this)})}return B}}.bind(this),facets:function(){var B=[{text:n.OverView,icon:"home",handler:function(){this.displayDefaultFacet();if(this.options.taggingContextManager){this.options.taggingContextManager.setProxyManagerAsCurrent(o.USER_PROFILE+"/"+o.PEOPLE_ABOUTME)}}.bind(z)},{text:n.About,icon:"user",handler:function(){if(!this._facetInstanciated[1]){this.instantiateFacetTwo();this._facetInstanciated[1]=true}if(!this._facetInstanciated[9]){this.instantiateFixedColumn();this._facetInstanciated[9]=true}this.displayView(2);if(this.options.taggingContextManager){this.options.taggingContextManager.setProxyManagerAsCurrent(o.USER_PROFILE+"/"+o.PEOPLE_ACTIVITIES)}a.dispatchEvent("onSetInstanceTagsRequest",[z.model])}.bind(z)}];if(u.getInstance().isFeatureActivated("activate_user_network")){B.push({text:n.Network,icon:"users",handler:function(){if(!this._facetInstanciated[2]){this.instantiateFacetThree();this._facetInstanciated[2]=true}this.displayView(3);if(this.options.taggingContextManager){this.options.taggingContextManager.setProxyManagerAsCurrent(o.USER_PROFILE+"/"+o.PEOPLE_CONNECTIONS)}}.bind(z)})}if(this.isCurrentUser()){B.push({text:n.ProfileManagement,icon:"cog",handler:function(){if(!this._facetInstanciated[3]){this.instantiateFacetFour();this._facetInstanciated[3]=true}this.displayView(4);if(this.options.taggingContextManager){this.options.taggingContextManager.setProxyManagerAsCurrent(o.USER_PROFILE+"/"+o.PEOPLE_SETTINGS)}}.bind(z)})}return B},events:{onSwitchToEditMode:function(B){var C=this.getChildView("bottom-bar");if(!C){C=this.addChildView("bottom-bar",new t({idcardInstance:B}));C.render(B.container)}else{C.show()}}.bind(this),onSwitchToViewMode:function(){var B=this.getChildView("bottom-bar");if(B){B.hide()}}.bind(this),onFacetSelect:function(){this.dispatchEvent("onFacetSelect",arguments)}.bind(this),onThumbnailChangeRequest:function(){var D=new y({widget:this._widget,model:this.model}),C=this.getControl("idcard"),B,E=function(){if(C){B=C.getElement(".thumbnail");var F=B.getStyle("background-image");if(B){B.setStyle("background-image",F.replace("update/","update/7"))}}if(window.ds&&window.ds.env!=="3DD"){require(["DS/TopBar/TopBar"],function(H){try{H.set({picture:g.constructUserPictureUrl(z.model.get("login"),Math.random())})}catch(G){console.error(G)}})}};D.launch(E)}.bind(this)}})},displayDefaultFacet:function(){if(!this._facetInstanciated[0]){this.instantiateFacetOne();this._facetInstanciated[0]=true}if(!this._facetInstanciated[9]){this.instantiateFixedColumn();this._facetInstanciated[9]=true}this.displayView(1)},instantiateFixedColumn:function(){var z=this.addChildView("left-column",{Class:w,model:this.model});console.log("trying to render fixed column");z.render(this.getElement("#facet-fixed-column"))},instantiateFacetOne:function(){if(!this.isDestroyed()){var A=h.extend({_createContent:function(){var D=this.getModelViews(),E;for(var C=0,B=D.length;C<B;C++){E=D[C];E.container.setStyle("opacity","0")}return this._parent.apply(this,arguments)},onItemSelect:function(){return this._parent.apply(this,arguments)}});var z=new A({widget:this._widget,useDynamicGrid:true,dynamicGridOptions:{layout:"medium",variableSizeItem:true,itemSelector:".content-in-feed-view-container"},collectionClass:"DS/SwymUICore/script/lib/collection/mixed-collection",collectionOptions:{mode:"whats-new",limit:8,hash_key:this.model.get("hash_key"),fetchTagsSeparatelyOnRefresh:true}});z.render(this.getElement("#facet-target-1"));this.getChildView("facet-target-1").addChildView("activitiesView",z)}},instantiateFacetTwo:function(){require(["DS/SwymUIComponents/script/feature/core/user/view/macro/user-aboutme-view"],function(A){if(!this.isDestroyed()){var z=new A({model:this.model,widget:this._widget});z.render(this.getElement("#facet-target-2"));this.getChildView("facet-target-2").addChildView("userView",z)}}.bind(this))},instantiateFacetThree:function(){require(["DS/SwymUIComponents/script/feature/core/user/view/macro/user-connections-view"],function(z){if(!this.isDestroyed()){var A=new z({model:this.model,widget:this._widget});A.render(this.getElement("#facet-target-3"));this.getChildView("facet-target-3").addChildView("connectionsView",A)}}.bind(this))},instantiateFacetFour:function(){require(["DS/SwymUIComponents/script/feature/core/user/view/macro/user-settings-view"],function(A){if(!this.isDestroyed()){var z=new A({model:this.model,widget:this._widget});z.render(this.getElement("#facet-target-4"));this.getChildView("facet-target-4").addChildView("settingsView",z)}}.bind(this))},onSetModel:function(B,C,A){var z=this;if(!A.isCurrentUser()){this._invitationStatus=null;A.getInvitationStatus({onComplete:function(E,D){z._invitationStatus=D.result;if(z._idCardInstance){z._idCardInstance.render()}}})}},destroy:function(){this.context.removeListener("onPeopleTabChange",this._onPeopleTabChange);return this._parent.apply(this,arguments)}});return x});define("DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-highlight-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/core/ui-components/list/list-item/item-view","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUIComponents/script/feature/core/ui-components/list/item-list","DS/SwymUIComponents/script/feature/community/content/view/content-list-view","DS/SwymUICore/script/utils/utils","DS/SwymUICore/script/lib/model/generic/swym-model"],function(j,g,h,e,k,f,b,m,i,l){var d=["ActionMenuClass","iconCls"],a=k.getInstance(),c=e.extend({name:"item-highlight-view",itemViewSelector:".content-in-feed-view-container",defaultOptions:{summaryViewClass:"DS/SwymUIComponents/script/feature/community/content/view/content-highlight-view",comments:false,showAnswers:false},onItemClick:function(){var n=this.model;require(["DS/SwymUICore/script/utils/navigation"],function(o){o.goToContent(n.get("mid"),n.getModelName(),n.get("community->mid"))})},_onContentHighlightedUpdate:function(){var o=this.communityModel.get("highlighted_content_uri"),n="";this.communityModel.isContentHighlightHidden({onComplete:function(q,p){if(p){o=""}if(o){n=i.extractDataFromSubject6wURI(o);if(!this.model||(this.model&&this.model.get("mid")!==n.extraAttrs.mid)){require([l.getModuleNameFromModelName(n.modelName,n.modelAMDModuleRoot)],function(r){this.model=new r({mid:n.extraAttrs.mid});this.setOption("iconCls",i.getIconFromModel(this.model));this.model.fetch({fromCache:true,onComplete:function(){this.onContextChange();this.refresh()}.bind(this)})}.bind(this))}}else{this.model=null;this.hide()}}.bind(this)})},_onContentHighlightMaskUpdate:function(){},onShow:function(){if(!this.model){this.hide()}},onCommunityChange:function(n){if(n.communityId){this.communityModel=new f({mid:n.communityId});this.listenTo(this.communityModel,{"onSync:read":this._onContentHighlightedUpdate,"onSync:update":this._onContentHighlightedUpdate,"onSync:contentHighlightMask":this._onContentHighlightMaskUpdate});this._onContentHighlightedUpdate()}},onFilteringChange:function(n){if(this.communityModel){if(a.communityId===this.communityModel.get("mid")){this._filteringActive=n;if(n){this.hide()}else{this.show()}}}},onContextChange:function(){if(a.isCommunityHomePageContext()){this.show()}else{this.hide()}},hide:function(){this.container&&this.container.addClassName("hidden");this._parent()},show:function(){this.container&&this.container.removeClassName("hidden");this._parent()},init:function(){var n=this;n._parent.apply(n,arguments);this.onCommunityChange=this.onCommunityChange.bind(this);a.addListener("onCommunityChange",this.onCommunityChange,this,true);this.onFilteringChange=this.onFilteringChange.bind(this);a.addListener("onFilteringChange",this.onFilteringChange,this,true);this.onContextChange=this.onContextChange.bind(this);a.addListener("onContextChange",this.onContextChange,this,true)},createDummyView:function(n){var o=h.extend({name:"dummy-view"});return new o(n)},destroy:function(){a.removeListener("onContextChange",this.onContextChange);a.removeListener("onFilteringChange",this.onFilteringChange);a.removeListener("onCommunityChange",this.onCommunityChange);return this._parent.apply(this,arguments)}});c.implement({_onResize:m.prototype._onResize,domEvents:m.prototype.domEvents,onItemDragStart:b.prototype.onItemDragStart,onItemDrag:b.prototype.onItemDrag});return c});define("DS/SwymUIComponents/script/feature/community/survey/edit/survey-creator-view",["UWA/String","UWA/Core","DS/SwymUIComponents/script/feature/community/content/edit/abstract-content-editor-body-view","DS/SwymUIComponents/script/feature/community/survey/view/survey-editor-view","DS/SwymUICore/script/feature/community/survey/model/survey-model","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/edit/survey-creator-view"],function(d,g,b,c,f,e){var a=b.extend({name:"survey-editor-body-view",_modelEvents:{onVirtualChange:"contentChanged"},_createContent:function(){var h=[{"class":"survey-creator-minimized",html:e.Startyoursurvey},this.getChildView("survey-editor")];return h},setup:function(){var j=this;if(!this.model||!this.model.get("mid")){if(this.model&&this.model.getModelName()==="survey"){var h=this.model.get("options"),i,k;if(h&&h.hasOwnProperty("questions")){for(i in h.questions){if(h.questions.hasOwnProperty(i)){k=h.questions[i]}this.model.addQuestion(k)}}}else{this.model=new f()}}this.addChildView("survey-editor",{Class:c,model:this.model,events:{onContentChange:j.contentChanged.bind(j)}});return this._parent.apply(this,arguments)},contentChanged:function(){this.dispatchEvent("onContentChange")},isContentEmpty:function(){var h=this.getContentAttributes();console.log("content for debug survey creator view",h);if(h.hasOwnProperty("questions")&&h.questions.length===0||(h.questions.hasOwnProperty("0")&&h.questions["0"].hasOwnProperty("answers")&&h.questions["0"].hasOwnProperty("description")&&d.unescapeHTML(h.questions["0"]["description"])===""&&h.questions["0"]["answers"].hasOwnProperty("0")&&h.questions["0"]["answers"].hasOwnProperty("1")&&h.questions.length===1&&h.questions["0"].answers.length===2)){return true}return false},validateContent:function(i){var h=this.getChildView("survey-editor");if(h&&i&&i.publish){return(h.validate()===true)}return false},validateFirstStepContent:function(){var h=this.getChildView("survey-editor");if(h){return(h.validateQuestions()===true)}return false},goToNextStep:function(){var h=this.getChildView("survey-editor");if(h){h.goToNextStep()}},goToPreviousStep:function(){var h=this.getChildView("survey-editor");if(h){h.goToPreviousStep()}},resetContent:function(){var h=this.getChildView("survey-editor");this.model.getAssociated("questions").reset([]);if(h){h.refresh()}},refreshContent:function(){},getContentAttributes:function(){var h,j=this.getChildView("survey-editor"),i=j.getChildViews(),k=g.merge({},this.model.getChanges());k.questions=[];this.model.getAssociated("questions").forEach(function(l){var m=l.toJSON();g.extend(m,l.getChanges());m.answers=[];for(h in i){if(l===j.getChildView(h).model){m.description=j.getChildView(h).getRTEView().getContentAttributes().content}}l.getAssociated("answers").forEach(function(o){var n=o.toJSON();g.extend(n,o.getChanges());this.answers.push(n)}.bind(m));this.questions.push(m)}.bind(k));delete k.title;return k},getMediaCollectionLength:function(){var k=0,j=this.getChildView("survey-editor"),i=j.getChildViews(),h;for(h in i){k+=j.getChildView(h).getRTEView().getMediaCollectionLength()}return k},getMediaCollection:function(){},uploadMedia:function(j){var l=this.getChildView("survey-editor"),i=l.getChildViews(),h,k=[],m=function(n){return new Promise(function(p,o){l.getChildView(n).getRTEView().uploadMedia({communityId:j.communityId,onUploadsComplete:function(){p()},onUploadsFailure:function(){o()}})})};for(h in i){if(l.getChildView(h).getRTEView().getMediaCollectionLength()>0){k.push(m(h))}}Promise.all(k).then(function(){j.onUploadsComplete()},function(n){j.onUploadsFailure(n)})},addMedia:function(k){var j=this.getChildView("survey-editor"),i=j.getChildViews(),h;for(h in i){j.getChildView(h).getRTEView().addMedia(k)}}});return a});define("DS/SwymUIComponents/script/feature/core/rich-tooltip/view/rich-tooltip-view",["DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/content/view/media-thumbnail-view","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/feature/community/community/view/community-signup-request-view","DS/SwymUIComponents/script/feature/core/user/view/author-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/community/view/community-signup-request-view"],function(j,f,k,i,a,c,g,b,m,h){var e=null;function o(p){var q;if(e&&e.model&&e.model.equals(p)){e.show()}else{q=new g({model:p});q.render(document.body).show();if(e&&!e.isDestroyed()){e.destroy()}e=q}}var l=f.extend({_modelClass:a,_modelEventsForAutoRefresh:["onChange"],name:"rtt-community-infos-summary-view",_createContent:function(){var r=this.model,p=r.get("content_update"),t=(r.get("update")>p)?r.get("update"):p,q=r.getVisibility(),s=r.hasCurrentUserAccess();return[this.addChildView("communityLogo",{Class:k,model:r,imageRenderingOptions:{isLink:true}}),{html:[{"class":"object-title dsi-communitylist-title"+((s===false)?"-noaccess":""),html:{tag:"a","class":"link","data-content-type":"community","data-content-id":r.get("mid"),html:r.get("title")}},(r.get("owner")?{"class":"detail",html:[{tag:"span",html:m.OwnedBy+" "},(r.getAssociated("owner").get("nickname")||"")]}:""),(t)?{"class":"detail",html:[{tag:"span",html:m.LastUpdate+" "},c.prettyDate(t)]}:"",(q&&q!=="Unknown")?{"class":"detail",html:[{tag:"span",html:m.Visibility+" "},q]}:""]}]}}),n=f.extend({_modelClass:a,_modelEventsForAutoRefresh:["onChange"],name:"rtt-community-description-view",domEvents:{"click button.btn":"requestCommunityAccess","click .description.detail":"goToCommunity"},goToCommunity:function(){var p=this.model;require(["DS/SwymUICore/script/utils/navigation"],function(q){q.goToCommunity(p.get("mid"))})},_createContent:function(){var p=this.model,r=p.hasCurrentUserAccess(),q=p.get("description"),s=j.getInstance().isFeatureActivated("activate_community_join_request");return(q||(r===false)?[q?{"class":"detail description",html:q}:"",(r===false&&s===true)?{"class":"border-top community-access-request-btn",styles:{"text-align":"center"},html:{tag:"button","class":"btn btn-primary",styles:{"font-size":"12px"},html:h.RequestAccessToThisCommunity}}:""]:"")},requestCommunityAccess:function(){o(this.model)}}),d=f.extend({_modelClass:[i,a],_displayRichTooltips:false,name:"rich-tooltip-view",defaultOptions:{contactsLimit:8},imageReloadOptions:{size:"m"},_createContent:function(){var q=this.model,p=q.getModelName();return[this.addChildView("topView",{className:"rich-tooltip-top flex-display",Class:((p==="user")?b:l),model:q,userInfosResponsivenessCls:"col-xs-12"}),(p!=="user"||q.get("login"))?this.addChildView("bottomView",{className:"rich-tooltip-bottom",Class:(p==="user")?"DS/SwymUIComponents/script/feature/core/user/view/shared-contacts-small-view":n,model:q,showBorder:false,limit:this.options.contactsLimit,tooltipOptions:{className:"rich-tooltip-inner-tooltip"}}):{}]}});return d});define("DS/SwymUIComponents/script/feature/core/rich-tooltip/rich-tooltip",["UWA/Core","DS/UIKIT/Popover","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/core/rich-tooltip/view/rich-tooltip-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/RTAudioVideoAPI/RTAudioVideoAPI","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/direct-message/direct-messages"],function(h,d,i,b,m,l,k,a){var g=700,e=100,j=1000,f=d.extend({_destroyed:false,defaultOptions:{className:"rich-tooltip flex-display",position:"bottom",closeOnClick:true,autoHideOnClickOutside:false,animate:true,trigger:"",delay:{show:g,hide:e}},timeout:null,_enter:function(n){var o=this;return function(){var q=(n===undefined)?"toggle":(n?"show":"hide"),p=o.options.delay&&((n===undefined&&!o.isVisible||n===true)?o.options.delay.show:o.options.delay.hide);if(o.timeout){clearTimeout(o.timeout)}if(p){o.timeout=setTimeout(function(){if(o._destroyed!==true){o[q]()}},p)}else{o[q]()}}},_hideIfTargetIsAbsentFromPage:function(){if(this.options&&!h.extendElement(this.options.target).isInjected(document.body)){this.hide()}},init:function(n){if(!n.viewOptions){throw new Error("Missing arguments")}if(n.timeout){this.timeout=n.timeout}n.body=this.innerView=new b(n.viewOptions);n.target.addClassName("rich-tooltip-target");this.destroy=this.destroy.bind(this);return this._parent.call(this,n)},buildSkeleton:function(o){var n=this._parent.call(this,o);this.innerView.container.addEvent("resize",i.getDelayedSyncTask(this.updatePosition.bind(this),2000));return n},getCoordinatesForPosition:function(p){var q=this.options,t=q.offset,n=q.target.getPosition(document.body),s=q.target.getSize(),r=this.elements.container.getSize(),o=p;if(o.split(" ").length>1){o=p.indexOf("top")>-1?["top"]:["bottom"];o.push(p.indexOf("left")>-1?"left":"right");o=o[0]+" "+o.join("-")}if(/-right/.test(o)){n.x+=s.width-r.width}else{if(/(top|bottom)$/.test(o)){n.x+=s.width/2-r.width/2}}if(/bottom/.test(o)){n.y+=s.height}else{if(/^(left|right)$/.test(o)){n.x-=r.width;n.y+=s.height/2-r.height/2;if(o==="right"){n.x+=s.width+r.width}}else{n.y-=r.height}}return{left:Math.round(n.x+t.x+parseInt(q.target.getStyle("marginLeft"),10)),top:Math.round(n.y+t.y+parseInt(q.target.getStyle("marginTop"),10))}},updatePosition:function(){if(!this.isVisible||!this.options){return}this._hideIfTargetIsAbsentFromPage();var D=this.options,o=this.elements,v=D.target,r,B,s=false,y=false,u={},A={},x,z,w,n,C,t,q;if(D.target){if(!this._position){this._position=D.position}r=o.container.offsetWidth;B=o.container.offsetHeight;u.offsets=v.getOffsets();u.viewportWidth=document.documentElement.clientWidth||window.innerWidth;u.viewportHeight=document.documentElement.clientHeight||window.innerHeight;u.scrollTop=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;u.offsets.y+=v.offsetHeight;s=u.offsets.x;y=u.offsets.y;if(this.defaultOptions.position==="top"){w="top";n="bottom"}else{w="bottom";n="top"}q=this.getCoordinatesForPosition(w);C=(q.left>=0);t=(u.viewportWidth-(q.left+r))>=0;A={bottom:(u.viewportHeight+u.scrollTop)-(y+B),top:y-(B+v.offsetHeight),right:u.viewportWidth-(s+r),left:(s+v.offsetWidth)-r};if(C&&t){if(A[w]>=10){z=w}else{if(A[n]>=10){z=n}}}if(!z){if(A.right>=10){z="right"}else{if(A.left>=10){z="left"}}}if(!z){for(var p in A){if(A.hasOwnProperty(p)){if(!x||(A[x]<A[p])){x=p}}}z=x}if(this._position!==z){this.elements.container.removeClassName(this._position);this.elements.container.addClassName(z);this._position=z}this.elements.container.setStyles(z===w?q:this.getCoordinatesForPosition(z));return this}return this._parent.apply(this,arguments)},handleEvents:function(){var n=this.options.target;if(!this.events&&n){if(this.options.closeOnClick===true){this.events={mouseover:this._enter(true),mouseout:this._enter(false),click:this._enter(false)}}else{this.events={mouseover:this._enter(true),mouseout:this._enter(false)}}n.addEvents(this.events);this.elements.container.addEvents(this.events)}},onShow:function(){window.document.body.addEvent("click",this.destroy)},onHide:function(){window.document.body.removeEvent("click",this.destroy);var n=this;if(this.timeout){clearTimeout(this.timeout)}this.timeout=setTimeout(function(){n.destroy()},h.is(this.options.delay&&this.options.delay.destroy,"number")?this.options.delay.destroy:j)},destroy:function(){if(this._destroyed===false){this._destroyed=true;this.options.target.removeClassName("rich-tooltip-target");this.innerView.destroy();this.innerView=null;this._parent.apply(this,arguments)}}});f.SHOW_DELAY=g;f.HIDE_DELAY=e;f.DESTROY_DELAY=j;var c=function(o){function p(q){require(["DS/SwymUICore/script/feature/core/direct-message/model/direct-message-model","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/lib/model/model-manager","DS/UWPClientControls/PlatformNotify"],function(t,u,r,s){var v;if(Array.isArray(q)&&(q.length>1)&&(q.length<=(t.MAX_NB_USERS_IN_DM))){v=new t();v.addChanges({users:q});v.save({},{onComplete:function(w){u.goToDM(w.get("mid"));w=new t(w.toJSON());r.notify("onCreate",w)},onFailure:function(x,w){if(w&&w.result&&w.result.id){u.goToDM(w.result.id);r.notify("onCreate",new t(w.result))}else{s.error(a.AnErrorOccurred)}}})}})}var n={addIMSpecificOverrides:function(){o.implement({buildSkeleton:function(v){var s=this.innerView&&this.innerView.model;if(!s||(s.getModelName()!=="user")){return this._previous.apply(this,arguments)}var r=s&&s.get("login"),w=m.getInstance(),x=w.get("config").tenant,u=w.get("user").login,q=this._previous(v),t=h.createElement("div",{"class":"dm",html:{tag:"span","class":"fonticon fonticon-comment"},events:{click:function(){p([r,u])}}});if(r&&!s.isAnonymized()){if((r!==u)&&(s.get("ut_state")!=2)&&(s.get("ut_state")!=3)){this._rtAudioVideoApi=new l({logins:[r],tenantId:x.id,size:"15px",svgIcon:false});h.createElement("div",{"class":"rt-options",html:[{"class":"audio"},{"class":"video"},t]}).inject(this.innerView.container.getElement(".rich-tooltip-top"),"after");this._rtAudioVideoApi.renderTo({container:this.innerView.container.getElement(".rt-options .audio"),type:"audio"});this._rtAudioVideoApi.renderTo({container:this.innerView.container.getElement(".rt-options .video"),type:"video"})}}this.innerView.addControl("conversationTooltip",new k({target:t,body:a.get("StartAConversation")}));return q},destroy:function(){if(this._destroyed===false){this._rtAudioVideoApi&&this._rtAudioVideoApi.destroy()}this._previous.apply(this,arguments)}})}};return n};c(f).addIMSpecificOverrides();return f});define("DS/SwymUIComponents/script/feature/core/rich-tooltip/rich-tooltip-factory",["UWA/Core","UWA/Event","UWA/Class/Events","i18n!DS/SwymUICore/assets/nls/feature/core/user/model/user-model","DS/SwymUICore/script/utils/navigation","DS/SwymUICore/script/feature/core/user/model/user-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUIComponents/script/feature/core/rich-tooltip/rich-tooltip","DS/SwymUICore/script/feature/core/user/model/currentuser-model"],function(a,B,q,s,o,g,b,k,c){var z=(window.ds&&ds.env==="3DD"),A=window.ds&&(window.ds.env==="MOBILE"),e=A?"mousedown ":"mouseover ",u=".no-community-rich-tooltip",n=".no-rich-tooltip",m=".rich-tooltip-target",j={user:z?(o.URLPART_PEOPLE_IN_3DD):o.URLPART_PEOPLE,community:o.URLPART_COMMUNITY},f={user:'a[href*="'+j.user+'"]:not([target="_blank"]):not('+m+"):not("+n+")"},x={user:'[data-login]:not([data-login^="_ANONYMISED_"]):not('+m+"):not("+n+")",community:"[data-content-type=community]:not("+m+"):not("+n+"):not("+u+")"},w={user:e+f.user},v={user:e+x.user,community:e+x.community},d={user:"data-login",community:"data-content-id"},p=k.SHOW_DELAY;function t(C){c.getInstanceFetched(function(){if(C.showTooltip!==false&&!C.target.hasClassName("dragged")){var D=new k({target:C.target,timeout:C.timeout,viewOptions:{model:C.model}});if(C.showTooltip!==false&&a.extendElement(C.target).isInjected(document.body)){D.show()}else{D.destroy()}}if(C.callback){C.callback()}})}function i(M,H){M.stopPropagation();var L=null,J=null,F=null,E=null,G=M._uwaTarget,I={},C=m+", "+n;function N(){G.removeEvent("mouseout",D);window.document.body.removeEvent("mousedown",K)}function D(P,Q){var O=P&&(P.type==="mouseout")&&P.relatedTarget;if((Q!==true)&&O&&(O!==G)&&(G.contains(O))){return null}clearTimeout(J);I.showTooltip=false;N()}function K(O){return D(O,true)}if(true){switch(H){case"community":C+=(", "+u);case"user":F="login";E=d[H];L=G.getAttribute(E);if(!L&&(E!=="data-hash-key")){F="hash_key";L=G.dataset.hashKey}break;default:break}if(L&&!G.getParent(C)&&G.dataset.login!=="anonymous"){G.addEvent("mouseout",D);window.document.body.addEvent("mousedown",K);I.target=G;I.callback=N;J=setTimeout(function(){var Q,P,O;if(H==="community"){Q=b;O={mid:L}}else{Q=g;O={};O[F]=L}if(G.dataset.login==="anonymous"){P=new Q({nickname:G.innerText,ut_state:"9"})}else{P=new Q(O,{autoPopulate:true,data:{as_admin:(a.is(G)?(G.getAttribute("data-as-admin")==="true"?true:null):null)},onFailure:function(R,S){if(S.errorcode&&S.errorcode==="ERROR_USER_NOT_FOUND"){R.set("nickname",s.anonymizedUser)}}})}I.model=P;I.timeout=J;t(I)},p)}else{return null}}}function y(C){i(C,"user")}function l(C){if(C.target.dataset.contentType!=="person"){i(C,"community")}}function h(E,C){a.extendElement(window.document.body);var D={},F=(C.view&&C.view.container)||(C.widget&&C.widget.body)||C.domElt;if(!F){throw new Error("Invalid arguments")}D[w.user]=D[v.user]=y;D[v.community]=l;if(E===true){a.extendElement(F).addEvents(D)}else{a.extendElement(F).removeEvents(D)}}var r=q.singleton({activateTooltipDisplay:function(C){return h(true,C)},deactivateTooltipDisplay:function(C){return h(false,C)}}).init();return r});define("DS/SwymUIComponents/script/feature/community/question/social-interactions/answer-detailed-view",["UWA/Core","UWA/Utils/Client","DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-view","DS/SwymUICore/script/feature/community/iquestion/model/iq-answer-model","DS/SwymUICore/script/feature/community/iquestion/model/iqa-comment-model","DS/SwymUICore/script/feature/community/comment/collection/comment-collection","DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-collection-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-editor-view","DS/SwymUIComponents/script/feature/community/content/view/content-small-view-factory","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/SwymUIComponents/script/feature/community/content/social-interactions/social-toolbar-view","DS/SwymUICore/script/utils/date","DS/SwymUIComponents/script/feature/core/ui-components/tooltip/responsive-button-tooltip","DS/UIKIT/Input/Button","DS/UIKIT/Mask","i18n!DS/SwymUIComponents/assets/nls/feature/community/question/social-interactions/social-features-for-question-detailed-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/comment/view/comment-view"],function(a,q,d,j,m,h,k,s,o,p,l,r,e,f,i,u,n,g){var c=r.extend({_modelClass:j,defaultOptions:{socialToolbarMode:"light",enableShare:false,enableLike:false,showCommentsSummaryFirst:false}});var b="answer-comments-wrapper",t=d.extend({_modelClass:j,_contentModelAssociation:"answeredFor",_contentAttributeInModel:"answer",_contentCounter:"nb_answers",_commentsWrapperSelector:"."+b,name:"answer-detailed-view",_modelEvents:{"onSync:positiveRate":"refresh","onSync:negativeRate":"refresh","onChange:answer":"_updateAnswer"},_modelEventsForAutoRefresh:["onChange:can_validate"],upvoteAnswer:function(){var v=this.model;v.positiveRate({onComplete:function(w){this.alert("success",n.get("Yourvotehasbeensuccessfullysaved"));var x=parseInt(w.get("NbRatings"),10);w.set("NbRatings",(x+1))}.bind(this),onFailure:function(){this.alert("error",n.get("YourvotecouldnotbesavedPleasetryagain"))}.bind(this)})},downvoteAnswer:function(){var v=this.model;v.negativeRate({onComplete:function(w){this.alert("success",n.get("Yourvotehasbeensuccessfullysaved"));var x=parseInt(w.get("NbRatings"),10);w.set("NbRatings",(x-1))}.bind(this),onFailure:function(){this.alert("error",n.get("YourvotecouldnotbesavedPleasetryagain"))}.bind(this)})},_updateAnswer:function(){if(this.container&&this.container.getElement(".content-message")){this.container.getElement(".content-message").setContent(this.renderContentSummary(this.model.get("answer")))}},_updateButtonsVisibility:function(){if(this.container&&this.model){if(this.model.isNew()){this.container.addClassName("disable-all-buttons");this.listenToOnce(this.model,"onChange:mid",this._updateButtonsVisibility)}else{this.container.removeClassName("disable-all-buttons")}}},_createFooter:function(){var A=this.model,D=A.get("can_rate"),w=A.get("can_validate"),C=A.get("has_rated")&&(parseInt(A.get("my_rate"),10)===1),x=(A.get("validate")==="1"),y=A.get("rate"),B=((w&&!x)?{html:this.addControl("validationButton",new i({value:n.ValidateAnswer,icon:"check",className:"primary"})),"class":"validate"}:""),v=this.addControl("voteButton",new i({value:(C?n.get("Unvote"):n.get("Vote")),icon:"thumbs-up",className:"default iqa-vote-btn",disabled:(!D),active:(Boolean(C))})),z={tag:"span","class":"counter",html:(y>0)?String(y):"0",events:{onClick:function(){}}};if(!q.Features.touchEvents){if(B){this.addControl("validationButtonTooltip",new f({target:this.getControl("validationButton").getContent(),position:"bottom",body:n.ValidateAnswer,offset:{x:0,y:5}}))}if(v){this.addControl("voteButtonTooltip",new f({target:v.getContent(),position:"bottom",body:(C?n.get("Unvote"):n.get("Vote")),offset:{x:0,y:5}}))}}this._updateButtonsVisibility();return([{"class":"answer-footer-wrapper answer-action-bar",html:[{html:[v,z],"class":"upvote"},this.addChildView("socialToolbarView",new c({model:A,widget:this._widget})),B]}])},_createContent:function(){var v=this._parent.apply(this,arguments);return[v].concat(this._createFooter())},onRedraw:function(){var v=this;l.getInstanceFetched(function(w){var x=v.model.getAuthor();if((w.get("login")===x.get("login"))||(w.get("hash_key")===x.get("hash_key"))){v.container.addClassName("disable-vote-btn")}else{v.container.removeClassName("disable-vote-btn")}});return this._parent.apply(this,arguments)}});return t});define("DS/SwymUIComponents/script/feature/community/question/social-interactions/social-features-for-question-detailed-view",["UWA/Core","UWA/Event","UWA/Array","DS/SwymUIComponents/script/feature/community/content/social-interactions/social-toolbar-view","DS/SwymUIComponents/script/feature/community/question/social-interactions/social-features-for-question-view","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUICore/script/feature/community/iquestion/model/iq-answer-model","DS/SwymUICore/script/feature/community/iquestion/collection/iq-answer-collection","DS/SwymUIComponents/script/feature/community/question/social-interactions/answer-detailed-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/comment-collection-view","DS/SwymUIComponents/script/feature/community/content/social-interactions/edit/comment-editor-view","DS/SwymUICore/script/utils/utils","i18n!DS/SwymUIComponents/assets/nls/feature/community/question/social-interactions/social-features-for-question-detailed-view"],function(a,u,n,p,g,h,b,l,m,k,r,c,f){var o=p.extend({_modelClass:h,defaultOptions:{enableComment:false,enableShare:false}}),t=p.extend({_modelClass:h,defaultOptions:{enableComment:false,enableLike:false}});var e=b.DateField,i=b.LocalStorageKeyForSort;var j=r.extend({defaultOptions:{itemModelClass:b,itemTextAttribute:"answer",itemAdditionEvent:"addAnswer",itemAssociationToParentModel:"answeredFor"},name:"sf-answer-editor-view"}),q=k.extend({_collectionClass:l,_contentModelAssociation:"answeredFor",_editorViewClass:j,_showSubsetOfModelViews:false,_collectionEvents:{"onRequest:read":"mask",onSync:"unmask"},_collectionEventsForAutoRefresh:null,setup:function(){var v=c.getDelayedSyncTask(this.refresh.bind(this));this._collectionEvents=a.merge(this._collectionEvents,{onAdd:v,onRemove:v,onReset:v});return this._parent.apply(this,arguments)},_createContent:function(){var v=window.localStorage.getItem(i)||e,w=this.collection.getSortAttribute();if(v!==w){this.collection.setSortAttribute(v);this.collection.sort()}return this._parent.apply(this,arguments)},modelViewClass:m,name:"sf-answer-collection-view",defaultOptions:{answerToScrollTo:null},scrollToAnswer:function(w){var y=this,v=null,x,w=w;if(w&&this.collection&&!this.isDestroyed()){x=y.collection.getAssociated("answeredFor");if((x.getCustomProperty("detailedAnswersFetched")===true)||(this.collection.length>0)||this.collection.hasBeenFetched()){setTimeout(function(){y.getModelViews().forEach(function(z){if(z.model.get("subject6wuri")===w){v=z}});if(v){if(!v.isDestroyed()){v.container.scrollIntoView(false);v.container.addClassName("fade-in-out-blue");setTimeout(function(){if(v.container){v.container.removeClassName("fade-in-out-blue")}},5000)}}else{y.alert("info",f.get("TheAnswerYouAreLookingForCouldNotBeFoundItMayHaveBeenRemoved"))}},2500)}else{if(x){x.addEventOnce("onSync:fetchAllDetailedAnswers",function(){y.scrollToAnswer(w)})}else{this.collection.addEventOnce("onCollectionChange",function(){y.scrollToAnswer(w)})}}}},onRender:function(){if(this.getOption("answerToScrollTo")){this.scrollToAnswer(this.getOption("answerToScrollTo"))}}}),d=k.extend({_collectionClass:l,_contentModelAssociation:"answeredFor",_editorViewClass:j,_collectionEvents:{"onRequest:read":"mask",onSync:"unmask",onAdd:"onValidatedAnswerChanged",onRemove:"onValidatedAnswerChanged"},onValidatedAnswerChanged:function(){var v=this.collection.getAssociated("answeredFor");v&&v.set("nb_validate",this.collection.length)},_createContent:function(){return this._parent.apply(this,arguments)},modelViewClass:m,name:"validated-answer-collection-view"}),s=g.extend({name:"social-features-for-question-detailed-view",defaultOptions:{validatedAnswersViewClass:d,nonValidatedAnswersViewClass:q},_modelEvents:{"onRequest:fetchAllDetailedAnswers":"mask","onSync:fetchAllDetailedAnswers":"unmask","onError:fetchAllDetailedAnswers":"unmask"},domEvents:{"click .upvote>button:not([disabled])":"_onUpvoteClick","click .validate":"_onValidateClick"},_createActionBar:function(){var v=this.getOption("actionBarViewOptions")||{};this.setOption("actionBarViewOptions",a.extend(v,{events:{sortAnswersRequest:function(w){this.sortNonValidatedAnswers(w)}.bind(this)}}));this._parent.apply(this,arguments)},sortNonValidatedAnswers:function(v){var w,x;if(w=this.getChildView("nonValidatedAnswers")){x=w.collection;x&&x.setSortAttribute(v)&&x.sort();w.refresh()}},answersNotBeenOrBeingFetched:function(){var v=this.model;return(!v.haveDetailedAnswersBeenFetched()&&!v.areDetailedAnswersBeingFetched())},fetchAllAnswers:function(w){var v=this.model;return v.fetchAllDetailedAnswers(w)},_findAnswerViewWhichFiredEvent:function(x){var v,z,w,y=u.getElement(x);if(y){z=y.getClosest(".answer-detailed-view-container");if(w=this.getChildView("nonValidatedAnswers")){v=n.detect(w.getModelViews(),function(A){return A.container===z})}if(!v&&(w=this.getChildView("validatedAnswers"))){v=n.detect(w.getModelViews(),function(A){return A.container===z})}}return v},_onUpvoteClick:function(w){var v=this._findAnswerViewWhichFiredEvent(w);if(v){if(!(parseInt(v.model.get("my_rate"),10)===1)){v.upvoteAnswer()}else{v.downvoteAnswer()}}},_onValidateClick:function(x){var y,w=this,v=w._findAnswerViewWhichFiredEvent(x);if(v&&(y=v.model)){this.mask();y.validateAnswer({onComplete:function(z){w.unmask();w.dispatchEvent("newAnswerValidated",[z,w]);w.alert("success",f.Theanswerwasvalidatedsuccessfully)},onFailure:function(){w.alert("error",f.TheanswercouldnotbevalidatedPleasetryagain);w.unmask()}})}},newAnswerValidated:function(w,v){v.fetchAnswerCollections()},fetchAnswerCollections:function(){this.fetchAllAnswers()},_createContent:function(){var x=this.getChildView("actionBar"),v=this.getChildView("nonValidatedAnswers"),w=this.getChildView("validatedAnswers");return[x?{"class":"social-buttons-wrapper",html:[this.addChildView("socialToolbarViewWithLikeOnly",new o({model:this.model,widget:this._widget})),x,this.addChildView("socialToolbarViewWithShareOnly",new t({model:this.model,widget:this._widget}))]}:"",{"class":"validated-answers",html:w?w:""},{"class":"non-validated-answers",html:v?v:""}]}});return s});define("DS/SwymUIComponents/script/feature/community/content/edit/media-layout-editor",["UWA/Core","UWA/Event","UWA/Utils/Client","DS/UIKIT/Popover","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/media-layout-editor","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/utils/media-utils","DS/SwymUIComponents/script/feature/core/rich-tooltip/rich-tooltip"],function(a,q,l,n,h,i,b,m,f){var r=300,c=150,o=0,g="media-layout-editor",d="mediaLayoutEditorTarget",j="mle-btn-",k={sl:{"data-layout":"sl","data-size":"small","data-position":"left"},sc:{"data-layout":"sc","data-size":"small","data-position":"center"},lc:{"data-layout":"lc","data-size":"large","data-position":"center"},sr:{"data-layout":"sr","data-size":"small","data-position":"right"}};var p=i.extend({name:g+"-view",domEvents:{"click .media-layout-btn":"_onLayoutChangeRequest","click .caption-btn":"_onCaptionChange","click .link-btn":"_onLinkChange","click .unlink-btn":"_onUnlink","click .fonticon-pencil":"_onPictureEditionRequest","click .thumbnail-selector-btn:not(.disabled)":"_onThumbnailSelectorClick"},defaultOptions:{image:null,imageInfos:null,editorView:null},_updateImageAttributes:function(u){var t="",v={},s;for(t in k){if(k.hasOwnProperty(t)){if(t===u){v=k[t]}}}s=this.options.image.getParent();if(s&&s.match("figure")){delete v.styles;s.set(v)}else{this.options.image.set(v)}},_onThumbnailSelectorClick:function(u){var t=this.options.editorView.getElement('img[data-content-thumbnail="true"]'),w=q.getElement(u),s=this.options.image,v=false;if(!w.hasClassName("selected")){if(t!==s){if(t){t.removeAttribute("data-content-thumbnail")}s.setAttribute("data-content-thumbnail","true")}w.addClassName("selected");v=(s===this.options.editorView.getElement('img:not([data-deleted-media="true"])'));if(v){w.addClassName("disabled")}w.title=v?h.get("DefaultThumbnail"):this._getContentThumbnailSelectorNls(true)}else{s.removeAttribute("data-content-thumbnail");w.removeClassName("selected");w.title=this._getContentThumbnailSelectorNls(false)}this.options.editorView.dispatchEvent("onContentChange")},_onPictureEditionRequest:function(){this.options.editorView.mask();require(["DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/media/edit/content-edit-media-lightbox"],function(s,u){var x=this.options.image.getAttribute("data-new_media");if(x){var w=this.options.editorView.getMediaCollection();if(w.length>0){var z=this.options.image.getAttribute("data-media_cid"),t=this.options.image.getAttribute("data-media-id"),v=z?w.get(z):w.get(t),y=new u({isNewMedia:x,model:v,viewToUpdate:this.options.editorView});y.injectInDom();this.options.editorView.unmask()}}else{var v=new s({id:this.options.image.getAttribute("data-media-id")});v.fetch({onComplete:function(A){var C=A.get("_acl");if(C.update&&C.update.access){var B=new u({isNewMedia:false,model:A,viewToUpdate:this.options.editorView});B.injectInDom();this.options.editorView.unmask()}else{this.options.editorView.unmask();this.alert("warn",h.YouDontHaveEditingRights)}}.bind(this)})}}.bind(this))},_onLayoutChangeRequest:function(u){var v=this.options.image,s=this.getElement(".media-layout-btn.selected"),w=q.getElement(u),t;if(s){s.removeClassName("selected")}if(w!==s){w.addClassName("selected");this._updateImageAttributes(w.getAttribute("data-layout"))}else{if(this._getImageMaxWidth()>=m.CONTENT_SECTION_MAX_WIDTH){this._updateImageAttributes("lc")}else{v.removeAttribute("data-size");v.removeAttribute("data-position");v.removeAttribute("data-layout");t=v.getParent();if(t&&t.match("figure")){t.removeAttribute("data-size");t.removeAttribute("data-position");t.removeAttribute("data-layout")}}}if(this.options.editorView){this.options.editorView.getRTEView().saveSnapShot();this.options.editorView.dispatchEvent("onContentChange")}this.dispatchEvent("onMediaLayoutChange")},_onCaptionChange:function(t){var v=this.options.image,x=this.options.image.getParent(),u=this.getElement(".caption-btn"),A=v.getParent().match("figure"),y=v.getParent().match("a"),w=v.getAttribute("data-layout")?v.getAttribute("data-layout"):x.getAttribute("data-layout"),z=v.getAttribute("data-position")?v.getAttribute("data-position"):x.getAttribute("data-position"),s=v.getAttribute("data-size")?v.getAttribute("data-size"):x.getAttribute("data-size");if(y){v=v.getParent();x=x.getParent();A=v.getParent().match("figure")}if(A){v.setAttribute("data-layout",w);v.setAttribute("data-position",z);v.setAttribute("data-size",s);x.outerHTML=v.outerHTML}else{v.removeAttribute("data-position");v.removeAttribute("data-layout");v.removeAttribute("data-size");v.outerHTML="<figure "+(w?'data-layout="'+w+'"':"")+(z?'data-position="'+z+'"':"")+(s?'data-size="'+s+'"':"")+'contenteditable="false">'+v.outerHTML+'<figcaption class="figcaption-placeholder" contenteditable="true" data-placeholder="'+h.get("Caption")+'"></figcaption></figure>'}if(A){u.title=h.get("AddACaption")}else{u.title=h.get("RemoveCaption")}if(this.options.editorView){this.options.editorView.getRTEView().saveSnapShot();this.options.editorView.dispatchEvent("onContentChange")}},_onLinkChange:function(t){var s=this.options.editorView.getRTEView().ckeditor,u=this.options.image,v=u.getParent();if(v&&v.match("a")){u=v}if(s){s.customLink=u;s.execCommand("customlink")}},_onUnlink:function(s){var t=this.options.image,u=t.getParent();if(u&&u.match("a")){u.outerHTML=t.outerHTML}},_getImageLayout:function(v){var t,w=v||this.options.image,u=w.getAttribute("data-size"),s=w.getAttribute("data-position");if(!u&&!s){t=w.getParent();if(t&&t.match("figure")){return this._getImageLayout(t)}}switch(u){case"small":switch(s){case"left":return"sl";case"center":return"sc";case"right":return"sr";default:break}break;case"large":if(s==="center"){return"lc"}break;default:break}return""},_getImageMaxWidth:function(){var s=parseInt(this.options.imageInfos.width,10);return s},_getContentThumbnailSelectorNls:function(t){var u,v=null,s=this.options.editorView.model;if(s){v=s.getModelName()}else{u=this.options.editorView.getOption("contentEditorView");if(u){v=u.getCurrentContentType()}}if(t!==true){switch(v){case"post":return h.get("UseAsPostThumbnail");case"iquestion":return h.get("UseAsQuestionThumbnail");case"idea":return h.get("UseAsIdeaThumbnail");case"wiki":return h.get("UseAsWikiPageThumbnail");default:return h.get("UseAsContentThumbnail")}}else{return h.get("RestoreDefaultThumbnail")}},_createContent:function(){var G,x=this.options.image,v=this.options.editorView,t=this._getImageMaxWidth(),w=x.getAttribute("data-layout")||this._getImageLayout(),A=v.getElements('img:not([data-deleted-media="true"])'),E=(x===A[0]),C=(x.dataset.contentThumbnail==="true")||(E&&!v.getElement('img[data-content-thumbnail="true"]')),s=x.getParent(),F=false,B=false,y,z=[],u=0,D;if(!l.Platform.ios){y=z[u]=[];G=(((t>m.CONTENT_LARGE_IMAGE_MIN_WIDTH)&&(t<m.CONTENT_SECTION_MAX_WIDTH))?["sl","sc","lc","sr"]:["sl","sc","sr"]);G.map(function(I){var H=undefined,J=undefined;switch(I){case"sl":H="Left";J="picture-wrapping-left";break;case"sc":H="SmallAndCentered";J="picture-inline-small";break;case"lc":H="Centered";J="picture-inline-large";break;case"sr":H="Right";J="picture-wrapping-right";break;default:throw new Error("This layout is not supported!")}y.push({"class":("media-action-btn media-layout-btn "+(j+I)+(" fonticon fonticon-2x fonticon-"+J)+(w===I?" selected":"")),"data-layout":I,title:h.get(H)})},this)}if(s){B=s.match("a");if(!B){F=s.match("figure")}else{F=s.getParent().match("figure")}}++u;y=z[u]=[];y.push({"class":"media-action-btn fonticon fonticon-2x fonticon-feather fonticon-text-caption caption-btn",title:(F?h.get("RemoveCaption"):h.get("AddACaption"))});y.push({"class":"media-action-btn fonticon fonticon-2x fonticon-link link-btn",title:h.get("InsertALink")});y.push({"class":"media-action-btn fonticon fonticon-2x fonticon-link-off unlink-btn"+(B?"":" disabled"),title:h.get("Unlink")});if(x.getAttribute("data-media-type")==="picture"){if(!z[u]){z[u]=[]}y=z[u];y.push({"class":"media-action-btn fonticon fonticon-2x fonticon-pencil",title:h.get("Edit")})}if(A.length>1){++u;y=z[u]=[];y.push({"class":"media-action-btn thumbnail-selector-btn"+(C?(" selected"+(E?" disabled":"")):""),html:{tag:"span","class":"fonticon fonticon-2x fonticon-picture-favorite"},title:((C&&E)?h.get("DefaultThumbnail"):this._getContentThumbnailSelectorNls(C))})}D=z.reduce(function(H,I){if(!H){H=[]}else{H.push({"class":"btn-group-divider"})}return H.concat(I)});return D}}),e=n.extend(f,{_targetPresenceCheckInterval:null,defaultOptions:{className:"flex-display "+g,position:"top",closeOnClick:false,delay:{show:r,hide:c,destroy:o},viewOptions:null,timeout:null},_hideThenShowAgainAfterUpdate:function(){var t=this,s=this.getContent();if(s){this.hide();setTimeout(function(){if(t._destroyed!==true){t.show();t.updatePosition()}},0)}},init:function(t,s){if(!t.viewOptions){throw new Error("Missing arguments")}if(t.timeout){this.timeout=t.timeout}t.target[d]=true;t.viewOptions.image=t.target;t.body=this.innerView=new p(t.viewOptions);this.innerView.addEvent("onMediaLayoutChange",this._hideThenShowAgainAfterUpdate,this);this._parent.apply(this,arguments)},buildSkeleton:function(t){var s=this._parent.apply(this,arguments);return s},handleEvents:function(){var t=this.options&&this.options.target,s=this._previous.apply(this,arguments);if(t){t.addEvent("dragstart",function(){t.removeClassName("highlighted")})}return s},onShow:function(){var s=this,t=this.options&&this.options.viewOptions&&this.options.viewOptions.image;if(t){if(!this._targetPresenceCheckInterval){this._targetPresenceCheckInterval=setInterval(function(){if(this._destroyed===true){clearInterval(this._targetPresenceCheckInterval)}else{if(!document.body.contains(t)){s.destroy()}}},100)}t.addClassName("highlighted")}},onHide:function(){var s=this.options&&this.options.viewOptions&&this.options.viewOptions.image;if(s){s.removeClassName("highlighted")}return this._previous.apply(this,arguments)},destroy:function(){if(this._destroyed===false){clearInterval(this._targetPresenceCheckInterval);this.options.target[d]=undefined;this.options.target.removeEvent("resize",this._onTargetResize)}return this._previous.apply(this,arguments)}});e.SHOW_DELAY=r;e.HIDE_DELAY=c;e.DESTROY_DELAY=o;e.TARGET_FLAG_PROPERTY=d;e.NAME=g;e.BTN_EFFECTS=k;return e});define("DS/SwymUIComponents/script/feature/community/content/edit/media-layout-editor-factory",["UWA/Core","UWA/Array","UWA/Event","UWA/Class/Events","UWA/Class/Listener","DS/SwymUIComponents/script/feature/community/content/edit/media-layout-editor"],function(g,a,m,o,n,k){var c=["mouseover","touchstart"],e=0,b=k.TARGET_FLAG_PROPERTY,h=".no-"+k.NAME,f=c.map(function(p){return p+" img:not("+h+")"}),j=k.SHOW_DELAY;var l=function(p){if(p.showEditor!==false){var q=new k({target:p.target,timeout:p.timeout,viewOptions:{model:p.model,imageInfos:p.imageInfos,editorView:p.editorView}});if(p.showEditor!==false){q.show()}else{q.destroy()}}if(p.callback){p.callback()}p.editorView.dispatchEvent("mediaLayoutHasBeenCreate")};var i=function(z,w,q){z.stopPropagation();var v,s,y,r=null,x=null,u=z.target,p={};function A(){u.removeEvent("mouseout",t);g.extendElement(window.document).removeEvent("click",t)}function t(){clearTimeout(x);p.showEditor=false;A()}if(u===m.getElement(z)&&!u[b]){s=u.dataset.mediaId;y=w&&w.get("thumbnails_infos");if(!y){v=true}else{r=a.detect(y,function(B){return(B.media_id===s)});if(u.dataset.deletedMedia==="true"){return}else{v=true}if(r){r=g.clone(r,false)}}if((v===true)||(u.dataset.mediaType!=="picture")){r=g.merge(r||{},{width:u.style.width||u.width,height:u.style.height||u.height})}if((parseInt(r.width,10)>=e)&&!u.getParent(h)){u.addEvent("mouseout",t);g.extendElement(window.document).addEvent("click",t);p.target=u;p.callback=A;p.imageInfos=r;p.editorView=q;x=setTimeout(function(){p.timeout=x;l(p)},j)}}};var d=n.singleton(o,{_handleEditorDisplay:function(q,p){var r=p.domElt;if(!r||!p.getContent){throw new Error("Invalid arguments")}if(q===true){f.forEach(function(s){this.listenTo(g.extendElement(r),s,function(t){i.call(this,t,p.getContent.call(this),p.editorView)})},this)}else{f.forEach(function(s){this.stopListening(g.extendElement(r),s)},this)}p.editorView.dispatchEvent("mediaLayoutIsReady")},activateEditorDisplay:function(p){return this._handleEditorDisplay(true,p)},deactivateEditorDisplay:function(p){return this._handleEditorDisplay(false,p)}}).init();return d});define("DS/SwymUIComponents/script/feature/community/content/view/content-body-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/lib/model/generic/community-content","DS/SwymUICore/script/lib/model/generic/6wtaggable-model","DS/SwymUIComponents/script/utils/content-process","DS/UIKIT/Spinner","DS/SwymUIComponents/script/utils/content-media-utils"],function(h,e,i,f,g,b,a){var d=e.extend({_modelEventsForAutoRefresh:["onChange:summary","onChange:content","onChange:thumbnails_infos"],_modelEvents:{"onSync:update":"onModelUpdate","onChange:tags6w":"_updateInlineTagsLookAccordingToTagsList"},_delegateSpriteReloadToParentView:false,defaultOptions:{modelAttr:"content"},_onRevisionReceived:function(j){this.wikiRevisionData=j.attributes;this.setMode("revision");this.refresh()},wikiRevisionData:null,mode:null,contentMediaCollection:null,name:"content-body-view",init:function(){return this._parent.apply(this,arguments)},setup:function(j){if(j&&j.hasOwnProperty("mode")){this.setMode(j.mode)}return this._parent.apply(this,arguments)},setMode:function(j){this.mode=j},onSetModel:function(k,l,j){this.reactTo(j,"onRevisionReceived",this._onRevisionReceived);this.setMode("view")},onModelUpdate:function(){this.setMode("view");this.wikiRevisionData=null;this.refresh()},_updateInlineTagsLookAccordingToTagsList:function(){if(!this.isDestroyed()&&(this.model instanceof f)){g.updateInlineTagsLookAccordingToTagsList(this.container,this.model.get("tags6w")||[])}},_createContent:function(){var s=false,p=this.model,u=p.get("thumbnails_infos"),k;if(p){var r=p.get(this.getOption("modelAttr")),t=false;if(this.mode==="preview"&&p.hasVirtuallyChanged(this.getOption("modelAttr"))){r=p.getChanges(this.getOption("modelAttr"))}else{if(this.mode==="revision"){r=p.get("content")}else{if(!r){var o=p.has("update");r=p.get("summary");if((!o&&p._modelName==="wiki")||(p._modelName!=="wiki")){t=true}}}}if((this.mode!=="preview")&&u&&(u.length>0)){s=true}else{s=false}r=a.replaceStreammediaUrl(r);r=h.createElement("div",{html:r});r=g.contentProcessTables(r);var v=r.getElements("img[data-media-id]");var q=a.createThumbnailInContentView(v,this,s);k=q.length;for(var n=0,m=q.length;n<m;n++){var j=n;q[n].addEventOnce("onPostInject",function(){v[j].destroy()});q[n].render().inject(v[n],"before")}r=g.contentPostProcess(r,{imageProcessing:false,updateInlineTagsLookAccordingToTagsList:(this.model instanceof f),tagList:(this.model instanceof f)?(this.model.get("tags6w")||[]):null});if(s){this.imageReloadOptions={useVariableSizeSprite:true,selector:'img[data-type="VariableSizeMediaThumbnail"]'}}else{this.imageReloadOptions={useSprite:false,imageKind:"thumb",size:"l"}}if(!p.get(this.getOption("modelAttr"))){var l={html:this.addControl("content-loading",new b({className:"msg-animation",visible:true,animate:true,spin:true})),styles:{"text-align":"center",height:"30px"}};r=[r,l]}return r}}});var c=e.extend({_modelClass:i,name:"content-body-view",defaultOptions:{modelAttr:"content"},setup:function(){this._parent.apply(this,arguments);var j={model:this.model,widget:this._widget,modelAttr:this.getOption("modelAttr"),Class:d};if(this.getOption("innerBodyViewMode")){j.mode=this.getOption("innerBodyViewMode")}this.addChildView("innerBodyView",j)},_createContent:function(){var j=this.model;if(j){var k=h.createElement("div",{html:[{"class":"content-body diff-enabled",html:[this.getChildView("innerBodyView")]},{styles:{clear:"both"}}]});return k}}});return c});define("DS/SwymUIComponents/script/feature/community/content/edit/extra-text-editor",["UWA/Core","DS/UIKIT/Popover","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/core/rich-tooltip/rich-tooltip","DS/SwymUIComponents/script/feature/community/content/edit/paragraph-formatter-popover","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/extra-text-editor"],function(i,b,d,h,a,k,c){var j=100,f=300,e=9,m="extra-text-editor";var l=d.extend({name:m+"-view",domEvents:{},defaultOptions:{extraEditor:null,editorView:null},_createContent:function(){var p=this,o=i.createElement("div",{"class":"extra-text-editor-btn fonticon fonticon-menu paragraph-formatter-menu"}),n=i.createElement("div",{html:o}),q=i.createElement("div",{"class":"extra-text-editor-btn fonticon fonticon-attach attachment"});this.addControl("paragraphFormatter",new a({target:n,extraEditor:this.options.extraEditor,events:{onApplyStyle:function(){p.dispatchEvent("onApplyStyle")}}}));this.addControl("menuIconTooltip",new k({target:o,body:c.FormatParagraph}));this.addControl("attachmentIconTooltip",new k({target:q,body:c.AddMedia}));return[{tag:"div",html:n},q]},_openMediaLibrary:function(n){}}),g=b.extend({defaultOptions:{className:"flex-display "+m,position:"top-right",delay:{show:j,hide:f},offset:{y:0},editionTarget:null,editorView:null,viewOptions:null},init:function(o,n){var p=this;this.updatePosition=this.updatePosition.bind(this);o.body=this.innerView=new l({extraEditor:this,events:{onApplyStyle:function(){p.dispatchEvent("onApplyStyle")}}});this._parent.apply(this,arguments)},handleEvents:function(){var n=this.options.target;if(!this.events&&n){this.events={click:h.prototype._enter.call(this,true),resize:this.updatePosition};n.addEvents(this.events);this.elements.container.addEvents(this.events)}},updatePosition:function(){var u=window.getSelection();if(u.rangeCount===0){return}var q=u.getRangeAt(0),t=(i.is(q.startContainer)&&i.is(q.startContainer.parentElement)&&q.startContainer.parentElement.className!==this.innerView.className&&q.startOffset===0&&q.endOffset===0&&q.startContainer.localName==="p")?true:false;if(this.isVisible&&((this.options&&this.options.editionTarget&&document.documentElement.contains(this.options.editionTarget))||t)){var s,x=this.options,p=x.offset,r=x.editionTarget,o=this.options.editorView,n,w,v;if(o&&!o.isDestroyed()){s=r.getPosition(o.container);n=parseInt(r.getStyle("marginTop"),10);w=parseInt(r.getStyle("paddingTop"),10);if(!i.is(w)){w=e}if(!i.is(n)){n=0}this.elements.container.setStyles({top:Math.max(10,Math.round(s.y+p.y+n+w-2))})}if(t){v={localName:"p"}}else{v=this.options.editionTarget}this.updateIcon(v)}return this},updateIcon:function(p){var q={blockquote:"fonticon-text-quote",h1:"fonticon-text-h1",h2:"fonticon-text-h2",ol:"fonticon-list-ordered",numberedlist:"fonticon-list-ordered",ul:"fonticon-list",bulletedlist:"fonticon-list",pre:"fonticon-code",p:"fonticon-menu"},r="fonticon-menu",n=this.elements.container.getElement(".paragraph-formatter-menu"),o;if(i.is(p.localName)){if(i.is(p.getParent)&&(p.localName==="li"||p.localName==="p")){p=p.getParent()}if(p&&q.hasOwnProperty(p.localName)){if(n.hasClassName(r)){n.removeClassName(r)}for(o in q){if(q.hasOwnProperty(o)&&n.hasClassName(q[o])){n.removeClassName(q[o])}}n.addClassName(q[p.localName])}}},show:function(){var p=this.options.editorView;if(p&&!p.isDestroyed()){var n=this,o=this.elements;if(!o){return}if(!this.isVisible){this.isVisible=true;this.inject(p.container);this.updatePosition();this.elements.container.addClassName("in");if(this.options.animate){setTimeout(function(){if(n.elements&&n.isVisible){n.dispatchEvent("onShow")}},150)}else{this.dispatchEvent("onShow")}this.options.editorView.getChildView("rte").ckeditor.on("selectionChange",function(q){var r=q.data.selection.getSelectedText();if(r&&r.length>0){n.innerView.getControl("paragraphFormatter").hide()}})}return this}},setEditionTarget:function(n){if(n!==this.getOption("editionTarget")){this.setOptions({editionTarget:n});this.innerView.refresh();this.updatePosition()}},getEditionTarget:function(){return this.getOption("editionTarget")},destroy:function(){if(this._destroyed===false){this._destroyed=true;this.innerView.destroy();this.innerView=null;this._parent.apply(this,arguments)}}});return g});define("DS/SwymUIComponents/script/feature/community/content/edit/extra-text-editor-factory",["UWA/Core","UWA/Event","UWA/Class/Events","UWA/Class/Listener","DS/Logger/Logger","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/content/edit/extra-text-editor"],function(h,i,n,m,b,k,g){var f=["click","touchend"],o="blockquote,h1,h2,i,ul,ol,p,table,pre,tr,div",e=["keydown .editable-container","paste .editable-container"].concat(f.map(function(p){return p+" "+o}));function d(s,r,p,t){var q;if(r&&p){q=r.getControl(t);if(!q){q=r.addControl(t,new g({target:p,editionTarget:s,editorView:r,events:{onApplyStyle:function(){l(r,p,t)}}}))}else{if(q.getEditionTarget()!==s){q.setEditionTarget(s)}else{if(q.innerView){}}}q.show()}else{throw new Error("Missing arguments")}}var c=function(s,p,t){var r=null,q=s.parentElement;if(q){h.extendElement(q);if(q.match(p)){r=q}else{r=q.getParent(p);if(!t.contains(r)){r=null}}}return r};var j=k.getDelayedSyncTask(function(u,r,q,t){var s=null,p=h.extendElement(u).getElement(o);if(!p){if(u.match(o)){s=u}else{s=c(u,o,q)}}else{while(p){s=p;p=p.getElement(o)}}if(s){return d(s,r,q,t)}},100);var l=k.getDelayedSyncTask(function(r,q,t){var p=window.getSelection().getRangeAt(0),s=p&&p.startContainer;if(s){if(s.nodeType===s.TEXT_NODE){s=c(s,o,q)}if(s&&s.nodeType===Node.ELEMENT_NODE){h.extendElement(s);j.call(this,s,r,q,t)}}},200);var a=m.singleton(n,{_handleEditorDisplay:function(t,q){var s,p,u=q.domElt,r=true;if(!u||!q.editorView||!q.extraTextEditorId){throw new Error("Invalid arguments")}h.extendElement(u);if(t===true){p=function(){r=false;l.call(this,q.editorView,u,q.extraTextEditorId)};s=function(z){var x=z.target;if(z.target.hasClassName("editable-container")||z.target.hasClassName("scroller-content")){var v=z.target.getBoundingClientRect(),w,y;for(w=z.x;w<v.left+v.width;w+=40){y=document.elementFromPoint(w,z.y);if(y!==z.target){x=y;break}}}if(!(z.type==="touchend"&&!z.cancelable)){q.editorView.dispatchEvent("onSelectionChange",[x])}if(z.type==="keydown"){switch(i.whichKey(z)){case"return":case"ctrl+v":case"up":case"down":case"left":case"right":p();break;default:}}else{if(z.type==="paste"){p()}else{r=false;j.call(this,x,q.editorView,u,q.extraTextEditorId)}}};e.forEach(function(v){this.listenTo(u,v,s)},this);q.editorView.addEvents({onEnterKeyPressed:p,onBackspaceKeyPressed:p});q.editorView.executeWhenRTEIsReady(function(){if(r===true){r=false;var v=u.getElement(o);if(v){d.call(this,v,q.editorView,u,q.extraTextEditorId)}}})}else{e.forEach(function(v){this.stopListening(u,v)},this)}},activateEditorDisplay:function(p){return this._handleEditorDisplay(true,p)},deactivateEditorDisplay:function(p){return this._handleEditorDisplay(false,p)}}).init();return a});define("DS/SwymUIComponents/script/feature/community/survey/view/question-view",["UWA/Core","DS/SwymUIComponents/script/feature/community/content/utils/content-renderer","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/content/view/content-body-view","DS/SwymUICore/script/feature/community/survey/model/question-model"],function(f,c,e,d,a){var b=e.extend({_modelEventsForAutoRefresh:["onChange"],_modelClass:a,_createContent:function(){var g=this.model,j=g.get("description",{escapeHTML:false}),i=c.getInstance().render(j,{createMediaView:false}),h=this.addChildView("contentMediaDisplayManager",{Class:"DS/SwymUIComponents/script/feature/community/media/view/simple-content-media-view",contentAttributeInModel:"description",model:g,widget:this._widget});return f.createElement("div",{"class":"content-body",html:[{html:i},{html:h}]})}});return b});define("DS/SwymUIComponents/script/feature/community/media/view/media-summary-view",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/content/view/content-summary-view"],function(c,b,d){var a=d.extend({_modelClass:b,name:"media-summary-view",defaultOptions:{iconCls:"picture"}});return a});define("DS/SwymUIComponents/script/feature/community/media/view/media-summary-view-light",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUIComponents/script/feature/community/media/view/media-summary-view"],function(e,b,d){var c=250,a=d.extend({_modelClass:b,name:"media-summary-view-light",defaultOptions:{iconCls:"picture"},getMediaThumbnailContainerMaxHeight:function(){return c},_createContent:function(){return{tag:"div",html:[this._createThumbnail(),this._getIconElement(),this._createActionMenu()]}}});return a});define("DS/SwymUIComponents/script/feature/community/wiki/edit/wiki-creator-view",["DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-view-with-advanced-rte","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/edit/wiki-creator-view"],function(a,c){var b=a.extend({name:"wiki-editor-body-view",_createContent:function(){return[{"class":"wiki-creator-minimized",html:c.Startyourwikipage}]}});return b});define("DS/SwymUIComponents/script/feature/community/survey/view/legacy-survey-view",["UWA/Core","UWA/String","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/survey-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/answer-result-view","DS/UWPClientCode/I18n","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/survey/view/answer-collection-view","DS/SwymUIComponents/script/feature/community/survey/view/answer-result-collection-view","DS/SwymUIComponents/script/feature/community/survey/view/question-view","DS/SwymUICore/script/feature/core/user/model/currentuser-model","DS/W3DXComponents/Views/GraphView","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/SwymUICore/script/utils/utils"],function(l,b,f,a,d,h,m,p,o,i,c,g,n,k){var j=k.isFeatureActivated("activateSurveyImprovements");var e=h.extend({model:null,_el:null,_currentQuestion:null,_currentQuestionPosition:1,_questionView:null,_answersView:null,_userHasAlreadyAnswered:null,_showResultsAfterVote:null,_showResult:null,_canExport:false,_mode:"view",defaultOptions:{fetchItemOnClick:true,modelFetchOptions:{},resultMode:"row"},_modelEventsForAutoRefresh:["onSync:read","onSync:update","onChange:questions","onChange:endHour","onChange:endDate"],domEvents:{"click .prev-button":"onPrevButtonClick","click .next-button":"onNextButtonClick","click .survey-save-button":"onSaveButtonClick","click .export-button":"onExportButtonClick","click .see-results":"onSeeResultsAndCancelClick","change .answer-checkbox":"onCheckboxChange"},_getResultSeries:function(s){var r=this,q=[];s.forEach(function(t){var u=parseInt(t.get("is_open"),10)===1;q.push([b.unescapeHTML(u?a.OpenAnswers:t.get("description")),parseFloat(t.getRoundedPercentage())])});return q},_createContent:function(){var y=this,w=this.model,A;this._userHasAlreadyAnswered=null;this._showResultsAfterVote=null;this._showResult=null;if(w&&this.model.getAssociated("questions").length>0){if(this.model.get("published")==="0"){this._mode="preview"}else{if(this._mode!=="result"){this._mode="view"}}if(w.getAssociated("questions")){w.getAssociated("questions").forEach(function(C){if(C.getAssociated("answers")){C.getAssociated("answers").forEach(function(D){D.set("nbVoters",this.get("nbVoters"))}.bind(this))}}.bind(w))}var r=new Date();var B=new Date(),u=w.get("startHour"),s=w.get("startDate");if(u&&s){B.setHours(u.substring(0,2));B.setMinutes(u.substring(3,5));B.setDate(s.substring(8,10));B.setMonth(parseInt(s.substring(5,7),10)-1);B.setYear(s.substring(0,4))}var t=new Date(),z=w.get("endHour"),x=w.get("endDate");if(z&&x){t.setHours(z.substring(0,2));t.setMinutes(z.substring(3,5));t.setDate(x.substring(8,10));t.setMonth(parseInt(x.substring(5,7),10)-1);t.setYear(x.substring(0,4))}if(r<B&&this._mode=="view"){A=l.createElement("div",{styles:{"padding-top":"12px","font-size":"17px"},html:f.SurveynotyetstartedPleasecomeback.format(w.get("startDate"),w.get("startHour"))})}else{this._userHasAlreadyAnswered=w.get("userHasAlreadyAnswered")||false;this._showResultsAfterVote=w.get("showResultsAfterVote");this._canSeeResults=false;if(j){this._canSeeResults=parseInt(w.getCommunity().get("this").getCurrentUserRights,10)>2||w.get("login")===i.getInstance().get("login")||false}switch(this._mode){case"view":if(!j){this._showResult=(this._userHasAlreadyAnswered===true&&this._showResultsAfterVote===true)||(r>t)}else{if(!w.isOpen()){this._showResult=true}else{if(this._userHasAlreadyAnswered){if(this._showResultsAfterVote===true){this._showResult=true}else{if(this._canSeeResults){this._showResult=true}else{this._showResult=false}}}else{this._showResult=false}}}break;case"preview":this._showResult=false;break;case"result":this._showResult=true;break}var q=this.model.getAssociated("questions").at(0);q.set("thumbnails_infos",this.model.get("thumbnails_infos"));this._questionView=new o({model:q,modelAttr:"description"});if(this._showResult===false){if(q.get("type")==="Scale"){q.getAssociated("answers").reset([{is_open:"0",id:"fake"}])}this._answersView=new m(q.getAssociated("answers"))}else{if(this._showResult===true){var v=this.model.get("questions")&&this.model.get("questions").hasOwnProperty("0")&&this.model.get("questions")[0].hasOwnProperty("answers")&&this.model.get("questions")[0]["answers"];v&&q.getAssociated("answers").reset(v);if(this.getOption("resultMode")==="row"){this._answersView=new p(q.getAssociated("answers"))}else{if(this.getOption("resultMode")==="pie"){this._answersView=l.createElement("div",{events:{resize:function(){if(this._graph){this._graph.reflow()}}.bind(this)}})}}}}if(!this._controls["prev-button"]){this.addControl("prev-button",new g({className:"default prev-button",value:f.Previous,attributes:{disabled:true}}))}if(!this._controls["next-button"]){this.addControl("next-button",new g({className:"default next-button",value:f.Next}))}this._canExport=(this.model.getCommunity().getUserRole()>=3)||false;if(this._mode!="preview"){if(this._showResult===false){this.addControl("save-button",new g({className:"primary survey-save-button",value:f.Save,disabled:(this.model.getAssociated("questions").length>1?true:false)}))}else{if(this._canExport){this.addControl("export-button",new g({className:"primary export-button",value:f.Exportresults}))}}}if(this._userHasAlreadyAnswered===false||this._showResult===true){A=l.createElement("div",{styles:(window.ds&&window.ds.env==="3DD"?{padding:"0px 10px"}:""),html:[{styles:{"font-style":"italic",color:"#C1C1C1","text-align":"right","font-size":"11px",padding:"0 0 10px"},html:f.Start+w.get("startDate")+" "+w.get("startHour")+" - "+f.End+w.get("endDate")+" "+w.get("endHour")},{styles:{padding:"5px 0","border-bottom":"1px solid #D8D8D8",color:"#518cd3","font-weight":"bold"},html:f.Question+' <span class="current-question-position">'+this._currentQuestionPosition+'</span> / <span class="question-count">'+w.getAssociated("questions").length+"</span>"},{styles:{margin:"10px 0"},html:this.addChildView("current-question-view",this._questionView)},(this._showResult?{styles:{"text-align":"right",padding:"10px 0 10px"},html:f.Numberofvoters+w.get("nbVoters")+(this._userHasAlreadyAnswered===true?" ("+f.includingyou+")":"")}:""),((this._showResult&&w.get("nbVoters")!=="0")?new n({type:"switch",label:f.PieGraph,checked:this.getOption("resultMode")==="pie",className:"graph-mode-toggle",events:{onChange:function(){if(this.isChecked()){y.setOption("resultMode","pie")}else{y.setOption("resultMode","row")}y._currentQuestionPosition=1;y.refresh()}}}):{"class":"answers-config"}),{styles:{padding:"5px 0 10px 0"},"class":"current-answers",html:this._answersView},(w.getAssociated("questions").length>1?this._controls["prev-button"]:""),(w.getAssociated("questions").length>1?this._controls["next-button"]:""),(this._mode!=="preview"?(this._showResult===false?[this._controls["save-button"],(this._canSeeResults?new g({className:"default see-results",value:f.CheckResults}):"")]:[(this._canExport?this._controls["export-button"]:""),(this._mode==="result"&&this._userHasAlreadyAnswered===false&&j?new g({className:"default see-results",value:f.Answer}):"")]):""),(this._showResult===false?{styles:{"font-style":"italic",color:"#C1C1C1","font-size":"11px","padding-top":"5px","margin-bottom":"10px",clear:"both"},html:"<i>"+f.Thissurveyisanonymous+"</i>"}:"")]})}else{A=l.createElement("div",{styles:{"padding-top":"12px","font-size":"17px"},html:f.Pleasecomebackon.format(w.get("endDate"),w.get("endHour"))})}}return A}},validateCurrentAnswer:function(){var q=false;var r=true;if(this._currentQuestion.get("type")=="Single"||this._currentQuestion.get("type")=="Multiple"){this._currentQuestion.getAssociated("answers").forEach(function(t,s){if(t.get("selected")===true){q=true;if(t.get("is_open")=="1"&&(!t.get("custom_text")||(t.get("custom_text")&&t.get("custom_text").trim()===""))){r=false}}})}else{if(this._currentQuestion.get("type")=="Open"){this._currentQuestion.getAssociated("answers").forEach(function(t,s){if(t.get("custom_text")&&t.get("custom_text").trim()!==""){q=true}})}else{if(this._currentQuestion.get("type")=="Scale"){if(this._currentQuestion.getChanges("selected_index")){q=true}}}}if(q&&r){return true}else{return false}},setCurrentQuestion:function(q){this._currentQuestion=this.model.getAssociated("questions").at(q-1);this._currentQuestion.set("thumbnails_infos",this.model.get("thumbnails_infos"));var r=this.container.getElement(".current-question-position");if(r){r.setContent(q.toString())}if(this._currentQuestion.get("type")==="Scale"&&this._showResult===false){this._currentQuestion.getAssociated("answers").reset({is_open:"0",id:"fake"})}if(this._questionView){this._questionView.setModel(this._currentQuestion);if(this.getOption("resultMode")==="row"){this._answersView.setCollection(this._currentQuestion.getAssociated("answers"))}else{if(this.getOption("resultMode")==="pie"){this._answersView.empty();this._graph=new c({type:c.TYPE_PIE,series:[{data:this._getResultSeries(this._currentQuestion.getAssociated("answers"))}]}).render().inject(this._answersView)}}}if(this._showResult===false&&this._currentQuestion.get("type")==="Multiple"&&this._currentQuestion.get("nb_answer_max")!="0"){var s=0;this._currentQuestion.getAssociated("answers").forEach(function(u,t){if(u.get("selected")===true){s++}});this._answersView.getModelViews().forEach(function(t,u){if(t.getControl("answer-checkbox").getInputElement().checked===false){t.getControl("answer-checkbox").setDisabled(s>=this._currentQuestion.get("nb_answer_max"))}}.bind(this));this.getElement(".answers-config").setHTML(d.replace(f.MaxNumberOfAnswer,{nbMax:this._currentQuestion.get("nb_answer_max")}))}else{if(this.getElement(".answers-config")){this.getElement(".answers-config").empty()}}if(this._currentQuestionPosition==1){if(this._controls["prev-button"]){this._controls["prev-button"].setDisabled(true)}if(this._controls["next-button"]){this._controls["next-button"].setDisabled(false)}}else{if(this.model.getAssociated("questions").length<=this._currentQuestionPosition){if(this._controls["prev-button"]&&this._controls["next-button"]){this._controls["prev-button"].setDisabled(false);this._controls["next-button"].setDisabled(true)}}else{if(this._controls["prev-button"]&&this._controls["next-button"]){this._controls["prev-button"].setDisabled(false);this._controls["next-button"].setDisabled(false)}}}if(this._showResult===false&&this._controls["save-button"]&&this.model.getAssociated("questions").length==this._currentQuestionPosition){this._controls["save-button"].setDisabled(false)}else{if(this._showResult===false&&this._controls["save-button"]){this._controls["save-button"].setDisabled(true)}}},setup:function(q){if(q.mode){this._mode=q.mode}this._parent.apply(this,arguments)},onPrevButtonClick:function(q){if(this._controls["prev-button"]){this._currentQuestionPosition--;this.setCurrentQuestion(this._currentQuestionPosition)}},onNextButtonClick:function(q){if(this._controls["next-button"]&&this._mode!="preview"){if(this.validateCurrentAnswer()||(this._showResult===true)){this._currentQuestionPosition++;this.setCurrentQuestion(this._currentQuestionPosition)}else{if(this._currentQuestion.get("type")=="Open"){this.alert("warn",f.Pleasefillyouranswer)}else{this.alert("warn",f.Pleaseselectyouranswer)}}}else{this._currentQuestionPosition++;this.setCurrentQuestion(this._currentQuestionPosition)}},onSaveButtonClick:function(q){if(this.validateCurrentAnswer()){var r=[];this.model.getAssociated("questions").forEach(function(s,t){s.getAssociated("answers").forEach(function(v,u){if(v.get("selected")===true||(v.get("is_open")=="1"&&s.get("type")==="Open")){this.push({answer:(v.get("is_open")=="1"?v.get("custom_text"):null),answer_id:(v.get("is_open")=="1"?-1:v.get("mid")),question_id:(!v.get("mid")?s.get("mid"):v.get("questionId"))})}else{if(s.get("type")==="Scale"){this.push({answer:s.getChanges("selected_index"),question_id:s.get("mid")})}}}.bind(this))}.bind(r));if(this.getControl("prev-button")){this.getControl("prev-button").setDisabled(true)}if(this.getControl("next-button")){this.getControl("next-button").setDisabled(true)}this.getControl("save-button").setDisabled(true);this.getControl("save-button").setValue(f.Loading);this.model.saveAnswers(r,{onComplete:function(){this._questionView=null;this._currentQuestion=null;this._currentQuestionPosition=1;this.model.fetch({onComplete:function(){this.setCurrentQuestion(1)}.bind(this)});this.alert("success",f.Youranswershasbeenposted)}.bind(this),onFailure:function(){if(this.getControl("prev-button")){this.getControl("prev-button").setDisabled(false)}if(this.getControl("next-button")){this.getControl("next-button").setDisabled(false)}this.getControl("save-button").setValue(f.Save);this.getControl("save-button").setDisabled(false);this.alert("error",f.Errorwhilepostingyouranswers)}.bind(this)})}else{if(this._currentQuestion.get("type")=="Open"){this.alert("warn",f.Pleasefillyouranswer)}else{this.alert("warn",f.Pleaseselectyouranswer)}}},onSeeResultsAndCancelClick:function(){if(this._mode==="view"){this._mode="result"}else{this._mode="view"}this._currentQuestionPosition=1;this.refresh()},onExportButtonClick:function(){var q=this;this.model.getResults({onComplete:function(){q.alert("info",f.AnEmailWillBeSent)},onFailure:function(){q.alert("warning",f.EmailSendingError)}})},onCheckboxChange:function(r){this._currentQuestion.getAssociated("answers").forEach(function(t,s){if("checkbox_answer_"+t.get("mid")==r.target.name){t.set("selected",r.target.checked)}});if(this._currentQuestion.get("nb_answer_max")!="0"){var q=0;this._currentQuestion.getAssociated("answers").forEach(function(t,s){if(t.get("selected")===true){q++}});this._answersView.getModelViews().forEach(function(s,t){if(s.getControl("answer-checkbox").getInputElement().checked===false){s.getControl("answer-checkbox").setDisabled(q>=this._currentQuestion.get("nb_answer_max"))}}.bind(this))}},onRedraw:function(){if(this._showResult===true&&this.getOption("resultMode")==="row"){this._answersView.dispatchEvent("surveyRedraw")}if(this._userHasAlreadyAnswered===false||this._showResult===true){this.setCurrentQuestion(1)}},onSetModel:function(){if(this.getOption("fetchItemOnClick")===true&&!this.model.hasBeenFetched()){this.model.fetch(this.options&&this.options.modelFetchOptions);this.setOption("fetchItemOnClick",false)}}});return e});define("DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-switcher-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-view-with-rte","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-view-with-advanced-rte","DS/SwymUIComponents/script/feature/community/media/edit/media-creator-body-view","DS/SwymUIComponents/script/feature/community/media/edit/media-editor-body-view","DS/SwymUIComponents/script/feature/community/survey/edit/survey-creator-view","DS/SwymUIComponents/script/feature/community/wiki/edit/wiki-creator-view"],function(g,f,i,b,a,d,c,h){var e=f.extend({name:"content-editor-body-switcher-view",defaultOptions:{currentMode:"simpleRTE",contentEditorView:null},modes:{simpleRTE:{Class:i,dragZoneSelector:".post .content-edition",rteViewOptions:{isSimpleRTE:true}},instantMessageRTE:{Class:i,className:"instant-message-rte",dragZoneSelector:".message .content-edition",rteViewOptions:{overrideDefaultEnterBehaviour:true,enableEmojis:true,isInstantMessageRTE:true,disableTableOnPaste:true}},advancedRTE:{Class:b},mediaCreator:{Class:a},mediaEditor:{Class:d},surveyCreator:{Class:c},wikiCreator:{Class:h}},_getView:function(k){var j=this.getChildView(k);if(!j){j=this.addChildView(k,g.merge({model:this.model,communityId:this.options.communityId,contentEditorView:this.options.contentEditorView},this.modes[k]));this.listenTo(j,{onContentChange:this.contentChanged,onMediaUploadsStart:function(){this.dispatchEvent("onMediaUploadsStart",arguments)},onMediaUploadsComplete:function(){this.dispatchEvent("onMediaUploadsComplete")},onMediaUploadsFailure:function(){this.dispatchEvent("onMediaUploadsFailure")},onEnterKeyPressed:function(){this.dispatchEvent("onEnterKeyPressed")},onSwymImgPaste:function(){this.dispatchEvent("onSwymImgPaste")}.bind(this),onCopyPaste:function(l){}})}return j},_createContent:function(){return this._getCurrentView()},_getCurrentView:function(){return this._getView(this.options.currentMode)},switchTo:function(k){var j;if(k!==this.options.currentMode){this.oldMode=this.options.currentMode;this.setOption("currentMode",k);this.addEventOnce("onRedraw",function(){if(this._getCurrentView().refreshContent){j=this._getView(this.oldMode);j.cleanDndViewEvents();this._getCurrentView().refreshContent(j.getContentAttributes(),j.getMediaCollection())}}.bind(this));this.setCommunityId(this.options.communityId);this.refresh()}},setCommunityId:function(j){return this._getCurrentView().setCommunityId(j)},getCommunityId:function(){return this._getCurrentView().getCommunityId.apply(this,arguments)},contentChanged:function(){this.dispatchEvent("onContentChange")},getContentAttributes:function(){return this._getCurrentView().getContentAttributes()},isContentEmpty:function(){return this._getCurrentView().isContentEmpty()},resetContent:function(){if(this.model){this.stopReactingTo(this.model);this.model=null}return this._getCurrentView().resetContent()},resetEditorViews:function(){return this._getCurrentView().resetEditorViews()},getMediaCollectionLength:function(){return this._getCurrentView().getMediaCollectionLength()},getMediaCollection:function(){return this._getCurrentView().getMediaCollection()},uploadMedia:function(j){return this._getCurrentView().uploadMedia(j)},addMedia:function(j){return this._getCurrentView().addMedia(j)},validateContent:function(j){return this._getCurrentView().validateContent(j)},validateFirstStepContent:function(){return this._getCurrentView().validateFirstStepContent()},goToNextStep:function(){return this._getCurrentView().goToNextStep()},goToPreviousStep:function(){return this._getCurrentView().goToPreviousStep()}});return e});define("DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view",["UWA/Core","UWA/Event","UWA/Utils","UWA/Utils/Client","UWA/String","DS/SwymUICore/script/lib/event-manager","DS/SwymUICore/script/lib/view/generic/swym-model-view","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUIComponents/script/feature/community/content/edit/content-type-selector","DS/SwymUIComponents/script/feature/core/search/view/community-selector-view","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-body-switcher-view","DS/SwymUIComponents/script/utils/content-creation-types-manager","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUICore/script/feature/core/history/history-model","DS/SwymUICore/script/lib/model/generic/swym-model","DS/SwymUICore/script/lib/model/generic/6wtaggable-model","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUIComponents/script/feature/community/content/edit/paragraph-formatter","DS/SwymUIComponents/script/utils/content-upload-error","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/content/edit/content-creation-view","DS/UWPClientControls/PlatformNotify","DS/WebappsUtils/WebappsUtils","DS/Logger/Logger","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/core/auto-save/view/auto-save-view","DS/SwymUIComponents/script/feature/core/modal/super-modal","DS/UIKIT/Popover","DS/SwymUICore/script/feature/core/auto-save/auto-save-manager","DS/SwymUIComponents/script/feature/community/content/edit/rich-link-preview/rich-link-preview-utils","DS/SwymUICore/script/utils/localstorage-utils","DS/SwymUICore/script/utils/usage-tracker"],function(p,B,i,n,K,s,a,r,F,c,I,h,J,k,d,z,l,A,L,G,E,w,t,q,D,b,C,g,f,v,x,e,m,u){var y=C.isFeatureActivated("activateNewWiki"),j=C.isFeatureActivated("activateSurveyImprovements"),o=z.extend({_modelName:"content-creation-dummy-taggable-model"});var H=a.extend({_titleContent:"",_content:null,_context:null,_communityId:null,_uploadingState:false,_saveFailedDueToUploading:false,_publishDisabled:false,_previouslyActiveProxyManagers:null,_taggerProxyManager:null,_taggerProxyManagerName:"",_taggableModel:null,_taggerShowRequested:false,_fetchCommunities:true,_scrollerContentSelector:".editor-scroller-content",_modelEvents:{"onSync:read":"refresh"},name:"content-editor-view",className:"fade-in-animation",domEvents:{"click .publish-button":"onPublishButtonClick","click .next-button":"_goToNextStep","click .previous-button":"_goToPreviousStep","focusin .content-title-text":"onTitleFocus","blur .content-title-text":"onTitleInput","keydown .content-title-text":"onTitleKeydown","keyup .content-title-text":"onTitleInput","paste .content-title-text":"onTitlePaste","input .content-title-text":"onTitleInput","click .attachment":"_onOpenMediaLibrary","click .paragraph":"_onOpenParagraph","click .content-title-section .maximize":"switchToMaximizedView","click .content-editor-body-switcher-view-container":"onTitleOrBodyClick","click .content-title":"onTitleOrBodyClick","click .your-communities":"_onYourCommunitiesClick","click .content-edition .actions .fonticon-wrong":"onCancel"},uiConfiguration:{instantMessageRTE:{maximizeAvailableInMinimizedMode:false,mediaLibAvailableInMinimizedMode:false,saveAsDraft:false,expandOnClick:true},simpleRTE:{maximizeAvailableInMinimizedMode:true,mediaLibAvailableInMinimizedMode:true,saveAsDraft:true,expandOnClick:true},advancedRTE:{maximizeAvailableInMinimizedMode:false,mediaLibAvailableInMinimizedMode:false,saveAsDraft:true,expandOnClick:false,maximizedOnly:true},mediaCreator:{maximizeAvailableInMinimizedMode:false,mediaLibAvailableInMinimizedMode:false,saveAsDraft:true,expandOnClick:true},mediaEditor:{maximizeAvailableInMinimizedMode:false,mediaLibAvailableInMinimizedMode:false,saveAsDraft:false,expandOnClick:false,maximizedOnly:true},surveyCreator:{maximizeAvailableInMinimizedMode:false,mediaLibAvailableInMinimizedMode:false,saveAsDraft:true,expandOnClick:true,maximizedOnly:true},wikiCreator:{maximizeAvailableInMinimizedMode:false,mediaLibAvailableInMinimizedMode:false,saveAsDraft:false,expandOnClick:false,maximizedOnly:true}},executeListenerIfVisible:function(N){var M=this;return function(){if(M&&M.isVisible&&M.isVisible()){return N.apply(this,arguments)}}},onTitleKeydown:function(O){var N=[66,73,85];if(O.keyCode===13){O.preventDefault()}else{if(O.keyCode===9){var M=this.getChildView("body").getChildView("simpleRTE").getChildView("rte");if(!M._switchedToRTE){O.preventDefault();M.switchToRTE()}}else{if(O.ctrlKey&&(N.indexOf(O.keyCode)>=0)){O.preventDefault()}}}},getCreationModeFromModelName:function(M,N){var O;switch(M){case"media":if(this.model&&this.model.get("mid")){O="mediaEditor"}else{O="mediaCreator"}break;case"survey":O="surveyCreator";break;case"wiki":if(!p.is(N,"boolean")){N=this.isMaximized()}if(N){O="advancedRTE"}else{O="wikiCreator"}break;case"message":case"comment":O="instantMessageRTE";break;default:if(!p.is(N,"boolean")){N=this.isMaximized()}if(N){O="advancedRTE"}else{O="simpleRTE"}break}return O},getCurrentMode:function(M){var N;if(this.model&&this.model.get("mid")){N=this.getCreationModeFromModelName(this.model.getModelName(),true)}else{N=this._typesManager&&this.getCreationModeFromModelName(this.getOption("createMessagesOnly")===true?h.MESSAGE:this._typesManager.getCurrentContentType(),M)}return N},getClassNames:function(){var M=this._parent.apply(this,arguments)||"";if(this.uiConfiguration[this.getCurrentMode()]&&(this.uiConfiguration[this.getCurrentMode()].maximizedOnly===true)){M+=" detailed-content"}return M},_onOpenMediaLibrary:function(){u.trackPageEvent({category:"ContentCreation",label:"openMediaLibrary",view:"content-editor-view",event:"click"});if(!this.getElement(".attachment").hasClassName("disabled")){require(["DS/SwymUIComponents/script/feature/community/media/library/media-library-view"],function(N){var M=new N({communityId:this.getSelectedCommunityID()});M.injectInDom();this.listenTo(M,{newMediaAdded:function(P){var Q=P.newMedia,O=P.existingMedia;b.log("media should be uploaded");if(Q&&Array.isArray(Q)&&(Q.length>0)){this.addMedia(Q)}if(O&&Array.isArray(O)&&(O.length>0)){this.addMedia(O)}u.trackPageEvent({category:"ContentCreation",label:"uploadMedia",view:"content-editor-view",event:"upload"});M.destroy()}})}.bind(this))}},_onOpenParagraph:function(){var O=this.getChildView("paragraphFormatter"),P=this.container.getElement(".right-elements"),N=this.container.getElement(".left-elements .attachment"),M=this.container.getElement(".left-elements");event.stopPropagation();if(O&&O.isVisible()){O.hide();P&&P.show();N&&N.show();M&&M.removeClassName("activated");u.trackPageEvent({category:"ContentCreation",label:"closeParagraphFormatter",view:"content-editor-view",event:"click"})}else{O&&O.show();P&&P.hide();N&&N.hide();M&&M.addClassName("activated");u.trackPageEvent({category:"ContentCreation",label:"openParagraphFormatter",view:"content-editor-view",event:"click"})}},_isOnCreationMode:function(){if(!this.model||!this.model.get("mid")){return true}return false},switchToMaximizedView:function(O){var P=this.getElement(".maximize"),N=this.getChildView("paragraphFormatter"),M=this.container.getElement(".left-elements");u.trackPageEvent({category:"ContentCreation",label:O?"switchToAdvancedCreation":"automaticSwitchToAdvancedCreation",view:"content-editor-view",event:O?"click":""});if(P&&!P.hasClassName("disabled")&&!this._publishDisabled){if(this._isOnCreationMode()){this._context.setTemporaryState(true)}this.dispatchEvent("onSwitchToMaximizedView",[this]);this.container&&this.container.addClassName("detailed-content");N&&N.hide();M&&M.removeClassName("activated");this._getBodyView().switchTo(this.getCurrentMode(true));if(this._isOnCreationMode()){this._displayNewModelTaggerView()}this.maximizeTouchDevices();this._populateCommunitySelector();l.dispatchEvent("onInfiniteScrollDesactivationRequest");this.refresh()}},switchToMinimizedView:function(){this._setMinimizedContentCreation();this.dispatchEvent("onSwitchToMinimizedView",[this]);this.container&&this.container.removeClassName("detailed-content");this.unMaximizeTouchDevices();l.dispatchEvent("onInfiniteScrollActivationRequest");this.getControl("paragraphModal")&&this.getControl("paragraphModal").hide();this.refresh()},_navigateToPreviousContext:function(){var M=this.model;if(M&&!M.isNew()||this._typesManager.wasProgrammaticallyChanged()){k.back()}this.dispatchEvent("onBack",[this])},getCurrentContentType:function(){if(this.model&&this.model.get("mid")){return this.model.getModelName()}if(this.getOption("createMessagesOnly")===true){return h.MESSAGE}return this._typesManager.getCurrentContentType()},_getContenticonEl:function(){var M=this.getChildView("content-icon");if(!M){if(this.model&&!this.model.isNew()){M=p.createElement("div",{"class":"content-icon "+this.model.getModelName(),html:{tag:"span","class":"fonticon fonticon-2x fonticon-"+this.getOption("iconCls")}})}else{M=this.addChildView("content-icon",{Class:F})}}return M},_createTitleSection:function(P){var T=this.model,X=true,Z=t.Addapost,ab=t.AddATitle,Q=t.Addanidea,R=t.AddATitle,N=t.Addaquestion,S=t.AddATitle,ac=t.Addamedia,aa=t.AddATitle,Y=t.Addasurvey,O=t.AddATitle,W=t.Addawiki,U=t.AddATitle,V,M=p.createElement("span",{"class":"maximize left-icon fonticon fonticon-2x fonticon-resize-full"});if(T){this._titleContent=this.model.hasVirtuallyChanged("title")?T.getChanges("title"):T.get("title");if(T.getModelName()==="survey"&&(String(T.get("published")))==="1"){X=false}}V={"class":"content-title-section",html:[{"class":"content-title",html:[(X===false)?{tag:"div","class":"content-title-text",text:this._titleContent,value:this._titleContent}:{"class":"content-title-text",contenteditable:X,"data-placeholder-post":Z,"data-placeholder-idea":Q,"data-placeholder-question":N,"data-placeholder-media":ac,"data-placeholder-survey":Y,"data-placeholder-wiki":W,"data-placeholder-post-focused":ab,"data-placeholder-idea-focused":R,"data-placeholder-question-focused":S,"data-placeholder-media-focused":aa,"data-placeholder-survey-focused":O,"data-placeholder-wiki-focused":U,html:this._titleContent}]},(P?"":[this.addChildView("auto-save",{Class:g}),{tag:"span",html:M}])]};this.addControl("expandIconTooltip",new w({target:M,body:t.Maximize}));return V},_createActions:function(){var N,M=p.createElement("span",{"class":"fonticon fonticon-wrong"});N={"class":"actions",html:[this.addChildView("auto-save",{Class:g}),{tag:"span",html:M}]};this.addControl("cancelIconTooltip",new w({target:M,body:t.Cancel}));return N},_createBodyView:function(){var N=this.getChildView("body")&&this.getChildView("body").cid,M=this.addChildView("body",{Class:I,model:this.model,currentMode:this.getCurrentMode(),communityId:this._context.isCommunityContext()?this.getSelectedCommunityID():undefined,contentEditorView:this,addScroller:this.isMaximized(),checkModel:false,overrideDefaultEnterBehaviour:this.getCurrentContentType()==="message"||this.getCurrentContentType()==="comment"});if(N!==M.cid){this.listenTo(M,{onContentChange:this.onContentChange,onOpenMediaLibraryRequest:this._onOpenMediaLibrary,onEnterKeyPressed:function(){if((this.getCurrentContentType()==="message"||this.getCurrentContentType()==="comment")&&!this.isMasked()){m.removeItem(this._getLocalStorageKeyForMessage());this.mask();this.onPublish();this.resetBodyContent();this.unmask()}}.bind(this),onSwymImgPaste:function(){var O=h.getInstance();if(O.getContentTypes().indexOf(h.POST)===-1){this.alert("warn",t.MediaPasteNoRights)}else{setTimeout(function(){m.removeItem(this._getLocalStorageKeyForMessage());this._publishDisabled=false;this.switchToMaximizedView();O.setContentTypeRequest({type:"post",updateIcon:true,forceFocus:false,userAction:true})}.bind(this),0)}}.bind(this),onMediaUploadsStart:function(O){if(this.getCurrentMode()!=="mediaCreator"&&this._communityId){this.switchToUploadingState();this.dispatchEvent("onMediaUploadsStart")}},onMediaUploadsComplete:function(){if(this.getCurrentMode()!=="mediaCreator"&&this.getCurrentContentType()!=="message"){this.leaveUploadingState();this.dispatchEvent("onMediaUploadsComplete")}else{if(this.getCurrentContentType()==="message"){var O=h.getInstance();this.leaveUploadingState();this.dispatchEvent("onMediaUploadsComplete");if(K.stripTags(this.getBodyAttributes().content)){m.removeItem(this._getLocalStorageKeyForMessage());this._publishDisabled=false;this.switchToMaximizedView();O.setContentTypeRequest({type:"post",updateIcon:true,forceFocus:false,userAction:true})}else{O.setContentTypeRequest({type:"media",updateIcon:true,forceFocus:false,userAction:true})}this.expand()}}},onMediaUploadsFailure:function(){if(this.getCurrentMode()!=="mediaCreator"){this.leaveUploadingState();this.dispatchEvent("onMediaUploadsFailure")}}})}return M},_getBodyView:function(){var M=this.getChildView("body");if(!M){this._createBodyView();M=this.getChildView("body")}return M},_getCreationRightsMessage:function(){return p.createElement("div",{"class":"no-creation-rights err-msg",styles:{"word-break":"normal","overflow-wrap":"break-word","word-wrap":"break-word",display:"none","text-align":"center",padding:"15px 0 5px 0"},html:{tag:"span",html:[t.NoCreationRights," ",{tag:"a","class":"your-communities",html:t.YourCommunities}," ",t.ToBecomaAnAuthor,"."]}})},enablePublishRequest:function(){var O=this.getControl("publishButton"),Q=this.getControl("draftMenuButton"),P=this.getElement(".publish-section"),M=this.getElement(".content-editor-body-switcher-view-container"),N=this.getElement(".no-creation-rights");if(this._publishDisabled){this.expand()}this._publishDisabled=false;O&&O.setDisabled(this._publishDisabled);Q&&Q.setDisabled(this._publishDisabled);N&&N.hide();P&&P.show();M&&M.show()},disablePublishRequest:function(){var O=this.getControl("publishButton"),Q=this.getControl("draftMenuButton"),P=this.getElement(".publish-section"),M=this.getElement(".content-editor-body-switcher-view-container"),N=this.getElement(".no-creation-rights");this._publishDisabled=true;this.contract();O&&O.setDisabled(this._publishDisabled);Q&&Q.setDisabled(this._publishDisabled);P&&P.hide();M&&M.hide();N&&N.show()},_createPublishBarLeftElements:function(){var P={display:"none"},S=this._typesManager.getCurrentContentType(),M,O,R,N=this.getChildView("paragraphFormatter"),Q;if((n.Features.touchEvents)&&this.getChildView("body").getChildView("advancedRTE")&&!N){N=this.addChildView("paragraphFormatter",new A({className:"paragraph-touch",extraEditor:this.getChildView("body").getChildView("advancedRTE"),mode:"touch"}));N.hide()}if(S!=="media"){P=""}if((n.Features.touchEvents)&&this.getChildView("body").getChildView("advancedRTE")){M={tag:"span","class":"paragraph left-icon fonticon fonticon-2x fonticon-text"}}O=p.createElement("span",{"class":"attachment left-icon fonticon fonticon-2x fonticon-attach",styles:P});R=p.createElement("span",{"class":"arrow-right-shape",styles:P});Q={"class":"left-elements",html:[M,R,O,N]};if(O){this.addControl("attachmentIconTooltip",new w({target:O,body:t.InsertMedia}))}return this.getCurrentContentType()!=="survey"?Q:""},_goToPreviousStep:function(M){this._setNextButton();this.getControl("previousButton").hide();this._getBodyView().goToPreviousStep()},_goToNextStep:function(M){if(this.validateFirstStepContent()){this._setPublishButton();if(this.getControl("previousButton")){this.getControl("previousButton").show()}this._getBodyView().goToNextStep()}},_setPublishButton:function(){var M=this.getControl("publishButton");if(M){M.getContent().addClassName("publish-button");M.getContent().removeClassName("next-button");M.setIcon("check");M.setValue(t.Publish)}},_setNextButton:function(){var M=this.getControl("publishButton");if(M){M.getContent().removeClassName("publish-button");M.getContent().addClassName("next-button");M.removeIcon();M.setValue(t.Next)}},_createPublishBar:function(){var P,O,Q,M,N=j&&(this.getCurrentContentType()==="survey"&&(!this.model||(this.model&&this.model.get("published")==="0")));if(N){M=this.addControl("previousButton",new G({value:t.Previous,className:"default previous-button"}));M.hide()}this._publishDisabled=false;P=this.addControl("publishButton",new G({value:(N?t.Next:t.Publish),disabled:this._publishDisabled,className:(N?"primary next-button":"primary publish-button"),icon:(N?null:"check")}));Q=this.addControl("draftMenuButton",new G({disabled:this._publishDisabled,className:"primary",dropdown:{items:[{text:t.Saveasdraft,className:"draft-item"}]},events:{onDropdownClick:function(S,R){b.log(R);this.onPublishButtonClick(null,{published:0})}.bind(this)}}));O=new E({buttons:[P,Q]});if((this.model&&(parseInt(this.model.get("published"),10)===1))||this.getCurrentContentType()==="wiki"){Q.hide();P.elements.container.addClassName("btn-group-alone")}else{Q.show()}return{"class":"publish-section"+(this._context.isCommunityContext()?" community":""),html:[(y?this._createPublishBarLeftElements():null),{"class":"right-elements",html:[(this._isOnCreationMode()?this.getCommunitySelector():null),{tag:"div","class":"buttons",html:[(j?M:""),O,this.addControl("cancelButton",new G({value:t.Cancel,className:"default btn-cancel",styles:{width:""},icon:"wrong",events:{onClick:function(){this.onCancelBound()}.bind(this)}}))]}]}]}},removeInvalidationForPublish:function(){this.container&&this.container.hasClassName("invalid")&&this.container.removeClassName("invalid")},markViewAsInvalidForPublish:function(){q.info(t.get("Somerequiredfieldsaremissing"));this.container&&!this.container.hasClassName("invalid")&&this.container.addClassName("invalid")},_createContent:function(){var M=this._createBodyView(),O=this._createPublishBar(),N=[{"class":"editor-scroller-content",html:[this._getContenticonEl(),this._createTitleSection(true),(y?this._createActions():null),M]},this._getCreationRightsMessage(),O];if(n.Features.touchEvents){N=[this._getContenticonEl(),{"class":"editor-scroller-content",html:[this._createTitleSection(true),this._createActions(),O,M]},this._getCreationRightsMessage()]}return[this.isMaximized()?"":this.addChildView("repliedContentView",{Class:"DS/SwymUIComponents/script/feature/community/content/edit/replied-content-view",creationMode:true}),{"class":"content-edition",html:this.isMaximized()?N:[this._getContenticonEl(),this._createTitleSection(false),M,this._getCreationRightsMessage(),O]}]},changeContentTypeClass:function(N){var O=this,M=this._typesManager.getAllPossibleContentTypes();M.forEach(function(P){if(P===N){!O.container.hasClassName(P)&&O.container.addClassName(P)}else{O.container.hasClassName(P)&&O.container.removeClassName(P)}})},onTitleFocus:function(M){var N=B.getElement(M),O=N.getText();this._titleContent=O},_pasteHtmlAtCaret:function(N){var R,M;if(window.getSelection){R=window.getSelection();if(R.getRangeAt&&R.rangeCount){M=R.getRangeAt(0);M.deleteContents();var O=document.createElement("div");O.innerHTML=N;var S=document.createDocumentFragment(),Q,P;while((Q=O.firstChild)){P=S.appendChild(Q)}M.insertNode(S);if(P){M=M.cloneRange();M.setStartAfter(P);M.collapse(true);R.removeAllRanges();R.addRange(M)}}}else{if(document.selection&&document.selection.type!="Control"){document.selection.createRange().pasteHTML(N)}}},onTitlePaste:function(M){var N;if(window.clipboardData&&window.clipboardData.getData){N=window.clipboardData.getData("Text")}else{if(M.clipboardData&&M.clipboardData.getData){N=M.clipboardData.getData("text/plain")}}N=N?N.replace(/(\r\n|\n|\r)/gm,""):"";M.preventDefault();this._pasteHtmlAtCaret(N);this.onTitleInput(M)},onTitleInput:function(M){var N=B.getElement(M),O=N.getText().trim();if(O!==this._titleContent){if(N.innerHTML==="<br>"){N.innerHTML=""}this._titleContent=O;this.dispatchEvent("onContentTitleChange",[O])}},onContentTitleChange:function(M){this.onContentChange();if(this.model){this.model.addChanges("title",M)}},isContentEmpty:function(){var M=false;if((this._titleContent.length<=0)&&(this.isBodyContentEmpty())){M=true}return M},isBodyContentEmpty:function(){return this._getBodyView().isContentEmpty()},resetBodyContent:function(){return this._getBodyView().resetContent()},resetEditorViews:function(){return this._getBodyView().resetEditorViews()},getMediaCollectionLength:function(){return this._getBodyView().getMediaCollectionLength()},uploadMedia:function(M){return this._getBodyView().uploadMedia(M)},addMedia:function(M){return this._getBodyView().addMedia(M)},getBodyAttributes:function(M){return this._getBodyView().getContentAttributes(M)},validateContent:function(N,M){return this._getBodyView().validateContent(N)},validateFirstStepContent:function(){return this._getBodyView().validateFirstStepContent()},_getLocalStorageKeyForMessage:function(){return"3DSwym-"+this._communityId+"-message"},onContentChange:function(){if(this.isContentEmpty()&&(!(this.getCurrentContentType()==="survey"&&this.isMaximized()))){this.markContentAsEmpty();this._clearAutoSave()}else{this.removeInvalidationForPublish();this.markContentAsNonEmpty();this._launchAutoSave()}if(this.getCurrentContentType()==="message"){var M=this.getBodyAttributes();if(M&&M.content){m.setItem(this._getLocalStorageKeyForMessage(),M.content)}}},markContentAsNonEmpty:function(){var M=this.getElement(".content-edition");if(M&&!M.hasClassName("non-empty")){M.addClassName("non-empty");this.expand()}},markContentAsEmpty:function(){var M=this.getElement(".content-edition");if(M&&M.hasClassName("non-empty")){M.removeClassName("non-empty")}},canPublishOrSaveAsDraft:function(Q){var O=false,N=Boolean(Q&&Q.published===0),P=(this._titleContent.length>0&&this._titleContent.length<256)||(this.getCurrentMode()==="mediaCreator")||(this.getCurrentContentType()==="message"),M=this.validateContent({publish:!N,saveAsDraft:N});if(P&&M){O=true}else{if(Q&&(Q.published===0)){if(P||M){O=true}else{if(P===false){this.getElement(".content-title-text").focus()}else{if(M===false){this._getBodyView().getElement(".editable-container").focus()}}}}else{if(P===false){if(this._titleContent.length===0){this.emptyTitle()}this.getElement(".content-title-text").focus()}else{if(M===false){this._getBodyView().getElement(".editable-container").focus()}}}}if(this._titleContent.length>255){q.error(t.TitleSizeExceeded)}return O},switchToUploadingState:function(M){this._uploadingState=true;if(!(M&&M.maskView===false)){this._uploadMask=true;this.mask(t.UploadingMedia)}},leaveUploadingState:function(){if(this._uploadingState===true){this._uploadingState=false;this._saveFailedDueToUploading=false;if(this._uploadMask===true){this._uploadMask=false;this.unmask()}}},switchToPublishingState:function(){if(this.getCurrentContentType()!=="message"){this.mask(t.Publishing)}},switchToSavingAsDraftState:function(){this.mask(t.SavingAsDraft)},_setDefaultTitleAndPlaceholder:function(N){var M=this;if(N.hasBeenFetched()&&N.length===0&&N.communityId===M._context.getData().communityId){M.expand()}},setTitleValue:function(N){var M=this.getElement(".content-title-text");this._titleContent=N;if(M){M.setText(this._titleContent)}},init:function(){this.onCancelBound=this.onCancel.bind(this);this.onCancelBoundIfVisible=this.executeListenerIfVisible(this.onCancelBound);this.onCommunityChangeBound=this.onCommunityChange.bind(this);this.onContentTypesChangeBound=this.onContentTypesChange.bind(this);this.onCurrentContentTypeChangeBound=this.onCurrentContentTypeChange.bind(this);this.onCurrentContentTypeChangeBoundIfVisible=this.executeListenerIfVisible(this.onCurrentContentTypeChangeBound);this._onContextChangeAttemptBound=this._onContextChangeAttempt.bind(this);return this._parent.apply(this,arguments)},setup:function(){var M=this;if(n.Features.touchEvents){this.uiConfiguration.simpleRTE.maximizedOnly=true;this.uiConfiguration.simpleRTE.mediaLibAvailableInMinimizedMode=true;this.uiConfiguration.advancedRTE.mediaLibAvailableInMinimizedMode=true}this._context=J.getInstance();this._typesManager=h.getInstance();this._context.addListener("onBack",this.onCancelBoundIfVisible);this.autoSave=x.getInstance();if(this._isOnCreationMode()){this._context.addListener("onCommunityChange",this.onCommunityChangeBound,this,true);if(this.getOption("createMessagesOnly")!==true){this._typesManager.addEvent("onContentTypesChange",this.onContentTypesChangeBound,this,true);this._typesManager.addEvent("onCurrentContentTypeChange",this.onCurrentContentTypeChangeBoundIfVisible,this,true)}}if(this.uiConfiguration[this.getCurrentMode()].expandOnClick===true){this.onDocumentBodyClickBound=this.onDocumentBodyClick.bind(this);document.body.addEvent("click",this.onDocumentBodyClickBound)}this._context.addListener("onContextChangeAttempt",this._onContextChangeAttemptBound,this,false);M.reactTo(l,{onCommunityWhatsnewEmpty:function(N){if(N==="whatsnew"){if(M._context.isCommunityContext()){l.dispatchEvent("GetItemListCollection")}}},ReturnItemListCollection:M._setDefaultTitleAndPlaceholder});if(M._context.isCommunityContext()){l.dispatchEvent("GetItemListCollection")}this._context.dispatchEvent("onContentEditorViewRendered");this.listenTo(s,"onEventReply",function(O){if(O&&O.model){this.repliedModel=O.model;var N=h.getInstance(),Q=this.repliedModel.get("message_type"),R="message";if(Q==="INTERNAL_EVENT"){R="comment"}N.setContentTypeRequest({type:R,updateIcon:true,forceFocus:false,commentSubjectContentType:this.repliedModel.get("message_details->subject_model")});var P=this._getBodyView()._getCurrentView().getChildView("rte");if(P){P.updateEditor();this.enablePublishRequest();this.expand()}}}.bind(this));return this._parent.apply(this,arguments)},_onContextChangeAttempt:function(M){if(this.isVisible()&&this.isMaximized()){if(!this.model&&(this._context.isHomePageContext()||this._context.isCommunityHomePageContext())){this.onCancel(!(M&&M.success))}}},_onAutoSave:function(){if(this.isVisible()){var O=this,M=h.getInstance(),N;if(!this.autoSave.hasBeenRestored){N=this.autoSave.getAutoSaveModel();if(N){O.getChildView("body")&&O.getChildView("body").resetContent();O.model=N;O.setTitleValue(N.getChanges("title")||N.get("title"));if(N.get("revision_description")){O.getControl("majorEditionCheckbox")&&O.getControl("majorEditionCheckbox").setCheck();O.getControl("revisionInput")&&O.getControl("revisionInput").setValue(N.get("revision_description"));O.getControl("revisionInput")&&O.getControl("revisionInput").show()}if(!N.get("mid")&&!O.isMaximized()){O.refresh();O.switchToMaximizedView();M.setContentTypeRequest({type:N.getModelName(),updateIcon:true,forceFocus:false,userAction:true})}this.autoSave.hasBeenRestored=true}else{this.autoSave.addEventOnce("onContentRecoveryRequest",this._onAutoSave,this)}}}},isMaximized:function(){if(this.container){return this.container.hasClassName("detailed-content")}return false},onRedraw:function(){this.container.addClassName(this.getCurrentContentType());if(this.container.getElement(".publish-section")){this.container.getElement(".publish-section").setHTML(this._createPublishBar().html)}},setCommunityId:function(M){return this._getBodyView().setCommunityId(M)},_updateInstantMessageEditorIfLocalStorage:function(){if(this.getCurrentContentType()==="message"){var N=m.getItem(this._getLocalStorageKeyForMessage()),M=this._getBodyView()._getCurrentView().getChildView("rte");if(M){if(N&&K.unescapeHTML(N)){M.updateEditor(N)}else{M.resetEditor()}}}},onCommunityChange:function(){var M;if(!this.isDestroyed()){M=this.getCommunitySelector();if(this._context.isCommunityContext()){if(M&&M.container){M.container.addClassName("hidden")}this.getElement(".publish-section")&&this.getElement(".publish-section").addClassName("community");this._communityId=this._context.getData().communityId;if(!this._context.isContentContext()){this.setCommunityId(this._communityId)}l.dispatchEvent("GetItemListCollection")}else{this._communityId=null;this.setCommunityId(this._communityId);if(M&&M.container){M.container.removeClassName("hidden")}this.getElement(".publish-section")&&this.getElement(".publish-section").removeClassName("community")}if(!this._context.contentId){if(this.getOption("createMessagesOnly")!==true){this.isRendered()&&this.updateContentType()}}this.removeRepliedContent();this._updateInstantMessageEditorIfLocalStorage()}},onTitleOrBodyClick:function(){if(this.getCurrentMode()!=="wikiCreator"){if((!this.isMaximized())&&(this.uiConfiguration[this.getCurrentMode()].maximizedOnly===true)&&this.getCurrentContentType()!==h.MESSAGE&&this.getCurrentContentType()!==h.COMMENT){this.switchToMaximizedView();var M=this.getElement(".content-title-text");M.focus()}}else{this.dispatchEvent("showWikiEditor")}},onDocumentBodyClick:function(M){var N,O,P=B.getElement(M);if(this._isOnCreationMode()){if((!this.isMaximized())&&(this.uiConfiguration[this.getCurrentMode()].expandOnClick===true)){P=B.getElement(M),N=this.getElement(".content-edition");if(N){if((N.contains(P)||(p.is(O=P.getParent())&&(O.hasClassName("draft-item")||(O.hasClassName("autocomplete-item")&&O.getParent(".community-selector-view-container"))))||P.getParent(".type-selector"))&&(P!==this.getElement(".btn-cancel"))&&(P!==this.getElement(".fonticon-wrong"))&&(!P.getParent(".content-type-selector-container")||P.getParent(".content-type-selector-container")&&N.getParent().hasClassName("expanded"))){if(!N.getParent().hasClassName("expanded")){this.expand()}}else{if(!N.hasClassName("non-empty")){this.contract()}}}}}},_getNewDummyTaggableModel:function(){return new o({subject6wuri:i.getUUID(),tags6w:[],tags6w_implicit:[]},{provokeCacheUpdates:false})},_displayNewModelTaggerView:function(){var M=r.getInstance();if(this._isOnCreationMode()){var N=this.getOption("taggingContextManager");if(N&&!this._taggerProxyManager){if(window.ds&&window.ds.env==="3DSwym"){if(!M.isBootstrapConditionMet("TopFrameInit")){M.executeWhenBootstrapConditionIsMet("TopFrameInit",this._displayNewModelTaggerView.bind(this));return null}}if(!this._taggableModel){this._taggableModel=this._getNewDummyTaggableModel()}this._taggerProxyManagerName=i.getUUID();this._previouslyActiveProxyManagers=N.getActiveProxiesManagers();this._taggerProxyManager=N.createProxyManager(this._taggerProxyManagerName,{persistTags:false,client:this._taggableModel});this.options.taggingContextManager.setProxyManagerAsCurrent(this._taggerProxyManagerName);if(M.isFeatureActivated("activate_explicit_tags_thru_server")===false){this._taggerProxyManager.disableTaggingMode()}}}},_switchTaggerBackToPreviousState:function(){var M=this.getOption("taggingContextManager");if(this._taggableModel&&M&&this._taggerProxyManager){if(this._taggerProxyManager.isActive()){this.options.taggingContextManager.setProxyManagersAsCurrent((this._previouslyActiveProxyManagers&&Object.keys(this._previouslyActiveProxyManagers)||[]))}this._previouslyActiveProxyManagers=null;if(this._taggerProxyManagerName){this.options.taggingContextManager.destroyProxyManager(this._taggerProxyManagerName);this._taggerProxyManagerName=""}this._taggerProxyManager=null;this._taggableModel=null}},_populateCommunitySelector:function(){var M=this.getCommunitySelector();if(M&&this._fetchCommunities&&!this._context.isCommunityContext()){this._fetchCommunities=false;M.populateCommunityCollection({communityId:this.model?this.model.get("community").mid:null})}},expand:function(){if(!this._publishDisabled&&(!(n.Platform.ios&&this.getCurrentContentType()!==h.MEDIA)||window.ds&&window.ds.env!=="3DSwym"&&n.Features.touchEvents)){this.container&&this.container.addClassName("expanded")}this._populateCommunitySelector()},focusOnTitleInput:function(){var N=this,M=this.getElement(".content-title-text"),O=this.getElement(".editable-container");if(this.getCurrentContentType()===h.MESSAGE&&O){O.focus();setTimeout(function(){O.focus()});return true}else{if(M){M.focus();setTimeout(function(){M.focus()});N.expand();return true}}return false},contract:function(){this.container&&this.container.removeClassName("expanded")},removeRepliedContent:function(){var M=this.getChildView("repliedContentView");if(M&&M.model){M.cancel()}},onContentTypesChange:function(){this.updateContentType()},onCurrentContentTypeChange:function(O){var P,N=this.getElement(".content-title-text"),M=this.getCurrentContentType();this.updateContentType();this.removeRepliedContent();switch(M){case h.SURVEY:break;case h.WIKI:break;case h.COMMENT:case h.MESSAGE:case h.MEDIA:P=this.getChildView("auto-save");if(P){P.clear()}break;default:break}if(n.Features.touchEvents){if(O&&O.forceFocus&&(M!==h.MEDIA&&M!==h.MESSAGE&&M!==h.COMMENT)){this.switchToMaximizedView()}}if(O&&O.forceFocus===true){if(N){this.focusOnTitleInput()}else{this.addEventOnce("onRender",this.focusOnTitleInput)}}},updateContentType:function(){var P,N=this.getCurrentContentType(),O=this.getCurrentMode(),M=this.autoSave&&this.autoSave.getAutoSaveModel();if(!this._context.isCommunityContext()){P=this.getCommunitySelector();P&&P.setModelParam(N,{communityId:M?M.get("community").mid:null})}else{this.enablePublishRequest()}this.changeContentTypeClass(N);this.configureUI(this.uiConfiguration[O]);switch(N){case h.MEDIA:this._setMinimizedContentCreation();if(j){this._setPublishButton()}break;case h.SURVEY:if(j){this._setNextButton()}break;case h.MESSAGE:case h.COMMENT:if(this.isMaximized()){this.resetBodyContent();this.switchToMinimizedView()}break;default:this._setSimpleRTEMode();if(j){this._setPublishButton()}}if(N===h.MESSAGE||N===h.COMMENT){this._publishDisabled=true}else{this._publishDisabled=false}this._getBodyView().switchTo(O);this.removeInvalidationForPublish()},_setMinimizedContentCreation:function(){this.contract();this._getBodyView().switchTo(this.getCurrentMode(false));if(this._isOnCreationMode()){this._switchTaggerBackToPreviousState()}this.hideTagger()},_setSimpleRTEMode:function(){},_maximizeIconManager:function(N){var M=this.getElement(".content-title-section .maximize");if(M){if(N){M.setStyle("display","")}else{M.setStyle("display","none")}}},_attachmentIconManager:function(N){var M=this.getElement(".publish-section .attachment");if(M){if(N){M.setStyle("display","")}else{M.setStyle("display","none")}}},configureUI:function(N){var M,O;if(N){if((N.maximizeAvailableInMinimizedMode!==undefined)&&(!this.isMaximized())){if(N.maximizeAvailableInMinimizedMode===true){this._maximizeIconManager(true)}else{this._maximizeIconManager(false)}}else{this._maximizeIconManager(false)}if((N.mediaLibAvailableInMinimizedMode!==undefined)&&(!this.isMaximized())){if(N.mediaLibAvailableInMinimizedMode===true){this._attachmentIconManager(true)}else{this._attachmentIconManager(false)}}else{n.Features.touchEvents&&N.mediaLibAvailableInMinimizedMode?this._attachmentIconManager(true):this._attachmentIconManager(false)}if(N.saveAsDraft!==undefined){M=this.getElement(".publish-section .dropdown-toggle");O=this.getControl("publishButton");if(M){if(N.saveAsDraft===true&&this.getCurrentContentType()!=="wiki"){M.setStyle("display","");O.getContent().removeClassName("btn-group-alone")}else{M.setStyle("display","none");O.getContent().addClassName("btn-group-alone")}}}}},getCommunitySelector:function(){var M=this.getChildView("communitySelector");if(!M&&!this.isDestroyed()){M=this.addChildView("communitySelector",{Class:c,modelParam:this.getCurrentContentType(),events:{disablePublishRequest:this.disablePublishRequest.bind(this),enablePublishRequest:this.enablePublishRequest.bind(this)}});M.addEvent("onCommunitySelectChange",function(N){this.setCommunityId(N)}.bind(this))}return M},getSelectedCommunityID:function(){if(this.model&&this.model.get("mid")){this._communityId=this.model.getCommunity().get("mid")}return this._communityId||(this.getCommunitySelector()?this.getCommunitySelector().getSelectedCommunity():"")},_launchAutoSave:function(){if(!this.isContentEmpty()||this.getCurrentContentType()==="survey"){u.trackPageEvent({category:"AutoSave",label:"contentSaved",view:"content-editor-view"});this.getChildView("auto-save").onContentChanged(this)}},_clearAutoSave:function(){this.getChildView("auto-save").clear()},emptyTitle:function(){var M=this.getElement(".content-title-text");M&&M.empty();this._titleContent=""},_confirmCancel:function(M,O){if(M!==false){if((!this.isContentEmpty()&&!this.model||(this.model&&this.model.hasVirtuallyChanged()))&&!O){var N=this.addControl("removeConfirmationModal",new f({closable:false}));N.confirm({title:t.Cancel,message:t.AreYouSure,callback:function(P){if(P===true){this.onCancel(true,true);u.trackPageEvent({category:"ContentCreation",label:"cancelCreation",view:"content-editor-view",event:"click"})}}.bind(this)});return false}this._navigateToPreviousContext()}return true},onCancel:function(M,O){var N=this.getCurrentContentType()==="message";if(this._confirmCancel(M,O)){if(!this.isDestroyed()){if(this._isOnCreationMode()){if(this.model){this.model=null;this.removeChildView("body")}this.emptyTitle();if(!N){this.resetBodyContent()}if(this.isMaximized()){this.switchToMinimizedView()}this._context.setTemporaryState(false);this.emptyTitle();if(!N){this.resetBodyContent()}this.removeInvalidationForPublish();this._clearAutoSave();this.onContentChange()}else{this.model.removeChanges();this._clearAutoSave();if(!N){this.resetBodyContent()}this.refresh()}this.resetEditorViews();this.contract()}this._typesManager.setContentTypeRequest({type:"message",updateIcon:true,forceFocus:true,resetUserAction:true})}},onPublishButtonClick:function(M,N){if(this.canPublishOrSaveAsDraft(N)===true){this.removeInvalidationForPublish();this.onPublish(M,N)}else{this.markViewAsInvalidForPublish()}},onPublish:function(U,M){if(this._uploadingState!==false){if(this._saveFailedDueToUploading===false){this._saveFailedDueToUploading=true;this.switchToUploadingState();this.addEventOnce("onMediaUploadsComplete",this.onPublish.bind(this,U,M))}return this}if(this.getCurrentMode()==="mediaCreator"){this.onNewMediaPublish(U,M)}else{var N,Q,S,T,O,R=M||{},P=this;if((N=this.getElement(".content-title-text"))){Q=(N.getText());S=this.getSelectedCommunityID();T=this.getCurrentContentType();O=p.merge(p.merge(R,{title:Q,community_id:S,published:1,isDMContext:P._context.isDirectMessageContext(),contentType:T}),this.getBodyAttributes());if(!P.model){O.author=r.getInstance().get("user")}if(this.getCurrentMode()==="instantMessageRTE"){var W=this.getChildView("repliedContentView");if(W&&W.model){var V=W.model;if(V.getModelName()==="community-event"){O.parentCommentUri=V.get("message_details->parent_uri")||V.get("message_details->model_uri");O.subject6wuri=V.get("subject_uri");O.parentMessageUUID=V.get("mid");O.subject_model=V.get("message_details->subject_model");O.subject_title=V.get("message_details->subject_title");O.subject_id=V.get("message_details->subject_id")}else{O.parentMessageUri=V.getInstantMessage().get("subject6wuri");O.parentMessageUUID=V.get("mid")}}}b.log(Q,S,T);if((((!this.isContentEmpty()))||(O.published!==1))&&S&&T){if(this.getMediaCollectionLength()>0){P.switchToUploadingState();this.uploadMedia({communityId:S,onUploadsComplete:function(){O=p.merge(P.getBodyAttributes(),O);P.leaveUploadingState();P.saveContent(O)},onUploadsFailure:function(X){P.leaveUploadingState();L.printErrorMessage(X,"media")}})}else{this.saveContent(O)}}else{b.error("All conditions not met for a publish")}}}this._clearAutoSave()},saveContent:function(P){var S=this,T,N=false,M=(P.published!==1),O,R,Q=S._context.isDirectMessageContext(),U={onComplete:function(V){b.log("onSuccess",arguments);if(!S.isDestroyed()){if(M){S._context.reset({path:(Q?"dm":"community")+":"+P.community_id+"/"+J.COMMUNITY_MY_CONTRIBUTIONS});S.onCancel(false,true);setTimeout(S.switchToMinimizedView.bind(S))}else{if(S.isMaximized()){if(V){if(V.getModelName()==="survey"&&!V.isOpen()){S.alert("info",t.CreatedSurveyNotOpenAlert)}T=S.getSelectedCommunityID();S._context.reset({contentType:V.getModelName(),communityId:T,dmId:(Q?T:undefined),contentId:V.get("mid"),editionMode:false})}S.onCancel(false,true)}else{S.onCancel(true,true)}}S.unmask()}if(M){u.trackPageEvent({category:"ContentCreation",label:"saveAsDraft",view:"content-editor-view",event:"click",contentType:V?V.getModelName():"instant-message"});S.alert("success",t.Thedraftwassavedsuccessfully)}else{u.trackPageEvent({category:"ContentCreation",label:"publishContent",view:"content-editor-view",event:"click",contentType:V?V.getModelName():"instant-message"})}S._context.setTemporaryState(false)},onFailure:function(W,V){require(["DS/SwymUICore/script/feature/core/error/error"],function(X){u.trackPageEvent({category:"ContentCreation",label:"publishFailed",view:"content-editor-view",event:"click"});X.displayError(V&&V.errorcode)});S.unmask()}};this.transformURLPreviewsBeforeSave(P);if(this.model&&this.model.get("mid")){if(M){U.notify="draft";this.switchToSavingAsDraftState()}else{U.notify="publish";this.switchToPublishingState()}this.model.save(P,U)}else{if(!M){U.notify="publish";this.switchToPublishingState()}else{U.notify="draft";this.switchToSavingAsDraftState()}if(!this._taggableModel){N=true;this._taggableModel=this._getNewDummyTaggableModel()}if(P.contentType==="survey"){O="";R="";(this._taggableModel.get("questions")||[]).forEach(function(V){O+=(V.description||"")});(P.questions||[]).forEach(function(V){R+=(V.description||"")})}else{O=this._taggableModel.get("content")||"";R=P.content}this._taggableModel.deriveTagActionsFromContentChanges(O,R);p.extend(P,this._taggableModel.getChanges());if(N){this._taggableModel=null}d.saveModelWithDefaultParams(P.contentType,P,U)}},transformURLPreviewsBeforeSave:function(M){if((M.contentType==="survey")&&(M.questions.length>0)){M.questions.forEach(function(N){N.description=e.convertURLPreviewToLink(N.description,false)})}else{M.content=e.convertURLPreviewToLink(M.content,false)}},showTagger:function(){if(this.isVisible()&&(r.getInstance().isFeatureActivated("activate_explicit_tags_thru_server")!==false)){this._taggerShowRequested=true;this._context.dispatchEvent("onTaggerShowRequest")}},hideTagger:function(){if(this._taggerShowRequested===true){this._taggerShowRequested=false;this._context.dispatchEvent("onTaggerHideRequest")}},onNewMediaPublish:function(Z,T){var P,V,W,Y,R={},O=[],N=T||{},U=this,X=this._getBodyView(),aa=X.getMediaCollection();if(aa){O=aa.toArray()}P=this.getElement(".content-title-text");V=(P.getText());W=this.getSelectedCommunityID();Y=this.getCurrentContentType();if(O&&O.length){for(var S=0,Q=O.length;S<Q;S++){R=p.merge(N,p.merge({community_id:W,published:1,contentType:Y,author:r.getInstance().get("user"),download_original_file:"0"},X.getContentAttributes()));if(V!==""){var ab;if(Q>1){ab=V+"-"+(S+1)}else{ab=V}R.title=ab}O[S].setCustomProperty("changesToBeSaved",p.clone(R))}var M=(R.published!==1);if(M){this.switchToSavingAsDraftState()}else{this.switchToPublishingState()}X.uploadMedia({mediaToBeUploaded:O,notify:M?"draft":"publish",onUploadsComplete:function(){U.onCancel(true,true);U.unmask();if(M){U.alert("success",t.Thedraftwassavedsuccessfully);var ac=U._context.isDirectMessageContext();U._context.reset({path:(ac?"dm":"community")+":"+R.community_id+"/"+J.COMMUNITY_MY_CONTRIBUTIONS})}else{if(R.is_illustration===true){U.alert("success",(O.length>1)?t.get("Yourmediahavebeensuccessfullypublished"):t.get("Yourmediahasbeensuccessfullypublished"))}}},onUploadsFailure:function(ac){b.log("onUploadsFailure");L.printErrorMessage(ac,"media");U.unmask()}})}},_onYourCommunitiesClick:function(){this._context.reset({path:J.MY_COMMUNITIES})},onRender:function(){this.maximizeTouchDevices();this._updateInstantMessageEditorIfLocalStorage();return this._parent.apply(this,arguments)},onShow:function(){this.maximizeTouchDevices();return this._parent.apply(this,arguments)},onInjected:function(){if(!this.autoSave.hasBeenRestored){this._onAutoSave()}},onHide:function(){if(this.isMaximized()){if(this.model){this.hideTagger()}this.unMaximizeTouchDevices()}return this._parent.apply(this,arguments)},maximizeTouchDevices:function(){if(n.Features.touchEvents&&this.isMaximized()){this._widget.dispatchEvent("onMaximizeTouchDevices")}},unMaximizeTouchDevices:function(){if(n.Features.touchEvents){this._widget.dispatchEvent("unMaximizeTouchDevices")}},destroy:function(){if(this.onDocumentBodyClickBound){document.body.removeEvent("click",this.onDocumentBodyClickBound)}this.onCancelBoundIfVisible&&this._context.removeListener("onBack",this.onCancelBoundIfVisible);this.autoSave&&this.autoSave.removeEvent("onContentRecoveryRequest",this._onAutoSave);if((this.getOption("createMessagesOnly")!==true)){this.onContentTypesChangeBound&&this._typesManager.removeEvent("onContentTypesChange",this.onContentTypesChangeBound);this.onCurrentContentTypeChangeBoundIfVisible&&this._typesManager.removeEvent("onCurrentContentTypeChange",this.onCurrentContentTypeChangeBoundIfVisible)}this.onCommunityChangeBound&&this._context.removeListener("onCommunityChange",this.onCommunityChangeBound);if(this._onContextChangeAttemptBound){this._context.removeListener("onContextChangeAttempt",this._onContextChangeAttemptBound)}this._previouslyActiveProxyManagers=null;this._taggerProxyManager=null;this._taggableModel=null;if(this.model){this.model.removeChanges()}this._parent.apply(this,arguments)}});return H});define("DS/SwymUIComponents/script/feature/community/idea/edit/idea-edit-view",["UWA/Core","DS/SwymUICore/script/feature/community/idea/model/idea-model","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view"],function(d,c,a){var b=a.extend({_modelClass:c,name:"idea-edit-view"});return b});define("DS/SwymUIComponents/script/feature/community/content/edit/content-creation-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-view","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view","DS/SwymUIComponents/script/utils/content-creation-types-manager","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/SwymUICore/script/feature/core/context/context-model"],function(f,c,e,g,d,a){var b=c.extend({name:"content-creation-view",domEvents:{resize:"onViewResize"},onViewResize:function(){if(this.options.dispatchResize===true){d.dispatchEvent("onContentCreationViewResize",[this])}},init:function(){var i=this,h=this._parent.apply(this,arguments);this.onContentTypesChangeBound=this.onContentTypesChange.bind(this);this.onCurrentContentTypeChangeBound=this.onCurrentContentTypeChange.bind(this);this.onContentTypeIconChangeBound=this.onContentTypeIconChange.bind(this);this._typesManager=g.getInstance();if(this.getOption("createMessagesOnly")!==true){this._typesManager.addEvent("onContentTypesChange",this.onContentTypesChangeBound,null,true);this._typesManager.addEvent("onCurrentContentTypeChange",this.onCurrentContentTypeChangeBound,null,true);this._typesManager.addEvent("onContentTypeIconChange",this.onContentTypeIconChangeBound,null,true)}return h},_createWikiEditorView:function(j){var i=this,h=i.getChildView("wikiEditorView");if(!h){h=i.addChildView("wikiEditorView",new j({taggingContextManager:i.getOption("taggingContextManager"),creation:true}));i.listenTo(h,{onSwitchToMaximizedView:i._onSwitchToMaximizedView,onWikiCancel:function(){i._onSwitchToMinimizedView();i.getChildView("editorView").switchToMinimizedView()}});if(i.getElement(".community-content-wrapper")){h.inject(i.getElement(".community-content-wrapper"))}}return h},setup:function(){var h=this;h._parent.apply(h,arguments);h.listenTo(h.addChildView("editorView",new e({taggingContextManager:h.getOption("taggingContextManager"),createMessagesOnly:h.getOption("createMessagesOnly")})),{onSwitchToMaximizedView:h._onSwitchToMaximizedView,onSwitchToMinimizedView:h._onSwitchToMinimizedView,onCommunityChange:function(j){if(h._typesManager.getCurrentContentType()!=="wiki"){h.getChildView("editorView").setCommunityId(j)}else{var i=h.getChildView("wikiEditorView");if(i){i.setCommunityId(j)}}},showWikiEditor:h.showWikiEditor})},onContentTypesChange:function(h){if(h&&h.contentTypes){if(h.contentTypes.length>0){this.show()}else{this.hide()}}else{throw new Error("No content types present")}},showWikiEditor:function(){var i=this,h=i.getChildView("wikiEditorView"),j=i.getChildView("editorView");if(!h){require(["DS/SwymUIComponents/script/feature/community/wiki/edit/wiki-edit-view"],function(k){h=i._createWikiEditorView(k);h.show();h.switchToMaximizedView();j.hide()})}else{h.show();h.switchToMaximizedView();j.hide()}},onCurrentContentTypeChange:function(){var h;h=this.getElement(".community-content-wrapper");if(h){if(this._typesManager.getCurrentContentType()==="wiki"){h.removeClassName("one-column")}else{h.addClassName("one-column")}}},onContentTypeIconChange:function(i){var k=this,h,l=k.getChildView("editorView"),j,m;if(k.isVisible()){if(i.newType==="wiki"){require(["DS/SwymUIComponents/script/feature/community/wiki/edit/wiki-edit-view"],function(n){h=k._createWikiEditorView(n);if(i.oldType!=="media"&&i.oldType!=="survey"){j=l.getBodyAttributes().content}m=l._titleContent;l.hide();h.show();h.switchToMaximizedView();if(i.oldType!=="media"&&i.oldType!=="survey"){h._getBodyView()._getCurrentView().getRTEView().updateEditor(j)}h.setTitleValue(m)})}else{h=k.getChildView("wikiEditorView");if(h){if(h.isVisible()){h.hide();l.switchToMaximizedView()}}l.show();k._typesManager.setContentTypeRequest({type:i.newType});if(i.newType==="survey"){l.switchToMaximizedView()}if(i.oldType==="wiki"&&h&&h.isMaximized()&&i.newType!=="media"&&i.newType!=="survey"){j=h.getBodyAttributes().content;l._getBodyView()._getCurrentView().getRTEView().updateEditor(j)}}setTimeout(function(){k._typesManager.removePersisted("onContentTypeIconChange")},0)}},onRedraw:function(){var h=this._typesManager.getContentTypes();if(this.getOption("createMessagesOnly")===true){h=[g.MESSAGE]}if(h&&(h.length>0)){this.removeClassHidden()}else{this.addClassHidden()}},addClassHidden:function(){if(this.container&&!this.container.hasClassName("hidden")){this.container.addClassName("hidden")}},removeClassHidden:function(){if(this.container&&this.container.hasClassName("hidden")){this.container.removeClassName("hidden")}},_onSwitchToMaximizedView:function(){var j=this,i=j.getElement(".community-content-wrapper"),k=j.getChildView("editorView"),h=j.getChildView("wikiEditorView");if(j._typesManager.getCurrentContentType()==="wiki"){k.hide();if(h){h.show()}}if(i){i.addClassName("content-item full-content")}d.dispatchEvent("onMaximizeRequest",[j])},_onSwitchToMinimizedView:function(){var j=this,i=j.getElement(".community-content-wrapper"),k=j.getChildView("editorView"),h=j.getChildView("wikiEditorView");if(j._typesManager.getCurrentContentType()==="wiki"){h.hide();k.show()}if(i){i.removeClassName("content-item");i.removeClassName("full-content")}if(j.container&&j.container.hasClassName("maximized")){d.dispatchEvent("onUnMaximizeRequest",[j])}},_createContent:function(){var j=this,h=j.getChildView("wikiEditorView"),k=j.getChildView("editorView"),i=f.createElement("div",{"class":"community-content-wrapper",html:[]});if(j._typesManager.getCurrentContentType()!=="wiki"){i.addClassName("one-column");if(h){h.hide();k.show()}}k.inject(i);if(h){h.inject(i)}return i},onHide:function(){if(this.container&&this.container.hasClassName("maximized")){d.dispatchEvent("onUnMaximizeRequest",[this])}},onUnMaximize:function(){var i=this.getChildView("editorView"),h=this.getChildView("wikiEditorView");if(h){h.onCancel(false)}if(i){i.onCancel(false)}},destroy:function(){if(this.getOption("createMessagesOnly")!==true){this._typesManager.removeEvent("onContentTypesChange",this.onContentTypesChangeBound);this._typesManager.removeEvent("onCurrentContentTypeChange",this.onCurrentContentTypeChangeBound);this._typesManager.removeEvent("onContentTypeIconChange",this.onContentTypeIconChangeBound)}this._parent.apply(this,arguments)}});return b});define("DS/SwymUIComponents/script/feature/community/media/edit/media-edit-view",["UWA/Core","DS/SwymUICore/script/feature/community/media/model/media-model","DS/SwymUICore/script/feature/core/context/context-model","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view","DS/SwymUIComponents/script/utils/content-upload-error","i18n!DS/SwymUIComponents/assets/nls/feature/community/media/edit/media-editor-body-view"],function(g,e,d,b,a,f){var c=b.extend({_modelClass:e,name:"media-edit-view",onPublish:function(o,n){var m=(this.getElement(".content-title").getText()!==this.model.get("title"));if((parseInt(this.model.get("published"),10)!==1)||this.model.hasVirtuallyChanged()||this._getBodyView().getChildView("mediaEditor").pictureHasChanged||m){var j=g.extend({published:1,title:this.getElement(".content-title").getText()},n||{}),h=parseInt(j.published,10)===0,p=h?f.Thedraftwassuccessfullysaved:f.Yourchangeshavebeensuccessfullypublished,i=function(){var q=this.model.get("community")&&this.model.get("community").community_type==="dm";this.unmask();if(h){this._context.reset({path:(q?"dm:":"community:")+this.getSelectedCommunityID()+"/"+d.COMMUNITY_MY_CONTRIBUTIONS})}else{this._context.reset({contentType:this.model.getModelName(),communityId:this.getSelectedCommunityID(),dmId:q?this.getSelectedCommunityID():undefined,contentId:this.model.get("mid"),editionMode:false})}this.alert("success",p)},l=function(r,q){a.printErrorMessage(q);this.unmask()},k=this.model;if(!h&&(this.model.hasVirtuallyChanged("thumbnail_time_ms")===true)){p=f.Yourchangeshavebeensuccessfullypublishedthumbnailnotrefreshed}if(this._getBodyView().getChildView("mediaEditor").pictureHasChanged){this.mask();k.addEvent("mediaFileSavedToModel",function(){k.save(j,{notify:h?"draft":"publish",onComplete:i.bind(this),onFailure:l.bind(this)});k.removeEvent("mediaFileSavedToModel")}.bind(this));k.dispatchEvent("saveEditedMediaFileToModel")}else{this.mask();k.save(j,{notify:h?"draft":"publish",onComplete:i.bind(this),onFailure:l.bind(this)})}}else{this.alert("error",f.get("Nochangetosave")||"No change to save")}}});return c});define("DS/SwymUIComponents/script/feature/community/wiki/edit/wiki-edit-view",["UWA/Core","DS/SwymUICore/script/feature/core/config/bootstrap-model","DS/SwymUICore/script/feature/community/wiki/model/wiki-model","DS/SwymUICore/script/feature/community/wiki/model/wikitree-model","DS/SwymUICore/script/feature/community/community/model/community-model","DS/SwymUICore/script/utils/date","DS/SwymUICore/script/utils/utils","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view","DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-view","DS/SwymUIComponents/script/feature/community/wiki/view/wikitree-buttons-view","DS/SwymUIComponents/script/feature/community/wiki/view/wiki-access-editor-view","DS/SwymUIComponents/script/feature/core/ui-components/layout/layout-manager","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","i18n!DS/SwymUIComponents/assets/nls/feature/community/wiki/edit/wiki-creator-view"],function(b,o,m,d,j,g,e,f,a,i,l,c,n,k,p,h){var q=e.isFeatureActivated("activateNewWiki"),r=f.extend({_modelClass:m,name:"wiki-edit-view",defaultOptions:{iconCls:"book-open"},_wikiData:{},_createContent:function(){var v=this,z=v._parent.apply(v,arguments),t=v.model,w=(t?t.getCommunity().get("mid"):v.getSelectedCommunityID()),y,s,u;var x=v.getCommunitySelector();if(x){x.populateCommunityCollection()}if(w){y=new d({community_id:w},{autoPopulate:true})}s=v.addChildView("wikiTreeViewEdit",{addScroller:true,model:y?y:null,Class:a,widget:v._widget,moveOnlyCurrentNode:true,creation:(v.getOption("creation")?true:false),editable:(v.getOption("creation")?false:true)},{callback:function(A){if(v.getOption("creation")){v.reactTo(A,"currentPageChange",function(D){if(D.id){var B=v.getChildView("wikiAccessEditorView");v._addWikiChanges("parent_id",D.id);if(b.is(D.isPrivate)&&B){var E=B.getControl("accessSelect");if(E){if(D.isPrivate===true){E.select(1);E.disable()}else{E.select(0);E.enable();var C=B.getControl("user-search-control");if(C){C.disable();C.unselectAll()}}}}}})}}});u=v.addChildView("wikiTreeButtonsView",new i({mode:"edit",model:(w?new j({mid:w},{autoPopulate:true}):null),moveOnlyCurrentNode:true,creation:v.getOption("creation"),editable:true}));if(t&&y&&(window.ds&&(window.ds.env==="3DSwym"))){y.setCurrentPage(t)}return(q?[{"class":"col-md-3 wiki-tree-view-edit-wrapper",html:{"class":"wikitree-view-wrapper-container maximize",html:[this.getChildView("back-arrow-view"),[{"class":"wikitree-view-wrapper",styles:{"margin-right":"auto"},html:[{"class":"heading",html:[{"class":"wikitree-header",html:[{tag:"span","class":"fonticon fonticon-book-open"},{tag:"span",html:h.Wikitree}]},u]},{html:s}]}]]}},{"class":"col-md-9 wiki-content-editor-view-wrapper",html:z}]:z)},_createBodyView:function(){var u=this,t=u.model,v=u._parent.apply(u,arguments),s;if(q){s=u.addChildView("wikiAccessEditorView",{Class:l,model:t,events:{onInit:function(){u.listenTo(this,{onContentChange:u.onContentChange})}}});u.reactTo(s,"displayAccessIcon",function(w){if(w){u.getControl("accessIcon").show();s.container.removeClassName("hidden")}else{u.getControl("accessIcon").hide();s.container.addClassName("hidden")}})}return[(q?{"class":"wiki-properties-wrapper hidden",html:s}:null),v]},_createPublishBarLeftElements:function(){var t=this,w=t._parent.apply(t,arguments);var v=t.getControl("majorEditionCheckbox"),u=t.getControl("revisionInput"),s=b.createElement("span",{"class":"fonticon fonticon-help"});if(s){t.addControl("helpIconTooltip",new p({target:s,body:h.RevisionTooltip}))}if(!u){u=t.addControl("revisionInput",new n({className:"revision-message-input",placeholder:h.Revisiondescription,value:"",events:{onPostInject:function(){t.validateFieldView();this.getContent().addEvent("keyup",function(){t.validateFieldView()})},onChange:function(){t.onContentChange()}}}))}u.hide();if(!v){v=t.addControl("majorEditionCheckbox",new k({className:"primary major-edition-checkbox",type:"checkbox",checked:false,value:h.CreateRevision,events:{onChange:function(){var x=t.getElement(".publish-section");if(t.getControl("majorEditionCheckbox").isChecked()===true){u.show();x.addClassName("revision-input-expanded");t.validateFieldView()}else{if(t.getControl("majorEditionCheckbox").isChecked()===false){u.setValue("");u.hide();x.removeClassName("revision-input-expanded");t.validateFieldView()}}t.onContentChange()}}}))}if(o.getInstance().isFeatureActivated("activate_wiki_revision")){w.html.push([v,s,u])}return w},_createActions:function(){var v=this,w=v._parent.apply(v,arguments),t=this.addControl("accessIcon",b.createElement("span",{"class":"fonticon fonticon-lock",events:{click:function(){var x=v.getElement(".wiki-properties-wrapper");if(x.hasClassName("hidden")){x.removeClassName("hidden");this.addClassName("checked")}else{x.addClassName("hidden");this.removeClassName("checked")}}}})),u=(v.model?v.model.getCommunity():null),s=false;v.addControl("accessIconTooltip",new p({target:t,body:h.Accessandediting}));w.html.splice(1,0,{tag:"span",html:t});if(!u){u=new j({mid:v.getSelectedCommunityID()})}if(u.getUserRole()>=3){t.show()}else{t.hide()}return w},_addWikiChanges:function(v,u){var t=this,s=t.model;if(s){s.addChanges(v,u)}else{t._wikiData[v]=u}},getWikiData:function(){var t=this,s=t.model;if(s){return s.getChanges()}else{return t._wikiData}},validateFieldView:function(){var t=this,v=true,u=t.getControl("revisionInput"),s=u.getValue();t._addWikiChanges("revision_description",s);return v},setCommunityId:function(t){var s=this,v,u;console.log(t);if(t&&(!s._context.isCommunityContext()||s._context.isCommunityContext()===t)){if(s._getBodyView().getCommunityId()!==t){s._getBodyView().setCommunityId(t)}v=s.getChildView("wikiAccessEditorView");if(v&&v.getCommunityId()!==t){v.setCommunityId(t)}v=s.getChildView("wikiTreeViewEdit");if(v&&v.getCommunityId()!==t){v.mask();u=new d({community_id:t},{autoPopulate:true,onPopulate:function(w){v.setModel(w);if(w.get("tree")&&!w.currentPage){v.selectItemView(w.get("tree")[0].id)}v.unmask()}})}}},setup:function(){var t=this,s=t._parent.apply(t,arguments);this.addChildView("back-arrow-view",{Class:"DS/SwymUIComponents/script/feature/core/ui-components/back-arrow-view",model:this.model});return s},getBodyAttributes:function(){var s=this;return b.merge(s._parent.apply(s,arguments),s.getContentAttributes())},getContentAttributes:function(){var t=this,u=t._parent.apply(t,arguments)||{},s;b.merge(u,t.getWikiData());b.merge(u,t.getChildView("wikiAccessEditorView").getWikiData());u.minor_edition=(t.getControl("majorEditionCheckbox").isChecked()===false?"1":"0");return u},resetContent:function(){if(this.model){this.model.removeChanges()}return this._parent.apply(this,arguments)},resetEditorViews:function(){var u=this,t;if(!u.model){u._wikiData={}}var v=u.getControl("revisionInput");if(v){v.setValue("");v.hide()}var w=u.getControl("majorEditionCheckbox");if(w){w.uncheck()}var s=u.getElement(".wiki-properties-wrapper");s.addClassName("hidden");t=u.getElement(".fonticon-lock");if(t){t.removeClassName("checked")}u.getChildView("wikiAccessEditorView").resetEditorViews()},onCancel:function(s,t){if(this._confirmCancel(s,t)){if(!this.isDestroyed()){if(this._isOnCreationMode()){if(this.model){this.model=null}this.emptyTitle();this.resetBodyContent();this.dispatchEvent("onWikiCancel");this._context.setTemporaryState(false);this.removeInvalidationForPublish();this.onContentChange();this._clearAutoSave()}else{this.model.removeChanges();this.resetBodyContent();this._clearAutoSave()}this.resetEditorViews();this.contract()}}},changeContentTypeClass:function(){console.log(this.name)},onRedraw:function(){var t=this.getChildView("body")&&this.getChildView("body").getChildView("advancedRTE"),x,s=this.model&&this.model.get("_revisionToDisplay"),w=this.getControl("majorEditionCheckbox"),v=this.getElement(".publish-section"),u=this.getControl("revisionInput");c.dispatchEvent("showLayout");this.container.addClassName("wiki");if(this.container.getElement(".publish-section")){this.container.getElement(".publish-section").setHTML(this._createPublishBar().html)}if(s&&s>=0&&this.model){x=this.model.getRevisionData(s);this.model.addChanges("message",x.message);this.model.addChanges("title",x.title);this.setTitleValue(x.title);t.refreshContent(x.message);w&&w.check().disable();u&&u&&u.show();u&&u.setValue("Restored from revision: "+this.model.get("_revisionToDisplay"));v&&v.addClassName("revision-input-expanded")}else{this.model&&t.refreshContent(this.model.get("content"));w.enable();u&&u.hide();u&&u.setValue("");v&&v.removeClassName("revision-input-expanded")}},updateContentType:function(){this._parent.apply(this,arguments);this._publishDisabled=false}});return r});define("DS/SwymUIComponents/script/feature/community/question/edit/question-edit-view",["UWA/Core","DS/SwymUICore/script/feature/community/iquestion/model/iquestion-model","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view"],function(d,c,a){var b=a.extend({_modelClass:c,name:"question-edit-view"});return b});define("DS/SwymUIComponents/script/feature/community/post/edit/post-edit-view",["UWA/Core","DS/SwymUICore/script/feature/community/post/model/post-model","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view"],function(d,b,a){var c=a.extend({_modelClass:b,name:"post-edit-view"});return c});define("DS/SwymUIComponents/script/feature/community/survey/edit/survey-edit-view",["UWA/Core","DS/SwymUICore/script/feature/community/survey/model/survey-model","DS/SwymUIComponents/script/feature/community/content/edit/content-editor-view"],function(d,c,a){var b=a.extend({_modelClass:c,name:"survey-edit-view",defaultOptions:{iconCls:"clipboard"}});return b});define("DS/SwymUIComponents/script/feature/community/survey/view/survey-stats-home-view",["UWA/Core","DS/SwymUICore/script/lib/view/generic/swym-model-view","i18n!DS/SwymUIComponents/assets/nls/feature/community/survey/view/survey-stats-collection-view","DS/SwymUICore/script/feature/community/survey/collection/survey-collection","DS/SwymUIComponents/script/feature/community/survey/view/survey-stats-collection-view","DS/SwymUIComponents/script/feature/community/survey/view/legacy-survey-view","DS/SwymUIComponents/script/feature/core/modal/modal","DS/SwymUIComponents/script/feature/core/pagination/view/paging-toolbar-view"],function(e,d,c,h,a,g,f,i){var b=d.extend({_modelEvents:{"onChange:toDate":"_communityChanged","onChange:fromDate":"_communityChanged"},_asAdmin:false,_communityChanged:function(){this.surveyCollection.resetCollection(1,{data:{date00:this.model.get("fromDate"),date01:this.model.get("toDate")}})},_createContent:function(){var j=this.model;if(j){var l=new i({collection:this.surveyCollection,widget:this._widget});var k=e.createElement("div",{"class":"analytics",html:[{tag:"span",html:c.Surveys},this.surveyCollectionView,l]});return k}},_showDetails:function(j){if(!this.surveyResultModal){this.surveyView=new g({model:j,mode:"result",widget:this._widget});this.surveyResultModal=this.addControl("surveyResultModal",new f({renderTo:this._widget?this._widget.body:document.body,header:"<h4>"+j.get("title")+"</h4>",body:this.surveyView,className:"survey-wrapper"}))}else{this.surveyResultModal.setHeader("<h3>"+j.get("title")+"</h3>");this.surveyView.setModel(j);this.surveyView.setCurrentQuestion(1)}this.surveyResultModal.show()},setup:function(j){var k=this._parent.apply(this,arguments);if(e.is(this.model._asAdmin)){this._asAdmin=this.model._asAdmin}this.surveyCollection=new h([],{mode:"community-stats-surveys",limit:10,asAdmin:this._asAdmin});this.surveyCollection.setAssociated("community",this.model);this.surveyCollectionView=new a({collection:this.surveyCollection,community:this.model,widget:this._widget});this.surveyCollectionView.addEvent("surveyClicked",function(l){this._showDetails(l)}.bind(this));this.surveyCollection.addEventOnce("onBeforePageChange",function(){this.mask()}.bind(this));this.surveyCollection.addEventOnce("onAfterPageChange",function(){this.unmask()}.bind(this));return k}});return b});define("DS/SwymUIComponents/script/feature/core/stats/view/stats-collection-view",["DS/SwymUICore/script/lib/view/generic/swym-collection-view","DS/SwymUICore/script/feature/core/stats/collection/stats-collection","DS/SwymUIComponents/script/feature/core/stats/view/daterange-view","DS/SwymUIComponents/script/feature/core/stats/view/analytics-view","DS/SwymUIComponents/script/feature/community/survey/view/survey-stats-home-view"],function(e,f,a,d,b){var c=e.extend({_collectionClass:f,name:"stats-collection-view",modelViewClass:{pie:d,column:d,table:d,community:b},defaultOptions:{asAdmin:false},_notifyOfItemViewSelection:false,_tenant:null,_community:null,attributes:{styles:{height:"100%"}},bodyAttributes:{tag:"div",styles:{"overflow-x":"hidden"}},modelViewsCfg:{attributes:{"class":"graph col-xs-12 col-md-6 col-sm-6 col-lg-4"}},init:function(g){if(g){if(g.hasOwnProperty("scroller")){this._addScroller=g.scroller}}return this._parent.apply(this,arguments)},setup:function(g){if(g){if(g.hasOwnProperty("community")){this._community=g.community}if(g.hasOwnProperty("tenant")){this._tenant=g.tenant}}return this._parent.apply(this,arguments)},setCommunity:function(g){this._community=g},_parseDate:function(g){return g.getFullYear()+"-"+((g.getMonth()+1)<10?("0"+(g.getMonth()+1)):(g.getMonth()+1))+"-"+((g.getDate())<10?("0"+(g.getDate())):(g.getDate()))},_changeBothDate:function(h,k){var g=this._parseDate(h),j=this._parseDate(k),i=this.collection.first();if(i&&i.hasOwnProperty("_fromDate")&&(i._fromDate!==g||i._toDate!==j)){this.collection.updateModels(g,j)}},_changeStartDate:function(i){var h=this._parseDate(i),g=this.collection.first();if(g&&g.hasOwnProperty("_fromDate")&&g._fromDate!==h){this.collection.updateModels(h,null)}},_changeEndDate:function(i){var h=this._parseDate(i),g=this.collection.first();if(g&&g.hasOwnProperty("_toDate")&&g._toDate!==h){this.collection.updateModels(null,h)}},_createContent:function(){var g=new a({community:this._community?this._community:null,tenant:this._tenant?this._tenant:null});this.reactTo(g,"bothDateChanged",this._changeBothDate);this.reactTo(g,"startDateChanged",this._changeStartDate);this.reactTo(g,"endDateChanged",this._changeEndDate);return[g,this._parent()]}});return c});