define("DS/DMUMeasurable/DMUToolsSceneGraph",["DS/Visualization/PathElement","DS/SceneGraphOverrides/SceneGraphOverrideSet"],function(c,a){var b=undefined;var d={callPad3DViewerModelServices:function(f,h){function g(){if(undefined===b){b=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices");if(undefined===b){b=null}}return b}var e;var i=g();if(i&&f&&i[f]){e=i[f](h)}return e},isReference:function(f){var e=false;if(f){e=d.callPad3DViewerModelServices("isReference",f);if(!e){e=((undefined!==f.productType)&&(f.productType==="Reference3D"||f.productType==="ReferenceRep"))}if(!e){e=((undefined!==f.isPLMReference)&&f.isPLMReference())}}return e},isRepReference:function(f){var e=false;if(f){e=d.callPad3DViewerModelServices("isRepReference",f);if(!e){e=((undefined!==f.productType)&&(f.productType==="ReferenceRep"))}if(!e){e=((undefined!==f.isPLMRepReference)&&f.isPLMRepReference())}}return e},isRepInstance:function(f){var e=false;if(f){e=d.callPad3DViewerModelServices("isRepInstance",f);if(!e){e=((undefined!==f.plmtype)&&(f.plmtype==="VPMRepInstance"))}if(!e){e=((undefined!==f.productType)&&(f.productType==="InstanceRep"))}if(!e){e=((undefined!==f.isPLMRepInstance)&&f.isPLMRepInstance())}}return e},isInstance:function(f){var e=false;if(f){e=d.callPad3DViewerModelServices("isInstance",f);if(!e){e=((undefined!==f.isPLMInstance)&&f.isPLMInstance())}if(!e){e=((undefined!==f.productType)&&(f.productType==="Instance3D"||f.productType==="InstanceRep"))}}return e},isReferenceOrInstance:function(g,f){var e=d.isReference(g);if(!e){e=d.isInstance(g)}if(!e){e=d.isRepInstance(g)}if(!e&&f){e=d.isRepReference(g)}return e},isLeaf:function(h,g){var e=true;if(g&&d.isPLMNode(h)){e=d.callPad3DViewerModelServices("is3DLeaf",h)}else{for(var f=0;f<h.children.length;f++){if(d.isReferenceOrInstance(h.children[f],g)){e=false;break}}}return e},is3DLeaf:function(f){var e=d.callPad3DViewerModelServices("is3DLeaf",f);if(undefined===e&&f.is3DLeaf){e=f.is3DLeaf()}return e},isPLMNode:function(f){var e=d.callPad3DViewerModelServices("isPLMNode",f);if(undefined===e){e=f.className==="PAD3DViewerNode"}return e},getNodeType:function(f){var e=d.callPad3DViewerModelServices("getNodeType",f);if(undefined===e&&f.getType){e=f.getType()}return e},getNodeID:function(f){var e=d.callPad3DViewerModelServices("getNodeID",f);if(undefined===e&&f.getID){e=f.getID()}return e},isVisible:function(g,h){var e=false;if(h&&g){var f=g.getSceneGraphOverrideSetManager().getCurrentVisibility(h);e=((f===null||f===undefined)?true:f)}return e},parseForLeafNodes:function(k,h,l,f){if(k&&h){var i=k.clone();var g=i.getChildrenPathes();if(d.isLeaf(i.getLastElement(true),true)||0===g.length){if(d.isVisible(h,i)){if(l){l.push(i)}}else{if(f){f.push(i)}}}else{for(var e=0;e<g.length;e++){if(d.isReferenceOrInstance(g[e].getLastElement(true),true)){if(d.isVisible(h,g[e])){d.parseForLeafNodes(g[e],h,l,f)}else{if(f){f.push(g[e].clone())}}}}}}},parseForLeafNodesOfScene:function(h,k,g){var e=d.getProductRoots(h);for(var f=0;f<e.length;f++){var j=new c();j.addElement(e[f]);d.parseForLeafNodes(j,h,k,g)}},getName:function(t,k,f,e,u){var n=(e)?e:"";if(t&&k){var g=[];var m=[];var x=true;var l=t.length;for(var s=0;s<l;s++){var q=t[s];var h=d.callPad3DViewerModelServices("getNodeID",q);if(h){x=false;if(d.isInstance(q)||d.isRepInstance(q)){q=q.children[0]}m.push(h);g.push(n)}else{g.push(q.name)}}k(g);if(!x){var w=[];for(var s=0;s<m.length;s++){var v=false;for(var r=0;!v&&(r<s);r++){v=(m[s]===m[r])}if(!v){w.push(m[s])}}var o=f.getController();var p=["ds6w:label"];if(u){p.push("ds6wg:revision")}o.getAttributes({ids:w,attributes:p,callbacks:{onComplete:function(z){g=[];var y;for(var j=0;j<m.length;j++){y=z[m[j]]["ds6w:label"];if(u&&z[m[j]]["ds6wg:revision"]){y+=(" "+z[m[j]]["ds6wg:revision"])}g.push(y)}k(g)},onFailure:function(){return null}}})}}},getProductRoots:function(g){var e=[];function f(m,l,k){var j=m.children;var n=j.length;for(var h=0;h<n;h++){if(true===d.isReference(j[h])||d.isRepReference(j[h])){if(!k){l.push(m);break}else{l.push(j[h])}}else{f(j[h],l,false)}}}f(g.getRootNode(),e,true);return e},getRoots:function(f){var e=d.callPad3DViewerModelServices("getRoots",f);if(undefined===e&&f.getRoots){e=f.getRoots()}return e},getRootReferences:function(f){var g=[];function e(k,l){if(d.isReference(k)||d.isRepReference(k)){l.push(k)}else{var j=k.children;var m=j.length;for(var h=0;h<m;h++){e(j[h],l)}}}e(f.getRootNode(),g);return g},getSceneRoot:function(e){return e.getRootNode()},getRootBag:function(g){var f=d.getSceneRoot(g);var e;if(f){e=f.getChildByName("root-bag-web");if(!e){e=f.getChildByName("RootBag")}}return e},recursiveGetPathElementVisibility:function(o,n){var f;if(o.hasSceneGraphOverrideSet()){var e=o.getSceneGraphOverrideSetManager();if(e){var q=e.getNumberOfSceneGraphOverrideSets();for(var m=0;m<q;m++){var h=e.getSceneGraphOverrideSetAt(m);if(h){var l=h.getOverridesFromPathElement(n);if(l){for(var k=0;k<l.length;k++){f=l[k].getVisibility();if(f!==null){break}}}else{var p=n.getChildrenPathes();for(var k=0;k<p.length;k++){f=d.recursiveGetPathElementVisibility(o,p[k]);if(f!==null){break}}}}}}else{if(o&&n&&o.sceneGraphState){f=o.sceneGraphState.getAppliedVisibility(n);if(f===null){var g=n.getChildrenPathes();for(var k=0;k<g.length;k++){f=d.recursiveGetPathElementVisibility(o,g[k]);if(f!==null){break}}}}}}return f},getFirstReference:function(e){var j=new c();var h=e.getLength();for(var f=0;f<h;f++){var g=e.getElement(f);if(d.isReference(g)||d.isRepReference(g)){j.addElement(g);break}}return j},getLastReference:function(e){if(e.getLength()>1){if(d.isReference(e.getLastElement(true))){return e.clone()}else{return d.getLastReference(e.getParentPath())}}else{return new c()}},getLastRepReference:function(e){if(e.getLength()>1){if(d.isRepReference(e.getLastElement(true))){return e.clone()}else{return d.getLastRepReference(e.getParentPath())}}else{return new c()}},getLastInstance:function(e){if(e.getLength()>1){if(d.isInstance(e.getLastElement(true))||d.isRepInstance(e.getLastElement(true))){return e.clone()}else{return d.getLastInstance(e.getParentPath())}}else{return new c()}},truncatePathElement:function(g,f){var e=new c();var j=Math.min(g.getLength(),f);for(var h=0;h<j;h++){e.addElement(g.getElement(h))}return e},cleanOccurrencePathElement:function(e){var h=e.clone();h.internalPath=[];var j=this;while(h&&h.externalPath.length&&!j.isReference(h.getElement(0))&&!j.isRepReference(h.getElement(0))){h.externalPath.shift()}var g=h.getLength();for(var f=g-1;0<=f;f--){if(!j.isReferenceOrInstance(h.getElement(f))&&!d.isRepReference(h.getElement(f))){h.externalPath.pop()}}return h},buildPathElement:function(h){var f=new c();var e=[];var g=h;while(g&&!g.notAllowedInPathElement){e.splice(0,0,g);g=g.parents[0]}f.setFromArray(e);return f},isDescendant:function(h,g){var j=false;var f=h.getLength();if(g.getLength()>=f){j=true;for(var e=0;(j)&&(e<f);e++){j=g.getElement(e)===h.getElement(e)}}return j},getAllOthers:function(m){var z=[];var x=(m instanceof Array)?m:[m];var g=x.length;if(0<g){var r=x[0];while(r&&this.isReferenceOrInstance(r.getLastElement())){z=z.concat(r.getSiblingsPathes());r=r.getParentPath()}var q=x[0].getElement(0);var y=q.parents[0];var h=y.children;var n=h.length;for(var w=0;w<n;w++){var l=h[w];if(l!==q){var e=new c();e.addElement(l);z.push(e)}}for(var w=1;w<g;w++){var r=x[w];var v=r.externalPath.length;var f=-1;var o=-1;for(var t=0;t<z.length;t++){if(z[t].isAParentOf(r)){var u=z[t].externalPath.length;if(o<u){f=t;o=u}}}if(0<=f){for(var s=z[f].externalPath.length+1;s<=v;s++){var p=this.truncatePathElement(r,s);var A=p.getSiblingsPathes();z=z.concat(A)}z.splice(f,1)}}}return z},getRenderables:function(e){return e._getRenderableOccurrences()},createSceneGraphOverrideSet:function(f){var h;var e=d.getSceneRoot(f).getChildByName("root-bag-web");if(!e){e=d.getSceneRoot(f).getChildByName("RootBag")}var g=f.getSceneGraphOverrideSetManager();if(e&&g){h=new a(e);if(h){g.pushSceneGraphOverrideSet(h)}}return h},removeSceneGraphOverrideSet:function(f,e){if(f&&e){var g=f.getSceneGraphOverrideSetManager();if(g){g.removeSceneGraphOverrideSet(e)}}},_completePathElement:function(h,f){var g=f.clone();if(h._viewers[0]){var i=h._viewers[0].viewer;var e=d.getSceneRoot(i).getChildByName("root-bag-web");if(!e){e=d.getSceneRoot(i).getChildByName("RootBag")}if(g.getElement(0).id!==e.id){g.externalPath.unshift(e)}}return g},getSceneGraphOverride:function(h,e){var f;var g=this._completePathElement(h,e);if(h&&g){f=h.getUniqueOverrideFromPathElement(g);if(!f){f=h.createOverride({pathes:[g]})}}return f},removeSceneGraphOverride:function(h,e){var f;var g=this._completePathElement(h,e);if(h&&g){f=h.getUniqueOverrideFromPathElement(g);if(f){h.deleteOverride(f)}}},computeBoundingBox:function(i,l){var h;var f;var n=0;if(l&&((n=l.length)>0)){var e;var m;var k;for(var g=0;g<n;g++){k=l[g];if(!k){continue}e=d.getLastReference(k).getLastElement();if(!e){continue}f=e.getBoundingBox();m=k.getWorldMatrix();if(m){f.applyMatrix4(m)}if(0===g){h=f}else{h.mergeWithBox(f)}}}else{var o=d.getRootReferences(i);n=o.length;for(var g=0;g<n;g++){f=o[g].getBoundingBox();if(0===g){h=f}else{h.mergeWithBox(f)}}}return h}};return d});define("DS/DMUMeasurable/DMUToolsMaths",["DS/Visualization/ThreeJS_DS"],function(a){var b=0.001;var c={isZero:function(d){return(Math.abs(d)<b)},areEqual:function(g,f,d,l){var e=(l!==undefined)?l:b;var h=true;var k=(d!==undefined)?d:"float";switch(k){case"float":h=(Math.abs(g-f)<e);break;case"Vector3":h=(Math.abs(g.x-f.x)<e)&&(Math.abs(g.y-f.y)<e)&&(Math.abs(g.z-f.z)<e);break;case"Matrix4":for(var j=0;j<16&&h;j++){h=(Math.abs(g.elements[j]-f.elements[j])<e)}break;default:console.log("areEqual used with unknown type: "+k);break}return h},isLessOrEqual:function(g,f,h){var e=(h!==undefined)?h:b;var d=(g<=f+e);return d},isLessThan:function(g,f,h){var e=(h!==undefined)?h:b;var d=(g<f+e);return d},computeMatrixFromLines:function(d,e,f,g){var j=e.clone().normalize();var i;var h;if(f!==undefined){h=new a.Vector3().crossVectors(j,f);i=new a.Vector3().crossVectors(h,j)}else{if(g!==undefined){i=new a.Vector3().crossVectors(j,g);h=new a.Vector3().crossVectors(j,i)}else{i=new a.Vector3().crossVectors(j,new a.Vector3(0,0,1));if(c.isZero(i.length())){i=new a.Vector3().crossVectors(j,new a.Vector3(0,1,0))}h=new a.Vector3().crossVectors(j,i)}}return new a.Matrix4(j.x,i.x,h.x,d.x,j.y,i.y,h.y,d.y,j.z,i.z,h.z,d.z,0,0,0,1)},computeTransformationBetweenTwoLines:function(h,j,l,n){var p={};p.returnCode=1;if(h&&j&&l&&n){var m=j.clone().normalize();var o=n.clone().normalize();var f=new a.Matrix4().makeTranslation(-h.x,-h.y,-h.z);var g=new a.Vector3().crossVectors(m,o);if(c.isZero(g.length())){g=new a.Vector3().crossVectors(m,new a.Vector3(1,0,0));if(c.isZero(g.length())){g=new a.Vector3().crossVectors(m,new a.Vector3(0,1,0))}}var i=Math.acos(o.dot(m));var d=new a.Matrix4().makeRotationAxis(g.normalize(),i);var e=new a.Matrix4().makeTranslation(l.x,l.y,l.z);var k=e.clone().multiply(d).multiply(f);p.returnCode=0;p.transformation=k}return p},quaternionToAxisSystem:function(g){var d={};var f=new a.Matrix4().setRotationFromQuaternion(g.clone()).elements;d.X=new a.Vector3(f[0],f[1],f[2]);d.Y=new a.Vector3(f[4],f[5],f[6]);d.Z=new a.Vector3(f[8],f[9],f[10]);d.Origin=new a.Vector3(f[12],f[13],f[14]);return d}};return c});define("DS/DMUMeasurable/DMUMeshCreation",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils"],function(b,d,c){var a={createPolylines:function(p,v,r,h){var x=3;var k=new c.PrimitiveGroup();var s=new c.Color(v[0].r,v[0].g,v[0].b,1);k.fillAttr=new c.FillAttributes();k.lineAttr=new c.LineAttributes(s,r,h);k.pointAttr=new c.PointAttributes();var e=0;var u=p.length;for(var n=0;n<u;n++){var i=p[n];var j=i.length;for(var g=0;g<j;g++){e+=i[g].length}}var o=new c.Buffer();o.size=x*e;o.component=c.VertexComponentEnum.POSITION;o.format=c.DataTypeEnum.FLOAT;o.dimension=x;o.data=new Float32Array(o.size);var y=o.data;var w=0;for(var n=0;n<u;n++){var i=p[n];var j=i.length;for(var g=0;g<j;g++){var t=i[g];e=t.length;for(var m=0;m<e;m++){var z=t[m];y[w]=z[0];y[w+1]=z[1];y[w+2]=z[2];w+=x}}}k.addBuffer(0,o);var f=0;for(var n=0;n<u;n++){var i=p[n];var s=new c.Color(v[n].r,v[n].g,v[n].b,1);var j=i.length;for(var g=0;g<j;g++){var t=i[g];e=t.length;var q=new c.Primitive();q.nbIndices=e;q.connectivity=c.ConnectivityTypeEnum.LINE_STRIP;q.attr={fill:new c.FillAttributes(s),line:new c.LineAttributes(s,r,h),point:new c.PointAttributes()};var l=new c.VertexComponent();l.component=c.VertexComponentEnum.POSITION;l.nbVertices=e;l.nbValuesPerVertex=x;l.format=c.DataTypeEnum.FLOAT;l.cardinality=0;l.bufferId=0;l.offset=f;f+=e;q.addVertexComponent(l);k.addPrimitive(q)}}return k},createRectangle:function(f,g,o,l,n,e){var h=[];var j=0;h[j++]=0;h[j++]=0;h[j++]=0;h[j++]=f;h[j++]=0;h[j++]=0;h[j++]=f;h[j++]=g;h[j++]=0;h[j++]=0;h[j++]=g;h[j++]=0;var k=[];k[0]=0;k[1]=0;k[2]=1;var m=[];var j=0;m[j++]=0;m[j++]=1;m[j++]=1;m[j++]=0;return a.createPlanarPolygon(h,k,m,false,o,l,n,e)},createPlanarPolygon:function(H,w,g,F,m,N,s,Q){var D=3;var f=H.length/D;var t=(m)?f+1:0;var A=(s)?f:0;var M=(F)?c.ConnectivityTypeEnum.TRIANGLE_STRIP:c.ConnectivityTypeEnum.TRIANGLE_FAN;var L=(Q!==undefined)?Q:new c.Color(0.5,0.5,0.5,1);var I=(N!==undefined)?N:new c.Color(0.5,0.5,0.5,1);var r=new c.PrimitiveGroup();r.fillAttr=new c.FillAttributes();r.lineAttr=new c.LineAttributes();r.pointAttr=new c.PointAttributes();var z=new c.Buffer();z.size=D*f;z.component=c.VertexComponentEnum.POSITION;z.format=c.DataTypeEnum.FLOAT;z.dimension=D;z.data=new Float32Array(z.size);var o=new c.Buffer();o.size=D;o.component=c.VertexComponentEnum.NORMAL;o.format=c.DataTypeEnum.FLOAT;o.dimension=D;o.data=new Float32Array(o.size);var u=new c.Buffer();u.size=D*2;u.component=c.VertexComponentEnum.TEX_COORD_0;u.format=c.DataTypeEnum.FLOAT;u.dimension=D;u.data=new Float32Array(u.size);var G=new c.Buffer();G.indexBuffer=true;G.size=t+A;G.format=c.DataTypeEnum.UINT;G.dimension=1;G.data=new Uint16Array(G.size);var v=new c.Buffer();v.indexBuffer=true;v.size=A;v.format=c.DataTypeEnum.UINT;v.dimension=1;v.data=new Uint16Array(v.size);var B=new c.Buffer();B.indexBuffer=true;B.size=t+A;B.format=c.DataTypeEnum.UINT;B.dimension=1;B.data=new Uint16Array(B.size);var y=0;var P=1;var e=2;var h=3;var x=4;var q=5;r.addBuffer(y,z);r.addBuffer(P,o);r.addBuffer(e,G);r.addBuffer(h,v);r.addBuffer(x,u);r.addBuffer(q,B);var E=G.data;var K=0;var J=0;if(m){for(J=0;J<f;J++){E[K++]=J}E[K++]=0}if(s){for(J=0;J<f;J++){E[K++]=J}}E=v.data;K=0;if(s){for(J=0;J<f;J++){E[K++]=0}}E=B.data;K=0;if(s){for(J=0;J<f;J++){E[K++]=g[J]}}E=z.data;for(K=0;K<D*f;K++){E[K]=H[K]}E=o.data;K=0;E[K++]=w[0];E[K++]=w[1];E[K++]=w[2];E=u.data;K=0;E[K++]=0;E[K++]=0;E[K++]=0;E[K++]=1;E[K++]=0;E[K++]=0;if(m){var l=new c.Primitive();l.nbIndices=f+1;l.connectivity=c.ConnectivityTypeEnum.LINE_STRIP;l.attr={fill:new c.FillAttributes(I),line:new c.LineAttributes(I),point:new c.PointAttributes()};var k=new c.VertexComponent();k.component=c.VertexComponentEnum.POSITION;k.nbVertices=f;k.nbValuesPerVertex=D;k.format=c.DataTypeEnum.FLOAT;k.cardinality=0;k.bufferId=y;k.indices=new c.IndexArray();k.indices.format=c.DataTypeEnum.UINT;k.indices.bufferId=e;k.indices.offset=0;l.addVertexComponent(k);r.addPrimitive(l)}if(s){var n=new c.Primitive();n.nbIndices=f;n.connectivity=M;n.attr={fill:new c.FillAttributes(L),line:new c.LineAttributes(),point:new c.PointAttributes()};var p=new c.VertexComponent();p.component=c.VertexComponentEnum.POSITION;p.nbVertices=f;p.nbValuesPerVertex=D;p.format=c.DataTypeEnum.FLOAT;p.cardinality=0;p.bufferId=y;p.indices=new c.IndexArray();p.indices.format=c.DataTypeEnum.UINT;p.indices.bufferId=e;p.indices.offset=t;var C=new c.VertexComponent();C.component=c.VertexComponentEnum.NORMAL;C.nbVertices=1;C.nbValuesPerVertex=D;C.format=c.DataTypeEnum.FLOAT;C.cardinality=0;C.bufferId=P;C.indices=new c.IndexArray();C.indices.format=c.DataTypeEnum.UINT;C.indices.bufferId=h;C.indices.offset=0;var O=new c.VertexComponent();O.component=c.VertexComponentEnum.TEX_COORD_0;O.nbVertices=2;O.nbValuesPerVertex=D;O.format=c.DataTypeEnum.FLOAT;O.cardinality=0;O.bufferId=x;O.indices=new c.IndexArray();O.indices.format=c.DataTypeEnum.UINT;O.indices.bufferId=q;O.indices.offset=0;n.addVertexComponent(p);n.addVertexComponent(C);n.addVertexComponent(O);r.addPrimitive(n)}return r},_computeTotalLength:function(e){var h=[];if(e.length>0){h.push(0);var g=0;for(var f=1;f<e.length;f++){g+=e[f-1].distanceTo(e[f]);h.push(g)}}return h},_intersection:function(h,g,f){var e=((h.x-f.x)*g.x-(f.y-h.y)*g.y)/(-g.x*g.x-g.y*g.y);return new b.Vector2(h.x+e*g.x,h.y+e*g.y)},boundingBoxCompute:function(o){var n=Number.MAX_VALUE;var k=[];var f=[];var w=0;var e=0;var h=0;var l=0;for(var u=0;u<o.length;u++){f.push(o[(u+1)%o.length].clone().sub(o[u]).normalize());if(o[u].x<o[w].x){w=u}if(o[u].x>o[e].x){e=u}if(o[u].y<o[l].y){l=u}if(o[u].y>o[h].y){h=u}}var j=new b.Vector2(-1,0);var x=new b.Vector2(0,-1);for(var u=0;u<o.length;u++){var p=[x.dot(f[w]),-x.dot(f[e]),j.dot(f[h]),-j.dot(f[l])];switch(p.indexOf(Math.max.apply(Math,p))){case 0:j=f[w].clone();j.set(j.y,-j.x);w=(w+1)%o.length;break;case 1:j=f[e].clone().negate();j.set(j.y,-j.x);e=(e+1)%o.length;break;case 2:j=f[h].clone();h=(h+1)%o.length;break;case 3:j=f[l].clone().negate();l=(l+1)%o.length;break}x=j.clone().negate();x.set(x.y,-x.x);var s=this._intersection(o[w],x,o[h]);var q=this._intersection(o[e],x,o[h]);var t=this._intersection(o[l],j,o[w]);var m=this._intersection(o[l],j,o[e]);var r=s.distanceTo(t);var g=s.distanceTo(q);var v=g*r;if(v<n){k=[s,t,m,q,g,r];n=v}}return k}};return a});define("DS/DMUMeasurable/DMUMeasureEnums",[],function(){var a=a||{REVISION:"1"};a.ResultType={POINT:0,PICKINGPT:1,CENTER:2,CURVE:3,LINE:4,AXIS:5,CIRCLE:6,SURFACE:7,PLANE:8,CYLINDER:9,CONE:10,SPHERE:11,PRODUCT:12};a.ViewedType={POINT:0,CENTER:1,AXIS:2,CURVE:3,INFPLANE:4,SURFACE:5,PRODUCT:6,CIRCLE:7,CYCOSP:8};return a});define("DS/DMUMeasurable/DMUGeometryEnums",[],function(){var a=a||{REVISION:"1"};a.GeometryType={POINT:0,PICKINGPT:1,CURVE:2,LINE:3,CIRCLE:4,SURFACE:5,PLANE:6,CYLINDER:7,CONE:8,SPHERE:9,PRODUCT:10};a.Relationship={NONE:0,COINCIDENT:1,PARRALLEL:2,INTERSECTING:3};a.Mode={EXACT:0,FACETTED:1};return a});define("DS/DMUMeasurable/DMUMathsVector3D",[],function(){var a=0.001;var c=0.000001;var b={modifyEpsilon:function(d){var e=a;if(d>0){a=d;c=d*d}return e},isNull:function(e){var d=(Math.abs(e[0])<a)&&(Math.abs(e[1])<a)&&(Math.abs(e[2])<a);return d},clone:function(e){var d=[];d[0]=e[0];d[1]=e[1];d[2]=e[2];return d},length:function(e){var d=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return d},squaredLength:function(e){var d=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return d},normalize:function(h,e){var f;var g=h[0]*h[0]+h[1]*h[1]+h[2]*h[2];if(Math.abs(g-1)<c){f=e||[0,0,0];f[0]=h[0];f[1]=h[1];f[2]=h[2]}else{if(g>c){var d=Math.sqrt(g);f=e||[0,0,0];f[0]=h[0]/d;f[1]=h[1]/d;f[2]=h[2]/d}}return f},multiply:function(g,d,e){var f=e||[0,0,0];f[0]=d*g[0];f[1]=d*g[1];f[2]=d*g[2];return f},areEqual:function(f,e){var d=(Math.abs(e[0]-f[0])<a)&&(Math.abs(e[1]-f[1])<a)&&(Math.abs(e[2]-f[2])<a);return d},add:function(g,f,d){var e=d||[0,0,0];e[0]=f[0]+g[0];e[1]=f[1]+g[1];e[2]=f[2]+g[2];return e},sub:function(g,f,d){var e=d||[0,0,0];e[0]=f[0]-g[0];e[1]=f[1]-g[1];e[2]=f[2]-g[2];return e},angle:function(i,h){var f;var e=Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);var d=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);if((e>a)&&(d>a)){var g=(i[0]*h[0]+i[1]*h[1]+i[2]*h[2])/(e*d);f=Math.acos(Math.min(Math.max(g,-1),1))}return f},dot:function(f,e){var d=f[0]*e[0]+f[1]*e[1]+f[2]*e[2];return d},cross:function(h,g,i){var j=i||[0,0,0];var f=h[0];var e=h[1];var d=h[2];var m=g[0];var l=g[1];var k=g[2];j[0]=e*k-d*l;j[1]=d*m-f*k;j[2]=f*l-e*m;return j},subAndLength:function(h,g,e){var f=e||[0,0,0];f[0]=g[0]-h[0];f[1]=g[1]-h[1];f[2]=g[2]-h[2];var d=Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);return d},subAndSquaredLength:function(h,f,d){var e=d||[0,0,0];e[0]=f[0]-h[0];e[1]=f[1]-h[1];e[2]=f[2]-h[2];var g=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];return g},multiplyAndAdd:function(h,d,g,e){var f=e||[0,0,0];f[0]=h[0]*d+g[0];f[1]=h[1]*d+g[1];f[2]=h[2]*d+g[2];return f},isIdentity:function(d){var e=(Math.abs(d[0]-1)<a)&&(Math.abs(d[1])<a)&&(Math.abs(d[2])<a)&&(Math.abs(d[3])<a)&&(Math.abs(d[4])<a)&&(Math.abs(d[5]-1)<a)&&(Math.abs(d[6])<a)&&(Math.abs(d[7])<a)&&(Math.abs(d[8])<a)&&(Math.abs(d[9])<a)&&(Math.abs(d[10]-1)<a)&&(Math.abs(d[11])<a)&&(Math.abs(d[12])<a)&&(Math.abs(d[13])<a)&&(Math.abs(d[14])<a)&&(Math.abs(d[15]-1)<a);return e},areMatrixEqual:function(e,d){var f=(Math.abs(e[0]-d[0])<a)&&(Math.abs(e[1]-d[1])<a)&&(Math.abs(e[2]-d[2])<a)&&(Math.abs(e[3]-d[3])<a)&&(Math.abs(e[4]-d[4])<a)&&(Math.abs(e[5]-d[5])<a)&&(Math.abs(e[6]-d[6])<a)&&(Math.abs(e[7]-d[7])<a)&&(Math.abs(e[8]-d[8])<a)&&(Math.abs(e[9]-d[9])<a)&&(Math.abs(e[10]-d[10])<a)&&(Math.abs(e[11]-d[11])<a)&&(Math.abs(e[12]-d[12])<a)&&(Math.abs(e[13]-d[13])<a)&&(Math.abs(e[14]-d[14])<a)&&(Math.abs(e[15]-d[15])<a);return f},transformVector:function(j,e,h){var i=h||[0,0,0];var g=j[0];var f=j[1];var d=j[2];i[0]=e[0]*g+e[4]*f+e[8]*d;i[1]=e[1]*g+e[5]*f+e[9]*d;i[2]=e[2]*g+e[6]*f+e[10]*d;return i},transformPoint:function(j,e,h){var i=h||[0,0,0];var g=j[0];var f=j[1];var d=j[2];i[0]=e[0]*g+e[4]*f+e[8]*d+e[12];i[1]=e[1]*g+e[5]*f+e[9]*d+e[13];i[2]=e[2]*g+e[6]*f+e[10]*d+e[14];return i}};return b});define("DS/DMUMeasurable/DMUManipulablePlane",["DS/Visualization/Node3D","DS/DMUMeasurable/DMUMeshCreation","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUToolsMaths","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Mesh/MeshUtils","DS/Manipulators/LineTranslationManipulator","DS/Manipulators/RotationManipulator","DS/Manipulators/PlaneTranslationManipulator","DS/Manipulators/PointHandle"],function(d,j,i,e,g,f,a,b,l,h,k){var c=d.extend({init:function(m){this._parent();this._viewer=m.viewer;this._frameWindow=m.frameWindow;this._bTranslationManipulator=(m.bTranslationManipulator)?m.bTranslationManipulator:false;this._bRotationManipulator=(m.bRotationManipulator)?m.bRotationManipulator:false;this._bResizeManipulator=(m.bResizeManipulator)?m.bResizeManipulator:false;this._bCenterManipulator=(m.bCenterManipulator)?m.bCenterManipulator:false;this._sType=m.sType;this._rulerClass=m.RulerClass;this._CBGetState=(m.getState)?m.getState:this.getState;this._CBGetShowState=(m.getState)?m.getShowState:this.getShowState;this._CBGetGeometry=(m.getGeometry)?m.getGeometry:this.getGeometry;this._CBSetGeometry=(m.setGeometry)?m.setGeometry:this.setGeometry;this._CBGetDisplayInformation=(m.getDisplayInformation)?m.getDisplayInformation:this.getDisplayInformation;this._CBManipulationInformation=(m.getManipulationInformation)?m.getManipulationInformation:this.getManipulationInformation;this._mMaterial=new g.MeshPhongMaterial({transparent:true,side:g.DoubleSide,enableClipPlanes:false,depthWrite:false});this._mMaterial.force=true;this._nCenterPlaneNode=new d();this._nCenterPlaneNode._getExcludeFromCSO=function(){return true};this.addChild(this._nCenterPlaneNode);if(this._bRotationManipulator){this._nUSideNode=new d();this.addChild(this._nUSideNode);this._nVSideNode=new d();this.addChild(this._nVSideNode)}if(this._bResizeManipulator){this._nCornerNode=new d();this.addChild(this._nCornerNode)}this._bVisuNotBuild=true;this._addManipulators();this._fPreviousPlaneUSize=0;this._fPreviousPlaneVSize=0;this._cPreviousColor=0;this._fPreviousOpacitUSide=0;this._sPreviousDisplayPlaneMode=0;this.update();return this},setName:function(m){this._nCenterPlaneNode.name=m;this._nCenterPlaneSubNode.name=m;if(this._nUSideNode){this._nUSideNode.name=m;this._nUpSideSubNode.name=m;this._nUmSideSubNode.name=m}if(this._nVSideNode){this._nVSideNode.name=m;this._nVpSideSubNode.name=m;this._nVmSideSubNode.name=m}if(this._nCornerNode){this._nCornerNode.name=m;this._nUpVpCornerSubNode.name=m;this._nUpVmCornerSubNode.name=m;this._nUmVpCornerSubNode.name=m;this._nUmVmCornerSubNode.name=m}},clean:function(){if(this._bCenterManipulator&&this._nPointHandle){this._nPointHandle.dispose()}if(this._ruler){this._ruler.clean()}},update:function(){var m=this._CBGetDisplayInformation();this._mMaterial.color=m.fillColor;this._mMaterial.opacity=m.opacity;this._rebuildPlaneSubNodes();this._updateManipulators();this._bVisuNotBuild=false;return this},getState:function(){return c.State.STANDARD},getShowState:function(){return true},getGeometry:function(){return{referential:new g.Matrix4(),uSize:1000,vSize:1000}},setGeometry:function(){},getDisplayInformation:function(){return{mode:c.DisplayMode.PLANE,fillColor:new g.Color(7979230),opacity:0.2}},getManipulationInformation:function(){return true},_getCenter:function(){var m=this._CBGetGeometry(this._sType);return new g.Vector3().getPositionFromMatrix(m.referential)},_getNormal:function(){var n=this._CBGetGeometry(this._sType);var m=n.referential.decompose();return new g.Vector3(0,0,1).applyQuaternion(m[1])},_getUDirection:function(){var n=this._CBGetGeometry(this._sType);var m=n.referential.decompose();return new g.Vector3(1,0,0).applyQuaternion(m[1])},_getVDirection:function(){var n=this._CBGetGeometry(this._sType);var m=n.referential.decompose();return new g.Vector3(0,1,0).applyQuaternion(m[1])},_isPlaneSubNodesNeedRebuild:function(){var o=!this._bVisuNotBuild;if(o){var n=this._CBGetGeometry(this._sType);o=o&&(this._fPreviousPlaneUSize===n.uSize);o=o&&(this._fPreviousPlaneVSize===n.vSize);var m=this._CBGetDisplayInformation();o=o&&(this._cPreviousColor===m.fillColor);o=o&&(this._fPreviousOpacity===m.opacity);o=o&&(this._sPreviousDisplayPlaneMode===m.mode)}return !o},_recordPlaneData:function(){var n=this._CBGetGeometry(this._sType);this._fPreviousPlaneUSize=n.uSize;this._fPreviousPlaneVSize=n.vSize;var m=this._CBGetDisplayInformation();this._cPreviousColor=m.fillColor;this._fPreviousOpacity=m.opacity;this._sPreviousDisplayPlaneMode=m.mode},_setPlaneVisibility:function(m){if(this._viewer.getVisibleSpace()===0){m=!m}this._nCenterPlaneNode.setVisibility(m);if(this._nUSideNode){this._nUSideNode.setVisibility(m)}if(this._nVSideNode){this._nVSideNode.setVisibility(m)}if(this._nCornerNode){this._nCornerNode.setVisibility(m)}},_rebuildPlaneSubNodes:function(){var m=false;if(this._isPlaneSubNodesNeedRebuild()){this._recordPlaneData();this._rebuildSidesSubNodes();this._rebuildCornersSubNodes();this._rebuildCenterSubNode();m=true}return m},_rebuildSidesSubNodes:function(){if(this._nUSideNode&&this._nVSideNode){var q=this._CBGetDisplayInformation();var s=this._CBGetGeometry(this._sType);var o=s.uSize;var t=s.vSize;var r=o/2;var p=t/2;var n=Math.max(o,t)/20;var m;this._nUSideNode.manipulator.deactivate(this._nUSideNode.token);this._nVSideNode.manipulator.deactivate(this._nVSideNode.token);if(this._nUpSideSubNode!==null){this._nUSideNode.remove(this._nUpSideSubNode)}if(this._nUmSideSubNode!==null){this._nUSideNode.remove(this._nUmSideSubNode)}if(this._nVpSideSubNode!==null){this._nVSideNode.remove(this._nVpSideSubNode)}if(this._nVmSideSubNode!==null){this._nVSideNode.remove(this._nVmSideSubNode)}m=j.createRectangle(o,n,false,undefined,true,q.fillColor);this._nUpSideSubNode=f.createMeshNode(m,this._mMaterial);this._nUpSideSubNode.excludeFromHighlight(true,false);this._nUpSideSubNode.setShadow(false);this._nUpSideSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(-r,p,0)));this._nUSideNode.addChild(this._nUpSideSubNode);m=j.createRectangle(o,n,false,undefined,true,q.fillColor);this._nUmSideSubNode=f.createMeshNode(m,this._mMaterial);this._nUmSideSubNode.excludeFromHighlight(true,false);this._nUmSideSubNode.setShadow(false);this._nUmSideSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(-r,-p-n,0)));this._nUSideNode.addChild(this._nUmSideSubNode);m=j.createRectangle(n,t,false,undefined,true,q.fillColor);this._nVpSideSubNode=f.createMeshNode(m,this._mMaterial);this._nVpSideSubNode.excludeFromHighlight(true,false);this._nVpSideSubNode.setShadow(false);this._nVpSideSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(r,-p,0)));this._nVSideNode.addChild(this._nVpSideSubNode);m=j.createRectangle(n,t,false,undefined,true,q.fillColor);this._nVmSideSubNode=f.createMeshNode(m,this._mMaterial);this._nVmSideSubNode.excludeFromHighlight(true,false);this._nVmSideSubNode.setShadow(false);this._nVmSideSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(-r-n,-p,0)));this._nVSideNode.addChild(this._nVmSideSubNode);this._nUSideNode.manipulator.activate(this._nUSideNode.token);this._nVSideNode.manipulator.activate(this._nVSideNode.token)}},_rebuildCornersSubNodes:function(){if(this._nCornerNode){var q=this._CBGetDisplayInformation();var s=this._CBGetGeometry(this._sType);var o=s.uSize;var t=s.vSize;var r=o/2;var p=t/2;var n=Math.max(o,t)/20;var m;this._nCornerNode.manipulator.deactivate(this._nCornerNode.token);if(this._nUpVpCornerSubNode!==null){this._nCornerNode.remove(this._nUpVpCornerSubNode)}if(this._nUpVmCornerSubNode!==null){this._nCornerNode.remove(this._nUpVmCornerSubNode)}if(this._nUmVpCornerSubNode!==null){this._nCornerNode.remove(this._nUmVpCornerSubNode)}if(this._nUmVmCornerSubNode!==null){this._nCornerNode.remove(this._nUmVmCornerSubNode)}m=j.createRectangle(n,n,false,undefined,true,q.fillColor);this._nUpVpCornerSubNode=f.createMeshNode(m,this._mMaterial);this._nUpVpCornerSubNode.excludeFromHighlight(true,false);this._nUpVpCornerSubNode.setShadow(false);this._nUpVpCornerSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(r,p,0)));this._nUpVpCornerSubNode.name="UV";this._nCornerNode.addChild(this._nUpVpCornerSubNode);m=j.createRectangle(n,n,false,undefined,true,q.fillColor);this._nUpVmCornerSubNode=f.createMeshNode(m,this._mMaterial);this._nUpVmCornerSubNode.excludeFromHighlight(true,false);this._nUpVmCornerSubNode.setShadow(false);this._nUpVmCornerSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(r,-p-n,0)));this._nUpVmCornerSubNode.name="U-V";this._nCornerNode.addChild(this._nUpVmCornerSubNode);m=j.createRectangle(n,n,false,undefined,true,q.fillColor);this._nUmVpCornerSubNode=f.createMeshNode(m,this._mMaterial);this._nUmVpCornerSubNode.excludeFromHighlight(true,false);this._nUmVpCornerSubNode.setShadow(false);this._nUmVpCornerSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(-r-n,p,0)));this._nUmVpCornerSubNode.name="-UV";this._nCornerNode.addChild(this._nUmVpCornerSubNode);m=j.createRectangle(n,n,false,undefined,true,q.fillColor);this._nUmVmCornerSubNode=f.createMeshNode(m,this._mMaterial);this._nUmVmCornerSubNode.excludeFromHighlight(true,false);this._nUmVmCornerSubNode.setShadow(false);this._nUmVmCornerSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(-r-n,-p-n,0)));this._nUmVmCornerSubNode.name="-U-V";this._nCornerNode.addChild(this._nUmVmCornerSubNode);this._nCornerNode.manipulator.activate(this._nCornerNode.token)}},_rebuildCenterSubNode:function(){var C=this._CBGetDisplayInformation();var u=this._CBGetGeometry(this._sType);var D=u.uSize;var w=u.vSize;var z=D/2;var A=w/2;var t;var s;if(this._nCenterPlaneNode.manipulator){this._nCenterPlaneNode.manipulator.deactivate(this._nCenterPlaneNode.token)}if(this._nCenterPlaneSubNode!==null){this._nCenterPlaneNode.remove(this._nCenterPlaneSubNode)}if(C.mode===c.DisplayMode.PLANE){t=j.createRectangle(D,w,false,undefined,true,C.fillColor);this._nCenterPlaneSubNode=f.createMeshNode(t,this._mMaterial);this._nCenterPlaneSubNode.excludeFromCSO(true);this._nCenterPlaneSubNode.excludeFromHighlight(true,false);this._nCenterPlaneSubNode.setShadow(false);this._nCenterPlaneSubNode.setMatrix(new g.Matrix4().translate(new g.Vector3(-z,-A,0)))}else{if(C.mode===c.DisplayMode.GRID){this._nCenterPlaneSubNode=new d();var p=u.uStep;var v=u.vStep;if(!p){p=D/10}if(!v){v=w/10}var y=Math.floor(z/p);var x=Math.floor(A/v);var H=new a.Color(C.fillColor.r,C.fillColor.g,C.fillColor.b,1);var F;for(var E=-y;E<=y;E++){F=p*E;var r=new g.Vector3(F,A);var q=new g.Vector3(F,-A);var m=[r,q];s=f.createLineNode({points:m,color:H});s.excludeFromHighlight(true,false);s.setShadow(false);this._nCenterPlaneSubNode.addChild(s)}for(var B=-x;B<=x;B++){F=v*B;var o=new g.Vector3(z,F);var n=new g.Vector3(-z,F);var G=[o,n];s=f.createLineNode({points:G,color:H});s.excludeFromHighlight(true,false);s.setShadow(false);this._nCenterPlaneSubNode.addChild(s)}}}this._nCenterPlaneNode.addChild(this._nCenterPlaneSubNode);if(this._nCenterPlaneNode.manipulator){this._nCenterPlaneNode.manipulator.activate(this._nCenterPlaneNode.token)}},_addManipulators:function(){if(this._bTranslationManipulator){this._addTranslator()}if(this._bRotationManipulator){this._addRotatorU();this._addRotatorV()}if(this._bResizeManipulator){this._addResizor()}if(this._bCenterManipulator){this._addPointManipulator()}if(this._rulerClass){this._ruler=new this._rulerClass(this)}},_setNodeVisibility:function(r){if(r){var q=this._viewer.getVisibleSpace();var n=q===0?!this._CBGetShowState():this._CBGetShowState();var p=(this._CBGetState()===c.State.INEDITION);var o=n&&p;r.setVisibility(o);var m=o?q!==0:q===0;if(m===true&&p===false&&q===0){m=false}r.setVisibilityFree(!m)}},_setPointHandleVisibility:function(){if(this._bCenterManipulator){this._setNodeVisibility(this._nPointHandle)}},_updateManipulators:function(){if(this._bTranslationManipulator){this._nCenterPlaneNode.manipulator.axis=this._getNormal()}if(this._bRotationManipulator){this._nUSideNode.manipulator.setAxis(this._getUDirection());this._nUSideNode.manipulator.setCenter(this._getCenter());this._nVSideNode.manipulator.setAxis(this._getVDirection());this._nVSideNode.manipulator.setCenter(this._getCenter())}if(this._bResizeManipulator){this._nCornerNode.manipulator.axis=this._getNormal()}if(this._nPointHandle){this._setPointHandleVisibility();var m=this._CBGetDisplayInformation();this._nPointHandle.setFillColor(m.fillColor)}if(this._ruler){this._ruler.update()}},_onTranslatorManipulationBeginCB:function(m){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.TRANSLATION,evt:m.event})){this._vInitialCenter=this._getCenter();if(this._ruler){this._ruler.updateOnTranslationBegin(m)}this._CBManipulationInformation({action:c.ManipulationAction.BEGIN,type:c.ManipulationType.TRANSLATION,evt:m.event})}},_onTranslatorManipulationCB:function(n){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.TRANSLATION,evt:n.event})){var o=this._CBGetGeometry(this._sType);var m=o.referential;m.setPosition(this._vInitialCenter.clone().add(n.translationVector));this._CBSetGeometry({referential:m});this._updateManipulators();if(this._ruler){this._ruler.updateOnTranslation(n)}this._CBManipulationInformation({action:c.ManipulationAction.DO,type:c.ManipulationType.TRANSLATION,evt:n.event})}},_onTranslatorManipulationEndCB:function(m){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.TRANSLATION,evt:m.event})){this._vInitialCenter=undefined;if(this._ruler){this._ruler.updateOnTranslationEnd()}}this._CBManipulationInformation({action:c.ManipulationAction.END,type:c.ManipulationType.TRANSLATION,evt:m.event})},_addTranslator:function(){this._nCenterPlaneNode.manipulator=new b({axis:this._getNormal()});this._nCenterPlaneNode.manipulator.setExclusive(true);this._nCenterPlaneNode.manipulator.setPickingPriority(false);this._nCenterPlaneNode.manipulator.setPickingDuringManipulation(false);this._nCenterPlaneNode.manipulator.setPrePickingDuringManipulation(false);this._nCenterPlaneNode.manipulator.setPreActivationDuringManipulation(false);this._nCenterPlaneNode.manipulator.setPickingInManipulation(true);this._nCenterPlaneNode.token=this._nCenterPlaneNode.manipulator.linkToNode(this._nCenterPlaneNode);var m=this;this._nCenterPlaneNode.manipulator.subscribe("BeginManipulate",function(n){m._onTranslatorManipulationBeginCB(n)});this._nCenterPlaneNode.manipulator.subscribe("Manipulate",function(n){m._onTranslatorManipulationCB(n)});this._nCenterPlaneNode.manipulator.subscribe("EndManipulate",function(n){m._onTranslatorManipulationEndCB(n)})},_rotatorManipulationBeginCB:function(m,o){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.ROTATION,evt:m.event})){var n=this._CBGetGeometry(this._sType);this._mInitialMatrix=new g.Matrix4().copy(n.referential);if(this._ruler){this._ruler.updateOnRotationBegin(m,o)}this._CBManipulationInformation({action:c.ManipulationAction.BEGIN,type:c.ManipulationType.ROTATION,evt:m.event})}},_rotatorManipulationCB:function(q,r){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.ROTATION,evt:q.event})){var o=r?this._nUSideNode.manipulator.axis:this._nVSideNode.manipulator.axis;var n=q.axis.clone().dot(o);var m=(!e.isLessOrEqual(n,0))?q.angle:-q.angle;var p=(r?this._mInitialMatrix.clone().rotateX(m):this._mInitialMatrix.clone().rotateY(m));this._CBSetGeometry({referential:p});if(this._ruler){this._ruler.updateOnRotation(q)}this._CBManipulationInformation({action:c.ManipulationAction.DO,type:c.ManipulationType.ROTATION,evt:q.event})}},_rotatorManipulationEndCB:function(m){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.ROTATION,evt:m.event})){this._mInitialMatrix=undefined;if(this._ruler){this._ruler.updateOnRotationEnd()}}this._CBManipulationInformation({action:c.ManipulationAction.END,type:c.ManipulationType.ROTATION,evt:m.event})},_addRotatorU:function(){if(this._nUSideNode){this._nUSideNode.manipulator=new l({axis:this._getUDirection()});this._nUSideNode.manipulator.setCenter(this._getCenter());this._nUSideNode.manipulator.setExclusive(true);this._nUSideNode.manipulator.setPickingPriority(false);this._nUSideNode.manipulator.setPickingDuringManipulation(false);this._nUSideNode.manipulator.setPrePickingDuringManipulation(false);this._nUSideNode.manipulator.setPreActivationDuringManipulation(false);this._nUSideNode.token=this._nUSideNode.manipulator.linkToNode(this._nUSideNode);var m=this;this._nUSideNode.manipulator.subscribe("BeginManipulate",function(n){m._rotatorManipulationBeginCB(n,true)});this._nUSideNode.manipulator.subscribe("Manipulate",function(n){m._rotatorManipulationCB(n,true)});this._nUSideNode.manipulator.subscribe("EndManipulate",function(n){m._rotatorManipulationEndCB(n)})}},_addRotatorV:function(){if(this._nVSideNode){this._nVSideNode.manipulator=new l({axis:this._getVDirection()});this._nVSideNode.manipulator.setCenter(this._getCenter());this._nVSideNode.manipulator.setExclusive(true);this._nVSideNode.manipulator.setPickingPriority(false);this._nVSideNode.manipulator.setPickingDuringManipulation(false);this._nVSideNode.manipulator.setPrePickingDuringManipulation(false);this._nVSideNode.manipulator.setPreActivationDuringManipulation(false);this._nVSideNode.token=this._nVSideNode.manipulator.linkToNode(this._nVSideNode);var m=this;this._nVSideNode.manipulator.subscribe("BeginManipulate",function(n){m._rotatorManipulationBeginCB(n,false)});this._nVSideNode.manipulator.subscribe("Manipulate",function(n){m._rotatorManipulationCB(n,false)});this._nVSideNode.manipulator.subscribe("EndManipulate",function(n){m._rotatorManipulationEndCB(n)})}},_refreshAngularRuler:function(o){if(this._angularRuler&&o){var n=new g.Vector3().copy(o.axis);var m=this._angularRuler.direction.dot(n);var p=e.isLessThan(m,0)?2*Math.PI-o.angle:o.angle;this._angularRuler.setValue(this._angularRuler.initValue+p*180/Math.PI);this._angularRuler.refresh()}},clearRulers:function(){if(this._ruler){this._ruler.clearRulers()}},_doResizerManipulateBeginCB:function(m){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.RESIZE,evt:m.event})){this._sCorner=m.intersection.path[0].getLastElement().name;this._vInitialPosition=this._getCornerPosition(this._sCorner);this.clearRulers();this._CBManipulationInformation({action:c.ManipulationAction.BEGIN,type:c.ManipulationType.RESIZE,evt:m.event})}},_doResizerManipulateCB:function(m){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.RESIZE,evt:m.event})){this._modifyCornerPosition(this._sCorner,this._vInitialPosition.clone().add(m.translationVector));this._CBManipulationInformation({action:c.ManipulationAction.DO,type:c.ManipulationType.RESIZE,evt:m.event})}},_doResizerManipulateEndCB:function(m){if(this._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.RESIZE,evt:m.event})){this._sCorner=undefined;this._vInitialPosition=undefined}this._CBManipulationInformation({action:c.ManipulationAction.END,type:c.ManipulationType.RESIZE,evt:m.event})},_addResizor:function(){this._nCornerNode.manipulator=new h({axis:this._getNormal()});this._nCornerNode.manipulator.setExclusive(true);this._nCornerNode.manipulator.setPickingPriority(false);this._nCornerNode.manipulator.setPickingDuringManipulation(false);this._nCornerNode.manipulator.setPrePickingDuringManipulation(false);this._nCornerNode.manipulator.setPreActivationDuringManipulation(false);this._nCornerNode.token=this._nCornerNode.manipulator.linkToNode(this._nCornerNode);var m=this;this._nCornerNode.manipulator.subscribe("BeginManipulate",function(n){m._doResizerManipulateBeginCB(n)});this._nCornerNode.manipulator.subscribe("Manipulate",function(n){m._doResizerManipulateCB(n)});this._nCornerNode.manipulator.subscribe("EndManipulate",function(n){m._doResizerManipulateEndCB(n)})},_addPointManipulator:function(){var p=this._CBGetDisplayInformation();this._nPointHandle=new k({viewer:this._viewer,sceneGraph:this});this._nPointHandle.name="PointHandle";this._nPointHandle.setFillColor(p.fillColor);this._nPointHandle.setVisibilityInTree(false);var o=10;var q=this;var m;var n;this._nPointHandle.subscribe("BeginManipulate",function(s){if(q._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.CENTER,evt:s.event})){n=new g.Matrix4().getInverse(q._CBGetGeometry(this._sType).referential);q._nPointHandle.setPickable(a.NODRAWHL);q._setPlaneVisibility(false);q.clearRulers();var r=new g.MeshBasicMaterial({color:p.fillColor,side:g.DoubleSide,transparent:true,alphaTest:0.5,enableClipPlanes:false});r.force=true;q._nPointHandleSmallPlane=f.createRectangleNode({width:o,height:o,material:r});q._nPointHandleSmallPlane.setShadow(false);q._nPointHandleSmallPlane.setPickable(a.NOPICKABLE);q._nPointHandleSmallPlane.setVisibility(false);q._nPointHandleSmallPlane.setVisibilityInTree(false);q.addChild(q._nPointHandleSmallPlane);q._CBManipulationInformation({action:c.ManipulationAction.BEGIN,type:c.ManipulationType.CENTER,evt:s.event})}});this._nPointHandle.subscribe("Manipulate",function(C){if(q._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.CENTER,evt:C.event})){var s=C.intersection;var A=s.position&&s.path.length;if(A){var u=s.normal.negate();u.normalize();var w=new g.Vector3(1,0,0).projectOnPlane(u);var B=w.length();var v=new g.Vector3(0,1,0).projectOnPlane(u);var z=v.length();var t=new g.Vector3().crossVectors(new g.Vector3(0,0,1),u);var x=new g.Vector3(0,0,1).dot(u);if(e.areEqual(Math.abs(x),1,"float")){if(e.areEqual(B,z,"float")){w.normalize();v=new g.Vector3().crossVectors(u,w).normalize()}else{if(e.isLessThan(B,z)){v.normalize();w=new g.Vector3().crossVectors(v,u).normalize()}else{w.normalize();v=new g.Vector3().crossVectors(u,w).normalize()}}}else{w=t.normalize();v=new g.Vector3().crossVectors(u,w).normalize()}m=new g.Matrix4(w.x,v.x,u.x,0,w.y,v.y,u.y,0,w.z,v.z,u.z,0,0,0,0,1);m.setPosition(s.position);q._nPointHandle.setMatrix(n.clone().multiply(m));var y=-o/2;var D=m.clone();var r=s.position.clone().add(w.clone().multiplyScalar(y)).add(v.clone().multiplyScalar(y));D.setPosition(r);q._nPointHandleSmallPlane.setVisibility(true);q._nPointHandleSmallPlane.setMatrix(n.clone().multiply(D));q._CBManipulationInformation({action:c.ManipulationAction.DO,type:c.ManipulationType.CENTER,evt:C.event})}}});this._nPointHandle.subscribe("EndManipulate",function(r){if(q._CBManipulationInformation({action:c.ManipulationAction.ENABLE,type:c.ManipulationType.CENTER,evt:r.event})){q._CBSetGeometry({referential:m});q._updateManipulators();q._setPlaneVisibility(true);q._nPointHandle.setMatrix(new g.Matrix4());q._nPointHandle.setPickable(a.PICKABLE);q.clearRulers();if(q._nPointHandleSmallPlane){q.remove(q._nPointHandleSmallPlane)}}q._CBManipulationInformation({action:c.ManipulationAction.END,type:c.ManipulationType.CENTER,evt:r.event})})},_getCornerPosition:function(v){var u=this._CBGetGeometry(this._sType);var o=u.uSize;var n=u.vSize;var s=((v==="UV")||(v==="U-V"))?1:-1;var r=((v==="UV")||(v==="-UV"))?1:-1;var m=u.referential.decompose();var t=m[0];var x=m[1];var w=new g.Vector3(1,0,0).applyQuaternion(x);var p=new g.Vector3(0,1,0).applyQuaternion(x);var q=t.clone().add(w.multiplyScalar(s*o/2)).add(p.multiplyScalar(r*n/2));return q},_modifyCornerPosition:function(z,s){var x=this._CBGetGeometry(this._sType);var q=x.uSize;var o=x.vSize;var v=((z==="UV")||(z==="U-V"))?1:-1;var t=((z==="UV")||(z==="-UV"))?1:-1;var n=x.referential.decompose();var u=n[0];var B=n[1];var A=(new g.Vector3(1,0,0).applyQuaternion(B)).multiplyScalar(v);var r=(new g.Vector3(0,1,0).applyQuaternion(B)).multiplyScalar(t);var p=u.clone().add(A.clone().multiplyScalar(-q/2)).add(r.clone().multiplyScalar(-o/2));var m=s.clone().sub(p);var w=x.referential.clone();var y=(p.clone().add(s)).multiplyScalar(0.5);w.setPosition(y);this._CBSetGeometry({referential:w,uSize:m.dot(A),vSize:m.dot(r)});this._updateManipulators()}});c.State={STANDARD:0,INEDITION:1};c.DisplayMode={PLANE:0,GRID:1};c.ManipulationAction={ENABLE:0,BEGIN:1,DO:2,END:3};c.ManipulationType={TRANSLATION:0,ROTATION:1,RESIZE:2,CENTER:3};return c});define("DS/DMUMeasurable/DMUMathsBoundingGeometry",["DS/DMUMeasurable/DMUMathsVector3D"],function(d){var a=0.001;var c=0.000001;var b={areEqualAABB:function(g,f){var e=(Math.abs(f[0]-g[0])<a)&&(Math.abs(f[1]-g[1])<a)&&(Math.abs(f[2]-g[2])<a)&&(Math.abs(f[3]-g[3])<a)&&(Math.abs(f[4]-g[4])<a)&&(Math.abs(f[5]-g[5])<a);return e},computeAABBDistance:function(f,e){return Math.sqrt(b.computeAABBSquaredDistance(f,e))},computeAABBSquaredDistance:function(f,e){var j=0;var i=0;var h=0;var g=0;if(f[3]<e[0]){i=e[0]-f[3]}else{if(f[0]>e[3]){i=f[0]-e[3]}}if(f[4]<e[1]){h=e[1]-f[4]}else{if(f[1]>e[4]){h=f[1]-e[4]}}if(f[5]<e[2]){g=e[2]-f[5]}else{if(f[2]>e[5]){g=f[2]-e[5]}}if((i!==0)||(h!==0)||(g!==0)){j=i*i+h*h+g*g}return j},computeAABBSquaredMaxDistance:function(f,e){var j=0;var i=Math.max(Math.abs(e[0]-f[3]),Math.abs(e[3]-f[0]));var h=Math.max(Math.abs(e[1]-f[4]),Math.abs(e[4]-f[1]));var g=Math.max(Math.abs(e[2]-f[5]),Math.abs(e[5]-f[2]));j=i*i+h*h+g*g;return j},computeAABBForPoint:function(f){var e=[];e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[0];e[4]=f[1];e[5]=f[2];return e},computeAABBForPoints:function(k){var f=[];var j=k.length;var l;var h;var g;f[0]=k[0][0];f[1]=k[0][1];f[2]=k[0][2];f[3]=f[0];f[4]=f[1];f[5]=f[2];for(var e=1;e<j;e++){l=k[e][0];h=k[e][1];g=k[e][2];if(l<f[0]){f[0]=l}else{if(l>f[3]){f[3]=l}}if(h<f[1]){f[1]=h}else{if(h>f[4]){f[4]=h}}if(g<f[2]){f[2]=g}else{if(g>f[5]){f[5]=g}}}return f},computeAABBForUnsortedPoints:function(o,f,q,h,e){var p=[];var m;var n;var l;var k;if(e&&!d.isIdentity(e)){m=3*q[f];p=d.transformPoint([h[m],h[m+1],h[m+2]],e);p[3]=p[0];p[4]=p[1];p[5]=p[2];for(var j=1;j<o;j++){m=3*q[f+j];var g=d.transformPoint([h[m],h[m+1],h[m+2]],e);n=g[0];l=g[1];k=g[2];if(n<p[0]){p[0]=n}else{if(n>p[3]){p[3]=n}}if(l<p[1]){p[1]=l}else{if(l>p[4]){p[4]=l}}if(k<p[2]){p[2]=k}else{if(k>p[5]){p[5]=k}}}}else{m=3*q[f];p[0]=h[m];p[1]=h[m+1];p[2]=h[m+2];p[3]=p[0];p[4]=p[1];p[5]=p[2];for(var j=1;j<o;j++){m=3*q[f+j];n=h[m];l=h[m+1];k=h[m+2];if(n<p[0]){p[0]=n}else{if(n>p[3]){p[3]=n}}if(l<p[1]){p[1]=l}else{if(l>p[4]){p[4]=l}}if(k<p[2]){p[2]=k}else{if(k>p[5]){p[5]=k}}}}return p},computeAABBForSegment:function(f,e){var g=[];g[0]=Math.min(f[0],e[0]);g[1]=Math.min(f[1],e[1]);g[2]=Math.min(f[2],e[2]);g[3]=Math.max(f[0],e[0]);g[4]=Math.max(f[1],e[1]);g[5]=Math.max(f[2],e[2]);return g},computeAABBForTriangle:function(f,e,h){var g=[];g[0]=Math.min(f[0],e[0],h[0]);g[1]=Math.min(f[1],e[1],h[1]);g[2]=Math.min(f[2],e[2],h[2]);g[3]=Math.max(f[0],e[0],h[0]);g[4]=Math.max(f[1],e[1],h[1]);g[5]=Math.max(f[2],e[2],h[2]);return g},intersectAABBWithRay:function(e,g,h){var j=false;if(((Math.abs(h[0])>a)||((g[0]>e[0])&&(g[0]<e[3])))&&((Math.abs(h[1])>a)||((g[1]>e[1])&&(g[1]<e[4])))&&((Math.abs(h[2])>a)||((g[2]>e[2])&&(g[2]<e[5])))){var l,f;var i,m;var k;if(Math.abs(h[0])<a){l=-Number.MAX_VALUE;f=Number.MAX_VALUE}else{k=1/h[0];if(k>=0){l=(e[0]-g[0])*k;f=(e[3]-g[0])*k}else{l=(e[3]-g[0])*k;f=(e[0]-g[0])*k}}if(Math.abs(h[1])<a){i=-Number.MAX_VALUE;m=Number.MAX_VALUE}else{k=1/h[1];if(k>=0){i=(e[1]-g[1])*k;m=(e[4]-g[1])*k}else{i=(e[4]-g[1])*k;m=(e[1]-g[1])*k}}if((l<m)&&(i<f)){if(i>l){l=i}if(m<f){f=m}if(Math.abs(h[2])<a){i=-Number.MAX_VALUE;m=Number.MAX_VALUE}else{k=1/h[2];if(k>=0){i=(e[2]-g[2])*k;m=(e[5]-g[2])*k}else{i=(e[5]-g[2])*k;m=(e[2]-g[2])*k}}if((l<m)&&(i<f)){if(i>l){l=i}if(m<f){f=m}if(f>0){j=true}}}}return j},areEqualBoundingSpheres:function(g,f){var e=(Math.abs(f[0]-g[0])<a)&&(Math.abs(f[1]-g[1])<a)&&(Math.abs(f[2]-g[2])<a)&&(Math.abs(f[3]-g[3])<a);return e},computeBoundingSpheresDistance:function(f,e){return Math.max(0,d.subAndLength(f,e)-f[3]-e[3])},computeBoundingSpheresSquaredDistance:function(f,e){var g=b.computeBoundingSpheresDistance(f,e);return g*g},computeBoundingSphereForPoint:function(f){var e=[];e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=0;return e},computeBoundingSphereForPoints:function(h){var e=[];var g=b.computeAABBForPoints(h);var f=[g[3],g[4],g[5]];e=b.computeBoundingSphereForSegment(g,f);return e},computeBoundingSphereForSegment:function(f,g){var e=[];e[0]=(f[0]+g[0])/2;e[1]=(f[1]+g[1])/2;e[2]=(f[2]+g[2])/2;e[3]=d.subAndLength(f,g)/2;return e},computeBoundingSphereForTriangle:function(m,l,k){var e=[];var g=d.sub(m,l);var f=d.sub(m,k);var p=d.squaredLength(g);var n=d.squaredLength(f);var h=d.dot(g,f);var i=2*(p*n-h*h);var j;if(Math.abs(i)<=c){var r=b.computeAABBForTriangle(m,l,k);j=[r[3],r[4],r[5]];e=b.computeBoundingSphereForSegment(r,j)}else{var q=(p*n-n*h)/i;var o=(n*p-p*h)/i;var s=m;if(q<=0){j=d.add(m,k);e=d.multiply(j,0.5)}else{if(o<=0){j=d.add(m,l);e=d.multiply(j,0.5)}else{if(q+o>=1){j=d.add(l,k);e=d.multiply(j,0.5);s=l}else{j=d.multiplyAndAdd(g,q,m);e=d.multiplyAndAdd(f,o,j)}}}e[3]=d.subAndLength(e,m)}return e}};return b});define("DS/DMUMeasurable/DMUMathsInfiniteGeometry",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUGeometryEnums"],function(e,c){var b=0.001;var d=0.000001;var a={computeTwoPointsDistance:function(h,g){var f={};f.returnCode=1;if(h&&g){f.returnCode=0;f.distance=e.subAndLength(h,g);f.relationship=(f.distance<b)?c.Relationship.COINCIDENT:c.Relationship.NONE}return f},computePointLineDistance:function(k,j,g){var f={};f.returnCode=1;if(k&&j&&g){var h=e.squaredLength(g);if(h>d){f.returnCode=0;var i=e.dot(e.sub(j,k),g)/h;f.aPosition=e.multiplyAndAdd(g,i,j);f.distance=e.subAndLength(k,f.aPosition);f.relationship=(f.distance<b)?c.Relationship.COINCIDENT:c.Relationship.NONE}}return f},computePointPlaneDistance:function(k,g,i){var f={};f.returnCode=1;if(k&&g&&i){var h=e.squaredLength(i);if(h>d){f.returnCode=0;var j=e.dot(e.sub(k,g),i)/h;f.aPosition=e.multiplyAndAdd(i,j,k);f.distance=e.subAndLength(k,f.aPosition);f.relationship=(f.distance<b)?c.Relationship.COINCIDENT:c.Relationship.NONE}}return f},computeTwoLinesDistance:function(r,q,g,h){var s={};s.returnCode=1;if(r&&q&&g&&h){s.returnCode=0;var f=e.sub(g,r);var n=e.squaredLength(q);var m=e.dot(q,h);var k=e.squaredLength(h);var j=e.dot(q,f);var i=e.dot(h,f);var l=n*k-m*m;var p=0;var o=0;if(l<b){p=0;o=(m>k)?(j/m):(i/k);s.aPosition1=e.clone(r);s.aPosition2=e.multiplyAndAdd(h,o,g);s.distance=e.subAndLength(s.aPosition1,s.aPosition2);s.relationship=(s.distance<b)?c.Relationship.COINCIDENT:c.Relationship.PARRALLEL;s.angle=0}else{p=(m*i-k*j)/l;o=(n*i-m*j)/l;s.aPosition1=e.multiplyAndAdd(q,p,r);s.aPosition2=e.multiplyAndAdd(h,o,g);s.distance=e.subAndLength(s.aPosition1,s.aPosition2);s.relationship=(s.distance<b)?c.Relationship.INTERSECTING:c.Relationship.NONE;s.angle=e.angle(q,h)}}return s},computeLinePlaneDistance:function(i,j,h,g){var o={};o.returnCode=1;if(i&&j&&h&&g){o.returnCode=0;var l=e.normalize(j);var f=e.normalize(g);var m=e.dot(l,f);if(Math.abs(m)<b){o.angle=0;var k=a.computePointPlaneDistance(i,h,f);if((k.returnCode===0)&&(k.distance<b)){o.distance=0;o.aPosition=e.clone(i);o.relationship=c.Relationship.COINCIDENT}else{o.distance=k.distance;o.aPosition=k.aPosition;o.relationship=c.Relationship.PARRALLEL}}else{o.distance=0;o.angle=Math.asin(m);var n=e.dot(e.sub(i,h),f)/m;o.aPosition=e.multiplyAndAdd(l,n,i);o.relationship=c.Relationship.INTERSECTING}}return o},computeTwoPlanesDistance:function(p,u,o,s){var v={};v.returnCode=1;if(p&&u&&o&&s){v.returnCode=0;var m=e.normalize(u);var g=e.normalize(s);if(e.areEqual(m,g)||e.isNull(e.add(m,g))){v.angle=0;var q=(e.areEqual(m,g))?1:-1;var n=e.dot(p,m);var l=e.dot(o,g);v.distance=Math.abs(n-q*l);var k=a.computePointPlaneDistance(o,p,m);v.aPosition1=k.aPosition;var j=a.computePointPlaneDistance(p,o,g);v.aPosition2=j.aPosition;v.relationship=(v.distance<b)?c.Relationship.COINCIDENT:c.Relationship.PARRALLEL}else{v.distance=0;v.angle=Math.acos(e.dot(m,g));var r=e.cross(m,g);var f=e.cross(m,r);var t=e.cross(g,r);var i=a.computeLinePlaneDistance(o,t,p,m);v.aPosition1=i.aPosition;var h=a.computeLinePlaneDistance(p,f,o,g);v.aPosition2=h.aPosition;v.relationship=c.Relationship.INTERSECTING}}return v}};return a});define("DS/DMUMeasurable/DMUMeshServices",["DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/Visualization/ThreeJS_DS","DS/Visualization/Measurable"],function(f,i,a,c,h,j,b){var l=0.1;var d=0.02;var g=0.000001;var e=50;var k={verifyMesh:function(n){var m=(n!==undefined)&&(n.group!==undefined)&&(n.group.glType!==undefined)&&(n.group.geometry!==undefined);m=m&&(n.count!==undefined)&&(n.count>0)&&(n.group.geometry.vertexIndexArray!==undefined);return m},extractMeshVertices:function(x,n,A,t){var q=[];var z=x.count;if(A&&(A<z)){z=A}var B=(t)?t:false;var p=x.start;var y=x.group.geometry;var o=y.vertexIndexArray;var m=y.vertexPositionArray;var v;if(n&&!a.isIdentity(n)){if(!B){for(var s=0;s<z;s++){v=3*o[p+s];q[s]=a.transformPoint([m[v],m[v+1],m[v+2]],n)}}else{var u=[];for(var s=0;s<z;s++){v=3*o[p+s];var w=false;for(var r=0;!w&&(r<u.length);r++){w=(v===u[r])}if(!w){q.push(a.transformPoint([m[v],m[v+1],m[v+2]],n));u.push(v)}}}}else{if(!B){for(var r=0;r<z;r++){v=3*o[p+r];q[r]=[m[v],m[v+1],m[v+2]]}}else{var u=[];for(var s=0;s<z;s++){v=3*o[p+s];var w=false;for(var r=0;!w&&(r<u.length);r++){w=(v===u[r])}if(!w){q.push([m[v],m[v+1],m[v+2]]);u.push(v)}}}}return q},extractMeshNormals:function(x,m,A,s){var o=[];if(k.verifyMesh(x)){var t=x.count;if(A&&(A<t)){t=A}var B=(s)?s:false;var p=x.start;var y=x.group.geometry;var n=y.vertexIndexArray;var z=y.vertexNormalArray;var v;if(m&&!a.isIdentity(m)){if(!B){for(var r=0;r<t;r++){v=3*n[p+r];o[r]=a.transformVector([z[v],z[v+1],z[v+2]],m)}}else{var u=[];for(var r=0;r<t;r++){v=3*n[p+r];var w=false;for(var q=0;!w&&(q<u.length);q++){w=(v===u[q])}if(!w){o.push(a.transformVector([z[v],z[v+1],z[v+2]],m));u.push(v)}}}}else{if(!B){for(var q=0;q<t;q++){v=3*n[p+q];o[q]=[z[v],z[v+1],z[v+2]]}}else{var u=[];for(var r=0;r<t;r++){v=3*n[p+r];var w=false;for(var q=0;!w&&(q<u.length);q++){w=(v===u[q])}if(!w){o.push([z[v],z[v+1],z[v+2]]);u.push(v)}}}}}return o},computeAABB:function(s,n){var q=s.count;var o=s.start;var r=s.group.geometry;var p=r.vertexIndexArray;var m=r.vertexPositionArray;return h.computeAABBForUnsortedPoints(q,o,p,m,n)},computeBoundingSphere:function(p,n){var m=[];var o=k.extractMeshVertices(p,n);var m=h.computeBoundingSphereForPoints(o);return m},_computeVolume:function(v,p){var z={};z.returnCode=1;if(v.group.glType===4){var o=k.extractMeshVertices(v);var y=o.length/3;var m=0;var n=[0,0,0];var w=[0,0,0];var u=[0,0,0];var t=[0,0,0];var x=[0,0,0];var r=[0,0,0];for(var q=0;q<y;q++){w=a.sub(p,o[3*q],w);u=a.sub(p,o[3*q+1],u);t=a.sub(p,o[3*q+2],t);var s=-(t[0]*u[1]*w[2])+(u[0]*t[1]*w[2])+(t[0]*w[1]*u[2])-(w[0]*t[1]*u[2])-(u[0]*w[1]*t[2])+(w[0]*u[1]*t[2]);x=a.add(w,a.add(u,t,x),x);m+=s;n=a.multiplyAndAdd(x,s,n,r)}z.returnCode=0;z.volume=m/6;z.aCog=(f.isZero(m))?[0,0,0]:a.multiplyAndAdd(n,1/(4*m),p)}return z}};return k});define("DS/DMUMeasurable/DMUMeshRecognition",["DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMeshServices","DS/Visualization/ThreeJS_DS","DS/Visualization/Measurable"],function(f,i,a,c,h,m,j,b){var l=0.1;var d=0.02;var g=0.000001;var e=50;var k={recognizeCanonicGeometry:function(w,B,q){var D={};D.returnCode=1;if(w.decoration){var t=new b(w);var C=t.getType();switch(C){case b.TYPEUNKNOWN:var p=m.extractMeshVertices(w);var z=w.group.glType;var y=p.length;if(y===1){D.returnCode=0;D.type=i.GeometryType.POINT;D.position=k._buildVector3(p[0]).applyMatrix4(B)}break;case b.TYPEPLANE:var u=t.getPlane();if(u){D.returnCode=0;D.type=i.GeometryType.PLANE;D.origin=k._buildVector3(u.position).applyMatrix4(B);D.normal=k._buildVector3(u.normal).transformDirection(B)}break;case b.TYPECYLINDER:var x=t.getCylinder();if(x){D.returnCode=0;D.type=i.GeometryType.CYLINDER;D.radius=x.radius;if(q){var p=m.extractMeshVertices(w);var s=k._computeMinMaxProjection(p,x.axis,x.center);if(s.returnCode===0){D.point1=k._buildVector3(s.aPoint1).applyMatrix4(B);D.point2=k._buildVector3(s.aPoint2).applyMatrix4(B)}}else{D.point1=k._buildVector3(x.center).applyMatrix4(B);D.point2=D.point1.clone().sub(k._buildVector3(x.axis)).applyMatrix4(B)}}break;case b.TYPECONE:var v=t.getCone();if(v){D.returnCode=0;D.type=i.GeometryType.CONE;D.semiAngle=v.semiAngle;D.apex=k._buildVector3(v.center).applyMatrix4(B);D.axis=k._buildVector3(v.axis).transformDirection(B);if(q){var p=m.extractMeshVertices(w);var s=k._computeMinMaxProjection(p,v.axis,v.center);if(s.returnCode===0){D.point1=k._buildVector3(s.aPoint1).applyMatrix4(B);D.point2=k._buildVector3(s.aPoint2).applyMatrix4(B)}}else{D.point1=k._buildVector3(v.center).applyMatrix4(B);D.point2=D.point1.clone().sub(k._buildVector3(v.axis)).applyMatrix4(B)}}break;case b.TYPESPHERE:var r=t.getSphere();if(r){D.returnCode=0;D.type=i.GeometryType.SPHERE;D.radius=r.radius;D.center=k._buildVector3(r.center).applyMatrix4(B)}break;case b.TYPELINE:var A=t.getLine();if(A){D.returnCode=0;D.type=i.GeometryType.LINE;D.point1=k._buildVector3(A.startPosition).applyMatrix4(B);D.point2=k._buildVector3(A.endPosition).applyMatrix4(B)}break;case b.TYPECIRCLE:var n=t.getCircle();if(n){D.returnCode=0;D.type=i.GeometryType.CIRCLE;D.radius=n.radius;D.center=k._buildVector3(n.center).applyMatrix4(B);D.normal=k._buildVector3(n.axis).transformDirection(B)}break}D.exact=D.returnCode===0}else{if(w._bNotRecognized===undefined){if(m.verifyMesh(w)){var p=m.extractMeshVertices(w);var z=w.group.glType;var y=p.length;if(y===1){D.returnCode=0;D.type=i.GeometryType.POINT;D.position=k._buildVector3(p[0]).applyMatrix4(B)}else{if(y===2){D=k._recognizeLine(p);if(D.returnCode===0){D.point1=k._buildVector3(D.aPoint1).applyMatrix4(B);D.point2=k._buildVector3(D.aPoint2).applyMatrix4(B)}}else{if(z===1){var s=k._recognizeCircle(p);if(s.returnCode===0){D=s;D.center=k._buildVector3(D.aCenter).applyMatrix4(B);D.normal=k._buildVector3(D.aNormal).transformDirection(B)}else{D=k._recognizeLine(p);if(D.returnCode===0){D.point1=k._buildVector3(D.aPoint1).applyMatrix4(B);D.point2=k._buildVector3(D.aPoint2).applyMatrix4(B)}}}else{if(z===4){var s=k._recognizePlane(p);if(s.returnCode===0){D=s;D.origin=k._buildVector3(D.aOrigin).applyMatrix4(B);D.normal=k._buildVector3(D.aNormal).transformDirection(B)}else{var o=m.extractMeshNormals(w);D=k._recognizeCylinder(p,o);if(D.returnCode===0){D.point1=k._buildVector3(D.aPoint1).applyMatrix4(B);D.point2=k._buildVector3(D.aPoint2).applyMatrix4(B)}else{D=k._recognizeSphere(p,o);if(D.returnCode===0){D.center=k._buildVector3(D.aCenter).applyMatrix4(B)}else{D=k._recognizeCone(p,o);if(D.returnCode===0){D.apex=k._buildVector3(D.aApex).applyMatrix4(B);D.axis=k._buildVector3(D.aAxis).applyMatrix4(B);D.point1=k._buildVector3(D.aPoint1).applyMatrix4(B);D.point2=k._buildVector3(D.aPoint2).applyMatrix4(B)}}}}}}}}}if(D.returnCode===1){w._bNotRecognized=true}}D.exact=false}return D},recognizeNonCanonicGeometry:function(s,r,q){var n={};n.returnCode=1;if(m.verifyMesh(s)){var o=m.extractMeshVertices(s,r.elements);var p=s.group.glType;if(p===1){var t=k._recognizeCircle(o,q);if(t.returnCode===0&&q){n=t;n.center=k._buildVector3(n.aCenter).applyMatrix4(r);n.normal=k._buildVector3(n.aNormal).transformDirection(r)}else{n=k._recognizeCurve(o,q);if((n.returnCode===0)&&q){n.point1=k._buildVector3(n.aPoint1);n.point2=k._buildVector3(n.aPoint2)}}}else{if(p===4){n=k._recognizeSurface(o,q);if((n.returnCode===0)&&q){n.cog=k._buildVector3(n.aCog)}}}}return n},_recognizeLine:function(p){var z={};z.returnCode=1;var w=p.length;if(w===2){z.returnCode=0;z.type=i.GeometryType.LINE;z.aPoint1=p[0];z.aPoint2=p[1]}else{if(w>2){var u=a.sub(p[1],p[0]);var t;var o=true;for(var s=1;o&&(s<w);s++){t=a.sub(p[s],p[0]);o=f.isZero(a.length(a.cross(u,t)))}if(o){var y=0;var q=1;var v=0;var n=a.dot(u,u);for(var r=2;r<w;r++){t=a.sub(p[r],p[0]);var x=a.dot(u,t);if(x<v){y=r;v=x}else{if(x>n){q=r;n=x}}}z.returnCode=0;z.type=i.GeometryType.LINE;z.aPoint1=p[y];z.aPoint2=p[q]}}}return z},_recognizePlane:function(o){var C={};C.returnCode=1;var z=o.length;var w;var u;var x=0;var v=0;var t=0;for(var r=x+1;r<z&&0===t;r++){if(0===v){w=a.sub(o[x],o[r]);if(a.length(w)>l){v=r}}else{if(0===t){u=a.sub(o[x],o[r]);if(a.length(u)>l){var q=a.angle(w,u);if((q>d)&&(q<Math.PI-d)){t=r}}}}}if((0!==v)&&(0!==t)){var y=a.cross(w,u);var B=true;for(var p=0;B&&(p<z);p++){if((p!==x)&&(p!==v)&&(p!==t)){var s=a.sub(o[x],o[p]);var A=a.cross(w,s);if(!f.isZero(a.length(A))){var n=a.angle(y,A);B=!((n>d)&&(n<Math.PI-d))}}}if(B){C.returnCode=0;C.type=i.GeometryType.PLANE;C.aOrigin=o[x];C.aNormal=a.normalize(y)}}return C},_recognizeCircle:function(y){var x={};x.returnCode=1;var H=y.length;if(H>6){var p=k._recognizePlane(y);if(p&&(p.type===i.GeometryType.PLANE)){var C=p.aNormal;var n=0;var B=Math.floor(2*H/3);var w=Math.floor(H/3);var F=k._computeCircleThru3Points(y[n],y[w],y[B]);if(F.returnCode===0){var z=F.radius;var A=F.aCenter;var o=true;for(var E=0;o&&(E<H);E++){var G=a.length(a.sub(y[E],A));o=f.areEqual(z,G,"float",0.0017)}if(o){x.returnCode=0;x.type=i.GeometryType.CIRCLE;x.radius=F.radius;x.aCenter=F.aCenter;x.aNormal=C;x.length=2*Math.PI*F.radius;var u=a.sub(y[0],F.aCenter);var v=Math.ceil(H/2);var s=a.sub(y[v-1],F.aCenter);var q=a.sub(y[H-1],F.aCenter);var t=a.angle(u,s);var r=a.angle(s,q);var D=t+r;x.arcLength=x.length*(D/(Math.PI*2))}}}}return x},_recognizeCylinder:function(O,Q,H){var K={};K.returnCode=1;var u=((H)&&(H<=O.length))?H:O.length;var D=true;if(u>e){var B=k._recognizeCylinder(O,Q,e);D=(B!==undefined)&&(B.type!==undefined)&&(B.type===i.GeometryType.CYLINDER)}if(D){var o;var N;var x;var t=false;if(u>7){for(var Y=0;Y<u;Y++){for(var X=Y+1;X<u;X++){N=a.cross(Q[Y],Q[X]);if(!t){if(a.length(N)>l){t=true;x=N;o=N}}else{var z=a.dot(x,N);o=a.add(o,a.multiply(N,z))}}}}if(o){var p=0.7;x=a.normalize(o);o=[0,0,0];var F=0;var E=[];for(var W=0;W<u;W++){N=a.cross(Q[W],x);if(a.length(N)/a.length(Q[W])>p){F++;E[W]=1}else{E[W]=0}}var y=true;if(F>1){for(var V=0;(V<u)&&(E[V]===1);V++){for(var U=V+1;(U<u)&&(E[U]===1);U++){N=a.cross(Q[V],Q[U]);if(!t){if(a.length(N)>l){t=true;x=N;o=N}}else{var P=a.dot(x,N);o=a.add(o,a.multiply(N,P))}}}o=a.normalize(o);for(var T=0;(T<u)&&(E[T]===1)&&y;T++){N=a.cross(Q[T],o);if(1-a.length(N)/a.length(Q[T])>d){y=false}}}else{y=false}if(l>=a.length(o)){y=false}if(y){var v=0;var A=[];var ac=0;var L=0;var M=0;var Z=0;var ab;for(var S=0;S<u;S++){ab=a.dot(a.sub(O[0],O[S]),o);var w=a.sub(a.multiply(o,ab),O[S]);var G=false;for(var R=0;(R<v)&&!G;R++){var I=a.subAndLength(A[R],w);G=(I<l)}if(!G){A[v]=w;v++}if(ab>M){M=ab;Z=S}if(ab<ac){ac=ab;L=S}}var J=k._recognizeCircle(A);if(J&&(J.type===i.GeometryType.CIRCLE)){ab=a.dot(a.sub(J.aCenter,O[L]),o);var aa=a.add(a.multiply(o,ab),J.aCenter);ab=a.dot(a.sub(J.aCenter,O[Z]),o);var C=a.add(a.multiply(o,ab),J.aCenter);K.returnCode=0;K.type=i.GeometryType.CYLINDER;K.radius=J.radius;K.aPoint1=aa;K.aPoint2=C}}}}return K},_recognizeCone:function(w,z,o,n){var v={};v.returnCode=1;var N=((o)&&(o<=w.length))?o:w.length;var x=((n)&&(n<=z.length))?n:z.length;var E=true;if(N>e){var H=k._recognizeCone(w,z,e,e);E=(H!==undefined)&&(H.type!==undefined)&&(H.type===i.GeometryType.CONE)}if(E){if(3<N){var B=[];for(var F=1;F<N;F++){if(!a.areEqual(w[0],w[F])){B.push(w[F])}}var q=k._recognizeCircle(B);if(q&&(q.type===i.GeometryType.CIRCLE)){var G=a.sub(q.aCenter,w[0]);if(a.areEqual(a.normalize(G),q.aNormal)){v.returnCode=0;v.type=i.GeometryType.CONE;v.aApex=w[0];v.aPoint1=w[0];v.aPoint2=q.aCenter;v.aAxis=q.aNormal;v.semiAngle=a.angle(a.sub(w[1],w[0]),G)}}}if((v.returnCode!==0)&&(N===x)){var C=false;var P=-1;var u=-1;var O=-1;var t=-1;for(var F=0;(F<x)&&!C;F++){for(var D=F+1;(D<x)&&!C;D++){if(a.areEqual(z[F],z[D])&&!a.areEqual(w[F],w[D])){if(0>P){P=F;O=D}else{if(!a.areEqual(z[P],z[F])){u=F;t=D;C=true}}}}}if((0<=P)&&(0<=O)&&(0<=u)&&(0<=t)){var s=a.sub(w[P],w[O]);var M=a.cross(s,z[P]);var r=a.sub(w[u],w[t]);var L=a.cross(r,z[u]);var p=false;var y=a.angle(M,L);if((y>d)&&(y<Math.PI-d)){var K=c.computeLinePlaneDistance(w[P],s,w[u],L);if((K.returnCode===0)&&(K.relationship===i.Relationship.INTERSECTING)){var J=c.computeLinePlaneDistance(w[P],z[P],w[u],L);if((J.returnCode===0)&&(J.relationship===i.Relationship.INTERSECTING)){p=true;v.aApex=K.aPosition;v.aAxis=a.normalize(a.sub(K.aPosition,J.aPosition))}}}else{var K=c.computeTwoLinesDistance(w[P],s,w[u],r);if((K.returnCode===0)&&(K.relationship===i.Relationship.INTERSECTING)){var J=c.computeTwoLinesDistance(w[P],z[P],w[u],z[u]);if((J.returnCode===0)&&(J.relationship===i.Relationship.INTERSECTING)){p=true;v.aApex=K.aPosition1;v.aAxis=a.normalize(a.sub(K.aPosition1,J.aPosition1))}}}if(p){v.semiAngle=a.angle(s,v.aAxis);var G;for(var A=0;(A<N)&&p;A++){G=a.sub(v.aApex,w[A]);y=a.angle(G,v.aAxis);p=f.areEqual(v.semiAngle,y)}if(p){v.returnCode=0;v.type=i.GeometryType.CONE;var I=k._computeMinMaxProjection(w,v.aAxis,v.aApex);v.aPoint1=I.aPoint1;v.aPoint2=I.aPoint2}}}}}return v},_recognizeSphere:function(y,B){var x={};x.returnCode=1;var G=y.length;var z=B.length;if(G===z){var v=0;var u=0;var s=0;var q=0;var t;var r;var p;var n;var C;for(var F=1;(F<G)&&(0===q);F++){if(0===u){t=a.sub(y[v],y[F]);if(a.length(t)>l){u=F}}else{if(0===s){r=a.sub(y[v],y[F]);if(a.length(r)>l){C=a.angle(t,r);if((C>d)&&(C<Math.PI-d)){s=F;n=a.cross(t,r)}}}else{if(0===q){p=a.sub(y[v],y[F]);if(a.length(p)>l){C=a.angle(n,a.cross(t,p));if((C>d)&&(C<Math.PI-d)){q=F}}}}}}if((0!==u)&&(0!==s)&&(0!==q)){var w=k._computeSphereThru4Points(y[v],y[u],y[s],y[q]);if(w.returnCode===0){var o=true;var A;var E;for(var D=0;(D<G)&&o;D++){E=a.sub(y[D],w.aCenter);A=a.length(E);o=f.areEqual(w.radius,A)&&a.areEqual(a.normalize(E),a.normalize(B[D]))}if(o){x.returnCode=0;x.type=i.GeometryType.SPHERE;x.aCenter=w.aCenter;x.radius=w.radius}}}}return x},_recognizeCurve:function(o,t){var n={};n.returnCode=0;n.type=i.GeometryType.CURVE;n.length=0;if(t){var r=o.length;var q=r/2;var s=0;for(var p=0;p<q;p++){s+=a.length(a.sub(o[p],o[p+1]))}n.length=s;n.aPoint1=o[0];n.aPoint2=o[r-1]}return n},_recognizeSurface:function(p,o){var y={};y.returnCode=1;y.type=i.GeometryType.SURFACE;y.area=0;if(o){var w=p.length;var x=w/3;var u=0;var n=[0,0,0];for(var q=0;q<x;q++){var t=a.sub(p[3*q],p[3*q+1]);var r=a.sub(p[3*q],p[3*q+2]);var s=a.length(a.cross(t,r));var v=a.add(p[3*q],a.add(p[3*q+1],p[3*q+2]));u+=s;n=a.multiplyAndAdd(v,s,n)}y.returnCode=0;y.area=u/2;y.aCog=(f.isZero(u))?[0,0,0]:a.multiply(n,1/(3*u))}return y},_computeMinMaxProjection:function(q,o,u){var x={};x.returnCode=0;var v=q.length;var n=a.normalize(o);var t=Number.MAX_VALUE;var w=-Number.MAX_VALUE;var p;var s=[0,0,0];for(var r=0;r<v;r++){p=a.dot(a.sub(u,q[r],s),n);if(p>w){w=p}if(p<t){t=p}}x.aPoint1=a.multiplyAndAdd(n,t,u);x.aPoint2=a.multiplyAndAdd(n,w,u);return x},_computeCircleThru3Points:function(t,s,r){var w={};w.returnCode=1;var n=a.sub(t,s);var u=a.sub(s,r);var p=a.cross(n,u);if(a.areEqual(t,s)){w.aCenter=a.multiply(a.add(t,r),0.5);p=a.cross([0,0,1],u)}else{if(a.areEqual(t,r)){w.aCenter=a.multiply(a.add(t,s),0.5);p=a.cross([0,0,1],n)}else{if(a.areEqual(s,r)){w.aCenter=a.multiply(a.add(t,s),0.5);p=a.cross([0,0,1],n)}else{var v=a.squaredLength(p);if(v>g){var o=(0.5*a.squaredLength(u)+0.5*a.dot(n,u))/v;var q=a.multiplyAndAdd(n,0.5,t);w.aCenter=a.multiplyAndAdd(a.cross(n,p),-o,q)}}}}if(w.aCenter!==undefined){w.returnCode=0;w.type=i.GeometryType.CIRCLE;w.radius=a.subAndLength(w.aCenter,t);w.aNormal=a.normalize(p)}return w},_computeSphereThru4Points:function(t,s,r,q){var o={};o.returnCode=1;var p=k._computeCircleThru3Points(t,s,r);if(p.returnCode===0){var n=k._computeCircleThru3Points(s,r,q);if(n.returnCode===0){var u=c.computeTwoLinesDistance(p.aCenter,p.aNormal,n.aCenter,n.aNormal);if((u.returnCode===0)&&(u.relationship===i.Relationship.INTERSECTING)){o.returnCode=0;o.type=i.GeometryType.SPHERE;o.aCenter=u.aPosition1;o.radius=a.subAndLength(o.aCenter,t)}}}return o},_buildVector3:function(n){return new j.Vector3(n[0],n[1],n[2])},verifyMesh:function(n){console.log("DEPRECATED: use DMUMeshServices.verifyMesh");return m.verifyMesh(n)},extractMeshVertices:function(o,n){console.log("DEPRECATED: use DMUMeshServices.extractMeshVertices");return m.extractMeshVertices(o,n)},extractMeshNormals:function(o,n){console.log("DEPRECATED: use DMUMeshServices.extractMeshNormals");return m.extractMeshNormals(o,n)}};return k});define("DS/DMUMeasurable/DMUMathsFiniteGeometry",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUGeometryEnums"],function(f,b,d){var a=0.001;var e=0.000001;var c={computePointSegmentDistance:function(k,h,g,i){var o={};o.returnCode=1;if(k&&h&&g){o.returnCode=2;var n=(i!==undefined)?i:Number.MAX_VALUE;if(n>e){var p=f.sub(k,h);var j=f.sub(h,g);var l=-f.dot(p,j);if(l<=0){o.aPosition=f.clone(h);n=f.squaredLength(p)}else{var m=f.squaredLength(j);if(m<e){o.aPosition=f.clone(h);n=f.squaredLength(p)}else{l=l/m;if(l>=1){o.aPosition=f.clone(g);n=f.subAndSquaredLength(g,k)}else{o.aPosition=f.multiplyAndAdd(j,l,h);n=f.subAndSquaredLength(o.aPosition,k)}}}if((i===undefined)||(i>n)){o.returnCode=0;o.squaredDistance=n;o.distance=Math.sqrt(n);o.relationship=(n<e)?d.Relationship.COINCIDENT:d.Relationship.NONE}}}return o},computePointTriangleDistance:function(q,i,h,g,y){var u={};u.returnCode=1;if(q&&i&&h&&g){u.returnCode=2;var C=f.sub(i,h);var s=f.squaredLength(C);var B=f.sub(i,g);var o=f.squaredLength(B);var v=f.sub(h,g);var j=f.squaredLength(v);if(s<e){u=c.computePointSegmentDistance(q,i,g)}else{if((o<e)||(j<e)){u=c.computePointSegmentDistance(q,i,h)}else{var k=f.sub(q,i);var r=f.dot(C,B);var m=f.dot(C,k);var l=f.dot(B,k);var w=s*o-r*r;var A=r*l-o*m;var z=r*m-s*l;if((A+z)<=w){if(A<0){if(z<0){if(m<0){z=0;A=(-m>=s)?1:-m/s}else{A=0;z=(l>=0)?0:((-l>=o)?1:z=-l/o)}}else{A=0;z=(l>=0)?0:((-l>=o)?1:-l/o)}}else{if(z<0){z=0;A=(m>=0)?0:((-m>=s)?1:-m/s)}else{w=1/w;A*=w;z*=w}}}else{var t=0;var x=0;var n=0;var p=0;if(A<0){t=r+m;x=o+l;if(x>t){n=x-t;p=s-2*r+o;A=(n>=p)?1:n/p;z=1-A}else{A=0;z=(x<=0)?1:((l>=0)?0:-l/o)}}else{if(z<0){t=r+m;x=o+l;if(x>t){n=x-t;p=s-2*r+o;A=(n>=p)?1:n/p;z=1-A}else{A=0;z=(x<=0)?1:((l>=0)?0:-l/o)}}else{n=o+l-r-m;if(n<=0){A=0}else{p=s-2*r+o;A=(n>=p?1:n/p)}z=1-A}}}u.aPosition=f.multiplyAndAdd(B,z,f.multiplyAndAdd(C,A,i));u.squaredDistance=f.subAndSquaredLength(u.aPosition,q);if((y===undefined)||(u.squaredDistance<y)){u.relationship=(u.squaredDistance<e)?d.Relationship.COINCIDENT:d.Relationship.NONE;u.returnCode=0}}}}return u},computeTwoSegmentsDistance:function(n,l,G,E,D){var y={};y.returnCode=1;if(n&&l&&G&&E){y.returnCode=2;if(f.areEqual(n,l)){y=c.computePointSegmentDistance(n,G,E,D);y.angle=0;y.aPosition1=f.clone(n);y.aPosition2=y.aPosition;return y}if(f.areEqual(G,E)){y=c.computePointSegmentDistance(G,n,l,D);y.angle=0;y.aPosition1=y.aPosition;y.aPosition2=f.clone(G);return y}var H=false;var K=f.sub(n,l);var h=f.sub(G,E);var A=f.cross(K,h);var F=f.squaredLength(A);var C=e*f.squaredLength(K)*f.squaredLength(h);var z=0;var r=0;var x=0;var p=0;var v=0;var u=0;var t=0;var q=0;var o=0;var J=0;if(F>C){x=f.sub(n,G);J=f.dot(x,A);J=J*J;if((D!==undefined)&&(J>(D*F))){return y}var k=f.cross(A,x);u=f.dot(k,K);t=f.dot(k,h);var s=false;if(u<=0){v=f.clone(G)}else{if(u>=F){v=f.clone(E)}else{s=1}}var m=false;if(t<=0){p=f.clone(n)}else{if(t>=F){p=f.clone(l)}else{m=1}}if(!s&&!m){r=f.sub(v,n);t=-f.dot(r,K);q=f.squaredLength(K);var B;if(t<=0){B=f.clone(n)}else{if(t>=q){B=f.clone(l)}else{t=t/q;B=f.multiplyAndAdd(K,t,n)}}var g=f.subAndSquaredLength(v,B);z=f.sub(G,p);u=f.dot(z,h);o=f.squaredLength(h);var i;if(u<=0){i=f.clone(G)}else{if(u>=o){i=f.clone(E)}else{u=u/o;i=f.multiplyAndAdd(h,u,G)}}var I=f.subAndSquaredLength(p,i);if(g<=I){if((D!==undefined)&&(g>D)){return y}J=g;p=B}else{if((D!==undefined)&&(I>D)){return y}J=I;v=i}}else{q=0;if(s&&m){var j=1/F;u=u*j;t=t*j;v=f.multiplyAndAdd(h,u,G);p=f.multiplyAndAdd(K,t,n);J=J*j}else{if(s){z=f.sub(G,p);q=f.squaredLength(h);A=f.cross(h,z);J=f.squaredLength(A);if((D!==undefined)&&(J>(D*q))){return y}o=f.dot(h,z);if(o<=0){v=f.clone(G);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{if(o>=q){v=f.clone(E);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{q=1/q;J=J*q;o=o*q;v=f.multiplyAndAdd(h,o,G)}}}else{r=f.sub(v,n);q=f.squaredLength(K);A=f.cross(K,r);J=f.squaredLength(A);if((D!==undefined)&&(J>(D*q))){return y}o=f.dot(K,r);o=-o;if(o<=0){p=f.clone(n);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{if(o>=q){p=f.clone(l);J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>(D*q))){return y}}else{q=1/q;J=J*q;o=o*q;p=f.multiplyAndAdd(K,o,n)}}}}}}else{H=true;q=f.squaredLength(h);x=f.sub(G,n);u=f.dot(x,h);var w=f.sub(G,l);t=f.dot(w,h);if((q<e)||(Math.abs(u-t)<e)){return y}if(u>q){if(t>q){v=f.clone(E);if(t>=u){p=f.clone(n)}else{p=f.clone(l)}}else{if(t>=0){p=f.clone(l);t=t/q;v=f.multiplyAndAdd(h,t,G)}else{v=f.clone(G);t=u/(u-t);p=f.multiplyAndAdd(K,t,n)}}}else{if(u<0){if(t<0){v=f.clone(G);if(t<u){p=f.clone(n)}else{p=f.clone(l)}}else{if(t<=q){p=f.clone(l);t=t/q;v=f.multiplyAndAdd(h,t,G)}else{v=f.clone(G);t=u/(u-t);p=f.multiplyAndAdd(K,t,n)}}}else{p=f.clone(n);u=u/q;v=f.multiplyAndAdd(h,u,G)}}J=f.squaredLength(f.sub(v,p));if((D!==undefined)&&(J>D)){return y}}if((D===undefined)||(J<D)){y.squaredDistance=J;y.distance=Math.sqrt(J);if(H){y.relationship=(y.distance<a)?d.Relationship.COINCIDENT:d.Relationship.PARRALLEL;y.angle=0}else{y.relationship=(y.distance<a)?d.Relationship.INTERSECTING:d.Relationship.NONE;y.angle=f.angle(K,h)}y.aPosition1=p;y.aPosition2=v;y.returnCode=0}}return y},computeSegmentTriangleSquaredDistance:function(C,B,o,n,l,z){var s={};s.returnCode=1;if(C&&B&&o&&n&&l){s.returnCode=2;var D=(z!==undefined)?z:Number.MAX_VALUE;if(D>e){var k;var h;var r=false;var F=f.sub(o,n);var E=f.sub(o,l);var t=f.cross(F,E);if(!f.normalize(t)){t=f.multiply(t,1000)}var v=f.sub(o,C);var u=f.sub(o,B);var p=f.dot(t,v);var m=f.dot(t,u);if(((p>0)&&(m<0))||((p<0)&&(m>0))){var g=f.sub(C,B);var A=b.computeLinePlaneDistance(C,g,o,t);if((A.returnCode===0)&&(A.aPosition)){A=c.computePointTriangleDistance(A.aPosition,o,n,l,D);if((A.returnCode!==2)&&(A.relationship===d.Relationship.COINCIDENT)){D=A.squaredDistance;k=f.clone(A.aPosition);h=f.clone(A.aPosition);r=true}}}if(!r){var q=[C,B];var w=[o,n,l,o];var A;for(var y=0;(y<3)&&(D>e);y++){A=c.computeTwoSegmentsDistance(C,B,w[y],w[y+1],D);if(A.returnCode!==2){D=A.squaredDistance;k=f.clone(A.aPosition1);h=f.clone(A.aPosition2);r=true}}for(var x=0;(x<2)&&(D>e);x++){A=c.computePointTriangleDistance(q[x],o,n,l,D);if(A.returnCode!==2){D=A.squaredDistance;k=f.clone(q[x]);h=f.clone(A.aPosition);r=true}}}if(r){s.returnCode=0;s.squaredDistance=D;s.aPosition1=k;s.aPosition2=h;s.angle=0;s.relationship=(s.squaredDistance<e)?d.Relationship.INTERSECTING:d.Relationship.NONE}}}return s},computeTwoTrianglesSquaredDistance:function(k,h,g,u,t,s,o){var y={};y.returnCode=1;if(k&&h&&u&&t&&s){y.returnCode=2;var x=(o!==undefined)?o:Number.MAX_VALUE;if(x>e){var l=[k,h,g,k];var w=[u,t,s,u];var n;var m;var v=false;var q;for(var r=0;(r<3)&&(x>e);r++){q=c.computeSegmentTriangleSquaredDistance(l[r],l[r+1],u,t,s,x);if(q.returnCode!==2){x=q.squaredDistance;n=f.clone(q.aPosition1);m=f.clone(q.aPosition2);v=true}}for(var p=0;(p<3)&&(x>e);p++){q=c.computeSegmentTriangleSquaredDistance(w[p],w[p+1],k,h,g,x);if(q.returnCode!==2){x=q.squaredDistance;n=f.clone(q.aPosition2);m=f.clone(q.aPosition1);v=true}}if(v){y.returnCode=0;y.squaredDistance=x;y.aPosition1=n;y.aPosition2=m;y.angle=0;y.relationship=d.Relationship.NONE}}}return y}};return c});define("DS/DMUMeasurable/DMUMeshMeasure",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsFiniteGeometry","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMeshServices"],function(f,a,d,c){var e=0.000001;var b={computePointMeshSquaredDistance:function(n,h,o,g){var i={};i.returnCode=1;var j=h&&h.group&&h.group.geometry&&(h.start!==undefined)&&(h.count!==undefined)&&(h.count>0);if(j){var l=h.count;var p=h.group.glType;var m=c.extractMeshVertices(h,o.elements);var k=(p===1)?l/2:l/3;if(p===1){i=b._computePointCurveSquaredDistance(n,k,m,g)}else{if(p===4){i=b._computePointSurfaceSquaredDistance(n,k,m,g)}}}return i},_computePointMeshSquaredMaxDistance:function(p,h,t,r){var j={};j.returnCode=1;var k=h&&h.group&&h.group.geometry&&(h.start!==undefined)&&(h.count!==undefined)&&(h.count>0);if(k){j.returnCode=2;var o=c.extractMeshVertices(h,t.elements,undefined,true);var u=o.length;var q=(r)?r:0;var g;var s=[0,0,0];var n=d.computeAABBForPoint(p);var l=d.computeAABBForPoints(o);var v=d.computeAABBSquaredMaxDistance(n,l);if(v>q){for(var m=0;m<u;m++){v=f.subAndSquaredLength(p,o[m],s);if(v>q){q=v;g=f.clone(o[m]);j.returnCode=0}}if(j.returnCode===0){j.squaredMaxDistance=q;j.aPosition1=p;j.aPosition2=g}}}return j},computeTwoMeshesSquaredDistance:function(p,g,o,v,i){var j={};j.returnCode=1;var w=p&&p.group&&p.group.geometry&&(p.start!==undefined)&&(p.count!==undefined)&&(p.count>0);var u=o&&o.group&&o.group.geometry&&(o.start!==undefined)&&(o.count!==undefined)&&(o.count>0);if(w&&u){var r=p.count;var n=p.group.glType;var t=c.extractMeshVertices(p,g.elements);var k=(n===1)?r/2:r/3;var q=o.count;var m=o.group.glType;var s=c.extractMeshVertices(o,v.elements);var h=(m===1)?q/2:q/3;if(n===1){if(m===1){j=b._computeTwoCurvesSquaredDistance(k,t,h,s,i)}else{if(m===4){j=b._computeCurveSurfaceSquaredDistance(k,t,h,s,i)}}}else{if(n===4){if(m===1){j=b._computeCurveSurfaceSquaredDistance(h,s,k,t,i);var l=j.aPosition1;j.aPosition1=j.aPosition2;j.aPosition2=l}else{if(m===4){j=b._computeSurfaceSurfaceSquaredDistance(k,t,h,s,i)}}}}}return j},_computeTwoMeshesSquaredMaxDistance:function(B,t,A,r,z){var m={};m.returnCode=1;var w=B&&B.group&&B.group.geometry&&(B.start!==undefined)&&(B.count!==undefined)&&(B.count>0);var v=A&&A.group&&A.group.geometry&&(A.start!==undefined)&&(A.count!==undefined)&&(A.count>0);if(w&&v){m.returnCode=2;var g=c.extractMeshVertices(B,t.elements);var y=g.length;var C=c.extractMeshVertices(A,r.elements);var x=C.length;var q=(z)?z:0;var k;var h;var n=[0,0,0];var p=d.computeAABBForPoints(g);var o=d.computeAABBForPoints(C);var l=d.computeAABBSquaredMaxDistance(p,o);if(l>q){for(var u=0;u<y;u++){for(var s=0;s<x;s++){l=f.subAndSquaredLength(g[u],C[s],n);if(l>q){q=l;k=f.clone(g[u]);h=f.clone(C[s]);m.returnCode=0}}}if(m.returnCode===0){m.squaredMaxDistance=q;m.aPosition1=k;m.aPosition2=h}}}return m},_computePointCurveSquaredDistance:function(m,q,o,g){var s={};s.returnCode=1;if((q!==undefined)&&o){s.returnCode=2;var r=(g)?g:Number.MAX_VALUE;var h;var p=d.computeAABBForPoint(m);for(var n=0;(n<q)&&(r>e);n++){var l=d.computeAABBForSegment(o[2*n],o[2*n+1]);var k=d.computeAABBSquaredDistance(p,l);if(k<r){var j=a.computePointSegmentDistance(m,o[2*n],o[2*n+1],r);if(j.returnCode!==2){s.returnCode=0;r=j.squaredDistance;h=f.clone(j.aPosition)}}}if(s.returnCode===0){s.squaredDistance=r;s.aPosition1=m;s.aPosition2=h}}return s},_computePointSurfaceSquaredDistance:function(m,q,o,g){var s={};s.returnCode=1;if((q!==undefined)&&o){s.returnCode=2;var r=(g)?g:Number.MAX_VALUE;var h;var p=d.computeAABBForPoint(m);for(var n=0;(n<q)&&(r>e);n++){var l=d.computeAABBForTriangle(o[3*n],o[3*n+1],o[3*n+2]);var k=d.computeAABBSquaredDistance(p,l);if(k<r){var j=a.computePointTriangleDistance(m,o[3*n],o[3*n+1],o[3*n+2],r);if(j.returnCode!==2){s.returnCode=0;r=j.squaredDistance;h=f.clone(j.aPosition)}}}if(s.returnCode===0){s.squaredDistance=r;s.aPosition1=m;s.aPosition2=h}}return s},_computeTwoCurvesSquaredDistance:function(l,u,h,t,g){var w={};w.returnCode=1;if((l!==undefined)&&u&&(h!==undefined)&&t){w.returnCode=2;var v=(g)?g:Number.MAX_VALUE;var m;var k;for(var s=0;(s<l)&&(v>e);s++){var r=d.computeAABBForSegment(u[2*s],u[2*s+1]);for(var q=0;(q<h)&&(v>e);q++){var p=d.computeAABBForSegment(t[2*q],t[2*q+1]);var o=d.computeAABBSquaredDistance(r,p);if(o<v){var n=a.computeTwoSegmentsDistance(u[2*s],u[2*s+1],t[2*q],t[2*q+1],v);if(n.returnCode!==2){w.returnCode=0;v=n.squaredDistance;m=f.clone(n.aPosition1);k=f.clone(n.aPosition2)}}}}if(w.returnCode===0){w.squaredDistance=v;w.aPosition1=m;w.aPosition2=k}}return w},_computeCurveSurfaceSquaredDistance:function(k,u,s,t,g){var w={};w.returnCode=1;if((k!==undefined)&&u&&(s!==undefined)&&t){w.returnCode=2;var v=(g)?g:Number.MAX_VALUE;var l;var h;for(var r=0;(r<k)&&(v>e);r++){var q=d.computeAABBForSegment(u[2*r],u[2*r+1]);for(var p=0;(p<s)&&(v>e);p++){var o=d.computeAABBForTriangle(t[3*p],t[3*p+1],t[3*p+2]);var n=d.computeAABBSquaredDistance(q,o);if(n<v){var m=a.computeSegmentTriangleSquaredDistance(u[2*r],u[2*r+1],t[3*p],t[3*p+1],t[3*p+2],v);if(m.returnCode!==2){w.returnCode=0;v=m.squaredDistance;l=f.clone(m.aPosition1);h=f.clone(m.aPosition2)}}}}if(w.returnCode===0){w.squaredDistance=v;w.aPosition1=l;w.aPosition2=h}}return w},_computeSurfaceSurfaceSquaredDistance:function(p,g,o,A,u){var q={};q.returnCode=1;if((p!==undefined)&&g&&(o!==undefined)&&A){q.returnCode=2;var z=(u)?u:Number.MAX_VALUE;var r=[];var n;var m;var y;var x;if(p>o){n=p;m=o;y=g;x=A}else{n=o;m=p;y=A;x=g}var k;var h;for(var v=0;(v<n)&&(z>e);v++){var s=d.computeAABBForTriangle(y[3*v],y[3*v+1],y[3*v+2]);for(var t=0;(t<m)&&(z>e);t++){if(r[t]===undefined){r[t]=d.computeAABBForTriangle(x[3*t],x[3*t+1],x[3*t+2])}var l=d.computeAABBSquaredDistance(s,r[t]);if(l<z){var w=a.computeTwoTrianglesSquaredDistance(y[3*v],y[3*v+1],y[3*v+2],x[3*t],x[3*t+1],x[3*t+2],z);if(w.returnCode!==2){q.returnCode=0;z=w.squaredDistance;k=f.clone(w.aPosition1);h=f.clone(w.aPosition2)}}}}if(q.returnCode===0){q.squaredDistance=z;if(p>o){q.aPosition1=k;q.aPosition2=h}else{q.aPosition1=h;q.aPosition2=k}}}return q},_computePointCurveSquaredMaxDistance:function(k,q,m,p){var s={};s.returnCode=1;if((q!==undefined)&&m){s.returnCode=2;var o=(p)?p:Number.MAX_VALUE;var g;var n=d.computeAABBForPoint(k);for(var l=0;(l<q)&&(o>e);l++){var j=d.computeAABBForSegment(m[2*l],m[2*l+1]);var r=d.computeAABBSquaredMaxDistance(n,j);if(r<o){var h=a.computePointSegmentDistance(k,m[2*l],m[2*l+1],o);if(h.returnCode!==2){s.returnCode=0;o=h.squaredMaxDistance;g=f.clone(h.aPosition)}}}if(s.returnCode===0){s.squaredMaxDistance=o;s.aPosition1=k;s.aPosition2=g}}return s}};return b});define("DS/DMUMeasurable/DMUToolsMeasure",["DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeshServices","DS/DMUMeasurable/DMUMeshMeasure","DS/DMUMeasurable/DMUToolsMaths","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/Visualization/SubElement","DS/DMUMeasurable/DMUMeshRecognition"],function(f,k,l,c,m,p,g,h,e,j,d,b,o){var i=0.000001;var n=function(r){var q=m.getLastReference(r);if(q&&q.getLastElement(true)){return q}else{q=m.getLastRepReference(r);if(q&&q.getLastElement(true)){return q}else{return r.clone()}}};var a={measureItem:function(z,C,s,w){var r={};var u;if(w&&w===true){u=new Date().getTime()}var A=z.getPathElement();var x;var q=z.getLevel();if(q){r.product=A.getElement(q-1);x=m.truncatePathElement(A,q)}else{x=n(A);if(x&&x.getLastElement(true)){r.product=x.getLastElement(true)}}var y=z.getType();if((C!==undefined)&&(C===e.ViewedType.PRODUCT)){r.type=l.GeometryType.PRODUCT;r.position=z.getSelPoint();r.aabb=a.retrieveProductAABB(r.product,x.getWorldMatrix());var t=a.measureProduct(z,w);r.volume=t.volume;r.area=t.area;r.cog=t.cog}else{if(((C!==undefined)&&(C===e.ViewedType.POINT))||(y===l.GeometryType.POINT)||(y===l.GeometryType.PICKINGPT)){r.type=l.GeometryType.POINT;r.position=z.getPoint();if(!r.position){r.position=z.getSelPoint()}}else{if(y===l.GeometryType.LINE){r.type=y;r.length=z.getLength();var B=z.getPoints();r.point1=B.beginPoint;r.point2=B.endPoint;r.position=r.point1.clone().add(r.point2).multiplyScalar(0.5)}else{if(y===l.GeometryType.CIRCLE){r.type=y;r.length=z.getLength();r.position=z.getSelPoint();r.radius=z.getRadius();r.center=z.getCenter();r.normal=z.getAxis();r.arcLength=z.getArcLength()}else{if(y===l.GeometryType.CYLINDER){r.type=y;r.area=z.getArea();r.cog=z.getCoG();r.position=z.getSelPoint();r.radius=z.getRadius();var B=z.getPoints();r.point1=B.beginPoint;r.point2=B.endPoint}else{if(y===l.GeometryType.CONE){r.type=y;r.area=z.getArea();r.cog=z.getCoG();r.position=z.getSelPoint();r.apex=z.getApex();r.semiAngle=z.getSemiAngle();r.axis=z.getAxis();var B=z.getPoints();r.point1=B.beginPoint;r.point2=B.endPoint}else{if(y===l.GeometryType.SPHERE){r.type=y;r.area=z.getArea();r.cog=z.getCoG();r.position=z.getSelPoint();r.radius=z.getRadius();r.center=z.getCenter()}else{if(y===l.GeometryType.PLANE){r.type=y;r.area=z.getArea();r.cog=z.getCoG();r.position=z.getSelPoint();var v=z.getPlane();r.origin=v.origin;r.normal=v.normal}else{if(y===l.GeometryType.CURVE){r.type=y;r.length=z.getLength();r.position=z.getSelPoint()}else{if(y===l.GeometryType.SURFACE){r.type=y;r.area=z.getArea();r.cog=z.getCoG();r.position=z.getSelPoint()}}}}}}}}}}if(w&&w===true){console.log("PCS measureItem="+(new Date().getTime()-u))}return r},measureProduct:function(M){var u={};var L=M.getPathElement();var t;var s=M.getLevel();if(s){t=m.truncatePathElement(L,s)}else{t=n(L)}var F=m.getRenderables(t);var r=0;var O=0;var q=[0,0,0];var w=[0,0,0];var G=F.length;for(var K=0;K<G;K++){var x=F[K].matrix.elements;var C=F[K].geometry;var E=C.length;for(var J=0;J<E;J++){var N=C[J].drawingGroups;var v=N.length;for(var I=0;I<v;I++){if((N[I].geomType==="FACE")){var y=N[I].primitives.length;for(var H=0;H<y;H++){var z=b.getFromSGNode(N[I].primitives[H]);var B=o.recognizeNonCanonicGeometry(N[I].primitives[H],new j.Matrix4(),true);O+=B.area;if(z.getBodyDimension()===3){var A=p._computeVolume(N[I].primitives[H],w);r+=A.volume;var D=c.transformPoint(A.aCog,x);q=c.multiplyAndAdd(D,A.volume,q)}}}}}}u.volume=(r>0)?r:0;q=(h.isZero(r))?[0,0,0]:c.multiply(q,1/r);u.cog=new j.Vector3(q[0],q[1],q[2]);u.area=(O>0)?O:0;return u},measureBetween:function(u,A,t,y,v){var r={};if(((A===e.ViewedType.POINT)||(A===e.ViewedType.AXIS)||(A===e.ViewedType.CENTER)||(A===e.ViewedType.INFPLANE))&&((y===e.ViewedType.POINT)||(y===e.ViewedType.AXIS)||(y===e.ViewedType.CENTER)||(y===e.ViewedType.INFPLANE))){r=a.measureBetweenInfinite(u,A,t,y)}else{if((A===e.ViewedType.PRODUCT)||(y===e.ViewedType.PRODUCT)){var C=Number.MAX_VALUE;if(u.getSelPoint()&&t.getSelPoint()){var D=f.computeTwoPointsDistance(u.getSelPoint().toArray(),t.getSelPoint().toArray());C=D.distance*D.distance}if((A===e.ViewedType.PRODUCT)&&(y===e.ViewedType.PRODUCT)){r=a.measureBetweenWithProducts(a.MeasuredType.PRODUCT,u,t,C,v);r.type1=A;r.type2=y}else{if((A===e.ViewedType.PRODUCT)&&((y===l.GeometryType.POINT)||(y===e.ViewedType.CENTER))){r=a.measureBetweenWithProducts(a.MeasuredType.POINT,t,u,C,v);r.type1=A;r.type2=e.ViewedType.POINT;var B=r.aPosition1;r.aPosition1=r.aPosition2;r.aPosition2=B;var B=r.product1;r.product1=r.product2;r.product2=B}else{if((y===e.ViewedType.PRODUCT)&&((A===l.GeometryType.POINT)||(A===e.ViewedType.CENTER))){r=a.measureBetweenWithProducts(a.MeasuredType.POINT,u,t,C,v);r.type1=e.ViewedType.POINT;r.type2=y}else{if(A===e.ViewedType.PRODUCT){r=a.measureBetweenWithProducts(a.MeasuredType.MESH,t,u,C,v);r.type1=a.MeasuredType.MESH;r.type2=a.MeasuredType.MESH;var B=r.aPosition1;r.aPosition1=r.aPosition2;r.aPosition2=B;var B=r.product1;r.product1=r.product2;r.product2=B}else{r=a.measureBetweenWithProducts(a.MeasuredType.MESH,u,t,C,v);r.type1=a.MeasuredType.MESH;r.type2=a.MeasuredType.MESH}}}}r.distance=Math.sqrt(r.squaredDistance)}else{if(((A===e.ViewedType.POINT)||(A===e.ViewedType.CENTER))&&((y===e.ViewedType.CURVE)||(y===e.ViewedType.SURFACE)||(y===e.ViewedType.CIRCLE)||(y===e.ViewedType.CYCOSP))){var q=(A===e.ViewedType.CENTER)?u.getCenter().toArray():u.getSelPoint().toArray();r=g.computePointMeshSquaredDistance(q,t.getPrimitive(),t.getReferentialPosition());r.type1=e.ViewedType.POINT;r.type2=a.MeasuredType.MESH}else{if(((y===e.ViewedType.POINT)||(y===e.ViewedType.CENTER))&&((A===e.ViewedType.CURVE)||(A===e.ViewedType.SURFACE)||(A===e.ViewedType.CIRCLE)||(A===e.ViewedType.CYCOSP))){var q=(y===e.ViewedType.CENTER)?t.getCenter().toArray():t.getSelPoint().toArray();r=g.computePointMeshSquaredDistance(q,u.getPrimitive(),u.getReferentialPosition());r.type1=a.MeasuredType.MESH;r.type2=e.ViewedType.POINT;var s=r.aPosition1;r.aPosition1=r.aPosition2;r.aPosition2=s}else{r=g.computeTwoMeshesSquaredDistance(u.getPrimitive(),u.getReferentialPosition(),t.getPrimitive(),t.getReferentialPosition());r.type1=a.MeasuredType.MESH;r.type2=a.MeasuredType.MESH}}r.distance=Math.sqrt(r.squaredDistance)}}if(r.type1===a.MeasuredType.MESH){var w=u.getType();if((w===l.GeometryType.CURVE)||(w===l.GeometryType.LINE)||(w===l.GeometryType.CIRCLE)){r.type1=e.ViewedType.CURVE}else{r.type1=e.ViewedType.SURFACE}}if(r.type2===a.MeasuredType.MESH){var w=t.getType();if((w===l.GeometryType.CURVE)||(w===l.GeometryType.LINE)||(w===l.GeometryType.CIRCLE)){r.type2=e.ViewedType.CURVE}else{r.type2=e.ViewedType.SURFACE}}if(r.product1===undefined){var z=u.getPathElement();if(z){r.product1=n(z).getLastElement()}}if(r.product2===undefined){var x=t.getPathElement();if(x){r.product2=n(x).getLastElement()}}if(r.aPosition1){r.position1=new j.Vector3(r.aPosition1[0],r.aPosition1[1],r.aPosition1[2])}if(r.aPosition2){r.position2=new j.Vector3(r.aPosition2[0],r.aPosition2[1],r.aPosition2[2])}if(r.aExtension){r.extensionDirection=new j.Vector3(r.aExtension[0],r.aExtension[1],r.aExtension[2])}return r},measureThreepoints:function(y,v,t){var q={};var w=y.getSelPoint();var u=v.getSelPoint();var r=t.getSelPoint();if(w&&u&&r){var D=w.toArray();var C=u.toArray();var B=r.toArray();var s=c.sub(D,C);var F=c.sub(C,B);q.angle=Math.PI-c.angle(s,F);var z=c.cross(s,F);q.normal=new j.Vector3(z[0],z[1],z[2]);var G;if(c.areEqual(D,C)){G=c.multiply(c.add(D,B),0.5)}else{if(c.areEqual(D,B)){G=c.multiply(c.add(D,C),0.5)}else{if(c.areEqual(C,B)){G=c.multiply(c.add(D,C),0.5)}else{var E=c.squaredLength(z);if(E>i){var x=(0.5*c.squaredLength(F)+0.5*c.dot(s,F))/E;var A=c.multiplyAndAdd(s,0.5,D);var G=c.multiplyAndAdd(c.cross(s,z),-x,A)}}}}if(G!==undefined){q.radius=c.subAndLength(G,D);q.center=new j.Vector3(G[0],G[1],G[2])}}return q},measureBetweenInfinite:function(v,E,u,C){var r={};var B=[v,u];var D=[{_selectedType:E},{_selectedType:C}];for(var x=0;x<2;x++){var A=B[x].getType();D[x].realType=A;if(D[x]._selectedType===e.ViewedType.POINT){D[x].type=l.GeometryType.POINT;D[x].position=B[x].getSelPoint()}else{if((A===l.GeometryType.POINT)||(A===l.GeometryType.PICKINGPT)){D[x].type=l.GeometryType.POINT;D[x].position=B[x].getPoint()}else{if(A===l.GeometryType.LINE){D[x].type=l.GeometryType.LINE;var F=B[x].getPoints();D[x].position=B[x].getSelPoint();D[x].direction=F.endPoint.sub(F.beginPoint)}else{if(A===l.GeometryType.CIRCLE){if(D[x]._selectedType===e.ViewedType.CENTER){D[x].type=l.GeometryType.POINT;D[x].position=B[x].getCenter()}else{D[x].type=l.GeometryType.LINE;D[x].position=B[x].getCenter();D[x].direction=B[x].getAxis()}}else{if(A===l.GeometryType.CYLINDER){D[x].type=l.GeometryType.LINE;var F=B[x].getPoints();D[x].position=F.beginPoint;D[x].direction=F.endPoint.sub(F.beginPoint)}else{if(A===l.GeometryType.CONE){D[x].type=l.GeometryType.LINE;var F=B[x].getPoints();D[x].position=F.beginPoint;D[x].direction=F.endPoint.sub(F.beginPoint)}else{if(A===l.GeometryType.SPHERE){D[x].type=l.GeometryType.POINT;D[x].position=B[x].getCenter()}else{if(A===l.GeometryType.PLANE){D[x].type=l.GeometryType.PLANE;var y=B[x].getPlane();D[x].origin=B[x].getSelPoint();D[x].normal=y.normal}}}}}}}}}var t=D[0];var s=D[1];var w=false;if(((D[0].type===l.GeometryType.LINE)&&(D[1].type===l.GeometryType.PLANE))||(D[0].type===l.GeometryType.POINT)||(D[0].type===l.GeometryType.PICKINGPT)){t=D[1];s=D[0];w=true}var G;var q=[];var z=[];if(t.type===l.GeometryType.PLANE){z[0]=e.ViewedType.INFPLANE;if(s.type===l.GeometryType.PLANE){z[1]=e.ViewedType.INFPLANE;G=f.computeTwoPlanesDistance(t.origin.toArray(),t.normal.toArray(),s.origin.toArray(),s.normal.toArray());if(G&&(G.returnCode===0)){r.distance=G.distance;r.angle=(G.angle>Math.PI/2)?Math.PI-G.angle:G.angle;r.relationship=G.relationship;if(G.relationship===l.Relationship.INTERSECTING){q[0]=c.clone(G.aPosition1);q[1]=c.clone(G.aPosition2)}else{q[0]=t.origin.toArray();q[1]=G.aPosition2}}}else{if(s.type===l.GeometryType.LINE){z[1]=e.ViewedType.AXIS;G=f.computeLinePlaneDistance(s.position.toArray(),s.direction.toArray(),t.origin.toArray(),t.normal.toArray());if(G&&(G.returnCode===0)){r.distance=G.distance;r.angle=(G.angle>Math.PI/2)?Math.PI-G.angle:G.angle;r.relationship=G.relationship;if(G.relationship===l.Relationship.INTERSECTING){q[0]=G.aPosition;q[1]=G.aPosition}else{q[0]=G.aPosition;q[1]=s.position.toArray()}r.aExtension=s.direction.toArray()}}else{z[1]=e.ViewedType.POINT;G=f.computePointPlaneDistance(s.position.toArray(),t.origin.toArray(),t.normal.toArray());if(G&&(G.returnCode===0)){r.distance=G.distance;r.relationship=G.relationship;q[0]=G.aPosition;q[1]=s.position.toArray()}}}}else{if(t.type===l.GeometryType.LINE){z[0]=e.ViewedType.AXIS;if(s.type===l.GeometryType.LINE){z[1]=e.ViewedType.AXIS;G=f.computeTwoLinesDistance(t.position.toArray(),t.direction.toArray(),s.position.toArray(),s.direction.toArray());if(G&&(G.returnCode===0)){r.distance=G.distance;r.angle=(G.angle>Math.PI/2)?Math.PI-G.angle:G.angle;r.relationship=G.relationship;if((G.relationship===l.Relationship.INTERSECTING)||(G.relationship===l.Relationship.NONE)){q[0]=G.aPosition1;q[1]=G.aPosition2;r.aExtension=c.sub(t.position.toArray(),G.aPosition1)}else{q[0]=t.position.toArray();q[1]=G.aPosition2;if((t.realType===l.GeometryType.CIRCLE)||(t.realType===l.GeometryType.CYLINDER)||(t.realType===l.GeometryType.CONE)||(t.realType===l.GeometryType.SPHERE)){r.aExtension=s.direction.toArray()}else{r.aExtension=c.sub(s.position.toArray(),G.aPosition2)}}}}else{z[1]=e.ViewedType.POINT;G=f.computePointLineDistance(s.position.toArray(),t.position.toArray(),t.direction.toArray());if(G&&(G.returnCode===0)){r.distance=G.distance;r.relationship=G.relationship;q[0]=G.aPosition;q[1]=s.position.toArray();r.aExtension=c.sub(t.position.toArray(),G.aPosition)}}}else{z[0]=e.ViewedType.POINT;z[1]=e.ViewedType.POINT;q[0]=t.position.toArray();q[1]=s.position.toArray();G=f.computeTwoPointsDistance(q[0],q[1]);if(G&&(G.returnCode===0)){r.distance=G.distance;r.relationship=G.relationship}}}if(w){r.aPosition1=q[1];r.aPosition2=q[0];r.type1=z[1];r.type2=z[0]}else{r.aPosition1=q[0];r.aPosition2=q[1];r.type1=z[0];r.type2=z[1]}return r},measureBetweenWithProducts:function(L,E,D,S,P){var A={};var C;if(P&&P===true){C=new Date().getTime()}var G=(S)?S:Number.MAX_VALUE;A.squaredDistance=G;var R=(L===a.MeasuredType.PRODUCT);var t;var y=E.getPathElement();var J;var Z=E.getLevel();if(Z){t=y.getElement(Z-1);J=m.truncatePathElement(y,Z)}else{J=n(y);t=J.getLastElement()}var s;var x=D.getPathElement();var q;var W=D.getLevel();if(W){s=x.getElement(W-1);q=m.truncatePathElement(x,W)}else{q=n(x);s=q.getLastElement()}var af=false;if(R){var aa=J.externalPath.length;var Y=q.externalPath.length;var T;var r;var ae;if(aa<Y){T=aa;r=q;ae=J}else{T=Y;r=J;ae=q}af=true;for(var ad=0;af&&(ad<T);ad++){af=(r.externalPath[ad]===ae.externalPath[ad])}}if(af){A.squaredDistance=0;A.aPosition1=E.getSelPoint().toArray();A.aPosition2=A.aPosition1;A.product1=t;A.product2=s}else{if(P&&P===true){if(R){console.log("Measure Products: "+t.name+" / "+s.name)}else{console.log("Measure Products: "+L+" / "+s.name)}}var v=[];var U=[];var O=[];var N=[];v.push(J);U.push(q);var B;if(!R){if(L===a.MeasuredType.MESH){B=a.retrieveMeshPrimitivesAndAABB(E)}else{B=k.computeAABBForPoint(E.getSelPoint().toArray())}}var z;var w=!R;var u;var Q;for(var ad=0;ad<v.length;ad++){if(R){B=a.retrieveProductAABB(v[ad].getLastElement(true),E.getReferentialPosition())}z=a.retrieveProductAABB(U[ad].getLastElement(true),D.getReferentialPosition());Q=k.computeAABBSquaredDistance(B,z);if(Q<G){if(R){w=m.isLeaf(v[ad].getLastElement(true))}u=m.isLeaf(U[ad].getLastElement(true));if(w&&u){if(R){O.push(v[ad])}else{O.push(E)}N.push(U[ad])}else{if(w||(!u&&(v[ad].getLastElement(true).bSphere.radius<U[ad].getLastElement(true).bSphere.radius))){var F=U[ad].getChildrenPathes();var I=F.length;for(var ac=0;ac<I;ac++){if(m.isReferenceOrInstance(F[ac].getLastElement())){if(R){v.push(v[ad])}else{v.push(E)}U.push(F[ac])}}}else{var F=v[ad].getChildrenPathes();var I=F.length;for(var ac=0;ac<I;ac++){if(m.isReferenceOrInstance(F[ac].getLastElement())){v.push(F[ac]);U.push(U[ad])}}}}}}var K=O.length;var M=new Date().getTime()-C;for(var ab=0;ab<K;ab++){var X;if(R){X=O[ab]}else{X=O[ab]}var V=N[ab];var H=a.measureBetweenWithParts(L,X,V,G,P);if(H.squaredDistance<G){G=H.squaredDistance;A=H;A.product1=O[ab];A.product2=N[ab]}}if(Z||!R){A.product1=t}if(W){A.product2=s}if(P&&P===true){console.log("Measure Products: Parts Couples="+K+" Scan duration="+M+" Duration="+(new Date().getTime()-C))}}return A},measureBetweenWithParts:function(v,t,r,s,w){var u;switch(v){case a.MeasuredType.PRODUCT:var y=a.retrievePartPrimitivesAndAABB(t);var q=t.getWorldMatrix();break;case a.MeasuredType.MESH:var y=a.retrieveMeshPrimitivesAndAABB(t);var q=t.getReferentialPosition();break;case a.MeasuredType.POINT:var y={};y.primitives=[];y.primitives[0]=t.getSelPoint().toArray();y.AABB=[];y.AABB[0]=k.computeAABBForPoint(y.primitives[0]);var q=null;break}var x=a.retrievePartPrimitivesAndAABB(r);var z=r.getWorldMatrix();u=a.measureBetweenPrimitivesAABB(v,y,q,x,z,s,w);return u},retrieveProductAABB:function(t,q){var r=[];var s=t.bBox.clone().applyMatrix4(q);r[0]=s.min.x;r[1]=s.min.y;r[2]=s.min.z;r[3]=s.max.x;r[4]=s.max.y;r[5]=s.max.z;return r},retrievePartPrimitivesAndAABB:function(D){var G={};G.primitives=[];var B=m.getRenderables(D);var s=B.length;for(var A=0;A<s;A++){var t=B[A].geometry;var F=t.length;for(var z=0;z<F;z++){var v=t[z].drawingGroups;var q=v.length;for(var y=0;y<q;y++){if(v[y].geomType==="FACE"){var E=v[y].primitives.length;for(var x=0;x<E;x++){G.primitives.push(v[y].primitives[x])}}}}}if(0<G.primitives.length){var u=p.extractMeshVertices(G.primitives[0],undefined,1);if(0<u.length){G.vertice=new j.Vector3(u[0][0],u[0][1],u[0][2])}var r=p.extractMeshNormals(G.primitives[0],undefined,1);if(0<r.length){G.normal=new j.Vector3(r[0][0],r[0][1],r[0][2])}}G.AABB=[];var C=D.getWorldMatrix().elements;var E=G.primitives.length;for(var w=0;w<E;w++){G.AABB[w]=p.computeAABB(G.primitives[w],C)}return G},retrieveMeshPrimitivesAndAABB:function(r){var q={};q.primitives=[];q.primitives.push(r.getPrimitive());q.AABB=[];q.AABB[0]=p.computeAABB(r.getPrimitive(),r.getReferentialPosition().elements);return q},measureBetweenPrimitivesAABB:function(y,r,C,J,A,E,s){var t={};var z=new Date().getTime();var I=(E)?E:Number.MAX_VALUE;t.squaredDistance=I;var u=[];var q=0;var v;var H=r.primitives.length;var G=J.primitives.length;for(var F=0;F<H;F++){for(var D=0;D<G;D++){v=k.computeAABBSquaredDistance(r.AABB[F],J.AABB[D]);if(v<I){u[q]=[F,D,v];q++}}}var B=u.length;var w=0;if(y===a.MeasuredType.POINT){for(var F=0;(F<B)&&(I>i);F++){if(u[F][2]<I){var x=g.computePointMeshSquaredDistance(r.primitives[u[F][0]],J.primitives[u[F][1]],A,I);if(x.squaredDistance<I){I=x.squaredDistance;t=x}w++}}}else{for(var F=0;(F<B)&&(I>i);F++){if(u[F][2]<I){var x=g.computeTwoMeshesSquaredDistance(r.primitives[u[F][0]],C,J.primitives[u[F][1]],A,I);if(x.squaredDistance<I){I=x.squaredDistance;t=x}w++}}}if(s&&s===true){console.log("Measure Parts: Primitives Couples="+H*G+" ("+H+"-"+G+")  Candidates="+u.length+"  MeasuredCandidates="+w+"  duration="+(new Date().getTime()-z))}return t}};a.MeasuredType={POINT:0,MESH:1,PRODUCT:2};return a});define("DS/DMUMeasurable/DMUMeasurable",["UWA/Core","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeshServices","DS/DMUMeasurable/DMUMeshRecognition","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUMeasureEnums","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement"],function(d,f,i,h,a,c,g,b){var e=d.Class.extend({init:function(n,o){if(!o){this._bRealPathElement=false;if(n.pathElement){this._pathElement=n.pathElement.clone();this._bRealPathElement=true}else{this._matrix=(n.position)?n.position.clone():new g.Matrix4()}if(n.selpoint){var k=new g.Matrix4().getInverse(this._getMatrix());this._selPosition=n.selpoint.clone().applyMatrix4(k)}if(n.selnormal){var k=new g.Matrix4().getInverse(this._getMatrix());this._selNormal=n.selnormal.clone().transformDirection(k)}var j;if(n.canonic){j=n.canonic;j.exact=true;j.returnCode=0;this._length=n.canonic.length;this._cog=n.canonic.cog;this._area=n.canonic.area;this._SGPrimitive=n.canonic.primitive}else{if(n.primitive){this._SGPrimitive=n.primitive;if(n.bAvoidRecognition){j={returnCode:1}}else{j=h.recognizeCanonicGeometry(this._SGPrimitive,new g.Matrix4(),true)}}}if(j.returnCode===0){this._type=j.type;switch(j.type){case f.GeometryType.POINT:case f.GeometryType.PICKINGPT:this._selectedType=c.ViewedType.POINT;this._position=j.position;if(!this._selPosition){this._selPosition=j.position.clone()}break;case f.GeometryType.LINE:this._selectedType=c.ViewedType.AXIS;this._point1=j.point1;this._point2=j.point2;if(!this._selPosition){this._selPosition=this._point1.clone()}break;case f.GeometryType.CIRCLE:this._selectedType=c.ViewedType.CIRCLE;this._center=j.center;this._radius=j.radius;this._normal=j.normal;var l=i.extractMeshVertices(this._SGPrimitive);var m=l.length-1;this._point1=new g.Vector3(l[0][0],l[0][1],l[0][2]);this._point2=new g.Vector3(l[m][0],l[m][1],l[m][2]);if(!this._selPosition){this._selPosition=this._center.clone()}break;case f.GeometryType.PLANE:this._selectedType=c.ViewedType.INFPLANE;this._origin=j.origin;this._normal=j.normal;if(!this._selPosition){this._selPosition=this._origin.clone()}break;case f.GeometryType.CYLINDER:this._selectedType=c.ViewedType.CYCOSP;this._radius=j.radius;this._point1=j.point1;this._point2=j.point2;if(!this._selPosition){this._selPosition=this._point1.clone()}break;case f.GeometryType.CONE:this._selectedType=c.ViewedType.CYCOSP;this._apex=j.apex;this._semiAngle=j.semiAngle;this._axis=j.axis;this._point1=j.point1;this._point2=j.point2;if(!this._selPosition){this._selPosition=this._point1.clone()}break;case f.GeometryType.SPHERE:this._selectedType=c.ViewedType.CYCOSP;this._radius=j.radius;this._center=j.center;if(!this._selPosition){this._selPosition=this._center.clone()}break}this._mode=(j.exact)?f.Mode.EXACT:f.Mode.FACETTED}else{switch(this._SGPrimitive.group.glType){case 1:this._type=f.GeometryType.CURVE;this._selectedType=c.ViewedType.CURVE;var l=i.extractMeshVertices(this._SGPrimitive);var m=l.length-1;this._point1=new g.Vector3(l[0][0],l[0][1],l[0][2]);this._point2=new g.Vector3(l[m][0],l[m][1],l[m][2]);if(!this._selPosition){this._selPosition=this._point1.clone()}break;case 4:this._type=f.GeometryType.SURFACE;this._selectedType=c.ViewedType.SURFACE;var l=i.extractMeshVertices(this._SGPrimitive);if(!this._selPosition){this._selPosition=new g.Vector3(l[0][0],l[0][1],l[0][2])}break}this._mode=f.Mode.FACETTED}}return this},clone:function(){var j=new e({},true);j._type=this._type;j._mode=this._mode;if(this._SGPrimitive){j._SGPrimitive=this._SGPrimitive}if(this._pathElement){j._pathElement=this._pathElement.clone()}if(this._bRealPathElement){j._bRealPathElement=this._bRealPathElement}if(this._selPosition){j._selPosition=this._selPosition}if(this._selNormal){j._selNormal=this._selNormal}if(this._position){j._position=this._position}if(this._point1){j._point1=this._point1.clone()}if(this._point2){j._point2=this._point2.clone()}if(this._origin){j._origin=this._origin.clone()}if(this._normal){j._normal=this._normal.clone()}if(this._center){j._center=this._center.clone()}if(this._apex){j._apex=this._apex.clone()}if(this._axis){j._axis=this._axis.clone()}if(this._radius){j._radius=this._radius}if(this._semiAngle){j._semiAngle=this._semiAngle}if(this._length){j._length=this._length}if(this._area){j._area=this._area}if(this._cog){j._cog=this._cog}if(this._selectedType){j._selectedType=this._selectedType}return j},getType:function(){return this._type},getMode:function(){return this._mode},getPrimitive:function(){return this._SGPrimitive},getPathElement:function(){var j=(this._bRealPathElement)?this._pathElement.clone():new b();return j},setLevel:function(j){this._level=j},getLevel:function(){return this._level},setReferentialPosition:function(j){if(!this._bRealPathElement&&j&&j instanceof g.Matrix4){this._matrix=j.clone()}},getReferentialPosition:function(){return this._getMatrix().clone()},getPoint:function(){var j=null;if(this._type===f.GeometryType.POINT){j=this._position.clone().applyMatrix4(this._getMatrix())}return j},getPoints:function(){var j=null;if((this._type===f.GeometryType.LINE)||(this._type===f.GeometryType.CURVE)||(this._type===f.GeometryType.CYLINDER)||(this._type===f.GeometryType.CONE)||(this._type===f.GeometryType.CIRCLE)){j={};j.beginPoint=this._point1.clone().applyMatrix4(this._getMatrix());j.endPoint=this._point2.clone().applyMatrix4(this._getMatrix())}return j},getPlane:function(){var j=null;if(this._type===f.GeometryType.PLANE){j={};j.origin=this._origin.clone().applyMatrix4(this._getMatrix());j.normal=this._normal.clone().transformDirection(this._getMatrix())}return j},getRadius:function(){var j=null;if((this._type===f.GeometryType.CIRCLE)||(this._type===f.GeometryType.CYLINDER)||(this._type===f.GeometryType.SPHERE)){j=this._radius}return j},getCenter:function(){var j=null;if((this._type===f.GeometryType.CIRCLE)||(this._type===f.GeometryType.SPHERE)){j=this._center.clone().applyMatrix4(this._getMatrix())}return j},getAxis:function(){var j=null;if(this._type===f.GeometryType.CIRCLE){j=this._normal.clone().transformDirection(this._getMatrix())}else{if((this._type===f.GeometryType.LINE)||(this._type===f.GeometryType.CYLINDER)||(this._type===f.GeometryType.CONE)){j=this._point2.clone().sub(this._point1).normalize().transformDirection(this._getMatrix())}}return j},getAngle:function(){var j=null;if(this._type===f.GeometryType.CIRCLE){j=Math.PI*2}return j},getSemiAngle:function(){var j=null;if(this._type===f.GeometryType.CONE){j=this._semiAngle}return j},getApex:function(){var j=null;if(this._type===f.GeometryType.CONE){j=this._apex.clone().applyMatrix4(this._getMatrix())}return j},getLength:function(){var j=null;if((this._type===f.GeometryType.LINE)||(this._type===f.GeometryType.CIRCLE)||(this._type===f.GeometryType.CURVE)){if(!this._length){this._complete()}j=this._length}return j},getArcLength:function(){var j=null;if((this._type===f.GeometryType.CIRCLE)){if(!this._arcLength){this._complete()}j=this._arcLength}return j},getCoG:function(){var j=null;if((this._type===f.GeometryType.SURFACE)||(this._type===f.GeometryType.CYLINDER)||(this._type===f.GeometryType.SPHERE)||(this._type===f.GeometryType.CONE)||(this._type===f.GeometryType.PLANE)){if(!this._cog){this._complete()}j=this._cog.clone().applyMatrix4(this._getMatrix())}return j},getArea:function(){var j=null;if((this._type===f.GeometryType.SURFACE)||(this._type===f.GeometryType.CYLINDER)||(this._type===f.GeometryType.SPHERE)||(this._type===f.GeometryType.CONE)||(this._type===f.GeometryType.PLANE)){if(!this._area){this._complete()}j=this._area}return j},getVolume:function(){var j=null;if(!this.volume){var k=a.measureProduct(this);this.volume=k.volume}j=this.volume;return j},getSelPoint:function(){var j;if(this._selPosition!==undefined){j=this._selPosition.clone().applyMatrix4(this._getMatrix())}else{j=this._point1.clone().applyMatrix4(this._getMatrix())}return j},getSelNormal:function(){var j=this._selNormal.clone().transformDirection(this._getMatrix());return j},computeMinimumDistance:function(l){var j={};j.returnCode=1;if(l){var k=a.measureBetween(this,this._selectedType,l,l._selectedType);if(k.position1){j.distance=k.distance;j.relationship=k.relationship;j.position1=k.position1;j.position2=k.position2;j.returnCode=0}}return j},computeAngle:function(l){var j={};j.returnCode=1;if(l){var k=a.measureBetween(this,this._selectedType,l,l._selectedType);if(k.position1){j.angle=k.angle;j.returnCode=0}}return j},exportData:function(j){var k={};k.canonic={};k.canonic.type=j(this._type,"int");k.canonic.mode=j(this._mode,"int");k.canonic.selectedType=j(this._selectedType,"int");k.canonic.matrix=j(this._getMatrix(),"Matrix4");switch(this._type){case f.GeometryType.POINT:case f.GeometryType.PICKINGPT:k.canonic.position=j(this._position,"Vector3");break;case f.GeometryType.LINE:k.canonic.point1=j(this._point1,"Vector3");k.canonic.point2=j(this._point2,"Vector3");if(!this._length){this._complete()}k.canonic.length=j(this._length,"float");break;case f.GeometryType.CIRCLE:k.canonic.center=j(this._center,"Vector3");k.canonic.radius=j(this._radius,"float");k.canonic.normal=j(this._normal,"Vector3");if(!this._length){this._complete()}k.canonic.length=j(this._length,"float");break;case f.GeometryType.PLANE:k.canonic.origin=j(this._origin,"Vector3");k.canonic.normal=j(this._normal,"Vector3");if(!this._cog||!this._area){this._complete()}k.canonic.cog=j(this._cog,"Vector3");k.canonic.area=j(this._area,"float");break;case f.GeometryType.CYLINDER:k.canonic.radius=j(this._radius,"float");k.canonic.point1=j(this._point1,"Vector3");k.canonic.point2=j(this._point2,"Vector3");if(!this._cog||!this._area){this._complete()}k.canonic.cog=j(this._cog,"Vector3");k.canonic.area=j(this._area,"float");break;case f.GeometryType.CONE:k.canonic.apex=j(this._apex,"Vector3");k.canonic.semiAngle=j(this._semiAngle,"float");k.canonic.axis=j(this._axis,"Vector3");k.canonic.point1=j(this._point1,"Vector3");k.canonic.point2=j(this._point2,"Vector3");if(!this._cog||!this._area){this._complete()}k.canonic.cog=j(this._cog,"Vector3");k.canonic.area=j(this._area,"float");break;case f.GeometryType.SPHERE:k.canonic.radius=j(this._radius,"float");k.canonic.center=j(this._center,"Vector3");if(!this._cog||!this._area){this._complete()}k.canonic.cog=j(this._cog,"Vector3");k.canonic.area=j(this._area,"float");break;case f.GeometryType.SURFACE:if(!this._cog||!this._area){this._complete()}k.canonic.cog=j(this._cog,"Vector3");k.canonic.area=j(this._area,"float");break;case f.GeometryType.CURVE:if(!this._length){this._complete()}k.canonic.length=j(this._length,"float");k.canonic.point1=j(this._point1,"Vector3");k.canonic.point2=j(this._point2,"Vector3");break}k.selpoint=j(this._selPosition,"Vector3");if(this._selNormal){k.selnormal=j(this._selNormal,"Vector3")}return k},importData:function(k,j){this._type=j(k.canonic.type,"int");this._mode=j(k.canonic.mode,"int");this._bRealPathElement=false;this._pathElement={};this._matrix=(k.canonic.matrix)?j(k.canonic.matrix,"Matrix4"):new g.Matrix4();if(k.selpoint){this._selPosition=j(k.selpoint,"Vector3")}if(k.selnormal){this._selNormal=j(k.selnormal,"Vector3")}if(k.canonic.position){this._position=j(k.canonic.position,"Vector3")}if(k.canonic.point1){this._point1=j(k.canonic.point1,"Vector3")}if(k.canonic.point2){this._point2=j(k.canonic.point2,"Vector3")}if(k.canonic.origin){this._origin=j(k.canonic.origin,"Vector3")}if(k.canonic.normal){this._normal=j(k.canonic.normal,"Vector3")}if(k.canonic.center){this._center=j(k.canonic.center,"Vector3")}if(k.canonic.apex){this._apex=j(k.canonic.apex,"Vector3")}if(k.canonic.axis){this._axis=j(k.canonic.axis,"Vector3")}if(k.canonic.radius){this._radius=j(k.canonic.radius,"float")}if(k.canonic.semiAngle){this._semiAngle=j(k.canonic.semiAngle,"float")}if(k.canonic.length){this._length=j(k.canonic.length,"float")}if(k.canonic.area){this._area=j(k.canonic.area,"float")}if(k.canonic.cog){this._cog=j(k.canonic.cog,"Vector3")}if(k.canonic.selectedType){this._selectedType=j(k.canonic.selectedType,"int")}return this},print:function(l){var j=(l!==undefined)?l:"Measurable";console.log(j);switch(this._type){case f.GeometryType.POINT:console.log("    type=POINT point=("+this._position.x+", "+this._position.y+", "+this._position.z+")");break;case f.GeometryType.CURVE:console.log("    type=CURVE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case f.GeometryType.LINE:console.log("    type=LINE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case f.GeometryType.CIRCLE:console.log("    type=CIRCLE radius="+this._radius+" center=("+this._center.x+", "+this._center.y+", "+this._center.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case f.GeometryType.SURFACE:console.log("    type=SURFACE area="+this._area+" cog=("+this._cog.x+", "+this._cog.y+", "+this._cog.z+")");break;case f.GeometryType.PLANE:console.log("    type=PLANE origin=("+this._origin.x+", "+this._origin.y+", "+this._origin.z+") normal=("+this._normal.x+", "+this._normal.y+", "+this._normal.z+")");break;case f.GeometryType.CYLINDER:console.log("    type=CYLINDER point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case f.GeometryType.CONE:console.log("    type=CONE point1=("+this._point1.x+", "+this._point1.y+", "+this._point1.z+") point2=("+this._point2.x+", "+this._point2.y+", "+this._point2.z+")");break;case f.GeometryType.SPHERE:console.log("    type=SPHERE center=("+this._center.x+", "+this._center.y+", "+this._center.z+")");break}var k=this._getMatrix().elements;console.log("    transformation=("+k[0]+", "+k[4]+", "+k[8]+"), ("+k[1]+", "+k[5]+", "+k[9]+"), ("+k[2]+", "+k[6]+", "+k[10]+"), ("+k[3]+", "+k[7]+", "+k[11]+")")},_complete:function(){var j=h.recognizeNonCanonicGeometry(this._SGPrimitive,new g.Matrix4(),true);if(this._type===f.GeometryType.CIRCLE){this._arcLength=j.arcLength;this._length=j.length}else{if(this._type===f.GeometryType.LINE){this._length=j.length}else{if((this._type===f.GeometryType.PLANE)||(this._type===f.GeometryType.CYLINDER)||(this._type===f.GeometryType.CONE)||(this._type===f.GeometryType.SPHERE)){this._area=j.area;this._cog=j.cog}else{if(this._type===f.GeometryType.CURVE){this._length=j.length}else{this._area=j.area;this._cog=j.cog}}}}},_getMatrix:function(){var j=(this._bRealPathElement)?this._pathElement.getWorldMatrix():this._matrix;return j}});return e});define("DS/DMUMeasurable/DMUMeshIntersection",["DS/DMUMeasurable/DMUMathsVector3D","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUMeshServices","DS/DMUMeasurable/DMUMeshMeasure","DS/Visualization/ThreeJS_DS"],function(b,c,g,j,d,h){var a=0.001;var f=0.000001;var i=0.0004;var e={computeSectionCurves:function(G,r,p){var B={};B.returnCode=2;B.nbIntersections=0;B.nbTotTriangles=0;var E=[p[12],p[13],p[14]];var D=[p[8],p[9],p[10]];var w=-b.dot(E,D);var Q=G.count;var z=G.start;var t=G.group.geometry;var A=t.vertexIndexArray;var q=t.vertexPositionArray;var o;var l;var k;var x;var v;var P=[0,0,0];var O=[0,0,0];var N=[0,0,0];var F=[];var L=[0,0,0,0,0,0];var C=Q/3;for(var K=0;K<C;K++){B.nbTotTriangles++;x=z+3*K;v=3*A[x];P[0]=q[v];P[1]=q[v+1];P[2]=q[v+2];v=3*A[x+1];O[0]=q[v];O[1]=q[v+1];O[2]=q[v+2];v=3*A[x+2];N[0]=q[v];N[1]=q[v+1];N[2]=q[v+2];o=P[0]*D[0]+P[1]*D[1]+P[2]*D[2]+w;l=O[0]*D[0]+O[1]*D[1]+O[2]*D[2]+w;k=N[0]*D[0]+N[1]*D[1]+N[2]*D[2]+w;var u=0;var s=0;if(o>0){if(l>0){if(k<=0){u=1}}else{if(k>0){u=2}else{u=1;s=2}}}else{if(l>0){if(k>0){u=1}s=2}else{if(k>0){u=1}}}if((u!==0)||(s!==0)){B.nbIntersections++;var y=3-u-s;var n;if(y===0){n=e._computeIntersectionTrianglePlane(P,O,N,E,D,L)}else{if(y===1){n=e._computeIntersectionTrianglePlane(O,N,P,E,D,L)}else{n=e._computeIntersectionTrianglePlane(N,P,O,E,D,L)}}if(n&&(n.length===2)){F.push([n[0],n[1]])}}}if(F.length>0){B.returnCode=0;e._mergePolylines(F);for(var J=0;J<F.length;J++){e._simplifyPolylinePerpendicularDistance(F[J],i,L)}var m=F.length;for(var I=0;I<m;I++){var M=F[I].length;for(var H=0;H<M;H++){F[I][H]=b.transformPoint(F[I][H],r,F[I][H])}}B.aPolylines=F}return B},_computeIntersectionTrianglePlane:function(C,B,A,q,s,x){var o;var n=x||[0,0,0,0,0,0];n[0]=C[0]-B[0];n[1]=C[1]-B[1];n[2]=C[2]-B[2];n[3]=C[0]-A[0];n[4]=C[1]-A[1];n[5]=C[2]-A[2];var w=n[0]*s[0]+n[1]*s[1]+n[2]*s[2];var v=n[3]*s[0]+n[4]*s[1]+n[5]*s[2];if((Math.abs(w)>a)&&(Math.abs(v)>a)){var m=((q[0]-C[0])*s[0]+(q[1]-C[1])*s[1]+(q[2]-C[2])*s[2]);var z=m/w;var y=m/v;var u=n[0]*z;var t=n[1]*z;var r=n[2]*z;var p=n[3]*y;var l=n[4]*y;var k=n[5]*y;if((Math.abs(u-p)>a)||(Math.abs(t-l)>a)||(Math.abs(r-k)>a)){o=[];o[0]=[u+C[0],t+C[1],r+C[2]];o[1]=[p+C[0],l+C[1],k+C[2]]}}return o},_mergePolylines:function(l){var q=true;var p;var n;var y;var x;var o;var m;var v;var u;while(q){q=false;for(var t=0;t<l.length;t++){p=l[t][0];n=l[t][l[t].length-1];for(var s=t+1;s<l.length;s++){y=l[s][0];x=l[s][l[s].length-1];o=((p[0]-y[0])*(p[0]-y[0]))+((p[1]-y[1])*(p[1]-y[1]))+((p[2]-y[2])*(p[2]-y[2]));if(o<f){for(var r=1,w=l[s].length;r<w;r++){l[t].unshift(l[s][r])}p=l[t][0];l.splice(s,1);q=true;s--}else{m=((p[0]-x[0])*(p[0]-x[0]))+((p[1]-x[1])*(p[1]-x[1]))+((p[2]-x[2])*(p[2]-x[2]));if(m<f){for(var r=l[s].length-2;0<=r;r--){l[t].unshift(l[s][r])}p=l[t][0];l.splice(s,1);q=true;s--}else{v=((n[0]-y[0])*(n[0]-y[0]))+((n[1]-y[1])*(n[1]-y[1]))+((n[2]-y[2])*(n[2]-y[2]));if(v<f){for(var r=1,w=l[s].length;r<w;r++){l[t].push(l[s][r])}n=l[t][l[t].length-1];l.splice(s,1);q=true;s--}else{u=((n[0]-x[0])*(n[0]-x[0]))+((n[1]-x[1])*(n[1]-x[1]))+((n[2]-x[2])*(n[2]-x[2]));if(u<f){for(var r=l[s].length-2;0<=r;r--){l[t].push(l[s][r])}n=l[t][l[t].length-1];l.splice(s,1);q=true;s--}}}}}}}},_simplifyPolylinePerpendicularDistance:function(o,r,q){var k=q||[0,0,0,0,0,0];var t;var s;var p;var u;var v;var m;for(var n=1;n<o.length-1;n++){t=o[n-1];s=o[n];p=o[n+1];k[0]=p[0]-t[0];k[1]=p[1]-t[1];k[2]=p[2]-t[2];u=k[0]*k[0]+k[1]*k[1]+k[2]*k[2];if(u>f){v=((s[0]-t[0])*k[0]+(s[1]-t[1])*k[1]+(s[2]-t[2])*k[2])/u;k[3]=k[0]*v+t[0]-s[0];k[4]=k[1]*v+t[1]-s[1];k[5]=k[2]*v+t[2]-s[2];m=(k[3]*k[3])+(k[4]*k[4])+(k[5]*k[5]);if(m<r){for(var l=n+1;l<o.length;l++){o[l-1]=o[l]}o.length=o.length-1;n--}}}},detectTwoMeshesInterference:function(s,k,r,y,n){var A=1;var z=s&&s.group&&s.group.geometry&&(s.start!==undefined)&&(s.count!==undefined)&&(s.count>0);var x=r&&r.group&&r.group.geometry&&(r.start!==undefined)&&(r.count!==undefined)&&(r.count>0);if(z&&x){A=0;var q=s.group.glType;var p=r.group.glType;if((q===4)&&(p===4)){var u=s.count;var w=j.extractMeshVertices(s,k.elements);var o=u/3;var t=r.count;var v=j.extractMeshVertices(r,y.elements);var m=t/3;var l=d._computeSurfaceSurfaceSquaredDistance(o,w,m,v,n);A=((l.returnCode===0)&&(l.squaredDistance<f))?2:0}}return A},computeRayMeshIntersection:function(x,S,K){var D={returnCode:1,aParameters:[]};if(x&&S&&K&&K.group&&K.group.glType&&K.group.glType===4){D.returnCode=0;var T=K.count;var y=K.start;var r=K.group.geometry;var z=r.vertexIndexArray;var n=r.vertexPositionArray;var J=g.computeAABBForUnsortedPoints(T,y,z,n);if(g.intersectAABBWithRay(J,x,S)){var O,N,M;var G=T/3;var v;var u;var H=[];var F,C,B,R,Q,P;var L=[0,0,0];var p,o;var t;var s=[true,true,true];var q=[true,true,true];var E;var m;var w,I;var l;var A;for(O=0;O<G;O++){v=y+3*O;u=3*z[v];H[0]=[n[u],n[u+1],n[u+2]];u=3*z[v+1];H[1]=[n[u],n[u+1],n[u+2]];u=3*z[v+2];H[2]=[n[u],n[u+1],n[u+2]];H[3]=H[0];F=H[1][0]-H[0][0];C=H[1][1]-H[0][1];B=H[1][2]-H[0][2];R=H[2][0]-H[0][0];Q=H[2][1]-H[0][1];P=H[2][2]-H[0][2];P=H[2][2]-H[0][2];L[0]=C*P-B*Q;L[1]=B*R-F*P;L[2]=F*Q-C*R;p=L[0]*S[0]+L[1]*S[1]+L[2]*S[2];if(Math.abs(p)>a){o=L[0]*(x[0]-H[0][0])+L[1]*(x[1]-H[0][1])+L[2]*(x[2]-H[0][2]);if(((p>0)&&(o<0))||((p<0)&&(o>0))){for(N=0;N<3;N++){F=H[N][0]-x[0];C=H[N][1]-x[1];B=H[N][2]-x[2];R=H[N+1][0]-x[0];Q=H[N+1][1]-x[1];P=H[N+1][2]-x[2];t=(C*P-B*Q)*S[0]+(B*R-F*P)*S[1]+(F*Q-C*R)*S[2];s[N]=(Math.abs(t)<a);q[N]=(t>0)}E=false;if(s[0]){E=true;if(s[1]){m=q[2]}else{if(s[2]){m=q[1]}else{m=(q[1]&&q[2])}}}else{if(s[1]){E=true;if(s[2]){m=q[0]}else{m=(q[2]&&q[0])}}else{if(s[2]){E=true;m=(q[0]&&q[1])}else{if(q[0]&&q[1]&&q[2]){E=true;m=true}else{if(!q[0]&&!q[1]&&!q[2]){E=true;m=false}}}}}if(E){w=b.dot(S,L);I=b.dot(b.sub(x,H[0]),L)/w;if(m){I=-I}l=D.aParameters.length;A=true;for(M=0;A&&(M<l);M++){A=(Math.abs(D.aParameters[M]-I)>a)}if(A){D.aParameters.push(I)}}}}}}}return D},computeRayIntersection:function(p,s,o,r,q){var u;var t=new h.Ray(p,s);var k=t.intersectMeshInstances({object:o},r,t.origin,1);var m=k[0].object.id;var l=[];for(var n=0;n<k.length;n++){if(m===k[n].object.id){l.push(k[n])}}u=(q)?l:l[0];return u}};return e});define("DS/DMUMeasurable/DMUToolsInterference",["DS/DMUMeasurable/DMUMathsBoundingGeometry","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUMeasurable/DMUMeshIntersection","DS/DMUMeasurable/DMUToolsMeasure","DS/DMUMeasurable/DMUMathsVector3D","DS/Visualization/ThreeJS_DS"],function(g,i,e,a,c,h){var b=0.001;var f=0.000001;var d={detectInterference:function(V,U,p,J){var D={};D.returnCode=0;D.interfering1=[];D.interfering2=[];var C=2*f;var y;if(J&&J===true){console.log("Clash Products: "+V.length+" / "+U.length);y=new Date().getTime()}var A=[];var z=[];for(var O=0;O<V.length;O++){for(var N=0;N<U.length;N++){A.push(V[O]);z.push(U[N])}}var I=[];var H=[];var M=[];var L=[];var x;var w;var v;var u;var K;for(var R=0;R<A.length;R++){var t=A[R].getLastElement();var r=z[R].getLastElement();x=a.retrieveProductAABB(t,A[R].getWorldMatrix());w=a.retrieveProductAABB(r,z[R].getWorldMatrix());K=g.computeAABBSquaredDistance(x,w);if(K<C){v=i.isLeaf(t);u=i.isLeaf(r);if(v&&u){I.push(t);H.push(r);M.push(A[R]);L.push(z[R])}else{if(v||(!u&&(t.bSphere.radius<r.bSphere.radius))){var B=r.children;var E=B.length;for(var Q=0;Q<E;Q++){var o=B[Q];if(i.isReferenceOrInstance(o)){A.push(A[R]);var W=z[R].clone();W.addElement(o);z.push(W)}}}else{var B=t.children;var E=B.length;for(var Q=0;Q<E;Q++){var o=B[Q];if(i.isReferenceOrInstance(o)){var W=A[R].clone();W.addElement(o);A.push(W);z.push(z[R])}}}}}}var F=I.length;var G=new Date().getTime()-y;for(var P=0;((D.returnCode===0)||p)&&(P<F);P++){var T=a.retrievePartPrimitivesAndAABB(M[P]);var s=M[P].getWorldMatrix();var S=a.retrievePartPrimitivesAndAABB(L[P]);var q=L[P].getWorldMatrix();var l=d._detectInterferenceBetweenPrimitivesAABB(T,s,S,q,C,J);if(l===2){D.returnCode=2;if(p){D.interfering1.push(M[P]);D.interfering2.push(L[P])}}else{if(T.vertice&&S.vertice){var l=d.computeRayProductInterferences(T.vertice.toArray(),[0,0,1],[L[P]]);if((l.returnCode===0)&&(l.iSide<0)){D.returnCode=2;if(p){D.interfering1.push(M[P]);D.interfering2.push(L[P])}}else{l=d.computeRayProductInterferences(S.vertice.toArray(),[0,0,1],[M[P]]);if((l.returnCode===0)&&(l.iSide<0)){D.returnCode=2;if(p){D.interfering1.push(M[P]);D.interfering2.push(L[P])}}}}}}if(J&&J===true){console.log("Clash Products: Parts Couples="+F+" Scan duration="+G+" Duration="+(new Date().getTime()-y))}return D},_detectInterferenceBetweenPrimitivesAABB:function(m,z,l,y,k,s){var A=0;var o=new Date().getTime();var r=[];var q=0;var u;var w=m.primitives.length;var v=l.primitives.length;for(var p=0;p<w;p++){for(var n=0;n<v;n++){u=g.computeAABBSquaredDistance(m.AABB[p],l.AABB[n]);if(u<f){r[q]=[p,n];q++}}}var t=r.length;var x=0;for(var p=0;(A===0)&&(p<t);p++){A=e.detectTwoMeshesInterference(m.primitives[r[p][0]],z,l.primitives[r[p][1]],y,k);x++}if(s&&s===true){console.log("Clash Parts: Primitives Couples="+w*v+" ("+w+"-"+v+")  Candidates="+r.length+"  TestedCandidates="+x+"  duration="+(new Date().getTime()-o))}return A},computeRayProductInterferences:function(v,Q,B){var A={returnCode:0,iSide:0,aIntersections:[]};for(var O=0;O<B.length;O++){var F=i.getRenderables(B[O]);var s=[v[0],v[1],v[2]];var r=[Q[0],Q[1],Q[2]];var M=B[O].getWorldMatrix();if(M&&!c.isIdentity(M.elements)){var q=new h.Matrix4().getInverse(M).elements;s=c.transformPoint(v,q,s);r=c.transformVector(Q,q,r)}var S=[];var H=F.length;for(var N=0;N<H;N++){var y=F[N].boundingBox.clone().applyMatrix4(M);var D=[y.min.x,y.min.y,y.min.z,y.max.x,y.max.y,y.max.z];if(g.intersectAABBWithRay(D,v,Q)){var C=F[N].geometry;var E=C.length;for(var L=0;L<E;L++){var R=C[L].drawingGroups;var t=R.length;for(var K=0;K<t;K++){if(R[K].geomType==="FACE"){var u=R[K].primitives.length;for(var J=0;J<u;J++){var w=e.computeRayMeshIntersection(s,r,R[K].primitives[J]);if(w.returnCode===0){for(var I=0;I<w.aParameters.length;I++){var o=S.length;var x=true;for(var G=0;x&&(G<o);G++){x=(Math.abs(S[G]-w.aParameters[I])>b)}if(x){S.push(w.aParameters[I]);A.iSide+=(w.aParameters[I]>0)?1:-1;var P=c.multiplyAndAdd(Q,Math.abs(w.aParameters[I]),v);var z=new h.Vector3(P[0],P[1],P[2]);A.aIntersections.push({primitive:R[K].primitives[J],point:z,normal:null,distance:c.subAndLength(P,v),geometry:C[L],object:F[N]})}}}}}}}}}}A.aIntersections.sort(function(k,j){return k.distance-j.distance});return A}};return d});define("DS/DMUMeasurable/DMUToolsAvatars",["DS/DMUMeasurable/DMUToolsMaths","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/FixedSizeNode3D"],function(e,d,c,a){var b={createCrossNode:function(o,g,f,l){var k=new d.Vector3(o,0,0);var i=new d.Vector3(0,o,0);var r=new d.Vector3();var q=r.clone().add(k).add(i);var p=r.clone().sub(k).add(i);var n=r.clone().add(k).sub(i);var m=r.clone().sub(k).sub(i);var t=[q,m,r,p,n];var h=c.createLineNode({points:t,material:l});h.setShadow(false);var j=new a({name:"myFixedSizeNode",ratio:1});j.add(h);var s=e.computeTransformationBetweenTwoLines(new d.Vector3(),new d.Vector3(0,0,1),g,f);j.setMatrix(s.transformation);return j},createLineNode:function(g,f,j){var h=[g.clone(),f.clone()];var i=c.createLineNode({points:h,material:j});i.setShadow(false);return i},createRectangleNode:function(j,g,k,h,l){var i=c.createRectangleNode({width:j,height:g,material:l});i.setShadow(false);var f=e.computeTransformationBetweenTwoLines(new d.Vector3(j/2,g/2,0),new d.Vector3(0,0,1),k,h);i.setMatrix(f.transformation);return i},createCircleNode:function(l,k,j,m){var h=0.2;var i=Math.round((2*Math.PI)/Math.acos(1-(h/l)));var g=c.createCircleNode({radius:l,segments:i,material:m});g.setShadow(false);var f=e.computeTransformationBetweenTwoLines(new d.Vector3(),new d.Vector3(0,0,1),k,j);g.setMatrix(f.transformation);return g},createArcNode:function(h,i,m,l,s,p){var j=0.2;var t=Math.round((2*Math.PI)/Math.acos(1-(j/h)));var f=m.angleTo(l);var r=0;if(p!==undefined&&p===true){r=f;f=(2*Math.PI)}var k=c.createCircleNode({radius:h,segments:t,startAngle:r,endAngle:f,material:s});k.setShadow(false);var q=m.clone().normalize();var n=m.clone().cross(l).normalize();var o=n.clone().cross(m).normalize();var g=new d.Matrix4(q.x,o.x,n.x,0,q.y,o.y,n.y,0,q.z,o.z,n.z,0,0,0,0,1);k.setMatrix(g.setPosition(i));return k}};return b});define("DS/DMUMeasurable/DMUMeasurableElementAgent",["UWA/Core","DS/StateCommandEngine/PathElementAgent","DS/DMUMeasurable/DMUMeshRecognition","DS/DMUMeasurable/DMUGeometryEnums","DS/DMUMeasurable/DMUMeasureEnums","DS/DMUMeasurable/DMUToolsAvatars","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/ThreeJS_DS"],function(b,e,i,f,a,d,h,g){var c=e.extend({init:function(l){var k={pickingFilter:this._pickingFilter,prePickingFilter:this._prePickingFilter,activatePrePicking:false,thisAgent:this};if(l.appli){this._appli=l.appli}if(l.checkAppli){this._checkAppli=l.checkAppli}if(l.displayAppli){this._displayAppli=l.displayAppli}if(l.displayAvatar){this._displayAvatar=l.displayAvatar}var j=b.extend(k,l);this._avatarNode=null;this._parent(j)},_pickingFilter:function(k){var j=this.thisAgent._filter(k);if(this.thisAgent._checkAppli){j=j&&this.thisAgent._checkAppli(k,this.thisAgent._appli)}this.thisAgent._condition=j;return j},_prePickingFilter:function(k){var j=true;if(this.thisAgent.options.activatePrePicking){j=this.thisAgent._filter(k);if(this.thisAgent._checkAppli){j=j&&this.thisAgent._checkAppli(k,this.thisAgent._appli)}}this.thisAgent._condition=j;return j},agentActionOnTheScene:function(k){this._parent(k);var l;if(this._condition&&k.pickingResult.position){var j=this._viewer.getMousePosition(k.event.getCurrentPosition(this._viewer.canvas));l=this._viewer.pick(j,this.options.prePickingMode,true)}if(this._displayAvatar){if(this._avatarNode){h.getSceneRoot(this._viewer).remove(this._avatarNode)}if(this._condition&&k.pickingResult.position&&l.position){this._drawAvatar(this,l.position,l.normal)}}if(this._displayAppli){if(this._condition&&k.pickingResult.position&&l.position){l.pathElement=l.path[0];this._displayAppli(l,this._appli)}}},deactivate:function(){if(this._activated){if(this._avatarNode){h.getSceneRoot(this._viewer).remove(this._avatarNode);this._viewer.render()}this._parent()}},_filter:function(k){var j=k.getLastElement().sgNode;var p=(j!==undefined)||(k.instanceId!==undefined);if(p){if(j!==undefined){this.geometry=i.recognizeCanonicGeometry(j,k.getWorldMatrix(),true);if(this.geometry.returnCode!==0){this.geometry={};switch(j.group.glType){case 1:this.geometry.type=f.GeometryType.CURVE;break;case 4:this.geometry.type=f.GeometryType.SURFACE;break;default:this.geometry.type=f.GeometryType.PICKINGPT}}}else{this.geometry={type:f.GeometryType.PICKINGPT}}var q=this.options.acceptedGeometries.length;if(p&&(q>0)){p=false;for(var l=0;!p&&(l<q);l++){p=this.geometry.type===this.options.acceptedGeometries[l]}}if(p&&q===0){if(this.options.viewedGeometries){if(this.options.viewedGeometries.length>0){if(this.options.viewedGeometries.indexOf(a.ViewedType.PRODUCT)>=0){var r=h.getLastReference(k);k.externalPath=r.externalPath;k.internalPath=r.internalPath;p=true}}}}}else{var o=this.cso.get();if(o){if(o.length>0){var n=false;var m=0;while(!n&&m<o.length){if(o[m].pathElement.isEqual(k)){n=true}m++}if(!n){p=true}}else{p=true}if(p){this.geometry={type:f.GeometryType.PICKINGPT}}}}return p},_drawAvatar:function(o,p,q){var j=new g.MeshBasicMaterial({force:true});j.line=new g.LineBasicMaterial({color:new g.Color(16679169),force:true});var l=new g.LineBasicMaterial({color:new g.Color(16679169),force:true,dashSize:1,gapSize:1});switch(o.geometry.type){case f.GeometryType.POINT:var k=10;o._avatarNode=d.createCrossNode(k,p,q,j);h.getSceneRoot(o._viewer).add(o._avatarNode);break;case f.GeometryType.CIRCLE:var k=10;o._avatarNode=d.createCircleNode(o.geometry.radius,o.geometry.center,o.geometry.normal,j);h.getSceneRoot(o._viewer).add(o._avatarNode);break;case f.GeometryType.SPHERE:var k=10;o._avatarNode=d.createCrossNode(k,o.geometry.center,q,j);h.getSceneRoot(o._viewer).add(o._avatarNode);break;case f.GeometryType.CYLINDER:case f.GeometryType.CONE:var r=o.geometry.point1.clone().sub(o.geometry.point2);var s=r.length()/8;r.normalize().multiplyScalar(s);var n=o.geometry.point1.clone().add(r);var m=o.geometry.point2.clone().sub(r);o._avatarNode=d.createLineNode(n,m,l);h.getSceneRoot(o._viewer).add(o._avatarNode);break;case f.GeometryType.PLANE:var k=10;var t=(p)?p:o.geometry.origin;o._avatarNode=d.createRectangleNode(k,k,t,o.geometry.normal,j);h.getSceneRoot(o._viewer).add(o._avatarNode);break}if(o._avatarNode){o._avatarNode.setNoZ(true);o._avatarNode.setPickable(false)}}});return c});