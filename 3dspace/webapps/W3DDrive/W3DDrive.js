define("DS/W3DDrive/Utils/BrowserDetection",[],function(){var c=window.navigator.userAgent;return{isIE:a,isEdge:b};function a(){var e=c.indexOf("MSIE");var d=c.indexOf("Trident/");if(e>=0||d>=0){return true}return false}function b(){var d=c.indexOf("Edge/");return d>=0?true:false}});define("DS/W3DDrive/Utils/google",[],function(){var a=function(){return{urlEncode:function(b){b=window.escape(b);b=b.replace(new RegExp("\\+","g"),"%2B");return b.replace(new RegExp("%20","g"),"+")}}};return a});define("DS/W3DDrive/Actions/formFactory",["DS/W3DContentApp/Views/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Select","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(t,s,r,e){return{createForm:k,createTextError:n,createTextInput:c,createSelectInput:v,createTextLabel:a,createWarningLabel:u,createToggleRadios:z,disableValidationButton:x,enableValidationButton:y,invalidateInput:i,invalidateInputAndShowErrorMessage:q,onCheckInput:m,showWarningMessage:h,validateInput:p,validateInpuptAndHideErrorMessage:d,wrapInDiv:l,wrapInFormGroup:b};function z(F){var E=F.items;var G=[];var B=document.createElement("div");var D=document.createElement("div");D.innerHTML=F.label||e.options;D.classList.add("label__options");B.appendChild(D);var C={name:F.toggleType||"editType",className:"primary"};E.map(function(J,I){var H=new s(Object.assign({},C,{value:J.value,label:J.label}));if(I===0){H.check()}B.appendChild(H.elements.container);G.push(H)});return{container:B,items:G}}function i(B){B.classList.add("form__input--error");return B}function p(B){B.classList.remove("form__input--error");return B}function g(B){B.textContent=null;B.classList.remove("form__message-error--active");B.classList.remove("form__message--warning");return B}function o(B,C){B=g(B);B.classList.add("form__message-error--active");B.textContent=C;return B}function j(B){B.classList.remove("form__message-error--active");B.classList.add("form__message-error");return B}function h(B,C){B=g(B);B.textContent=C;B.classList.add("form__message--warning");return B}function A(B){B.classList.remove("form__message--warning");return B}function x(B){var C=t.modals.current.getFooter().getElement(B);if(!C.disabled){C.disabled=true}}function y(B){if(!t.modals.current){return}var C=t.modals.current.getFooter().getElement(B);if(C.disabled){C.disabled=false}}function w(C,D,E,B){if(C.checkValidity()){p(C);j(D);y(B)}else{i(C);o(D,E);x(B)}}function f(E,B,D,C){if(B.maxLength!==-1&&B.value.length>=E){h(D,C)}else{A(D)}}function m(F,C,E,D,B){f(F,C,E,D.maxLengthText);w(C,E,D.chars,B)}function q(B,C,D){i(B);o(C,D);return{input:B,textError:C}}function d(B,C){p(B);j(C)}function c(C){var B=document.createElement("input");return Object.assign(B,{autofocus:"true",className:"form-control form-control-root",label:"Title",name:"newContainerName",placeholder:e.title,type:"text",autocomplete:"off"},C)}function n(D,B){var C=document.createElement("span");return Object.assign(C,B,{className:"form__message-error",textContent:D})}function a(D,B){var C=document.createElement("span");return Object.assign(C,B,{className:"form__message-label",textContent:D})}function u(D,B){var C=document.createElement("span");return Object.assign(C,B,{className:"form__message-warning",textContent:D})}function v(C){var B=new r({placeholder:false});var D=C.options;D.map(function(F){var E={};E.value=F.value;E.label=F.label;E.innerText=F.label;E.selected=F.selected;E.disabled=F.disabled;B.add(E)});return B}function b(B){var D=document.createElement("div");D.classList.add("form-group");for(var C=0;C<B.length;C+=1){D.appendChild(B[C])}return D}function k(B,C){var F=document.createElement("form"),E="form-vertical form form-root";if(Array.isArray(B)){for(var D=0;D<B.length;D+=1){if(B[D].tagName){F.appendChild(B[D])}else{B[D].inject(F)}}}else{F.appendChild(B)}if(C.className){E+=" "+C.className}return Object.assign(F,C,{className:E})}function l(B){var D=document.createElement("div");for(var C=0;C<B.length;C+=1){D.appendChild(B[C])}return D}});define("DS/W3DDrive/Models/Actions/Google/actionsUtils",[],function(){var a={};a.accessControlListFolder=Object.freeze({owner:Object.freeze(["moveTo","edit","delete","createFolder","upload","viewPermissions","giveReadAccess","giveEditAccess","removeAccess"]),reader:Object.freeze(["viewPermissions"]),writer:Object.freeze(["edit","createFolder","upload","viewPermissions"]),writerSharer:Object.freeze(["edit","createFolder","upload","viewPermissions","giveReadAccess","giveEditAccess"]),});a.accessControlListFile=Object.freeze({owner:Object.freeze(["moveTo","edit","delete","download","preview","viewPermissions","giveReadAccess","giveEditAccess","removeAccess"]),reader:Object.freeze(["download","preview","viewPermissions"]),writer:Object.freeze(["edit","download","preview","viewPermissions"]),writerSharer:Object.freeze(["edit","download","preview","viewPermissions","giveReadAccess","giveEditAccess"])});return a});define("DS/W3DDrive/Utils/W3DSpacePreferencesUpgrade",[],function(){function a(c){var b=c.getValue("collab-storage");if(b){c.setValue("saved-fragment","drives/"+b+"/mimetype/text%2Fdirectory/inode/myCollabSpaces/content");c.setValue("firstlyLoading","false");c.setValue("collab-storage",null);c.setValue("main-view",null);c.setValue("id-card-view",null)}return c}return a});define("DS/W3DDrive/Metas/drive",[],function(){return function(){return{ids:{dropbox:"dropbox",google2:"google2",drivesHub:"drivesHub",onedrive:"onedrive"},actionPubIds:{remove:"remove",install:"install",storage:"storage"}}}});define("DS/W3DDrive/Metas/errors",[],function(){return function(){return{xmlhttprequestCodes:{BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,CONFLICT:409,PRECONDITION_FAILED:410,INTERNAL_SERVER_ERROR:500},w3ddrive:{ressourceAccess:"res_acc_err",noToken:"no_token_err",duplication:"duplication"}}}});define("DS/W3DDrive/Utils/hubRequestHelper",["DS/WAFData/WAFData"],function(a){var b;return{getHeaders:function(){return{"X-DS-CSRFTOKEN":b}},performRequest:function(e,d){var c=Object.assign({},d);c.headers=c.headers?c.headers:{};c.headers["X-DS-CSRFTOKEN"]=b||"";if(!/content-type/ig.test(Object.keys(c.headers))&&!d.noContentType){c.headers["Content-Type"]="application/json"}var f=c.onComplete;c.onComplete=function(j,i,h){var g=Object.keys(i).filter(function(k){return k.search(/x-ds-csrftoken/i)!==-1});b=g.length>0?i[g[0]]:b;if(typeof f==="function"){f(j,i,h)}};return a.authenticatedRequest(e,c)}}});define("DS/W3DDrive/Utils/ViewsRestrictions",[],function(){var a={restrictions:{},setPossibleRestrictions:function(c,d){if(!this.restrictions.hasOwnProperty(c)){this.restrictions[c]={}}for(var b=0;b<d.length;b++){this.restrictions[c][d[b]]=false}},setRestrictions:function(c,d){if(!this.restrictions.hasOwnProperty(c)){return false}else{for(var b=0;b<d.length;b++){if(this.restrictions[c].hasOwnProperty(d[b])===true){this.restrictions[c][d[b]]=true}}return true}},getRestrictions:function(b){if(!this.restrictions.hasOwnProperty(b)){return{}}else{return this.restrictions[b]}},getRestriction:function(c,b){if(!this.restrictions.hasOwnProperty(c)){return false}else{if(!this.restrictions[c].hasOwnProperty(b)){return false}else{return this.restrictions[c][b]}}}};return a});define("DS/W3DDrive/Actions/Share/CollabSpaces/shareCSHelper",["DS/W3DContentApp/Utils/Helpers","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,d){function c(g){var f;if(g==="PublicReader"){f=d.publicreader}else{if(g==="Reader"){f=d.readercs}else{if(g==="Contributor"){f=d.contributor}else{if(g==="Author"){f=d.author}else{if(g==="Leader"){f=d.leaderOwner}else{if(g==="Readerrestricted"){f=d.restrictedReader}else{if(g==="Contributorrestricted"){f=d.restrictedContributor}else{if(g==="Authorrestricted"){f=d.restrictedAuthor}else{if(g==="Leaderrestricted"){f=d.restrictedLeaderOwner}}}}}}}}}return{id:g,name:f}}function e(g){var h=[];if(g){for(var f=0;f<g.length;f++){if(g[f]==="PublicReader"){h=h.concat(g[f])}else{if(g[f]==="Reader"){h=h.concat(g[f])}else{if(g[f]==="Contributor"){h=h.concat(g[f])}else{if(g[f]==="Author"){h=h.concat(g[f])}else{if(g[f]==="Leader"){h=h.concat(g[f])}else{if(g[f]==="Readerrestricted"){h=h.concat(g[f])}else{if(g[f]==="Contributorrestricted"){h=h.concat(g[f])}else{if(g[f]==="Authorrestricted"){h=h.concat(g[f])}else{if(g[f]==="Leaderrestricted"){h=h.concat(g[f])}}}}}}}}}}}return h.reverse()}function a(i,g){var h=g.get("availableRoles");var f=e(h);return f.filter(function(j){return(i.indexOf(j)!==-1)}).map(function(j){return c(j)})}return function(g,f){return{inputCategories:a(g,f)}}});define("DS/W3DDrive/Metas/inode",["DS/WebappsUtils/WebappsUtils"],function(M){var r=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_SWV1_Part200x150.png");var k=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_SWV1_Assembly200x150.png");var I=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_SWV1_Drawing200x150.png");var f=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_CATV5_Assembly200x150.png");var E=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_CATV5_Drawing200x150.png");var O=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_CATV5_Part200x150.png");var T=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_EASM200x150.png");var s=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_EDRW200x150.png");var V=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_EPRT200x150.png");var C=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_STL200x150.png");var a=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_3DXML200x150.png");var N=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_DWG200x150.png");var U=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_IGES200x150.png");var t=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_DXF200x150.png");var l=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_OBJ200x150.png");var F=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_STEP200x150.png");var J=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_VRML200x150.png");var j=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_3MF200x150.png");var x=M.getWebappsAssetUrl("W3DDrive","thumbnails/l_3PDF200x150.png");var w=M.getWebappsAssetUrl("W3DDrive","thumbnails/l_SLDX200x150.png");var W=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_ComposerSmg200x150.png");var d=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_AxF200x150.png");var n=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpac2DGridFile200x150.png");var o=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacBlockModelFile200x150.png");var X=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacBlockModelConstraint200x150.png");var Q=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacDatarecorderConfiguration200x150.png");var R=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacDTMFile200x150.png");var m=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacExperimentalvariogram200x150.png");var z=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacGeologyDatabase200x150.png");var y=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacGraphicsStylesFile200x150.png");var b=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacScriptFile200x150.png");var q=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacPlotFile200x150.png");var u=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacPluginBlockModel200x150.png");var A=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacRangeFile200x150.png");var e=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacStringFile200x150.png");var H=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacSurpacWorkArea200x150.png");var S=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacSurveyDatabase200x150.png");var p=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASurpacVariogramFile200x150.png");var c=M.getWebappsAssetUrl("W3DDrive","thumbnails/GEOVIASDMFile200x150.png");var G=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_TableDoc200x150.png");var B=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_PresDoc200x150.png");var v=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_TextDoc200x150.png");var L=M.getWebappsAssetUrl("W3DDrive","thumbnails/l_DIAG200x150.png");var i=M.getWebappsAssetUrl("W3DDrive","thumbnails/l_PROJ200x150.png");var D=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_PDFdoc200x150.png");var K=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_ImageFile200x150.png");var h=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_VideoFile200x150.png");var P=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_AudioFile200x150.png");var g=M.getWebappsAssetUrl("W3DDrive","thumbnails/I_ZIPDoc200x150.png");return function(){return{mimeType:{folder:"text/directory",label:"text/label",pdf:"application/pdf",collabSpace:"collaborative Space"},ids:{trueRoot:"trueRootId",sharedWithMe:"sharedwithme"},actionPubIds:{share:"share",shareContent:"shareContent",moveTo:"moveTo",copy:"copy",edit:"edit",del:"delete",createFolder:"createFolder",createLabel:"createLabel",upload:"upload",label:"label",download:"download",preview:"preview",openWith:"openWith",insert:"insert",comment:"comment",viewPermissions:"viewPermissions",viewPermissionsLink:"viewPermissionsLink",viewPermissionsGroup:"viewPermissionsGroup",createCollabSpace:"createCollabSpace",update:"update",editCS:"editCS",addMember:"addMember",addMemberRestricted:"addMemberRestricted",changeThumbnail:"changeThumbnail",addContent:"addContent",moveToCS:"moveToCS",editContent:"editContent",viewAnalytics:"viewAnalytics",downloadVersion:"downloadVersion",restoreVersion:"restoreVersion",restore:"restore",addToMyDrive:"addToMyDrive",changeAlias:"changeAlias",removeFromMyDrive:"removeFromMyDrive"},thumbnails:{content:M.getWebappsAssetUrl("W3DDrive","thumbnails/I_UnknownFile200x150.png"),folder:M.getWebappsAssetUrl("W3DDrive","folder_thumbnail.png"),sharedFolder:M.getWebappsAssetUrl("W3DDrive","folder-thumbnail-shared.png"),label:M.getWebappsAssetUrl("W3DDrive","collection_thumbnail.png"),sldprt:r,sldasm:k,slddrw:I,eprt:V,easm:T,edrw:s,catpart:O,catproduct:f,catdrawing:E,"3dxml":a,"3mf":j,dwg:N,dxf:t,sldxml:w,u3d:x,iges:U,igs:U,obj:l,stp:F,step:F,stl:C,vrml:J,smg:W,smggeom:W,smgxml:W,smgview:W,smgsce:W,axf:d,grd:n,mdl:o,con:X,sdf:Q,dtm:R,evg:m,ddb:z,ssi:y,tcl:b,tbc:b,pf:q,dm:u,dms:u,bmf:u,bpr2:u,rng:A,str:e,swa:H,sdb:S,vgm:p,sdm:c,xls:G,xlsx:G,numbers:G,csv:G,ppt:B,pptx:B,keynote:B,txt:v,log:v,doc:v,docx:v,mpp:i,vsd:L,vsdx:L,pdf:D,png:K,jpg:K,jpeg:K,gif:K,tiff:K,tif:K,bmp:K,psd:K,ai:K,wmv:h,mp4:h,mov:h,avi:h,mpg:P,wma:P,mp3:P,wav:P,zip:g},icons:{folder:"folder",label:M.getWebappsAssetUrl("W3DDrive","collection_icon.png")}}}});define("DS/W3DDrive/Models/AmazonCloudDrive/Drive",[],function(){var a;a=function(){return};a.DRIVE_ID="amazonCloud";return a});define("DS/W3DDrive/Utils/StructureNavigation",[],function(){return{filesAreEqual:f,hasRelations:b,isLinkedFile:d,isPart:c,isSupportedBy3DPlay:e};function d(g){if(typeof g!=="object"||Array.isArray(g)||!g.isContainer||!g.drive){return false}if(g.isContainer()){return false}return b(g)&&g.drive.isDsDrive}function b(g){return a({inode:g,extensions:["CATProduct","sldasm"]})}function c(g){if(typeof g!=="object"||Array.isArray(g)||!g.isContainer||!g.drive){return false}if(g.isContainer()){return false}return g.drive.isDsDrive&&a({inode:g,extensions:["sldprt","catpart"]})}function f(h,g){if(!h||!g){return false}return h.name===g.name&&h.size===g.size&&h.lastModified===g.lastModified}function e(g){return a({inode:g,extensions:["CATProduct"]})}function a(i){if(typeof i==="undefined"){throw"isExtensionAllowed takes an object options as parameter"}if(typeof i.extensions==="undefined"){throw'isExtensionAllowed takes an array of extensions as "options.extensions"'}if(typeof i.inode==="undefined"){throw'isExtensionAllowed takes an object/string to compare the extension as "options.inode"'}var k=i.extensions;var m=i.inode;var l="";var j=new RegExp(k.join("|"),"i");if(typeof m==="string"){var h=m.lastIndexOf(".")+1;l=m.substr(h)}else{l=m.get("fileExtension")}if(l&&l.search){var g=l.search(j);return g>-1}else{return false}}});define("DS/W3DDrive/Metas/permission",["DS/WebappsUtils/WebappsUtils"],function(a){return function(){return{actionPubIds:{removePermission:"removePermission",makeReader:"makeReader",makeWriter:"makeWriter",makeWriterShare:"makeWriterShare",makeReaderShare:"makeReaderShare",enableShare:"enableShare",disableShare:"disableShare",makeContributor:"makeContributor",makeAuthor:"makeAuthor",makeLeaderOwner:"makeLeaderOwner",makeMainOwner:"makeMainOwner",makePublicReader:"makePublicReader"},thumbnails:{people:a.getWebappsAssetUrl("W3DDrive","default_people.png")}}}});define("DS/W3DDrive/Actions/createTasksSession",["UWA/Class/Promise","i18n!DS/W3DDrive/assets/nls/W3DDrive",],function(b,c){function a(d){d.returnValue=c.onBeforeUnload}return function(f){var g=[];var i=(f||7);var h=(function(){var l=[];function k(m){m=[].concat(m).filter(function(n){return(typeof n==="function")});l.push(m);return l.length}function j(){var n=l[0];if(!n){return}var m=n.shift();if(!n.length){l.splice(0,1)}return m}return{push:k,shift:j}})();function d(){if(i<=0){return}var j=h.shift();if(!j){return}j().then(d);d()}function e(o){o=[].concat(o).filter(function(p){return(typeof p==="function")});var m=o.map(function(){return b.deferred()});var k=o.map(function(p,q){return function(){var r=p();--i;return r.then(function(){++i;m[q].resolve(Array.prototype.slice.apply(arguments))},function(){++i;m[q].reject(Array.prototype.slice.apply(arguments))})}});h.push(k);d();window.addEventListener("beforeunload",a);var j=[];var l=[];return m.reduce(function(q,p){return q.then(function(){return p.promise.then(function(){j.push(arguments[0])},function(){l.push(arguments[0])})})},b.resolve()).then(n,n);function n(){window.removeEventListener("beforeunload",a);if(!l.length){return b.resolve(j.reduce(function(q,p){return q.concat(p)},[]))}return b.reject(l.reduce(function(q,p){return q.concat(p)},[]))}}return e}});define("DS/W3DDrive/Actions/Permissions/Base",["DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c,b){return function(d){var e={actions:[],init:function(f){f=f||{};this.model=f.model},toJSON:function(){var f=this.model;var g=this.actions.filter(function(h){return f.isActionAllowed(h.id)},this);if(!g.length){return null}return g},openDialog:function(h){var g=this.model;var f=document.createElement("div");var j=h.titleNLSKey;var i=h.modalBodyContent;var k=h.confirmAction;i.reduce(function(l,m){l.appendChild(m);return l},f);return a.dialog({title:b.replace(b[j],{name:g.get("displayName")||g.get("label")}),body:f,buttons:[{className:"primary",value:k.NLSKey,action:function(l){l.hide();k.handler()}},{value:b.cancel,action:function(l){l.hide()}}]})},dispatchPermissionActions:function(g,f){c.dispatchEvent("permission:"+g,f)}};e.init(d);return e}});define("DS/W3DDrive/Models/Box/Drive",[],function(){var a;a=function(){return};a.DRIVE_ID="box";return a});define("DS/W3DDrive/Collections/Pagination",["UWA/Core"],function(b){return function a(c){return c.extend({finiteInt:function(e,d){if(!(b.typeOf(e)==="number")||isNaN(e)||!isFinite(e)||~~e!==e){throw new TypeError("`"+d+"` must be a finite integer")}return e},_computeTotalPages:function(e,d){return Math.ceil(e/d)},_checkState:function(g){if(g){var i=g.totalRecords,d=g.pageSize,e=g.currentPage,h=g.firstPage,f=g.totalPages;if(i!=null&&d!=null&&e!=null&&h!=null){i=this.finiteInt(i,"totalRecords");d=this.finiteInt(d,"pageSize");e=this.finiteInt(e,"currentPage");h=this.finiteInt(h,"firstPage");if(d<1){throw new RangeError("`pageSize` must be >= 1")}f=g.totalPages=this._computeTotalPages(i,d);if(h<0||h>1){throw new RangeError("`firstPage must be 0 or 1`")}g.lastPage=h===0?Math.max(0,f-1):f||h;if(e<h||(f>0&&(h?e>f:e>=f))){throw new RangeError("`currentPage` must be firstPage <= currentPage "+(h?"<=":"<")+" totalPages if "+h+"-based. Got "+e+".")}}return g}},hasPreviousPage:function(){var e=this,f=e.state,d=f?f.currentPage:undefined;return d>f.firstPage},hasNextPage:function(){var e=this,g=e.state,d=g?g.currentPage:undefined,f=g?g.lastPage:undefined;return d<f},getFirstPage:function(d){return this.getPage("first",d)},getPreviousPage:function(d){return this.getPage("prev",d)},getNextPage:function(d){return this.getPage("next",d)},getLastPage:function(d){return this.getPage("last",d)},getPage:function(e,d){var g=this,j=g.state,f=j?j.currentPage:undefined,k=j?j.firstPage:undefined,i=j?j.lastPage:undefined,h=e;d=d||{};switch(e){case"first":h=k;break;case"prev":h=f-1;break;case"next":h=f+1;break;case"last":h=i;break;default:h=this.finiteInt(e,"index")}g.state=g._checkState(b.extend(j,{currentPage:h}));d.from=f;d.to=h;if(d.permissions){d.permissions.state=g.state;return d.permissions.fetch(d)}else{return g.fetch(d)}}})}});define("DS/W3DDrive/Collections/drivesHubFactory",["UWA/Data","UWA/Class/Promise"],function(a,b){return function(c){var d=c.url;if(!d){throw new Error("A URL must be provided in order to build the factory.")}return{createDrives:function(){this.getProviders().then(function(e){e.map(function(f){})})},getProviders:function(){var e=d+"drive/v1/providers";return new b(function(g,f){a.request(e,{onComplete:function(h){g(h)},onFailure:function(h){f(h)}})})}}}});define("DS/W3DDrive/Actions/dialogTree",["DS/UIKIT/Scroller","DS/W3DContentApp/Views/DriveView/driveTreeViewWithDocument","DS/W3DContentApp/Views/SuperModal","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,b,g,i){return function c(q,t){var m=b();var n=m.getXSO();t=(t||{});var l=UWA.createElement("span",{"class":"form__message-error",text:" "});var s=document.createElement("div");s.classList.add("modal__content-tree-wrapper");s.appendChild(m.container);var o=document.createElement("div");o.classList.add("modal__content-tree");[s,l].map(function(u){o.appendChild(u)});n.onAdd(j({xso:n,modalContentTree:o,excludeInodes:t.excludeInodes,checkForm:t.checkForm}));var p=new a({element:s});var r=!q.isContainer();if(r){q=q.collection.dot()}q.drive.getInodesPath(t.inodeFrom,q).then(function(x){var v=m.expandInodesPath(x);if(!v||!v.length){return}var w=v[v.length-1];if(!r){w.hide();return}if(w.inode.get("parentId")==="myCollabSpaces"){w.hide();var y=w._parentNode.getChildren();var u=["VPLMProjectLeader","VPLMProjectAuthor","VPLMProjectAdministrator"];y.map(function(z){var A=z.inode.get("contexts")[0].role?z.inode.get("contexts")[0].role:z.inode.get("contexts")[1].split(".")[0];if(u.indexOf(A)===-1){z.hide()}})}else{w.expand()}});return{xso:n,scroller:p,treeView:m,modalContentTree:o}};function e(m,l){if(!m){return}if(l){m.classList.add("form__message-error--active")}else{m.classList.remove("form__message-error--active")}}function k(l,m){if(!l){return}if(m){l.classList.add("disabled")}else{l.classList.remove("disabled")}}function d(l,m){if(!l||!m){return}l.textContent=i.replace(i.operationNotPossibleOnFolder,{name:m.get("title")})}function h(l){return l.get().map(function(m){return m.inode})}function f(m,l){return !l[m.get("id")]}function j(l){return function(){var n=l.xso;var q=l.modalContentTree;var r=l.excludeInodes||{};var t=h(n);var s=q.querySelector(".form__message-error");var p=q.parentElement.parentElement.querySelector(".js-validation-button");var m=t.reduce(function(v,u){return(v&&f(u,r))},true);if(!m){d(s,t[0])}var o=m;if(o&&l.checkForm){o=l.checkForm(true)}k(p,!o);e(s,!m)}}});define("DS/W3DDrive/Models/Actions/CollabSpaces/actionsUtils",[],function(){var a={};a.getCollabSpaceActions=function(b){var e=[];if(!(b.get("parentId")==="trueRootId")){e=["viewPermissions","viewAnalytics"]}var d=b.get("actions");if(d){for(var c=0;c<d.length;c++){if(d[c]==="edit.title"){e.push("editCS")}if(d[c]==="add.contents"){e.push("addContent")}if(d[c]==="add.members"){e.push("PublicReader","Reader","Contributor","Author","Leader","Readerrestricted","Contributorrestricted","Authorrestricted","Leaderrestricted")}if(d[c]==="add.members.restricted"){e.push("Readerrestricted","Contributorrestricted","Authorrestricted","Leaderrestricted")}if(d[c]==="delete"){e.push("delete")}if(d[c]==="edit.thumbnail"){e.push("changeThumbnail")}if(d[c]==="add.collabspaces"){e.push("createCollabSpace")}}}return e};a.getContentActions=function(b){var e=["comment","preview","openWith"];var d=b.get("actions");if(d){for(var c=0;c<d.length;c++){if(d[c]==="download"){e.push("download");if(b.get("type").value==="Document"){e.push("shareContent")}}if(d[c]==="move"){e.push("moveToCS")}if(d[c]==="update"){e.push("update")}if(d[c]==="delete"){e.push("delete")}if(d[c]==="edit"){e.push("editContent")}}}return e};return a});define("DS/W3DDrive/Utils/SystemDetection",[],function(){var b=window.navigator.appVersion;return{isWindows:a};function a(){return b.indexOf("Win")!==-1?true:false}});define("DS/W3DDrive/Actions/Iterations/Base",["DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c,b){return function(e){var d={actions:[],init:function(f){var g=Object.assign({},f);this.model=g.model},toJSON:function(){var f=this.model;var g=this.actions.filter(function(h){return f.isActionAllowed(h.id)});if(!g.length){return null}return g},openDialog:function(h){var g=this.model;var f=document.createElement("div");var k=h.title;var j=h.titleNLSKey;var i=h.modalBodyContent;var l=h.confirmAction;i.reduce(function(m,n){m.appendChild(n);return m},f);return a.dialog({title:k||b.replace(b[j],{name:g.get("displayName")||g.get("label")}),body:f,buttons:[{className:"primary",value:l.value,action:function(m){m.hide();l.handler()}},{value:b.cancel,action:function(m){m.hide()}}]})},dispatchIterationActions:function(g,f){c.dispatchEvent("iteration:"+g,f)}};d.init(e);return d}});define("DS/W3DDrive/initWidget",["UWA/Utils","DS/WebAppsFoundations/Views/CollectionView"],function(b,a){function c(f){a.prototype.buildItemView=function(i,j){if(!this.childrenViews){this.childrenViews=[]}var h=new j({model:i});this.childrenViews.push(h);return h};var d=a.prototype.destroy;a.prototype.destroy=function(){if(this&&this.childrenViews){this.childrenViews.map(function(h){h.destroy();h.stopListening();h.container=null;h=null})}this.childrenViews=null;d.apply(this,arguments)};if(!f.hasPreference("isInodePanelSideBarOpened")){f.addPreference({name:"isInodePanelSideBarOpened",type:"hidden",label:"InodePanelView SideBar opened state",defaultValue:"`false`"})}if(!f.hasPreference("isDrivePanelSideBarCollapsed")){f.addPreference({name:"isDrivePanelSideBarCollapsed",type:"hidden",label:"DrivePanelView SideBar opened state",defaultValue:"`false`"})}if(!f.hasPreference("inodeTableLayoutKey")){f.addPreference({name:"inodeTableLayoutKey",type:"hidden",label:"selected inodeTableLayout layout",defaultValue:"thumbnailsLayout"})}if(!f.hasPreference("inodeDetailViewKey")){f.addPreference({name:"inodeDetailViewKey",type:"hidden",label:"selected inodeDetailView tab",defaultValue:"inode-detail-properties"})}function e(){function h(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return h()+h()+"-"+h()+"-"+h()+"-"+h()+"-"+h()+h()+h()}function g(h,j){if(typeof h!=="string"){return false}var i=f.getValue(h);if(j===i){return}f.setValue(h,j);return true}f.setValue("3ddrive_uuid","W-"+e());f.addEvents({onToggleInodePanelSideBarVisibility:function(){var h=!f.getBool("isInodePanelSideBarOpened");f.setValue("isInodePanelSideBarOpened",h);f.dispatchEvent("onInodePanelSideBarVisibilityToggled",h)},onToggleLightboxPropertiesVisibility:function(){f.dispatchEvent("onToggleLightboxPropertiesVisibilityToggled")},onToggleDrivePanelSideBarCollapsed:function(){var h=!f.getBool("isDrivePanelSideBarCollapsed");f.setValue("isDrivePanelSideBarCollapsed",h);f.dispatchEvent("onDrivePanelSideBarCollapsedToggled",h)},onUpdateInodeTableLayoutKey:function(h){if(g("inodeTableLayoutKey",h)){f.dispatchEvent("onInodeTableLayoutKeyUpdated",h)}},onUpdateInodeDetailViewKey:function(j){var h="inodeDetailViewKey";var i=f.getValue(h);if(i===j){return}g(h,j)}});return f}return c});define("DS/W3DDrive/Views/inodeDetailAnalyticsView",["UWA/Class/View","DS/W3DXComponents/Views/GraphView","DS/UIKIT/Scroller","DS/UIKIT/Input/Select","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css","css!DS/UIKIT/UIKIT.css"],function(c,g,e,a,o){var h;var p,j,i,b;function d(){var q=document.createElement("div");q.classList.add("inode-detail-analytics__to-scroll");return q}function k(q,t){var s=new g({title:q.title,type:g.TYPE_PIE,unit:q.unit,plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:true,format:"<b>{point.name}</b>: {point.y:} "+q.labelFormat}}},series:[]});var r=UWA.createElement("div",{"class":"analytics"});s.inject(r);r.inject(t);s.reflow();return s}function m(r,q){r.setOptions({subtitle:q.nbr+" "+q.subtitle,series:[{data:q.data}]}).render()}function n(q,s){var r={};r.onComplete=function(w){var v=JSON.parse(w);var u=v.mpr,t=v.nbmembers;m(q,{data:u,subtitle:o.members,nbr:t})};s.getAnalyticsMembers(r)}function f(q,r){p=k({title:o.mpr,unit:o.unitMembers,labelFormat:"",graphName:"Members"},q)}function l(s){var x=s.model;var r=new c(s);var q=r.destroy;var w=false;var u=UWA.createElement("div",{"class":"inode-analytics_container"});u.render=function(){};u.container=u;function v(){var z=r.container;var B=r.elements;var A=d();f(u,x);n(p,x);A.appendChild(u);z.appendChild(A);var y=new e({element:A});return r}function t(){q.apply(r,arguments);w=false;u.container=null;p.destroy()}r.container.classList.add("inode-detail-analytics");return Object.assign(r,{render:v,destroy:t})}return l});define("DS/W3DDrive/Models/Stub",[],function(b){function a(e,c){if(!c){return}var d=c.onComplete;var f=((typeof e.toJSON==="function")?e.toJSON():{});if(typeof d==="function"){d(e,f,c)}if(typeof e.dispatchEvent==="function"){e.dispatchEvent("onSync",[e,f,c])}}return{fetch:function(c){a(this,c)},save:function(d,e,c){a(this,c)}}});define("DS/W3DDrive/Models/Actions/Dropbox/actionsUtils",[],function(){var a={};a.accessControlListFolder=Object.freeze({owner:Object.freeze(["moveTo","edit","copy","delete","createFolder","upload","viewPermissions","giveEditAccess","giveReadAccess"]),writer:Object.freeze(["moveTo","edit","copy","delete","viewPermissions"]),reader:Object.freeze(["copy","viewPermissions"])});a.accessControlListSharedFolderChild=Object.freeze({owner:Object.freeze(["moveTo","edit","copy","delete","createFolder","upload","viewPermissions"]),writer:Object.freeze(["moveTo","edit","copy","delete","viewPermissions"]),reader:Object.freeze(["copy","viewPermissions"])});a.accessControlListFile=Object.freeze({owner:Object.freeze(["moveTo","edit","copy","delete","download","preview","viewPermissions","giveReadAccess"]),writer:Object.freeze(["moveTo","edit","copy","delete","download","preview","viewPermissions"]),reader:Object.freeze(["copy","download","preview","viewPermissions"])});return a});define("DS/W3DDrive/Collections/Stub",[],function(b){function a(e,c){if(!c){return}var d=c.onComplete;var f=((typeof e.toJSON==="function")?e.toJSON():{});if(typeof d==="function"){d(e,f,c)}if(typeof e.dispatchEvent==="function"){e.dispatchEvent("onSync",[e,f,c])}}return{comparator:null,fetch:function(c){a(this,c)}}});define("DS/W3DDrive/Views/startView",["DS/UIKIT/Input/Button","DS/W3DXComponents/Views/EmptyView","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css"],function(k,m,d){var b="start-view",e="start-view_content",a=e+"--medium",o=e+"--small";var f="start_view_0";var c=true;var n=0;var g;var s=Object.freeze({normal:880,small:540});function q(t,u){if(!t){return""}if(u in t){return t[u].join?t[u].join(" "):t[u]}return""}function i(t,v){var u=t||"div";var w=q(v,"classes");var x=q(v,"content");var y=w?' class="'+w+'"':"";return"<"+u+y+">"+x+"</"+u+">"}function j(t,v){var u=i("span",{classes:t.icon});var x=i("span",{classes:t.title,content:v.title});var w=i("div",{classes:t.content,content:[u,x]});return i("div",{classes:t.container,content:w})}function p(t){t.container.addEvent("dragenter",function(){n+=1;if(!t.container.classList.contains("drag-over")){t.container.classList.add("drag-over")}});t.container.addEvent("dragleave",function(){n-=1;if(n===0){t.container.classList.remove("drag-over")}});t.container.addEvent("drop",function(){n=0;t.container.classList.remove("drag-over")})}function h(t){c=true;function u(){if(!c){return}setTimeout(function(){if(c){g=requestAnimationFrame(u)}},500);var v=t.container.firstChild.classList;var w=parseInt(getComputedStyle(t.container).getPropertyValue("width").replace("px",""),10);if(w<s.small){if(v.contains(o)){return}v.remove(e);v.remove(a);v.add(o);return}if(w<s.normal){if(v.contains(a)){return}v.remove(e);v.remove(o);v.add(a);return}if(v.contains(e)){return}v.remove(a);v.remove(o);v.add(e)}g=window.requestAnimationFrame(u)}function r(){window.cancelAnimationFrame(g);g=null;c=false}function l(t){if(c===t){return}if(t){h(this)}else{r()}}return function(){var u=new m({id:f,template:function(){var x=j({container:b+"__drop-zone",content:b+"__drop-zone-content",icon:b+"__drop-zone-icon fonticon fonticon-5x fonticon-3dpart",title:b+"__drop-zone-title"},{title:d.dropFiles});var v=new k({value:d.selectToUpload,className:"primary block",icon:"upload"});var w=(v.elements.container.outerHTML+i("span",{classes:b+"__separator",content:d.or})+x);return i("div",{classes:"start-view_content",content:w})}});u.container.classList.add(b);p(u);h(u);u.toggleResponsive=l;var t=u.destroy;u.destroy=function(){if(u){u.container.removeEvents();r();u.template=null;t.apply(u,arguments);u.stopListening();u.container=null;u.model=null;u=null}};return u}});define("DS/W3DDrive/Utils/AuthAdapter",["UWA/Utils","UWA/Services/Auth/Adapter/Exposition"],function(b,c){function a(){var d=new c();return Object.assign(d,{authenticate:function(g,f){var e=window.open("about:blank","blank","left=160,top=120,width=750,height=750,resizable=yes"),h=setInterval(function(){var j;try{if(!e||e.closed){clearInterval(h);d.hasIdentity(g,f);return}j=e.location;if(j&&b.isValidUrl(j)&&b.matchUrl(location,j)){e.close()}}catch(i){}},500);d.request("authenticate",function(i){e.location=i.url},f)}})}return a});define("DS/W3DDrive/Utils/dropbox",[],function(){var a=function(){return{isSharedWithMe:function(b){if(b.access_type&&b.access_type!=="owner"){return true}if(b.shared_folder&&b.shared_folder["access_type"]!=="owner"){return true}return false}}};return a});define("DS/W3DDrive/Utils/errors",["DS/W3DContentApp/Utils/Helpers","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(c,f){function b(){var g=Error.apply(this,arguments);g.name=this.name=this.constructor.name;this.stack=g.stack;this.message=g.message}b.prototype=Object.create(Error.prototype,{constructor:{value:b,writtable:true,configurable:true}});function a(h){var g=c.computeNLSSize(h.constants.maxFileSize);return new b(f.replace(f.maxSize,{size:g}))}function e(h){var g=c.computeNLSSize(h.constants.maxFileSize);return new b(f.replace(f.maxSizeDSDrive,{size:g}))}function d(g){return new b(f.replace(f.uploadUnsupportedChar,{character:g}))}return{createUploadFileSizeError:a,createUploadFileSizeErrorDSDrive:e,createUploadFileNameErrorDSDrive:d,UploadError:b}});define("DS/W3DDrive/Actions/download",["UWA/Promise","UWA/Utils"],function(c,b){function a(h,j,e){if(!h){return}j=(j||"POST");if(j==="GET"){if(window.navigator.msSaveOrOpenBlob){window.open(h,"_blank");return}var d=document.createElement("a");var g=function(k){k.stopPropagation();document.body.removeChild(d);d.removeEventListener("click",g)};d.href=h;d.target="_blank";d.download=e.get("title");d.addEventListener("click",g);document.body.appendChild(d);d.click();return}var f=document.createElement("form");f.style.display="none";f.method=j;if(h.indexOf("?")!==-1){var i=b.parseQuery(h);Object.keys(i).reduce(function(m,l){var k=document.createElement("input");k.setAttribute("name",l);k.setAttribute("value",i[l]);m.appendChild(k);return m},f)}f.action=h.substring(0,h.indexOf("?"));document.body.appendChild(f);f.submit()}return a});define("DS/W3DDrive/Actions/Permissions/GroupAccess",["DS/W3DDrive/Metas/permission","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c){var b=a();return function(d){d.actions.push({id:b.actionPubIds.removePermission,text:c.remove,icon:"fonticon fonticon-cancel",handler:function(){var e=d.model;var f=document.createTextNode(c.replace(c.shareRemove,{name:e.get("displayName")}));return d.openDialog({titleNLSKey:"shareRemove",modalBodyContent:[f],confirmAction:{NLSKey:c.remove,handler:function(){d.dispatchPermissionActions("onRemoveLinkAuthorization",[e])}}})}});return d}});define("DS/W3DDrive/Views/driveActions",["UWA/Class/Events","DS/Usage/TrackerAPI","DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Metas/drive","DS/W3DContentApp/Views/DriveView/driveDetailView","DS/W3DContentApp/BusEvent","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css"],function(l,e,j,a,i,h,k){var c=a();function d(n,m){return m.isActionIdoK(n.id)}function g(m,o){var n=[];o.forEach(function(p){if(d(p,m)){n.push(p)}},this);return n}function b(o,n,m){o.dispatchEvent(n,m);h.dispatchEvent("driveActions:"+n,m)}function f(m){var u=new l(m);var t=m.model;var r=e.getCounter("3DDrive-sync-tool-installation",{label:"Sync tool installation",appID:"X3DDRIV_AP",tenant:m.model.id});var q=e.getCounter("3DDrive-disconnect-external-service",{label:"Disconnect external service",appID:"X3DDRIV_AP",tenant:m.model.id});function n(){b(u,"onInstall",[t]);r.inc()}function p(){var w=i({model:t});var v={title:t.get("title"),body:w.container,buttons:[{className:"primary",value:k.ok,action:function(x){x.hide()}}]};w.render();j.dialog(v);b(u,"onStorage",[t])}function s(){b(u,"onRemove",[t]);q.inc()}var o=[{id:c.actionPubIds.storage,text:k.storage,icon:"database",handler:p},{id:c.actionPubIds.remove,text:k.disconnect,icon:"box-times",handler:s}];return Object.assign(u,{toJSON:function(v){return g(t,o,v)}})}return f});define("DS/W3DDrive/initStdWidget",["UWA/Utils","DS/W3DDrive/initWidget","DS/PlatformAPI/PlatformAPI","css!DS/W3DDrive/W3DDrive.css"],function(b,c,a){function d(f){var e=b.parseQuery(window.location.href);if(e.hasOwnProperty("widgetDomain")){e=b.parseQuery(e.widgetDomain)}f.setValue("isDrivePanelSideBarCollapsed",true);f.setValue("firstlyLoading",true);if(e.hasOwnProperty("token")){f.setValue("token",e.token)}else{f.setValue("token",null)}f.setValue("SCDataMgtBaseUrl","https://"+b.parseUrl(window.location.href).domain.replace("scpres","scdatamgt"));f.setValue("publicTenant",a.getApplicationConfiguration("app.sc.tenant"));f=c(f);f.removeEvent("onToggleDrivePanelSideBarCollapsed");f.setValue("isStandalone",true);return f}return d});define("DS/W3DDrive/widget",["DS/W3DDrive/initWidget","UWA/Class/Events"],function(c,a){var b=a.extend({preferences:{},events:{},getValue:function(d){if(this.preferences[d]!==undefined){return this.preferences[d]}},data:{appId:"fakeAppId"},setTitle:function(){console.log("widget set title does nothing")},getBool:function(d){return this.getValue(d)},setValue:function(d,e){this.preferences[d]=e},hasPreference:function(d){return this.getValue(d)?true:false},addPreference:function(d){if(d.defaultValue==="`false`"){d.defaultValue=false}this.setValue(d.name,d.defaultValue)},setBody:function(d){this.body=d}});return c(b.singleton())});define("DS/W3DDrive/w3DDriveMainView",["UWA/Class/Events","DS/W3DDrive/widget","DS/i3DXCompassServices/i3DXCompassPubSub"],function(c,f,a){var b=c.extend({_targetElement:null,_w3ddriveAppElement:null,_selectedFilesIn3DDrive:[],init:function(g){this._subscribeToCompassEvent();if(g.platformId){f.setValue("x3dPlatformId",g.platformId)}this._parent.apply(this,arguments)},inject:function(g){if(g.targetElement){this._targetElement=g.targetElement}else{throw new Error("A target Element is required in order to be able to know where the 3DDrive app must be injected in the DOM. Please provide this option")}this._render()},_subscribeToCompassEvent:function(){var g=this;a.subscribe("setX3DContent",function(h){g._selectedFilesIn3DDrive=h.data.items.filter(function(i){return i.objectType!=="text/directory"});g.dispatchEvent("onSelectionChange",[g._selectedFilesIn3DDrive])});a.subscribe("resetX3DContent",function(h){g._selectedFilesIn3DDrive=[];g.dispatchEvent("onSelectionChange",[g._selectedFilesIn3DDrive])})},_render:function(){var g=this;if(g._w3ddriveAppElement){f.setBody(g._targetElement);g._targetElement.appendChild(g._w3ddriveAppElement)}else{if(g._targetElement){f.setBody(g._targetElement);f.setValue("firstlyLoading",true);require(["DS/W3DDrive/Utils/Preferences","DS/W3DDrive/widget","DS/W3DDrive/w3DDriveApp"],function(h,i){h.runHistory("DSROOT/content");g._w3ddriveAppElement=i.body.firstChild})}}}}),d=b.singleton(),e=false;b.initInstance=function(g){if(e===false){g=g?g:{};d.init(g);e=true}return d};return b});define("DS/W3DDrive/Utils/RequestHelper",["DS/WAFData/WAFData","UWA/Data","UWA/String","UWA/Services/Auth","DS/W3DDrive/widget","DS/W3DDrive/Metas/errors","DS/W3DContentApp/Utils/Alert","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(h,j,b,f,i,d,g,l){var c=(i.getValue("isStandalone")===true)?true:false;var m=d().xmlhttprequestCodes;var a=d().w3ddrive;var k;var e={_tenant:null,_baseUrl:null,_uuid:i.getValue("3ddrive_uuid"),setTenant:function(n){this._tenant=n},getTenant:function(){return this._tenant},hasTenant:function(){return(this._tenant)?true:false},setBaseUrl:function(n){this._baseUrl=n},getBaseUrl:function(n){var o=n||this._baseUrl;if(this._baseUrl){o=this._baseUrl}var p;if(c){p=b.format("{0}/resources/3ddrive/v1/shared/bos",o)}else{p=b.format("{0}/resources/3ddrive/v1/bos",o)}return p},manageFailure:function(n,q,p,o){if(p&&typeof(p)==="function"){p(n,q,o)}else{switch(n){case m.CONFLICT:g.add({message:l.replace(l.duplicationError,{msg:q.error.message,fileName:q.error.filename}),className:"error"});break;default:g.add({message:l.unexpectedError,className:"error"});break}}},performRequest:function(n,s,q,r,p,t){if(!i.getValue("is3DSpaceWidget")){n+=(n.indexOf("?")!==-1)?"&":"?";n+="lastmodifier="+e._uuid}var o=e.performRequestWithOptions(n,{type:p||"json",method:t||"get",data:r||null,onComplete:s||null,onFailure:function(u,v){e.manageFailure(o.xhr.status,v,q,{xhr:o.xhr})}});return o},performExternalRequestWithOptions:function(o,n){return j.request(o,n)},performRequestWithOptions:function(o,n){var t;if(!n){n={}}if(n.auth&&!(n.auth instanceof f)){if(e.hasTenant()===false&&n.auth){o+=(o.indexOf("?")===-1?"?":"&");o+="tenant="+n.auth.platformId}if(!n.headers){n.headers={}}n.headers["X-DS-CSRFTOKEN"]=k||"";t=n.onComplete;n.onComplete=function(x,w,v){var u=Object.keys(w).filter(function(z,y){return z.search(/x-ds-csrftoken/i)!==-1});k=u.length>0?w[u[0]]:k;if(typeof t==="function"){t(x,w,v)}}}if(!n.type){n.type="json"}var q=null;if(n.onFailure){q=n.onFailure}var p;n.onFailure=function(u,v){e.manageFailure(p.xhr.status,v,q,{xhr:p.xhr})};if(c===true&&o.indexOf("shared")!==-1){o+=(o.indexOf("?")!==-1)?"&":"?";o+="token="+i.getValue("token");o+="&";o+="tenant="+e._tenant}if(!i.getValue("is3DSpaceWidget")){if(n.data){var r;if(typeof n.data==="string"){try{r=JSON.parse(n.data)}catch(s){r={}}r.lastmodifier=e._uuid;n.data=JSON.stringify(r)}else{if(n.data){r=n.data}else{r={}}r.lastmodifier=e._uuid;n.data=r}}else{o+=(o.indexOf("?")!==-1)?"&":"?";o+="lastmodifier="+e._uuid}}p=h.authenticatedRequest(o,n);return p},getRequestMethod:function(o,n){if(n===true||(o.ajax&&o.ajax==e.performExternalRequestWithOptions)){return e.performExternalRequestWithOptions}else{return e.performRequestWithOptions}},addQueryStrings:function(o){if(!o.url){return""}var n=o.url.indexOf("?")>-1?o.url:o.url+"?";var p=o.queryStrings;if(p){Object.keys(p).map(function(q){var s="&"+q;var r=p[q];s+=typeof r==="string"?("="+r):"";if(n[n.length-1]==="?"){s=s.substr(1,s.length)}n+=s})}return n},performTestUrlRequest:function(n){return new Promise(function(q,p){var o={method:"HEAD",onComplete:q,onFailure:p};e.performRequestWithOptions(n,o)})}};return e});define("DS/W3DDrive/Metas/3DSpace/inode",["DS/W3DDrive/Metas/inode","DS/WebappsUtils/WebappsUtils"],function(a,b){return function(){var c=a();Object.assign(c.ids,{files:"files",trueRoot:"trueRootId",collaborativeSpaces:"CollaborativeSpaces",myCollabSpaces:"myCollabSpaces"});Object.assign(c.mimeType,{folder:"application/folder",labeled:"application/labeled"});Object.assign(c.icons,{collabSpace:b.getWebappsAssetUrl("W3DDrive","Collab_Space_icon.png")});Object.assign(c.thumbnails,{collabSpace:b.getWebappsAssetUrl("W3DDrive","Collab_Space_Thumbnail.png"),defaultPeople:b.getWebappsAssetUrl("W3DDrive","default_people.png"),});c.boType={collabSpace:"collaborative Space",team:"Team",leader:"Leader",leaderOwner:"Leader & Owner",folder:"Workspace Vault",document:"Document"};return c}});define("DS/W3DDrive/Metas/DSDrive/inode",["DS/W3DDrive/Metas/inode","UWA/Object","DS/WebappsUtils/WebappsUtils"],function(a,c,b){return function(){var d=a();Object.assign(d.ids,{root:"DSROOT",sharedWithMe:"sharedwithme",trash:"TRASH"});Object.assign(d.mimeType,{folder:"application/folder",labeled:"application/labeled"});Object.assign(d.icons,{trash:b.getWebappsAssetUrl("W3DDrive","trash_22.png")});Object.assign(d.actionPubIds,{giveReadAccess:"giveReadAccess",giveEditAccess:"giveEditAccess",giveShareAccess:"giveShareAccess",shareLink:"share.link"});d.boType={folder:"DriveFolder",document:"DriveFile"};d.constants={maxFileSize:1000000000};return d}});define("DS/W3DDrive/Collections/AuthCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/W3DDrive/Utils/RequestHelper"],function(e,c,b,d){var a;a=b.extend({_prepareModel:function(g,f){f=Object.assign({},f,{});f.auth=this._auth;return this._parent(g,f)},setup:function(g,f){if(f){this._auth=f.auth}},sync:function(h,g,f){f=e.clone(f||{},false);f.ajax=f.ajax||d.getRequestMethod(f);f.auth=this._auth;return this._parent(h,g,f)},createMany:function(i,f){if(!Array.isArray(i)){throw new Error("createMany should be used with an array for attributes param")}var h=this;var g=i.map(function(j){return new c(function(m,l){f=(f||{});var k=Object.assign({},f);k.onComplete=function(n,o){m(n);if(typeof f.onComplete==="function"){f.onComplete(n,o,f)}};k.onFailure=function(n,o){l(n);if(typeof f.onFailure==="function"){f.onFailure(n,o,f)}};h.create(j,k)})});return c.resolve(g)}});return a});define("DS/W3DDrive/Metas/Dropbox/inode",["DS/W3DDrive/Metas/inode"],function(a){return function(){var b=a();Object.assign(b.ids,{root:"root",sharedWithMe:"sharedwithme"});b.constants={timeoutDownloadUrlMs:10800000,maxFileSize:10000000};return b}});define("DS/W3DDrive/Collections/Inodes",["UWA/Core","DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Collections/Pagination"],function(d,a,c){var b;b=a.extend({_sorting:{logic:{attributeName:"title",asc:true}},init:function(g,e){var f;e=e||{};f=e.parentInode;if(!f||!f.id){throw new Error("You must specify a valid parentInode options")}this._parentInode=f;return this._parent.apply(this,arguments)},sort:function(e){var e=e||{};if(e.sorting){this._sorting=e.sorting}return this._parent.apply(this,arguments)},_sortById:function(g,f){var e,h;e=g.get("id");h=f.get("id");return(e>h)?1:-1},_sortByTitle:function(i,g){var h,f;h=i.get("title").toUpperCase();f=g.get("title").toUpperCase();var e=f.localeCompare(h);if(e===0){return this._sortById(i,g)}else{return e}},_sortByCreatedDate:function(h,g){var f,e;f=h.get("createdDate");e=g.get("createdDate");if(f===e){return this._sortByTitle(h,g)}else{return(f>=e)?-1:1}},_sortByModifiedDate:function(h,g){var f,e;f=h.get("modifiedDate");e=g.get("modifiedDate");if(f===e){return this._sortByTitle(h,g)}else{return(f>=e)?-1:1}},_sortByAttrName:function(){var e;switch(this._sorting.logic.attributeName){case"title":e=this._sortByTitle;break;case"createdDate":e=this._sortByCreatedDate;break;case"modifiedDate":e=this._sortByModifiedDate;break;default:return}e=e.apply(this,arguments);return this._sorting.logic.asc?-e:e},getInode:function(e){if(this.get(e)){return this.get(e)}else{this.map(function(g){if(g.inodeTable){var f=g.inodeTable.getInode(e);if(f){return f}}})}return null},comparator:function(h,g){var e,f;e=h.isContainer();f=g.isContainer();if(e&&!f){return -1}if(!e&&f){return 1}return this._sortByAttrName.apply(this,arguments)},filterFiles:function(){return this.filter(function(e){return e.isContainer()})},});b=c(b);return b});define("DS/W3DDrive/Metas/GoogleDrive/inode",["DS/W3DDrive/Metas/inode"],function(a){return function(){var b=a();Object.assign(b.mimeType,{folder:"application/vnd.google-apps.folder"});Object.assign(b.ids,{root:"root",sharedWithMe:"sharedwithme"});b.constants={maxFileSize:10000000};return b}});define("DS/W3DDrive/Actions/Share/shareFactory",["UWA/Core","UWA/String","UWA/Promise","UWA/Class/View","DS/UIKIT/Badge","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Accordion","DS/UIKIT/Toggler","DS/UIKIT/Input/Text","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/W3DContentApp/Utils/Helpers","DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Actions/Share/CollabSpaces/shareCSHelper","DS/W3DDrive/Utils/RequestHelper","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css"],function(s,Z,F,W,w,c,Q,O,p,X,t,z,E,J,T,A,D,n){return{bindViewToModal:R,closeShareModal:S,convertCategoriesToSharingRole:f,createAccordion:I,createButton:C,createButtonGroup:G,createCheckboxWithContent:b,createCheckInput:y,createGroupInvitationView:i,createInvitationView:r,createMessageDocFrag:V,createPlatformInvitationView:g,createReshareElem:U,createTabItem:m,createTagsTextInput:j,createTextArea:x,createTextBlock:k,createTextInput:e,createTextInputWithButton:a,createToggler:q,createToggleSwitch:l,emptyModalFooter:M,hideModalFooter:B,getInputCategories:h,getModalFooterButtons:H,getModalTitle:K,getShareModalTitle:P,makeElement:u,onEmailAddress:Y,showModalFooter:aa,createCheckboxAndContent:o};function S(){var ab=J.modals.current;ab.hide()}function aa(){var ab=J.modals.current;if(!ab){return}var ac=ab.getFooter();ac.show()}function B(){var ab=J.modals.current;if(!ab){return}var ac=ab.getFooter();ac.hide()}function M(){var ab=J.modals.current;if(!ab){return}var ac=ab.getFooter();ac.empty()}function H(ad){var af=ad||{};var ac=af.buttonClass;var ae=J.modals.current;if(!ae){return[]}var ag=ae.getFooter();if(!ag){return[]}var ab=typeof ac==="string"?"button."+ac:"button";return[].slice.call(ag.querySelectorAll(ab))}function u(ab){var af=ab||{};var ae=af.element||"div";if(typeof af==="string"){ae=af}var ad=af.classes||[];var ag=document.createElement(ae);if(typeof ad==="string"){ag.classList.add(ad);return ag}for(var ac=0;ac<ad.length;ac+=1){ag.classList.add(ad[ac])}return ag}function G(ab){return new O(Object.assign({},{buttons:ab.buttons},ab))}function P(ab){return(ab.title||n.share)}function C(ab){return new Q(Object.assign({},ab))}function f(ac,ae){var ad=ae||"reader";var ab;if(!ac){return ae}ac=[].concat(ac);if(ac.indexOf("giveReadAccess")!==-1){ad="reader"}if(ac.indexOf("giveEditAccess")!==-1){ad="writer"}if(ac.indexOf("Reader")!==-1){ad="Reader"}if(ac.indexOf("PublicReader")!==-1){ad="PublicReader"}if(ac.indexOf("Contributor")!==-1){ad="Contributor"}if(ac.indexOf("Author")!==-1){ad="Author"}if(ac.indexOf("Leader")!==-1){ad="Leader"}if(ac.indexOf("Readerrestricted")!==-1){ad="Reader";ab=true}if(ac.indexOf("Contributorrestricted")!==-1){ad="Contributor";ab=true}if(ac.indexOf("Authorrestricted")!==-1){ad="Author";ab=true}if(ac.indexOf("Leaderrestricted")!==-1){ad="Leader";ab=true}if(ac.indexOf("giveShareAccess")!==-1){ad+="Sharer"}return{role:ad,restricted:ab}}function h(ad,ab,ac){if(ac===true){return T(ad,ab).inputCategories}return["giveReadAccess","giveEditAccess"].filter(function(ae){return(ad.indexOf(ae)!==-1)}).map(function(af){var ae;switch(af){case"giveReadAccess":ae="can_view";break;case"giveEditAccess":ae="can_edit";break;case"Reader":ae="readercs";break;case"PublicReader":ae="publicreader";break;case"Contributor":ae="makeContributor";break;case"Author":ae="makeAuthor";break;case"Leader":ae="leader";break}return{id:af,name:n[ae]}})}function r(aj,ad){if(!Array.isArray(aj)){throw new Error("You should provide a categories array input")}var ai;var aq=[],ag=[];var ar,ao,al,at;var ab,av,an,ak,au,ap,ah;for(var am=0;am<aj.length;am++){if(aj[am].id.contains("restricted")){aq.push(aj[am])}else{ag.push(aj[am])}}if(ad&&ad.inode&&ad.inode.get("actions").indexOf("add.members.restricted")!==-1){ag=aq}ab={categories:ag,suggestFormat:"{fname} {lname}",suggestKey:"login",labelFormat:"{fname} {lname}",placeholder:"",typeDelay:500,minLength:2,getSuggestions:af,saveProcess:ae};an=new z(Object.assign(ab,ad));an.elements.buttons.classList.add("shareview__footer");ar=an.render;ao=an.destroy;au=Object.assign(an,{render:function(){var aw=ar.apply(an,arguments);var ax=an.container.querySelector("input.temp-autocomplete-input");if(ax){ax.focus()}an.show();return aw},destroy:function(){if(typeof ai==="function"){ai()}return ao.apply(this,arguments)}});if(ad&&ad.inode&&ad.inode.get("actions").indexOf("add.members.restricted")===-1&&aq.length>1){av={categories:aq,suggestFormat:"{fname} {lname}",suggestKey:"login",labelFormat:"{fname} {lname}",placeholder:"",typeDelay:500,minLength:2,getSuggestions:af,saveProcess:ae};ak=new z(Object.assign(av,ad));ak.elements.buttons.classList.add("shareview__footer");al=ak.render;at=ak.destroy;ap=Object.assign(ak,{renderRestrictedRoles:function(){var aw=al.apply(ak,arguments);var ax=ak.container.querySelector("input.temp-autocomplete-input");if(ax){ax.focus()}ak.show();return aw},destroyRestrictedRoles:function(){if(typeof ai==="function"){ai()}return at.apply(this,arguments)}});ah=[au,ap]}else{ah=au}return ah;function ac(ax){var aw=ax.item;var ay=aw.email;if(!ay&&Z.isEmail(ax.selection)){ay=ax.selection}return{displayName:(aw.name||ay),emailAddress:ay,fname:aw.fname,pid:aw.id,lname:aw.lname,personID:ax.selection,picture:aw.picture,role:f([ax.categoryId]).role,isRestricted:f([ax.categoryId]).restricted}}function ae(aw){return aw.map(ac)}function af(ay,aw,ax){ai=function(){Object.keys(aw).map(function(az){delete aw[az]})};if(!ay){return}if(aw[ay]){return ax(aw[ay])}if(Z.isEmail(ay)){return ax([{login:ay,fname:ay,lname:"",email:ay,role:null}])}return ax([])}}function Y(ab){return{login:ab,fname:ab,lname:"",email:ab,role:null}}function g(ac,ad,am){var ab=Object.assign({},am,{getSuggestions:af});var ak;var al=(function ae(){var an;return function(ap){if(an){an.cancel();an=null}var ao=Z.format("{0}/resources/3ddrive/v1/peoples?filter={1}&limit=10",ac,encodeURIComponent(ap));return new F(function(ar,aq){an=A.performRequestWithOptions(ao,{type:"json",onComplete:ar,onFailure:aq})})}})();var ah=r(h(ad),ab);var ag=ah.container.querySelector("button.btn-primary");ag.classList.add(am.viewClass);var aj=ah.container.querySelector("button.btn-default");aj.classList.add(am.viewClass);ag.textContent=(am.validateButtonText)?am.validateButtonText:n.share;var ai=ah.destroy;ah.destroy=function(){if(typeof ak==="function"){ak()}return ai.apply(this,arguments)};return ah;function af(ap,an,ao){ak=function(){Object.keys(an).map(function(aq){delete an[aq]})};if(!ap){return}if(an[ap]){return ao(an[ap])}al(ap).then(ao,function(){})}}function i(ac,ad,ao){var ab=Object.assign({},ao,{suggestFormat:"{label}",suggestKey:"resourceid",labelFormat:"{label}",getSuggestions:af,saveProcess:aj});var am;var an=(function ae(){var ap;return function(aA){if(ap){ap.cancel();ap=null}var ar=ao.inode;var az=ar._auth.platformId;var at=ar.drive.get("user").id;var av=Date.now();var aw;var au;if(ao.is3DSpace){aw="3DSpace-"}else{aw="3DDrive-"}var ax=aw.concat(at,"-",av);ac=ar._auth.platform.urls3DSearch;var aq=Z.format("{0}/search",ac);if(ar.drive.id==="OnPremise"){au=JSON.stringify({query:aA+"*",source:["3dspace"],label:ax,nresults:8,refine:{"ds6w:what/ds6w:type":[{object:"Group",type:"string",field:["implicit"]}]},select_predicate:["groupuri","ds6w:label","ds6w:type"],locale:D.lang})}else{au=JSON.stringify({query:'[ds6w:type]:"foaf:Group" AND [ds6w:label]:('+aA.trim()+"*)",source:["usersgroup"],order_by:"desc",order_field:"relevance",select_predicate:["ds6w:label","resourceid"],nresults:8,tenant:az,label:ax,locale:D.lang})}var ay=function(aD,aC){var aB=[];if(aD.hasOwnProperty("results")){aD.results.map(function(aE){var aF={};if(aE.hasOwnProperty("attributes")){aE.attributes.map(function(aG){if(aG.hasOwnProperty("format")&&aG.hasOwnProperty("name")&&aG.hasOwnProperty("value")){if(aG.name.indexOf("ds6w:")!==-1){aG.name=aG.name.split("ds6w:")[aG.name.split("ds6w:").length-1]}if(ao.is3DSpace){if(aG.name.toLowerCase()==="groupuri"){aF.resourceid=aG.value}}aF[aG.name]=aG.value}})}aB.push(aF)})}aC(aB)};return new F(function(aC,aB){ap=A.performRequestWithOptions(aq,{type:"json",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},auth:ar._auth,data:au,onComplete:function(aD){ay(aD,aC)},onFailure:aB})})}})();var ai=r(h(ad,ao.inode.drive,ao.is3DSpace),ab);var ah,al,ak;if(ai.length>1){ai.map(function(ap){ah=ap.container.querySelector("button.btn-primary");ah.classList.add(ao.viewClass);al=ap.container.querySelector("button.btn-default");al.classList.add(ao.viewClass);if(ao.validateButtonText){ah.textContent=(ao.validateButtonText)?ao.validateButtonText:n.share}})}else{ah=ai.container.querySelector("button.btn-primary");ah.classList.add(ao.viewClass);al=ai.container.querySelector("button.btn-default");al.classList.add(ao.viewClass);if(ao.validateButtonText){ah.textContent=(ao.validateButtonText)?ao.validateButtonText:n.share}ak=ai.destroy;ai.destroy=function(){if(typeof am==="function"){am()}return ak.apply(this,arguments)}}return ai;function af(ar,ap,aq){am=function(){Object.keys(ap).map(function(at){delete ap[at]})};if(!ar){return}if(ap[ar]){return aq(ap[ar])}an(ar).then(aq,function(){})}function aj(ap){return ap.map(ag)}function ag(au){var ap=au.item;var at=ap.resourceid;var aq=ap.label;var ar={uri:ap.resourceid,title:ap.label,isGroup:true,accessright:f([au.categoryId]).role,isRestricted:f([au.categoryId]).restricted};return ar}}function R(ad,ab){ab=ab||{};var ac=J.modals.current;return ac}function K(ab){return n.replace(n.shareElem,{type:n[ab.isFolder()?"folder":"file"],name:ab.get("title")})}function q(ac){if(ac.buttons.length<=1){return u({element:"div"})}var ab=u({element:"div",classes:[ac.classes,"tab"]});for(var ad=0;ad<ac.buttons.length;ad+=1){ab.appendChild(ac.buttons[ad])}var ae=new X({container:ab,type:ac.type});return ab}function m(ab){var ae=u({element:"a",classes:[ab.classes,"tab-item"]});var ac=document.createTextNode(ab.value);var ad=u({element:"span",classes:["fonticon",ab.icon]});ae.appendChild(ad);ae.appendChild(ac);return ae}function U(ad){var ae=ad.className?ad.className:[];var ag=ad.id?ad.id:"checkbox-share";var af=u({element:"div",classes:["toggle","toggle-root","toggle-primary"].concat(ae)});var ab=u({element:"input",classes:"js_share-inode_reshare"});ab.type="checkbox";ab.value="reshare";ab.id=ag;var ac=u({element:"label",classes:"control-label"});ac.setAttribute("for",ag);ac.textContent=n.allowReshare;return[ab,ac].reduce(function(ah,ai){ah.appendChild(ai);return ah},af)}function V(){var ab=u({element:"span",classes:"js-share-inode_message-label"});ab.textContent=(n.addMessage+" (0/100 "+n.characters+")");var ac=u({element:"textarea",classes:["form-control","form-control-root","js-share-inode_message"]});ac.placeholder=n.shareMessage;ac.setAttribute("maxlength",100);return[ab,ac].reduce(function(ad,ae){ad.appendChild(ae);return ad},document.createDocumentFragment())}function x(){return new W({domEvents:{"keyup .js-share-inode_message":function(ac){var ab=ac.target;var ad=ab.previousSibling;ad.textContent=n.addMessage+" ("+ab.value.length+"/100 "+n.characters+")"}}})}function k(ab){var ad=Object.assign({},ab);var ac=ad.css;var af=ad.text||"";var ae=u(ad);ae.innerHTML=af;if(ac){Object.keys(ac).map(function(ag){ae.style[ag]=ac[ag]})}return ae}function y(ae){var ab=u({element:"div",classes:["toggle"]});var ac=u({element:"input"});var ad=u({element:"label",classes:"control-label"});ac.type="checkbox";ad.innerHTML=ae.label;ab.appendChild(ac);ab.appendChild(ad);return ab}function l(ab){return L(Object.assign({},{type:"switch"},ab))}function L(ab){return new c(ab)}function a(ae){var ab=u({element:"div",classes:"input-group"});var ac=u({element:"input",classes:"form-control"});var ah=Object.assign({},ae);var ag=ah.css;ac.type="text";var ad=u({element:"span",classes:"input-group-btn"});var af=u({element:"button",classes:["btn","btn-default","input__button"]});af.innerHTML=ah.buttonContent||"";ad.appendChild(af);ab.appendChild(ac);ab.appendChild(ad);if(ah.readonly){ac.readOnly=true}if(ag){Object.keys(ag).map(function(ai){ab.style[ai]=ag[ai]})}return ab}function I(ab){return new p(ab)}function e(ab){return new t(ab)}function j(ab){var ad=Object.assign({},ab);var aj=u();var an=u({classes:"tags__input__errormessage"});var am="limitExceeded";var ae="limitOk";var aq="duplicatedTag";var ar=ad.existingPermissionsLink;var ak=ad.initialTagsCount;var ai=new t(ad.inputOptions);var at=ad.maxTagsLimit;var al=/(\s+|,|;)/i;var ao=u({classes:"tags__container"});var af=u({classes:"tags__remaining"});af.textContent=n.replace(n.restrictionsCount,{count:ak,max:at});an.textContent=n.restrictedEmailsNumberLimitExceeded;ai.elements.container.addEventListener("keyup",function(av){var aw=ai.getValue();if(al.test(aw)){aw=aw.trim().substr(0,aw.length-1)}else{if(av.keyCode!==13){return}}if(Z.isEmail(aw)){ac(aw);ai.setValue("");return}else{if(aw.length>0){return}}v({element:aj,eventName:"submit"})});ai.elements.container.addEventListener("drop",function(aw){aw.preventDefault();var ax=aw.dataTransfer.getData("text");var av=ax.split(";");av.map(function(ay){if(Z.isEmail(ay)){ac(ay)}})});[ao,ai,af,an].reduce(d,aj);aj.updateTagsLimit=function(av){ak=av};return aj;function ac(aw){var ay=au(aw);if(ay){v({element:aj,eventName:aq,eventOptions:{duplicatedTag:aw}});return}var ax=new w({content:aw,selectable:true,closable:true,events:{onClose:function(){ao.removeChild(ax.elements.container);var az=ap();ah();v({element:aj,eventName:az?am:ae})}}});ao.appendChild(ax.elements.container);var av=ap();ah();v({element:aj,eventName:av?am:ae})}function ap(){var aw=Array.prototype.slice.call(ao.childNodes);var av=(aw.length+ak)>at;if(av){ag(true);return true}ag(false);return false}function ah(){var av=Array.prototype.slice.call(ao.childNodes);var aw=ak+av.length;af.textContent=n.replace(n.restrictionsCount,{count:aw,max:at})}function ag(av){if(av){an.classList.add("tags__input__errormessage--visible");return}an.classList.remove("tags__input__errormessage--visible")}function au(aw){var av=ar.some(function(ay){return ay.get("emailAddress")===aw});if(av){return true}var ax=Array.prototype.slice.call(ao.childNodes).some(function(ay){return ay.textContent===aw});return av||ax}}function v(ac){var ae;var ad=ac.element;var ab=ac.eventName;if(document.createEvent){ae=document.createEvent("Event");ae.initEvent(ab,true,true)}else{ae=new Event(ab)}Object.assign(ae,ac.eventOptions);ad.dispatchEvent(ae)}function o(ad){var ac=u();var ae=ad.normalView;var ag=ad.restrictedView;var af=ad.checkboxOptions;var ab=new c(Object.assign({events:{onChange:function(){if(ab.isChecked()){ae.hide();ag.show()}else{ag.hide();ae.show()}}}},af));[ab,ag,ae].reduce(d,ac);return ac}function b(ad){var ac=u();var ae=ad.content;ae.classList.add(ad.hiddenClass);var af=ad.checkboxOptions;var ab=new c(Object.assign({events:{onChange:function(){if(ab.isChecked()){N({element:ae,show:true,visibleClass:ad.visibleClass,hiddenClass:ad.hiddenClass})}else{N({element:ae,hide:true,hiddenClass:ad.hiddenClass,visibleClass:ad.visibleClass})}}}},af));[ab,ae].reduce(d,ac);return ac}function N(ab){if(typeof ab!=="object"){throw"Please provide an object for the toggleElementVisibility function."}var ac=ab.element;if(typeof ac==="undefined"){throw"Please provide an element to hide to the toggleElementVisibility function."}ac=ac.nodeName?ac:ac.getContent();if(ab.show){ac.classList.remove(ab.hiddenClass);ac.classList.add(ab.visibleClass);return}if(ab.hide){ac.classList.add(ab.hiddenClass);ac.classList.remove(ab.visibleClass);return}ac.classList.toggle(ab.hiddenClass);ac.classList.toggle(ab.visibleClass)}function d(ab,ac){if(!ac.nodeName){ac=ac.getContent()}ab.appendChild(ac);return ab}});define("DS/W3DDrive/scheduleTasksToGlobalSession",["DS/W3DDrive/Actions/createTasksSession"],function(a){return a(6)});define("DS/W3DDrive/Utils/IntegrationHelper",["DS/W3DDrive/widget","DS/W3DDrive/Metas/DSDrive/inode"],function(e,b){var d=b(),a={};if(window.parent.swxDriveService){a.SWIntegration=window.parent.swxDriveService}var c=e.getValue("addinmode");if(c==="catiav5"){a.CATIAV5=true}else{if(c==="solidworks"){a.SW=true}}if(a.SWIntegration){a.SWCheckShared=function(g){var f=g;while(f&&f.collection){f=f.collection.dot();if(f.id===d.ids.sharedWithMe){return true}}return false}}return a});define("DS/W3DDrive/Actions/drivesInputs",["DS/W3DDrive/Metas/drive","DS/W3DDrive/Metas/inode","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,a,c){return function(j){if(!j){return{}}var i=b(),d=a(),h={forbiddenChars:{},maxchars:{},maxcharsDesc:{}},e=h.maxchars,g=h.maxcharsDesc,f=h.forbiddenChars;switch(j.drive.id){case i.ids.google2:f.regex="(.)*";f.text=c.requiredField;break;case i.ids.dropbox:e.maxLength=255;f.regex='^((?!<)(?!>)(?!/)(?!\\\\)(?!:)(?!\\?)(?!\\*)(?!")(?!\\|).)*$';f.text=c.replace(c.forbiddenChars,{chars:'< > / \\ : * | ? "'});if(j.get("mimeType")!==d.mimeType.folder){e.maxLengthText=c.replace(c.fileMaxLength,{length:"255"})}else{e.maxLengthText=c.replace(c.folderMaxLength,{length:"255"})}break;default:if(j.id==="myCollabSpaces"||j.get("parentId")==="myCollabSpaces"){e.maxLength=32;g.maxLength=255;f.regex="([\x20,\x21,\x26,\x28,\x29,\x2B,\x2D,\x30-\x39,\x3B,\x3D,\x41-\x5A,\x5E-\x7B,\x7D-\x7F])+";f.text=c.forbiddenCharsCS;e.maxLengthText=c.replace(c.CSMaxLength,{length:e.maxLength})}else{if(j.get("mimeType")!==d.mimeType.folder){e.maxLength=255;f.regex='^((?!<)(?!>)(?!/)(?!\\\\)(?!:)(?!\\?)(?!\\*)(?!")(?!\\|)(?!@).)*$';f.text=c.replace(c.forbiddenChars,{chars:'< > / \\ : * | ? " @'});f.notEmpty=c.notEmpty;e.maxLengthText=c.replace(c.fileMaxLength,{length:e.maxLength})}else{e.maxLength=255;f.regex='^((?!<)(?!>)(?!/)(?!\\\\)(?!:)(?!\\?)(?!\\*)(?!")(?!\\|).)*$';f.text=c.replace(c.forbiddenChars,{chars:'< > / \\ : * | ? "'});e.maxLengthText=c.replace(c.folderMaxLength,{length:e.maxLength})}}break}return h}});define("DS/W3DDrive/Utils/Platform",["UWA/Class/Promise","DS/W3DDrive/widget","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(d,c,e){function b(f){if(f){return f.filter(function(g){if(c.getValue("is3DSpaceWidget")==="true"){return g["3DSpace"]}else{return g["3DDrive"]}}).map(function(h){if(h){var g={id:h.platformId,displayName:h.displayName,url:h["3DDrive"],urlSwym:h["3DSwym"],url3DSpace:h["3DSpace"],urlUsersGroup:h.usersgroup,urls3DSearch:h["3DSearch"],urlDrivesHub:h.driveshub};return g}})}}var a={_platforms:[],getAllPlatforms:function(){var f=this;return new d(function(h,g){if(f._platforms.length>0){return h(f._platforms)}e.getPlatformServices({onComplete:function(i){f._platforms=b(i);h(f._platforms)},onFailure:g})})}};return a});define("DS/W3DDrive/Utils/Metrics",["DS/W3DDrive/Metas/inode","DS/Usage/TrackerAPI","DS/W3DDrive/widget"],function(b,g,f){return{incActionTracker:a,triggerEventTracker:c,trackNavigation:d};function a(s){var l=Object.assign({},s);var o=l.model;var q=l.actionName;var j=l.context;var m=f.data.appId;var k=(m==="X3DCSMA_AP")?"3DSpace":"3DDrive";var r=b();var h=k+"-"+q+"-";var i=q;var p;if(m==="X3DCSMA_AP"){p=(o.get("mimeType")===r.mimeType.collabSpace)?"collabspace":"content"}else{p=(o.get("mimeType")===r.mimeType.folder)?"folder":"file"}h+=p;i+=" "+p;if(j){h+="-"+j+"view";i+=" from "+j}var n=g.getCounter(h,{label:i,appID:m,tenant:o.drive.id});return n}function c(z){var h=b();var k=z.model;var x=f.data.is3DSpaceWidget?"X3DCSMA_AP":f.data.appId;var t=f.data.x3dPlatformId;var i={appID:x,tenant:t};var q=z.eventAction;var r=z.eventValue;var m=k.drive.get("title");var p=z.context?(z.context).replace("-view",""):"";var o="";var u=k.get("fileExtension");var v=k.get("id")==="myCollabSpaces"||k.get("id")==="DSROOT";var s;if(x==="X3DCSMA_AP"){s=(k.get("mimeType")===h.mimeType.collabSpace||v)?"collabspace":"content"}else{s=(k.get("mimeType")===h.mimeType.folder)?"folder":"file"}var w=(x==="X3DCSMA_AP")?(k.get("mimeType")===h.mimeType.collabSpace||v)?"collabspace":k.get("type").value:(k.get("mimeType")===h.mimeType.folder)?"folder":"file";var n="";var j={pd1:m,pd2:p,pd3:o,pd4:u,pd6:w};var l=Object.assign(j,z.dimensions);e(l);var y=g.trackPageEvent(s,q,n,r,l,i);return y}function e(h){for(var i in h){if(h[i]===""||h[i]===null||h[i]===undefined){delete h[i];continue}h[i]=h[i].toString()}}function d(m){var l=f.data.appId;var n=f.data.x3dPlatformId;var q={appID:l,tenant:n};var p=(l==="X3DCSMA_AP")?"3dspace.navigation":"3ddrive.navigation";var k=m.eventAction;var i="";var j=m.eventValue;var h={};var o=g.trackPageEvent(p,k,i,j,h,q);return o}});define("DS/W3DDrive/Metas/DrivesHub/inode",["DS/W3DDrive/Metas/inode","UWA/Object"],function(a,b){return function(){var c=a();c.ids=Object.assign({},c.ids,{root:"root",sharedWithMe:"sharedwithme"});c.mimeType=Object.assign({},c.mimeType,{folder:"drivehub/folder",file:"drivehub/file"});c.boType={folder:"DriveFolder",document:"DriveFile"};return c}});define("DS/W3DDrive/Metas/DSDrive/permission",["DS/W3DDrive/Metas/permission"],function(a){return function(){var f=a(),e="delegate",d="read",g="edit",b="read_share",c="edit_share";f.roles={reader:d,writer:g,delegate:e,readershare:b,writershare:c};f.roleToFrontend=function(h){switch(h){case f.roles.reader:return"reader";case f.roles.writer:return"writer";case e:return"delegate";case b:return"readerSharer";case c:return"writerSharer";default:return""}};return f}});define("DS/W3DDrive/Utils/contextHelpers",["UWA/Utils/Client","DS/W3DDrive/Metas/inode","DS/W3DDrive/Utils/IntegrationHelper"],function(e,b,d){var c={};var a=b();c={contexts:{iOSContext:{id:"iOSContext",isActive:(function(){if(e.Platform.hasOwnProperty("ios")&&e.Platform.ios===true){return true}else{return false}})()},CATIAV5:{id:"CATIAV5",isActive:(function(){if(d.CATIAV5){return true}else{return false}})()}}};c.actionsFilters=(function(){var h={};var f={iOSFilter:{context:c.contexts.iOSContext.id,forbiddenActions:[a.actionPubIds.download,a.actionPubIds.downloadVersion],filter:function(j){if(typeof j==="object"){j=j.id}if(this.forbiddenActions.indexOf(j)!==-1){return false}else{return true}}},CATIAV5Filter:{context:c.contexts.CATIAV5.id,forbiddenActions:[a.actionPubIds.preview],filter:function(j){if(typeof j==="object"){j=j.id}if(this.forbiddenActions.indexOf(j)!==-1){return false}else{return true}}}};var g=function(){var j=[];Object.keys(c.contexts).map(function(k){if((typeof c.contexts[k].isActive==="function"&&c.contexts[k].isActive()===true)||(typeof c.contexts[k].isActive==="boolean"&&c.contexts[k].isActive===true)){j.push(c.contexts[k].id)}});return j};var i=function(j,k){return k.filter(function(l){return j.filter(l)})};h.apply=function(j,k){if(f.hasOwnProperty(j)){return i(f[filerName],k)}else{return false}};h.applyContext=function(l,k){var j=this;Object.keys(f).map(function(m){if(f[m].context===l){k=i(f[m],k)}});return k};h.applyCurrentContexts=function(k){var j=this;var l=g();Object.keys(f).map(function(m){if(l.indexOf(f[m].context)!==-1){k=i(f[m],k)}});return k};return h})();return c});define("DS/W3DDrive/Utils/drive",["UWA/Services/Auth","UWA/Utils","DS/W3DDrive/Metas/drive","DS/W3DDrive/Utils/AuthAdapter"],function(a,d,c,b){var f=c();function e(h){var g,i;if(!h){return}g=h.id;if(g===undefined||g===null){return}i=h.scope;return new a({adapter:new b(),adapterOptions:{provider:g,data:{scope:i}}})}return function(){return{auths:{dropbox:e({id:f.ids.dropbox}),google2:e({id:f.ids.google2,scope:"https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.file"})}}}});define("DS/W3DDrive/Utils/DSAuth",["UWA/Class","UWA/Data","DS/W3DDrive/Utils/Platform","UWA/Services/Auth","DS/W3DDrive/Utils/RequestHelper"],function(g,e,a,b,f){var d;var c=g.extend({init:function(i,h){if(h&&h.id!==i){throw new Error("Invalid id in DSAuth")}this.platform=h;this.platformId=i},getStorage:function(){return this.platform},getSwymService:function(){if(this.platform){return this.platform.urlSwym}},get3DEBBOMService:function(){if(this.platform){return this.platform.url3DEBOM}},getCSRF:function(){return this.csrf},setCSRF:function(h){this.csrf=h},clearIdentity:function(i,h){this.platform=undefined;return i()},hasIdentity:function(j,h){if(this.platform){return j()}var i=this;a.getAllPlatforms().then(function(k){k.map(function(l){if(l.id===i.platformId){i.platform=l}});j()})["catch"](h)},authenticate:function(i,h){this.hasIdentity.apply(this,arguments)}});return c});define("DS/W3DDrive/Metas/actions",["DS/W3DDrive/Metas/inode","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,d){var a=b();var c=[{id:a.actionPubIds.preview,text:d.preview,icon:"eye",fonticon:"eye"},{id:a.actionPubIds.share,text:d.share,icon:"user-add",fonticon:"user-add"},{id:a.actionPubIds.shareContent,text:d.share,icon:"share-alt",fonticon:"share-alt"},{id:a.actionPubIds.moveTo,text:d.moveTo,icon:"login",fonticon:"login"},{id:a.actionPubIds.copy,text:d.copyTo,icon:"docs",fonticon:"docs"},{id:a.actionPubIds.edit,text:d.edit,icon:"pencil",fonticon:"pencil"},{id:a.actionPubIds.createFolder,text:d.newFolder,icon:"folder",fonticon:"folder"},{id:a.actionPubIds.createLabel,text:d.newCollection,icon:"book",fonticon:"book"},{id:a.actionPubIds.upload,text:d.uploadFile,icon:"upload",fonticon:"upload"},{id:a.actionPubIds.download,text:d.download,icon:"download",fonticon:"download"},{id:a.actionPubIds.openWith,text:a.actionPubIds.openWith,icon:"export",fonticon:"export"},{id:a.actionPubIds.insert,text:d.insert,icon:"import",fonticon:"import"},{id:a.actionPubIds.update,text:d.toUpdate,icon:"upload",fonticon:"upload"},{id:a.actionPubIds.createCollabSpace,text:d.newCollabSpace,icon:"folder",fonticon:"folder"},{id:a.actionPubIds.addContent,text:d.addContent,icon:"upload",fonticon:"upload"},{id:a.actionPubIds.addMember,text:d.addMember,icon:"user-add",fonticon:"user-add"},{id:a.actionPubIds.addMemberRestricted,text:d.addMember,icon:"user-add",fonticon:"user-add"},{id:a.actionPubIds.editCS,text:d.editCS,icon:"pencil",fonticon:"pencil"},{id:a.actionPubIds.changeThumbnail,text:d.changeThumbnail,icon:"picture",fonticon:"picture"},{id:a.actionPubIds.del,text:d.deleteText,icon:"trash",fonticon:"trash"},{id:a.actionPubIds.moveToCS,text:d.moveTo,icon:"login",fonticon:"login"},{id:a.actionPubIds.editContent,text:d.editContent,icon:"pencil",fonticon:"pencil"},{id:a.actionPubIds.downloadVersion,text:d.download,icon:"download",fonticon:"download"},{id:a.actionPubIds.restoreVersion,text:d.restore,icon:"rotate-ccw",fonticon:"rotate-ccw "},{id:a.actionPubIds.restore,text:d.restore,icon:"rotate-ccw",fonticon:"rotate-ccw "},{id:a.actionPubIds.addToMyDrive,text:d.addToMyDrive,icon:"drive",fonticon:"drive"},{id:a.actionPubIds.changeAlias,text:d.rename,icon:"pencil",fonticon:"pencil"},{id:a.actionPubIds.removeFromMyDrive,text:d.remove,icon:"cancel",fonticon:"cancel"}];c.map(function(e){return Object.freeze(e)});return function(){return c.slice()}});define("DS/W3DDrive/Actions/Share/DSDrive/shareToSwymService",["UWA/String","DS/W3DDrive/Utils/RequestHelper","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,d,f,g,i){return function(k){var j=k[0];return c(j).then(function(l){return l})};function c(j){return new Promise(function(m,l){var n;var p;var k;var o;require(["DS/SwymPublishForm/script/publish-form-view"],function(q){var r=new q({title:"",description:"",contentTitle:j._attributes.title,contentDescription:"",mode:"jsevent",platformId:j._auth.getSwymService()});r.addEvent("CancelShare",function(s){e()},false);r.addEvent("StartUpload",function(s){var t=b.format("{0}/resources/3ddrive/v1/bos/{1}/publish",j._auth.platform.url,j._attributes.id);var v=JSON.parse(s);p=v.platform_instance;k=v.community_id;var u=v.content_type==="media"?"false":"true";d.performRequestWithOptions(t,{url:t,auth:j._auth,timeout:15000,method:"POST",data:JSON.stringify({platformid:p,communityid:k,isillustration:u,isDownloadable:"true",selectanswer:"mediaid"}),type:"json",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},proxy:"passport",onComplete:function(y){n=y.mediaid;var x=y.errorID;if(typeof x!=="undefined"){var w=i.get(x);if(w&&w!==x&&w.search("{tagName}")!==-1){w=i.replace(w,{tagName:j._attributes.title})}else{w=i.shareSwymError}h({message:w});return}if(typeof n==="undefined"){h({message:i.shareSwymErrorUpload});return}r.createContent(n)},onFailure:function(w){h({message:i.shareSwymError})}})},false);r.addEvent("ContentCreated",function(){a({platformId:p,communityId:k,mediaId:n,model:j})},false);r.render();m(r.getContent())})})}function e(){var j=g.modals.current;if(!j){return}j.hide()}function a(k){var n=k.platformId;var l=k.communityId;var m=k.mediaId;var j=k.model;f.addWithLink({message:"",className:"success"},{message:j._attributes.title,url:n+"/#community:"+l+"/media:"+m,help:i.shareSwymSuccess});e()}function h(j){f.add({message:j.message,className:"error"});e()}});define("DS/W3DDrive/Actions/Share/CollabSpaces/shareCS",["UWA/Class/View","UWA/String","UWA/Promise","DS/W3DDrive/Utils/RequestHelper","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Actions/Share/CollabSpaces/shareCSHelper","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/W3DDrive/Metas/3DSpace/inode","DS/UIKIT/Input/Toggle","DS/W3DDrive/Actions/Share/shareFactory","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(t,a,c,k,r,f,i,d,h,n,u,g){var o;var h=h();function s(v,x){var x=x||"Contributor";var w;if(!v){return x}v=[].concat(v);if(v.indexOf("PublicReader")!==-1){x="PublicReader"}if(v.indexOf("Reader")!==-1){x="Reader"}if(v.indexOf("Contributor")!==-1){x="Contributor"}if(v.indexOf("Author")!==-1){x="Author"}if(v.indexOf("Leader")!==-1){x="Leader"}if(v.indexOf("Readerrestricted")!==-1){x="Reader";w=true}if(v.indexOf("Contributorrestricted")!==-1){x="Contributor";w=true}if(v.indexOf("Authorrestricted")!==-1){x="Author";w=true}if(v.indexOf("Leaderrestricted")!==-1){x="Leader";w=true}return[x,w]}function l(w){var v;if(w==="PublicReader"){v=g.publicreader}else{if(w==="Reader"){v=g.readercs}else{if(w==="Contributor"){v=g.contributor}else{if(w==="Author"){v=g.author}else{if(w==="Leader"){v=g.leaderOwner}else{if(w==="Readerrestricted"){v=g.restrictedReader}else{if(w==="Contributorrestricted"){v=g.restrictedContributor}else{if(w==="Authorrestricted"){v=g.restrictedAuthor}else{if(w==="Leaderrestricted"){v=g.restrictedLeaderOwner}}}}}}}}}return{id:w,name:v}}function b(w){var v=w.item;return{login:v.login,role:s([w.categoryId])[0],isRestricted:s([w.categoryId])[1],fullname:v.name,emailAddress:v.email,isAdmin:(s([w.categoryId])[0].toUpperCase()===h.boType.leader.toUpperCase())}}function e(v){return v.map(b)}function p(F,x,B){if(!Array.isArray(F)){throw new Error("You should provide a categories array input")}var N=[],z=[];var y=F.some(function(S){return S.id==="Authorrestricted"});if(B.action.indexOf("add.members.restricted")===-1||(B.action.indexOf("add.members.restricted")===-1&&y)){for(var J=0;J<F.length;J++){if(F[J].id.contains("restricted")){N.push(F[J])}else{z.push(F[J])}}}else{z=[];F.map(function(S){if(S.id.contains("restricted")){z.push(S)}})}var H=[{id:"PublicReader",name:"Public Reader"},{id:"Reader",name:"Reader"},{id:"Contributor",name:"Contributor"},{id:"Author",name:"Author"},{id:"Leader",name:"Leader"},{id:"Readerrestricted",name:"Reader (Restricted)"},{id:"Contributorrestricted",name:"Contributor (Restricted)"},{id:"Authorrestricted",name:"Author (Restricted)"},{id:"Leaderrestricted",name:"Leader (Restricted) & Owner (Restricted)"}];function C(S){return{login:S,fname:S,lname:"",email:S,role:null}}var R,G,I,P,w,K,O,M;var D,Q,L;var E;if(B.action.indexOf("add.members.restricted")===-1&&N.length>1){R={categories:N,suggestFormat:"{fname} {lname}",suggestKey:"login",labelFormat:"{fname} {lname}",placeholder:"",typeDelay:500,minLength:2,suggestDistinction:function(T){for(var S in H){if(H[S].id===T.role){return H[S].name}}},saveProcess:e};G=new d(Object.assign(R,x));G.elements.buttons.classList.add("shareview__footer");I=G.render;P=G.destroy;L=Object.assign(G,{renderRestrictedRoles:function(){var S=I.apply(G,arguments);var T=G.container.querySelector("input.temp-autocomplete-input");if(T){T.focus()}G.show();return S},destroyRestrictedRoles:function(){if(typeof E==="function"){E()}return P.apply(this,arguments)}})}w={categories:z.length?z:N,suggestFormat:"{fname} {lname}",suggestKey:"login",labelFormat:"{fname} {lname}",placeholder:"",typeDelay:500,minLength:2,suggestDistinction:function(T){for(var S in H){if(H[S].id===T.role){return H[S].name}}},saveProcess:e};K=new d(Object.assign(w,x));K.elements.buttons.classList.add("shareview__footer");O=K.render;M=K.destroy;Q=Object.assign(K,{render:function(){var S=O.apply(K,arguments);var T=K.container.querySelector("input.temp-autocomplete-input");if(T){T.focus()}K.show();return S},destroy:function(){if(typeof E==="function"){E()}return M.apply(this,arguments)}});if(L){var v=Q.container.querySelector("button.btn-primary");v.textContent=g.addMemberBtn;var A=L.container.querySelector("button.btn-primary");A.textContent=g.addMemberBtn;D=[Q,L]}else{var v=Q.container.querySelector("button.btn-primary");v.textContent=g.addMemberBtn;D=Q}return D}function j(x,A,v){var w;var D;var B=v.view;var C=B.destroy;var E=(function y(){var F;return function(H){if(F){F.cancel();F=null}var G=a.format("{0}/resources/enocsmrest/peoples?filter={1}&collabspace={2}&limit=10",x[0],encodeURIComponent(H),encodeURIComponent(x[1]));if(F){F.cancel()}return new c(function(J,I){F=k.performRequestWithOptions(G,{type:"json",onComplete:J,onFailure:I})})}})();function z(H,F,G){D=function(){Object.keys(F).map(function(I){delete F[I]})};if(!H){return}if(F[H]){return G(F[H])}E(H).then(G,function(){console.warn("requestSuggestion call has failed")})}w=Object.assign({},A,{getSuggestions:z});B.destroy=function(){if(typeof D==="function"){D()}return C.apply(this,arguments)};return p(i(v.actionIds,v.drive).inputCategories,w,v)}function q(y,A,x){A.render();var w=r.modals.current;(function z(C){var B=C.onHide;C.onHide=function(){B.call(C);A.destroy()}})(w);(function v(C){C.elements.container.addEventListener("keyup",B);function B(){if(event.keyCode!==27){return}C.hide()}})(w);return w}function m(D,K,A,L){var x=A.drive.get("availableRoles");var E=A.get("actions");var I=new t();var y;var w=K.get("auth").getStorage().url3DSpace;I.container.classList.add("shareview");var H={};if(L.onEmailAddress){H.onEmailAddress=L.onEmailAddress}w=[w,D];var v={};v.drive=K;v.view=I;v.action=E;if(A.get("actions").indexOf("add.members.restricted")===-1){v.actionIds=x}else{v.actionIds=[];x.map(function(M){if(M.contains("restricted")){v.actionIds.push(M)}})}var F=j(w,H,v);if(A.get("actions").indexOf("add.members.restricted")===-1&&x.indexOf("Author")!==-1&&x.indexOf("Authorrestricted")!==-1){I.elements.addMemberView=F[0];y=u.createCheckboxAndContent({restrictedView:F[1],normalView:F[0],checkboxOptions:{type:"checkbox",value:g.enableRestrictedRoles,classes:"shareview__header-tabs"}});y.classList.add("shareview__options")}else{I.elements.addMemberView=F}I.render=function(){while(I.container.firstChild){I.container.removeChild(I.container.firstChild)}var M;if(y){F[0].render();M=[y,F[0].container,F[1].container]}else{F.render();M=[F.container]}M.reduce(function(N,O){N.appendChild(O);return N},I.container);return I};var J=q((L.title||g.share),I,L.viewClass);var z,B;var C;if(y){z=F[0];B=F[1];C=B.saveProcess;B.saveProcess=function(){if(typeof L.onComplete!=="function"){return}var M=C.apply(this,arguments);M=M.map(function(N){return Object.assign({},N)});L.onComplete(M)};B.onClose=function(){J.hide()}}else{z=F}var G=z.saveProcess;z.saveProcess=function(){if(typeof L.onComplete!=="function"){return}var M=G.apply(this,arguments);M=M.map(function(N){return Object.assign({},N)});L.onComplete(M)};z.onClose=function(){J.hide()};return I}return function(A,x){if(!A){return}A=[].concat(A);if(!A[0]){return}var w=Object.assign({},x);w.onComplete=function(B){if(typeof x.onComplete!=="function"){return}x.onComplete(A,B)};var z=f.getActionIds(A);var y=A[0].drive;o=A[0].id;var v=m(o,y,A[0],w);return new c(function(C,B){C(v.container)})}});define("DS/W3DDrive/Metas/Dropbox/permission",["DS/W3DDrive/Metas/permission"],function(a){return function(){var e=a();var d="owner";var c="viewer";var f="editor";var b="viewer_no_comment";e.roles={writer:f,reader:c,owner:d,readerNoComment:b};e.roleToFrontend=function(g){switch(g){case d:return"owner";case c:return"reader";case f:return"writer";case b:return"readerNoComment";default:return""}};return e}});define("DS/W3DDrive/Utils/History",["UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","UWA/String","DS/W3DDrive/widget","DS/W3DContentApp/SearchProxy"],function(h,b,l,j,d,f,k){var e,g,i,a,c;var i=/^\/+|\/+$/g;var g=false;var a="saved-fragment";var c="";e=b.extend(l,j,{_getSavedFragment:function(){if(f.getValue(a)){var m=f.getValue(a);if(m&&m.length>0&&m.indexOf("/")===-1){m=decodeURIComponent(f.getValue(a))}return m}else{return null}},_saveFragment:function(m){return f.setValue(a,m)},_loadUrl:function(n,p){var o=this;n=this.fragment=this.getFragment(n);var m=this.handlers.some(function(q){if(d.test(n,q.route)){q.callback(n);return true}});if(!m){console.log('No handler can be found for route = "'+n+'"');if(p!==true){return o._loadUrl(c,true)}}return m},init:function(){this.handlers=[];return this},setBaseURI:function(m){if(m.indexOf("/")!==0){m="/"+m}c=m},getFragment:function(m){if(m===undefined){m=""}return m.replace(i,"")},route:function(m,n){this.handlers.unshift({route:m,callback:n})},navigate:function(n,m){if(!g){return false}if(!m||m===true){m={trigger:!!m}}if(m.hasOwnProperty("loadBaseUri")&&m.loadBaseUri===true){n=c}n=this.getFragment(n||"");if(this.fragment===n&&m.force!==true){return}this.fragment=n;this._saveFragment(n);if(m.trigger){k.resetQuery({silent:true});return this._loadUrl(n)}},start:function(m){m=m||{};if(g){throw new Error("Backbone.history has already been started")}this.root=this._getSavedFragment()||m.root||c;this.root=("/"+this.root+"/").replace(i,"/");g=true;if(!m.silent){this._loadUrl(this.root)}},stop:function(){g=false}});return e.singleton()});define("DS/W3DDrive/Utils/Preferences",["UWA/String","DS/W3DDrive/Utils/Platform","DS/W3DDrive/Utils/History","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(f,a,d,e,g){var b;var c={validateRoute:function(i,k,h){var j="drives/{0}/mimetype/text%2Fdirectory/inode/{1}";h.map(function(l){if(l.id===k){j=f.format(j,k,i)}});return j},runHistory:function(h){var j=this;var k=(e.getValue("firstlyLoading")==="false")?false:e.getValue("firstlyLoading");var i=e.getValue("x3dPlatformId");if(e.getValue("isStandalone")===true){d.setBaseURI(h);j._runStartingRoute()}else{a.getAllPlatforms().then(function(l){if(i){d.setBaseURI(j.validateRoute(h,i,l),i)}else{if(l[0]){d.setBaseURI(j.validateRoute(h,l[0].id,l),l[0].id)}else{d.setBaseURI("/")}}j._runStartingRoute()},function(){d.setBaseURI("/");j._runStartingRoute()})}},_runStartingRoute:function(h,i){if(i){e.setValue("granted-"+i,true);d._saveFragment(h)}d.start({root:h});b=true}};return c});define("DS/W3DDrive/Actions/Share/shareToGroupService",["DS/W3DDrive/widget","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Actions/Share/shareFactory","DS/W3DDrive/Actions/formFactory","DS/W3DContentApp/Views/SuperModal","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(d,g,e,f,h,i){return function(p,k){var l=p[0].drive;var o=g.getActionIds(p);var n=a(p,l,k);var j=l.get("auth").getStorage().url;var m=l.get("availableRoles");if(m){return new Promise(function(r,q){r(b({url:j,actionIds:m,inodes:p,shareOptions:n}).render().container)})}else{return new Promise(function(t,s){var q=c({url:j,actionIds:o,inodes:p,shareOptions:n}).render();var r=q.container.querySelector(".paneladdmember-item-view-buttons");q.container.appendChild(r);t(q.container)})}};function c(r){var j=r.url;var l=r.actionIds;var k=r.inodes[0];var m=r.shareOptions;m.inode=k;m.validateButtonText=i.share;var n;var p=e.createTextArea();p.render=function(){while(p.container.firstChild){p.container.removeChild(p.container.firstChild)}n.render();var s=e.makeElement();s.classList.add("shareview__options2");var t=[];if(l.indexOf("giveShareAccess")!==-1){t.splice(1,0,e.createReshareElem({className:"shareview__reshare",id:"checkbox-share-group"}))}t.reduce(function(u,v){u.appendChild(v);return u},s);p.container.appendChild(n.container);p.container.appendChild(s);return p};n=e.createGroupInvitationView(j,l,m);var o=n.saveProcess;n.saveProcess=function(){if(typeof m.onComplete!=="function"){return}var s=p.container.querySelector(".js_share-inode_reshare");var t=o.apply(this,arguments);var v=false;t=t.map(function(w){if(!v&&w.isGroup===true){v=true}var x={message:""};if(s&&s.checked){x.accessright=e.convertCategoriesToSharingRole("giveShareAccess",w.accessright).role}return Object.assign({},w,x)});var u={isGroup:v};m.onComplete(t,u)};var q=n.destroy;n.destroy=function(){n=null;o=null;l=null;m=null;q.apply(this,arguments)};p.elements.platformInvitationView=n;n.onClose=function(){h.modals.current.hide()};return p}function b(y){var j=y.url;var m;var k=y.inodes[0];var p=y.shareOptions;var n=k.drive.get("availableRoles");var q;p.inode=k;p.validateButtonText=i.addGroupsBtn;var u;var s;var l;var r,o,x,w;var t=e.createTextArea();if((k.get("actions").indexOf("add.members.restricted")===-1)||(k.get("actions").indexOf("add.members.restricted")===-1&&n.indexOf("Authorrestricted")!==-1)){m=y.actionIds}else{m=[];y.actionIds.map(function(z){if(z.contains("restricted")){m.push(z)}})}q=e.createGroupInvitationView(j,m,p);if(k.get("actions").indexOf("add.members.restricted")===-1&&n.indexOf("Authorrestricted")!==-1){s=q[0];u=q[1];t.elements.platformInvitationView=u}else{t.elements.platformInvitationView=q}t.render=function(){while(t.container.firstChild){t.container.removeChild(t.container.firstChild)}if(k.get("actions").indexOf("add.members.restricted")===-1&&n&&n.indexOf("Authorrestricted")!==-1){var z=e.createCheckboxAndContent({restrictedView:q[1],normalView:q[0],checkboxOptions:{type:"checkbox",value:i.enableRestrictedRoles,classes:"shareview__header-tabs"}});z.classList.add("shareview__options");q[0].render();l=[z,q[0].container,q[1].container]}else{q.render();l=[q.container]}l.reduce(function(A,B){A.appendChild(B);return A},t.container);return t};var v=e.bindViewToModal(t,y);if(k.get("actions").indexOf("add.members.restricted")===-1&&n.indexOf("Authorrestricted")!==-1){s=q[0];u=q[1];o=u.saveProcess;w=u.destroy;u.saveProcess=function(){if(typeof p.onComplete!=="function"){return}var z=o.apply(this,arguments);var B=false;z=z.map(function(C){if(!B&&C.isGroup===true){B=true}var D={message:""};return Object.assign({},C,D)});var A={isGroup:B};p.onComplete(z,A)};u.destroyRestrictedView=function(){u=null;o=null;m=null;p=null;w.apply(this,arguments)};u.onClose=function(){v.hide()}}else{s=q}r=s.saveProcess;x=s.destroy;s.saveProcess=function(){if(typeof p.onComplete!=="function"){return}var z=r.apply(this,arguments);var B=false;z=z.map(function(C){if(!B&&C.isGroup===true){B=true}var D={message:""};return Object.assign({},C,D)});var A={isGroup:B};p.onComplete(z,A)};s.destroyNormalView=function(){s=null;r=null;m=null;p=null;x.apply(this,arguments)};var y={};y.validateButtonText=i.addGroupsBtn;s.onClose=function(){v.hide()};return t}function a(m,k,j){var l=Object.assign({},j);l.onComplete=function(n,o){if(typeof j.onComplete!=="function"){return}j.onComplete(m,n,o)};if(k.get("shareWithinvitation")){l.onEmailAddress=e.onEmailAddress}l.is3DSpace=(d.getValue("is3DSpaceWidget")==="true");return l}});define("DS/W3DDrive/Actions/Share/DSDrive/shareByLinkService",["DS/W3DDrive/Actions/Share/shareFactory","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Utils/RequestHelper","DS/WebappsUtils/WebappsUtils","UWA/Class/Promise","UWA/Utils/Client","DS/UIKIT/Alert","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(u,b,A,n,f,c,w,l,i){var g,E;return function(G,F){return new c(function(H){H(C(G,F))})};function C(Q,I){var G;var R=u.makeElement({classes:"shareview__bylink"});var Y=u.createTextBlock({text:""});var P=Q[0];var T=u.createTextInputWithButton({buttonContent:i.copyLink,readonly:true,css:{display:"none"}});var X=50;var M=u.createTextBlock({text:i.shareByLinkDeactivated,css:{display:"none"}});var L=null;var H;var U;var V=u.createToggleSwitch({label:i.enableShareableLink}).disable();O();F();J();N();return R;function F(){j(T);k({toggleLink:V,inputLink:T,expirationDate:Y,inode:P,shareOptionsView:H});p(L,P);G.elements.container.addEventListener("click",function(){B({inode:P,shareOptionsView:H,dispatchEvent:I.dispatchEvent})})}function J(){[V.elements.container,T,M,Y,H].reduce(o,R)}function K(){if(!Q||!P){return false}var aa=P.get("actions");var Z=aa&&aa.indexOf("share.link")>-1;return c.resolve({activated:Z})}function O(){H=u.makeElement({classes:[d().normal,d().hidden]});L=W();H.appendChild(L)}function W(){var aa=u.makeElement({classes:"shareview__link__restricted"});var Z=u.makeElement({classes:"restricted__validation__container"});U=u.createTagsTextInput({initialTagsCount:P.permissionsLink.length,existingPermissionsLink:P.permissionsLink.toArray(),maxTagsLimit:X,inputOptions:{placeholder:i.enterEmail}});G=u.createButton({value:i.add,className:"primary button__validation"});[U,G.elements.container].reduce(o,Z);var ab=u.createCheckboxWithContent({visibleClass:"checkbox__content--visible",hiddenClass:"checkbox__content--hidden",content:Z,checkboxOptions:{className:"primary restricted__share__checkbox",label:i.restrictedTo,type:"checkbox"}});aa.appendChild(ab);U.addEventListener("limitExceeded",function(){G.elements.container.disabled=true});U.addEventListener("limitOk",function(){G.elements.container.disabled=false});U.addEventListener("duplicatedTag",function(ac){D({message:i.replace(i.duplicatedRestriction,{name:ac.duplicatedTag})})});U.addEventListener("submit",function(){B({inode:P,shareOptionsView:H,dispatchEvent:I.dispatchEvent})});return aa}function N(){K().then(function(Z){if(Z.activated){return s(P).then(S)["catch"](function(){z({message:i.linkFetchError})})}M.style.display="block"})}function S(Z){V.enable();if(!Z){return}V.check();q(Y,Z.expiration);m(T,Z);P.set("sharedLink",Z);U.updateTagsLimit(Z.restrictions.length);x({shareOptionsView:H,sharedData:Z})}}function j(H){var G=H.querySelector(".input__button");var F=H.querySelector("input");G.addEventListener("click",function(){if(w.Platform.hasOwnProperty("ios")&&w.Platform.ios===true){var I=document.createRange();I.selectNode(F);var J=window.getSelection();J.removeAllRanges();J.addRange(I);F.setSelectionRange(0,999999)}else{F.select()}try{if(document.execCommand("copy")){D({message:i.linkCopied})}else{z({message:i.linkCopyError})}}catch(K){z({message:i.linkCopyError})}})}function k(F){var G=F.toggleLink;if(!G){return}G.addEvent("onChange",function(){if(G.isChecked()){r(F);return}v(F)})}function p(F,H){var G=F.querySelector(".restricted__share__checkbox input");G.addEventListener("change",function(){G.disabled=true;if(G.checked){return a({restricted:true,inode:H}).then(function(){D({message:i.restrictedShareActivationSuccess})},function(){G.checked=!G.checked;z({message:i.restrictedShareActivationFailed})})["finally"](function(){G.disabled=false})}A.dialog({title:i.replace(i.shareElem,{name:H.get("title")}),body:i.confirmPublicShare,buttons:[{className:"primary",value:i.publicShare,action:function(I){I.hide();a({restricted:false,inode:H}).then(function(){b.add({message:i.restrictedShareDeactivationSuccess,className:"success"});H.permissionsLink.reset();H.permissionsLink.dispatchEvent("onSync")},function(){b.add({message:i.restrictedShareDeactivationFailed,className:"error"})})}},{value:i.cancel,action:function(I){I.hide()}}]})})}function B(N){var F=N.inode;var L=N.dispatchEvent;var K=N.shareOptionsView;var M=K.querySelector(".tags__container");var G=N.tagsLimit;var I=[];var J=Array.prototype.slice.call(M.childNodes);if(J.length===0){z({message:i.mandatoryEmail});return}if(typeof G==="number"&&G>0&&J.length>G){z({message:i.restrictedEmailsNumberLimitExceededDescription});return}var H=J.map(function(P){var O={domain:false,mail:P.innerText};I.push(O);return Object.assign({},O,{id:P.innerText,displayName:P.innerText,emailAddress:P.innerText,picture:{medium:f.getWebappsAssetUrl("W3DDrive","default_people.png")}})});u.closeShareModal();e({url:y({action:"restrictions",inode:F}),method:"PUT",inode:F,data:{operation:"add",items:I}}).then(function(){b.add({message:i.restrictedShareAddEmailsSuccess,className:"success"});L("onShareAccessLink",[F,H])},function(){b.add({message:i.restrictedShareAddEmailsSuccess,className:"error"})})}function v(F){var G=F.inode;A.dialog({title:i.replace(i.unshareElem,{name:G.get("title")}),body:i.shareByLinkDeactivationConfirmation,buttons:[{className:"primary",value:i.unshare,action:function(H){H.hide();h(G)}},{value:i.cancel,action:function(H){H.hide()}}]})}function s(F){if(!F){throw"Cannot get shared data without an inode object."}return e({inode:F}).then(function(G){return G[0]})}function r(G){var H=G.toggleLink;var I=G.inputLink;var F=G.expirationDate;var J=G.inode;e({url:y({inode:J}),method:"POST",inode:J,data:{objectid:J.get("id"),service:"drive",tenant:J._auth.platform.id,sharer:J.drive.get("user").id,restricted:"false"}}).then(function(K){var L=K[0];J.set("sharedLink",L);q(F,L.expiration);m(I,L);x({shareOptionsView:G.shareOptionsView,sharedData:L});D({message:i.linkCreated})},function(){z({message:i.linkCreationError});H.uncheck()})}function h(F){e({method:"DELETE",inode:F}).then(function(){F.set("sharedLink",null);b.add({message:i.linkDeleted,className:"success"})},function(){b.add({message:i.linkDeletionError,className:"error"})})}function a(G){if(typeof G.restricted==="undefined"){throw'You must specified the "restricted" parameter to true|false.'}var H=G.inode;var F=G.restricted;return e({method:"PUT",inode:H,data:{objectid:H.get("id"),restricted:F}}).then(function(I){return I[0]})}function m(G,H){var F=G.querySelector("input");G.style.display="table";F.value=H.url}function z(F){t(Object.assign({},{className:"error"},F))}function D(F){t(Object.assign({},{className:"success"},F))}function t(F){if(!g){g=new l({visible:true,autoHide:true,hideDelay:3000,className:"w3ddrive alert"}).inject(document.body.querySelector(".shareview"))}g.add({message:F.message,className:F.className||"success"});if(E){clearTimeout(E)}E=setTimeout(function(){g.destroy();g=null;E=null},g.options.hideDelay*2)}function q(H,F){var G=new Date(F);H.innerHTML=i.expirationDate+": "+G.toLocaleString()}function x(H){var F=H.sharedData;var I=H.shareOptionsView;I.classList.remove(d().hidden);if(F.restricted){var J=I.querySelector(".restricted__share__checkbox input");var G=I.querySelector(".restricted__validation__container");if(J){J.checked=true}if(G){G.classList.remove("checkbox__content--hidden");G.classList.add("checkbox__content--visible")}}}function y(F){var H=F.action;var I=F.inode;var G=I._auth.platform.url+"/resources/share/accesses/";if(H==="edit"){return G+I.get("id")}if(H==="restrictions"){return G+I.get("id")+"/restrictions"}return G}function e(H){if(!H.inode){throw"inode object parameter is expected"}var G=H.url||y({action:"edit",inode:H.inode});var F=H.requestOptions||{};if(H.data){F.data=H.data}if(H.method){F.method=H.method}if(F.data){F.data=JSON.stringify(F.data)}return new c(function(J,I){n.performRequestWithOptions(G,Object.assign({method:"GET",type:"json",auth:H.inode._auth,headers:{"Content-Type":"application/json"},onComplete:function(){return J(arguments)},onFailure:function(){return I(arguments)}},F))})}function o(F,G){F.appendChild(G);return F}function d(){return{hidden:"shareview__bylink-options--hidden",normal:"shareview__bylink-options",visible:"shareview__bylink-options--visible"}}});define("DS/W3DDrive/Metas/3DSpace/permission",["DS/W3DDrive/Metas/permission"],function(a){return function(){var f=a();var g="contributor";var b="author";var e="leader";var d="publicreader";var c="reader";f.roles={contributor:g,author:b,leader:e,reader:c,publicReader:d};f.roleToFrontend=function(h){switch(h){case d:return"Public reader";case c:return"Reader";case g:return"Contributor";case b:return"Author";case e:return"Leader & Owner";default:return""}};return f}});define("DS/W3DDrive/Actions/delete",["DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDrive/Metas/DSDrive/inode","DS/UIKIT/Input/Toggle","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(h,e,g,f,i){var b=g();return function d(m,k){k=k||{};k.isPermanent=false;var l={};if(!Array.isArray(m)&&m.isCollabSpace()===true){m.doesItHaveContent().then(function(n){if(n.contentTotal>0){l=a(m,k)}else{l=j(m,k)}return h.dialog(l)})}else{if(Array.isArray(m)&&m.length>0){if(!m[0].drive.getInode(b.ids.trash,{noCreate:true})||m[0].get("parentId")===b.ids.trash){k.isPermanent=true}}else{if(!m.drive.getInode(b.ids.trash,{noCreate:true})||m.get("parentId")===b.ids.trash){k.isPermanent=true}}if(k.isPermanent!==true&&e.isLinkedFile(m)){l=c(m,k)}else{l=j(m,k)}return h.dialog(l)}};function j(o,l){var p=l.dispatchEvent;var n="";var k="";if(Array.isArray(o)){n=i.replace(i.deleteElems);if(o.length>0&&o[0].drive.get("isDrivesHubProvider")){k=i.confirmDeleteElemsExternalService}else{k=(l.isPermanent===true)?i.confirmPermaDeletionElems:i.confirmDeleteElems}o=[o]}else{var m=o;n=i.replace(i.deleteElem,{name:m.get("title")});if(o.drive.isCollabSpace&&o.get("parentId")==="myCollabSpaces"){k=i.confirmCSDeletion}else{if(o.drive.get("isDrivesHubProvider")){k=i.confirmDeletionExternalService}else{k=(l.isPermanent===true)?i.confirmPermaDeletion:i.confirmDeletion}}}return{title:n,body:k,buttons:[{className:"primary",value:i.deleteText,action:function(q){q.hide();p("onDelete",o)}},{value:i.cancel,action:function(q){q.hide()}}]}}function c(n,t){var s=t.dispatchEvent;var q=i.replace(i.deleteElem,{name:n.get("title")});var l=document.createElement("span");l.innerHTML=i.confirmDeletion;var o=document.createElement("div");o.innerHTML=i.options;o.classList.add("deleteview__label-options");var k={name:"deleteType",className:"primary"};var p=new f(Object.assign({},k,{value:"all",label:i.deleteLinkedFiles})).check();var m=new f(Object.assign({},k,{value:"one",label:i.deleteFileOnly}));var r=document.createElement("div");r.classList.add("deleteview");r.appendChild(l);r.appendChild(o);r.appendChild(p.elements.container);r.appendChild(m.elements.container);return{title:q,body:r,buttons:[{className:"primary",value:i.deleteText,action:function(u){u.hide();var v={};if(p.isChecked()){v.queryStrings={expand:"true"}}s("onDelete",[n,v])}},{value:i.cancel,action:function(u){u.hide()}}]}}function a(o,l){var n="";var k="";var m=o;n=i.replace(i.deleteElem,{name:m.get("title")});if(o.drive.isCollabSpace&&o.get("parentId")==="myCollabSpaces"){k=i.InfoCSNotEmpty}return{title:n,body:k,buttons:[{value:i.ok,action:function(p){p.hide()}}]}}});define("DS/W3DDrive/Models/AuthModel",["UWA/Core","UWA/Class/Model","DS/W3DDrive/Utils/RequestHelper"],function(d,c,b){var a;a=c.extend({init:function(e,f){var g;if(f){this._auth=f.auth}g=this._parent.apply(this,arguments);return g},sync:function(g,f,e){e=d.clone(e||{},false);if(e.noSync===true){return}e.ajax=e.ajax||b.getRequestMethod(e);e.auth=this._auth;return this._parent(g,f,e)}});return a});define("DS/W3DDrive/Models/Inode",["UWA/Core","UWA/Utils","UWA/String","DS/W3DDrive/widget","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/AuthModel","DS/W3DDrive/Utils/StructureNavigation","DS/W3DContentApp/Utils/Helpers","UWA/Class/Promise","DS/W3DContentApp/Utils/Alert","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,f,c,b,d,a,h,k,j,i,m){var g=d();var l=a.extend({defaults:{id:undefined,name:undefined,parentId:undefined,title:"",mimeType:"",downloadUrl:"",fileExtension:"",size:"",description:"",createdDate:"",modifiedDate:"",modifiedByMeDate:"",sharedWithMeDate:"",iconLink:"",thumbnailLink:{small:g.thumbnails.content,medium:g.thumbnails.content,large:g.thumbnails.content},owners:[],lastModifyingUser:{},shared:false},isContainer:function(){return this.isFolder()||this.isLabel()||this.isCollabSpace()},isCollabSpace:function(){return this.get("mimeType")===g.mimeType.collabSpace},isFolder:function(){return this.get("mimeType")===g.mimeType.folder},isLabel:function(){return this.get("mimeType")===g.mimeType.label},isPlayable:function(){var n=this.get("fileExtension").toLowerCase();return(n&&((n==="jpg")||(n==="jpeg")))},getURI:function(){return f.parseUrl(k.result(this,"url")).path},getOwnerNames:function(){var n=this.get("owners")[0]?this.get("owners")[0]:this.get("owners");if(!n){return}return(n.displayName?n.displayName:n.name)||""},getLastModifyingUserName:function(){var n;n=this.get("lastModifyingUser");if(!n){return}return n.displayName||""},getFileUrl:function(){var n=this.get("fileUrl");return new j(function(p,o){p(n)})},getDownloadUrl:function(){var n=this.get("downloadUrl");return new j(function(p,o){p({url:n,method:"GET"})})},getNLSType:function(){return this.isFolder()?m.folder:k.computeFileExtension(this.get("fileExtension"))},get3DPlayOptions:function(n){n=n||{};var p={provider:"FILE",physicalid:this.id,filename:this.get("fileUrl"),format:this.get("fileExtension"),type:this.get("fileExtension")};var o={};var q={};if(h.isSupportedBy3DPlay(this)){p.filename=this.get("title")+".zip";p.url=this.get("fileUrl")}q=Object.assign(q,n);if(this.get("forcePlay")){this.set("forcePlay",false);o.provider="FILE";o.filename="DS/3DPlay360Experiences/3DPlay360Experience";q.experience=Object.assign(o,n.experience)}q.asset=Object.assign(p,n.asset);return q},getThumbnailLink:function(){var n=this.get("thumbnailLink");return new j(function(p,o){p(n)})},getDefaultThumbnail:function(){if(this.isFolder()){return g.thumbnails.folder}var n=this.get("fileExtension");if(!n){return g.thumbnails.content}return g.thumbnails[n.toLowerCase()]||g.thumbnails.content},getActionIds:function(){return[]},isActionIdoK:function(n){return(this.getActionIds().indexOf(n)!==-1)},isAtLeastOneActionIdOk:function(o){if(!Array.isArray(o)){throw new Error("The parameter is not an Array.")}var n=this.getActionIds();return o.some(function(p){return n.indexOf(p)!==-1})},onRemove:function(){this.set("removed",true)},onAdd:function(){this.set("removed",false)},doesExistInBackend:function(){var n=this;return new j(function(p,o){if(b.getValue("isStandalone")===true){p(true);return}if(n.drive.isDrivesHubDrive){p(true);return}n.sync("GET",n,{onComplete:function(q){if(q.title){p(true)}else{p(false);n.destroy({noSync:true})}},onFailure:function(q){if(q.error.code){i.add({message:m.replace(m.tenantAccessError,{errorMsg:q.error.message}),className:"warning"})}p(false);n.destroy({noSync:true})}})})}});return l});define("DS/W3DDrive/Models/Permission",["UWA/Core","DS/W3DDrive/Models/AuthModel","DS/WebappsUtils/WebappsUtils"],function(d,a,c){var b=a.extend({defaults:{id:undefined,displayName:"",emailAddress:"",picture:{},role:"",type:"user"},getActionIds:function(){return[]},isActionAllowed:function(f){var e=this.getActionIds();return(e.indexOf(f)!==-1)},isActionIdoK:function(e){return this.getActionIds()[e]},destroy:function(e){e=d.clone(e||{},false);e.type="text";return this._parent(e)}});return b});define("DS/W3DDrive/Models/3DSpace/UserGroup",["DS/W3DDrive/Metas/3DSpace/permission","DS/W3DDrive/Models/Permission","DS/W3DDrive/Metas/3DSpace/inode","DS/WebappsUtils/WebappsUtils","UWA/String"],function(m,k,h,g,e){var b=m();var i=h();function d(n,p){var q=n.get("role");if(!q){return p}var o=p.filter(function(r){switch(r){case"edit.role.leader":if(q.value.toLowerCase()!==b.roles.leader){return true}break;case"edit.role.author":if(q.value.toLowerCase()!==b.roles.author){return true}break;case"edit.role.contributor":if(q.value.toLowerCase()!==b.roles.contributor){return true}break;case"edit.role.reader":if(q.value.toLowerCase()!==b.roles.reader){return true}break;case"edit.role.publicreader":if(q.value.toLowerCase()!==b.roles.publicReader){return true}break;case"delete":return true;break}return false});return o}function f(n){if(!n||n.hasOwnProperty("value")!==true){return null}if(n.value.toLowerCase()==="reader"){n.value="readercs"}return n.value.toLowerCase()}function l(n,p){if(n.get("actions")){if(n.get("actions").length===0){return false}else{for(var o=0;o<n.get("actions").length;o++){if(n.get("actions")[o]==="edit.role.leader"&&p===b.roles.leader){return true}if(n.get("actions")[o]==="edit.role.author"&&p===b.roles.author){return true}if(n.get("actions")[o]==="edit.role.contributor"&&p===b.roles.contributor){return true}if(n.get("actions")[o]==="edit.role.reader"&&p===b.roles.reader){return true}if(n.get("actions")[o]==="edit.role.publicreader"&&p===b.roles.publicReader){return true}if(n.get("actions")[o]==="delete"&&p==="removePermission"){return true}if(p==="makeMainOwner"){return true}}}}if(n.get("isOwnerCs")){return false}}var j={removePermission:function(n){return l(n,"removePermission")},makeReader:function(n){return l(n,b.roles.reader)},makePublicReader:function(n){return l(n,b.roles.publicReader)},makeContributor:function(n){return l(n,b.roles.contributor)},makeAuthor:function(n){return l(n,b.roles.author)},makeLeaderOwner:function(n){var o=l(n,b.roles.leader);return o===true||(n.get("role")!==undefined&&n.get("role").restricted===false&&n.get("role").admin!==true)}};var a=Object.keys(b.actionPubIds).reduce(function(n,o){n[b.actionPubIds[o]]=j[o];return n},{});var c=function(o){var n=o.value.toLowerCase();if(n==="readercs"){n="reader"}return n};return k.extend({idAttribute:"id",type:"group",parse:function(n){return{id:n.id,resourceid:n.uri,_label:n.title,accessright:n.accessright,members:n.members,role:n.role,actions:n.actions,parsedRole:f(n.role)}},destroy:function(n){this.set("pid",this.get("id"));return this._parent(n)},init:function(n){return this._parent.apply(this,arguments)},setup:function(n){this.set("id",n.id);this.set("resourceid",n.uri);this.set("label",n.title);this.set("accessright",n.accessright);this.set("role",n.role);this.set("parsedRole",f(n.role));this.set("members",n.members);this.set("type",this.type);this.set("actions",d(this,n.actions));return this._parent.apply(this,arguments)},save:function(p,o){if(p&&p.hasOwnProperty("role")){if(p.role==="mainOwner"){this.set("role",i.boType.leaderOwner)}else{var n=(p.role===i.boType.leader)?true:false;this.set("role",{value:p.role,admin:n})}this.set("parsedRole",f(this.get("role")))}return this._parent(null,o)},sync:function(q,p,o){o.url=p.collection.url();if(o.method==="create"){o.headers=o.headers||{};o.headers["Content-Type"]="application/json";var n=false;if(p.get("accessright")===i.boType.leader){n=true}o.data={role:{value:p.get("accessright"),admin:n,restricted:p.get("isRestricted")},uri:p.get("resourceid"),};if(typeof o.data==="object"){o.data=JSON.stringify(o.data)}o.method="POST"}else{if(q==="update"){o.headers=o.headers||{};o.headers["Content-Type"]="application/json";o.url=e.format("{0}/{1}",o.url,p.get("id"));o.data={role:{value:c(p.get("role")),admin:p.get("role").admin}};if(typeof o.data==="object"){o.data=JSON.stringify(o.data)}}else{if(q==="delete"){o.method="delete";o.url=e.format("{0}/{1}",o.url,p.get("id"));return this._parent(q,p,o)}}}return this._parent(q,p,o)},_hasAlreadyTheRole:function(n,o){return n.get("role").value===o},isActionAllowed:function(p){var n=a[p];if(!n){return false}var o=n(this);return o}})});define("DS/W3DDrive/Models/Drive",["UWA/Core","UWA/Class/Model","UWA/Class/Promise","UWA/Utils","UWA/String","DS/W3DDrive/Utils/DSAuth","DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/drive","DS/W3DDrive/Models/Inode","DS/W3DDrive/Utils/drive","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Utils/RequestHelper"],function(d,p,i,h,e,t,r,l,v,a,f,m,q){var w=a();var j=r();var s=l();var g={remove:function(){return true},install:function(){return false},storage:function(){return true}};var c=Object.keys(s.actionPubIds).reduce(function(y,z){y[s.actionPubIds[z]]=g[z];return y},{});function k(A,y){var z;z=A[y];if(!z){throw new Error("The object has no defined value for"+y)}return z}function o(y){return"granted-"+y.id}function n(y){return function z(){return new i(function(B,A){y.hasIdentity(function(){B(true)},function(){B(false)})})}}function x(z){return function y(){return new i(function(B,A){z.authenticate(function(){B.apply(this,arguments)},function(){A.apply(this,arguments)})})}}function u(z){return function y(){return new i(function(B,A){z.clearIdentity(function(){B.apply(this,arguments)},function(){A.apply(this,arguments)})})}}var b=p.extend({_Inodes:undefined,_Permissions:undefined,_createInodeTable:function(B,A,z){var y;y=k(this,"_Inodes");return new y(A||[],d.merge({parentInode:B,auth:this.hasAuth()},z))},fetch:function(y){y=y||{};y.ajax=q.getRequestMethod(y);return this._parent.apply(this,arguments)},_createShareWiths:function(A,z,y){var B;B=k(this,"_Permissions");return new B(z||[],d.merge({parentInode:A,auth:this.hasAuth()},y))},_indexInode:function(C){var D,z,A,y,B;D=C.id;if(D===undefined){throw new Error("You can't index an inode with no id")}C.drive=this;z=this._index;A=z[D];if(A){if(C===A){return A}if(A.collection){console.warn("This is a limit case. It could appear side effects (this case occurs when youreset your collection after a first fetch with reset:true option)")}B=A.permissions;y=A.inodeTable}else{if(C.isContainer()){y=this._createInodeTable(C,this._lsIndexedInodes(D));this._onResetInodes(y);y.dotDot=function(){var E;E=this.dot().collection;if(!E){return}return E.dot()};this.listenTo(y,{onAdd:this._indexInode,onReset:this._onResetInodes,"onChange:parentId":this._onChangeParentId});this.listenTo(C,"onDestroy",this._onDestroyInode);this.listenTo(C,"onChange:"+this.inodeIdAttr,this._onChangeId)}}if(!B){B=this._createShareWiths(C)}C.permissions=B;if(!C.isContainer()){return C}y.dot=function(){return C};C.inodeTable=y;z[D]=C;return C},_lsIndexedInodes:function(D){var A,y,z,B,C;A=[];y=this._index;for(z in y){if(y.hasOwnProperty(z)){B=y[z];C=B.get("parentId");if(C&&C===D){A.push(B)}}}return A},_onResetInodes:function(y){y.forEach(function(z){this._indexInode(z)},this)},_onChangeId:function(z,A){var y;y=z.previous(this.inodeIdAttr);this._index[A]=this.getInode(y);delete this._index[y]},_onChangeParentId:function(B,C){var z,y,A;A=this.getInode(C);if(!A){return}if(!A.isContainer()){return}z=B.collection;y=A.inodeTable;h.setImmediate(function(){z.remove(B);y.add(B)})},_onDestroyInode:function(y){var z;this.stopListening(y);if(y.isContainer()){z=y.inodeTable;delete y.inodeTable;this.stopListening(z);delete y.permissions;z.forEach(this._onDestroyInode,this)}delete this._index[y.id]},defaults:{id:"",title:"",iconLink:"",thumbnailLink:"",modified:"",quotaBytes:{total:"",used:""},user:{displayName:"",emailAddress:""},authenticated:undefined,granted:undefined},auth:undefined,init:function(){var B=this._parent.apply(this,arguments),y=k(this,"_Inodes"),A=y.prototype.model,z;this._index={};z=A.prototype.idAttribute;if(z===undefined||z===null){z="id"}this.inodeIdAttr=z;return B},hasAuth:function(){if(this.get("auth")){return this.get("auth")}var y=w.auths[this.id]||new t(this.id);this.set({auth:y});return this.get("auth")},sync:function(y,D,J){var G=J.attrs;var E=this;var F=o(D);var A;var I;var H=this._parent;var B;var C;J.ajax=q.getRequestMethod(J);if(!G){if(D.toJSON){G=D.toJSON()}else{G=D}}A=G.auth||this.hasAuth();I=n(A);if(y==="read"){B=I().then(function z(K){return Object.assign(G||{},{granted:true,authenticated:K})}).then(function(K){if(!K.authenticated||!m.result(D,"url")){return K}if(K.isDrivesHubProvider){return K}return new i(function(M,L){H(y,D,Object.assign({},J,{auth:A,onComplete:function(N){["quotaBytes","user"].map(function(O){delete K[O]});M(Object.assign({},N,K))},onFailure:function(N){f.add({message:N.error?N.error.message:"",className:"error"});L(N)}}))})})}else{if(y==="update"){C=new i(function(N,M){var L=x(E.get("auth")),K=u(E.get("auth")),O=G.authenticated;if(G.authenticated===undefined){return N()}if(O){L().then(function(){N.apply(this,arguments)},function(){M.apply(this,arguments)})}else{K().then(function(){G=Object.assign(D.defaults,{granted:G.granted,authenticated:G.authenticated,id:D.id});if(D.isDrivesHubDrive){G=Object.assign({},G,D.getDefaultsAttributes())}N.apply(this,arguments)},function(){M.apply(this,arguments)})}});B=C.then(function(L){if(L&&L.email!==undefined){var K=JSON.parse(L.email);if(K){G.user.emailAddress=K.email}}return G})}}return B.then(J.onComplete,J.onFailure)},getLegalInfo:function(){return""},getInode:function(A,G){var C=this.inodeIdAttr,E,F,y,B,z;if(!A){return}if(A.hasOwnProperty&&A.hasOwnProperty(C)){F=A}else{if(d.is(A,"string")){F={};F[C]=A}else{if(A.toJSON){F=A.toJSON()}else{return}}}y=F[C];if(!y){return}B=this._index;z=B[y];if(z){return z}for(var D in B){var z=B[D].inodeTable.getInode(y);if(z){return z}}if(G&&G.hasOwnProperty("noCreate")&&G.noCreate===true){return null}E=k(this,"_Inodes").prototype.model;z=new E(F,d.merge({auth:this.hasAuth()}));this._indexInode(z);return z},getTrueRootInode:function(){var y={};y.mimeType=j.mimeType.folder;y[this.inodeIdAttr]=j.ids.trueRoot;return this.getInode(y)},getRootInodes:function(z){var y=this;if(z===true){return new i(function(C,B){var D=y.getTrueRootInode();D.inodeTable.fetch({onComplete:function(){C(D.inodeTable)},onFailure:B})})}else{var A=this.getTrueRootInode();return A.inodeTable}},getParentInode:function(y,z){var A=this;return new i(function(D,C){var F=A.getInode(y),E=F.inodeTable.dotDot(),G,B;if(E||F===A.getTrueRootInode()){return D(E)}G=F.get("parentId");if(G!==undefined){B={mimeType:j.mimeType.folder};B[A.inodeIdAttr]=G;E=A.getInode(B);E.inodeTable.add(F);return D(E)}if(z){return C()}return F.fetch({onComplete:function(){A.getParentInode(y,true).then(D,C)},onFailure:C})})},getInodesPath:function(z,y){var B=this;function A(D,F){var E,C;if(F===undefined){F=D;D=undefined}E=B.getInode(F);C=B.getInode(D);if(!C){C=B.getTrueRootInode()}return new i(function(H,G){if(E===C){return H([C])}return B.getParentInode(E).then(A.bind(undefined,C),G).then(function(I){I.push(E);H(I)})})}return A(z,y).then(function(C){return C.map(function(D){return B._index[D.id]})})},getInodePanelURI:function(y){var z="drives";if(!y){return z}return e.format("/{0}/{1}/mimetype/{2}/inode/{3}",z,window.encodeURIComponent(y.drive.id),window.encodeURIComponent(y.get("mimeType")),window.encodeURIComponent(y.id))},getInodePanelContentURI:function(y){return e.format("{0}/content",this.getInodePanelURI(y))},getInodePreviewURI:function(y){return e.format("{0}/{1}/preview",this.getInodePanelContentURI(y.collection.dot()),window.encodeURIComponent(y.id))},isActionIdoK:function(z){var y=c[z];if(!y){return false}return y(this)},destroy:function(){var y=this.getTrueRootInode();y.destroy()}});return b});define("DS/W3DDrive/Models/GoogleDrive/Inode",["UWA/Core","UWA/Array","UWA/Utils","UWA/Class/Promise","DS/W3DDrive/Models/Actions/Google/actionsUtils","DS/W3DDrive/Metas/GoogleDrive/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/Inode","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Utils/RequestHelper","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,q,b,c,m,i,o,p,f,j,g){var d=o();var k=i();function l(t){var s=(t.get("userPermission")||{});return(s.role==="owner")}function e(s){return(n(s)&&s.get("writersCanShare"))}function n(t){var s=(t.get("userPermission")||{});return(s.role==="writer")}function r(t){var s=(t.get("userPermission")||{});return(s.role==="reader")}var h=p.extend({idAttribute:"id",urlRoot:"https://www.googleapis.com/drive/v2/files",sync:function(s,y,F){F=F?a.clone(F,false):{};F.ajax=j.getRequestMethod(F,true);if(s!=="create"&&s!=="update"&&s!=="patch"){return this._parent(s,y,F)}var v=F.file,D=this._parent,A=this,C,E,w,B,x,z,t,u;C=Object.assign({uploadType:"media"},F.attrs);if(!v){return D.call(A,s,y,F)}t=b.parseUrl(f.result(this,"url"));u=F.onFailure;w="---------------------------7da24f2e50046";B="\r\n--"+w+"\r\n";x="\r\n--"+w+"--";z=new window.FileReader();t.path="/upload"+t.path;t.query="uploadType=multipart";F.url=b.composeUrl(t);F.headers=F.headers?a.clone(F.headers,false):{};F.headers["Content-Type"]='multipart/mixed; boundary="'+w+'"';E=new c(function(H,G){z.onload=function(M){var J=new Uint8Array(M.target.result);var L=J.length;var I="";for(var K=0;K<L;K++){I+=String.fromCharCode(J[K])}H(B+"Content-Type: application/json\r\n\r\n"+JSON.stringify(C)+B+"Content-Type: "+C.mimeType+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+window.btoa(I)+x)};z.onerror=G;z.onprogress=y.dispatchAsEventListener("onProgress");z.readAsArrayBuffer(v)});E.then(function(G){F.data=G;return D.call(A,s,y,F)},function(){if(u){u.apply(null,arguments)}})},convertAttrsToBackend:function(t,s){var t=t||this.toJSON();var u={};var y;var x;var v;var w;if(t){if(t.parentId){y=t.parentId}if(t.mimeType){x=t.mimeType}if(t.description){v=t.description}if(t.title){w=t.title}}if(y){u.parents=[{id:y}]}if(!x){x="application/octet-stream"}else{if(x===d.mimeType.folder){x=k.mimeType.folder}}u.mimeType=x;if(v){u.description=v}if(w){u.title=w}return u},parse:function(x){var u,v,t,w,y,s;v=function(B){var A,z,C;z=B.parents||[];if(z.length>1){console.warn("This inode has more than one parent: this is a unexpected case")}A=z[0];if(A!==undefined){if(A.isRoot){C=k.ids.root}else{if(A.id){C=A.id}else{throw new Error("This case was not expected please contact QL8")}}}else{C=k.ids.sharedWithMe}return C};t=function(A){var z;z=A.mimeType;if(z===k.mimeType.folder){z=d.mimeType.folder}return z};w=function(A){var z;if(A.mimeType===k.mimeType.folder){z=k.icons.folder}else{z=A.iconLink}return z};y=function(A,B){var z;z={};if(A.mimeType===k.mimeType.folder){z.medium=k.thumbnails.folder;z.small=k.thumbnails.folder;z.large=k.thumbnails.folder}else{if(A.thumbnailLink){z.medium=A.thumbnailLink.replace(/(.+=)s[0-9]+$/,"$1w240-h180-p-k-nu");z.small=A.thumbnailLink;z.large=A.thumbnailLink.replace(/(.+=)s[0-9]+$/,"$1w1440-h1080-p-k-nu")}else{if(B){B=B.toLowerCase();if(k.thumbnails[B]){z.medium=k.thumbnails[B];z.small=k.thumbnails[B];z.large=k.thumbnails[B]}}else{if(A.mimeType==="audio/mp3"){z.medium=A.iconLink.replace(/(.+=)s[0-9]+$/,"$1w240-h180-p-k-nu");z.small=A.iconLink;z.large=A.iconLink.replace(/(.+=)s[0-9]+$/,"$1w1440-h1080-p-k-nu")}else{if(A.mimeType==="application/x-zip"){z.medium=A.iconLink.replace(/(.+=)s[0-9]+$/,"$1w240-h180-p-k-nu");z.small=A.iconLink;z.large=A.iconLink.replace(/(.+=)s[0-9]+$/,"$1w1440-h1080-p-k-nu")}else{if(A.mimeType==="image/vnd.dwg"){z.medium=A.iconLink.replace(/(.+=)s[0-9]+$/,"$1w240-h180-p-k-nu");z.small=A.iconLink;z.large=A.iconLink.replace(/(.+=)s[0-9]+$/,"$1w1440-h1080-p-k-nu")}}}}}}if(!z.medium){z=undefined}return z};s={id:x.id,parentId:v(x),title:x.title,mimeType:t(x),downloadUrl:x.webContentLink,fileUrl:x.webContentLink,fileExtension:f.computeFileExtension(x.fileExtension),size:x.fileSize,description:x.description,createdDate:x.createdDate,modifiedDate:x.modifiedDate,modifiedByMeDate:x.modifiedByMeDate,sharedWithMeDate:x.sharedWithMeDate,iconLink:w(x),thumbnailLink:y(x,x.fileExtension),owners:x.owners,lastModifyingUser:x.lastModifyingUser,shared:x.shared,userPermission:x.userPermission,writersCanShare:x.writersCanShare};for(u in s){if(s.hasOwnProperty(u)&&s[u]===undefined){delete s[u]}}return s},getFileUrl:function(){var s=this,t;return new c(function(v,u){if(s.get("fileUrl")){return v(s.get("fileUrl"))}return v("")})},getDownloadUrl:function(){var s=this;return new c(function(u,t){if(s.get("downloadUrl")){return u({url:s.get("downloadUrl"),method:"GET"})}})},save:function(u,v,t){t=Object.assign({},t,{});var s;if((!a.is(u))||(a.typeOf(u))==="object"){s=u;t=v}else{s={};s[u]=v}if(!s){t.attrs=this.convertAttrsToBackend();return this._parent(s,t)}if(s.parentid!==undefined){t.url="https://www.googleapis.com/drive/v3/files/"+this.id+"?addParents="+s.parentid+"&removeParents="+this.get("parentId");t.data={};return this._parent({},t)}t.attrs=this.convertAttrsToBackend(s);return this._parent(s,t)},destroy:function(t){var s;t=a.clone(t||{},false);if(t.trash){s=f.result(this,"url");if(s.slice(0,-1)!=="/"){s+="/"}t.url=s+"trash";t.method="POST"}else{t.type="text"}return this._parent(t)},isSharedWithMe:function(u){var t,s;u=u||this.toJSON();t=u.owners||[];if(t.length>1){console.warn("This inode has more than one parent: this is a unexpected case")}s=t[0];return s&&!s.isAuthenticatedUser&&u.shared},getActionIds:function(){var s=m[this.isFolder()?"accessControlListFolder":"accessControlListFile"];if(l(this)){return s.owner}if(e(this)){return s.writerSharer}if(n(this)){return s.writer}if(r(this)){return s.reader}return[]},get3DPlayOptions:function(){var s={asset:{requestsOptions:{authentication:this._auth}}};return this._parent(s)},isActionIdoK:function(s){if(s==="share"&&q.detect(this.getActionIds(),function(t){if(t==="giveReadAccess"||t==="giveEditAccess"){return true}})){return true}else{return this._parent(s)}},doesExistInBackend:function(){var s=this;if(s.id==="sharedwithme"){return new c(function(u,t){return u(true)})}return s._parent.call(s)}});return h});define("DS/W3DDrive/Models/Dropbox/Inode",["UWA/Core","UWA/Array","UWA/Utils","UWA/Class/Promise","DS/W3DDrive/Models/Actions/Dropbox/actionsUtils","DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Models/Inode","DS/W3DDrive/Utils/RequestHelper","DS/W3DContentApp/Utils/Helpers","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,u,c,e,b,z,t,l,h,j){var n=z();var v=t.prototype.defaults;return t.extend({idAttribute:"path_lower",url:function(E){var D="https://api.dropbox.com/2",A="https://content.dropboxapi.com/2",B={metadata:"/files/get_metadata",move:"/files/move","delete":"/files/delete",download:"/files/download",link:"/files/get_temporary_link",thumbnail:"/files/get_thumbnail"},F=B[E]||B.metadata,C=[B.download,B.thumbnail];D=C.indexOf(F)!==-1?A:D;return D+F},formatOptions:function(D,C,A){A=A?A:{};var B={url:this.url(D),method:"POST",headers:{"Content-Type":"application/json"},};B.headers=Object.assign(B.headers,A.headers);return Object.assign(B,C,A)},defaults:a.merge({root:"dropbox"},v),fetch:function(A){if(this.get("mimeType")!==n.mimeType.folder){return}var E=this,D=A?A.onFailure:null,B=this._parent,C=this.formatOptions("metadata",A);d(this).then(function(F){C.data=JSON.stringify({path:F});C.json=true;B.call(E,C)},function(F){if(typeof D==="function"){D.apply(null,arguments)}})},destroy:function(A){A=a.clone(A||{},false);A=this.formatOptions("delete",A,{data:JSON.stringify({path:this.get("path")})});return this._parent(A)},save:function(F,G,E){var D,A=this.get("path"),H="/"+this.get("title");var B="";if((!a.is(F))||(a.typeOf(F))==="object"){D=F;E=G}else{D={};D[F]=G}E=a.clone(E||{},false);if(!D){return this._parent(D,E)}if(D.parentid){B=D.parentid===n.ids.root?"":this.drive.getInode({path_lower:D.parentid}).get("path");H=B+"/"+this.get("title")}else{B=this.get("parentId")===n.ids.root?"":this.get("parentId");H=B+"/"+D.title;if(this.get("title").toLowerCase()===D.title.toLowerCase()){var C=new Error(j.editErrorTitleNameCase);return E.onFailure(this,{error:C})}}E=this.formatOptions("move",E,{method:"POST",data:JSON.stringify({from_path:A,to_path:H,autorename:true,allow_shared_folder:true})});return this._parent(D,E)},sync:function(C,B,A){A.ajax=l.getRequestMethod(A,true);return this._parent(C,B,A)},parse:function(C){var A={id:C.id,rev:C.rev,path:C.path_lower,path_lower:C.path_lower,root:C.root,parentId:s(C),title:C.name,mimeType:g(C,this),downloadUrl:"",fileUrl:"",fileExtension:f(C,this),modifiedDate:C.client_modified,iconLink:p(C,this),owners:"",readOnly:q(C),shared_folder_id:C.shared_folder_id,parent_shared_folder_id:C.parent_shared_folder_id,size:C.size,thumbnailLink:r(C,this)};for(var B in A){if(A.hasOwnProperty(B)&&A[B]===undefined){delete A[B]}}return A},getDownloadUrl:function(){var A=this,B;return new e(function(D,C){if(A.get("downloadUrl")){return D({url:A.get("downloadUrl"),method:"GET"})}B=function(E){D({url:E,method:"GET"})};A.getTemporaryLink(B,C)})},getFileUrl:function(){var A=this,B;return new e(function(D,C){if(A.get("fileUrl")){return D(A.get("fileUrl"))}B=function(E){D(E)};A.getTemporaryLink(B,C)})},getTemporaryLink:function(D,C){var B=this,A=this._auth||this.collection._auth;l.performExternalRequestWithOptions(this.url("link"),{method:"POST",type:"json",headers:{"Content-Type":"application/json"},auth:A,data:JSON.stringify({path:this.get("path")}),onComplete:function(E){B.set("downloadUrl",E.link);B.set("fileUrl",E.link);window.setTimeout(function(){B.set("downloadUrl",undefined);B.set("fileUrl",undefined)},(3600000*4));D(E.link)},onFailure:function(E){C(E)}})},getActionIds:function(){var B=k(this)?"accessControlListSharedFolderChild":this.isFolder()?"accessControlListFolder":"accessControlListFile";var A=b[B];if(m(this)){return A.owner}if(o(this)){return A.writer}if(w(this)){return A.reader}return[]},get3DPlayOptions:function(){var A={asset:{requestsOptions:{authentication:this._auth}}};return this._parent(A)},isActionIdoK:function(A){if(A==="share"&&u.detect(this.getActionIds(),function(B){if(B==="giveReadAccess"||B==="giveEditAccess"){return true}})){return true}else{return this._parent(A)}},doesExistInBackend:function(){return new e(function(B,A){B(true)})}});function i(A){switch(A){case n.ids.root:case n.ids.sharedWithMe:return"/";default:return A+"/"}}function d(A){return new e(function(C,B){if(A.id===n.ids.root){return C("")}if(typeof A.get("parentId")==="undefined"){return C(A.id)}A.drive.getInodesPath(A.id).then(function(D){D.shift();D.shift();var E=D.reduce(function(F,G){return F+"/"+G.get("title")},"");C(E)})})}function m(A){return !A.get("readOnly")}function o(A){return A.get("readOnly")&&!A.get("parent_shared_folder_id")}function w(A){return A.get("readOnly")&&A.get("parent_shared_folder_id")}function k(A){return A.isFolder()&&A.get("parent_shared_folder_id")}function s(C){var B=C.path_lower,A;if(B==="/"||typeof B==="undefined"){return n.ids.trueRoot}A=B.lastIndexOf("/");if(A!==0){return B.slice(0,A)}return n.ids.root}function f(E,A){var D,B;if(!y(E,A)){return""}D=E.path_lower;B=D.split(".");var C=B.length>0?B[B.length-1]:undefined;if(C){return h.computeFileExtension(C)}return""}function x(B,A){if(typeof B[".tag"]!=="undefined"){return B[".tag"]==="folder"}return A.get("mimeType")===n.mimeType.folder}function y(B,A){return !x(B,A)}function g(B,A){if(x(B,A)){return n.mimeType.folder}if(B.media_info){return B.media_info.metadata[".tag"]}}function p(B,A){if(y(B,A)){return B.icon}if(x(B,A)){return n.icons.folder}return n.icons.folder}function r(E,C){var G=f(E,C).toLowerCase();function B(H){H.map(function(I){l.performExternalRequestWithOptions(C.url("thumbnail"),{method:"POST",type:"blob",headers:{"Dropbox-API-Arg":JSON.stringify({path:E.id,size:I.size})},auth:C._auth||C.collection._auth,onComplete:function(L){var K=a.clone(C.get("thumbnailLink")||{});var J=new window.FileReader();J.onloadend=function(){K[I.thumbnailSize]=J.result;C.set("thumbnailLink",K)};if(L){J.readAsDataURL(L)}}})})}var F,A={};var D={jpg:"jpg",jpeg:"jpeg",png:"png",tiff:"tiff",tif:"tif",gif:"gif",bmp:"bmp"};if(x(E,C)){F=E.shared_folder_id?n.thumbnails.sharedFolder:n.thumbnails.folder}if(D[G]){B([{size:"w640h480",thumbnailSize:"medium"},{size:"w1024h768",thumbnailSize:"large"}])}if(y(E,C)&&G){F=n.thumbnails[G.toLowerCase()]}if(F){A.medium=F;A.small=F;A.large=F}else{A=undefined}return A}function q(A){return A.sharing_info?A.sharing_info["read_only"]:false}});define("DS/W3DDrive/W3DDriveTagger6WProxy",["UWA/Core","UWA/Class/Model","UWA/Date","UWA/Utils","DS/TagNavigatorProxy/TagNavigatorProxy","DS/W3DDrive/Collections/Inodes","DS/W3DDrive/Models/Inode","UWA/Class/View","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,b,h,f,j,d,l,a,i,m,k){var c,g;c=new b();c=e.extend(c,{_currentTagger:undefined,_currentDriveId:undefined,isSet:function(n){return n.id===this._currentDriveId},setTaggerProxy:function(o){if(o.isCollabSpace){if(!this.isSet(o)){if(this._currentTagger){this._currentTagger.die();delete this._currentTagger}var n={filteringMode:"FilteringOnServer",events:{},widgetId:m.id,tenant:o.id,};this._currentTagger=j.createProxy(n);this.listenTo(this._currentTagger,{onFilterChange:this.onFilterChange});this._currentDriveId=o.id}}else{if(!this.isSet(o)){if(this._currentTagger){this._currentTagger.die();delete this._currentTagger}if(o.isDsDrive&&m.id){var n={filteringMode:"WithFilteringServices",widgetId:m.id,pod:"6WTags"};if(o.isDsDrive){n=e.merge({tenant:o.id},n)}this._currentTagger=j.createProxy(n);this.listenTo(this._currentTagger,{onFilterSubjectsChange:this._onFilterSubjectsChange})}this._currentDriveId=o.id}}},_parseToTags:function(n){var o;if(n instanceof l){n=[n]}if(Array.isArray(n)||n instanceof d){o={};n.forEach(function(p){o[this._parseInodeToSubjectURI(p)]=this._parseInodeToTags(p)},this)}else{o=n}return o},_parseToSubjectURIs:function(n){if(n instanceof l){return[this._parseInodeToSubjectURI(n)]}return n.map(function(o){if(o instanceof l){o=this._parseInodeToSubjectURI(o)}if(o instanceof a){o=this._parseInodeToSubjectURI(o.model)}return o},this)},_parseInodeToTags:function(u){var q,n,p,o,r,t,s;q=[];n=u.getOwnerNames();if(u.isFolder()){r=k.folder}else{r=k.file;s=i.computeFileExtension(u.get("fileExtension"))}if(u.drive){t=u.drive.get("title")}p=this._parseDate(u.get("modifiedDate"));if(u.get("createdDate")!==""){o=this._parseDate(u.get("createdDate"))}else{o=this._parseDate(u.get("modifiedDate"))}if(n){q.push({object:n,sixw:"ds6w:who/ds6w:responsible",dispValue:n})}if(p){q.push({object:h.strftime(p,"%Y/%m/%d"),sixw:"ds6w:when/ds6w:modified",type:"date"})}if(o){q.push({object:h.strftime(o,"%Y/%m/%d"),sixw:"ds6w:when/ds6w:created",type:"date"})}if(r){q.push({object:r,sixw:"ds6w:what/ds6w:type",dispValue:r})}if(s){q.push({object:s,sixw:"ds6w:what/ds6w:docExtension",dispValue:s})}if(t){q.push({object:t,sixw:"ds6w:where/ds6w:source/ds6w:dataSource",dispValue:t})}return q},_parseDate:function(n){if(typeof n==="number"){return new Date(parseInt(n,10))}return new Date(n)},_parseInodeToSubjectURI:function(n){if(!n){return}return"driveid:"+n.get("id")},_onAdd:function(o,n){this.addSubjectsTagsWithInode(n)},_onRemove:function(n,o){this.setSubjectsTagsWithInode(o)},_onReset:function(n){this.setSubjectsTagsWithInode(n)},onFilterChange:function(p){this._inodeTableView.collection.filterTagObj=p;this._inodeTableView.collection.isNewFilter=true;this._currentTagger.setTags({},[]);var o={reset:true,type:"json",evnt:"onFilterChange"},n;n=o.onComplete;o.onComplete=function(){if(n){n(arguments)}};this._inodeTableView.collection.getFirstPage(o)},_onFilterSubjectsChange:function(n){var o;o=n.filteredSubjectList;if(o.length===this._inodeTableView.collection.length||Object.keys(n.localfilters).length===0){g=undefined}else{g=o}this.dispatchEvent("onFilterSubjectsChange",n)},getFilteredSubjectList:function(){return g},setInodeTable:function(n){if(!n||n===this.inodeTableView){return}this.unSetInodeTable();this._inodeTableView=n;if(m.getValue("is3DSpaceWidget")==="true"){this.listenTo(n.collection,{onFilterChange:this.onFilterChange,onAdd:this._onAdd,onRemove:this._onRemove,onReset:this._onReset});this.setSubjectsTagsWithInode(n.collection)}else{this.listenTo(n.collection,{onAdd:this._onAdd,onRemove:this._onRemove,onReset:this._onReset});this.setSubjectsTagsWithInode(n.collection)}},updateSubjectsTags:function(){g=undefined;if(this._currentTagger){this._currentTagger.unsetTags();this.addSubjectsTagsWithInode(this._inodeTableView.visibleItems)}},unSetInodeTable:function(){if(this._inodeTableView){this.stopListening(this._inodeTableView.collection)}delete this._inodeTableView;g=undefined;if(this._currentTagger){this._currentTagger.unsetTags()}},addSubjectsTagsWithInode:function(n){if(this._currentTagger){if(m.getValue("is3DSpaceWidget")==="true"){return this._currentTagger.addSubjects(n)}else{return this._currentTagger.addSubjectsTags(this._parseToTags(n))}}},setSubjectsTagsWithInode:function(n){if(this._currentTagger){if(m.getValue("is3DSpaceWidget")==="true"){return this._currentTagger.addSubjects(n)}else{return this._currentTagger.setSubjectsTags(this._parseToTags(n))}}},focusOnSubjectsWithInode:function(n){if(this._currentTagger){if(m.getValue("is3DSpaceWidget")){this._currentTagger.focusOnSubjects(["pid://"+n.id])}else{return this._currentTagger.focusOnSubjects(this._parseToSubjectURIs(n))}}},unfocus:function(){if(this._currentTagger){this._currentTagger.unfocus(arguments)}}});return c});define("DS/W3DDrive/Actions/Share/DSDrive/shareToPlatformService",["DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Actions/Share/shareFactory","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDrive/Actions/formFactory","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(f,b,e,d,g){return function(m,i){var j=m[0].drive;var l=f.getActionIds(m);var k=a(m,j,i);var h=j.get("auth").getStorage().url;return new Promise(function(q,p){var n=c({url:h,actionIds:l,inodes:m,shareOptions:k}).render();var o=n.container.querySelector(".paneladdmember-item-view-buttons");n.container.appendChild(o);q(n.container)})};function c(r){var h=r.url;var j=r.actionIds;var i=r.inodes[0];var k=r.shareOptions;var l;var o=b.createTextArea();var n;if(e.isLinkedFile(i)){n=d.createToggleRadios({toggleType:"editType",items:[{value:"all",label:g.shareLinkedFiles},{value:"one",label:g.shareFileOnly}]})}o.render=function(){while(o.container.firstChild){o.container.removeChild(o.container.firstChild)}l.render();var s=b.makeElement();s.classList.add("shareview__options2");var t=[];if(j.indexOf("giveShareAccess")!==-1){t.splice(1,0,b.createReshareElem({className:"shareview__reshare",id:"checkbox-share-member"}))}if(n){t.push(n.container)}t.push(b.createMessageDocFrag());t.reduce(function(u,v){u.appendChild(v);return u},s);o.container.appendChild(l.container);o.container.appendChild(s);return o};l=b.createPlatformInvitationView(h,j,k);var m=l.saveProcess;l.saveProcess=function(){if(typeof k.onComplete!=="function"){return}var s=o.container.querySelector(".js_share-inode_reshare");var u=o.container.querySelector(".js-share-inode_message");var t=m.apply(this,arguments);t=t.map(function(w){var x={message:u.value};if(s&&s.checked){x.role=b.convertCategoriesToSharingRole("giveShareAccess",w.role).role}return Object.assign({},w,x)});var v={};if(n&&n.items[0].isChecked()){v.queryStrings={expand:"true"}}k.onComplete(t,v)};var p=l.destroy;l.destroy=function(){l=null;m=null;j=null;k=null;p.apply(this,arguments)};o.elements.platformInvitationView=l;var q=b.bindViewToModal(o);l.onClose=function(){q.hide()};return o}function a(k,i,h){var j=Object.assign({},h);j.onComplete=function(l,m){if(typeof h.onComplete!=="function"){return}h.onComplete(k,l,m)};if(i.get("shareWithinvitation")){j.onEmailAddress=b.onEmailAddress}return j}});define("DS/W3DDrive/Actions/Share/DSDrive/shareDSDrive",["DS/W3DDrive/Actions/Share/DSDrive/shareToPlatformService","DS/W3DDrive/Actions/Share/DSDrive/shareToSwymService","DS/W3DDrive/Actions/Share/DSDrive/shareByLinkService","DS/W3DDrive/Actions/Share/shareToGroupService","DS/W3DDrive/Actions/Share/shareFactory","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(t,A,d,s,C,h){var b="shareview__platform__container";var x="shareview__swym__container";var l="shareview__bylink__container";var y="shareview__group__container";var m="shareview__header__platform";var v="shareview__header__swym";var j="shareview__header__link";var i="shareview__header__group";return function(K,H){var J;var E=C.makeElement({classes:["shareview"]});var G=C.makeElement({classes:["shareview__header"]});var I=C.makeElement({classes:["shareview__header-text"]});var D=C.makeElement({classes:"shareview__body"});var F=C.createToggler({type:"radio",classes:"shareview__header-tabs",buttons:z({shareToPlatformView:J,shareView:D,shareHeaderText:I,inodes:K,shareOptions:H})});G.appendChild(F);G.appendChild(I);E.appendChild(G);E.appendChild(D);u({shareHeader:G,parentView:D,shareToPlatformView:J,shareHeaderText:I,inodes:K,shareOptions:H});return E};function u(D){if(!D.shareOptions.shareTab){e(D);return}switch(D.shareOptions.shareTab){case"platform":e(D);q({headerClass:m,shareHeader:D.shareHeader});break;case"swym":r(D);q({headerClass:v,shareHeader:D.shareHeader});break;case"link":o(D);q({headerClass:j,shareHeader:D.shareHeader});break;case"group":k(D);q({headerClass:i,shareHeader:D.shareHeader});break;default:e(D);q({headerClass:m,shareHeader:D.shareHeader})}}function q(F){var E=F.shareHeader;if(!E){return}var D=E.querySelector(".tab-item.active");if(D){D.classList.remove("active")}var G=E.getElementsByClassName(F.headerClass);if(G.length===0){return}var H=G[0];H.classList.add("active")}function e(L){var J=L.parentView;var D=L.inodes;var E=L.shareOptions||{};var K=L.shareHeaderText;var G=J.getElementsByClassName(b);var F=G.length>0?G[0]:null;if(!F){var I=C.makeElement({classes:b});E.viewClass=b;var H=t(D,E);H.render();H.inject(I);J.appendChild(I);F=I}C.showModalFooter();a({viewClass:b});F.style.display="block";if(g(D)){K.innerHTML=h.shareInfoUsersExt}else{K.innerHTML=h.shareInfoUsers}return F}function r(E){var H=E.parentView;var I=E.shareHeaderText;var K=E.inodes;var F=H.getElementsByClassName(x);var D=F.length>0?F[0]:null;if(!D){var G=C.makeElement({classes:x});var J=A(K).then(function(L){G.appendChild(L);H.appendChild(G);D=G;C.hideModalFooter();D.style.display="block";I.innerHTML=h.shareInfoSwym})}else{C.hideModalFooter();D.style.display="block";I.innerHTML=h.shareInfoSwym}}function o(L){var J=L.parentView;var E=L.inodes;var F=L.shareOptions;var K=L.shareHeaderText;var G=J.getElementsByClassName(l);var I=G.length>0?G[0]:null;if(!I){var D=C.makeElement({classes:l});var H=d(E,F);D.appendChild(H);J.appendChild(D);I=D}I.style.display="block";C.hideModalFooter();K.innerHTML=h.shareInfoLink;return I}function k(L){var J=L.parentView;var E=L.inodes;var F=L.shareOptions;var K=L.shareHeaderText;var G=J.getElementsByClassName(y);var D=G.length>0?G[0]:null;if(!D){var H=C.makeElement({classes:y});F.viewClass=y;var I=s(E,F);I.render();I.inject(H);J.appendChild(H);D=H}C.showModalFooter();a({viewClass:y});D.style.display="block";K.innerHTML=h.shareInfoGroup;return D}function z(M){var D=M.shareView;var L=M.shareHeaderText;var E=M.inodes;var F=M.shareOptions;var J=[];var H=C.createTabItem({value:h.shareBtnUsers,icon:"fonticon-users-add",classes:m,active:true,});H.addEventListener("click",function(){B({exclude:b,parentView:D});e({parentView:D,shareHeaderText:L,inodes:E})});J.push(H);if(w(E)){var I=C.createTabItem({value:h.shareBtnSwym,icon:"fonticon-users-alt",classes:v});I.addEventListener("click",function(){B({exclude:x,parentView:D});r({parentView:D,shareHeaderText:L,inodes:E})});J.push(I)}if(c(E)){var G=C.createTabItem({value:h.shareableLink,icon:"fonticon-link",classes:j});G.addEventListener("click",function(){B({exclude:l,parentView:D});o({parentView:D,shareHeaderText:L,inodes:E,shareOptions:F})});J.push(G)}if(f(E)){var K=C.createTabItem({value:h.shareBtnGroup,icon:"fonticon-users-group-add",classes:i});K.addEventListener("click",function(){B({exclude:y,parentView:D});k({parentView:D,shareHeaderText:L,inodes:E,shareOptions:F})});J.push(K)}return J}function B(F){var H=F||{};var G=F.parentView;var D=H.exclude;var I=Array.isArray(D)?D:[D];var E=[b,x,l,y];E.filter(function(J){return I.indexOf(J)===-1}).map(function(J){n({className:J,parentView:G});p({viewClass:J})})}function n(E){var G=E.className;var H=E.parentView;if(!G||!H){return}var F=H.getElementsByClassName(G);if(F.length===0){return}var D=F[0];D.style.display="none"}function p(D){var F=D.viewClass;var E=C.getModalFooterButtons({buttonClass:F});E.map(function(G){G.style.display="none"})}function a(D){var F=D.viewClass;var E=C.getModalFooterButtons({buttonClass:F});E.map(function(G){G.style.display="inline-block"})}function w(F){if(F.length>1){return false}var E=F[0];var D=E.drive;return D.isDsDrive&&!E.isFolder()}function g(E){if(!E.length||E.length===0){return false}var D=E[0].drive;return D.get("shareWithinvitation")}function c(D){if(!D.length||D.length===0){return false}return D.length===1}function f(D){if(!D.length||D.length===0){return false}return typeof D[0]._auth.platform.urlUsersGroup!=="undefined"}});define("DS/W3DDrive/Actions/downloadAction",["DS/W3DDrive/Metas/drive","DS/W3DDrive/Metas/errors","DS/W3DDrive/Utils/IntegrationHelper","DS/W3DDrive/Actions/download","DS/W3DDrive/Utils/StructureNavigation","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/Utils/Alert","DS/W3DDrive/widget","DS/UIKIT/Input/Toggle","DS/W3DDrive/Utils/Metrics","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c,j,i,f,k,g,b,h,d,l){return function(o){var p=Object.assign({},o);var n=p.model;if(!n){throw"A model is mandatory to initiate a download action."}d.incActionTracker({actionName:"download",model:n,context:p.context}).inc();if(j.SWIntegration&&j.SWIntegration.downloadFile){j.SWIntegration.downloadFile(JSON.stringify({fileId:n.id}));return}if(f.hasRelations(n)&&n.drive.isDsDrive&&b.getValue("isStandalone")!==true){return m(p)}e(p)};function m(r){var q=r.model;var o={name:"downloadType",className:"primary"};var p=new h(Object.assign({},o,{value:"all",label:l.downloadLinkedFiles})).check();var s=new h(Object.assign({},o,{value:"one",label:l.downloadFileOnly}));var n=document.createElement("div");n.appendChild(p.elements.container);n.appendChild(s.elements.container);return k.dialog({title:l.download+" "+q.get("title"),body:n,buttons:[{className:"primary",value:l.download,action:function(t){t.hide();var u=p.isChecked();if(u){e(Object.assign({},r,{data:{expand:true}}));return}e(r)}},{value:l.cancel,action:function(t){t.hide()}}]})}function e(o){var q=a();var n=o.model;var s=n.get("title");var r=c().xmlhttprequestCodes;if(n.drive&&n.drive.get("id")===q.ids.google2&&n.get("size")>=11000000){var p={message:" Google Drive link",url:n.get("fileUrl")};g.addWithLink({message:l.replace(l.downloadExceedSize,{name:s}),className:"error"},p);return}n.getDownloadUrl(o).then(function(t){var u=t.url;if(!u){g.add({message:l.replace(l.emptyDownload,{name:s}),className:"warning"});return}i(u,t.method,n)},function(t){if(t&&t.hasOwnProperty("status")&&t.status===r.CONFLICT){g.add({message:l.replace(l.duplicationError,{msg:t.data.error.message,fileName:t.data.error.filename}),className:"error"})}else{g.add({message:l.replace(l.downloadError,{name:s}),className:"error"})}})}});define("DS/W3DDrive/Models/3DSpace/MyCollabSpaceContent",["UWA/Core","UWA/Class/Promise","DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Models/Inode","DS/W3DDrive/Models/Actions/CollabSpaces/actionsUtils","DS/W3DDrive/Utils/RequestHelper"],function(a,c,r,p,n,k){var m;var h=r();function b(t){return new c(function(w,v){var u;try{if(t.id){u=t._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+t.get("parentId")+"/contents/"+t.id+"/preview";setTimeout(function(){k.performRequestWithOptions(u,{type:"json",onComplete:w,onFailure:v})},7000)}}catch(x){v(x)}})}function o(u,t){var v={},z,w,y,x;if(u){if(u.parentId){z=u.parentId}if(u.description){w=u.description}if(u.title){y=u.title}if(u.parentId){x=u.parentId+"/"}}if(z){v.parents=[{id:z}]}if(w){v.description=w||""}if(y){v.title=y}if(t){v.uploadType="media"}return v}function q(t,u){return new c(function(x,w){var v;v="{0}/resources/enocsmrest/collabspaces/{1}/ticket?id={2}".format(u.url3DSpace,t.get("parentId"),window.Date.now());k.performRequestWithOptions(v,{method:"GET",type:"json",onComplete:function(y){x(y)},onFailure:w})})}function j(t,v,u){var w;w=Object.assign({data:{},headers:{"Content-Type":"application/json;charset=utf-8"}},v);return[{title:t.title,duplicatedfrom:t.duplicatedfrom,collabspace:u.get("parentId")},w]}function g(t){return t.actionurl}function i(t){return t.jobticket}function e(t){return t.ticket}function f(t){return[g(t),i(t),e(t)]}function d(t){var v,u;v=a.createElement("div").setHTML(t);u=v.getElement('[name="__fcs__jobReceipt"]');return u.value}function l(A,v,z,u,t){var y,x,w;y=new window.FormData();x={};x[v]=z;x["file-name"]=u.name;x.file_0=u;x["file-title"]=u.name;x["file-description"]=u.name;Object.keys(x).map(function(B){y.append(B,x[B])});w=new window.XMLHttpRequest();w.open("POST",A,true);return new c(function(C,B){w.onload=function(){if(this.status>=200&&this.status<400){C(this.response)}else{B("file upload in FCS failed")}};w.onerror=function(){B()};w.upload.onprogress=t.dispatchAsEventListener("onProgress");w.send(y)})}function s(u,x,w,t){var v;v=Object.assign({actions:[],businessobj:{description:"",file:t,fullnameowner:"",icon:"",maturity:"",modified:"",owner:{},thumbnail:"",title:t.split(".")[0],type:{}},collabspace:u.collabspace});return c.cast([v,x,w])}m=p.extend({idAttribute:"id",parse:function(y){var v,t;function u(B){var A;if(B){A=B.fullnameowner}return(A?[{displayName:A}]:undefined)}function x(A){if(!A){return}return parseInt(A,10)*1000}function z(B){var A={};A.medium=B;A.small=B;A.large=B;return A}function w(B){var A=[];if(B){B.map(function(C){if(C.split("/")[0].toLowerCase()==="types"){A.push(C.split("/")[1])}else{A.push(C)}})}return A}t={id:y.id,parentId:y.collabspace,title:y.businessobj?y.businessobj.title.replace(/&amp;/g,"&"):undefined,name:y.businessobj?y.businessobj.name.replace(/&amp;/g,"&"):undefined,createdDate:y.businessobj?x(y.businessobj.created):undefined,type:y.businessobj?y.businessobj.type:undefined,modifiedDate:y.businessobj?x(y.businessobj.modified):undefined,thumbnailLink:y.businessobj?z(y.businessobj.thumbnail):undefined,iconLink:y.businessobj?y.businessobj.icon:undefined,description:y.businessobj?y.businessobj.description.replace(/&amp;/g,"&"):undefined,family:{},owners:y.businessobj?u(y.businessobj):undefined,downloadUrl:"",fullnameowner:y.businessobj?y.businessobj.fullnameowner:undefined,maturity:y.businessobj?y.businessobj.maturity:undefined,version:y.businessobj?y.businessobj.version:undefined,actions:y.actions,taxonomies:y.businessobj?w(y.businessobj.taxonomies):undefined,icon:y.businessobj?y.businessobj.icon:undefined};for(v in t){if(t.hasOwnProperty(v)&&t[v]===undefined){delete t[v]}}return t},getDownloadUrl:function(){var u=this,t="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/download".format(this._auth.platform.url3DSpace,this.get("parentId"),this.get("id"));return new c(function(w,v){k.performRequestWithOptions(t,{type:"json",onComplete:function(x){var y=x?x.url:null;u.set("downloadUrl",y);w({url:y,method:"POST"})},onFailure:v})})},getThumbnailLink:function(){var t=this,u=this.get("fileExtension");u=u.toLowerCase();if(u==="jpg"||u==="jpeg"||u==="png"||u==="gif"||u==="bmp"){return this.getDownloadUrl().then(function(v){return{medium:t.get("thumbnailLink").medium,small:t.get("thumbnailLink").small,large:v.url}})}else{return new c(function(w,v){w({medium:t.get("thumbnailLink").medium,small:t.get("thumbnailLink").small,large:t.get("thumbnailLink").medium})})}},getFileUrl:function(){var u=this,t="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/fileurl".format(this._auth.platform.url3DSpace,this.get("parentId"),this.get("id"));return new c(function(w,v){k.performRequestWithOptions(t,{type:"json",onComplete:function(y){var x=y?y.url:null;var z=y?y.extension:null;u.set("fileUrl",x);u.set("fileExtension",z);w(x)},onFailure:v})})},sync:function(t,A,J){if(t!=="create"){return this._parent(t,A,J)}var D=this,w,C=this.collection._auth.getStorage(),x=J.file||{},H=o(A._attributes||(A.toJSON()),A.isNew()),F=j(H,J,A),I=A._parent.bind(A),v=J.onFailure,u;var E=[];if(this.collection&&this.collection._parentInode){E=this.collection._parentInode.extensionsAllowed||[]}var z=x.name.substring(x.name.lastIndexOf("."),x.name.length);var y=RegExp(z,"i");var B=E.some(function(K){return y.test(K)});if(z.length===0||B===false){return v(new Error("Extension not supported"))}if(J.action==="update"){u="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/versions".format(A._auth.platform.url3DSpace,A.get("parentId"),A.get("id"))}else{u="{0}/resources/enocsmrest/collabspaces/{1}/contents".format(A._auth.platform.url3DSpace,A.get("parentId"))}J.headers=J.headers||{};J.headers["Content-Type"]="application/json;charset=UTF-8";function G(K,M,L){if(J.action==="update"){J.data={title:K.businessobj.file,file:K.businessobj.file,modified:K.businessobj.modified,filedescription:K.businessobj.description,download:"",preview:"",index:"",physicalid:"",versionnumbers:"",actions:["download"]}}else{J.data=M||{};J.data=K}J.type="json",J.data=JSON.stringify(J.data);J.url=u+"?receipt="+encodeURIComponent(L);return I(t,A,J)}w=q.call(A,A,C).then(f).spread(function(M,K,L){return l(M,K,L,x,D)}).then(d);c.all(F.concat(w).concat(x.name)).spread(s).spread(G).then(function(){b(D).then(function(L){var K={medium:L.thumbnail,small:L.thumbnail,large:L.thumbnail};D.set("thumbnailLink",K);if(D.get("contentVersions")){D.get("contentVersions").fetch()}})})["catch"](function(K){v(K)})},destroy:function(t){t=a.clone(t||{},false);var w;if(!this.get("type")){return this._parent(t)}if(this.get("type").value!==h.boType.document){var t;var v=this.collection._parentInode.get("contexts");var u=v[0].name?v[0].name:v[1];w=this._auth.platform.url3DSpace+"/resources/lifecycle/Delete/structure?SecurityContext=ctx::"+u;var x={data:[{physicalid:this.id}],options:[{nlsKey:"Whole Structure",type:"checkbox",value:false,key:"wholeStructure"}]};t=Object.assign({type:"json",method:"POST",data:JSON.stringify(x),headers:{"Content-Type":"application/json",Accept:"application/json",SecurityContext:"ctx::"+u},url:w},t)}else{w=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("parentId")+"/contents/"+this.id;t=Object.assign({headers:{"Content-Type":"application/json"},url:w,method:"DELETE"},t)}return this._parent(t)},save:function(w,x,v){var u;var t="";v=Object.assign({},v);if((!a.is(w))||(a.typeOf(w))==="object"){u=w;v=x}else{u={};u[w]=x}if(!u){return this._parent(u,v)}if(u.parentid){t=this._auth.platform.url3DSpace+"/resources/restmove/collabspaces/"+this.get("parentId")+"/moveable/"+this.get("id");k.performRequestWithOptions(t,{method:"PUT",data:JSON.stringify({collabspace:w.parentid}),headers:{"Content-type":"application/json"},onComplete:v.onComplete,onFailure:v.onFailure})}if(w.action==="editContent"){t=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("parentId")+"/contents/"+this.id;return this._parent(this,Object.assign({},v,{url:t,type:"json",method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json;charset=utf-8"},data:JSON.stringify({actions:this.get("actions"),businessobj:{created:this.get("createdDate"),description:w.attributes.description,fullnameowner:this.get("fullnameowner"),icon:this.get("iconLink"),maturity:this.get("maturity"),modified:this.get("modified"),owner:this.owner,physicalid:this.id,thumbnail:this.get("thumbnail"),title:w.attributes.title,type:this.get("type"),version:this.get("version")},collabspace:w.inode.get("parentId"),id:w.inode.id})}))}},getActionIds:function(){var t=n.getContentActions(this);return t},"onChange:id":function(v,x,u){var w,t;w=this;function y(A){var z={};z.medium=A;z.small=A;z.large=A;return z}if(u&&u.from===undefined){b(this).then(function(z){if(z.thumbnail!==null){t=y(z.thumbnail);w.set("thumbnailLink",t)}})}},getNLSType:function(){return this.get("type").name},get3DPlayOptions:function(){return{asset:{provider:"EV6",physicalid:this.id,dtype:this.get("type").value,tenant:this._auth.platformId,serverurl:this._auth.platform.url3DSpace,requiredAuth:"passport"}}},isPlayable:function(){return false},doesExistInBackend:function(){var t=this;return new c(function(v,u){t.sync("GET",t,{onComplete:function(w){if(w.businessobj&&(w.businessobj.contexts||w.businessobj.maturity)){v(true)}else{v(false);t.destroy({noSync:true})}},onFailure:function(){v(false);t.destroy({noSync:true})}})})}});return m});define("DS/W3DDrive/Models/DSDrive/TrashInode",["UWA/String","DS/W3DDrive/Models/Inode","DS/W3DDrive/Utils/RequestHelper","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Metas/inode"],function(f,c,g,d,b){var a=b();var e=d();return c.extend({url:function(){return f.format("{0}/{1}",this.collection.url(),this.id)},parse:function(j){var h={};var i=this;Object.keys(j).map(function(l){var m=l;var k=j[l];if(l==="fullnameowner"){m="owners"}if(l==="modified"){m="modifiedDate";k*=1000}if(l==="created"){m="createdDate";k*=1000}if(l==="parentid"){m="parentId"}if(l===""){m="oldParentFolder"}h[m]=k});h.thumbnailLink=i.getThumbnailLink(j,j.mimetype,j.type,j.extension);return h},sync:function(j,i,h){return this._parent.apply(this,arguments)},getOwnerNames:function(){return this.get("owners")},getThumbnailLink:function(l,k,i,n){var h=this;var j=this.get("extension")||n;j=j.toLowerCase();var m;if(this.get("thumbnail")){m=this.get("thumbnail")}else{if(i===e.boType.folder){m=e.thumbnails.folder}else{m=e.thumbnails[j]||e.thumbnails.content}}if(j==="jpg"||j==="jpeg"||j==="png"||j==="gif"||j==="bmp"){this.addEventOnce("onChange:id",function(){h.getPreviewUrl().then(function(o){h.set("thumbnail",o.thumbnail);h.set("thumbnailLink",{small:o.thumbnail,medium:o.thumbnail,large:o.thumbnail})},function(){})})}else{}return{small:m,medium:m,large:m}},getPreviewUrl:function(i){i=i||{};var j=this;var h=f.format("{0}/{1}/preview",g.getBaseUrl(this._auth.getStorage().url),this.id);return new Promise(function(l,k){var m=function(n){l(n)};i.onComplete=m;i.onFailure=function(n,o){k({status:n,data:o})};g.performRequestWithOptions(h,i)})},getActionIds:function(){return[a.actionPubIds.restore,a.actionPubIds.del]},isActionIdoK:function(h){return this._parent.apply(this,arguments)},restore:function(i){i=i||{};var h=this;return new Promise(function(m,l){var k;var j={url:h.url(),method:"PUT",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},data:JSON.stringify(Object.assign({physicalid:h.id},i)),onComplete:m,onFailure:function(o){var p;var n;if(o&&o.hasOwnProperty("error")===true&&o.error.hasOwnProperty("message")===true&&o.error.hasOwnProperty("errorCode")===true){p=o.error.message;n=o.error.errorCode}l({status:k.xhr.status,msg:p,code:n})}};k=h.sync("update",h,j)})}})});define("DS/W3DDrive/Models/DSDrive/PermissionLink",["DS/W3DDrive/Metas/DSDrive/permission","DS/W3DDrive/Models/Permission","DS/WebappsUtils/WebappsUtils",],function(b,d,c){var a=b();return d.extend({idAttribute:"id",type:"link",parse:function(e){return{id:e.mail,displayName:e.mail,emailAddress:e.mail,domain:e.domain,picture:{medium:c.getWebappsAssetUrl("W3DDrive","default_people.png")},}},destroy:function(g){var h=this.collection._parentInode;var f=h._auth.platform.url+"/resources/share/accesses/"+h.get("id")+"/restrictions";var e=g||{};e=Object.assign(e,{url:f,method:"PUT",headers:{"Content-Type":"application/json"},data:JSON.stringify({operation:"remove",items:[{domain:this.get("domain"),mail:this.get("emailAddress")}]})});return this._parent(e)},isActionAllowed:function(){var f=this.collection._parentInode;var e=f.get("accessright");if(e===a.roles.delegate||e===a.roles.readerSharer){return true}return false}})});define("DS/W3DDrive/Actions/Permissions/CollabSpace",["DS/W3DDrive/Metas/permission","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c){var b=a();return function(d){d.actions=d.actions.concat([{id:b.actionPubIds.removePermission,text:c.remove,icon:"fonticon fonticon-cancel",handler:function(){var f=d.model;var g;if(d.model.get("resourceid")){g=document.createTextNode(c.RemoveConfirmationMsgGroup)}else{g=document.createTextNode(c.RemoveConfirmationMsg)}return d.openDialog({titleNLSKey:"shareRemove",modalBodyContent:[g],confirmAction:{NLSKey:c.remove,handler:function(){d.dispatchPermissionActions("onRemoveCollabSpaceMember",[f])}}})}},{id:b.actionPubIds.makePublicReader,text:c.publicreader,icon:"fonticon fonticon-eye",handler:function(){e("PublicReader")}},{id:b.actionPubIds.makeReader,text:c.readercs,icon:"fonticon fonticon-eye",handler:function(){e("Reader")}},{id:b.actionPubIds.makeContributor,text:c.contributor,icon:"fonticon fonticon-eye",handler:function(){e("Contributor")}},{id:b.actionPubIds.makeAuthor,text:c.author,icon:"fonticon fonticon-feather",handler:function(){e("Author")}},{id:b.actionPubIds.makeLeaderOwner,text:c.leaderOwner,icon:"fonticon fonticon-star ",handler:function(){e("Leader")}},{id:b.actionPubIds.makeMainOwner,text:c.mainOwner,icon:"fonticon fonticon-key",handler:function(){e("mainOwner")}}]);function e(f){d.dispatchPermissionActions("onUpdateCS",[d.model,f])}return d}});define("DS/W3DDrive/Models/3DSpace/ContentVersion",["UWA/Class/Promise","UWA/Class/Model","DS/W3DDrive/Utils/RequestHelper"],function(a,d,c){var b=d.extend({idAttribute:"physicalid",parentId:"",drive:"",parse:function(g){var e={};var f;e={physicalid:g.physicalid,file:g.file,masterid:g.masterid,title:g.title,modified:g.modified,actions:g.actions,fileExtension:g.title.split(".")[1]};for(f in e){if(e.hasOwnProperty(f)&&e[f]===undefined){delete e[f]}}return e},getDownloadUrl:function(){var f=this,e="{0}/resources/enocsmrest/collabspaces/{1}/contents/{2}/versions/{3}/download".format(this.collection._auth.platform.url3DSpace,this.collection.parentId,this.get("masterid"),this.id);return new a(function(h,g){c.performRequestWithOptions(e,{type:"json",onComplete:function(i){var j=i?i.url:null;f.set("downloadUrl",j);h({url:j,method:"POST"})},onFailure:g})})},isActionIdoK:function(){return"download"},isActionAllowed:function(g){var e=this.get("actions").reduce(function(i,h){i[h]=true;return i},{});var f=g.replace("Version","");return e[f]===true}});return b});define("DS/W3DDrive/Collections/3DSpace/ContentVersions",["UWA/Core","DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/3DSpace/ContentVersion"],function(d,a,c){var b=a.extend({model:c,id:"",parentId:"",parentCS:"",url:function(){return this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.parentId+"/contents/"+this.id+"/versions"},fetch:function(e){e=(e||{});var f=Object.assign({},e);return this._parent(e)},sync:function(g,f,e){return this._parent(g,f,e)},parse:function(e){this.dispatchEvent("onUpdate");return e}});return b});define("DS/W3DDrive/Actions/Iterations/Collabspace",["DS/W3DDrive/Metas/inode","DS/W3DDrive/Actions/downloadAction","DS/W3DDrive/Utils/contextHelpers","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c,b,d){return function(h){var e=a();var g=h.model;var f="version";h.actions=h.actions.concat([{id:e.actionPubIds.downloadVersion,text:d.download,icon:"download",fonticon:"download",handler:function(){c({model:g,context:f})}}]);h.actions=b.actionsFilters.applyCurrentContexts(h.actions);return h}});define("DS/W3DDrive/Metas/GoogleDrive/permission",["DS/W3DDrive/Metas/permission"],function(a){return function(){var e=a();var d="owner";var b="commenter";var c="read";var f="edit";e.roles={reader:c,writer:f};e.sharedRoles=Object.assign({},e.roles);e.roles.owner=d;e.roles.commenter=b;e.roleToFrontend=function(g){switch(g){case e.roles.reader:return"reader";case e.roles.writer:return"writer";case b:return"commenter";case d:return"owner";default:return""}};return e}});define("DS/W3DDrive/Models/Dropbox/MainRoot",["DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/Dropbox/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(e,c,b,f,g){var a=c();var d=e();var h=b.extend(f,{defaults:{parentId:d.ids.trueRoot,title:g.replace(g.myDrive,{serviceName:"Dropbox"}),mimeType:d.mimeType.folder,iconLink:d.icons.folder,thumbnailLink:{small:d.thumbnails.folder,medium:d.thumbnails.folder,large:d.thumbnails.folder}},getActionIds:function(){return["createFolder","upload"]}});return h});define("DS/W3DDrive/Models/DSDrive/InodeVersion",["UWA/Class/Model","UWA/String","UWA/Class/Promise","DS/W3DDrive/Utils/RequestHelper"],function(e,c,b,d){var f=e.extend({drive:"",parse:function(g){return{accessright:g.accessright,actions:g.actions,created:g.created,description:g.description,fileExtension:g.extension,fullnameowner:g.fullnameowner,hashmd5:g.hashmd5,icon:g.icon,id:g.id,iterationNumber:g.iterationNumber,masterid:g.masterid,mimetype:g.mimetype,modified:g.modified,owner:g.owner,size:g.size,title:g.title,thumbnail:a(this),type:g.type}},getDownloadUrl:function(){var h=this,g=c.format("{0}/resources/3ddrive/v1/bos/{1}/download",this.collection._auth.getStorage().url,this.get("id"));return new b(function(j,i){d.performRequestWithOptions(g,{type:"json",onComplete:function(k){var l=k?k.url:null;h.set("downloadUrl",l);j({url:l,method:"POST"})},onFailure:i})})},setup:function(){this._parent.apply(this,arguments)},refreshPreview:function(){var g=this;this.getPreviewUrl().then(function(h){if(h&&h.hasOwnProperty("thumbnail")){g.set("thumbnail",h.thumbnail)}})},getPreviewUrl:function(){var g=c.format("{0}/resources/3ddrive/v1/bos/{1}/preview",this.collection._auth.getStorage().url,this.get("id"));return new b(function(i,h){d.performRequest(g,i,h)})},restoreVersion:function(){var h=this;var i=this.collection;var g=c.format("{0}/resources/3ddrive/v1/bos/{1}/iterations",this.collection._auth.getStorage().url,this.collection._parentInode.get("id"));return new b(function(k,j){d.performRequestWithOptions(g,{type:"json",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},auth:h.collection._auth,data:JSON.stringify({id:h.get("id")}),onComplete:function(){i.onRestore({reset:true,merge:false,onComplete:k,onFailure:j})},onFailure:j})})},isActionIdoK:function(){return"download"},isActionAllowed:function(i){var g=this.get("actions").reduce(function(k,j){k[j]=true;return k},{});var h=i.replace("Version","");return g[h]===true}});function a(h){var g;var i=h.collection._parentInode.get("thumbnailLink");Object.keys(i).some(function(j){if(i[j]){g=i[j];return true}});return g}return f});define("DS/W3DDrive/Models/Dropbox/SharedWithMeRoot",["DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/Dropbox/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(d,c,b,e,h){var a=c();var g=d();var f=b.extend(e,{defaults:{parentId:g.ids.trueRoot,title:h.sharedWithMe,mimeType:a.mimeType.folder,iconLink:g.icons.folder,thumbnailLink:{small:g.thumbnails.folderShared,medium:g.thumbnails.folderShared,large:g.thumbnails.folderShared}},getActionIds:function(){return[]}});return f});define("DS/W3DDrive/Models/Dropbox/InodeFactory",["DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Models/Dropbox/Inode","DS/W3DDrive/Models/Dropbox/MainRoot","DS/W3DDrive/Models/Dropbox/SharedWithMeRoot"],function(d,a,g,e){var f=d(),c={};c[f.ids.root]=g;c[f.ids.sharedWithMe]=e;function b(j,i){var k=j[a.prototype.idAttribute],h=c[k];if(!h){h=a}return new h(j,i)}b.prototype.idAttribute=a.prototype.idAttribute;return b});define("DS/W3DDrive/Collections/Dropbox/Inodes",["UWA/Core","UWA/Utils","UWA/Class/Promise","DS/W3DDrive/Collections/Inodes","DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Models/Dropbox/InodeFactory","DS/W3DDrive/scheduleTasksToGlobalSession","DS/W3DDrive/Utils/errors","DS/W3DDrive/Utils/RequestHelper"],function(g,h,i,f,j,n,b,k,d){var l;var e=j();function m(o){return new i(function(p){if(o.id===e.ids.root){return p("")}if(typeof o.get("parentId")==="undefined"){return p(o.id)}o.drive.getInodesPath(o.id).then(function(q){q.shift();q.shift();var r=q.reduce(function(s,t){return s+"/"+t.get("title")},"");p(r)})})}function a(o){return new i(function(r,q){var p=new window.FileReader();p.onload=function(s){r(new Uint8Array(s.target.result))};p.onerror=q;p.readAsArrayBuffer(o)})}function c(s,p,r,q){var o=typeof q.limit==="number"?q.limit:Infinity;return{start:p,end:(p+r)>o?o:(p+r)}}l=f.extend({url:function(s){var r="https://api.dropbox.com/2",o="https://content.dropboxapi.com/2",p={upload:"/files/upload",copy:"/files/copy",createFolder:"/files/create_folder",fetch:"/files/list_folder",uploadStart:"/files/upload_session/start",uploadAppend:"/files/upload_session/append_v2",uploadEnd:"/files/upload_session/finish"},t=p[s]||"",q=[p.upload,p.uploadStart,p.uploadAppend,p.uploadEnd];r=q.indexOf(t)!==-1?o:r;return r+t},getContentType:function(o){return o.indexOf("upload")!==-1?"application/octet-stream":"application/json"},formatOptions:function(p,r,q){var o={url:this.url(p),method:"POST",data:q&&q.data?q.data:r.data,headers:{"Content-Type":this.getContentType(p)},onProgress:r.onProgress||q.onProgress};o.headers=Object.assign(o.headers,q.headers);return Object.assign({},r,o)},create:function(p,o){o.parentSync=this._parent;if(p.duplicatedfrom){return this.copy(p,o)}if(p.mimeType===e.mimeType.folder){return this.createFolder(p,o)}this.upload(p,o)},copy:function(p,o){var r=p.duplicatedfrom.substr(p.duplicatedfrom.lastIndexOf("/")),q=this._parentInode.get("path_lower");q=(q===e.ids.root?"":q)+r;o=this.formatOptions("copy",o,{data:JSON.stringify({from_path:p.duplicatedfrom,to_path:q,allow_shared_folder:true,autorename:true})});return o.parentSync.call(this,p,o)},createFolder:function(p,o){var r=(this._parentInode.get("path")||"")+"/"+p.title,q=this.formatOptions("createFolder",o,{data:JSON.stringify({path:r})});return o.parentSync.call(this,p,q)},upload:function(p,o){var q=o.file,r=(1024*500);o=Object.assign(o,{cursor:{},model:p,chunkSize:r,rangeStart:0,rangeEnd:r});if(q.size>r){return this.chunkedUpload(o)}this.oneTimeUpload(o)},shareChildren:function(q,p){var o=this;var r=q.reduce(function(u,s){if(!o.contains(s)){return u}var t=s.permissions;return p.map(function(w){var v=t.findWhere({emailAddress:w.emailAddress});if(v){return function(){return new i(function(y,x){v.save({role:w.role},{patch:true,onComplete:function(z){y({inode:s,permission:z})},onFailure:function(z){x({inode:s,permission:z})}})})}}return function(){return new i(function(y,x){t.create(w,{wait:false,onComplete:function(z){y({inode:s,permission:z})},onFailure:function(z){t.remove(z);x({inode:s,permission:z})}})})}}).concat(u)},[]);return b(r)},oneTimeUpload:function(o){var q=this,p=o.file;a(p).then(function(r){o=q.formatOptions("upload",o,{data:r,headers:{"Dropbox-API-Arg":JSON.stringify({path:(q.dot().get("path")||"")+"/"+p.name,mode:"add",autorename:true})},onProgress:function(s){o.rangeStart=s.loaded;q.updateProgress(o)}});return o.parentSync.call(q,o.model,o)},function(r){if(typeof o.onFailure==="function"){o.onFailure(o.model,r,o)}})},chunkedUpload:function(p){var q=this,o=p.file.slice(p.rangeStart,p.rangeEnd);a(o).then(function(r){p.data=r;if(p.rangeEnd>=p.file.size){return q.lastPartUpload(p)}q.partUpload(p)})},partUpload:function(p){var q=this,o={url:this.url("uploadAppend"),apiArg:{close:false,cursor:p.cursor},responseType:"text"};if(p.rangeStart===0){o=Object.assign(o,{url:this.url("uploadStart"),apiArg:{close:false},responseType:"json"})}d.performExternalRequestWithOptions(o.url,{method:"POST",type:o.responseType,data:p.data,auth:q._auth,headers:{"Content-Type":"application/octet-stream","Dropbox-API-Arg":JSON.stringify(o.apiArg)},onComplete:function(s){var r=c(p.rangeStart,p.rangeEnd,p.chunkSize,{limit:p.file.size});s=typeof s==="object"?s:p.cursor;s.offset=r.start;p=Object.assign(p,{rangeStart:r.start,rangeEnd:r.end,cursor:s});q.updateProgress(p);q.chunkedUpload(p)}})},updateProgress:function(r){var p,q=r.model;if(document.createEvent){p=document.createEvent("Event");p.initEvent("progress",true,true)}else{p=new Event("progress")}var o=r.file.size;p=Object.assign(p,{total:o,loaded:r.rangeStart,lengthComputable:o>0?true:false});q.dispatchEvent("onProgress",[p],q)},lastPartUpload:function(o){o=this.formatOptions("uploadEnd",o,{headers:{"Content-Type":"application/octet-stream","Dropbox-API-Arg":JSON.stringify({cursor:o.cursor,commit:{path:(this.dot().get("path")||"")+"/"+o.file.name,mode:"add",autorename:true}})}});return o.parentSync.call(this,o.model,o)},fetch:function(o){var q=this,p=this._parent,r=this.dot();m(r).then(function(s){o=q.formatOptions("fetch",o,{data:JSON.stringify({path:s})});return p.call(q,o)},function(s){o.onFailure.call(q,s,o)})},sync:function(q,p,o){o.ajax=d.getRequestMethod(o,true);return this._parent(q,p,o)},parse:function(o){return o.entries},sort:function(o){if(o&&o.sorting&&o.sorting.logic.attributeName==="createdDate"){return}return this._parent.apply(this,arguments)},model:n});return l});define("DS/W3DDrive/Models/GoogleDrive/SharedWithMeRoot",["DS/W3DDrive/Metas/GoogleDrive/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/GoogleDrive/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(h,d,e,f,g){var b=d();var a=h();var c=e.extend(f,{defaults:{parentId:a.ids.trueRoot,title:g.sharedWithMe,mimeType:b.mimeType.folder,iconLink:a.icons.folder,thumbnailLink:{small:a.thumbnails.folderShared,medium:a.thumbnails.folderShared,large:a.thumbnails.folderShared}},getActionIds:function(){return[]}});return c});define("DS/W3DDrive/Models/GoogleDrive/Permission",["UWA/Core","DS/W3DDrive/Metas/GoogleDrive/permission","DS/W3DDrive/Models/Permission","DS/W3DDrive/Utils/RequestHelper"],function(l,e,n,i){var f=e();var b="owner";var k="writer";var m="reader";var j={};j[b]="owner";j[k]="writer";j[m]="reader";function h(p){var q=p.role;if(!q){return}return j[q]}function a(q){var p=q.name;if(p){return p}return q.type}function d(q){var p;Object.keys(j).some(function(r){if(j[r]!==q){return false}p=r;return true});return p}function o(q){var p=Object.assign({},q);p.role=d(p.role);return p}function g(q){if(q.photoLink){return p(q.photoLink)}return p(f.thumbnails.people);function p(r){return Object.keys({small:null,medium:null,large:null}).reduce(function(s,t){s[t]=r;return s},{})}}var c=n.extend({parse:function(r){var p={id:r.id,displayName:a(r),emailAddress:r.emailAddress,picture:g(r),role:h(r)};for(var q in p){if(p.hasOwnProperty(q)&&p[q]===undefined){delete p[q]}}return p},save:function(r,s,q){var p;if(!r||typeof r==="object"){p=r;q=s}else{p={};p[r]=s}q.attrs=o(p||this.toJSON());return this._parent(p,q)},sync:function(r,q,p){p.ajax=i.getRequestMethod(p,true);return this._parent(r,q,p)},getActionIds:function(){var q=[];var r=this.collection._parentInode;var p=this.get("role");if(!r||p===j[b]){return q}var s=r.getActionIds();if(s.indexOf("removeAccess")!==-1){q.push("removePermission")}if(s.indexOf("giveReadAccess")!==-1&&p!==j[m]){q.push("makeReader")}if(s.indexOf("giveEditAccess")!==-1&&p!==j[k]){q.push("makeWriter")}return q}});return c});define("DS/W3DDrive/Collections/Dropbox/SharedWithMeRootInodes",["DS/W3DDrive/Collections/Dropbox/Inodes","DS/W3DDrive/Utils/dropbox"],function(d,a){var c=a(),b;b=d.extend({url:function(){return"https://api.dropbox.com/1/shared_folders/?include_membership=true"},parse:function(e){return e.filter(c.isSharedWithMe)}});return b});define("DS/W3DDrive/Collections/DSDrive/InodeVersions",["UWA/Class/Promise","DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/DSDrive/InodeVersion","DS/W3DDrive/Utils/RequestHelper","UWA/String"],function(d,a,f,e,c){var b=a.extend({model:f,init:function(i,g){g=g||{};var h=g.parentInode;if(!h){throw new Error("You must specify a valid parentInode options")}this._parentInode=h;return this._parent.apply(this,arguments)},setup:function(j,g){this.reset();var i=g.parentInode;this._parentInode=i;var h=this;this._parentInode.addEvent("onChange:modifiedDate",function(){if(h.hide===false){h.fetch({})}});return this._parent.apply(this,arguments)},url:function(){if(!this._auth&&this._parentInode._auth){this._auth=this._parentInode._auth}return c.format("{0}/resources/3ddrive/v1/bos/{1}/iterations",this._auth.getStorage().url,this._parentInode.get("id"))},reset:function(){this.hide=true;return this._parent.apply(this,arguments)},fetch:function(g){this.hide=false;var h=g.onComplete;g.inode=this._parentInode;g.method="GET";g.headers=g.headers||{};g.headers["Content-Type"]="application/json";g.onComplete=function(i,j){if(j.items){if(h){h.apply(null,arguments)}return}if(g.onFailure){g.onFailure.call(null,null,j)}};return this._parent.apply(this,arguments)},requestPreviews:function(i){var g;g=c.format("{0}/resources/3ddrive/v1/bos/previews",this._auth.getStorage().url);var h=[];var j=30;i.reduce(function(l,m,k){l=l.concat(m);if(l.length===j||k===i.length-1){h.push(new d(function(o,n){e.performRequest(g,o,n,{ids:l.join(",")})}));l=[]}return l},[]);return h},parse:function(i){if(!i.items){return[]}var g=this;var h=[];i.items.map(function(j){if(j.hasOwnProperty("id")){h.push(j.id)}});d.all(this.requestPreviews(h)).then(function(l){if(l.length===0){return}var k=l[0];var j=k.items.filter(function(m){return m.thumbnail.length>0});g.push(j,{parse:false,merge:true})});return i.items.sort(function(k,j){if(parseInt(k.modified)===parseInt(j.modified)){return 1}else{if(parseInt(k.modified)===parseInt(j.modified)){return 0}else{return -1}}}).reverse()},onRestore:function(i){var g=this;var j=function(){g.fetch(i)};var h=function(){if(i.hasOwnProperty("onFailure")&&typeof i.onFailure==="function"){i.onFailure(arguments)}};this._parentInode.fetch({onComplete:j,onFailure:h});this._parentInode.loadPreview({waitingTime:1})}});return b});define("DS/W3DDrive/Collections/GoogleDrive/Permissions",["DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/GoogleDrive/Permission","DS/W3DDrive/Utils/RequestHelper"],function(a,b,c){var d;d=a.extend({url:function(){var e="https://www.googleapis.com/drive/v2/files/";e+=this._parentInode.id;return e+"/permissions/"},init:function(g,e){e=e||{};var f=e.parentInode;if(!f||!f.id){throw new Error("You must specify a valid parentInode options")}this._parentInode=f;return this._parent.apply(this,arguments)},parse:function(e){return e.items},sync:function(g,f,e){e.ajax=c.getRequestMethod(e,true);return this._parent(g,f,e)},model:b,create:function(e,f){e=Object.assign({value:e.emailAddress},e);f=Object.assign({attrs:e},f);return this._parent(e,f)},createMany:function(h,f){if(!Array.isArray(h)){throw new Error("createMany should be used with an array for attributes param")}var g=this;return e(h);function e(l){var i=l.pop();if(!i){return Promise.resolve([])}var k=new Promise(function(n,m){g.create(i,{onComplete:n,onFailure:m})});return k.then(j,j);function j(m){return e(l).then(function(n){return n.concat(k)})}}}});return d});define("DS/W3DDrive/Collections/Dropbox/RootInodes",["DS/W3DDrive/Collections/Dropbox/Inodes","DS/W3DDrive/Collections/Stub","DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Models/Dropbox/InodeFactory"],function(e,c,b){var a=b();var d=e.extend(c,{init:function(h,g){var f=[a.ids.root].map(function(j){var i={};i[this.model.prototype.idAttribute]=j;return i},this).map(function(l){var j;var k;for(k=0;(!j&&k<h.length);k++){if(h[k].id===l.id){j=h[k]}}return(j||l)});return this._parent(f,g)}});return d});define("DS/W3DDrive/Models/DSDrive/Permission",["UWA/String","DS/W3DDrive/Metas/DSDrive/permission","DS/W3DDrive/Models/Permission","DS/W3DDrive/Utils/RequestHelper"],function(c,m,l,g){var b=m().actionPubIds;var a="edit";var i="read";var j="read_share";var o="edit_share";var h={};h[a]="writer";h[i]="reader";h[j]="readerSharer";h[o]="writerSharer";var f=l.extend({idAttribute:"id",url:function(p){var t=p||{};var q=t.withActions;var s=t.action;var r=c.format("{0}/resources/3ddrive/v1/bos/{1}/accesses",this._auth.getStorage().url,this.collection._parentInode.get("id"));if(s==="edit"||s==="delete"){r+="/"+this.id}var u="";if(q){u="?withactions=true"}return r+u},getPeopleLogin:function(q){var p=c.format("{0}/resources/3ddrive/v1/peoples/{1}",this._auth.getStorage().url,encodeURIComponent(q));return new Promise(function(s,r){var t=function(u){if(u.login){s(u.login)}else{r()}};g.performRequest(p,t,r)})},sync:function(v,r,q){if(v!=="create"){return this._parent(v,r,q)}r.set("id",r.get("pid"));var s=this._parent;var u=q.onComplete;var t=q.onFailure;var p=new Promise(function(y,x){var w=q.attrs||(r.toJSON());if(typeof w.personID==="string"){return y(w)}return r.getPeopleLogin(w.emailAddress).then(function(z){return y(Object.assign(w,{personID:z}))},function(){x(w)})});p.then(function(x){var z=n(x);var w=r.url({withActions:true});w=g.addQueryStrings({url:w,queryStrings:q.queryStrings});var y=Object.assign({url:w,data:JSON.stringify(z),headers:{"Content-Type":"application/json"},method:"POST",onComplete:function(A){if(A){if(typeof u==="function"){u.apply(this,arguments)}}else{if(typeof t==="function"){t()}}}},q);s.call(r,v,r,y)},function(w){if(typeof t==="function"){t(new Error(c.format("{0} is not a member of the platform. Shared contents are only available for platform members",w.emailAdress)))}})},save:function(s,r){if(!s){return this._parent(this,r)}this.set("role",s.role);this.set("message",s.message);var q=r.attrs||(this.toJSON());var p=this.url({action:"edit",withActions:true});p=g.addQueryStrings({url:p,queryStrings:r.queryStrings});var u=n(q);var t=Object.assign({url:p,data:JSON.stringify(u),headers:{"Content-Type":"application/json"},method:"PUT"},r);this._parent(this,t)},destroy:function(p){var q=p||{};if(q.queryStrings){q.url=g.addQueryStrings({url:this.url(),queryStrings:q.queryStrings})}q.url=this.url({action:"delete"});return this._parent(q)},parseFromOwnershipVector:function(p){p=p.ownershipVector[0].ownership;return p.reduce(function(q,r){q.push(Object.assign({access:r.access.logical},r.owner.person));return q},[])},parse:function(p){if(p.lname==="Unknown"){return{actions:this.converActions({accessright:p.accessright,actions:p.actions}),displayName:p.email+" (pending)",id:p.id,login:p.login,picture:d(this,p.login),role:e(p),accessright:p.accessright}}else{return{actions:this.converActions({accessright:p.accessright,actions:p.actions}),displayName:p.name,emailAddress:p.email,id:p.id,login:p.login,picture:d(this,p.login),role:e(p),accessright:p.accessright}}},converActions:function(p){var s=p.accessright;var t=p.actions;if(!t){return undefined}var q={"share.edit":this.getEditAction({accessright:s,actions:t}),"share.read":this.getReadAction({accessright:s,actions:t}),"share.remove":b.removePermission,"share.noreshare":b.disableShare,"share.reshare":b.enableShare};var r=t.map(function(u){return q[u]});return r},getEditAction:function(p){var q=p.accessright;var r=p.actions;if(r.indexOf("share.noreshare")>-1&&q.indexOf("share")>-1){return b.makeWriterShare}return b.makeWriter},getReadAction:function(p){var q=p.accessright;var r=p.actions;if(r.indexOf("share.noreshare")>-1&&q.indexOf("share")>-1){return b.makeReaderShare}return b.makeReader},getActionIds:function(){return this.get("actions")||[]}});return f;function e(p){var q=p.accessright;if(!q){return}return h[q]}function d(q,p){var r=q._auth.getSwymService()+"/api/user/getpicture/login/"+p+"/format/normal";return{small:r,medium:r,large:r}}function k(q){var p;Object.keys(h).some(function(r){if(h[r]!==q){return false}p=r;return true});return p}function n(p){return{id:(p.id||""),email:p.emailAddress,message:p.message,accessright:k(p.role)}}});define("DS/W3DDrive/Collections/GoogleDrive/PermissionsFactory",["DS/W3DDrive/Collections/GoogleDrive/Permissions","DS/W3DDrive/Collections/Stub","DS/W3DDrive/Metas/GoogleDrive/inode"],function(d,b,e){var c=e(),a={};a[c.ids.sharedWithMe]=d.extend(b);return function(h,g){var i=g.parentInode,f;if(!i){return}f=a[i.id];if(!f){f=d}return new f(h,g)}});define("DS/W3DDrive/Collections/Dropbox/InodesFactory",["DS/W3DDrive/Collections/Dropbox/Inodes","DS/W3DDrive/Collections/Dropbox/RootInodes","DS/W3DDrive/Collections/Dropbox/SharedWithMeRootInodes","DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Models/Dropbox/InodeFactory"],function(g,e,d,a,f){var h=a(),b={},c;b[h.ids.trueRoot]=e;b[h.ids.sharedWithMe]=d;c=function(l,j){var k=j.parentInode,i;if(!k){return}i=b[k.id];if(!i){i=g}return new i(l,j)};c.prototype.model=f;return c});define("DS/W3DDrive/Collections/DSDrive/Permissions",["UWA/Core","UWA/String","DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/DSDrive/Permission"],function(e,d,a,b){var c=a.extend({model:b,url:function(){return d.format("{0}/resources/3ddrive/v1/bos/{1}/accesses?withactions=true",this._auth.getStorage().url,this._parentInode.get("id"))},init:function(h,f){f=f||{};var g=f.parentInode;if(!g||!g.id){throw new Error("You must specify a valid parentInode options")}this._parentInode=g;return this._parent.apply(this,arguments)},fetch:function(f){var g=f.onComplete;f.method="GET";f.headers=f.headers||{};f.headers["Content-Type"]="application/json";f.onComplete=function(h,i){if(i.accesses){if(g){g.apply(null,arguments)}return}if(f.onFailure){f.onFailure.call(null,null,i)}};return this._parent.apply(this,arguments)},create:function(f,g){return this._parent.call(this,{displayName:f.emailAddress,emailAddress:f.emailAddress,message:f.message,role:f.role,pid:f.pid,personID:f.personID},g)},parse:function(f){return f.accesses}});return c});define("DS/W3DDrive/Models/3DSpace/CollabSpacePermission",["UWA/Core","UWA/String","DS/W3DDrive/Metas/3DSpace/permission","DS/W3DDrive/Models/Permission","DS/W3DDrive/Metas/3DSpace/inode","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(h,d,o,l,i,n){var c=o();var j=i();function m(p,r){if(p.get("actions")){if(p.get("actions").length===0){return false}else{for(var q=0;q<p.get("actions").length;q++){if(p.get("actions")[q]==="edit.role.leader"&&r===c.roles.leader){return true}if(p.get("actions")[q]==="edit.role.author"&&r===c.roles.author){return true}if(p.get("actions")[q]==="edit.role.contributor"&&r===c.roles.contributor){return true}if(p.get("actions")[q]==="edit.role.reader"&&r===c.roles.reader){return true}if(p.get("actions")[q]==="edit.role.publicreader"&&r===c.roles.publicReader){return true}if(p.get("actions")[q]==="delete"&&r==="removePermission"){return true}if(!p.get("fullRole").restricted&&r==="makeMainOwner"){return true}}}}if(p.get("isOwnerCs")){return false}}var k={removePermission:function(p){return m(p,"removePermission")},makeReader:function(p){return m(p,c.roles.reader)},makePublicReader:function(p){return m(p,c.roles.publicReader)},makeContributor:function(p){return m(p,c.roles.contributor)},makeAuthor:function(p){return m(p,c.roles.author)},makeLeaderOwner:function(p){return m(p,c.roles.leader)},makeMainOwner:function(p){return m(p,"makeMainOwner")}};var b=Object.keys(c.actionPubIds).reduce(function(p,q){p[c.actionPubIds[q]]=k[q];return p},{});function f(p){if(p.value.toLowerCase()==="reader"){p.value="readercs"}return p.value.toLowerCase()}function e(q,p){var r;if(q._auth.getSwymService()){r=q._auth.getSwymService()+"/api/user/getpicture/login/"+p+"/format/normal"}else{r=j.thumbnails.defaultPeople}return{small:r,medium:r,large:r}}function g(q,p){var r;r=q+"."+p+"@3ds.com";return r}var a=l.extend({idAttribute:"id",convertAttrsToBackend:function(q){var p;if(q.role===j.boType.leader){p=true}else{p=false}return{actions:q.actions?q.actions:[],collabspace:q.collabspace?q.collabspace:"",contents:null,id:q.id,isownercs:q.isOwnerCs?q.isOwnerCs:false,people:q.people?q.people:q.personID,picture:q.people?q.people.picture:"",role:{value:q.role,admin:p}}},parseFromResp:function(p){if(p.people){p=p.people;return p.reduce(function(q,r){q.push(Object.assign({access:r.access},r));return q},[])}},parse:function(r){var B={};if(r){var q,p,y,u,v,C,A,z,x,t,s,w;if(r.people){q=r.people.name;p=r.people.fname;y=r.people.lname;u=f(r.role);C=r.role.admin;A=r.collabspace;z=r.isownercs;x=r.role;t=e(this,r.people.login);s=r.actions;w=r.people.email?r.people.email:""}else{q=r.owner.name;p=r.owner.fname;y=r.owner.lname;u=c.roles.leader;C=true;A=r.name;z=true;x=r.owner;t=e(this,r.owner.login);s=[];w=""}if(q){B.displayName=q}if(u){B.role=u;B.accessright=u;if(C){B.role=u+"Owner"}}B.picture=t;B.actions=s;B.collabspace=A;B.pid=r.id;B.isOwnerCs=z;B.people=r.people;B.fullRole=x;B.emailAddress=w}return B},save:function(r,q){if(!r){return this._parent(this,q)}if(r.role==="mainOwner"){this.set("role",j.boType.leaderOwner);this.set("id",this.get("pid"));var t={actions:this.collection._parentInode.get("actions"),contents:this.collection._parentInode.get("contents"),contexts:this.collection._parentInode.get("contexts"),created:this.collection._parentInode.get("created"),description:this.collection._parentInode.get("description"),family:this.collection._parentInode.get("family"),members:this.collection._parentInode.get("members"),name:this.collection._parentInode.get("name"),owner:{login:this.get("people").login},solution:this.collection._parentInode.get("solution"),thumbnail:this.collection._parentInode.get("thumbnail"),title:this.collection._parentInode.get("title"),visibility:this.collection._parentInode.get("visibility")};var p=q.attrs||(this.toJSON());var s=Object.assign({data:JSON.stringify(t),headers:{"Content-Type":"application/json"},method:"PUT",url:d.format("{0}/resources/enocsmrest/collabspaces/{1}",this._auth.getStorage().url3DSpace,this.collection._parentInode.get("id"))},q)}else{this.set("role",r.role);this.set("id",this.get("pid"));var p=q.attrs||(this.toJSON());var s=Object.assign({data:JSON.stringify(this.convertAttrsToBackend(p)),headers:{"Content-Type":"application/json"},method:"PUT",url:d.format("{0}/resources/enocsmrest/collabspaces/{1}/members/{2}",this._auth.getStorage().url3DSpace,this.collection._parentInode.get("id"),this.get("pid"))},q)}this._parent(this,s)},destroy:function(q){var p;p=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.collection._parentInode.get("id")+"/members/"+this.get("pid");q=h.clone(q||{},false);q=Object.assign({method:"DELETE",url:p},q);this.set("id",this.get("pid"));return this._parent(q)},isActionAllowed:function(q){var p=b[q];if(!p){return false}return p(this)}});return a});define("DS/W3DDrive/Collections/3DSpace/CollabSpacePermissions",["UWA/Core","DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/3DSpace/CollabSpacePermission","DS/W3DDrive/Collections/Pagination","DS/W3DDrive/Metas/3DSpace/inode"],function(f,b,g,e,c){var a=c().ids.myCollabSpaces;var d=b.extend({model:g,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0},updateState:function(h){this.state=Object.assign({},this.state,h)},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"memberTotal"},url:function(){return this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this._parentInode.id+"/members?embed=people"},parseResponseForStateUpdate:function(k,i,j,h){return{totalRecords:k.memberTotal,lastPage:(k.nbPages>0)?k.nbPages-1:0}},parseRecords:function(i,h){return i.items},init:function(j,h){var i;h=h||{};i=h.parentInode;if(!i||(!i.id&&!h.isGroupPermission)){throw new Error("You must specify a valid parentInode options")}this._parentInode=i;return this._parent.apply(this,arguments)},parse:function(j,h){var i=this.parseResponseForStateUpdate(j,Object.assign({},this.queryParams),Object.assign({},this.state),h);if(i){this.updateState(i)}return this.parseRecords(j,h)},fetch:function(h){if(h.firstLoad){this.state.currentPage=0;this.state.firstPage=0;this.state.pageSize=20;this.state.lastPage=0}var k=Object.assign({},this.state);var i=this;var j=Object.keys(this.queryParams).reduce(function(n,l){var m=i.queryParams[l];var o=k[l];m=((typeof m==="function")?m.call(i):m);o=((typeof o==="function")?o.call(i):o);if(m!=null&&o!=null){n[m]=o}return n},{});h.data=Object.assign({},h.data,j);if(h.from!=="refresh"&&h.inode!==a){this._parent.apply(this,arguments)}},sort:function(h){h=h||{};if(!h.sorting||(h.sorting.id===this._sorting.id)){return this._parent.apply(this,arguments)}this._sorting=h.sorting;return this.getFirstPage({reset:true})},create:function(h,i){i=f.clone(i||{},false);function k(m,o){var l;for(var n=0;n<m._parentInode.get("owners").length;n++){if(m._parentInode.get("owners")[n].displayName.trim()===o.trim()){l=true}else{l=false}}return l}var j={actions:[],collabspace:"",contents:null,isownercs:k(this,(h.fullname?h.fullname:"")),people:h.login,picture:"",role:{value:h.role,admin:h.isAdmin,restricted:h.isRestricted}};i.data=JSON.stringify(j);i.headers={Accept:"application/json","Content-Type":"application/json"};i.url=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this._parentInode.id+"/members";return this._parent(h,i)}});d=e(d);return d});define("DS/W3DDrive/Actions/addToMyDriveActions",["DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Utils/RequestHelper","UWA/Class/Promise","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(d,f,b,e,h){return function(k,j){if(!k){return}if(j.action==="add"){g(k)}else{if(j.action==="remove"){i(k)}}};function g(j){a({method:"POST",inode:j,data:{objectid:j.get("id"),service:"drive",tenant:j._auth.platform.id,sharer:j.drive.get("user").id,restricted:"false"}}).then(function(k){if(k[0].addtomydrive){var l=j.get("actions").slice();l.splice(l.indexOf("addToMyDrive"),1);j.set("actions",l)}d.add({message:h.replace(h.addToMyDriveSuccess,{name:j.get("title")}),className:"success"})},function(k){if(Array.from(k).includes(412)){d.add({message:h.childAlreadyExists,className:"error"})}else{d.add({message:h.replace(h.addToMyDriveError,{name:j.get("title")}),className:"error"})}})}function c(j){a({method:"DELETE",inode:j}).then(function(){d.add({message:h.replace(h.removeFromMyDriveSuccess,{name:j.get("alias")}),className:"success"})},function(){d.add({message:h.replace(h.removeFromMyDriveError,{name:j.get("alias")}),className:"error"})})}function i(k){var j={title:h.replace(h.removeElement,{name:k.get("alias")?k.get("title"):k.get("title")}),body:h.removeElementBody,buttons:[{className:"primary",value:h.remove,action:function(l){c(k);l.hide();k.collection.remove(k)}},{value:h.cancel,action:function(l){l.hide()}}]};return f.dialog(j)}function a(l){if(!l.inode){throw"inode object parameter is expected"}var m=l.inode;var k=l.inode._auth.platform.url+"/resources/3ddrive/v1/sharedcontent/"+m.get("id")+"?withactions=true";var j=l.requestOptions||{};if(l.data){j.data=l.data}if(l.method){j.method=l.method}if(j.data){j.data=JSON.stringify(j.data)}return new e(function(o,n){b.performRequestWithOptions(k,Object.assign({method:"GET",type:"json",auth:l.inode._auth,headers:{"Content-Type":"application/json"},onComplete:function(){return o(arguments)},onFailure:function(){return n(arguments)}},j))})}});define("DS/W3DDrive/Collections/DSDrive/PermissionsFactory",["DS/W3DDrive/Collections/DSDrive/Permissions","DS/W3DDrive/Collections/Stub","DS/W3DDrive/Metas/DSDrive/inode"],function(c,b,f){var e=f();var d=c.extend(b);var a={};a[e.ids.root]=d;a[e.ids.sharedWithMe]=d;return function(i,h){var j=h.parentInode;var g;if(!j){return}g=a[j.id];if(!g){g=c}return new g(i,h)}});define("DS/W3DDrive/Collections/3DSpace/UserGroups",["DS/W3DDrive/Collections/3DSpace/CollabSpacePermissions","DS/W3DDrive/Models/3DSpace/UserGroup","UWA/String"],function(a,c,b){return a.extend({model:c,url:function(){if(!this._auth&&this._parentInode._auth){this._auth=this._parentInode._auth}return b.format("{0}/resources/enocsmrest/collabspaces/{1}/groups",this._auth.platform.url3DSpace,this._parentInode.get("id"))},init:function(f,d){d=d||{};var e=d.parentInode;if(!e){throw new Error("You must specify a valid parentInode options")}d.isGroupPermission=true;return this._parent.apply(this,arguments)},setup:function(f,d){this.reset();var e=d.parentInode;this._parentInode=e;return this._parent.apply(this,arguments)},find:function(e){var d=function(f){return f.get("resourceid")===e};return this._parent.apply(this,[d])},fetch:function(d){var e=d.onComplete;d.inode=this._parentInode;d.method="GET";d.headers=d.headers||{};d.headers["Content-Type"]="application/json";d.onComplete=function(f,g){if(g.items){if(e){e.apply(null,arguments)}return}if(d.onFailure){d.onFailure.call(null,null,g)}};return this._parent.apply(this,arguments)},parse:function(d){if(d.items){return d.items}else{return d}}})});define("DS/W3DDrive/Models/3DSpace/MyCollabSpace",["UWA/Core","UWA/Class/Promise","UWA/Class/Model","DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Models/Inode","DS/W3DDrive/Models/Actions/CollabSpaces/actionsUtils","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Collections/3DSpace/UserGroups","DS/W3DDrive/Utils/RequestHelper","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(j,g,p,d,e,m,i,k,h,c,l){var b=e();var f=d();var a;function n(q){return new g(function(t,s){var r;try{r=k.result(q,"url");if(r[r.length-1]!=="/"){r+="/"}r+="preview";c.performRequestWithOptions(r,{type:"json",onComplete:t,onFailure:s})}catch(u){s(u)}})}function o(q,s){var r;if(q){r=q[s];if(j.is(r,"function")){r=r.call(q)}}return r}a=m.extend({idAttribute:"name",versions:[],extensionsAllowed:[".3dxml",".step",".stp",".stpz",".ifc",".ifczip",".smg",".rvt",".rfa",".stl",".jpg",".jpeg",".png",".gif",".tif",".tiff",".bmp",".svg",".flv",".avi",".mov",".wmv",".mpg",".mpeg",".mp4",".m4v",".rm",".webm",".mkv",".mp3",".wav",".aac",".m4a",".wma",".ra",".ogg",".doc",".docx",".ppt",".pptx",".pps",".ppsx",".xls",".xlsx",".xlsm",".pdf",".zip",".txt",".csv",".json",".xml",".geojson",".mdb",".gml",".kml",".sdm",".omf",".str",".mineschedanimation"],extensionsAllowedThumbnail:[".jpg",".jpeg",".png",".gif",".tif",".tiff",".bmp",".svg"],setup:function(){this.userGroups=new h([],{parentInode:this,auth:this._auth});return this._parent(arguments)},url:function(){var q="";if(this.isNew()){return q}var r=this._auth;if(!r){return q}var s=this._auth.platform;if(!s){return q}q="{0}/resources/enocsmrest/collabspaces/{1}?embed=contexts&sort=amodified".format(s.url3DSpace,this.id);return q},parse:function(u){var r,q;u.id=u.name;function t(){var w;w=b.icons.collabSpace;return w}function v(y,x){var w,z;w={};if(y.thumbnail){z=y.thumbnail}else{z=x._auth.platform.url3DSpace+"/webapps/W3DSpace/assets/img/defaultThumb.png"}w.medium=z;w.small=z;w.large=z;return w}function s(w){if(!w){return}return parseInt(w,10)*1000}q={name:u.name,id:u.id,parentId:b.ids.myCollabSpaces,mimeType:f.mimeType.collabSpace,title:u.title,contexts:u.contexts,thumbnailLink:v(u,this),iconLink:t(),description:u.description,createdDate:s(u.created),modifiedDate:u.modified?s(u.modified):s(u.created),family:u.family,visibility:u.visibility,solution:u.solution,owner:"",contents:"",members:"",actions:u.actions,owners:u.owner?u.owner:undefined};for(r in q){if(q.hasOwnProperty(r)&&q[r]===undefined){delete q[r]}}return q},save:function(B,s,C){C=Object.assign({},C,{});var z;if((!j.is(B))||(j.typeOf(B))==="object"){z=B;C=s}else{z={};z[B]=s}if(!z){return this._parent(B,C)}if(B.action==="changeThumbnail"){var A=this.extensionsAllowedThumbnail;var w=B.file.name.substring(B.file.name.lastIndexOf("."),B.file.name.length);var v=RegExp(w,"i"),r=C.onFailure;var y=A.some(function(D){return v.test(D)});if(w.length===0||y===false){return r(new Error("Extension not supported, please try with an image"))}C=j.clone(C||{},false);C.file=B.file;C.type="json";this.set("thumbnailLink",{});var x=this,u=B.file,q=u.name,t=C.onComplete;C.onComplete=function(E,F,D){j.extend(D,F);D.onComplete=function(H,J,G){G.onComplete=function(L,M,K){if(t){return t(L,M,K)}};var I={actions:x.get("actions"),contents:x.get("contents"),contexts:x.get("contexts"),created:x.get("created"),description:x.get("description")?x.get("description"):"",family:x.get("family"),members:x.get("members"),name:x.get("name"),owner:x.get("owners"),solution:x.get("solution"),thumbnail:q,title:x.get("title"),visibility:x.get("visibility")};G.method="PUT";G.url=o(H,"url").split("?")[0]+"?receipt="+encodeURIComponent(J.receipt);G.data=JSON.stringify(I);G.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"};p.prototype.save.call(x,I,G)};E.checkInThumbnailFile(D)};return this.getTicket(j.extend({model:this},C))}else{z={actions:this.get("actions"),contents:this.get("contents"),contexts:[],created:this.get("createdDate"),description:B.csAtrributes.description,family:B.csAtrributes.family,members:null,name:this.get("name"),owner:this.get("owners"),solution:this.get("solution"),thumbnail:this.get("thumbnailLink").medium,title:B.csAtrributes.title,visibility:{value:B.csAtrributes.visibility}};C.method="PUT";C.url=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+B.actualName;C.data=JSON.stringify(z);C.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"};return this._parent(this,C)}},destroy:function(q){q=j.clone(q||{},false);var r=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.get("id");var q=Object.assign({headers:{"Content-Type":"application/json"},url:r,method:"DELETE"},q);return this._parent(q)},getDetailsUndeletedCS:function(s){var r=s,q="{0}/resources/enocsmrest/collabspaces/{1}/typesleft".format(s._auth.platform.url3DSpace,s.get("id"));return new g(function(u,t){c.performRequestWithOptions(q,{type:"json",onComplete:function(v){u(v.types)},onFailure:t})})},doesItHaveContent:function(){var q="{0}/resources/enocsmrest/collabspaces/{1}/contents".format(this._auth.platform.url3DSpace,this.get("id"));return new g(function(s,r){c.performRequestWithOptions(q,{onComplete:function(t){s(t)},onFailure:r})})},getTicket:function(s){var u=this,r=o(this,"url").split("?")[0]+"/ticket?id="+Date.now(),t,q,v;s=s?j.clone(s,false):{};q=s.model;v=s.onComplete;s.onComplete=function(w){if(v){return v(u,u.parseTicket(w),s)}};t=c.performRequestWithOptions(r,j.extend(j.extend({type:"json"}),s,true));return t},parseTicket:function(q){return{urlFCS:q.actionurl,ticket:{name:q.jobticket,value:q.ticket}}},checkInThumbnailFile:function(s){s=s?j.clone(s,false):{};if(!s.urlFCS){throw new Error('A "url" must be specified')}var v=this,r=s.urlFCS,x=s.onComplete,w,q,u;s.onComplete=function(y){if(x){return x(v,v.parseThumbnailFileReceipt(y),s)}};w=new FormData();q=this.getThumbnailFileForm(s);for(var t in q){w.append(t,q[t])}u=new XMLHttpRequest();u.open("POST",r);u.onreadystatechange=function(){if(u.readyState===4){if(u.status===200){s.onComplete(u.responseText)}else{if(s.onFailure){s.onFailure(u.responseText)}}}};u.send(w);return u},parseThumbnailFileReceipt:function(r){var q=j.createElement("div").setHTML(r).getElement('[name="__fcs__jobReceipt"]').value;return{receipt:q}},getThumbnailFileForm:function(r){r=r?j.clone(r,false):{};var q={};if(r.ticket&&r.ticket.name){q[r.ticket.name]=r.ticket.value}j.extend(q,{__fcs__jobTicket:r.ticket.value,"file-name":r&&r.file.name,file_0:r&&r.file,"file-title":r&&r.file.name,"file-description":r&&r.file.name});return q},getAnalyticsLastModified:function(t){if(!t){t={}}var v,s=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics",q="lmpt,lastmodified,nbmodified",r=t.modified;if(r){r="&modified="+r}var u=s+"?fields="+q+r;v=c.performRequestWithOptions(u,{type:"JSON",onComplete:t.onComplete});return v},getAnalyticsContents:function(r){if(!r){r={}}var t,q=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics",s="cpt,cpm,nbcontents";var u=q+"?fields="+s;t=c.performRequestWithOptions(u,{type:"JSON",onComplete:r.onComplete});return t},getAnalyticsMembers:function(t){if(!t){t={}}var u,s=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this.id+"/analytics",r="mpr,nbmembers";var q=s+"?fields="+r;u=c.performRequestWithOptions(q,{type:"JSON",onComplete:t.onComplete});return u},securityContext:function(v){var s=v.get("contexts");var r=["VPLMProjectLeader","VPLMCreator","VPLMExperimenter","VPLMViewer","VPLMProjectAdministrator"];var t;if(s&&!s[0].role){var q=[];s.map(function(x){q.push({name:x,role:x.split(".")[0]})});s=q}var w="{0}/resources/pno/person/setsecuritycontext".format(this._auth.platform.url3DSpace);c.performRequestWithOptions(w,{method:"POST",data:{SecurityContext:u()}});function u(){var x=s.map(function(y){var z=y.role?y.role:y.split(".")[0];if(z==="VPLMProjectLeader"){return 0}else{if(z==="VPLMCreator"){return 1}else{if(z==="VPLMExperimenter"){return 2}else{if(z==="VPLMViewer"){return 3}else{if(z==="VPLMProjectAdministrator"){return 4}else{return 5}}}}}});t=s.filter(function(y){return y.role===r[Math.min.apply(null,x)]});return t[0].name}},getActionIds:function(){var q=i.getCollabSpaceActions(this);if(this.drive.id==="OnPremise"||(this._auth&&this._auth.platform&&this._auth.platform.urlUsersGroup)){q=q.concat(f.actionPubIds.viewPermissionsGroup)}return q},getPreview:function(r){if(!r){r={}}var t=this,s,q=o(this,"url").split("?")[0]+"/preview",u=r.onComplete;r.onComplete=function(v){t.set("thumbnail",v.thumbnail);if(u){return u(t,v,r)}};c.performRequestWithOptions(q,j.extend({type:"json"},j.extend(r,true)));return s},isActionIdoK:function(q){if(q===f.actionPubIds.share){return(this._parent("giveEditAccess")||this._parent("giveReadAccess"))}if(q===f.actionPubIds.addMember){return(this._parent("Contributor")||this._parent("Author")||this._parent("Leader")||this._parent("Reader")||this._parent("PublicReader"))}if(q===f.actionPubIds.addMemberRestricted){if(this._parent("Contributor")){return false}else{return(this._parent("Contributorrestricted")||this._parent("Authorrestricted")||this._parent("Leaderrestricted")||this._parent("Readerrestricted"))}}return this._parent(q)},"onChange:id":function(s,u,r){var t=this,q;if(r.add){return}function v(x){var w={};w.medium=x;w.small=x;w.large=x;return w}if(this.get("parentId")){n(this).then(function(w){q=v(w.thumbnail);t.set("thumbnailLink",q)})}},getNLSType:function(){return l.collaborativeSpace}});return a});define("DS/W3DDrive/Collections/3DSpace/MyCollabSpaces",["UWA/Core","DS/W3DDrive/Collections/Inodes","DS/W3DDrive/scheduleTasksToGlobalSession","DS/W3DDrive/Models/3DSpace/MyCollabSpace","DS/W3DDrive/Utils/RequestHelper"],function(a,d,f,e,c){var b=d.extend({model:e,thumbnailsRetrieved:false,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0},updateState:function(g){this.state=Object.assign({},this.state,g)},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"csTotal"},url:function(){var h=this._auth.platform.url3DSpace;var g="{0}/resources/enocsmrest/collabspaces".format(h);return g},parseResponseForStateUpdate:function(j,h,i,g){return{totalRecords:j.csTotal,lastPage:(j.nbPages>0)?j.nbPages-1:0}},parseRecords:function(h,g){return h.items},parse:function(i,g){this.thumbnailsRetrieved=false;var h=this.parseResponseForStateUpdate(i,Object.assign({},this.queryParams),Object.assign({},this.state),g);if(h){this.updateState(h)}return this.parseRecords(i,g)},create:function(g,h){var i;h=a.clone(h||{},false);if(g.csAtrributes.title){i={actions:[],contents:null,contexts:[],description:g.csAtrributes.description,family:{value:g.csAtrributes.family},members:null,owner:{},solution:"",thumbnail:"",title:g.csAtrributes.title,visibility:{value:g.csAtrributes.visibility}};h.method="POST";h.url=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces"}h.data=JSON.stringify(i);h.headers={Accept:"application/json","Content-Type":"application/json;charset=utf-8"};return this._parent(g,h)},fetch:function(g){var j=Object.assign({},this.state);var h=this;var i=Object.keys(this.queryParams).reduce(function(m,k){var l=h.queryParams[k];var n=j[k];l=((typeof l==="function")?l.call(h):l);n=((typeof n==="function")?n.call(h):n);if(l!=null&&n!=null){m[l]=n}return m},{});g.data=Object.assign({},g.data,i);a.extend(g,true);if(!g.data){g.data={}}if(!g.data.fields){g.data.embed="contexts";g.data.sort="amodified";g.data.fields="actions,contexts,created,description,family,owner,solution,visibility,title"}this._parent.apply(this,arguments)},getPreviews:function(h){if(this.isEmpty()){return}if(!h){h={}}var j=this,i,g=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/previews",k=h.onComplete;function l(n){var m={};m.medium=n;m.small=n;m.large=n;return m}h.onComplete=function(o){var n,p,m;o.forEach(function(q){n=j.get(q.id);if(n){if(q.thumbnail===null){p=n.get("thumbnailLink").small}else{p=q.thumbnail}m=l(p);n.set("thumbnailLink",m)}});if(k){return k(j,o,h)}};c.performRequestWithOptions(g,a.extend(h,{type:"json",data:{ids:this.pluck(this.model.prototype.idAttribute).reduce(function(m,n){return m+","+n})}}));return i},shareChildren:function(i,h){var g=this;var j=i.reduce(function(m,k){if(!g.contains(k)){return m}var l=k.permissions;return h.map(function(o){var n=l.findWhere({emailAddress:o.emailAddress});if(n){return function(){return new Promise(function(q,p){n.save({role:o.role,},{patch:false,onComplete:function(r){q({inode:k,permission:r})},onFailure:function(r){p({inode:k,permission:r})}})})}}return function(){return new Promise(function(q,p){l.create(o,{wait:true,onComplete:function(r){q({inode:k,permission:r})},onFailure:function(r){l.remove(r);p({inode:k,permission:r})}})})}}).concat(m)},[]);return f(j)},onReset:function(){this.thumbnailsRetrieved=true;this.getPreviews()},onChange:function(h,i,g){if(!this.thumbnailsRetrieved){this.thumbnailsRetrieved=true;this.getPreviews()}}});return b});define("DS/W3DDrive/Models/DSDrive/UserGroup",["DS/W3DDrive/Metas/DSDrive/permission","DS/W3DDrive/Models/Permission","DS/WebappsUtils/WebappsUtils","UWA/String"],function(k,j,c,b){var d=k();var g="delegate";var a="edit";var f="read";var h="read_share";var l="edit_share";var e={};e[g]="writerSharer";e[a]="writer";e[f]="reader";e[h]="readerSharer";e[l]="writerSharer";var i=function(n){var m;Object.keys(e).some(function(o){if(e[o]!==n){return false}m=o;return true});return m};return j.extend({idAttribute:"id",type:"group",parse:function(m){return{id:m.id,resourceid:m.uri,_label:m.title,accessright:m.accessright,members:m.members,role:e[m.accessright]}},destroy:function(o){var p=this.collection._parentInode;var n=p._auth.platform.url+"/resources/share/accesses/"+p.get("id")+"/restrictions";var m=o||{};m=Object.assign(m,{url:n,method:"PUT",headers:{"Content-Type":"application/json"},data:JSON.stringify({operation:"remove",items:[{domain:this.get("domain"),mail:this.get("emailAddress")}]})});return this._parent(m)},init:function(m){return this._parent.apply(this,arguments)},setup:function(m){this.set("id",m.id);this.set("resourceid",m.uri);this.set("label",m.title);this.set("accessright",m.accessright);this.set("role",e[m.accessright]);this.set("members",m.members);this.set("type",this.type);return this._parent.apply(this,arguments)},save:function(n,m){if(n&&n.hasOwnProperty("role")){n.accessright=i(n.role)}if(typeof m==="object"&&m.data){m.headers={"Content-Type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"}}if(n&&n.parentid){m.patch=false}return this._parent(n,m)},sync:function(o,n,m){m.url=n.collection.url();if(m.method==="create"){m.headers=m.headers||{};m.headers["Content-Type"]="application/json";m.data={accessright:i(n.get("accessright")),uri:n.get("resourceid"),id:n.get("id"),message:""};if(typeof m.data==="object"){m.data=JSON.stringify(m.data)}m.method="POST"}else{if(o==="update"){m.headers=m.headers||{};m.headers["Content-Type"]="application/json";m.url=b.format("{0}/{1}",m.url,n.get("id"));m.data={accessright:n.get("accessright"),uri:n.get("resourceid"),id:n.get("id")};if(typeof m.data==="object"){m.data=JSON.stringify(m.data)}}else{if(o==="delete"){m.method="delete";m.url=b.format("{0}/{1}",m.url,n.get("id"))}}}return this._parent(o,n,m)},_applyCriteria:function(m,o){if(o){if(m.get("login")===m.collection._parentInode.drive.get("user").id){return false}if(m.get("accessright")===o){return false}if(o.indexOf(m.get("accessright"))!==-1){return false}}var n=m.collection._parentInode.get("accessright");return n===g||n===l},_actionCbks:{removePermission:function(m){var n=m.collection._parentInode.get("accessright");return(n===g||n===l||n===h)||m.get("login")===m.collection._parentInode.drive.get("user").id},makeReader:function(m){if(m._hasSharingAccess(m)){return false}return m._applyCriteria(m,[f,h])},makeWriter:function(m){if(m._hasSharingAccess(m)){return false}return m._applyCriteria(m,[a,l,g])},makeReaderShare:function(m){if(!m.isOwner(m)||!m._hasSharingAccess(m)||m._hasAlreadyTheRole(m,h)){return false}return true},makeWriterShare:function(m){if(!m.isOwner(m)||!m._hasSharingAccess(m)||m._hasAlreadyTheRole(m,g)||m._hasAlreadyTheRole(m,l)){return false}return true},enableShare:function(m){if(!m.isOwner(m)){return false}return !m._hasSharingAccess(m)},disableShare:function(m){if(!m.isOwner(m)){return false}return m._hasSharingAccess(m)}},isOwner:function(o){var p=o.collection._parentInode,n=p.drive.get("user").id,m=p.get("owners")[0].id;return n===m},_hasSharingAccess:function(m){var n=m.get("accessright");if(n===g||n===l||n===h){return true}return false},_hasAlreadyTheRole:function(m,n){return m.get("accessright")===n},isActionAllowed:function(n){var m=this._actionCbks[n](this);if(m){return true}else{return false}}})});define("DS/W3DDrive/Collections/DSDrive/PermissionsLink",["DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/DSDrive/PermissionLink",],function(b,a){return b.extend({model:a,url:function(){return this._parentInode._auth.platform.url+"/resources/share/accesses/"+this._parentInode.get("id")},setup:function(e,c){var d=c.parentInode;this._parentInode=d;this._auth=d._auth;return this._parent(arguments)},fetch:function(d){var c=Object.assign({},d,{headers:{"Content-Type":"application/json"},});return this._parent(c)},parse:function(c){if(!c||!Array.isArray(c.restrictions)){return[]}return c.restrictions}})});define("DS/W3DDrive/Models/Actions/DSDrive/actionsUtils",["DS/W3DDrive/Utils/IntegrationHelper"],function(a){var b={};b.filterSharedWithMeChild=function(c){return c.filter(function(d){switch(d){case"edit":case"delete":case"moveTo":return false;default:return true}})};b.filterSharedByLink=function(c){return c.filter(function(d){switch(d){case"edit":case"update":case"delete":case"moveTo":case"comment":case"copy":case"openWith":case"viewPermissions":return false;default:return true}})};b.filterSharedByLinkMultiSel=function(c){return c.filter(function(d){switch(d){case"edit":case"update":case"delete":case"moveTo":case"comment":case"copy":case"openWith":case"viewPermissions":case"download":return false;default:return true}})};b.manageActionOpeningForFiles=function(d,c){if(a.SWIntegration&&a.SWIntegration.insertIsAvailable(JSON.stringify({fileExtension:c.get("fileExtension").toLowerCase()}))){return d.concat(["insert"])}if(a.CATIAV5){return d.filter(function(e){switch(e){case"preview":return false;default:return true}})}return d};return b});define("DS/W3DDrive/Collections/DSDrive/UserGroups",["DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/DSDrive/UserGroup","UWA/String"],function(a,c,b){return a.extend({model:c,url:function(){if(!this._auth&&this._parentInode._auth){this._auth=this._parentInode._auth}return b.format("{0}/resources/3ddrive/v1/bos/{1}/groupaccesses",this._auth.getStorage().url,this._parentInode.get("id"))},init:function(f,d){d=d||{};var e=d.parentInode;if(!e){throw new Error("You must specify a valid parentInode options")}return this._parent.apply(this,arguments)},find:function(e){var d=function(f){return f.get("resourceid")===e};return this._parent.apply(this,[d])},setup:function(f,d){this.reset();var e=d.parentInode;this._parentInode=e;return this._parent.apply(this,arguments)},fetch:function(d){var e=d.onComplete;d.inode=this._parentInode;d.method="GET";d.headers=d.headers||{};d.headers["Content-Type"]="application/json";d.onComplete=function(f,g){if(g.accesses){if(e){e.apply(null,arguments)}return}if(d.onFailure){d.onFailure.call(null,null,g)}};return this._parent.apply(this,arguments)},parse:function(d){if(d.accesses){return d.accesses}else{return d}}})});define("DS/W3DDrive/Models/DSDrive/Inode",["UWA/Core","UWA/Array","UWA/Data","UWA/Utils","UWA/Class/Promise","UWA/String","UWA/Class/Collection","DS/W3DDrive/Models/Actions/DSDrive/actionsUtils","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/Inode","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDrive/Utils/RequestHelper","DS/W3DDrive/widget","DS/W3DDrive/Collections/DSDrive/PermissionsLink","DS/W3DDrive/Collections/DSDrive/UserGroups","DS/W3DDrive/Collections/DSDrive/InodeVersions","DS/W3DDrive/Utils/errors","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,D,j,d,h,c,H,x,i,v,C,l,z,u,A,y,G,a,t,n){var g=v();var I=i();return C.extend({idAttribute:"id",defaults:{thumbnailLink:""},setup:function(){var K=this;var J=Object.keys(I.ids).map(function(L){if(K.id!==I.ids[L]){return true}return false}).reduce(function(L,M){return L&&M},true);if(J){this.permissionsLink=new y([],{parentInode:this});this.userGroups=new G([],{parentInode:this,auth:this._auth});if(this.get("mimeType")!==g.mimeType.folder&&A.getValue("isStandalone")!==true){this.inodeVersions=new a([],{parentInode:this,auth:this._auth})}}return this._parent.apply(this,arguments)},urlRoot:function(){var J="";if(this.isNew()){return J}var K=this._auth;if(!K){return J}var L=this._auth.getStorage();if(!L){return J}J=c.format("{0}",u.getBaseUrl(L.url));return J},parse:function(V){var Q=this,ac,R,Y,W,J,L;if(V.results){V=V.results}if(V.items&&Array.isArray(V.items)){V=V.items[0]}function aa(ad){return ad===g.mimeType.folder}function S(ad){return ad===g.mimeType.label}function N(ad){return ad===I.boType.component}function X(ad){var ae;ae=ad.parentid;if(Q.get("id")===ae){ae=null}return ae}function K(af){var ae,ad;if(af.mimetype===I.mimeType.folder){return}if(af.extension){return af.extension}ae=af.title;if(!ae){return}ad=ae.split(".");return ad[ad.length-1]}function M(ae){var ad;ad=ae.mimetype;if(ad===I.mimeType.folder){ad=g.mimeType.folder}if(ae.type==="DriveFolder"){ad=g.mimeType.folder}return ad}function U(ad){if(!ad){return}return parseInt(ad,10)*1000}function T(ag,af,ae){var ad;if(N(ae)){ad=I.icons.component}else{if(aa(af)){ad=I.icons.folder}else{if(S(af)){ad=I.icons.label}else{ad=ag.icon}}}return ad}function Z(ag,af,ae,ai){var ad,ah;ad={};if(ag.thumbnail){ah=ag.thumbnail}else{if(aa(af)||Q.isFolder()){ah=I.thumbnails.folder}else{if(N(ae)){ah=I.thumbnails.component}else{if(S(af)){ah=I.thumbnails.label}else{if(ai&&!Q.get("thumbnailLink")){ah=I.thumbnails[ai.toLowerCase()]||I.thumbnails.content}}}}}if(ah){ad.medium=ah;ad.small=ah;ad.large=""}else{ad=undefined}return ad}function P(af){var ae=af.fullnameowner,ad=af.owner;if(!ae&&ad){ae=ad}if(ae&&ad){return[{displayName:ae,id:ad}]}return undefined}W=X(V);Y=M(V,W);J=V.type;L=K(V);R={accessright:V.accessright,actions:this.convertActions(V.actions),createdDate:U(V.created),description:V.description||undefined,fileExtension:L,iconLink:T(V,Y,J),id:V.id,mimeType:Y,modifiedDate:U(V.modified),owners:P(V),parentId:W,sharedLink:{},size:V.size,title:V.title,alias:V.alias,addtomydrive:V.addtomydrive,thumbnailLink:Z(V,Y,J,L)};for(ac in R){if(R.hasOwnProperty(ac)&&R[ac]===undefined){delete R[ac]}}if(V.actions){var ab=this.get("actions")||[];var O=V.actions.length!==ab.length;if(!O){O=ab.some(function(ae,ad){ae!==V.actions[ad]})}if(O){this.dispatchEvent("onChange:actions")}}return R},convertActions:function(M){if(!M){return undefined}var L=I.actionPubIds;var J={"add.folder":L.createFolder,"add.file":L.upload,copy:L.copy,"delete":L.del,download:L.download,"edit.title":L.edit,move:L.moveTo,openwith:L.openWith,preview:L.preview,"share.link":L.shareLink,"share.edit":L.giveEditAccess,"share.read":L.giveReadAccess,"share.reshare":L.giveShareAccess,update:L.update,addtomydrive:L.addToMyDrive,changealias:L.changeAlias,remove:L.removeFromMyDrive};var K=M.map(function(N){return J[N]}).filter(function(N){return typeof N!=="undefined"});K.push(L.viewPermissions);K.push(L.comment);M.some(function(N){if(N==="share.read"||N==="share.edit"||N==="share.reshare"){K.push(L.share);return true}return false});return K},save:function(K,J){if(typeof J==="object"&&J.data){J.headers={"Content-Type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"}}if(K&&K.parentid){J.patch=false}return this._parent(K,J)},sync:function(J,N,V){if(J!=="create"){var S=Object.assign({},V.queryStrings,{withactions:"true"});V.url=u.addQueryStrings({url:this.urlRoot()+"/"+this.id,queryStrings:S});if(typeof V.data==="object"){V.data=JSON.stringify(V.data)}return this._parent(J,N,V)}V=b.clone(V||{},false);var P=this,L,O=this.collection._auth.getStorage(),M=V.file||{},T=B(V.attrs||(N.toJSON()),N.isNew()),Q=r(T,V),U=N._parent.bind(N),K=V.onFailure;if(M&&M.size>I.constants.maxFileSize){V.onFailure(t.createUploadFileSizeErrorDSDrive(I));return null}V.headers=V.headers||{};V.headers["Content-Type"]="application/json;charset=UTF-8";function R(W,Y,X){V.data=Y||{};V.data=W;if(V.queryStrings){V.url=u.addQueryStrings({url:P.url(),queryStrings:V.queryStrings})}if(X){V.data.receipt=X}V.data=JSON.stringify(V.data);if(V.action==="update"){J="update";V.url=c.format("{0}/{1}",u.getBaseUrl(O.url),N.id)}return U(J,N,V)}if(N.get("mimeType")===g.mimeType.folder){d.setImmediate(function(){R.apply(null,s.apply(null,Q))})}else{if(N.get("duplicatedfrom")){d.setImmediate(function(){R.apply(null,m.apply(null,Q))})}else{L=E.call(P,O).then(o).spread(function(Y,W,X){return w(Y,W,X,M,P)}).then(e);h.all(Q.concat(L).concat(M.name)).spread(F).spread(R)["catch"](function(W){K(W)})}}},getFileUrl:function(){var K=this;var J=c.format("{0}/{1}/fileurl",u.getBaseUrl(this._auth.getStorage().url),this.get("id"));var L={};if(z.isSupportedBy3DPlay(this)){L.expand=true}return new h(function(N,M){u.performRequestWithOptions(J,{type:"json",data:L,onComplete:function(P){var O=P?P.url:null;K.set("fileUrl",O);N(O)},onFailure:M})})},getThumbnailLink:function(){var J=this;var K=this.get("fileExtension");K=K.toLowerCase();if(K==="jpg"||K==="jpeg"||K==="png"||K==="gif"||K==="bmp"){return this.getDownloadUrl().then(function(L){return{medium:J.get("thumbnailLink").medium,small:J.get("thumbnailLink").small,large:L.url}})}else{return new h(function(M,L){M({medium:J.get("thumbnailLink").medium,small:J.get("thumbnailLink").small,large:J.get("thumbnailLink").medium})})}},getDownloadUrl:function(K){K=K||{};var L=this;var J=c.format("{0}/{1}/download",u.getBaseUrl(this.drive.get("auth").getStorage().url),this.get("id"));return new h(function(N,M){var O=function(P){var Q=P?P.url:null;L.set("downloadUrl",Q);N({url:Q,method:"POST"})};K.onComplete=O;K.onFailure=function(P,R,Q){M({status:P,data:R,options:Q})};u.performRequestWithOptions(J,K)})},amISharedWithMeChild:function(){return(this.get("parentId")===I.ids.sharedWithMe)},getActionIds:function(J){if(this.get("removed")){return[]}var K=this.get("actions");if(!K){return[]}K=x.manageActionOpeningForFiles(K,this);if(this.drive.get("shareByLink")){K=K.concat(g.actionPubIds.viewPermissionsLink)}if(this._auth&&this._auth.platform&&this._auth.platform.urlUsersGroup){K=K.concat(g.actionPubIds.viewPermissionsGroup)}if(A.getValue("isStandalone")===true){if(J===true){K=x.filterSharedByLinkMultiSel(K)}else{K=x.filterSharedByLink(K)}}return K},isActionIdoK:function(J){if(J==="share"&&D.detect(this.getActionIds(),function(K){if(K==="giveReadAccess"||K==="giveEditAccess"||K==="giveShareAccess"){return true}})){return true}else{return this._parent(J)}},loadPreview:function(J){var K=this;J=J||{};if(J.add){return}f(this,J.waitingTime).then(function(L){K.set(K.parse(L))})},"onChange:id":function(K,L,J){this.loadPreview(J)},get3DPlayOptions:function(){var J={asset:{requestsOptions:{proxy:"none"}}};if(A.getValue("isStandalone")){J.asset.tenant=A.getValue("publicTenant")}else{J.asset.tenant=this._auth.getStorage().id}if(z.isSupportedBy3DPlay(this)){J.asset.filename=this.get("title")+".zip";J.asset.url=this.get("fileUrl")}return this._parent(J)}});function B(L,N){var Q={},M,J,P,O,K,R;if(L){if(L.parentId){M=L.parentId}if(L.mimeType){J=L.mimeType}if(L.description){P=L.description}if(L.title){O=L.title}if(L.duplicatedfrom){K=L.duplicatedfrom}if(L.parentId){if(L.parentId===I.ids.root){R="/"}else{R=L.parentId+"/"}}}if(M){Q.parents=[{id:M}]}if(!J){J="application/octet-stream"}else{if(J===g.mimeType.folder){J=I.mimeType.folder}}Q.mimeType=J;if(P){Q.description=P||""}if(O){Q.title=O}if(N){Q.uploadType="media"}if(K){Q.duplicatedfrom=K}return Q}function f(K,J){J=J||7000;return new h(function(N,M){var L;if(K.id==="trueRootId"||K.id==="DSROOT"||K.id==="myCollabSpaces"){N("");return}try{L=l.result(K,"url");if(L[L.length-1]!=="/"){L+="/"}L+="preview";setTimeout(function(){u.performRequest(L,N,M)},J)}catch(O){M(O)}})}function r(J,K){var L;L=Object.assign({data:{},headers:{"Content-Type":"application/json;charset=utf-8"}},K);return[{title:J.title,duplicatedfrom:J.duplicatedfrom},L]}function s(J,K){return[Object.assign({type:I.boType.folder},J),K]}function E(J){return new h(function(M,L){var K;K=c.format("{0}/ticket?id={1}",u.getBaseUrl(J.url,false),window.Date.now());u.performRequestWithOptions(K,{method:"GET",type:"json",onComplete:function(N){M(N)},onFailure:L})})}function p(J){return J.actionurl}function q(J){return J.jobticket}function k(J){return J.ticket}function o(J){return[p(J),q(J),k(J)]}function w(Q,L,P,K,J){var O,N,M;O=new window.FormData();N={};N[L]=P;N["file-name"]=K.name;N.file_0=K;N["file-title"]=K.name;N["file-description"]=K.name;Object.keys(N).map(function(R){O.append(R,N[R])});M=new window.XMLHttpRequest();M.open("POST",Q,true);return new h(function(S,R){M.onload=function(){if(this.status>=200&&this.status<400){S(this.response)}else{R("file upload in FCS failed")}};M.onerror=function(){R()};M.upload.onprogress=J.dispatchAsEventListener("onProgress");M.send(O)})}function e(J){var L,K;L=b.createElement("div").setHTML(J);K=L.getElement('[name="__fcs__jobReceipt"]');return K.value}function m(K,J){return[Object.assign({type:I.boType.document},K),J]}function F(N,M,L,J){var K;K=Object.assign({type:I.boType.document,file:J,description:""},N);return h.cast([K,M,L])}});define("DS/W3DDrive/Models/3DSpace/FilesRoot",["DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/DSDrive/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(c,b,e,d,g){var a=b();var h=c();var f=e.extend(d,{defaults:{parentId:h.ids.trueRoot,title:g.files,mimeType:a.mimeType.folder,iconLink:h.icons.folder,thumbnailLink:{small:h.thumbnails.folder,medium:h.thumbnails.folder,large:h.thumbnails.folder}},getActionIds:function(){return[]}});return f});define("DS/W3DDrive/Models/DSDrive/SharedWithMeRoot",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/DSDrive/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(c,b,e,d,g){var a=b();var h=c();var f=e.extend(d,{defaults:{parentId:h.ids.trueRoot,title:g.sharedWithMe,mimeType:a.mimeType.folder,iconLink:h.icons.folder,thumbnailLink:{small:h.thumbnails.folder,medium:h.thumbnails.folder,large:h.thumbnails.folder}},getActionIds:function(){return[]}});return f});define("DS/W3DDrive/Models/3DSpace/MyCollabSpacesRoot",["DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/DSDrive/Inode","DS/W3DDrive/Models/Stub","DS/W3DDrive/Models/Actions/CollabSpaces/actionsUtils","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(f,d,b,e,h,i){var g=d();var a=f();var c=b.extend(e,{defaults:{parentId:a.ids.trueRoot,title:i.myCollabSpaces,mimeType:g.mimeType.folder,iconLink:a.icons.collabSpace,thumbnailLink:{small:a.thumbnails.collabSpace,medium:a.thumbnails.collabSpace,large:a.thumbnails.collabSpace}},setSession:function(){this.set("isInnovation",this.drive.get("isinnovation"));this.set("isAdmin",this.drive.get("isadmin"));this.set("actions",this.drive.get("actions"))},getActionIds:function(){this.setSession();var j=this.isFolder();var k=h[(j?"getCollabSpaceActions":"getContentActions")](this);return k},getNLSType:function(){return""},doesExistInBackend:function(){return new Promise(function(k,j){k(true)})}});return c});define("DS/W3DDrive/Actions/Iterations/DriveFileHistory",["DS/W3DDrive/Metas/inode","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDrive/Utils/Metrics","DS/W3DDrive/Actions/downloadAction","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c,b,d,e){return function(i){var f=a();var h=i.model;var g="version";i.actions=i.actions.concat([{id:f.actionPubIds.downloadVersion,text:e.download,icon:"download",fonticon:"download",handler:function(){d({model:h,context:g})}},{id:f.actionPubIds.restore,text:e.restore,icon:"rotate-ccw",fonticon:"rotate-ccw ",handler:function(){b.incActionTracker({actionName:"restoreVersion",model:h,context:g}).inc();if(c.hasRelations(h)){var j=document.createElement("span");j.innerHTML=e.restorePointingFile;i.openDialog({title:e.restore+" "+h.get("title"),modalBodyContent:[j],confirmAction:{value:e.restore,handler:function(){i.dispatchIterationActions("onRestore",[h])}}});return}i.dispatchIterationActions("onRestore",[h])}}]);return i}});define("DS/W3DDrive/Actions/Iterations/iterationActionsFactory",["DS/W3DDrive/Actions/Iterations/Base","DS/W3DDrive/Actions/Iterations/DriveFileHistory","DS/W3DDrive/Actions/Iterations/Collabspace"],function(b,c,a){return function(d){if(!d||!d.iteration){throw"An iteration is necessary to build actions."}var e=d.iteration;var g=e.collection._parentInode||e.collection.parentCS;if(g.drive.isCollabSpace){return f(a)}return f(c);function f(){var i=new b({model:e});for(var h in arguments){if(arguments.hasOwnProperty(h)){var j=arguments[h];i=j(i)}}return i}}});define("DS/W3DDrive/Models/DSDrive/MainRoot",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/DSDrive/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(c,b,f,d,g){var a=b();var h=c();var e=f.extend(d,{defaults:{parentId:h.ids.trueRoot,title:g.myFiles,mimeType:a.mimeType.folder,iconLink:h.icons.folder,thumbnailLink:{small:h.thumbnails.folder,medium:h.thumbnails.folder,large:h.thumbnails.folder}},getActionIds:function(){return["createFolder","upload","download"]}});return e});define("DS/W3DDrive/Models/3DSpace/InodeFactoryCS",["DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Models/3DSpace/MyCollabSpacesRoot","DS/W3DDrive/Models/3DSpace/MyCollabSpace"],function(c,b,f){var d=c();var a={};a[d.ids.myCollabSpaces]=b;var g="id";function e(j,i){if(!j.name){j.name=j.id}var h=a[j[g]];if(!h){h=f}return new h(j,i)}e.prototype.idAttribute=g;return e});define("DS/W3DDrive/Models/GoogleDrive/MainRoot",["DS/W3DDrive/Metas/GoogleDrive/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/GoogleDrive/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(h,d,e,f,g){var c=d();var b=h();var a=e.extend(f,{defaults:{parentId:b.ids.trueRoot,title:g.replace(g.myDrive,{serviceName:"Drive"}),mimeType:c.mimeType.folder,iconLink:b.icons.folder,thumbnailLink:{small:b.thumbnails.folder,medium:b.thumbnails.folder,large:b.thumbnails.folder}},getActionIds:function(){return["createFolder","upload"]}});return a});define("DS/W3DDrive/Models/GoogleDrive/InodeFactory",["DS/W3DDrive/Metas/GoogleDrive/inode","DS/W3DDrive/Models/GoogleDrive/Inode","DS/W3DDrive/Models/GoogleDrive/MainRoot","DS/W3DDrive/Models/GoogleDrive/SharedWithMeRoot"],function(b,e,a,d){var g=b(),c={};c[g.ids.root]=a;c[g.ids.sharedWithMe]=d;function f(j,i){var k=j[e.prototype.idAttribute],h=c[k];if(!h){h=e}return new h(j,i)}f.prototype.idAttribute=e.prototype.idAttribute;return f});define("DS/W3DDrive/Collections/GoogleDrive/Inodes",["UWA/Promise","DS/W3DDrive/Collections/Inodes","DS/W3DDrive/Models/GoogleDrive/InodeFactory","DS/W3DDrive/Metas/GoogleDrive/inode","DS/W3DDrive/scheduleTasksToGlobalSession","DS/W3DDrive/Utils/google","DS/W3DDrive/Utils/errors","DS/W3DDrive/Utils/RequestHelper"],function(i,g,b,j,c,d,k,f){var l=d();var e=j();function a(n){var m=n.isSortIsAscending()}var h=g.extend({getSortValue:function(){var n=this._sorting.logic;var m=(n.asc?"":" desc");var o="";switch(n.attributeName){case"title":o=", title"+m+", modifiedDate";break;case"createdDate":o=", createdDate"+m+", title";break;case"modifiedDate":o=", modifiedDate"+m+", title";break;default:break}return"folder"+o},state:{currentPageToken:undefined,nextPageToken:undefined,pageSize:100,sortKey:function(){return this.getSortValue()}},updateState:function(m){this.state=Object.assign({},this.state,m)},queryParams:{currentPageToken:"pageToken",pageSize:"maxResults",sortKey:"orderBy"},url:function(){var m="https://www.googleapis.com/drive/v2/files?";m+="q="+l.urlEncode("'"+this._parentInode.id+"' in parents and trashed = false");return m},parseResponseForStateUpdate:function(p,n,o,m){return{nextPageToken:(p.nextPageToken||null)}},parseRecords:function(n,m){return n.items},getFirstPage:function(m){this.updateState({currentPageToken:undefined,nextPageToken:undefined});this.fetch(m)},hasNextPage:function(){return(this.state.nextPageToken!=null)},getNextPage:function(m){this.updateState({currentPageToken:this.state.nextPageToken,nextPageToken:undefined});this.fetch(m)},fetch:function(m){m=(m||{});var p=Object.assign({},this.state);var n=this;var o=Object.keys(this.queryParams).reduce(function(s,q){var r=n.queryParams[q];var t=p[q];r=((typeof r==="function")?r.call(n):r);t=((typeof t==="function")?t.call(n):t);if(r!=null&&t!=null){s[r]=t}return s},{});m.data=Object.assign({},m.data,o);return this._parent(m)},create:function(m,n){var o=n.file;if(o&&o.size>e.constants.maxFileSize){n.onFailure(m,k.createUploadFileSizeError(e));return null}return this._parent(m,n)},parse:function(o,m){var n=this.parseResponseForStateUpdate(o,Object.assign({},this.queryParams),Object.assign({},this.state),m);if(n){this.updateState(n)}return this.parseRecords(o,m)},sync:function(o,n,m){m.ajax=f.getRequestMethod(m,true);return this._parent(o,n,m)},sort:function(m){m=m||{};if(!m.sorting||(m.sorting.id===this._sorting.id)){return this._parent.apply(this,arguments)}this._sorting=m.sorting;return this.getFirstPage({reset:true})},model:b,shareChildren:function(q,p){var o=this;var r=q.map(function(t){if(!o.contains(t)){return}var s=t.permissions;return p.reduce(function(w,v){var u=s.findWhere({emailAddress:v.emailAddress});if(u){w.toSaves.push(function(){return new i(function(y,x){u.save({role:v.role,},{patch:true,onComplete:function(z){y({inode:t,permission:z})},onFailure:function(z){x({inode:t,permission:z})}})})});return w}w.toCreates.push(function(){return new i(function(y,x){s.create(v,{wait:false,onComplete:function(z){y({inode:t,permission:z})},onFailure:function(z){s.remove(z);x({inode:t,permission:z})}})})});return w},{toSaves:[],toCreates:[]})});var n=[];var m=[];return c(r.map(function(s){return function(){return s.toCreates.reduce(function(t,u){return t.then(function(){return u().then(function(){m.push(arguments[0])},function(){n.push(arguments[0])})})},i.resolve()).then(function(){return c(s.toSaves).then(function(){if(n.length){return i.reject(n)}return i.resolve(m.concat(arguments[0]))},function(){return i.reject(n.concat(arguments[0]))})})}}))}});return h});define("DS/W3DDrive/Utils/CompassHelpers",["DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(c,d){var b;function a(g){var h=g.collection._parentInode.get("contexts"),f,e;for(f=0;f<h.length;f++){e=h[f];if(e.role!=="VPLMProjectAdministrator"){break}}return e.name}b={getObject:function(j){var i,f,h,e,g;if(c.getValue("is3DSpaceWidget")){i="3DSpace";f=a(j);h=j.get("iconLink");e=j.get("type")?j.get("type").value:"";g=j.get("type")?j.get("type").name:""}else{if(j.drive.get("title")==="3DEXPERIENCE"){i="3DDrive";f="";h="";e=j.isContainer()?"DriveFolder":"DriveFile";g=j.isContainer()?d.folder:d.file}else{i=j.drive.id;f="";h="";e=(j.isContainer()?j.get("mimeType"):"Document");g=j.get("fileExtension")}}return{envId:j._auth.platformId||"",serviceId:i,contextId:f,objectId:j.id,objectType:e,displayName:j.get("title"),displayType:g,displayIcon:h,displayPreview:j.get("thumbnailLink").medium}},get3DXContent:function(g){var e,f;if(c.getValue("is3DSpaceWidget")){f="X3DCSMA_AP";e="1.0"}else{f=c.data.appId;e="2.0"}return{protocol:"3DXContent",version:e,source:f,data:{items:g.map(this.getObject)}}}};return b});define("DS/W3DDrive/w3DDriveTitleProxy",["UWA/Core","DS/W3DDrive/widget"],function(c,b){function a(d){b.setTitle((d||""))}return{setTitle:a}});define("DS/W3DDrive/Collections/3DSpace/MyCollabSpaceContents",["UWA/Core","UWA/String","DS/W3DDrive/Collections/Inodes","DS/W3DDrive/Models/3DSpace/MyCollabSpaceContent","DS/W3DDrive/scheduleTasksToGlobalSession","DS/W3DDrive/Utils/RequestHelper","DS/W3DDrive/W3DDriveTagger6WProxy"],function(h,b,g,j,a,c,e){function i(l){return l.map(function(m){return m.id}).reduce(function(n,o,m,q){var p=n;if(n){p+=","}return p+o},"")}function d(n,m){var l;l=n._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+n._parentInode.id+"/contents/previews";return new Promise(function(p,o){c.performRequestWithOptions(l,{type:"json",data:{ids:m(n)},onComplete:p,onFailure:o})})}function k(l,n){var m;if(l){m=l[n];if(h.is(m,"function")){m=m.call(l)}}return m}var f=g.extend({shouldFetch:true,model:j,state:{firstPage:0,currentPage:0,pageSize:25,lastPage:0},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"contentTotal"},filterTagObj:null,isNewFilter:false,updateState:function(l){this.state=Object.assign({},this.state,l)},url:function(){return b.format("{0}/resources/enocsmrest/collabspaces/{1}/contents",this._auth.platform.url3DSpace,this._parentInode.id)},setup:function(m,l){if(l){this._auth=l.auth}if(widget){this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})}},fetch:function(t){t=(t||{});var o=Object.assign({},t);var q=this,r,m,s,n,l;if(t.setState){this.state=t.setState}if(!t.data){t.data={}}if(!t.data.fields){t.data.sort="amodified"}l=Object.assign({},this.state);var p=Object.keys(this.queryParams).reduce(function(w,u){var v=q.queryParams[u];var x=l[u];v=((typeof v==="function")?v.call(q):v);x=((typeof x==="function")?x.call(q):x);if(v!=null&&x!=null){w[v]=x}return w},{});o.data=Object.assign({},t.data,p);if(!this.shouldFetch){if(typeof t.onComplete==="function"){t.onComplete(this,this.toJSON(),t)}this.dispatchEvent("onSync",[this,this.toJSON(),t]);return}if(t.evnt||this.filterTagObj){r=this.filterTagObj;if(r){s={tags:JSON.stringify(r)};o.data=(o.data?h.extend(s,o.data):s)}o.onComplete=function(w,v){var u=q.parseTags(v);if(t.reset===true){e._currentTagger.setTags(u.subjectsTags,u.tagValues)}else{e._currentTagger.addSubjects(u.subjectsTags)}q.isNewFilter=false}}if(t.withThumbnails){o.onComplete=function(w,v){var u=q.parseTags(v);e._currentTagger.setTags(u.subjectsTags,u.tagValues);q.isNewFilter=false;if(typeof t.onComplete==="function"){t.onComplete(w,v,t)}}}if(this.currentSearchUrl){o.url=this.currentSearchUrl}return this._parent.call(this,o)},parseTags:function(l){return{tagValues:l.tagValues,subjectsTags:l.subjectsTags}},onSearch:function(p){if(p){var m=(h.is(this.url,"function"))?this.url():this.url;var o;if(m.contains("?")){o=m+"&q="+p}else{o=m+"?q="+p}var l={firstPage:0,currentPage:0,pageSize:25,lastPage:0};if(o!=this.currentSearchUrl){this.currentSearchUrl=o;var n=this,r,q={reset:true,type:"json",evnt:"OnSearch",setState:l};r=q.onComplete;q.onComplete=function(){if(r){r(arguments)}};this.fetch(q)}}},onResetSearch:function(){if(this.currentSearchUrl){delete this.currentSearchUrl;var l=this,n,m={reset:true,type:"json",evnt:"OnSearch"};this.state={firstPage:0,currentPage:0,pageSize:25,lastPage:0};n=m.onComplete;m.onComplete=function(){if(n){n(arguments)}};this.fetch(m)}},parseResponseForStateUpdate:function(o,m,n,l){return{totalRecords:o.contentTotal,lastPage:(o.nbPages>0)?o.nbPages-1:0}},parseRecords:function(m,l){return m.items},parse:function(n,l){var m=this.parseResponseForStateUpdate(n,Object.assign({},this.queryParams),Object.assign({},this.state),l);if(m){this.updateState(m)}return this.parseRecords(n,l)},getExtension:function(l){if(!h.is(l,"string")){return}var m,n;m=l.match(/\.([^.]+)$/);if(m!==null&&m.length===2){n=m[1].toLowerCase()}return n},checkExtension:function(m,l){return m.indexOf(this.getExtension(l))!==-1},getPreviews:function(m){if(this.isEmpty()){return}if(!m){m={}}function q(s){var r={};r.medium=s;r.small=s;r.large=s;return r}var o=this,n,l=this._auth.platform.url3DSpace+"/resources/enocsmrest/collabspaces/"+this._parentInode.id+"/contents/previews",p=m.onComplete;m.onComplete=function(t){var s,u,r;t=o.parsePreviews(t);t.forEach(function(v){s=o.get(v.id);if(s){if(v.thumbnail===null){u=s.get("thumbnailLink").small}else{u=v.thumbnail}r=q(u);s.set("thumbnailLink",r)}});if(p){return p(o,t,m)}};c.performRequestWithOptions(l,h.extend(m,h.extend({type:"json",data:{ids:this.pluck(this.model.prototype.idAttribute).reduce(function(r,s){return r+","+s})}},true),true));return n},parsePreviews:function(l){return l},destroyChildren:function(n,l){var m=this;l=(l||{});if(!n.length){return Promise.resolve()}m.shouldFetch=false;this.remove(n);return new Promise(function(p,o){var q=n.map(function(r){return function(){return new Promise(function(t,s){r.destroy(Object.assign(l,{onComplete:t,onFailure:function(){s(r)}}))})}});a(q).then(function(){m.shouldFetch=true;p()},function(r){m.shouldFetch=true;o(r)})})},getDownloadUrl:function(m){var l="{0}/resources/enocsmrest/collabspace/download".format(this._auth.platform.url3DSpace);return new Promise(function(o,n){c.performRequestWithOptions(l,{type:"json",data:{ids:i(m)},onComplete:function(p){var q=p?p.url:null;o({url:(p?p.url:null),method:"POST"})},onFailure:n})})},});return f});define("DS/W3DDrive/Utils/Router",["DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Utils/History","UWA/Core","UWA/Class","UWA/Class/Events","UWA/Class/Listener","UWA/Class/Options"],function(j,d,g,a,l,k,h){var b,m,f,c,i,e;m=["routes"];f=/\((.*?)\)/g;c=/(\(\?)?:\w+/g;i=/\*\w+/g;e=/[\-{}\[\]+?.,\\\^$|#\s]/g;b=a.extend(h,l,k,{init:function(o){var n,p;o=g.clone(o||{},false);for(p=m.length-1;p>=0;p--){n=m[p];if(o.hasOwnProperty(n)){this[n]=o[n];delete o[n]}}this._bindRoutes();this.setup.apply(this,arguments)},setup:function(){return},_routeToRegExp:function(n){n=n.replace(e,"\\$&").replace(f,"(?:$1)?").replace(c,function(p,o){return o?p:"([^/?]+)"}).replace(i,"([^?]*?)");return new RegExp("^"+n+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(n,o){var p;p=n.exec(o).slice(1);return p.map(function(r,q){if(q===p.length-1){return r||null}return r?decodeURIComponent(r):null})},_bindRoutes:function(){var o,n;if(!this.routes){return}this.routes=j.result(this,"routes");n=Object.keys(this.routes);while((o=n.pop())!=null){this.route(o,this.routes[o])}},execute:function(o,n){if(o){o.apply(this,n)}},getLastFragment:function(){return d.fragment},navigate:function(o,n){d.navigate(o,n);return this},setBaseURI:function(n){return d.setBaseURI(n)},route:function(o,p,r){var n,q;n=this;if(!g.is(o,"regexp")){q=this._routeToRegExp(o)}if(g.is(p,"function")){r=p;p=""}if(!r){r=this[p]}d.route(q,function(t){var s;var u={};s=n._extractParameters(q,t).map(function(w){if(w){var v=c.exec(o);if(v){u[v[0]]=w}}});c.lastIndex=0;n.execute(r,u,p);n.dispatchEvent.apply(n,["onRoute:"+p].concat(s));n.dispatchEvent("onRoute",p,s);d.dispatchEvent("onRoute",n,p,s)});return this}});return b});define("DS/W3DDrive/Utils/popAuth",["UWA/Utils","UWA/Class/Promise","DS/W3DDrive/Utils/RequestHelper",],function(c,b,d){var a={};return{authenticate:function(e){return new b(function(i,h){var g=e.url;var f=e.connectUrl;var j=e.authenticated;if(j){a.close();i({authenticated:true});return}if(!g){h(new Error("An URL is need to open OAuth popup."))}var k=window.setInterval(function(){if(!a||a.closed){window.clearInterval(k);d.performRequestWithOptions(f,{type:"text",onComplete:function(l){i(Object.assign({authenticated:true,email:l}))},onFailure:h})}},500);if(a){a.location=g}})},getLoginUrl:function(e){return new b(function(g,f){d.performRequestWithOptions(e,{onComplete:function(){g({authenticated:true})},onFailure:function(i,h){if(i===200){return g({authenticated:true})}if(i!==401){return f(h)}return g({authenticated:false,connectUrl:e,url:h.details.replace("redirect_url=","")})}})})},open:function(e){a=window.open("about:blank","blank","left=160,top=120,width=750,height=750,resizable=yes");return b.resolve(e)},}});define("DS/W3DDrive/Collections/3DSpace/InodesFactoryCS",["DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Collections/3DSpace/MyCollabSpaces","DS/W3DDrive/Models/3DSpace/InodeFactoryCS"],function(c,d,e){var f=c();var b={};b[f.ids.myCollabSpaces]=d;function a(j,h){var i=h.parentInode;if(!i){return}var k=i.id;var g=b[k];if(i.get("parentId")===f.ids.trueRoot){g=d}if(!g){g=d}return new g(j,h)}a.prototype.model=e;return a});define("DS/W3DDrive/Actions/createInode",["UWA/Core","DS/W3DDrive/Metas/inode","DS/W3DDrive/Actions/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DDrive/Actions/drivesInputs","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(g,c,d,b,h,e,f){var a=c();return function(m,j){var q=e(m),k,i,r,o=q.maxchars,l,n,p;r=d.createTextInput(Object.assign({pattern:q.forbiddenChars.regex,required:true,title:q.forbiddenChars.text||""},o));p=d.createTextError(q.forbiddenChars.text);k=d.createForm([r,p],{className:"form_form-create"});k.addEventListener("submit",function(t){t.preventDefault();var s=(r.value||"").trim();if(!s){return}h.dispatchEvent("inodeActions:onCreateContainer",[m,j,s]);k.parentNode.removeChild(k);k=null;b.modals.current.hide()});n={chars:q.forbiddenChars.text,maxLengthText:o?o.maxLengthText:undefined};r.addEventListener("keyup",function(){d.onCheckInput(o.maxLength,r,p,n,".js-validation-button")});l={title:j===a.mimeType.label?f.createCollection:f.createFolder,body:k,buttons:[{className:"primary js-validation-button",value:f.create,action:function(){var s;if(document.createEvent){s=document.createEvent("Event");s.initEvent("submit",true,true)}else{s=new Event("submit")}k.dispatchEvent(s)}},{value:f.cancel,action:function(){k.parentNode.removeChild(k);k=null;b.modals.current.hide()}}]};b.dialog(l);b.modals.current.getBody().getElement("input[autofocus]").focus();d.disableValidationButton(".js-validation-button")}});define("DS/W3DDrive/Models/DrivesHub/Inode",["UWA/Class/Promise","DS/W3DDrive/Models/Inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/DrivesHub/inode","DS/W3DDrive/Utils/hubRequestHelper","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(g,m,c,e,b,l){var f=c();var i=e();return m.extend({idAttribute:"id",defaults:{actions:[],thumbnailLink:""},fetch:function(p){p=p||{};return this._parent(p)},get3DPlayOptions:function(){return this._parent({asset:{filename:this.url("download"),requestsOptions:{authentication:"passport"}}})},getActionIds:function(p){var q=this.get("actions");if(!p){return q}return q.filter(function(r){return r==="delete"})},getDownloadUrl:function(){var p=this.url("download");return g.resolve({method:"GET",url:p})},getFileUrl:function(){return g.resolve(this.url("download"))},getThumbnailLink:function(p){return g.resolve(this.get("thumbnailLink"))},isFolder:function(){var p=this.get("mimeType");return p===f.mimeType.folder||p===i.mimeType.folder},parse:function(s){if(!s){return}var q=s.name;if(s.name==="root"&&this.collection._parentInode.id===f.ids.trueRoot){q=l.myFiles}var p={accessright:"owner",actions:a(s.type),createdDate:s.created,fileExtension:s.extension,iconLink:k(s),id:s.id,mimeType:d(s.type),modifiedDate:s.lastModified,owner:s.owner?s.owner.replace(/"/g,""):"",owners:j(s),parentId:n(s,this),size:s.size,title:q,thumbnailLink:o(s)};for(var r in p){if(p.hasOwnProperty(r)&&p[r]===undefined){delete p[r]}}return p},save:function(q,r){q=q||{};if(!q||Object.keys(q).length===0){return this._parent(q,r)}var p=Object.assign({},{data:JSON.stringify({name:q.title})},r);return this._parent(q,p)},sync:function(s,r,q){var p=Object.assign({ajax:b.performRequest},q);if(s==="create"){if(r.get("mimeType")===f.mimeType.folder){r.set("type",i.mimeType.folder)}if(r.get("title")){r.set("name",r.get("title"))}p.url=r.collection.url()}else{if(s==="patch"){s="update";if(p&&p.data&&p.data.parentid){p.data.parentId=p.data.parentid}p.data=JSON.stringify(p.data)}if(s==="update"){if(!p.data){p.data=JSON.stringify(r._changed)}p.headers={"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"}}}return this._parent(s,r,p)},url:function(q){var p=this.drive.url();var t=this.id;var s={download:"stream"};var r=s[q]?s[q]:"";return p+"/contents/"+t+"/"+r}});function a(p){var q=[];if(!p){return q}if(p!==i.mimeType.folder){q=["preview","download","delete","edit"]}else{q=["createFolder","upload","delete","edit"]}return q}function o(s){var r=d(s.type);var q=s.type;var u=s.extension;var p={};var t;p={};if(s.thumbnail){t=s.thumbnail}else{if(h(r)){t=i.thumbnails.folder}else{if(u&&p){t=i.thumbnails[u.toLowerCase()]||i.thumbnails.content}}}if(t){p.medium=t;p.small=t;p.large=t}else{p=undefined}return p}function k(r){var p=r.type;var q=d(p);if(h(q)){return i.icons.folder}return r.icon}function d(p){if(p===i.mimeType.folder||p==="driveshub/folder"){return f.mimeType.folder}return p}function j(p){if(!p.owner){return{}}return{displayName:p.owner.replace(/"/g,""),id:p.owner.replace(/"/g,"")}}function n(r,q){var p=q.collection?q.collection:f.ids.trueRoot;var s=r.parentId?r.parentId.replace(/"/g,""):p;if(s==="hiddenroot"){return f.ids.trueRoot}return s}function h(p){return p===f.mimeType.folder||p===i.mimeType.folder}});define("DS/W3DDrive/Models/DrivesHub/InodeFactory",["DS/W3DDrive/Models/DrivesHub/Inode"],function(b){var c=b.prototype.idAttribute;function a(e,d){return new b(e,d)}a.prototype.idAttribute=c;return a});define("DS/W3DDrive/Collections/DrivesHub/Inodes",["DS/W3DDrive/Metas/inode","DS/W3DDrive/Collections/Inodes","DS/W3DDrive/Models/DrivesHub/InodeFactory","DS/W3DDrive/scheduleTasksToGlobalSession","DS/W3DDrive/Utils/hubRequestHelper"],function(a,d,c,e,b){return d.extend({shouldFetch:true,model:c,url:function(){var g=this._parentInode;var h=g.id;var f=g.drive.url();return f+"/contents/"+h+"/children"},copy:function(g,h){var f=Object.assign({},h,{data:JSON.stringify({id:g.duplicatedfrom}),method:"POST",});return f.parentCreate.call(this,g,f)},create:function(g,h){var f=Object.assign({parentCreate:this._parent,ajax:b.performRequest},h);if(g.duplicatedfrom){return this.copy(g,f)}if(g.mimeType===a().mimeType.folder){return this.createFolder(g,f)}return this.upload(g,f)},createFolder:function(g,i){var k=this._parentInode;var j=k.drive;var h=j.url()+"/contents/"+g.id+"children";var f=Object.assign({method:"POST"},i);f=Object.assign({url:h,method:"POST",type:"json",wait:true,data:JSON.stringify({name:g.title})},f);return f.parentCreate.call(this,g,f)},upload:function(h,g){var j=this;var i=g.file;var k=new FormData();k.append("file",i);var f=Object.assign({data:k,noContentType:true},g);return f.parentCreate.call(j,h,f)},destroyChildren:function(h,f){var g=this;f=(f||{});if(!h.length){return Promise.resolve()}g.shouldFetch=false;return new Promise(function(j,i){var k=h.map(function(l){return function(){return new Promise(function(n,m){l.destroy(Object.assign(f,{onComplete:n,onFailure:function(){m(l)}}))})}});e(k).then(function(){g.shouldFetch=true;j()},function(l){g.shouldFetch=true;i(l)})})},fetch:function(g){var f=Object.assign({ajax:b.performRequest},g);return this._parent(f)},sync:function(i,h,g){var f=Object.assign({ajax:b.performRequest},g);return this._parent(i,h,f)}})});define("DS/W3DDrive/Collections/GoogleDrive/RootInodes",["DS/W3DDrive/Collections/GoogleDrive/Inodes","DS/W3DDrive/Collections/Stub","DS/W3DDrive/Metas/GoogleDrive/inode"],function(e,c,a){var d=a();var b=e.extend(c,{init:function(h,g){var f=[d.ids.root,d.ids.sharedWithMe].map(function(j){var i={};i[this.model.prototype.idAttribute]=j;return i},this).map(function(l){var j;var k;for(k=0;(!j&&k<h.length);k++){if(h[k].id===l.id){j=h[k]}}return(j||l)});return this._parent(f,g)}});return b});define("DS/W3DDrive/Collections/GoogleDrive/SharedWithMeRootInodes",["DS/W3DDrive/Collections/GoogleDrive/Inodes","DS/W3DDrive/Utils/google"],function(d,b){var c=b(),a;a=d.extend({url:function(){return"https://www.googleapis.com/drive/v2/files?q="+c.urlEncode("sharedWithMe = true and trashed = false")}});return a});define("DS/W3DDrive/Models/Dropbox/Permission",["UWA/Core","DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Metas/Dropbox/permission","DS/W3DDrive/Models/Permission","DS/W3DDrive/Utils/RequestHelper"],function(h,j,g,l,d){var f=j();var i=g(),e,k={};function b(m){if(m.access_type){return i.roleToFrontend(m.access_type[".tag"])}return undefined}function c(m){return i.roles[m]}var k={removePermission:function(m){return m.get("actions").remove},makeReader:function(m){return m.get("actions")["make_viewer"]},makeReaderNoComment:function(m){return m.get("actions")["make_viewer_no_comment"]},makeWriter:function(m){return m.get("actions")["make_editor"]},makeWriterShare:function(m){return false}};var a=Object.keys(i.actionPubIds).reduce(function(m,n){m[i.actionPubIds[n]]=k[n];return m},{});e=l.extend({defaults:{id:undefined,displayName:"",emailAddress:"",picture:{small:i.thumbnails.people,medium:i.thumbnails.people,large:i.thumbnails.people},role:"",actions:{},},save:function(t,n,z){if(this.isNew()){return this._parent(t,n,z)}var u;if(!t||(typeof t==="object")){u=t;z=n}else{u={};u[t]=n}var o=this.get("role");var y=u.role;var v=this.collection._parentInode;var r={member:{".tag":"email",email:this.get("emailAddress")},access_level:i.roles[y]};var s=v.isFolder();r=(s?q(v,r):p(v,r));var w=Object.assign({},z,{data:JSON.stringify(r),headers:{"Content-Type":"application/json"},method:"POST",merge:true});w=(s?m(w):x(w));if(y){w.onComplete=function(B,D,C){var A=Object.assign({},B.get("actions"));A["make_"+i.roles[o]]=true;A["make_"+i.roles[y]]=false;B.set({actions:A});if(typeof z.onComplete==="function"){z.onComplete(B,D,C)}}}return this._parent(u,w);function q(B,A){return Object.assign({},A,{shared_folder_id:B.get("shared_folder_id")})}function p(B,A){return Object.assign({},A,{file:B.id})}function m(A){return Object.assign({},A,{url:"https://api.dropboxapi.com/2/sharing/update_folder_member"})}function x(A){return Object.assign({},A,{url:"https://api.dropboxapi.com/2/sharing/change_file_member_access"})}},destroy:function(n){var m,p,o=this.collection._parentInode;if(o.get("mimeType")===f.mimeType.folder){m="https://api.dropboxapi.com/2/sharing/remove_folder_member";p={shared_folder_id:o.get("shared_folder_id"),leave_a_copy:false}}else{m="https://api.dropboxapi.com/2/sharing/remove_file_member_2";p={file:o.get("id")||o.get("path")}}n=h.clone(n||{},false);n=Object.assign({method:"POST",type:"json",headers:{"Content-Type":"application/json"},url:m,data:JSON.stringify(Object.assign(p,{member:{".tag":"email",email:this.get("emailAddress")}}))},n);return this._parent(n)},parse:function(s){var m={};var n=s.name;n=(n?n.display_name:s.email);if(n){m.displayName=n}var q=s.email;if(q){m.emailAddress=q,m.id=q}var p={small:"",medium:"",large:""};var o=s.profile_photo_url;if(o){m.picture=Object.keys(p).reduce(function(v,u){v[u]=o;return v},{})}var t=s.access_type;if(t){t=t[".tag"]}if(t){t=i.roleToFrontend(t)}if(t){m.role=t}var r=(function(w){var u=w.permissions;if(!Array.isArray(u)){return}var v=w.access_type[".tag"];return u.reduce(function(z,y){var A=true;A=A&&y.allow;var x=y.action[".tag"];A=A&&!(("make_"+v)===x);z[x]=A;return z},{})})(s);if(r){m.actions=r}return m},sync:function(o,n,m){m.ajax=d.getRequestMethod(m,true);return this._parent(o,n,m)},isActionAllowed:function(n){var m=a[n];if(!m){return false}return m(this)}});return e});define("DS/W3DDrive/Utils/drivesHubConnect",["DS/W3DDrive/Utils/popAuth","DS/W3DDrive/Utils/hubRequestHelper"],function(e,a){return{createAuth:g,tryFetch:h};function h(j){if(!j){return Promise.resolve([])}return Promise.resolve(j).then(i).then(b).then(c)["catch"](function(){return[]})}function i(k){var j=k+"/drive/v1/providers?expand=true";return new Promise(function(m,l){a.performRequest(j,{onComplete:function(n){m({drives:n,url:k})},onFailure:function(o,n){l(n)},requestType:"json",responseType:"json",type:"json"})})}function b(k){var l=k.drives;var j=k.url;l=typeof l==="string"?JSON.parse(l):l;if(!Array.isArray(l)||l.length===0){return[]}return l.filter(function(m){return m.driveId==="onedrive"}).map(function(m){return{iconLink:m.driveIcon,id:m.driveId,thumbnailLink:m.driveIcon,title:m.driveName,url:j,isDrivesHubProvider:true}})}function c(j){return Promise.all(j.map(function(k){return d(k).then(function(l){k=Object.assign(k,{auth:g({drive:k,authenticated:true}),user:{emailAddress:l.email,name:l.name}});return k})["catch"](function(){k.auth=g({drive:k,authenticated:false});return k})}))}function f(k){var j=k.url+"/drive/v1/"+k.id+"/connect";return e.open(j).then(e.getLoginUrl).then(e.authenticate)}function d(k){var j=k.url+"/drive/v1/"+k.id+"/connect";return new Promise(function(m,l){a.performRequest(j,{onComplete:function(n){m(JSON.parse(n))},onFailure:function(){l(Error("No auth"))}})})}function g(j){return{adaptater:{},adaptaterOptions:{},authenticate:function(l,k){f(j.drive).then(function(m){l(m)})["catch"](function(m){k(m)})},data:{},hasIdentity:function(l,k){return j.authenticated?l():k()}}}});define("DS/W3DDrive/Collections/DrivesHub/RootInodes",["DS/W3DDrive/Collections/DrivesHub/Inodes"],function(b){var a=b.extend({url:function(){var c=this._parentInode.drive;var d=c.get("url");var e="/drive/v1/"+c.id+"/contents/hiddenroot/children";return d+e}});return a});define("DS/W3DDrive/Collections/GoogleDrive/InodesFactory",["DS/W3DDrive/Collections/GoogleDrive/Inodes","DS/W3DDrive/Collections/GoogleDrive/RootInodes","DS/W3DDrive/Collections/GoogleDrive/SharedWithMeRootInodes","DS/W3DDrive/Metas/GoogleDrive/inode","DS/W3DDrive/Models/GoogleDrive/InodeFactory"],function(g,d,b,a,h){var f=a(),c={},e;c[f.ids.trueRoot]=d;c[f.ids.sharedWithMe]=b;e=function(l,j){var k=j.parentInode,i;if(!k){return}i=c[k.id];if(!i){i=g}return new i(l,j)};e.prototype.model=h;return e});define("DS/W3DDrive/Collections/Dropbox/Permissions",["UWA/String","DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/Dropbox/Permission","DS/W3DDrive/Metas/Dropbox/permission","DS/W3DDrive/Metas/Dropbox/inode","DS/W3DDrive/Utils/RequestHelper"],function(a,c,e,f,i,d){var g=i();var h=f();var b=c.extend({url:function(){return this._parentInode.get("mimeType")===g.mimeType.folder?"https://api.dropboxapi.com/2/sharing/list_folder_members":"https://api.dropboxapi.com/2/sharing/list_file_members"},init:function(l,j){j=j||{};var k=j.parentInode;if(!k||!k.id){throw new Error("You must specify a valid parentInode options")}this._parentInode=k;return this._parent.apply(this,arguments)},makeFirstFetchPermissionsCall:function(){var l=this;var o=this._parentInode;var j=o.isFolder();var n=o.get("shared_folder_id")||o.get("parent_shared_folder_id");var m=new Promise(function(r,q){var p={actions:[{".tag":"remove"},{".tag":"make_editor"},{".tag":"make_owner"},{".tag":"make_viewer"},{".tag":"make_viewer_no_comment"}]};if(j){p.shared_folder_id=n}else{p.file=l._parentInode.id}d.performExternalRequestWithOptions(l.url(),{auth:l._auth,data:JSON.stringify(p),headers:{"Content-Type":"application/json"},type:"json",method:"POST",onComplete:r,onFailure:q})});return m.then(k);function k(q){var p=[];if(Array.isArray(q.users)){p=p.concat(q.users)}if(Array.isArray(q.invitees)){p=p.concat(q.invitees)}return p.map(function(r){var s=Object.assign({},(r.user||r.invitee));var t=Object.assign({},r);delete t.user;delete t.invitee;return Object.assign(s,t)})}},makeSecondFetchPermissionsCall:function(l){var m=this;var o=l.filter(function(p){return p.account_id});var k=o.map(function(p){return p.account_id});var n=new Promise(function(q,p){d.performExternalRequestWithOptions("https://api.dropboxapi.com/2/users/get_account_batch",{auth:m._auth,data:JSON.stringify({account_ids:k}),headers:{"Content-Type":"application/json"},type:"json",method:"POST",onComplete:q,onFailure:p})});return n.then(j(l));function j(p){return function(q){return p.map(function(r){if(!r.account_id){return r}return q.reduce(function(t,s){if(s.account_id!==r.account_id){return t}return Object.assign({},r,s)},null)})}}},fetch:function(m){var o=this._parentInode;var l=o.drive.get("user");var n=o.get("shared_folder_id")||o.get("parent_shared_folder_id");if(!n&&o.isFolder()){j(this,{parse:false})({id:l.emailAddress,displayName:l.displayName,emailAddress:l.emailAddress,role:h.roles.owner});return}m=m||Object.assign({},m);if(m.parse===undefined){m.parse=true}this.makeFirstFetchPermissionsCall().then(this.makeSecondFetchPermissionsCall.bind(this)).then(j(this,m),k(this,m));return;function j(q,p){return function(r){var s;s=p.reset?"reset":"set";q[s](r,p);if(typeof p.onComplete==="function"){p.onComplete(r)}return q.dispatchEvent("onSync",[q,r,p])}}function k(q,p){return function(r){if(typeof p.onFailure==="function"){p.onFailure(r)}q.dispatchEvent("onError",[q,r,p])}}},sync:function(l,k,j){j.ajax=d.getRequestMethod(j,true);return this._parent(l,k,j)},createPermissionFile:function(k,l){l=(l||{});var j=Object.assign({},k);var m=Object.assign({},l);var n={access_level:{".tag":h.roles[k.role]},file:this._parentInode.id,members:[{".tag":"email",email:k.emailAddress}]};m.onComplete=o;m.method="POST",m.headers={"Content-Type":"application/json"};m.url="https://api.dropboxapi.com/2/sharing/add_file_member";m.data=JSON.stringify(n);j.actions={remove:true};return c.prototype.create.call(this,j,m);function o(p,r,q){p.set("id",k.emailAddress);if(typeof l.onComplete==="function"){l.onComplete(p,r,q)}}},createPermissionFolder:function(j,k){k=(k||{});var m=this;var o=new Promise(function(q,p){var r=m._parentInode.get("shared_folder_id");if(r){return q(r)}d.performExternalRequestWithOptions("https://api.dropboxapi.com/2/sharing/share_folder",{data:JSON.stringify({path:m._parentInode.get("path")}),headers:{"Content-Type":"application/json"},method:"POST",type:"json",auth:m._auth,onComplete:function(s){return q(s.shared_folder_id)},onFailure:p})});o.then(function(r){m._parentInode.set("shared_folder_id",r);var q=Object.assign({},k);var s={shared_folder_id:r,members:[{member:{".tag":"email",email:j.emailAddress},access_level:{".tag":h.roles[j.role]}}]};var p=Object.assign({},j);var t={remove:true,make_viewer:true,make_editor:true};t["make_"+h.roles[j.role]]=false;p.actions=t;q.onComplete=n;q.method="POST",q.headers={"Content-Type":"application/json"};q.type="text";q.url="https://api.dropboxapi.com/2/sharing/add_folder_member";q.data=JSON.stringify(s);c.prototype.create.call(m,p,q)},l);function n(p,r,q){p.set("id",j.emailAddress);if(typeof k.onComplete==="function"){k.onComplete(p,r,q)}}function l(p,r,q){if(typeof k.onFailure==="function"){k.onFailure(p,r,q)}}},create:function(j,k){this._parentInode.isFolder()?this.createPermissionFolder(j,k):this.createPermissionFile(j,k)},model:e});return b});define("DS/W3DDrive/Collections/DrivesHub/InodesFactory",["DS/W3DDrive/Collections/DrivesHub/Inodes","DS/W3DDrive/Collections/DrivesHub/RootInodes","DS/W3DDrive/Metas/DrivesHub/inode","DS/W3DDrive/Models/DrivesHub/InodeFactory"],function(e,b,a,f){var g=a();var d={};d[g.ids.trueRoot]=b;var c=function(k,i){var j=i.parentInode;if(!j){return}var h=d[j.id];if(!h){h=e}return new h(k,i)};c.prototype.model=f;return c});define("DS/W3DDrive/Models/GoogleDrive/Drive",["UWA/Core","DS/W3DDrive/Metas/drive","DS/W3DDrive/Models/Drive","DS/W3DDrive/Collections/GoogleDrive/InodesFactory","DS/W3DDrive/Collections/GoogleDrive/PermissionsFactory","DS/WebappsUtils/WebappsUtils","DS/W3DDrive/Utils/RequestHelper"],function(g,a,i,c,j,d,f){function b(m){return{total:m.quotaBytesTotal||"",used:m.quotaBytesUsed||""}}function e(o){var n=o.user||{},m=n.displayName||o.name;return{id:n.permissionId,displayName:m||"",emailAddress:n.emailAddress||""}}var h=a(),l=i.prototype.defaults,k;k=i.extend({_Inodes:c,_Permissions:j,url:"https://www.googleapis.com/drive/v2/about",defaults:g.merge({id:h.ids.google2,title:"Google Drive",thumbnailLink:d.getWebappsAssetUrl("W3DDrive","Google_Drive_40x30.png"),iconLink:d.getWebappsAssetUrl("W3DDrive","Google_Drive_80x60.png")},l),sync:function(o,n,m){m.ajax=f.getRequestMethod(m,true);return this._parent(o,n,m)},parse:function(m){return{granted:m.granted,authenticated:m.authenticated,quotaBytes:b(m),user:e(m)}}});return k});define("DS/W3DDrive/Models/Dropbox/Drive",["UWA/Core","DS/W3DDrive/Metas/drive","DS/W3DDrive/Models/Drive","DS/W3DDrive/Collections/Dropbox/InodesFactory","DS/W3DDrive/Collections/Dropbox/Permissions","DS/W3DDrive/Utils/RequestHelper","DS/WebappsUtils/WebappsUtils"],function(g,a,j,f,c,e,b){function d(l){if(!l.name){return{displayName:"",emailAddress:""}}return{id:l.account_id,displayName:l.name.display_name,emailAddress:l.email,picture:{small:l.profile_photo_url,medium:l.profile_photo_url,large:l.profile_photo_url}}}var i=a(),k=j.prototype.defaults,h;h=j.extend({_Inodes:f,_Permissions:c,url:"https://api.dropboxapi.com/2/users/get_current_account",defaults:g.merge({id:i.ids.dropbox,title:"Dropbox",thumbnailLink:b.getWebappsAssetUrl("W3DDrive","Dropbox_40x30.png"),iconLink:b.getWebappsAssetUrl("W3DDrive","Dropbox_80x60.png")},k),fetch:function(l){var m=Object.assign({},l,{method:"POST",url:this.url});return this._parent(m)},sync:function(n,m,l){l.ajax=e.getRequestMethod(l,true);return this._parent(n,m,l)},getStorage:function(m){if(!m.email){return{total:"",used:""}}var l=this;e.performExternalRequestWithOptions("https://api.dropboxapi.com/2/users/get_space_usage",{method:"POST",type:"json",auth:this.get("auth")||this.collection._auth,onComplete:function(n){if(n){l.set("quotaBytes",{used:n.used||"",total:n.allocation.allocated||""})}},onFailure:function(n){console.log(n)}})},parse:function(l){return{granted:l.granted,authenticated:l.authenticated,quotaBytes:this.getStorage(l),user:d(l)}}});return h});define("DS/W3DDrive/Actions/moveAndCopy",["DS/W3DDrive/Metas/inode","DS/W3DDrive/Actions/drivesInputs","DS/W3DDrive/Actions/dialogTree","DS/W3DDrive/Actions/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Utils/StructureNavigation","DS/UIKIT/Input/Toggle","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(d,m,b,j,n,h,i,p){var g=d();var f;return function(z,F){F.excludeInodes=l(z,F);var s="";var r="";var A="";var t=[];var G=false;var w={};if(F.duplicate){s=p.replace(p.copyElem,{name:z.get("title")});A=p.copy;t.push({label:p.copyLinkedFiles});t.push({label:p.copyFileOnly})}else{if(F.restore){s=p.replace(p.restoreElem,{name:z.get("title")});r=p.replace((F.errorCode===1)?p.restoreNotAvailableParent:p.restoreNotUniqueName,{name:z.get("title")});A=p.restore;F.checkForm=function(H){if(H){G=true}var I=document.getElementById("inputName");var J=o(u.xso);if(I.getAttribute("validity")!=="true"||I.value===""||(F.errorCode===2&&I.value===z.get("title")&&(J[0].id===z.get("oldparentid")))){return false}else{f=I.value;return true}};var E=m(z);var y=E.maxchars;var D=j.createTextInput(Object.assign({pattern:E.forbiddenChars.regex,required:true,title:E.forbiddenChars.text||"",value:z.get("title"),id:"inputName",},y));var C=j.createTextError({text:E.forbiddenChars.text});var x={chars:E.forbiddenChars.text,maxLengthText:y?y.maxLengthText:undefined};D.classList.add("modal_inputName");D.setAttribute("validity",true);D.onkeyup=function(){D.setAttribute("validity",this.checkValidity());j.onCheckInput(y.maxLength,D,C,x,".js-validation-button");var H=D.parentElement.parentElement.parentElement.querySelector(".js-validation-button");if(G&&F.checkForm()){H.classList.remove("disabled")}else{H.classList.add("disabled")}};w.modalNewTitle=D;w.header=(UWA.createElement("div",{html:r,"class":"shareview__header-text"}));w.textErrorInputName=C}else{s=p.replace(p.moveElem,{name:z.get("title")});A=p.move;t.push({label:p.moveLinkedFiles});t.push({label:p.moveFileOnly})}}var u=b(z,F);if(h.isLinkedFile(z)){var q=a({toggleItems:t});u=Object.assign(u,q);u.modalContentTree.appendChild(u.container)}var v=e({model:z,components:u,callbackOptions:F,title:s,buttonValue:A,inodeActions:F.inodeActions});var B=Object.assign({},w,u,v);c(B)};function l(t,q){var s=q.duplicate;var r={};var u=t.isFolder()?t.inodeTable.dotDot():t.collection.dot();r[g.ids.sharedWithMe]=true;r[g.ids.trash]=true;if(!s){r[g.ids.sharedWithMe]=true;r[u.get("id")]=true}return r}function c(q){n.dialog({title:q.title,body:[q.header,q.modalNewTitle,q.textErrorInputName,q.modalContentTree],buttons:q.buttons});var r=n.modals.current.elements;r.footer.getElement(".js-validation-button").addClassName("disabled");r.scroller=q.scroller;r.treeView=q.treeView}function e(s){var r=s.model;var t=s.components;var u=s.inodeActions;var q=s.callbackOptions;return{title:s.title,buttons:[{className:"primary js-validation-button",value:s.buttonValue,action:function(v){v.hide();k(Object.assign({},{model:r,components:t},q))}},{value:p.cancel,action:function(v){v.hide()}}]}}function k(r){var q=r.model;var s=r.components;var x=r.dispatchEvent;var w=r.callback;var v=r.fallback;var t={data:{}};if(s.toggleLinked&&s.toggleLinked.isChecked()){t.queryStrings={expand:"true"}}var u=o(s.xso);t.data.parentid=u[0].id;if(r.duplicate){return x("onCopy",[q,u[0],t])}else{if(r.restore){return q.restore({parentid:u[0].id,title:f}).then(w,v)}}x("onMove",[q].concat(u[0],t,r.itemView))}function a(t){if(!t||!t.toggleItems){throw"You must specify a valid options object with a toggleItems properties"}var v=t.toggleItems;var r={name:"transfertType",className:"primary"};var s=new i(Object.assign({},r,{value:"all",label:v[0].label})).check();var u=new i(Object.assign({},r,{value:"one",label:v[1].label}));var q=document.createElement("div");q.appendChild(s.elements.container);q.appendChild(u.elements.container);return{container:q,toggleLinked:s,toggleOne:u}}function o(q){return q.get().map(function(r){return r.inode})}});define("DS/W3DDrive/Actions/editCS",["DS/W3DDrive/Actions/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DDrive/Actions/drivesInputs","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,a,e,c,d){return function(o,q){var k=c(o);var g;var x;var n;var u;var z;var t=k.maxchars;var r=k.maxcharsDesc;var j;var f;var s;var l;var h;var w;var C=[];var B=o.drive.get("actions").filter(function(i){return i==="add.collabspaces.visibility"});var A=[{value:"PRIVATE",label:d.isPrivate+" - "+d.privateDetail},{value:"PROTECTED",label:d.isProtected+" - "+d.protectedDetail},{value:"PUBLIC",label:d.isPublic+" - "+d.publicDetail}];if(o.get("visibility").value.toUpperCase()===("Private").toUpperCase()){A[0].selected=true}else{if(o.get("visibility").value.toUpperCase()===("Protected").toUpperCase()){A[0].disabled=true;A[1].selected=true}else{A[0].disabled=true;A[1].disabled=true;A[2].selected=true}}l=d.editCollabSpace;x=b.createTextInput(Object.assign({pattern:k.forbiddenChars.regex,required:true,placeholder:d.CSName,title:k.forbiddenChars.text,value:o.get("title")},t));s=b.createTextError(k.forbiddenChars.text);w=b.createTextError(d.warningDescription);n=b.createTextInput(Object.assign({name:"description",placeholder:d.description,value:o.get("description")},r));u=b.createSelectInput(Object.assign({required:true,message:d.chooseFamily,options:[{value:"DESIGNTEAM",label:d.design+" - "+d.designDetail},{value:"STANDARDTEAM",label:d.standard+" - "+d.standardDetail}],value:o.get("family").value},t));z=b.createSelectInput(Object.assign({required:true,message:d.choosePrivacy,options:A,value:o.get("visibility").value},t));if(o.get("actions")){var v=o.get("actions");if(o.get("actions").indexOf("edit.title")>o.get("actions").indexOf("edit.owner")){v=o.get("actions").reverse()}for(var y=0;y<v.length;y++){if(v[y]==="edit.title"){C.push(b.createTextLabel(d.title),x,s)}if(v[y]==="edit.description"){C.push(b.createTextLabel(d.description),n,w)}if(B.length>0&&v[y]==="edit.visibility"){C.push(b.createTextLabel(d.visibility),z,b.createWarningLabel(d.warningVisibility))}if(o.drive.get("isInnovation")&&v[y]==="edit.family"){C.push(b.createTextLabel(d.family),u)}}}g=b.createForm(C,{className:"form_form-create"});g.addEventListener("submit",function(G){G.preventDefault();var H=(x.value||"").trim();var i=n.value||"";var E=z.getValue()[0];var F=u.getValue()[0];var D;if(!H){return}D={title:H,description:i,visibility:E,family:F};e.dispatchEvent("inodeActions:onEditCS",[o,q,D]);g.parentNode.removeChild(g);g=null;a.modals.current.hide()});f={chars:k.forbiddenChars.text,maxLengthText:t?t.maxLengthText:undefined};h={chars:r?r.maxLength:undefined,maxLengthText:d.warningDescription};x.addEventListener("keyup",function(){b.onCheckInput(t.maxLength,x,s,f,".js-validation-button")});n.addEventListener("keyup",function(){b.onCheckInput(r.maxLength,n,w,h,".js-validation-button")});x.addEventListener("keydown",m);n.addEventListener("keydown",m);j={title:l,body:g,buttons:[{className:"primary js-validation-button",value:d.editCS,action:function(){p()}},{value:d.cancel,action:function(){g.parentNode.removeChild(g);g=null;a.modals.current.hide()}}]};a.dialog(j);a.modals.current.getBody().getElement("input[autofocus]").focus();function p(){var i;if(document.createEvent){i=document.createEvent("Event");i.initEvent("submit",true,true)}else{i=new Event("submit")}g.dispatchEvent(i)}function m(i){if(i.key!=="Enter"){return}i.preventDefault();p()}}});define("DS/W3DDrive/Models/uploadManager",["UWA/Class/Promise","DS/Usage/TrackerAPI","DS/W3DDrive/scheduleTasksToGlobalSession","DS/W3DContentApp/Views/UploadInodesView/taskViewSet","DS/W3DContentApp/Views/UploadInodesView/uploadInodeTaskView","DS/W3DContentApp/Utils/Alert","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(m,j,e,c,n,l,h,p){var g=0;var d=[];var k=[];var b=0;function i(v,t,r){if(!v||!t){return}k=[",","$",";","'"];var s=k.some(function(y){return t.name.indexOf(y)>-1});if((h.getValue("is3DSpaceWidget")==="true")&&s){return l.add({message:p.replace(p.forbiddenCharsUpload,{chars:", ; ' $"}),className:"error"})}else{var x=v.inodeTable;var w=Boolean(x);w=w&&(typeof x.create==="function");w=w&&(typeof x._prepareModel==="function");if(!w){return}r=Object.assign({},r,{file:t,wait:true});var u=x._prepareModel({parentId:v.id,title:t.name||"",mimeType:t.type});c.add(n({model:u}));return function(){return new m(function(B,A){var z=j.getTimer("3DDrive-upload-timer-"+b++,{label:"Upload file",appID:"X3DDRIV_AP",tenant:v.drive.id});z.start();var C=r.onComplete;var y=r.onFailure;r.onComplete=function(D){z.stop();z.getDuration().then(function(E){console.log(E)});if(typeof C==="function"){C.apply(this,arguments)}B()};r.onFailure=function(D){if(typeof y==="function"){y.apply(this,arguments)}A()};x.create(u,r)})}}}function o(){function r(){var s=d.pop();if(typeof s!=="function"){--g;return m.resolve()}return s().then(r,function(){--g;a()})}++g;return r()}function a(){var r=[];while(g<7&&d.length){r.push(o())}return m.all(r)}function f(u,s,r){var t=Object.keys(s).filter(function(v){return(typeof s[v]==="object")}).map(function(v){return s[v]}).map(function(v){return i(u,v,r)});return e(t)}function q(r){c.add(n({model:r}));return j.getTimer("3DDrive-upload-timer-"+b++,{label:"Upload file",appID:"X3DDRIV_AP",tenant:r.drive.id})}return{askForUpload:f,addUploadTask:q}});define("DS/W3DDrive/Actions/Share/ExternalServices/shareExternalServices",["DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Actions/Share/shareFactory","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(d,b,e){return function(i,f){var h=a(i,f);var g=d.getActionIds(i);return c(g,h)};function c(k,h){h=(h||{});var g=b.createInvitationView(b.getInputCategories(k));var j=b.bindViewToModal(g);var l=g.saveProcess;g.saveProcess=function(){if(typeof h.onComplete!=="function"){return}h.onComplete(l.apply(this,arguments))};g.onClose=function(){j.hide();g.destroy()};var i=g.destroy;g.destroy=function(){g=null;l=null;k=null;h=null;i.apply(this,arguments)};var f=b.makeElement({element:"div",classes:"shareview__external"});f.appendChild(g.container);g.render();return f}function a(h,f){var g=Object.assign({},f);g.onComplete=function(i){if(typeof f.onComplete!=="function"){return}f.onComplete(h,i)};return g}});define("DS/W3DDrive/Actions/Permissions/ShareAccess",["DS/W3DDrive/Metas/permission","DS/W3DDrive/Actions/formFactory","DS/W3DDrive/Utils/StructureNavigation","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(c,b,a,e){var d=c();return function(g){g.actions=g.actions.concat([{id:d.actionPubIds.removePermission,text:e.remove,icon:"fonticon fonticon-cancel",handler:function(){var h=g.model;var l=h.collection._parentInode;var i;var j=document.createTextNode(e.replace(e.shareRemove,{name:h.get("displayName")||h.get("label")}));if(a.isLinkedFile(l)){i=b.createToggleRadios({toggleType:"removeType",items:[{value:"all",label:e.shareRemoveLinkedFiles},{value:"one",label:e.shareRemoveFileOnly}]})}var k=[j];if(i){k.push(i.container)}return g.openDialog({titleNLSKey:"shareRemove",modalBodyContent:k,confirmAction:{NLSKey:e.remove,handler:function(){var m={};if(i&&i.items[0].isChecked()){m.queryStrings={expand:"true"}}g.dispatchPermissionActions("onRemoveShare",[h,m])}}})}},{id:d.actionPubIds.makeWriter,text:e.writer,icon:"fonticon fonticon-pencil",handler:function(){f("writer")}},{id:d.actionPubIds.makeReader,text:e.reader,icon:"fonticon fonticon-eye",handler:function(){f("reader")}},{id:d.actionPubIds.makeWriterShare,text:e.writer,icon:"fonticon fonticon-pencil",handler:function(){f("writerSharer")}},{id:d.actionPubIds.makeReaderShare,text:e.reader,icon:"fonticon fonticon-eye",handler:function(){f("readerSharer")}},{id:d.actionPubIds.enableShare,text:e.enableSharing,icon:"fonticon fonticon-user-add",handler:function(){f(g.model.get("role")+"Sharer")}},{id:d.actionPubIds.disableShare,text:e.disableSharing,icon:"fonticon fonticon-user-delete",handler:function(){var h=g.model.get("role");if(h==="writerSharer"){return f("writer")}f("reader")}}]);function f(k){var h=g.model;if(!a.isLinkedFile(h.collection._parentInode)){g.dispatchPermissionActions("onUpdate",[h,k]);return}var i=b.createToggleRadios({toggleType:"editType",items:[{value:"all",label:e.shareEditLinkedFiles},{value:"one",label:e.shareEditFileOnly}]});var j=document.createTextNode(e.replace(e.shareEdit,{name:h.get("displayName")}));g.openDialog({titleNLSKey:"shareEdit",modalBodyContent:[j,i.container],confirmAction:{NLSKey:e.change,handler:function(){var l={};if(i.items[0].isChecked()){l.queryStrings={expand:"true"}}g.dispatchPermissionActions("onUpdate",[h,k,l])}}})}return g}});define("DS/W3DDrive/Utils/Rerouter",["UWA/String","DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Metas/errors","DS/W3DDrive/Utils/RequestHelper"],function(f,a,d,e,h){var g=e().xmlhttprequestCodes;var c=e().w3ddrive;var b={Router:null,setRouter:function(i){this.Router=i},_getRessource:function(i,k){var j=f.format("{0}/share/v1/guest/{1}",i,encodeURIComponent(k));return new Promise(function(n,m){var l=h.performRequest(j,function(o){if(o){n(o)}else{m({status:g.NOT_FOUND})}},function(o,p){var q;if(p&&p.hasOwnProperty("error")===true){q=p.error}m({status:l.xhr.status,msg:q})})})},_getContent:function(j,i){return this._getRessource(j,i).then(function(l){var k=f.format("{0}",l.url);h.setTenant(l.tenant);h.setBaseUrl(l.url.split("/enovia")[0]+"/enovia");return new Promise(function(o,n){var m=h.performRequest(k,function(p){if(p){p.tenant=l.tenant;o(p)}else{n({status:g.NOT_FOUND})}},function(p,q){var r;if(q&&q.hasOwnProperty("error")===true){r=q.error}n({status:m.xhr.status,msg:r})})})},function(k){return new Promise(function(m,l){l(k)})})},rerouteFromSharedToken:function(j,i){if(!i){b.Router.navigate(f.format("error/{0}/$/$",c.noToken),{trigger:true})}else{b._getContent(j,i).then(function(m){var l;var k=a().mimeType.folder;if(m.mimetype===d().mimeType.folder){l=f.format("drives/{0}/mimetype/{1}/inode/{2}/content",m.tenant,encodeURIComponent(k),m.id)}else{l=f.format("drives/{0}/mimetype/{1}/inode/{2}/content/{3}/preview",m.tenant,encodeURIComponent(k),m.parentid,m.id)}b.Router.navigate(l,{trigger:true})},function(l){var k;switch(l.status){case g.NOT_FOUND:k=f.format("error/{0}/{1}/{2}",c.ressourceAccess,l.status,encodeURIComponent(l.msg));break;default:k=f.format("error/{0}/$/{1}",c.ressourceAccess,encodeURIComponent(l.msg))}b.Router.navigate(k,{trigger:true})})}}};return b});define("DS/W3DDrive/Utils/AutoRefresh",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DContentApp/Utils/Alert","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(h,f,j){var l=h().boType;var b=h().ids;var d;var c;var k=3000;var e="sharedwithme";var a={created:"created",modified:"modified",moved:"moved",removed:"removed",renamed:"renamed",restored:"restored",shared:"shared",trashed:"trashed",unshared:"unshared"};return{setw3dDriveView:function(m){if(!d){d=m}},setRouter:function(m){if(!c){c=m}},processEvent:function(m){switch(m.action){case a.created:case a.shared:this.processCreationEvent(m);break;case a.modified:case a.renamed:this.processModificationEvent(m);break;case a.removed:case a.unshared:this.processRemovalEvent(m);break;case a.moved:case a.restored:case a.trashed:this.processMovingEvent(m);break;default:break}},processCreationEvent:function(m){var o=d.getSecondPanel().model.drive;var q;if(m.action===a.shared){m.parentid=e;var p=o.getInode(e);q=p.inodeTable.add({items:[m]},{parse:true})}else{var n=o.getInode(m.parentid,{noCreate:true});if(!n||!n.inodeTable){return}q=n.inodeTable.add({items:[m]},{parse:true})}if(!Array.isArray(q)||q.length===0){return}var r=q[0];r.fetch();if(m.type===l.document){r.loadPreview({waitingTime:k})}},processModificationEvent:function(m){var o=d.getSecondPanel().model.drive;var n=o.getInode(m.id,{noCreate:true});if(!n){return}m.parentid=n.get("parentId");n.set(n.parse(m));if(m.type===l.document){n.loadPreview({waitingTime:k})}if("/"+c.getLastFragment()===o.getInodePreviewURI(n)){d.updateLightbox(n)}},processRemovalEvent:function(m){var n=d.getSecondPanel().model;var o=n.drive.getInode(m.id,{noCreate:true});if(!o){return}if(o.get("parentId")===e){m.parentid=e}if(m.parentid===n.id){g({currentFolder:n,inodeToRemove:o});return}var q=o.get("parentid")||o.get("parentId");var p=n.drive.getInode(q,{noCreate:true});if(!p){return}i({currentFolder:n,inodeToRemove:o,parentInode:p,serverData:m})},processMovingEvent:function(m){var o=d.getSecondPanel().model;var p=o.drive;var n=p.getInode({id:m.id},{noCreate:true});var q=p.getInode({id:m.parentid},{noCreate:true});if(!n){this.processCreationEvent(m);d.hideLightbox();return}var r=p.getInode(n.get("parentId"));if(n.isContainer()){p.getInodesPath(o).then(function(s){var t=s.some(function(u){return u.id===m.id});if(t){f.add({message:j.replace(j.folderMoved,{parentFolder:n.get("title")}),className:"warning"})}})}if(!q||m.parentid===b.root){r.inodeTable.remove(n);return}n.set(n.parse(m));if("/"+c.getLastFragment()===p.getInodePreviewURI(n)){n.listenToOnce(n,"onAdd",function(s){c.navigate(p.getInodePreviewURI(s),{trigger:true})});f.add({message:j.fileMoved,className:"warning"})}}};function g(m){var n=m.currentFolder;var o=m.inodeToRemove;if("/"+c.getLastFragment()===n.drive.getInodePreviewURI(o)){f.add({message:j.fileDeleted,className:"warning"});c.navigate(n.drive.getInodePanelContentURI(n),{trigger:false});d.hideLightbox()}n.inodeTable.remove(o)}function i(n){var o=n.currentFolder;var p=n.inodeToRemove;var q=n.parentInode;var m=n.serverData;o.drive.getInodesPath(o).then(function(s){var r=s.some(function(u){return u.id===m.id});if(!r||!q){return}var t=j.folderDeleted;if(p!==o){t=j.replace(j.parentFolderDeleted,{parentFolder:p.get("title")})}f.add({message:t,className:"warning"});c.navigate(o.drive.getInodePanelContentURI(q),{trigger:o.isContainer()});d.hideLightbox()}).then(function(){q.inodeTable.remove(p)})}});define("DS/W3DDrive/Models/DSDrive/Trash",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/DSDrive/Inode","DS/W3DDrive/Models/Stub","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(c,b,e,d,g){var a=b();var h=c();var f=e.extend(d,{defaults:{parentId:h.ids.trueRoot,title:g.trash,mimeType:a.mimeType.folder,iconLink:h.icons.trash,thumbnailLink:{small:h.thumbnails.folder,medium:h.thumbnails.folder,large:h.thumbnails.folder}},getActionIds:function(){return[]}});return f});define("DS/W3DDrive/Models/DSDrive/InodeFactory",["DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Models/DSDrive/Inode","DS/W3DDrive/Models/DSDrive/MainRoot","DS/W3DDrive/Models/DSDrive/SharedWithMeRoot","DS/W3DDrive/Models/DSDrive/Trash"],function(f,h,d,c,e){var g=f();var i={};i[g.ids.root]=d;i[g.ids.sharedWithMe]=c;i[g.ids.trash]=e;var b=h.prototype.idAttribute;function a(l,k){var m=l[b];var j=i[m];if(!j){j=h}return new j(l,k)}a.prototype.idAttribute=b;return a});define("DS/W3DDrive/Collections/DSDrive/Inodes",["UWA/Core","UWA/String","UWA/Class/Promise","DS/W3DDrive/Collections/Inodes","DS/W3DDrive/scheduleTasksToGlobalSession","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Models/DSDrive/InodeFactory","DS/W3DDrive/Utils/errors","DS/W3DDrive/Utils/RequestHelper"],function(j,c,k,i,b,f,e,l,g){var d;var a=f();d=i.extend({shouldFetch:true,model:e,url:function(p){var o=c.format("{0}/{1}/contents",this.serviceUrl(),this._parentInode.id);var n={createFolder:"?update=true&withactions=true",fetch:"?withactions=true"};var q=n[p]||n.fetch;return o+q},serviceUrl:function(){var n=this._auth.getStorage();return c.format("{0}",g.getBaseUrl(n.url))},parse:function(n){return n.items},fetch:function(n){n=(n||{});var o=Object.assign({},n);if(!this.shouldFetch){if(typeof n.onComplete==="function"){n.onComplete(this,this.toJSON(),n)}this.dispatchEvent("onSync",[this,this.toJSON(),n]);return}if(n.withThumbnails){o.onComplete=function(r,q){var p=0;h(r,m).map(function(u,t,s){u.then(function(v){r.push(v,{parse:true,merge:true});if(++p===s.length){if(typeof n.onComplete==="function"){n.onComplete(r,q,n)}}})})}}return this._parent(o)},create:function(n,o){o=Object.assign({},o);var p=o.file;if(p&&p.size>a.constants.maxFileSize){o.onFailure(n,l.createUploadFileSizeErrorDSDrive(a));return null}if(p&&p.name.indexOf("@")>-1){o.onFailure(n,l.createUploadFileNameErrorDSDrive("@"));return null}o.url=this.url("createFolder");return this._parent(n,o)},shareChildren:function(q,p,o){var n=this;o=o||{};var r=q.reduce(function(u,s){if(!n.contains(s)){return u}var t=s.permissions;return p.map(function(w){var v=t.findWhere({emailAddress:w.emailAddress});if(v){return function(){return new k(function(y,x){v.save({role:w.role,message:w.message},{patch:true,onComplete:function(z){y({inode:s,permission:z})},onFailure:function(z){x({inode:s,permission:z})},onTimeout:function(z){t.remove(z);x({inode:s,permission:z,reason:"timeout"})}})})}}return function(){return new k(function(y,x){t.create(w,Object.assign({wait:false,onComplete:function(z){y({inode:s,permission:z})},onFailure:function(z){t.remove(z);x({inode:s,permission:z})},onTimeout:function(z){t.remove(z);x({inode:s,permission:z,reason:"timeout"})}},o))})}}).concat(u)},[]);return b(r)},destroyChildren:function(p,n){var o=this;n=(n||{});if(!p.length){return k.resolve()}o.shouldFetch=false;return new k(function(r,q){var s=p.map(function(t){return function(){return new k(function(v,u){t.destroy(Object.assign(n,{onComplete:v,onFailure:function(){u(t)}}))})}});b(s).then(function(){o.shouldFetch=true;r()},function(t){o.shouldFetch=true;q(t)})})},getDownloadUrl:function(o){var n=c.format("{0}/download",g.getBaseUrl(this._auth.getStorage().url));return new k(function(q,p){var r=function(s){var t=s?s.url:null;q({url:(s?s.url:null),method:"POST"})};g.performRequest(n,r,p,{ids:m(o)})})}});return d;function m(n){return n.map(function(o){return o.id}).reduce(function(p,q,o,s){var r=p;if(p){r+=","}return r+q},"")}function h(q,p){var n;n=c.format("{0}/previews",g.getBaseUrl(q._auth.getStorage().url));var o=[];var r=30;q.reduce(function(t,u,s){t=t.concat(u);if(t.length===r||s===q.length-1){o.push(new k(function(w,v){g.performRequest(n,w,v,{ids:p(t)})}));t=[]}return t},[]);return o}});define("DS/W3DDrive/Models/3DSpace/InodeFactory",["DS/W3DDrive/Models/DSDrive/InodeFactory","DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Models/3DSpace/MyCollabSpacesRoot","DS/W3DDrive/Models/3DSpace/MyCollabSpace","DS/W3DDrive/Models/3DSpace/MyCollabSpaceContent"],function(e,f,c,a,g){var b=f();var h={};h[b.ids.myCollabSpaces]=c;var d=e.prototype.idAttribute;function i(l,k){if(!l.name){l.name=l.id}var j=h[l[d]];if(l.mimeType===b.boType.collabSpace){j=a}if(l[d]===b.ids.trueRoot){j=a}if(!j){j=g}return new j(l,k)}i.prototype.idAttribute=d;return i});define("DS/W3DDrive/Actions/Permissions/ShareAccessLink",["DS/W3DDrive/Metas/permission","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c){var b=a();return function(d){d.actions.push({id:b.actionPubIds.removePermission,text:c.remove,icon:"fonticon fonticon-cancel",handler:function(){var e=d.model;var f=document.createTextNode(c.replace(c.shareRemove,{name:e.get("displayName")}));return d.openDialog({titleNLSKey:"shareRemove",modalBodyContent:[f],confirmAction:{NLSKey:c.remove,handler:function(){d.dispatchPermissionActions("onRemoveLinkAuthorization",[e])}}})}});return d}});define("DS/W3DDrive/Actions/Permissions/permissionActionsFactory",["DS/W3DDrive/Actions/Permissions/Base","DS/W3DDrive/Actions/Permissions/CollabSpace","DS/W3DDrive/Actions/Permissions/ShareAccessLink","DS/W3DDrive/Actions/Permissions/ShareAccess"],function(d,b,c,a){return function(f){if(!f||!f.permission){throw new Error("A permission is necessary to build actions.")}var e=f.permission;var h=e.collection._parentInode;if(h.drive.isCollabSpace){return g(b)}if(h.drive.isDsDrive&&e.type==="link"){return g(c)}if(h.drive.isDsDrive&&e.type==="group"){return g(a)}return g(a);function g(){var j=new d({model:e});for(var i in arguments){if(arguments.hasOwnProperty(i)){var k=arguments[i];k(j)}}return j}}});define("DS/W3DDrive/Actions/editContent",["DS/W3DDrive/Actions/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DDrive/Actions/drivesInputs","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,a,e,c,d){return function(m,g){var r=c(m);var h;var j;var p;var o=r.maxchars;var i=r.maxcharsDesc;var l;var n;var f;var q;var k=[];q=d.editContent;j=b.createTextInput(Object.assign({required:true,placeholder:d.title,value:m.get("title")},o));f=b.createTextError(d.warningEditTitle);p=b.createTextInput(Object.assign({name:"description",placeholder:d.description,value:m.get("description")},i));k.push(b.createTextLabel(d.title),j,f);k.push(b.createTextLabel(d.description),p);h=b.createForm(k,{className:"form_form-create"});h.addEventListener("submit",function(t){t.preventDefault();var v=(j.value||"").trim();var u=p.value||"";var s;s={title:v,description:u};e.dispatchEvent("inodeActions:onEditContent",[m,s]);h.parentNode.removeChild(h);h=null;a.modals.current.hide()});n={chars:r.forbiddenChars.notEmpty,maxLengthText:o?o.maxLengthText:undefined};j.addEventListener("keyup",function(){b.onCheckInput(o.maxLength,j,f,n,".js-validation-button")});l={title:q,body:h,buttons:[{className:"primary js-validation-button",value:d.editCS,action:function(){var s;if(document.createEvent){s=document.createEvent("Event");s.initEvent("submit",true,true)}else{s=new Event("submit")}h.dispatchEvent(s)}},{value:d.cancel,action:function(){h.parentNode.removeChild(h);h=null;a.modals.current.hide()}}]};a.dialog(l);a.modals.current.getBody().getElement("input[autofocus]").focus()}});define("DS/W3DDrive/Collections/DSDrive/RootInodes",["DS/W3DDrive/Collections/DSDrive/Inodes","DS/W3DDrive/Collections/Stub","DS/W3DDrive/Metas/DSDrive/inode"],function(c,b,e){var d=e();var a=c.extend(b,{init:function(h,g){var f=[d.ids.root,d.ids.sharedWithMe,d.ids.trash].map(function(j){var i={};i[this.model.prototype.idAttribute]=j;return i},this).map(function(l){var j;var k;for(k=0;(!j&&k<h.length);k++){if(h[k].id===l.id){j=h[k]}}return(j||l)});return this._parent(f,g)}});return a});define("DS/W3DDrive/Collections/3DSpace/RootInodes",["DS/W3DDrive/Collections/Inodes","DS/W3DDrive/Collections/Stub","DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Models/3DSpace/InodeFactory"],function(c,a,e,b){var e=e();var d=c.extend(a,{init:function(i,g){g=g||{};var f=[];f.push(e.ids.myCollabSpaces);var h=this.model.prototype.idAttribute;return this._parent(f.map(function(k){var j={};j[h]=k;return j}).map(function(l){var j;var k;for(k=0;(!j&&k<i.length);k++){if(i[k].id===l.id){j=i[k]}}return(j||l)}),g)},model:b});return d});define("DS/W3DDrive/Actions/Share/CollabSpaces/shareContent",["UWA/String","DS/W3DDrive/Utils/RequestHelper","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css"],function(b,d,f,g,i){return function(l,k){var j=l[0];return c(j).then(function(m){return m})};function c(j){return new Promise(function(m,l){var n;var p;var k;var o;require(["DS/SwymPublishForm/script/publish-form-view"],function(q){o=new q({title:"",description:"",contentTitle:j.get("title"),contentDescription:"",mode:"jsevent",platformId:j.drive.get("auth").getSwymService()});o.addEvent("CancelShare",function(r){e()},false);o.addEvent("StartUpload",function(r){var t=b.format("{0}/resources/enocsmrest/publish/swym/createMedia",j.drive.get("auth").getStorage().url3DSpace);var u=JSON.parse(r);p=u.platform_instance;k=u.community_id;var s=u.content_type;var v=j.get("id");d.performRequestWithOptions(t,{url:t,auth:j.drive.get("auth"),timeout:15000,method:"POST",data:JSON.stringify({platformid:p,communityid:k,contenttype:s,isDownloadable:"true",objectid:v}),type:"json",headers:{"Content-type":"application/json; charset=UTF-8",Accept:"application/json; charset=UTF-8"},proxy:"passport",onComplete:function(y){n=y.mediaid;var x=y.errorID;if(typeof x!=="undefined"){var w=i.get(x);if(w&&w!==x&&w.search("{tagName}")!==-1){w=i.replace(w,{tagName:j.get("title")})}else{w=i.shareSwymError}h({message:w});return}if(typeof n==="undefined"){h({message:i.shareSwymErrorUpload});return}o.createContent(n)},onFailure:function(w){h({message:i.shareSwymError})}})},false);o.addEvent("ContentCreated",function(){a({platformId:p,communityId:k,mediaId:n,model:j})},false);o.render();m(o.getContent())})})}function e(){var j=g.modals.current;if(!j){return}j.hide()}function a(k){var n=k.platformId;var l=k.communityId;var m=k.mediaId;var j=k.model;f.addWithLink({message:"",className:"success"},{message:j.get("title"),url:n+"/#community:"+l+"/media:"+m,help:i.shareSwymSuccess});e()}function h(j){f.add({message:j.message,className:"error"});e()}});define("DS/W3DDrive/Actions/editInode",["DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Actions/formFactory","DS/W3DContentApp/BusEvent","DS/W3DDrive/Actions/drivesInputs","DS/W3DDrive/Utils/StructureNavigation","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(a,c,f,d,b,e){return function(l){var u=d(l);var o=u.maxchars;var r=document.createElement("div");var v=c.createTextInput(Object.assign({pattern:u.forbiddenChars.regex,required:true,title:u.forbiddenChars.text||"",value:l.get("alias")?l.get("alias"):l.get("title"),spellcheck:false},o));var t=c.createTextError({text:u.forbiddenChars.text});var g=c.createForm([v,t],{className:"form_form-edit"});g.addEventListener("submit",m);var n={chars:u.forbiddenChars.text,maxLengthText:o?o.maxLengthText:undefined};v.addEventListener("keyup",w);v.addEventListener("keydown",p);r.appendChild(g);var j={title:e.renameElem,body:r,buttons:[{className:"primary js-validation-button",value:e.rename,action:function(){if(b.isLinkedFile(l)||b.isPart(l)){s();return}h()}},{value:e.cancel,action:function(){a.modals.current.hide();i()}}]};a.dialog(j);var q=a.modals.current.getBody().getElement('input[name="newContainerName"]');var k=q.value.lastIndexOf("."+l.get("fileExtension"));q.focus();q.setSelectionRange(0,k?k:q.value.length);function i(){g.removeEventListener("submit",m);v.removeEventListener("keyup",w);g=null;v=null;u=null;o=null;j=null;n=null;t=null}function m(z){z.preventDefault();var y=(v.value||"").trim();if(!y){return}if(!l.get("alias")&&(y===l.get("title"))||(l.get("alias")&&y===l.get("alias"))){a.modals.current.hide();return}i();var x=l.get("addtomydrive")?"inodeActions:onChangeAlias":"inodeActions:onEdit";f.dispatchEvent(x,[l,y]);a.modals.current.hide()}function w(){c.onCheckInput(o.maxLength,v,t,n,".js-validation-button")}function h(){var x;if(document.createEvent){x=document.createEvent("Event");x.initEvent("submit",true,true)}else{x=new Event("submit")}g.dispatchEvent(x)}function p(x){if(x.key!=="Enter"){return}x.preventDefault();if(b.isLinkedFile(l)||b.isPart(l)){s();return}h()}function s(){var x=document.createElement("div");var y=document.createElement("span");y.innerHTML=e.confirmRenameLinkedFiles;x.appendChild(y);a.dialog({title:e.replace(e.renameContent,{name:l.get("title")}),body:x,buttons:[{className:"primary js-validation-button",value:e.rename,action:function(){h()}},{value:e.cancel,action:function(){a.modals.current.hide();i()}}]})}}});define("DS/W3DDrive/Actions/Share/shareGeneric",["DS/W3DDrive/widget","DS/W3DDrive/Actions/Share/DSDrive/shareToPlatformService","DS/W3DDrive/Actions/Share/DSDrive/shareToSwymService","DS/W3DDrive/Actions/Share/DSDrive/shareByLinkService","DS/W3DDrive/Actions/Share/shareToGroupService","DS/W3DDrive/Actions/Share/CollabSpaces/shareContent","DS/W3DDrive/Actions/Share/CollabSpaces/shareCS","DS/W3DDrive/Actions/Share/shareFactory","DS/W3DContentApp/Views/SuperModal","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(C,M,I,G,z,h,N,t,b,n){var j="shareview__platform__container";var u="shareview__swym__container";var e="shareview__bylink__container";var L="shareview__group__container";var W="shareview__header__platform";var q="shareview__header__swym";var a="shareview__header__link";var V="shareview__header__group";var F="drive";var X="collabspace";var l="collabspaceContent";var v="platform";var g="swym";var y="link";var c="group";var r="collabspace";var k="collabspaceContent";return function(ae,Z,ag){var ab;var ad=t.makeElement({classes:["shareview"]});var ac=t.makeElement({classes:["shareview__header"]});var af=t.makeElement({classes:["shareview__header-text"]});var Y=t.makeElement({classes:"shareview__body"});var aa=t.createToggler({type:"radio",classes:"shareview__header-tabs",buttons:O({shareToPlatformView:ab,shareView:Y,shareHeaderText:af,inodes:Z,type:ae,shareOptions:ag})});ac.appendChild(aa);ac.appendChild(af);ad.appendChild(ac);ad.appendChild(Y);p({shareHeader:ac,parentView:Y,shareToPlatformView:ab,shareHeaderText:af,inodes:Z,type:ae,shareOptions:ag});return ad};function p(Y){if(!Y.shareOptions.shareTab){A(Y);return}switch(Y.shareOptions.shareTab){case v:A(Y);Q({headerClass:W,shareHeader:Y.shareHeader});break;case g:w(g,Y);Q({headerClass:q,shareHeader:Y.shareHeader});break;case y:w(y,Y);Q({headerClass:a,shareHeader:Y.shareHeader});break;case c:w(c,Y);Q({headerClass:V,shareHeader:Y.shareHeader});break;case r:w(r,Y);Q({headerClass:q,shareHeader:Y.shareHeader});break;case k:w(k,Y);Q({headerClass:q,shareHeader:Y.shareHeader});break;default:A(Y);Q({headerClass:W,shareHeader:Y.shareHeader})}}function P(Y){if(!b.modals.current){return}var Z=document.createElement("h4");Z.textContent=Y;b.modals.current.setHeader(Z.outerHTML)}function Q(aa){var Z=aa.shareHeader;if(!Z){return}var Y=Z.querySelector(".tab-item.active");if(Y){Y.classList.remove("active")}var ab=Z.getElementsByClassName(aa.headerClass);if(ab.length===0){return}var ac=ab[0];ac.classList.add("active")}function A(Y){if(Y.type){switch(Y.type){case F:return w(v,Y);case X:return w(r,Y);case l:return w(k,Y)}}}function w(ad,al){var ai=al.parentView;var Z=al.inodes;var ag=al.type;var aa=al.shareOptions||{};var ak=al.shareHeaderText;var af;var ah;var ae;switch(ad){case v:var ab=Z[0].isFolder()?n.replace(n.shareFolder,{name:Z[0].get("title")}):n.replace(n.shareFile,{name:Z[0].get("title")});P(ab);af=j;ah=M;ae=H;break;case g:var ab=Z[0].isFolder()?n.replace(n.shareFolder,{name:Z[0].get("title")}):n.replace(n.shareFile,{name:Z[0].get("title")});P(ab);af=u;ah=I;ae=E;break;case y:var ab=Z[0].isFolder()?n.replace(n.shareFolder,{name:Z[0].get("title")}):n.replace(n.shareFile,{name:Z[0].get("title")});P(ab);af=e;ah=G;ae=K;break;case c:if(al.inodes[0].get("parentId")==="myCollabSpaces"){P(n.replace(n.addGroupTo,{title:Z[0].get("title")}))}else{var ab=Z[0].isFolder()?n.replace(n.shareFolder,{name:Z[0].get("title")}):n.replace(n.shareFile,{name:Z[0].get("title")});P(ab)}af=L;ah=z;ae=i;break;case r:P(n.replace(n.addMemberTo,{title:Z[0].get("title")}));af=j;ah=N;ae=f;break;case k:P(n.replace(n.shareBtnSwym,{title:Z[0].get("title")}));af=u;ah=h;ae=E;break;default:break}var ac=ai.getElementsByClassName(af);var Y=ac.length>0?ac[0]:null;aa.viewClass=af;aa.is3DSpace=(C.getValue("is3DSpaceWidget")==="true");if(!Y){var aj=t.makeElement({classes:af});aa.viewClass=af;ah(Z,aa).then(function(am){aj.appendChild(am);ai.appendChild(aj);Y=aj;if(ae){ae({inodes:Z,header:ak,type:ag,view:Y})}})}else{ae({inodes:Z,header:ak,type:ag,view:Y})}return Y}function H(Y){t.hideModalFooter();Y.view.style.display="block";if(U(Y.type,Y.inodes)){Y.header.innerHTML=n.shareInfoUsersExt}else{Y.header.innerHTML=(C.getValue("is3DSpaceWidget")==="true")?n.shareInfoUsersCB:n.shareInfoUsers}}function f(Y){H(Y)}function x(Y){}function E(Y){t.hideModalFooter();Y.view.style.display="block";Y.header.innerHTML=n.shareInfoSwym}function K(Y){Y.view.style.display="block";t.hideModalFooter();Y.header.innerHTML=n.shareInfoLink}function i(Y){Y.view.style.display="block";Y.header.innerHTML=(C.getValue("is3DSpaceWidget")==="true")?n.shareInfoGroupCB:n.shareInfoGroup}function O(ai){var Y=ai.shareView;var ah=ai.shareHeaderText;var Z=ai.inodes;var ae=ai.type;var aa=ai.shareOptions;var af=[];if(B(ae,Z)){var ac=t.createTabItem({value:n.shareBtnUsers,icon:"fonticon-users-add",classes:W,active:true});ac.addEventListener("click",function(){J({exclude:j,parentView:Y});w(v,{parentView:Y,shareHeaderText:ah,inodes:Z,type:ae,shareOptions:aa})});af.push(ac)}if(D(ae,Z)){var ac=t.createTabItem({value:n.addMemberBtn,icon:"fonticon-users-add",classes:W,active:true});ac.addEventListener("click",function(){J({exclude:j,parentView:Y});w(r,{parentView:Y,shareHeaderText:ah,inodes:Z,type:ae,shareOptions:aa})});af.push(ac)}if(R(ae,Z)){var ac=t.createTabItem({value:n.shareBtnSwym,icon:"fonticon-users-alt",classes:q});ac.addEventListener("click",function(){o({className:u,parentView:Y});w(k,{parentView:Y,shareHeaderText:ah,inodes:Z,type:ae})});af.push(ac)}if(d(ae,Z)){var ad=t.createTabItem({value:n.shareBtnSwym,icon:"fonticon-users-alt",classes:q});ad.addEventListener("click",function(){J({exclude:u,parentView:Y});w(g,{parentView:Y,shareHeaderText:ah,inodes:Z})});af.push(ad)}if(s(ae,Z)){var ab=t.createTabItem({value:n.shareableLink,icon:"fonticon-link",classes:a});ab.addEventListener("click",function(){J({exclude:e,parentView:Y});w(y,{parentView:Y,shareHeaderText:ah,inodes:Z,shareOptions:aa})});af.push(ab)}if(S(ae,Z)){var ag=t.createTabItem({value:(C.getValue("is3DSpaceWidget")==="true")?n.addGroupsBtn:n.shareBtnGroup,icon:"fonticon-users-group-add",classes:V});ag.addEventListener("click",function(){J({exclude:L,parentView:Y});w(c,{parentView:Y,shareHeaderText:ah,inodes:Z,shareOptions:aa})});af.push(ag)}return af}function J(aa){var ac=aa||{};var ab=aa.parentView;var Y=ac.exclude;var ad=Array.isArray(Y)?Y:[Y];var Z=[j,u,e,L];Z.filter(function(ae){return ad.indexOf(ae)===-1}).map(function(ae){o({className:ae,parentView:ab})})}function o(Z){var ab=Z.className;var ac=Z.parentView;if(!ab||!ac){return}var aa=ac.getElementsByClassName(ab);if(aa.length===0){return}var Y=aa[0];Y.style.display="none"}function T(Y){var aa=Y.viewClass;var Z=t.getModalFooterButtons({buttonClass:aa});Z.map(function(ab){ab.style.display="none"})}function m(Y){var aa=Y.viewClass;var Z=t.getModalFooterButtons({buttonClass:aa});Z.map(function(ab){ab.style.display="inline-block"})}function B(Y,Z){if(Y===F){return true}else{return false}}function D(Y,Z){if(Y===X){return true}else{return false}}function R(Y,Z){if(Y===l){return true}else{return false}}function d(Z,ab){if(Z!==F){return false}if(ab.length>1){return false}var aa=ab[0];var Y=aa.drive;return Y.isDsDrive&&!aa.isFolder()}function U(Z,aa){if(Z!==F){return false}if(!aa.length||aa.length===0){return false}var Y=aa[0].drive;return Y.get("shareWithinvitation")}function s(Y,Z){if(Y!==F){return false}if(!Z.length||Z.length===0){return false}return Z.length===1}function S(Y,Z){if(Y!==F&&Y!==X){return false}if(Z.length!==1){return false}if(Z[0].drive.id==="OnPremise"){return true}else{return typeof Z[0]._auth.platform.urlUsersGroup!=="undefined"}}});define("DS/W3DDrive/Actions/Share/share",["DS/W3DDrive/Metas/drive","DS/W3DDrive/Actions/Share/CollabSpaces/shareCS","DS/W3DDrive/Actions/Share/shareGeneric","DS/W3DDrive/Actions/Share/ExternalServices/shareExternalServices","DS/W3DContentApp/Views/SuperModal","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,a,c,e,g,h){return function(l,k){if(!l){return}d(k);i(l,k).then(function(m){f(m);j(m)})};function d(k){g.dialog({title:k.title||h.share,renderTo:document.body})}function i(l,k){return new Promise(function(p,o){var q=[].concat(l);var n=q[0].drive;var m;if(n.isDsDrive){p(c("drive",q,k))}else{if(n.get("actions")){if(q[0].get("parentId")==="myCollabSpaces"){p(c("collabspace",q,k))}else{p(c("collabspaceContent",q,k))}}else{p(e(q,k))}}})}function f(k){var m=g.modals.current;var l=m.getBody();l.className="";l.appendChild(k)}function j(k){var l=k.querySelector("input");if(!l){return}l.focus()}});define("DS/W3DDrive/inodesActions",["DS/W3DDrive/Actions/delete","DS/W3DDrive/Actions/download","DS/W3DDrive/Actions/Share/share","DS/W3DDrive/Metas/actions","DS/W3DDrive/Metas/drive","DS/W3DDrive/Metas/inode","DS/W3DContentApp/Utils/Helpers","DS/W3DDrive/Utils/contextHelpers","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/BusEvent","DS/W3DDrive/widget","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(r,n,i,j,d,k,f,o,a,q,e,g){var h={};var b=j();var c=k();var l=d();var p={};p[c.actionPubIds.share]=function(s){i(s,{title:g.shareElems,onComplete:function(u,t){m("onShare",[u,t])}})};function m(s,t){q.dispatchEvent("inodesActions:"+s,t);q.dispatchEvent("inodesActions",t)}if(e.getValue("is3DSpaceWidget")!=="true"){p[c.actionPubIds.del]=function(s){r(s,{dispatchEvent:m})}}if(e.getValue("is3DSpaceWidget")!=="true"){p[c.actionPubIds.download]=function(s){if(!s.length){a.add({message:g.replace(g.empty),className:"warning"});return}m("onDownload",[s]);s[0].collection.getDownloadUrl(s).then(function(t){var u=t.url;if(!u){a.add({message:g.replace(g.empty),className:"warning"});return}n(u,t.method)},function(){a.add({message:g.replace(g.downloadsError),className:"error"})})}}h.getActionsJSON=function(u){if(!u){return[]}u=[].concat(u).filter(function(w){return(w.drive.id!==l.ids.dropbox&&w.drive.id!==l.ids.google2)});var t=f.getActionIds(u);t=o.actionsFilters.applyCurrentContexts(t);var v=t.indexOf("giveReadAccess");if(v===-1){v=t.indexOf("giveEditAccess")}if(v!==-1){t.splice(v,0,c.actionPubIds.share)}var s=b.filter(function(w){return(t.indexOf(w.id)!==-1)});return s.map(function(w){var x=p[w.id];if(!x){return}return Object.assign({handler:function(){x(u)}},w)}).filter(function(w){return !!b})};return h});define("DS/W3DDrive/Collections/DSDrive/SharedWithMeRootInodes",["DS/W3DDrive/Collections/DSDrive/Inodes","DS/W3DDrive/Models/DSDrive/SharedWithMeRoot","DS/W3DDrive/Utils/RequestHelper"],function(c,b,d){var a;a=c.extend({url:function(){return d.getBaseUrl(this._auth.getStorage().url)+"/sharedwithme/contents?withactions=true"},});return a});define("DS/W3DDrive/Collections/3DSpace/InodesFactory",["DS/W3DDrive/Collections/3DSpace/RootInodes","DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Models/3DSpace/InodeFactory","DS/W3DDrive/Collections/3DSpace/MyCollabSpaces","DS/W3DDrive/Collections/3DSpace/MyCollabSpaceContents"],function(d,c,f,g,e){var h=c();var b={};b[h.ids.trueRoot]=d;function a(l,j){var k=j.parentInode;if(!k){return}var m=k.id;var i=b[m];if(k.get("parentId")===h.ids.trueRoot){i=g}if(!k.get("parentId")&&k.get("mimeType")===h.boType.collabSpace){i=e}if(!i){i=e}return new i(l,j)}a.prototype.model=f;return a});define("DS/W3DDrive/Actions/createCS",["DS/W3DDrive/Actions/formFactory","DS/W3DContentApp/Views/SuperModal","DS/W3DContentApp/BusEvent","DS/W3DDrive/Actions/drivesInputs","i18n!DS/W3DDrive/assets/nls/W3DDrive"],function(b,a,e,c,d){return function(n,p){var j=c(n);var g;var v;var m;var t;var w;var s=j.maxchars;var q=j.maxcharsDesc;var i;var f;var r;var h;var u;var k;var y=[];var x=n.drive.get("actions").filter(function(z){return z==="add.collabspaces.visibility"});k=d.createCollabSpace;v=b.createTextInput(Object.assign({pattern:j.forbiddenChars.regex,required:true,placeholder:d.CSName,title:j.forbiddenChars.text},s));r=b.createTextError(j.forbiddenChars.text);u=b.createTextError(d.warningDescription);m=b.createTextInput(Object.assign({placeholder:d.description,name:"description"},q));t=b.createSelectInput(Object.assign({required:true,message:d.chooseFamily,options:[{value:"DESIGNTEAM",label:d.design+" - "+d.designDetail,selected:true,disabled:false},{value:"STANDARDTEAM",label:d.standard+" - "+d.standardDetail,disabled:true}]},s));w=b.createSelectInput(Object.assign({required:true,message:d.choosePrivacy,options:[{value:"PRIVATE",label:d.isPrivate+" - "+d.privateDetail,selected:true},{value:"PROTECTED",label:d.isProtected+" - "+d.protectedDetail},{value:"PUBLIC",label:d.isPublic+" - "+d.publicDetail}]},s));w.addEvent("onChange",function(){if(this.getValue()[0]==="PUBLIC"){t.enable(1);t.enable(0);t.setValue(0)}else{t.enable(0);t.disable(1);t.setValue(0)}});y=[b.createTextLabel(d.title),v,r,b.createTextLabel(d.description),m,u];if(n.drive.get("isInnovation")){if(x.length>0){y.push(b.createTextLabel(d.visibility),w,b.createWarningLabel(d.warningVisibility))}y.push(b.createTextLabel(d.family),t)}g=b.createForm(y,{className:"form_form-create"});g.addEventListener("submit",function(D){D.preventDefault();var E=(v.value||"").trim();var z=m.value||"";var B=(x.length>0&&n.drive.get("isInnovation"))?w.getValue()[0]:"PRIVATE";var C=n.drive.get("isInnovation")?t.getValue()[0]:"DESIGNTEAM";var A;if(!E){return}A={title:E,description:z,visibility:B,family:C};e.dispatchEvent("inodeActions:onCreateCS",[n,p,A]);g.parentNode.removeChild(g);g=null;a.modals.current.hide()});f={chars:j.forbiddenChars.text,maxLengthText:s?s.maxLengthText:undefined};h={chars:q?q.maxLength:undefined,maxLengthText:d.warningDescription};v.addEventListener("keyup",function(){b.onCheckInput(s.maxLength,v,r,f,".js-validation-button")});m.addEventListener("keyup",function(){b.onCheckInput(q.maxLength,m,u,h,".js-validation-button")});v.addEventListener("keydown",l);m.addEventListener("keydown",l);i={title:k,body:g,buttons:[{className:"primary js-validation-button",value:d.create,action:function(){o()}},{value:d.cancel,action:function(){g.parentNode.removeChild(g);g=null;a.modals.current.hide()}}]};a.dialog(i);a.modals.current.getBody().getElement("input[autofocus]").focus();b.disableValidationButton(".js-validation-button");function o(){var z;if(document.createEvent){z=document.createEvent("Event");z.initEvent("submit",true,true)}else{z=new Event("submit")}g.dispatchEvent(z)}function l(z){if(z.key!=="Enter"){return}z.preventDefault();o()}}});define("DS/W3DDrive/Collections/DSDrive/TrashInodes",["DS/W3DDrive/Collections/DSDrive/Inodes","DS/W3DDrive/Models/DSDrive/TrashInode"],function(c,b){var a=c.extend({model:b,url:function(){return this._auth.getStorage().url+"/resources/3ddrive/v1/trash"},parse:function(d){return d.items}});return a});define("DS/W3DDrive/Models/DrivesHub/Permission",["DS/W3DDrive/Models/Permission"],function(a){return a.extend({idAttribute:"id",sync:function(d,c,b){},save:function(c,b){},destroy:function(b){},parse:function(b){}})});define("DS/W3DDrive/InodeActions",["UWA/Core","UWA/Class","UWA/Class/Events","DS/W3DDrive/Utils/Metrics","DS/UIKIT/Input/Toggle","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Metas/actions","DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/errors","DS/W3DDrive/Actions/createInode","DS/W3DDrive/Actions/editInode","DS/W3DDrive/Actions/delete","DS/W3DDrive/Actions/download","DS/W3DDrive/Actions/moveAndCopy","DS/W3DDrive/Actions/Share/share","DS/W3DDrive/Actions/addToMyDriveActions","DS/W3DDrive/Utils/IntegrationHelper","DS/W3DDrive/Utils/contextHelpers","DS/W3DDrive/Utils/StructureNavigation","DS/W3DDrive/widget","DS/W3DContentApp/BusEvent","DS/W3DDrive/Metas/drive","DS/W3DDrive/Actions/createCS","DS/W3DDrive/Actions/editCS","DS/W3DDrive/Actions/editContent","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css"],function(a,A,q,i,s,c,y,n,o,l,D,g,F,r,j,k,C,u,t,w,v,B,f,m,E,b,h){var d=n(),e=o(),p=f(),z=l().xmlhttprequestCodes,x=A.extend(q,{init:function(W){var ac;W=W||{};var I=W.model;var ao=W.context;if(!I){return}if(W.model.get("parentId")==="sharedwithme"&&W.model.get("addtomydrive")){var L=W.model.get("actions").filter(function(aq){return aq!=="changeAlias"&&aq!=="removeFromMyDrive"});W.model.set("actions",L)}function Y(){return ac}function N(aq){return i.incActionTracker({actionName:aq,model:I,context:ao})}function U(aq){return i.triggerEventTracker(Object.assign(aq,{model:I,context:ao}))}function O(ar,aq){B.dispatchEvent("inodeActions:"+ar,aq)}function S(){N("edit").inc();U({eventAction:"edit"});g(I)}function al(){N("delete").inc();F(I,{dispatchEvent:O})}function aa(aq){D(I,aq)}function M(){N("new").inc();U({eventAction:"create"});return aa(e.mimeType.folder)}function P(){aa(e.mimeType.label)}function Z(){N("download").inc();if(u.SWIntegration&&u.SWIntegration.downloadFile){u.SWIntegration.downloadFile(JSON.stringify({fileId:I.id}));return}var at=I.get("title");if(w.hasRelations(I)&&I.drive.isDsDrive&&v.getValue("isStandalone")!==true){return ar()}aq();function aq(au){U({eventAction:"download",dimensions:{pd5:(au&&au.data.expand)?"true":"false"}});if(I.drive&&I.drive.get("id")===p.ids.google2&&I.get("size")>=11000000){var av={message:" Google Drive link",url:I.get("fileUrl")};c.addWithLink({message:h.replace(h.downloadExceedSize,{name:I.get("title")}),className:"error"},av);return}I.getDownloadUrl(au).then(function(aw){var ax=aw.url;if(!ax){c.add({message:h.replace(h.emptyDownload,{name:at}),className:"warning"});return}r(ax,aw.method,I)},function(aw){if(aw&&aw.hasOwnProperty("status")&&aw.status===z.CONFLICT){c.add({message:h.replace(h.duplicationError,{msg:aw.data.error.message,fileName:aw.data.error.filename}),className:"error"})}else{if(aw&&aw.status===z.NOT_FOUND&&aw.options&&aw.options.xhr&&/reached max quota/i.test(aw.options.xhr.responseText)){c.add({message:h.guestNoRemainingAccess,className:"error"})}else{c.add({message:h.replace(h.downloadError,{name:at}),className:"error"})}}})}function ar(){var av={name:"downloadType",className:"primary"};var aw=new s(Object.assign({},av,{value:"all",label:h.downloadLinkedFiles})).check();var ax=new s(Object.assign({},av,{value:"one",label:h.downloadFileOnly}));var au=document.createElement("div");au.appendChild(aw.elements.container);au.appendChild(ax.elements.container);return y.dialog({title:h.download+" "+at,body:au,buttons:[{className:"primary",value:h.download,action:function(ay){ay.hide();var az=aw.isChecked();if(az){aq({data:{expand:true}});return}aq()}},{value:h.cancel,action:function(ay){ay.hide()}}]})}}function aj(){N("restore").inc();U({eventAction:"restore"});var ar=function(){I.destroy({noSync:true});c.add({message:h.replace(h.restoreElemSuccess,{name:I.get("title")}),className:"success"})};var aq;aq=function(at){var au=0;if(at.status===409){if(at.code==="parentNotAvailable"){au=1}else{if(at.code==="nameNotUnique"){au=2}}}if(au===0){c.add({message:h.unexpectedError,className:"error"})}else{j(I,{dispatchEvent:O,newTitle:true,restore:true,errorCode:au,callback:ar,fallback:aq})}};I.restore().then(ar,aq)}function ap(){N("restoreVersion").inc();U({eventAction:"restoreVersion"});if(u.SWIntegration&&u.SWIntegration.downloadFile){u.SWIntegration.downloadFile(JSON.stringify({fileId:I.id}));return}if(w.hasRelations(I)){return y.dialog({title:h.restore+" "+I.get("title"),body:h.restorePointingFile,buttons:[{className:"primary",value:h.restore,action:function(aq){aq.hide();O("onRestore",[I])}},{value:h.cancel,action:function(aq){aq.hide()}}]})}O("onRestore",[I])}function ad(){if(u.SWIntegration&&u.SWCheckShared&&!u.SWCheckShared(I)){u.SWIntegration.uploadFile(JSON.stringify({folderId:I.id,envId:I.drive.id}))}else{var ar=a.createElement("input",{attributes:{type:"file",multiple:true,accept:I.extensionsAllowed?I.extensionsAllowed.join(", "):""},styles:{display:"none"},events:{change:au,click:function(av){document.body.onfocus=aq;av.stopPropagation()}}});ar.inject(document.body);ar.click()}function au(){var av=this.files[0].name;if(I.drive.isDsDrive&&this.files.length===1&&w.hasRelations(av)){at({title:av,file:this.files[0]});return}O("onUpload",[I,this.files,{viewContext:ao,linkedFiles:false}])}function aq(){setTimeout(function(){ar.remove()},100);document.body.onfocus=null}function at(aw){var av=document.createElement("div");var ay=document.createElement("div");var az=aw.title;var ax=aw.file;ay.innerHTML=h.uploadLinkedFileDescription;av.appendChild(ay);return y.dialog({title:h.upload+" "+az,body:av,buttons:[{className:"primary",value:h.uploadAttachedFiles,action:function(aB){aB.hide();var aA=a.createElement("input",{attributes:{type:"file",multiple:true},styles:{display:"none"},events:{change:function(){var aD=Array.prototype.slice.call(this.files);var aC=aD.filter(function(aE){return aE.name===ax.name});if(aC.length===0&&!w.filesAreEqual(aC[0],ax)){aD=aD.concat(ax)}O("onUpload",[I,aD,{viewContext:ao,linkedFiles:true}])},click:function(aC){document.body.onfocus=function(){setTimeout(function(){aA.remove()},100);document.body.onfocus=null};aC.stopPropagation()}}}).inject(document.body);aA.click()}},{value:h.uploadOneFile,action:function(aA){aA.hide();O("onUpload",[I,[ax],{viewContext:ao,linkedFiles:false}])}}]})}}function af(aq){N("share").inc();U({eventAction:"share"});var ar=h.replace(h.shareElem,{type:h[I.isFolder()?"folder":"file"],name:I.get("title")});k(I,Object.assign({title:ar,onComplete:function(av,at,au){O("onShare",[av[0],at,au])},dispatchEvent:O},aq))}function Q(){N("move").inc();j(I,{dispatchEvent:O})}function am(){N("copy").inc();j(I,{dispatchEvent:O,duplicate:true})}function an(){N("preview").inc();U({eventAction:"preview"});O("onPreview",I)}function T(){N("insert").inc();U({eventAction:"insert"});if(u.SWIntegration){u.SWIntegration.insertFile(JSON.stringify({fileId:I.id}))}}function ah(){N("addToMyDrive").inc();U({eventAction:"addToMyDrive"});C(I,{action:"add"})}function V(){N("removeFromMyDrive").inc();U({eventAction:"removeFromMyDrive"});C(I,{action:"remove"})}function ag(){N("changeAlias").inc();U({eventAction:"changeAlias"});g(I)}function ab(){N("create").inc();U({eventAction:"create"});return m(I,e.mimeType.collabSpace)}function ak(){N("edit").inc();U({eventAction:"edit"});return E(I,e.mimeType.collabSpace)}function J(){N("changeThumbnail").inc();U({eventAction:"changeThumbnail"});function at(){O("onChangeThumbnail",[I,this.files])}function aq(){setTimeout(function(){ar.remove()},100);document.body.onfocus=null}var ar=a.createElement("input",{attributes:{type:"file",multiple:true},styles:{display:"none"},events:{change:at,click:function(au){document.body.onfocus=aq;au.stopPropagation()}}});ar.inject(document.body);ar.click()}function R(aq){N("addmember").inc();U({eventAction:"addmember"});var ar;if(aq.shareTab==="group"){ar=h.replace(h.addGroupTo,{title:I.get("title")})}else{ar=h.replace(h.addMemberTo,{title:I.get("title")})}k(I,Object.assign({title:ar,onComplete:function(au,at){O("onShareCS",[au[0],at])}},aq))}function ai(){N("update").inc();U({eventAction:"update"});function at(){O("onUpdate",[I,this.files])}function aq(){setTimeout(function(){ar.remove()},100);document.body.onfocus=null}var ar=a.createElement("input",{attributes:{type:"file",multiple:false,accept:((v.getValue("is3DSpaceWidget")!==true)&&I.get("fileExtension"))?"."+I.get("fileExtension"):"*"},styles:{display:"none"},events:{change:at,click:function(au){document.body.onfocus=aq;au.stopPropagation()}}});ar.inject(document.body);ar.click()}function K(){var aq="w3ddrive item inode-item selected inode-item--focused";var ar=document.getElementsByClassName(aq)[0]?document.getElementsByClassName(aq)[0]:this.container;N("move").inc();U({eventAction:"move"});j(I,{dispatchEvent:O,itemView:ar})}function H(){N("editContent").inc();U({eventAction:"editContent"});return b(I)}function ae(aq){N("sharecontent").inc();U({eventAction:"shareContent"});var ar=h.replace(h.shareBtnSwym);k(I,{title:ar,onComplete:function(au,at){}})}function X(aq){return I.isActionIdoK(aq.id)}var G={};G[e.actionPubIds.preview]=an;G[e.actionPubIds.share]=af;G[e.actionPubIds.moveTo]=Q;G[e.actionPubIds.copy]=am;G[e.actionPubIds.edit]=S;G[e.actionPubIds.del]=al;G[e.actionPubIds.createFolder]=M;G[e.actionPubIds.createLabel]=P;G[e.actionPubIds.upload]=ad;G[e.actionPubIds.download]=Z;G[e.actionPubIds.insert]=T;G[e.actionPubIds.restoreVersion]=ap;G[e.actionPubIds.restore]=aj;G[e.actionPubIds.addToMyDrive]=ah;G[e.actionPubIds.changeAlias]=ag;G[e.actionPubIds.removeFromMyDrive]=V;G[e.actionPubIds.createCollabSpace]=ab;G[e.actionPubIds.addContent]=ad;G[e.actionPubIds.addMember]=R;G[e.actionPubIds.addMemberRestricted]=R;G[e.actionPubIds.editCS]=ak;G[e.actionPubIds.changeThumbnail]=J;G[e.actionPubIds.update]=ai;G[e.actionPubIds.moveToCS]=K;G[e.actionPubIds.editContent]=H;G[e.actionPubIds.downloadVersion]=Z;G[e.actionPubIds.shareContent]=ae;ac=d.map(function(aq){var ar=G[aq.id];if(ar){aq=Object.assign({handler:G[aq.id]},aq)}return aq});ac=ac.filter(X);ac=t.actionsFilters.applyCurrentContexts(ac);this.toJSON=Y;if(W.validate){this.validate=W.validate}if(W.events){this.addEvents(W.events)}}});return x});define("DS/W3DDrive/Views/inodeDetailAccessLinkView",["UWA/Class/View","DS/W3DXComponents/Views/Layout/ScrollView","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/W3DDrive/InodeActions","DS/W3DDrive/Metas/inode","DS/W3DContentApp/Views/InodeDetailView/permissionsView","css!DS/W3DDrive/W3DDrive.css","css!DS/UIKIT/UIKIT.css"],function(a,e,c,d,i,f,h){var j=f();return function(s){var m=s.model;var p=m.permissionsLink;var q=new a(s);var r=q.destroy;var u={onSync:function(){g(q)},onReset:function(){k(q)}};var t=new i({model:m,context:"access"});var o=t.toJSON();q.elements.scrollView=new e({className:"inode-access__scroll",useInfiniteScroll:false,usePullToRefresh:false,view:h({collection:p})});q.elements.spinner=new d({className:"inode-access__spinner"});q.elements.iconbar=new c({className:"inode-access__topbar",items:o.filter(function(v){return v.id===j.actionPubIds.share})});var n=q.elements.iconbar.menu.items[0];if(n){n.elements.icon.classList.remove("fonticon-user-add");n.elements.icon.classList.add("fonticon-pencil");var l=n.handler;n.handler=function(){l({shareTab:"link"})}}q.container.classList.add("inode-access-link");q.listenTo(p,u);if(p.isEmpty()){k(q)}return Object.assign(q,{render:function(){b({view:q})},destroy:function(){q.stopListening();r.apply(q,arguments)}})};function b(n){var m=n.view;var l=m.container;var o=m.elements;l.setContent([o.iconbar,o.spinner,o.scrollView]);o.scrollView.render();return m}function k(m){var l=m.container;var n=m.elements.spinner;l.classList.add("loading");n.show()}function g(l){setTimeout(function(){var m=l.container;var n=l.elements.spinner;m.classList.remove("loading");if(!n){return}n.hide()},80)}});define("DS/W3DDrive/Collections/DSDrive/InodesFactory",["DS/W3DDrive/Collections/DSDrive/Inodes","DS/W3DDrive/Collections/DSDrive/RootInodes","DS/W3DDrive/Collections/DSDrive/SharedWithMeRootInodes","DS/W3DDrive/Collections/DSDrive/TrashInodes","DS/W3DDrive/Metas/DSDrive/inode","DS/W3DDrive/Models/DSDrive/InodeFactory"],function(a,e,d,i,h,b){var f=h();var g={};g[f.ids.trueRoot]=e;g[f.ids.sharedWithMe]=d;g[f.ids.trash]=i;var c=function(m,k){var l=k.parentInode;if(!l){return}var j=g[l.id];if(!j){j=a}return new j(m,k)};c.prototype.model=b;return c});define("DS/W3DDrive/Models/DSDrive/DriveAbstract",["UWA/Core","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/W3DDrive/Metas/drive","DS/W3DDrive/Metas/inode","DS/W3DDrive/Models/Drive","DS/W3DDrive/Collections/DSDrive/InodesFactory","DS/W3DDrive/Collections/DSDrive/PermissionsFactory","DS/W3DDrive/widget","DS/WebappsUtils/WebappsUtils"],function(h,l,b,a,g,m,n,f,d,e){var j=a(),i=g(),k=m.prototype.defaults;var c=m.extend({_Inodes:n,_Permissions:f,url:"",isDsDrive:true,defaults:h.merge({title:"3DEXPERIENCE",thumbnailLink:e.getWebappsAssetUrl("W3DDrive","3DDrive_40x30.png"),iconLink:e.getWebappsAssetUrl("W3DDrive","3DDrive_80x60.png"),shareWithinvitation:false},k),getInodePanelURI:function(o){if(o.get("mimeType")==""||!o.get("mimeType")){o.set("mimeType",i.mimeType.folder)}return this._parent.apply(this,arguments)},isActionIdoK:function(o){if(o===j.actionPubIds.install){return true}else{if(o===j.actionPubIds.storage||o===j.actionPubIds.remove){return false}}return this._parent.apply(this,arguments)},init:function(o){o=o||{};var p=this;this._parent.apply(this,arguments);b.getPlatformConfig({key:"share",platformId:p.id,onComplete:function(q){p.set("shareWithinvitation",q)}});b.getUser({onComplete:function(q){p.set("user",{displayName:q.firstname+" "+q.lastname,emailAddress:q.email,id:q.id})}})}});return c});define("DS/W3DDrive/Collections/DrivesHub/Permissions",["DS/W3DDrive/Collections/AuthCollection","DS/W3DDrive/Models/DrivesHub/Permission"],function(a,b){var c=a.extend({model:b,url:function(){},init:function(f,d){d=d||{};var e=d.parentInode;if(!e||!e.id){throw new Error("You must specify a valid parentInode options")}this._parentInode=e;return this._parent.apply(this,arguments)},fetch:function(d){return this._parent.apply(this,arguments)},create:function(d,e){},parse:function(d){}});return c});define("DS/W3DDrive/Models/3DSpace/Drive",["DS/W3DDrive/Models/DSDrive/DriveAbstract","DS/W3DDrive/Collections/3DSpace/InodesFactory","DS/W3DDrive/Collections/3DSpace/InodesFactoryCS","DS/W3DDrive/Collections/3DSpace/CollabSpacePermissions"],function(b,c,a,d){var e=b.extend({_Inodes:c,_Contents:a,isDsDrive:false,isCollabSpace:true,_Permissions:d,isActionIdoK:function(f){return false},url:function(){var g=this.get("auth").platform.url3DSpace;if(g){var f="{0}/resources/enocsmrest/session".format(g);return f}else{console.log("3DSpace url is not returned! the url can't be defined")}},init:function(f){return this._parent(f)},fetch:function(f){return this._parent(f)},parse:function(f){return{id:f.id,name:f.id,auth:f.auth,granted:f.granted,authenticated:f.authenticated,actions:f.actions,isAdmin:f.isadmin,isInnovation:f.isinnovation,availableRoles:f.availableRoles}}});return e});define("DS/W3DDrive/Models/DSDrive/Drive",["DS/W3DDrive/Models/DSDrive/DriveAbstract","DS/W3DDrive/widget","DS/W3DDrive/Utils/RequestHelper","UWA/Class/Promise"],function(b,e,d,c){var a=b.extend({fetch:function(f){var i=this;var h=this.get("auth");var g=this._parent.bind(this);return new c(function(k,j){if(e.getValue("isStandalone")!==true&&h&&typeof h==="object"){d.performRequestWithOptions(h.platform.url+"/resources/3ddrive/v1/admin/sharebylink",{method:"GET",type:"json",auth:h,headers:{"Content-Type":"application/json"},onComplete:function(l){i.set("shareByLink",l.sharebylink==="true");return k()},onFailure:function(){j(arguments)}})}else{k()}})["finally"](function(){return g(f)})}});return a});define("DS/W3DDrive/Collections/DrivesHub/PermissionsFactory",["DS/W3DDrive/Collections/DrivesHub/Permissions","DS/W3DDrive/Collections/Stub","DS/W3DDrive/Metas/DrivesHub/inode"],function(d,c,a){var f=a();var e=d.extend(c);var b={};b[f.ids.root]=e;b[f.ids.sharedWithMe]=e;return function(i,h){var j=h.parentInode;var g;if(!j){return}g=b[j.id];if(!g){g=d}return new g(i,h)}});define("DS/W3DDrive/Models/DrivesHub/Drive",["DS/W3DDrive/Models/Drive","DS/W3DDrive/Collections/DrivesHub/InodesFactory","DS/W3DDrive/Collections/DrivesHub/PermissionsFactory","DS/W3DDrive/Utils/hubRequestHelper","DS/W3DDrive/Metas/inode","i18n!DS/W3DContentApp/assets/nls/W3DContentApp"],function(c,e,b,f,a,h){var d=a();return c.extend({_Inodes:e,_Permissions:b,defaults:{id:"driveshub",title:"DrivesHub"},isDrivesHubDrive:true,fetch:function(i){if(this.get("url")){this.getStorage();if(this._index&&this._index[d.ids.trueRoot]){return this._index[d.ids.trueRoot].inodeTable.fetch(Object.assign({remove:false},i))}return this._parent.apply(this,arguments)}return this._parent.apply(this,arguments)},getDefaultsAttributes:function(){return{authenticated:false,id:this.id,iconLink:this.get("iconLink"),thumbnailLink:this.get("iconLink"),title:this.get("title"),user:{displayName:"",emailAddress:""}}},getLegalInfo:function(){switch(this.id){case"onedrive":return h.onedriveLegalContent;default:return this._parent()}},getStorage:function(){var i=this;f.performRequest(this.url("info"),{onComplete:function(k){var j=JSON.parse(k);i.set("user",{displayName:j.user.name,emailAddress:j.user.email||i.get("user").emailAddress});i.set("quotaBytes",{total:j.storageQuota.limit,used:j.storageQuota.usage})}})},parse:function(i){return i},save:function(i,j){if(i.authenticated){j=Object.assign({},j,{url:this.url("connect")})}if(i.authenticated===false){j=Object.assign({},j,{url:this.url("disconnect")})}return this._parent(i,j)},setup:function(i){this.auth=g(i.auth,this);this.set("auth",this.auth);this._parent.apply(this,arguments)},url:function(l){var k=this.get("url")+"/drive/v1/"+this.get("id");if(!l||l.length===0){return k}var j={connect:"/connect",disconnect:"/disconnect",info:"/info"};var i=j[l];return i?k+i:k}});function g(j,i){return Object.assign({},j,{clearIdentity:function(l,k){f.performRequest(i.url("disconnect"),{onComplete:l,onFailure:k})},hasIdentity:function(l,k){return i.get("authenticated")?l():k()}})}});define("DS/W3DDrive/Models/DriveFactory",["DS/W3DDrive/Metas/drive","DS/W3DDrive/Models/Drive","DS/W3DDrive/Models/DSDrive/Drive","DS/W3DDrive/Models/Dropbox/Drive","DS/W3DDrive/Models/GoogleDrive/Drive","DS/W3DDrive/Models/3DSpace/Drive","DS/W3DDrive/Models/DrivesHub/Drive","DS/W3DDrive/widget"],function(a,h,b,f,k,j,c,d){var e=a(),i={};if(!d.getValue("is3DSpaceWidget")){i[e.ids.dropbox]=f;i[e.ids.google2]=k;i[e.ids.onedrive]=c}function g(n,m){var l=i[n.id];if(!l){if(n.isDrivesHubProvider===true){l=c}else{if(d.getValue("is3DSpaceWidget")){l=j}else{l=b}}}return new l(n,m)}g.prototype.idAttribute=h.prototype.idAttribute;return g});define("DS/W3DDrive/Collections/drives",["UWA/Class/Collection","UWA/Class/Promise","DS/W3DDrive/Utils/drive","DS/W3DDrive/Utils/DSAuth","DS/W3DDrive/Metas/drive","DS/W3DDrive/Models/Drive","DS/W3DDrive/Models/DriveFactory","DS/W3DDrive/Utils/Platform","DS/W3DDrive/Utils/RequestHelper","DS/W3DDrive/widget","DS/W3DDrive/Utils/IntegrationHelper","DS/W3DDrive/Utils/drivesHubConnect"],function(d,i,c,b,a,j,g,o,e,f,l,n){var h=a(),k=c(),m=new d();return Object.assign(m,{model:g,comparator:"title",sync:function(v,u,q){if(v!=="read"){return}var r=[];var t=[];var s=q.onComplete;q=Object.assign({},q);delete q.onComplete;if(e.hasTenant()){t.push({id:e.getTenant(),auth:new b(e.getTenant(),{id:e.getTenant()})})}var p="";o.getAllPlatforms().then(function(w){w.map(function(x){if(f.getValue("is3DSpaceWidget")){if(x.url3DSpace!==undefined){t.push({id:x.id,auth:new b(x.id,x)})}}else{t.push({id:x.id,auth:new b(x.id,x)});if(x.urlDrivesHub){p=p?p:x.urlDrivesHub}}});if(!f.getValue("is3DSpaceWidget")&&!f.getValue("isStandalone")){if(!l.CATIAV5&&!l.SW){t.push({id:h.ids.dropbox,auth:k.auths[h.ids.dropbox]});t.push({id:h.ids.google2,auth:k.auths[h.ids.google2]})}else{p=""}}else{p=""}return n.tryFetch(p).then(function(x){return t.concat(x)}).then(function(x){x.map(function(y){r.push(new i(function(A,z){j.prototype.sync("read",y,Object.assign(q,{onComplete:A,onFailure:z}))}))});return i.all(r).then(function(y){s(y,q)})})})}})});define("DS/W3DDrive/w3DDriveView",["UWA/Core","UWA/Class/View","UWA/Utils","DS/W3DContentApp/Views/panelSlider","DS/W3DDrive/Collections/drives","DS/W3DContentApp/Views/DrivesPanelView/drivesPanelView","DS/W3DContentApp/Views/InodePanelView/inodePanelView","DS/W3DContentApp/Views/InodePreView/lightbox","DS/W3DContentApp/Views/UploadInodesView/taskViewSet","DS/W3DContentApp/Views/UploadInodesView/uploadInodeTasksView","DS/W3DDrive/Utils/ViewsRestrictions","DS/W3DXComponents/Views/EmptyView","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/W3DDrive/W3DDrive.css"],function(b,u,c,d,m,o,w,e,v,t,l,q,h){var i=null;var a="w3ddrive-view";var s="first-panel";l.setPossibleRestrictions(a,[s]);if(l.getRestriction(a,s)!==true){i=o({collection:m})}var x=d({panels:[i]});var p=new u({container:x.container});var k=p.render;var j=p.destroy;var r=t({children:v});var f;var n;var g=e.init();return Object.assign(p,{getFirstPanel:function(){if(l.getRestriction(a,s)!==true){return i}else{return null}},getSecondPanel:function(){return f},getLightbox:function(){return e},render:function(){x.render();if(l.getRestriction(a,s)!==true){i.render()}r.render();r.inject(x.container);return k.apply(p,arguments)},showEmptyView:function(){if(!n){n=new q({icon:"picture",title:h.noContent})}n.render().inject(p.container)},hideEmptyView:function(){if(n){n.destroy()}},showSecondPanel:function(z){var y;if(f){if(f.model===z){x.slideTo(1);return p}y=f;f.container.remove();y.destroy();y=null;f=null}if(!z){f=null;return p}f=w({model:z});x.refreshPanel(1,f.container).slideTo(1);f.render();return p},showFirstPanel:function(){if(l.getRestriction(a,s)!==true){x.slideTo(0)}return p},showLightbox:function(y){if(!g.parentElement&&x.container.parentElement){x.container.parentElement.appendChild(g)}g.toggleVisibility(true);g.animationFrameId=window.requestAnimationFrame(function(){g.refresh(y)})},hideLightbox:function(){if(g.animationFrameId){window.cancelAnimationFrame(g.animationFrameId);g.animationFrameId=null}g.toggleVisibility(false);g.hideLightbox()},updateLightbox:function(z,y){g.updatePreviewBody(z,y)},destroy:function(){x.destroy();r.destroy();g.destroy();return j.apply(p,arguments)}})});define("DS/W3DDrive/w3DDriveApp",["UWA/Core","UWA/Class/Promise","UWA/Utils","DS/Usage/TrackerAPI","DS/W3DDrive/Utils/Metrics","DS/W3DDrive/Collections/drives","DS/W3DDrive/Models/Inode","DS/W3DDrive/Models/uploadManager","DS/W3DDrive/Utils/Router","DS/W3DContentApp/Views/UploadInodesView/uploadInodeTaskView","DS/W3DContentApp/Utils/Alert","DS/W3DContentApp/BusEvent","DS/i3DXCompassServices/i3DXCompassPubSub","DS/W3DDrive/W3DDriveTagger6WProxy","DS/W3DDrive/w3DDriveTitleProxy","DS/W3DDrive/w3DDriveView","DS/W3DDrive/Metas/drive","DS/W3DDrive/Metas/inode","DS/W3DDrive/Metas/3DSpace/inode","DS/W3DDrive/Utils/Platform","DS/W3DDrive/Utils/drive","DS/W3DDrive/Utils/DSAuth","DS/W3DDrive/widget","DS/W3DDrive/Utils/errors","DS/W3DDrive/Utils/IntegrationHelper","DS/W3DDrive/Utils/CompassHelpers","DS/W3DDrive/Utils/Rerouter","DS/W3DDrive/Utils/ViewsRestrictions","DS/W3DDrive/Metas/errors","DS/PlatformAPI/PlatformAPI","DS/W3DDrive/Utils/RequestHelper","DS/W3DDrive/Utils/AutoRefresh","DS/W3DContentApp/Views/SuperModal","DS/W3DDrive/Utils/BrowserDetection","DS/UIKIT/Scroller","i18n!DS/W3DDrive/assets/nls/W3DDrive","css!DS/UIKIT/UIKIT.css"],function(t,R,Z,ae,V,T,P,L,s,i,aj,u,y,al,ak,C,c,ad,U,D,X,I,O,w,o,b,J,f,aa,x,K,M,W,F,af,m){var h="fetchInodeTable";var B="setTags";var a;var ah;var n=c();var U=U();var ao=X();var q;var p;var E=aa().xmlhttprequestCodes;var g=aa().w3ddrive;var l=ad();var ac=true;var k;var H="inode-detail-view";var d="inode-detail-properties";var v="inode-detail-access";var A="inode-detail-comments";var ag="w3ddrive-view";var e="first-panel";var an="panel-slider-view-id";var ab="controller";var ai=false;V.trackNavigation({eventAction:"load"});if(O.getValue("isStandalone")===true){ai=true;f.setRestrictions(H,[v,A]);f.setRestrictions(ag,[e]);f.setRestrictions(an,[ab]);ac=false}function j(){return new R(function(aq,ap){T.fetch({onComplete:function(ar){var at={};ar.map(function(au){at[au.id]=au.auth});aq(at)},onFailure:ap,reset:T.isEmpty(),merge:false})})}function Y(aq,ap){var ar=[];return new R(function(aC,aE){var aw=aq[":driveId"],az=aq[":parentInodeId"],at=aq[":inodeId"],av=aq[":mimetype"],aD,aB,au,ay,ax,aA;if(az==="sharedWithMe"){az=az.toLowerCase()}if(aw===undefined){return aE()}aD=T.get(aw);if(!aD){if(!ap[aw]){if(ai!==true){aj.add({message:m.replace(m.driveAccessError,{driveId:aw}),className:"warning"})}aw=Object.keys(ap)[0];ax=true}aD=T.get(aw)}ah.setBaseURI(aD.getInodePanelContentURI(aD.getRootInodes().first()));ar[0]=aD;ar[1]=av;if(aD){if(!ai&&ax){az=aD.getRootInodes().first().id}ay={};ay.mimeType=av;ay[aD.inodeIdAttr]=az;aB=aD.getInode(ay);ar[2]=aB}if(aB){au=aB.inodeTable.get(at);if(!au){ay={};ay[aD.inodeIdAttr]=at;ay.parentId=az;au=aD.getInode(ay);aB.inodeTable.add(au)}aB.doesExistInBackend().then(function(aG){if(aG===true){if(au){if(au.get("maturity")){ar[3]=au;aC({drive:aD,mappedArgs:ar})}else{au.doesExistInBackend().then(function(aH){if(aH===true){ar[3]=au}aC({drive:aD,mappedArgs:ar})})}}else{aC({drive:aD,mappedArgs:ar})}}else{var aF=function(){var aJ=document.getElementsByClassName("alert-warning");var aI=false;for(var aH=0;aJ.length;aH++){if(aJ[aH].innerText===m.inodeAccessError){aI=true;break}}return aI};if(!aF()){aj.add({message:m.inodeAccessError,className:"warning"})}aE(ar)}})}else{au=aD.getInode({id:at});au.doesExistInBackend().then(function(aF){if(aF===true){au.fetch({onComplete:function(){aB=aD.getInode({id:au.get("parentId"),mimeType:av});aB.inodeTable.add(au);ar[2]=aB;ar[3]=au;aC({drive:aD,mappedArgs:ar})},onFailure:aE})}else{aj.add({message:m.inodeAccessError,className:"warning"});aE(ar)}})}})}function S(ap){return new R(function(ar,aq){if(ap.get("authenticated")){if(O.getValue("is3DSpaceWidget")){ap.fetch({onComplete:function(){ar()}});return}}ap.fetch({onComplete:function(){if(ap.get("authenticated")){return ar()}aj.add({message:m.replace(m.authenticationExpired,{service:ap.get("title")}),className:"error"});aq()}})})}function z(aq,ap){L.askForUpload(aq,ap,{onComplete:function(ar){if(O.getValue("is3DSpaceWidget")){aj.add({message:m.replace(m.uploadSuccess,{title:ar.get("title")}),className:"success"})}else{if(ar.get("createdDate")!==ar.get("modifiedDate")){aj.add({message:m.replace(m.updateSuccess,{title:ar.get("title")}),className:"success"})}}},onFailure:function(au,ar){var at=((typeof au.get==="function")?au.get("title"):au.title);var av=m.replace(m.uploadError,{name:at||""});if(au&&au.destroy){au.destroy()}if(ar instanceof w.UploadError){av+=m.replace(m.moreDetails,{details:ar.message})}aj.add({message:av,className:"error"})}})}function N(au,ap){var at=au.get("title"),ar=au.collection,aq=new R(function(aw,av){au.destroy(Object.assign({wait:true,onComplete:function(ax,aA){if(aA&&aA.status==="failure"&&aA.report){var az=" ";for(var ay=0;ay<aA.report.length;ay++){az+=aA.report[ay].error+" "}ar.add(au);return av({msg:m.replace(m.errorDelete,{title:at,errorMessage:az})})}aw((aA)?aA.expandedIds:null)},onFailure:av,onTimeout:function(ax){av({reason:ax.message})}},ap))});aq.then(function(av){aj.add({message:m.replace(m.deleteSuccess,{name:at}),className:"success"});if(av){return{expandedIds:av,collection:ar}}},function(aw){if(aw&&aw.reason){var av=m.replace(m.deleteError.concat(" due to timeout:  "+aw.reason),{name:at});aj.add({message:av,className:"error"})}else{if(au.isCollabSpace()){aj.addAndOpenModal({message:m.replace(m.deleteError,{name:at}),className:"error",inode:au})}else{aj.add({message:(aw&&aw.msg)?aw.msg:m.replace(m.deleteError,{name:at}),className:"error"})}}}).then(Q)}function r(ap){return new R(function(aq){return ap.getRootInodes(true).then(function(ar){aq(ar.first())})}).then(function(aq){ah.navigate(ap.getInodePanelContentURI(aq),{trigger:true})})}function am(){var ap=C.getSecondPanel();if(!ap){return}var at=ap.model;if(!at){return}var au=at.inodeTable;var ar=at.permissions;if(typeof au.getFirstPage==="function"){au.getFirstPage({reset:true,withThumbnails:true,onFailure:aq})}else{au.fetch({reset:true,withThumbnails:true,onFailure:aq,})}ar.fetch({reset:true,inode:at.id,from:"refresh"});function aq(){r(at.drive);at.collection.remove(at)}}function G(ap,ar){var aq=ap.get("emailAddress")===ap.collection._parentInode.drive.get("user").emailAddress;var at=new R(function(av,au){ap.destroy(Object.assign({wait:true,onComplete:av,onFailure:au},ar))});return at.then(function(){if(aq){am()}aj.add({message:ar.messageSuccess,className:"success"})},function(){aj.add({message:ar.messageFailure,className:"error"})})}function Q(ap){if(!ap||!ap.expandedIds||!ap.collection){return R.resolve()}var ar=ap.collection;var aq=ap.expandedIds;return R.resolve(ar.remove(aq))}a=s.extend({routes:{error:"onError","error/:errorType/:errorCode/:errorMsg":"onError",":parentInodeId/init":"onReroute","drives/:driveId/mimetype/:mimetype/inode/:parentInodeId/content":"onInodeContent","drives/:driveId/mimetype/:mimetype/inode/:parentInodeId/content/:inodeId/preview":"onInodePreview","drives/:driveId/mimetype/:mimetype/inode/:inodeId/preview":"onInodePreview"},execute:function(at,ap){var aq;var ar=false;j().then(function(au){return Y(ap,au)}).then(function(au){aq=au.mappedArgs;return S(au.drive)},function(au){if(ai===true&&!ap.hasOwnProperty(":driveId")){aq=Object.keys(ap).map(function(av){return ap[av]});return}if(ap.hasOwnProperty(":errorType")){if(ap.hasOwnProperty(":errorCode")){if(ap.hasOwnProperty(":errorMsg")){at.apply(ah,[ap[":errorType"],ap[":errorCode"],ap[":errorMsg"]])}else{at.apply(ah,[ap[":errorType"],ap[":errorCode"]])}}else{at.apply(ah,[ap[":errorType"]])}at=null}else{if(ai===true){ah.navigate("error",{trigger:true})}else{if(au[0]){r(au[0])}else{ah.navigate("",{trigger:true,loadBaseUri:true})}}}ar=true}).then(function(){if(!ar&&at){at.apply(ah,aq)}},function(){ah.navigate("error",{trigger:true})});J.setRouter(ah)},onError:function(aq,ar,ap){aj.options.autoHide=false;if(aq===g.noToken){aj.add({message:m.standaloneNoToken,className:"error"})}else{if(!aq||aq!=g.ressourceAccess||ar!=E.NOT_FOUND){aj.add({message:m.unexpectedError,className:"error"})}else{aj.add({message:m.standaloneLinkError,className:"error"})}}Z.setImmediate(function(){C.showEmptyView()})},onReroute:function(){J.rerouteFromSharedToken(O.getValue("SCDataMgtBaseUrl"),O.getValue("token"))},onDrives:function(){C.showFirstPanel();C.getFirstPanel().selectedChildren.reset();C.showSecondPanel();ak.setTitle();T.fetch({reset:T.isEmpty(),merge:false});if(ac){Z.setImmediate(function(){al.unSetInodeTable()})}},onInodePreview:function(ap,at,ar,aq){if(!aq){aj.add({message:m.inodeAccessError,className:"warning"});if(ap){r(ap)}else{ah.navigate("",{trigger:true,loadBaseUri:true})}return}C.showLightbox({inode:aq});if(ai===true){aq.fetch()}Z.setImmediate(function(){var au=ah.onInodeContent(ap,at,ar);if(au){au[B].then(function(){if(ac){al.focusOnSubjectsWithInode(aq)}},function(){})}})},onInodeContent:function(ay,ap,aq){var ax={};var aw=R.deferred();var ar=R.deferred();ax[h]=aw.promise;ax[B]=ar.promise;if(q===aq){Z.setImmediate(function(){ah.onInodePanel(ay,ap,aq)});if(ac){Z.setImmediate(function(){ar.resolve()});return ax}return}q=aq;var av=aq.inodeTable;var at=O.getValue("inodesSorting");if(!av){return}var au=C.showSecondPanel(aq).getSecondPanel();var aA;if(au){aA=au.elements.contentView.view}av.sort({sorting:at});if(ac){Z.setImmediate(function(){al.setTaggerProxy(ay);if(aA){al.setInodeTable(aA)}})}if(ai!==true||aq.id!=="sharedwithme"){var az=new R(function(aC,aB){av.fetch({reset:av.isEmpty(),remove:false,merge:true,withThumbnails:true,onComplete:aC,onFailure:aB})});az.then(function(){av.sort({sorting:at});aw.resolve();if(ac){Z.setImmediate(function(){ar.resolve()})}},function(){aw.reject();ar.reject()})}Z.setImmediate(function(){ah.onInodePanel(ay,ap,aq)});return ax},onInodePanel:function(ap,ar,aq){C.showSecondPanel(aq);ak.setTitle(aq.get("title"));if(f.getRestriction(ag,e)!==true){Z.setImmediate(function(){var at=C.getFirstPanel().findChildViewByModel(ap);C.getFirstPanel().selectedChildren.add(at);ap.getInodesPath(aq.id).then(function(av){var au=at.expandInodesPath(av);au[au.length-1].select(true)})})}}});ah=new a();ah.listenTo(u,{"grantDriveView:onClick":function(ap){var aq=new R(function(at,ar){ap.save({granted:true,authenticated:true},{wait:true,onComplete:at,onFailure:ar})});aq.then(function(){aj.add({message:m.replace(m.authenticationSuccess,{service:ap.get("title")}),className:"success"})},function(){aj.add({message:m.replace(m.authenticationError,{service:ap.get("title")}),className:"error"})});aq.then(function(){r(ap)})},"driveActions:onInstallApp":function(){y.publish("installApp",{appId:"X3DDRVN_AP",widgetId:O.id,silent:true})},"driveActions:onLaunchApp":function(){y.publish("launchApp",{appId:"X3DDRVN_AP",widgetId:O.id,silent:true})},"driveActions:onStorage":function(ap){S(ap)},"driveActions:onRemove":function(ap){var aq=C.getFirstPanel().selectedChildren,ar=new R(function(au,at){ap.save({authenticated:false},{wait:false,onComplete:au,onFailure:at})});ar.then(function(){aj.add({message:m.replace(m.disconnectSuccess,{service:ap.get("title")}),className:"success"})},function(){aj.add({message:m.replace(m.disconnectError,{service:ap.get("title")}),className:"error"})});if(!aq.length){ar.then(function(){ah.navigate("",{trigger:true,loadBaseUri:true})})}},"inodeActions:onUpload":function(at,ar,ap){for(var aq=0;aq<ar.length;aq++){V.incActionTracker({actionName:"upload",model:at,context:ap.viewContext}).inc()}z(at,ar)},"inodeActions:onCreateContainer":function(at,ar,ap){var aq=new R(function(av,au){at.inodeTable.create({parentId:at.id,title:ap,mimeType:ar},{wait:true,onComplete:av,onFailure:function(aw,ax){au(ax)}})});aq.then(function(){aj.add({message:m.replace(m.createSuccess,{name:ap}),className:"success"})},function(av){var au;if(av.error&&av.error.message&&av.error.message.indexOf("unique")!==-1){au=m.replace(m.createErrorFolderNameConflict,{name:ap})}else{au=m.replace(m.createError,{name:ap})}aj.add({message:au,className:"error"})})},"inodeActions:onShare":function(av,au,at){var ap=av.get("title");if(at&&at.isGroup===true){R.all(au.map(function(aw){return new R(function(ay,ax){var az=av.userGroups.find(aw.uri);if(az){az.save({role:aw.accessright},Object.assign({wait:true,onComplete:ay,onFailure:ax},at))}else{av.userGroups.create(aw,{method:"create",onComplete:ay,onFailure:ax})}})})).then(ar,aq)}else{av.collection.shareChildren([av],au,at).then(ar,aq)}function ar(){aj.add({message:m.replace(m.shareElemSuccess,{name:ap}),className:"success"})}function aq(aw){if(!Array.isArray(aw)){aw=[aw]}var ay=aw.some(function(az){return az.reason==="timeout"});if(au.length===aw.length&&!ay){aj.add({message:m.replace(m.shareError,{name:ap}),className:"error"});return}var ax=aw.filter(function(az){return typeof az.permission.get==="function"}).map(function(az){return az.permission.get("displayName")});aj.add({message:m.replace(m.shareErrorMembers,{name:ap,members:ax.join(", ")}),className:"error"});if(ay){aj.add({message:m.replace(m.shareTimeout,{name:ap}),className:"warning"})}}},"inodeActions:onShareAccessLink":function(ap,aq){ap.permissionsLink.add(aq)},"inodesActions:onShare":function(at,ar){var au=at[0].collection;au.shareChildren(at,ar).then(aq,ap);function aq(av){aj.add({message:m.replace(m.sharesSuccess),className:"success"})}function ap(av){av.map(function(aw){aj.add({message:m.replace(m.shareError,{name:aw.inode.get("title")}),className:"error"})})}},"inodeActions:onEdit":function(au,ar,aq){var ap=au.get("title"),at=new R(function(aw,av){au.save({title:ar},Object.assign({onComplete:aw,onFailure:function(ax,ay){av(ay.error)}},aq))});at.then(function(){var av=C.getSecondPanel();if(au.get("mimeType")===l.mimeType.folder&&av.model.id===au.id){ak.setTitle(au.get("title"))}aj.add({message:m.replace(m.editSuccess,{name:ap,newName:au.get("title")}),className:"success"})},function(av){var aw;au.set({title:ap});aw=m.replace(m.editError,{name:ap});if(av&&av.message&&(typeof av.message==="string")){aw+=": "+av.message}aj.add({message:aw,className:"error"})})},"inodeActions:onCopy":function(au,aq,ap){var at,ar=au.get("title");at=new R(function(aw,av){aq.inodeTable.create({duplicatedfrom:au.id,mimeType:au.get("mimeType")},Object.assign({wait:true,onComplete:aw,onFailure:av},ap))});at.then(function(){ah.navigate(aq.drive.getInodePanelContentURI(aq),{trigger:true});C.hideLightbox();aj.add({message:m.replace(m.copySuccess,{name:ar,toName:aq.get("title")}),className:"success"})},function(){aj.add({message:m.replace(m.copyError,{name:ar,toName:aq.get("title")}),className:"error"})});V.triggerEventTracker({eventAction:"copy",model:au,dimensions:{pd5:(ap.queryStrings&&ap.queryStrings.expand==="true")?"true":"false"}})},"inodeActions:onMove":function(aw,at,ap,aq){var av=aw.get("title");var ar;var au=new R(function(ay,ax){ar=aw.save({parentid:at.id},Object.assign({patch:true,wait:true,onComplete:function(aA,az){ay(az)},onFailure:function(az,aA){ax(aA)}},ap))});au.then(function(ax){if(aq){aq.destroy()}aj.add({message:m.replace(m.moveSuccess,{name:av,toName:(at.get("title")||at.id)}),className:"success"});if(ax){return{collection:aw.collection,expandedIds:ax.expandedIds}}},function(az){var ay=m.replace(m.moveError,{name:av,toName:at.get("title")});if(ar&&ar.xhr.status===409){const ax=az?az.error:undefined;if(ax&&typeof ax.message==="string"&&/parent is not authorized/i.test(ax.message)){ay=m.replace(m.moveErrorSelf,{name:av,toName:at.get("title")})}else{ay=m.replace(m.moveErrorNameConflict,{name:av})}}aj.add({message:ay,className:"error"})}).then(Q);V.triggerEventTracker({eventAction:"move",model:aw,dimensions:{pd5:(ap.queryStrings&&ap.queryStrings.expand==="true")?"true":"false"}})},"inodeActions:onPreview":function(aq){var ap=aq.drive;ah.navigate(ap.getInodePreviewURI(aq),{trigger:true});k=O.getView().type;O.dispatchEvent("onViewRequest",{type:"fullscreen"})},"inodeActions:onDelete":function(ar,ap){var aq=ar.drive;if(ar.isContainer()){ah.navigate(aq.getInodePanelContentURI(ar.inodeTable.dotDot()),{trigger:true})}N(ar,ap);V.triggerEventTracker({eventAction:"delete",model:ar,dimensions:{pd5:(ap&&ap.queryStrings&&ap.queryStrings.expand==="true")?"true":"false"}})},"inodesActions:onDelete":function(ap){var aq=ap[0].collection;aq.destroyChildren(ap,{wait:false}).then(function(){aj.add({message:m.deletesSuccess,className:"success"})},function(at){var ar;if(at.length>1){ar=m.replace(m.deletesError,{size:at.length})}else{ar=m.replace(m.deleteError,{name:at[0].get("title")})}aj.add({message:ar,className:"error"})})},"inodeScrollTableView:onDrop":function(at,ar){var ap=ae.getCounter("3DDrive-create-file-dnd",{label:"Create file DnD",appID:"X3DDRIV_AP",tenant:at._auth.platformId});for(var aq=0;aq<ar.length;aq++){ap.inc()}z(at.dot(),ar)},onRefresh:function(){am()},"permission:onRemoveCollabSpaceMember":function(ap,at){var au=Object.assign({},at);var ar=ap.collection._parentInode.get("title");var aq=ap.get("label")?ap.get("label"):ap.get("displayName");if(ap.collection&&ap.collection._parentInode&&ap.collection._parentInode.get("parentId")===U.ids.myCollabSpaces){au.messageSuccess=m.replace(m.shareRemoveSuccessCS,{name:aq,CSName:ar});au.messageFailure=m.replace(m.shareRemoveErrorCS,{name:aq})}G(ap,au)},"permission:onRemoveLinkAuthorization":function(ap,ar){var at=Object.assign({},ar);var aq=ap.get("displayName");at.messageSuccess=m.replace(m.shareRemoveSuccess,{name:aq});at.messageFailure=m.replace(m.shareRemoveError,{name:aq});G(ap,at)},"permission:onRemoveShare":function(ap,ar){var at=Object.assign({},ar);var aq;if(ap.get("type")==="group"){aq=ap.get("label")}else{aq=ap.get("displayName")}at.messageSuccess=m.replace(m.shareRemoveSuccess,{name:aq});at.messageFailure=m.replace(m.shareRemoveError,{name:aq});G(ap,at)},"permission:onUpdate":function(aq,at,ap){var ar=aq.get("role");var au=new R(function(aw,av){aq.save({role:at},Object.assign({wait:true,onComplete:aw,onFailure:av},ap))});au.then(function(){var av;if(aq.get("type")==="group"){av=aq.get("label")}else{av=aq.get("displayName")}aj.add({message:m.replace(m.shareSucess,{access:m[aq.get("role")],name:aq.collection._parentInode.get("title"),userName:av}),className:"success"})},function(av){aq.set("role",ar);aj.add({message:((av&&av.message)?av.message:m.replace(m.shareError,{name:aq.collection._parentInode.get("title")})),className:"error"})})},"inodeActions:onChangeAlias":function(au,aq,ap){var at=au.get("alias"),ar=new R(function(aw,av){au.save({alias:aq},Object.assign({onComplete:aw,onFailure:function(ax,ay){av(ay.error)}},ap))});ar.then(function(){aj.add({message:m.replace(m.editSuccess,{name:at,newName:au.get("alias")}),className:"success"})},function(av){var aw;au.set({alias:at});aw=m.replace(m.editError,{name:at});if(av&&av.message&&(typeof av.message==="string")){aw+=": "+av.message}aj.add({message:aw,className:"error"})})},"inodeActions:onCreateCS":function(at,ar,ap){var aq=new R(function(av,au){at.inodeTable.create({parentId:at.id,csAtrributes:ap,mimeType:ar},{wait:true,onComplete:av,onFailure:au,onTimeout:function(ax){var aw={reason:""};aw.reason=m.replace(ax.message);au(aw)}})});aq.then(function(au){aj.add({message:m.replace(m.CScreateSuccess,{name:au.get("title")}),className:"success"})},function(au){if(au.reason){aj.add({message:m.replace(m.CScreateError,{name:au.reason}),className:"warning"})}else{aj.add({message:m.replace(m.CScreateError,{name:au.get("csAtrributes").title}),className:"error"})}})},"inodeActions:onShareCS":function(at,ar,au){if(ar.length>0&&ar[0].isGroup===true){R.all(ar.map(function(av){return new R(function(ax,aw){var ay=at.userGroups.find(av.uri);if(ay){ay.save({role:av.accessright},{wait:true,onComplete:ax,onFailure:aw})}else{at.userGroups.create(av,{method:"create",onComplete:ax,onFailure:aw})}})})).then(aq,ap)}else{at.collection.shareChildren([at],ar).then(aq,ap)}function aq(av){if(au){au.onAddUsersEnd()}if(av[0].permission){aj.add({message:m.replace(m.sharesSuccessCS),className:"success"})}else{aj.add({message:m.replace(m.shareGroupSuccessCS),className:"success"})}}function ap(av){if(!Array.isArray(av)){av=[av]}av.map(function(aw){var ax=aw.inode?aw.inode.get("title"):aw.collection._parentInode.get("title");aj.add({message:m.replace(m.shareErrorCS,{name:ax}),className:"error"})})}},"inodesActions:onShareCS":function(at,ar){var au=at[0].collection;au.shareChildren(at,ar).then(aq,ap);function aq(av){aj.add({message:m.replace(m.sharesSuccessCS),className:"success"})}function ap(av){av.map(function(aw){aj.add({message:m.replace(m.shareErrorCS,{name:aw.inode.get("title")}),className:"error"})})}},"panelMultiOrg:onCancel":function(){ah.navigate(href,{trigger:false})},"inodeActions:shareCSMultiOrg":function(at,ar,au){var at;if(at.collection){at=at}else{at=at.drive.getInode({id:at.id})}at.collection.shareChildren([at],ar).then(aq,ap);function aq(av){au.onAddUsersEnd();aj.add({message:m.replace(m.sharesSuccessCS),className:"success"})}function ap(av){av.map(function(aw){aj.add({message:m.replace(m.shareErrorCS,{name:aw.inode.get("title")}),className:"error"})})}},"permission:onUpdateCS":function(ap,ar){var aq=ap.get("role");var at=new R(function(av,au){ap.save({role:ar},{wait:true,onComplete:av,onFailure:au})});at.then(function(){aj.add({message:m.replace(m.shareSucessCS,{access:m[(ap.get("parsedRole"))?ap.get("parsedRole"):ap.get("role")],name:ap.collection._parentInode.get("title"),userName:ap.get("displayName")||ap.get("label")}),className:"success"})},function(au){ap.set("role",aq);aj.add({message:((au&&au.message)?au.message:m.replace(m.shareErrorCS,{name:ap.collection._parentInode.get("title")})),className:"error"})})},"inodeActions:onEditCS":function(at,ar,ap){var aq=new R(function(av,au){at.save({actualName:at.id,csAtrributes:ap,mimeType:ar},{wait:true,onComplete:av,onFailure:function(ax,ay,aw){aj.add({message:m.replace(m.CSEditError,{name:ax.get("csAtrributes").title}),className:"error"})}})});aq.then(function(au){aj.add({message:m.replace(m.CSEditSuccess,{name:au.get("title")}),className:"success"})},function(au){aj.add({message:m.replace(m.CScreateError,{name:au.get("title")}),className:"error"})})},"inodeActions:onChangeThumbnail":function(at,ar,ap){var aq=new R(function(av,au){at.save({actualName:at.id,file:ar[0],action:"changeThumbnail"},{wait:true,onComplete:av,onFailure:au})});aq.then(function(au){aj.add({message:m.replace(m.CSEditThumbnailSuccess,{name:au.get("title")}),className:"success"})},function(au){aj.add({message:au.message?au.message:m.replace(m.CSEditThumbnailError,{name:au.get("title")}),className:"error"})})},"iteration:onRestore":function(aq){var ap=aq.get("title");aq.restoreVersion().then(function(){aj.add({message:m.replace(m.restoreSuccess,{name:ap}),className:"success"})},function(){aj.add({message:m.replace(m.restoreFail,{name:ap}),className:"error"})})},"inodeActions:onUpdate":function(at,aq){var ap=aq[0];var ar=new R(function(aw,av){if((O.getValue("is3DSpaceWidget")!=="true")&&at.get("fileExtension").toLowerCase()!==aq[0].name.split(".").pop().toLowerCase()){aj.add({message:m.replace(m.updateDifferentExtension,{extension:at.get("fileExtension")}),className:"error"});av()}else{if((O.getValue("is3DSpaceWidget")!=="true")&&at.get("title")!==aq[0].name){if(F.isIE()||F.isEdge()){aj.add({message:m.browserRestrictionOnUpdate,className:"error"})}else{var au={title:m.toUpdate+" "+at.get("title"),body:m.replace(m.updateDifferentFileNames,{nameA:at.get("title"),nameB:aq[0].name}),buttons:[{className:"primary",value:m.toUpdate,action:function(ax){ax.hide();aw()}},{value:m.cancel,action:function(ax){ax.hide();av()}}]};W.dialog(au);ap=new File([ap],at.get("title"),{type:ap.type})}}else{aw()}}});ar.then(function(){var av=L.addUploadTask(at);av.start();var au=new R(function(ax,aw){at.sync("create",at,{file:ap,action:"update",onComplete:function(ay){at.set(at.parse(ay));at.dispatchEvent("onChange:id");av.stop();av.getDuration();ax(ay)},onFailure:function(ay){aw(ay)}})});au.then(function(){aj.add({message:m.replace(m.updateSuccess,{title:at.get("title")}),className:"success"});if(O.getValue("is3DSpaceWidget")!=="true"){}},function(aw){at.dispatchEvent("onError",at);var ax;ax=m.replace(m.updateError,{title:at.get("title")});if(aw&&aw.message&&(typeof aw.message==="string")){ax+=": "+aw.message}aj.add({message:ax,className:"error"})})})},"inodeActions:onEditContent":function(ar,ap){var aq=new R(function(au,at){ar.save({inode:ar,attributes:ap,action:"editContent"},{wait:true,onComplete:au,onFailure:at})});aq.then(function(at){aj.add({message:m.replace(m.succesEditingContent,{name:at.get("title")}),className:"success"})},function(){aj.add({message:m.replace(m.errorEditingContent,{name:ar.get("title")}),className:"error"})})},"drivesView:onWannaChangeSelection":function(ap){var aq=new R(function(au,at){if(ap.get("authenticated")){var ar=ae.getCounter("3DDrive-switch-service",{label:"Switch service",appID:"X3DDRIV_AP",tenant:ap.id});ar.inc();return au()}ap.save({authenticated:true},{wait:true,onComplete:au,onFailure:at})});aq.then(function(){var ar=ae.getCounter("3DDrive-connect-external-service",{label:"Connect external service",appID:"X3DDRIV_AP",tenant:ap.id});ar.inc();r(ap)},function(){aj.add({message:m.replace(m.authenticationError,{service:ap.get("title")}),className:"error"});ah.navigate("",{trigger:true,loadBaseUri:true})})},"driveView:onNodeClick":function(aq){var ap=aq.drive;if(O.getValue("is3DSpaceWidget")&&aq.isCollabSpace()){aq.securityContext(aq);if(aq.get("solution")!==U.boType.team){aj.add({message:m.warningNonOCDX,className:"warning"})}}ah.navigate(ap.getInodePanelContentURI(aq),{trigger:true})},"driveTreeView:onPreExpand":function(ap){ap.inodeTable.fetch({merge:false,remove:false})},"inodePanelView:onSort":function(aq){var ap=C.getSecondPanel();if(!ap){return}var ar=ap.model;var at=ar.inodeTable;if(at){O.setValue("inodesSorting",aq);at.sort({sorting:aq})}},"inodePanelView:onPathClick":function(ap){ah.navigate(ap,{trigger:true})},"inodePaneView:onChangeSelection":function(ap,aq){p=ap;if(!aq.length){if(ac){al.unfocus()}y.publish("resetObject");y.publish("resetX3DContent");return}if(ac){al.focusOnSubjectsWithInode(ap)}if(ap.isCollabSpace()!==true){y.publish("setObject",b.getObject(ap));y.publish("setX3DContent",b.get3DXContent(aq))}},"inodeTableScrollView:onNextPage":function(ap){ap.getNextPage({evnt:"onFilterChange",merge:false,remove:false})},"inodeDetailAccessView:onNextPage":function(aq,ap){ap.getNextPage({permissions:ap,merge:false,remove:false})},"inodeView:onDblClick":function(ar){if(!ar.isContainer()&&!ar.isActionIdoK(l.actionPubIds.preview)){return}if(o.SWIntegration&&o.SWCheckShared&&!o.SWCheckShared(ar)){var at=ar.get("fileExtension").toLowerCase();if(at==="sldprt"||at==="sldasm"||at==="slddrw"){o.SWIntegration.openFile(JSON.stringify({fileId:ar.id,envId:ar.drive.id}));return}}var ap=ar.drive;var aq=ar.isContainer()?ap.getInodePanelContentURI(ar):ap.getInodePreviewURI(ar);ah.navigate(aq,{trigger:true});if(!ar.isContainer()){k=O.getView().type;O.dispatchEvent("onViewRequest",{type:"fullscreen"})}if(O.getValue("is3DSpaceWidget")&&ar.isCollabSpace()){ar.securityContext(ar);if(ar.get("solution")!==U.boType.team){aj.add({message:m.warningNonOCDX,className:"warning"})}}},OpenModal:function(ap){return ap.getDetailsUndeletedCS(ap).then(function(at){var au=m.DetailsMsgFailureCS;var ar=document.createElement("div");var av=document.createElement("div");av.classList.add("modal-content-relative");at.map(function(ax){return au=au.concat("- ").concat(ax).concat("</br>")});av.innerHTML=au;var aq=new af({element:av}).inject(ar);var aw={title:"Details",body:aq,buttons:[{value:"Close",action:function(ax){ax.hide()}}]};return W.dialog(aw)})},"inodeDetailView:onAccess":function(ap){ap.permissions.fetch({inode:ap,merge:false,reset:true,firstLoad:true,onFailure:function(){aj.add({message:m.replace(m.permissionError,{name:ap.get("title")}),className:"error"})}})},"inodeDetailView:onAccessLink":function(ap){ap.permissionsLink.fetch({merge:false,reset:true,onFailure:function(){aj.add({message:m.replace(m.permissionError,{name:ap.get("title")}),className:"error"})}})},"inodeDetailView:onAccessGroup":function(ap){ap.userGroups.fetch({merge:false,reset:true,onFailure:function(){aj.add({message:m.replace(m.permissionError,{name:ap.get("title")}),className:"error"})}})},"lightbox:onPreviewError":function(){aj.add({message:m.replace(m.previewError),className:"error"})},"lightbox:onCancelClick":function(ap){if(ac){if(p){al.focusOnSubjectsWithInode(p)}else{al.unfocus()}}C.hideLightbox();O.dispatchEvent("onViewRequest",{type:k});ah.navigate(ap,{trigger:false})},"lightbox:onArrowClick":function(ap){ah.navigate(ap,{trigger:true})},"lightbox:onPlay":function(ap){C.updateLightbox(ap,true)},"inodePreView:onCarouselSlide":function(aq){var ap=aq.drive;ah.navigate(ap.getInodePreviewURI(aq),{trigger:false});if(ac){al.focusOnSubjectsWithInode(aq)}},"sidebar:toggleTab":function(ar){var aq=C.getLightbox();aq.togglePreviewPropertiesVisibility(document.body,true);var ap=document.querySelector('.lightbox__preview-properties-container--visible .navigation__header span[data-key="'+ar+'"]');if(ap){ap.click()}},"lightbox:onAnnotationShared":function(at){u.dispatchEvent("sidebar:toggleTab",["inode-detail-comments"]);var av=C.getLightbox();var ap=false;var au;setTimeout(aq,25000);ar();function ar(){if(av.isTabVisible("inode-detail-comments")&&av.getPropertiesView().elements.bodyView.view._successFullInit){ap=true;av.getPropertiesView().elements.bodyView.view.setActiveFieldContent({media:[{type:"annotation",file:at.screenshot,data:{annotationFile:at.annotation}}]})}else{au=setTimeout(ar,100)}}function aq(){clearTimeout(au);if(!ap){aj.add({message:m.annotationSharedError,className:"error"})}}},"socialToolbar:onPreviewAnnotation":function(au,ap){au.annotation=ap;var at=C.getLightbox();var ar=au.drive;var aq={trigger:true};if(at.isLightboxVisible()){aq.force=true}ah.navigate(ar.getInodePreviewURI(au),aq)}});M.setw3dDriveView(C);M.setRouter(ah);x.subscribe("3ddrive.resfresh.notif",function(ap){if(!O.getValue("is3DSpaceWidget")&&ap.lastmodifier!==O.getValue("3ddrive_uuid")){M.processEvent(ap)}});O.body.empty();if(ai===true){document.body.addClassName("standalone")}C.render().inject(O.body);return ah});