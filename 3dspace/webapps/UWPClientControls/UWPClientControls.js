define("DS/UWPClientControls/Column",["UWA/Core","UWA/Utils","UWA/Controls/Abstract"],function(e,c,d){function b(r,j){var k,h,s,g,f,n=0,m=0,q=0,p=[],o=[],t=[];for(k=0,h=r.length;k<h;k++){s=r[k];if(typeof s.size!=="undefined"){f=/^[0-9\.]+%$/i.test(s.size);if(typeof s.size==="number"||f){g=parseFloat(s.size);if(!isNaN(g)){if(f){o.push(k);q+=g}else{n+=g}p.push(g)}else{p=[];break}}else{if(/^[0-9\.]+px$/i.test(s.size)){t.push(k)}else{p=[];break}}}else{p=[];break}}if(p.length>0){for(k=0,h=p.length;k<h;k++){if(t.indexOf(k)<0&&o.indexOf(k)<0&&p[k]!==0){p[k]=Math.round(p[k]*(100-q)/n);m+=p[k]}}m+=q;for(k=0;k<h;k++){if(t.indexOf(k)<0&&!r[k].force){p[k]+=100-m;break}}if(j){k=0;while(j!==0){if(typeof p[k]!=="undefined"){if(p[k]>2&&t.indexOf(k)<0&&!r[k].force){p[k]+=-1;j--}if(k++>p.length){k=0}}else{p=[];j=0}}}}return p}var a=d.extend({defaultOptions:{className:"",classNames:{column:"wp-col"},gutter:"",offset:0,items:[{size:1},{size:1},{size:1}]},init:function(g){var h=0,f,j;this._parent(g);if(typeof g==="undefined"||e.is(this.options.items,"array")){this.columns=[];j=b(this.options.items,this.options.offset);for(f=j.length;h<f;h++){j[h]={width:j[h]};e.merge(j[h],this.options.items[h])}this._buildSkeleton(j)}},add:function(h){var g=0,f;if(e.is(h,"array")){for(f=h.length;g<f;g++){h[g]=this._addColumn(h[g])}}else{h=this._addColumn(h)}return h},remove:function(h){var g=0,f;if(e.is(h,"array")){for(f=h.length;g<f;g++){this._removeColumn(h[g])}}else{this._removeColumn(h)}},update:function(m,g){var g=typeof g!=="undefined"?g:true,h,k,n,j,f;if(e.is(m,"array")&&m.length===this.columns.length){h=m}else{if(m.size&&m.position){if(this.columns[m.position-1]){this.columns[m.position-1].size=m.size;h=this.columns}}}if(h){n=b(h,this.options.offset);for(j=0,f=this.columns.length;j<f;j++){k=this.columns[j];k.width=n[j];if(k.body&&g){k.body.setStyle("width",k.width+"%")}}}},setOffset:function(f){f=parseInt(f,10);if(!isNaN(f)){if(this.options.offset!==f){this.options.offset=f;this.update(this.columns)}}},get:function(f){return this.columns[f]},_addColumn:function(h,f){var g=this.columns;if(typeof h.position==="undefined"||h.position>g.length){h.position=g.length}g.splice(h.position,0,h);if(!f){this.update(g)}h.body=e.createElement("div");if(this.options.gutter){h.body.setStyles({paddingLeft:this.options.gutter,paddingRight:this.options.gutter})}h.body.setStyles(h.styles);h.className=typeof h.className!=="undefined"?h.className:"";h.body.addClassName(this.options.classNames.column+" "+h.className);h.body.setStyle("width",h.width+"%");if(h.position===g.length-1){h.body.inject(this.elements.container);h.body.addClassName("last");if(h.position>0&&h.position===g.length-1){g[h.position-1].body.removeClassName("last")}}else{h.body.inject(g[h.position-1].body,"after")}return h},_removeColumn:function(f){var g=this.columns,h=g[f];if(h){h.body.destroy();g.splice(f,1)}this.update(g);return h},_buildSkeleton:function(k){var g=this.options,j=g.element,h,f;if(!j){this.elements.container=document.createDocumentFragment()}else{this.elements.container=e.extendElement(g.element);delete g.element}if(g.className){this.elements.container.addClassName(g.className)}if(g.styles){this.elements.container.setStyles(g.styles)}for(h=0,f=k.length;h<f;h++){this._addColumn(k[h],true)}},inject:function(g,f){var h=this.getContent();if(h){this.dispatchEvent("onPreInject",[g]);g.grab(h,f);this.elements.container=g;this.dispatchEvent("onPostInject",[g]);this.dispatchEvent("onResize",[g])}return this}});return a});define("DS/UWPClientControls/Draggable",["UWA/Core","UWA/Class","UWA/Element","UWA/Utils","UWA/Event"],function(g,e,d,f,c){var b=function(i){var h=false;try{h=i instanceof TouchEvent}catch(j){}return h};var a={disabled:false,defaultOptions:{ignoreDragging:["INPUT","TEXTAREA","SELECT","BUTTON"],items:"",limit:false,distance:10,delay:300,movePlayer:true,textSelection:true,autoscroll:false,area:50,offset:{left:0,top:0}},init:function(h){this.options=g.extend(g.clone(this.defaultOptions),h,true);this.container=this.options.container;this.handleEvents()},handleEvents:function(){this.eventNames={start:"touchstart mousedown",move:"touchmove mousemove",end:"touchend mouseup",select:"selectstart"};this.events={start:this.dragStart.bind(this),move:this.dragMove.bind(this),stop:this.dragStop.bind(this),select:this.onSelectStart.bind(this)};if(f.Client.Platform.ios&&f.Client.Engine.name==="safari"){this.eventNames.move.split(" ").forEach(function(h){document.addEventListener(h,function i(j){this.isDragging&&j.preventDefault()}.bind(this),{passive:false})},this)}this.container.addEvent(this.eventNames.select,this.events.select);this.eventNames.start.split(" ").forEach(function(h){this.container.addEvent(h,this.events.start)},this);this.eventNames.end.split(" ").forEach(function(h){d.addEvent.call(document,h,this.events.stop)},this)},autoscroll:function(j,m){if(!this.options.autoscroll){return}var n=this,o=j==="x",p=o?"left":"top",l=o?"width":"height";var s=this.options,q=m.scroller[j],h=m.pointer[p]+q,r=this.windowSize[l],i=s.area;function k(w,B,A,t,C,z){var u=+new Date(),y=Math.floor(n._data.position.top),x=y,v={};v.positive=w;v.id=window.setInterval(function(){var E=+new Date(),K=E-u,H=n._data.pointer.top,J=n._data.position.top,D=10,G=2,F,I;F=(t-(w?C-H:H))/t;I=Math.floor((F*D)/G)*G;I=Math.max(I,G);I=Math.floor(I*K/16)*(w?1:-1);if(!w&&A<=0){window.clearInterval(v.id);n._autoscroll=null}A+=I;window.scrollBy(0,I);if(y!==J){y=J;x=J}else{x=x+I}if(z){n._data.pointer.diffTop+=I;z(n._data)}B&&B.setStyle("top",x);u=E},16);return v}this._autoscroll||(this._autoscroll={});if(h<q+i){if(typeof this._autoscroll.positive==="undefined"||this._autoscroll.positive){if(q){window.clearInterval(this._autoscroll.id);this._autoscroll=k(false,s.movePlayer&&this.player,q,i,r,s.autoscrollFn)}else{this._autoscroll=null}}}else{if(h>q+r-i){if(!this._autoscroll.positive){window.clearInterval(this._autoscroll.id);this._autoscroll=k(true,s.movePlayer&&this.player,q,i,r,s.autoscrollFn)}}else{window.clearInterval(this._autoscroll.id);this._autoscroll=null}}},onSelectStart:function(h){if(this.disabled||this.shouldIgnoreDrag(h)){return}return false},dragStart:function(j){var h=this.options,k=c.getElement(j),l,i;if(h.handle){i=k?(d.match.call(k,h.handle)?k.getParent(h.items):false):false}else{i=k?(d.match.call(k,h.items)?k:false):false}if(!i){return}if(this.first&&b(this.first)!==b(j)){return}if(this.disabled||(j.which!==1&&!b(j))){return}if(this.shouldIgnoreDrag(j)){return}this.player=i;this.target=k;this.first=j;this.time=j.timeStamp;this.oMousePos=this.getMousePos(j);l=this.container.getOffsets();this.baseX=Math.round(l.x);this.baseY=Math.round(l.y);this.eventNames.move.split(" ").forEach(function(m){d.addEvent.call(document,m,this.events.move)}.bind(this));if(typeof h.beforeStart==="function"){h.beforeStart.call(this.player,j,this.getDragData(j))}if(!b(j)){return false}},dragStop:function(h){this.clear();if(this.player){this.onDragStop(h)}this.player=null;this.target=null},dragMove:function(l){var k=this.options,i=this.getMousePos(l),j=l.timeStamp-this.time,h=Math.abs(i.left-this.oMousePos.left),m=Math.abs(i.top-this.oMousePos.top);if(this.first&&k.distance&&k.distance>=h&&k.distance>=m){return false}if(this.first&&b(l)&&k.delay>j&&(h>0||m>0)){this.dragStop();return}if(this.first){this.first=false;this.onDragStart.call(this,l);return false}if(this.isDragging===true){this.onDragMove.call(this,l)}return false},onDragStart:function(j){var k,i,h=this.options;if(this.isDragging){return this}this.dragStarted=this.isDragging=true;this.oPlayerOffset=this.player.getOffsets();if(this.options.autoscrollContainer){this.oScroll={x:h.autoscrollContainer.scrollLeft,y:h.autoscrollContainer.scrollTop}}else{this.oScroll=f.Client.getScrolls()}if(h.autoscroll){this.windowSize=g.Utils.Client.getSize()}if(h.limit){i=this.player.getSize();k=this.container.getSize();this.limit={left:this.baseX,right:k.width-i.width-this.baseX,top:this.baseY}}if(typeof h.start==="function"){h.start.call(this.player,j,this.getDragData(j))}return false},onDragMove:function(j){var i=this.options,k=this.getDragData(j),h;this._data=k;this.autoscroll("y",k);if(i.movePlayer){this.player.setStyle("left",k.position.left+i.offset.left);!this._autoscroll&&this.player.setStyle("top",k.position.top+i.offset.top)}h=this.lastPosition||k.position;k.prevPosition=h;if(i.drag){i.drag.call(this.player,j,k)}this.lastPosition=k.position;return false},onDragStop:function(h){var i=this.getDragData(h);this.dragStarted=false;if(this.options.stop){this.options.stop.call(this.player,h,i)}return false},getDragData:function(h){var i=(this.dragStarted&&this.getOffset(h))||{};i.player=this.player;i.target=this.target;return i},getOffset:function(l){var k=this.options,j=this.getMousePos(l),i=Math.round(j.left-this.oMousePos.left),o=Math.round(j.top-this.oMousePos.top),h,n,m;c.preventDefault(l);if(k.autoscrollContainer){h={x:k.autoscrollContainer.scrollLeft,y:k.autoscrollContainer.scrollTop}}else{h=f.Client.getScrolls()}m=Math.round(this.oPlayerOffset.x+i-this.baseX+h.x-this.oScroll.x);n=Math.round(this.oPlayerOffset.y+o-this.baseY+h.y-this.oScroll.y);if(k.limit){if(m>this.limit.right){m=this.limit.right}else{if(m<this.limit.left){m=this.limit.left}}if(n<this.limit.top){n=this.limit.top}}return{scroller:h,position:{left:m,top:n},pointer:{left:j.left,top:j.top,diffLeft:i+(h.x-this.oScroll.x),diffTop:o+(h.y-this.oScroll.y)}}},getMousePos:function(h){h.touches&&(h=h.touches.length?h.touches[0]:h.changedTouches[0]);return{left:h.clientX,top:h.clientY}},shouldIgnoreDrag:function(h){var i=c.getElement(h);if(typeof this.options.shouldIgnoreDrag==="function"){return this.options.shouldIgnoreDrag(h)}return i.match(this.options.ignoreDragging.join(", "))},clear:function(h){if(this._autoscroll){window.clearInterval(this._autoscroll.id);this._autoscroll=null}this.isDragging=false;if(!h&&this.disabled){return}this.eventNames.move.split(" ").forEach(function(i){d.removeEvent.call(document,i,this.events.move)}.bind(this))},enable:function(){this.disabled=false},disable:function(){this.disabled=true},destroy:function(){this.clear(true);this.container.removeEvent(this.eventNames.select,this.events.select);this.eventNames.start.split(" ").forEach(function(h){this.container.removeEvent(h,this.events.start)}.bind(this));this.eventNames.end.split(" ").forEach(function(h){d.removeEvent.call(document,h,this.events.stop)}.bind(this))}};return e.extend(a)});define("DS/UWPClientControls/ModalManager",function(){var b=[];var a={register:function(c){b.push(c);c.elements.container.id="wp-modal-"+(b.length-1)},unregister:function(d){var c=b.indexOf(d);if(c!==-1){b.splice(c,1)}},getActive:function(){for(var c=b.length-1;c>=0;c--){if(b[c].active){return b[c]}}},setActive:function(e,c){var d=b.indexOf(e);if(d!==-1){b[d].active=c}}};return a});define("DS/UWPClientControls/ClickRemover",["UWA/Element"],function(c){var d={};var e=function(f){return Object.getOwnPropertyNames(f).length===0};var b=function(g){for(var f in d){if(d.hasOwnProperty(f)){if(d[f].bypassFirstEvent){d[f].bypassFirstEvent=false}else{d[f].cb(g);a.remove(f)}}}};var a={add:function(g,f,i){var h=window;if(typeof f==="function"){if(e(d)){c.addEvent.call(h,"click",b)}d[g]={};d[g].cb=f;d[g].bypassFirstEvent=!!i}},remove:function(f){var g=window;if(d[f]){delete d[f];if(e(d)){c.removeEvent.call(g,"click",b)}}}};return a});define("DS/UWPClientControls/Notify",["UWA/Core","UWA/Class/Timed","UWA/Controls/Notify"],function(f,e,c){var a="success",d="error";var b=c.extend({defaultOptions:{autoHide:false,showDuration:4000,className:""},init:function(g){g.className="uwp-notify "+(g.className||"");this._parent(f.merge(g,this.defaultOptions))},showMessage:function(k,i){var j,g=new e(),h="addMessage-"+f.Utils.getCheckSum(k);if(!this.messages.length&&k){this.addMessage(k,false,i)}j=this._parent(k);if(j&&this.options.autoHide){g.setDelayed(h,function(){g.clearDelayed(h);f.Event.dispatchEvent(j,"click")},this.options.showDuration,false,this)}if(i&&j){j.addClassName(i)}return j},addMessage:function(i,j,g){var h;if(!i){return}this.messages.push(i);if(j){h=this.showMessage(i);if(g&&h){h.addClassName(g)}}}});b.TYPE_SUCCESS=a;b.TYPE_ERROR=d;return b});define("DS/UWPClientControls/UWPClientControls",[],function(){});define("DS/UWPClientControls/EditInPlace",["UWA/Event","UWA/Class","UWA/Class/Events","UWA/Class/Options","DS/UIKIT/Input/Text"],function(h,d,k,i,c){var a="edit-in-place",f=40,e=1000,j=30,g=function(){},b;b=d.extend(k,i,{options:{className:a,placeholder:"",defaultText:"",maxLength:0,maxWidth:0,minWidth:0,growInputAsUserType:false,onEdit:g,onCancel:g,onComplete:g,noEdit:g,autoEdit:true},init:function(m,l){this.setOptions(l);this.element=m;this.editMode=false;this.events={enter:this.onEnter.bind(this),leave:this.onLeave.bind(this),click:this.edit.bind(this)};if(this.options.autoEdit){this.attachEvents()}},attachEvents:function(){var m=this.element,l=this.events;m.addEvent("mouseover",l.enter);m.addEvent("mouseout",l.leave);m.addEvent("click",l.click)},detachEvents:function(){var m=this.element,l=this.events;m.removeEvent("mouseover",l.enter);m.removeEvent("mouseout",l.leave);m.removeEvent("click",l.click)},onEnter:function(){if(!this.editMode){this.element.addClassName(this.options.className)}},onLeave:function(){if(!this.editMode){this.element.removeClassName(this.options.className)}},onKeyUp:function(m){var l=h.whichKey(m);if(l==="esc"){this.endEdit(true)}else{if(l==="return"){this.endEdit()}}},edit:function(q){var m,p,r,l,n,s,o,t=this.options;if(t.noEdit()||this.editMode){return}if(q&&q.stop){q.stop()}p=this.element;n=t.minWidth;o=t.maxWidth;l=n&&n>f?n:f;s=o&&o<e?o:e;this.onEnter();this.editMode=true;this.originalText=p.getText();this.input=r=new c({className:a+" "+(t.className||""),placeholder:t.placeholder,value:this.originalText,attributes:{maxLength:t.maxLength||""}}).getContent();r.addEvents({blur:this.endEdit.bind(this,false),keyup:this.onKeyUp.bind(this)});if(t.growInputAsUserType){r.addEvents({keyup:function(){var u=this.value.length*7+j;if(u<l){u=l}else{if(s&&u>s){u=s}}this.setStyles({width:u})}})}m=p.getSize().width+j;if(m<l){m=l}if(s&&m>s){m=s}r.setStyles({width:m,margin:"0"});p.hide();r.inject(p,"after");r.focus();r.select()},endEdit:function(o){var q,l,n,m,p;if(!this.editMode){return}l=this.input;n=this.element;m=this.options;p=this.originalText;this.editMode=false;q=l.value.trim();if(o){n.setText(p);m.onCancel(n)}else{if(q!==p){n.setText(q||m.defaultText);m.onEdit(q,n)}}l.destroy();this.detachEvents();n.show();this.onLeave();m.onComplete(q,n)}});return b});define("DS/UWPClientControls/PlatformNotify",["UWA/Core","UWA/String","DS/UIKIT/Alert"],function(d,c,b){var a={alert:null,message:function(f,e){if(!this.alert){this.alert=new b({closable:true,visible:true,autoHide:true,maximumVisibleMessages:1,className:"wp-alert"}).inject(document.body,"top")}this.alert.add({className:e,message:d.is(f,"string")?c.escapeHTML(f):f})},error:function(e){this.message(e,"error")},success:function(e){this.message(e,"success")},warn:function(e){this.message(e,"warning")},info:function(e){this.message(e,"primary")}};return a});define("DS/UWPClientControls/Utils",["UWA/Core"],function(a){return{throttle:function(f,i,e){var d,h,b,g=0;function c(){g=new Date().getTime();h=null;b=f.apply(e,d)}return function(){var j=new Date().getTime(),k=i-(j-g);e=e||this;d=arguments;if(k<=0){clearTimeout(h);h=null;g=j;b=f.apply(e,d)}else{if(!h){h=setTimeout(c,k)}}return b}},debounce:function(h,d,b,i){var g,f,e,j;function c(){var k=new Date().getTime()-e;if(k<d&&k>=0){g=setTimeout(c,d-k)}else{g=null;if(!b){j=h.apply(i,f);if(!g){i=f=null}}}}return function(){i=i||this;f=arguments;e=new Date().getTime();var k=b&&!g;if(!g){g=setTimeout(c,d)}if(k){j=h.apply(i,f);i=f=null}return j}},getConsecutiveNumbers:function(c,e){var f,d,b=[],h=true,g=-1;for(f=0,d=c.length;f<d;f++){if(h||c[f]===g+1){b.push(f);if(b.length===e){break}h=false}else{b=[];h=true}g=c[f]}return b.length>=e?c[b[0]]:false},hasTouch:function(){return"ontouchstart" in window||window.DocumentTouch&&document instanceof window.DocumentTouch},getPlatform:function(b){var c=b||Math.min(document.documentElement.clientWidth,document.documentElement.clientHeight);if(this.hasTouch()){if(c<768){return"mobile"}if(c<=1280){return"tablet"}}return"desktop"},addEvent:function(e,d,c,b){if(typeof b==="undefined"){b=false}if(e.addEventListener){e.addEventListener(d,c,b)}else{if(e.attachEvent){e.attachEvent("on"+d,c,b)}}},addEvents:function(d,c,b){Object.keys(c).forEach(function(e){this.addEvent(d,e,c[e],b)},this)},removeEvent:function(e,d,c,b){if(typeof b==="undefined"){b=false}if(e.removeEventListener){e.removeEventListener(d,c,b)}else{if(e.detachEvent){e.detachEvent("on"+d,c,b)}}},removeEvents:function(d,c,b){Object.keys(c).forEach(function(e){this.removeEvent(e,d,c[e],b)})}}});define("DS/UWPClientControls/DockLayout/DropTarget",["UWA/Class"],function(a){var b=a.extend({init:function(c){this.dropRectangle=c.dropRectangle;this.indicatorRectangle=c.indicatorRectangle;this.mousePolygon=c.mousePolygon;this.container=c.container;this.name=c.name;this.priority=c.priority},matchesCoordinates:function(o,n){var f=false,c=this.mousePolygon;for(var k=0,h=c.length-1;k<c.length;h=k++){var m=c[k].x,g=c[k].y;var l=c[h].x,e=c[h].y;var d=((g>n)!==(e>n))&&(o<(l-m)*(n-g)/(e-g)+m);if(d){f=!f}}return f},createItems:function(f){var e=require("DS/UWPClientControls/DockLayout/RowOrColumn"),c=require("DS/UWPClientControls/DockLayout/Item"),d=new e({type:this.dropRectangle.width>this.dropRectangle.height?"row":"column",container:this.container});f.forEach(function(g){d.addChild(new c({content:g,container:d,weight:100/f.length}))});if(d.content.length===1){d=d.content[0];d.container=this.container}this.container.dropItemAt(this.name,d)}});b.sortByPriority=function(c){return c.sort(function(e,d){if(e.priority>d.priority){return -1}if(e.priority<d.priority){return 1}return 0})};return b});define("DS/UWPClientControls/DockLayout/DropTargetIndicator",["UWA/Core","UWA/Class/View"],function(c,b){var a=b.extend({init:function(d){this._parent();this.manager=d.manager;this.element=c.createElement("div",{"class":"dock-drop-target"});this.element.setStyle("position","absolute");this.manager.element.appendChild(this.element)},setRectangle:function(d){if(!d){this.element.setStyle("height",0)}else{this.element.setStyles({left:d.left,top:d.top,width:d.width,height:d.height})}this.rectangle=d},getRectangle:function(){return c.clone(this.rectangle)},show:function(){this.element.show()},hide:function(){this.element.hide()},remove:function(){this.element.remove()}});return a});define("DS/UWPClientControls/DockLayout/Utils",["DS/WebappsUtils/Map"],function(a){var b={clamp:function(c){return{x:Math.min(c.maxX,Math.max(c.minX,c.x)),y:Math.min(c.maxY,Math.max(c.minY,c.y)),}},max:function(d){var c=-Infinity;d.forEach(function(e){if(e>c){c=e}});return c},divideRectangle:function(d,g){var e=[],f=d.width>d.height?"width":"height";for(var c=0;c<g;++c){e.push({left:d.left+(f==="width"?c*d.width/g:0),top:d.top+(f==="height"?c*d.height/g:0),width:d.width/(f==="width"?g:1),height:d.height/(f==="height"?g:1)})}return e},toMap:function(d){var c=new a();d.forEach(function(e){c.set(e[0],e[1])});return c}};return b});define("DS/UWPClientControls/Grid",["UWA/Core","UWA/Event","UWA/Element","UWA/Controls/Abstract","DS/UWPClientControls/Utils","DS/UWPClientControls/Draggable"],function(g,k,b,h,i,c){var d={};function e(l){l=l.sort(function(n,m){if(n.row>m.row||n.row===m.row&&n.col>m.col){return 1}if(n.row===m.row&&n.col===m.col){return 0}return -1});return l}function j(l){l=l.sort(function(n,m){if(n.row>m.row){return 1}if(n.row===m.row){return 0}return -1});return l}function a(l){l=l.sort(function(n,m){if(n.row+n.sizey<m.row+m.sizey){return 1}return -1});return l}var f={name:"r2grid",defaultOptions:{resizePlaceholderClassName:"r2g-preview-resize",placeholderClassName:"r2g-preview",resizeClassName:"r2g-resize",widgetClassName:"r2g-widget",namespace:"",cols:12,area:50,minSize:"1 1",maxSize:"12 12",fitMinSize:"2 2",margins:"7 7",resizable:"both x y",breakpoints:"mobile:1:1:2 tablet:2:1:2 desktop:12:2:4",fit:false,limit:false,proxy:false,autoscroll:false,offsets:{x:0,y:0}},init:function(l){var m;if(!l.el){return}this._parent(l);l=this.options;this.events={};this.clientWidth=document.documentElement.clientWidth;if(l.viewport){this.viewportHeight=this.options.viewport.getSize().height}else{this.viewportHeight=document.documentElement.clientHeight}this.elements.wrapper=g.extendElement(l.el);this.elements.container=this.elements.wrapper.getParent();this.elements.container.addClassName(this.name);if(l.resizable){this.setupTemplateResize()}l.margins=l.margins.split(" ").map(function(n){return +n});l.minSize=l.minSize.split(" ").map(function(n){return +n});l.fitMinSize=l.fitMinSize.split(" ").map(function(n){return +n});l.maxSize=l.maxSize.split(" ").map(function(n){return +n});if(l.breakpoints){this.breakpoint=this.getBreakpoint(l.breakpoints)}this.minSizex=this.breakpoint&&this.breakpoint.minSizex||this.options.minsize[0];this.minSizey=this.breakpoint&&this.breakpoint.minSizey||this.options.minsize[1];if(g.is(l.widgets,"string")){m=this.elements.wrapper.getElements(l.widgets)}else{if(g.is(l.widgets,"array")){m=l.widgets}else{m=this.elements.wrapper.getChildren()}}this.originalWidgets=m.map(this.parseWidgetsOption.bind(this));this.widgets=this.originalWidgets.map(this.parseOriginalWidgets.bind(this));this.cols=this.breakpoint&&this.breakpoint.col||l.cols;this.rows=this.widgets.reduce(function(o,n){return o+(n.sizey||1)},1)||1;this.setupGrid();this.createFauxGrid();this.registerWidgets();this.createStylesheet();if(!l.proxy){this.setupDrag();this.setupResize();this.events.window=i.debounce(this.update.bind(this),120,false);i.addEvent(window,"resize",this.events.window)}if(this.options.fit){this.fit()}this.updateGridHeight()},parseWidgetsOption:function(q){var o,p,n,l={},m=false;if(g.is(q,"element")){n=g.extend({el:g.extendElement(q)},this.parseData(q))}else{if(g.is(q,"string")){o=g.createElement(q);n=g.extend({el:o},this.parseData(o))}else{if(this.breakpoint){n={el:g.extendElement(q.el)};p=Object.keys(q);l.sizex=Math.max((q.sizex||1),this.minSizex);l.sizey=(q.sizey!==1)?Math.max((q.sizey||1),this.minSizey):1;q.row&&(l.row=q.row);q.col&&(l.col=q.col);this.breakpoints.forEach(function(r){if(p.indexOf(r)!==-1){n[r]=this.parseData(q[r],true);m=true}}.bind(this));if(!m){g.merge(n,l)}}else{n=g.extend({el:g.extendElement(q.el)},this.parseData(q))}}}if(this.options.resizable){n.el.addContent(this.resizeTemplate)}return n},parseOriginalWidgets:function(n){var m=Object.keys(n),l;if(this.breakpoint){if(n[this.breakpoint.name]){return g.extend({el:n.el},this.parseData(n[this.breakpoint.name]))}this.breakpoints.reverse().some(function(o){if(m.indexOf(o)!==-1){l=o;return true}});if(l){return g.extend({el:n.el},this.parseData(n[l]))}}return g.extend({},n)},setupTemplateResize:function(){var l=this.options,m=l.resizable;m=m.replace(/x/,"left-x right-x");m=m.replace(/both/,"left-both right-both");this.resizeTemplate=m.split(" ").map(function(n){return'<span class="'+l.resizeClassName+" "+l.resizeClassName+"-"+n+'"></span>'}).join("")},setupGrid:function(p){var m,o,n=this.options,l=this.elements.container;!p&&n.offsets||(n.offsets=l.getOffsets());!p&&n.containerWidth||(n.containerWidth=l.getSize().width);this.baseX=n.offsets.x;this.baseY=n.offsets.y;this.widgetWidth=Math.floor((n.containerWidth-this.cols*2*this.options.margins[0])/this.cols);this.widgetHeight=this.options.height||this.widgetWidth;this.minWidgetWidth=this.options.margins[0]*2+this.widgetWidth;this.minWidgetHeight=this.options.margins[1]*2+this.widgetHeight;this.visibleRows=Math.floor(this.viewportHeight/this.minWidgetHeight);this.rows=Math.max(this.rows,this.visibleRows);o=(this.viewportHeight/this.minWidgetHeight)-this.visibleRows;m=Math.floor((o*this.minWidgetHeight)/this.visibleRows);this.minWidgetHeight+=m;this.widgetHeight+=m},getLastRow:function(){return this.widgets.reduce(function(m,l){l=l.row+l.sizey-1;return m<l?l:m},0)||1},createStylesheet:function(){var A=this.options,w="",p,n,s,q,u,r,z=this.rows,o,v,m,l,t;p=A.namespace?A.namespace:"default";n=A.namespace?"."+A.namespace:"";s=[this.rows,this.cols,this.widgetWidth,this.widgetHeight,p];if(d[p]){o=d[p];v=o.split(" ");m=+v[0];l=v.slice(1).join(" ");z=Math.max(this.rows,m);s[0]=z;t=s.slice(1).join(" ");if(o===s.join(" ")||(this.rows<m&&l===t)){return}}this.removeStyleTag(p);for(q=this.cols;q>=0;q--){w+=(n+' [data-col="'+(q+1)+'"] { left:'+(q*this.widgetWidth+q*A.margins[0]+(q+1)*A.margins[0])+"px; }\n")}for(q=z;q>=0;q--){w+=(n+' [data-row="'+(q+1)+'"] { top:'+(q*this.widgetHeight+q*A.margins[1]+(q+1)*A.margins[1])+"px; }\n")}for(r=1;r<=z;r++){w+=(n+' [data-sizey="'+r+'"] { height:'+(r*this.widgetHeight+(r-1)*(A.margins[1]*2))+"px; }\n")}for(u=1;u<=this.cols;u++){w+=(n+' [data-sizex="'+u+'"] { width:'+(u*this.widgetWidth+(u-1)*(A.margins[0]*2))+"px; }\n")}d[p]=s.join(" ");this.addStyleTag(p,w)},registerWidgets:function(){e(this.widgets);this.widgets.forEach(function(l){this.registerWidget(l)}.bind(this))},registerWidget:function(m){var n=this.getHighestEmptyRow(m),l;if(n){m.row=n;m.el.setAttribute("data-row",n)}if(!m.col||!m.row||!this.isValidPosition(m,m.col,m.row)){l=this.getNextAvailablePosition(m);g.extend(m,l)}m.el.addClassName(this.options.widgetClassName);this.setData(m);if(!m.el.isInjected()){m.el.inject(this.elements.wrapper)}this.addFauxWidget(m)},onOverlappedColumn:function(p){if(!p.length){return}var m=p[0],q,l,n;function o(v,s){var r=v+s-1,u=[],t;for(t=v;t<=r;t++){u.push(t)}return u}q=o(m.coords.col,this.player.sizex);for(n=0;n<q.length;n++){if(this.lastCols.indexOf(q[n])===-1){this.setPlayer(m.coords.col,m.coords.row);break}}for(n=0;n<this.lastCols.length;n++){if(q.indexOf(this.lastCols[n])===-1){l=this.lastCols[n];this.setPlayer(m.coords.col,m.coords.row);this.forEachWidgetBelow(l,this.playerCells.rows[0],function(r){this.moveWidgetUp(r,this.player.sizey)}.bind(this));break}}this.lastCols=q},onOverlappedRow:function(p){if(!p.length){return}var n=p[0],q,s,o,m,r;function l(v,u){var t=v+u-1,w=[],x;for(x=v;x<=t;x++){w.push(x)}return w}q=l(n.coords.row,this.player.sizey);for(o=0;o<q.length;o++){if(this.lastRows.indexOf(q[o])===-1){this.setPlayer(n.coords.col,n.coords.row);break}}for(o=0;o<this.lastRows.length;o++){if(q.indexOf(this.lastRows[o])===-1){s=this.lastRows[o];r=this.playerCells.cols;this.setPlayer(n.coords.col,n.coords.row);for(m=0;m<r.length;m++){this.forEachWidgetBelow(r[m],s,function(t){this.moveWidgetUp(t,this.player.sizey)}.bind(this))}break}}this.lastRows=q},setPlayer:function(m,o){var n,p,l=false;this.removeFauxWidget(this.placeholder);this.player.col=m;this.player.row=o;this.playerCells=this.getCells(this.player);n=this.getWidgetsOverlapping(this.player);if(!n.length){l=this.canPlayerGoUp(this.player);if(l!==false){o=l;this.player.row=o;this.playerCells=this.getCells(this.player)}this.setPlaceholder(m,o)}else{p=this.getWidgetsConstraints(n);p.canGoUp.forEach(function(q){this.moveWidgetUpToRow(q.wdg,q.row)}.bind(this));p.cantGoUp.forEach(function(q){l=this.canPlayerGoUp(this.player);if(!l){this.moveWidgetDown(q,(o+this.player.sizey)-q.row)}}.bind(this));this.setPlaceholder(m,l||o)}},setPlaceholder:function(o,q){var p,r,n=g.extend({},this.placeholder),l=this.placeholder.row!==q,m=this.placeholder.col!==o;r=(o+n.sizex-1);if(r>this.cols){o=this.cols-n.sizex+1}this.placeholder.col=o;this.placeholder.row=q;this.placeholderCells=this.getCells(this.placeholder);if(this.placeholder.el){this.placeholder.el.setAttributes({"data-row":q,"data-col":o})}else{this.placeholder.setAttributes({"data-row":q,"data-col":o})}if(l||m){p=this.getWidgetsBelow(n);p.forEach(function(s){this.moveWidgetUp(s,s.row-q-this.placeholder.sizey)}.bind(this))}p=this.getWidgetsOverlapping(this.placeholder);if(p.length){p.forEach(function(s){this.moveWidgetDown(s,q+this.placeholder.sizey-s.row)}.bind(this))}},setupDrag:function(){var n=this,l=this.options,m="."+l.widgetClassName+", "+l.widgetClassName+" > *",o=l.handle?l.handle:m;this.events.drag=new c({container:this.elements.container,items:"."+l.widgetClassName,handle:o,limit:l.limit,autoscroll:!l.fit&&l.autoscroll,distance:0,area:l.area,start:function(){n.onDragStart(this)},stop:function(p,q){n.onDragStop(q)},drag:i.throttle(function(p,q){n.onDrag(q)},120,n)})},setupResize:function(){var q=this,n=this.options,o="."+n.resizeClassName,r=n.resizeHandle?n.resizeHandle:o,s=120,l=60,m=i.debounce(function(t){q.onResizing(t)},s,false,q),p=i.throttle(function(t){q.onResizingWidget(t)},l,q);this.events.resize=new c({container:this.elements.container,items:"."+n.widgetClassName,handle:r,limit:n.limit,autoscroll:!n.fit&&n.autoscroll,autoscrollFn:this.onResizingWidget.bind(this),area:n.area,distance:0,movePlayer:false,start:function(t,u){q.onResizeStart(this,u)},stop:function(){var t=180;setTimeout(q.onResizeStop.bind(q),t)},drag:function(t,u){m(u);p(u)}})},onDragStart:function(l){this.player=this.widgets.filter(function(m){if(m.el===l){return true}})[0];this.placeholder=g.extend({},this.player);this.playerCells=this.getCells(this.player);this.placeholderCells=g.extend({},this.playerCells);this.lastCols=[];this.lastRows=[];this.placeholder.el=g.createElement(this.player.el.getTagName(),{"class":this.options.placeholderClassName});this.setData(this.placeholder);this.placeholder.el.inject(this.elements.wrapper);this.player.el.addClassName("dragging")},onResizeStart:function(m,n){var l=this.options,q=n.target,p=l.margins,o=this.parseData(m),r=100;this.player=g.extend({el:m},this.getCoords(o));this.resized=g.extend({},this.player);this.direction={left:q.hasClassName(l.resizeClassName+"-left-x")||q.hasClassName(l.resizeClassName+"-left-both"),right:q.hasClassName(l.resizeClassName+"-right-x"),bottom:q.hasClassName(l.resizeClassName+"-y"),both:q.hasClassName(l.resizeClassName+"-left-both")||q.hasClassName(l.resizeClassName+"-right-both")};if(this.direction.left){this.resized.maxSizex=Math.max(Math.min(this.player.col,l.maxSize[0]),this.player.col+this.player.sizex-1);this.resized.minCol=Math.max(1,this.player.col+this.player.sizex-l.maxSize[0]);this.resized.maxCol=this.player.col+this.player.sizex-this.minSizex;this.resized.minLeft=(this.resized.minCol-1)*this.minWidgetWidth+p[0];this.resized.maxLeft=(this.resized.maxCol-1)*this.minWidgetWidth+p[0]}else{this.resized.maxSizex=Math.min(l.maxSize[0],this.cols-this.player.col+1)}this.resized.minSizex=this.minSizex;this.resized.minSizey=this.minSizey;this.resized.maxSizey=l.fit?r:l.maxSize[1];this.resized.minWidth=this.resized.minSizex*this.widgetWidth+(this.resized.minSizex-1)*p[0]*2;this.resized.maxWidth=this.resized.maxSizex*this.widgetWidth+(this.resized.maxSizex-1)*p[0]*2;this.resized.minHeight=this.resized.minSizey*this.minWidgetHeight-p[1]*2;this.resized.maxHeight=this.resized.maxSizey*this.minWidgetHeight-p[1]*2;this.lastSizex=this.resized.sizex;this.lastSizey=this.resized.sizey;this.lastCol=this.resized.col;this.player.el.setStyles({"min-width":this.widgetWidth,"min-height":this.widgetHeight});this.placeholder&&this.placeholder.remove();this.placeholder=g.createElement(this.player.el.getTagName(),{"class":l.placeholderClassName+" "+l.resizePlaceholderClassName,"data-row":this.player.row,"data-col":this.player.col,"data-sizex":this.player.sizex,"data-sizey":this.player.sizey}).inject(this.elements.wrapper);this.player.el.addClassName("dragging")},onDrag:function(n){if(this.player===null||(this.events.drag&&this.events.drag._autoscroll)){return false}var l,m={x:n.position.left+this.baseX,y:n.position.top+this.baseY,width:this.player.sizex*this.widgetWidth,height:this.player.sizey*this.widgetHeight};m.x1=m.x+(m.width/2);m.y1=m.y+(m.height/2);m.x2=m.x+m.width;m.y2=m.y+m.height;l=this.getClosestColliders(m);this.onOverlappedColumn(l);this.onOverlappedRow(l)},onResizingWidget:function(p){var o=this.resized,q=this.options.margins,n={},m=p.pointer.diffLeft,l=p.pointer.diffTop;if(!o){return}if(this.direction.left){n.width=Math.max(Math.min(o.width-m,o.maxWidth),o.minWidth);n.left=Math.max(Math.min(o.x-this.baseX+m+q[0],o.maxLeft),o.minLeft)}else{if(!this.direction.bottom){n.width=Math.max(Math.min(o.width+m,o.maxWidth),o.minWidth)}}if(this.direction.bottom||this.direction.both){n.height=Math.max(Math.min(o.height+l,o.maxHeight),o.minHeight)}this.player.el.setStyles(n)},onResizing:function(t){if(this.resized===null||(this.events.resize&&this.events.resize._autoscroll)){return false}var l=this.resized,q=this.options.margins,x={},w=t.pointer.diffLeft,v=t.pointer.diffTop,o,n,u,s,m;if(this.direction.left){o=Math.round(w/this.minWidgetWidth);u=Math.max(1,l.sizex-o);m=Math.max(Math.min(l.col+o,l.maxCol),l.minCol);x.width=Math.max(Math.min(l.width-w,l.maxWidth),l.minWidth);x.left=Math.max(Math.min(l.x-this.baseX+w+q[0],l.maxLeft),l.minLeft)}else{o=Math.round(w/this.minWidgetWidth);u=Math.max(1,l.sizex+o);x.width=Math.max(Math.min(l.width+w,l.maxWidth),l.minWidth)}n=Math.round(v/this.minWidgetHeight);s=Math.max(1,l.sizey+n);x.height=Math.max(Math.min(l.height+v,l.maxHeight),l.minHeight);u=Math.max(Math.min(u,l.maxSizex),l.minSizex);s=Math.max(Math.min(s,l.maxSizey),l.minSizey);if(!this.direction.both&&(this.direction.right||this.direction.left)){s=l.sizey;delete x.height}else{if(this.direction.bottom){u=l.sizex;delete x.width}}this.player.el.setStyles(x);if(u!==this.lastSizex||s!==this.lastSizey){var p=this.resize({widget:this.player.el,sizex:u,sizey:s,col:m,silent:true});this.placeholder&&this.placeholder.setAttributes({"data-row":p.row,"data-col":m||p.col,"data-sizex":u,"data-sizey":s})}this.lastSizex=u;this.lastSizey=s;this.lastCol=m},onDragStop:function(m){var l;if(!this.player){return}this.player.el.removeClassName("dragging");m.position.left=m.position.left+this.baseX;m.position.top=m.position.top+this.baseY;l=this.getClosestColliders(m.position);this.onOverlappedColumn(l);this.onOverlappedRow(l);this.player.el.setAttributes({"data-col":this.placeholder.col,"data-row":this.placeholder.row});this.player.el.setStyles({left:"",top:""});this.player.row=this.placeholder.row;this.player.col=this.placeholder.col;this.playerCells=this.getCells(this.player);this.addFauxWidget(this.player,this.player,true);this.dispatchEvent("onDrop");this.player=null;this.playerCells=null;this.placeholderCells=null;this.placeholder.el.remove();this.placeholder=null;if(this.options.fit){this.fit()}this.updateGridHeight()},onResizeStop:function(){if(!this.player){return}this.player.el.removeClassName("dragging");this.player.el.setStyles({width:"",height:"",left:"","min-width":"","min-height":""});this.dispatchEvent("onResize");this.player=null;this.resized=null;if(this.placeholder){this.placeholder.remove();this.placeholder=null}if(this.options.fit){this.fit()}this.updateGridHeight()},unfit:function(){var o=this.gridmap,l,p,m=[],n;this.options.fit=false;this.minSizey=Math.max(this.breakpoint.minSizey,this.minSizey);for(l=1;l<o.length;l++){for(p=o[l].length-1;p>0;p--){n=o[l][p];if(this.isWidget(l,p)&&m.indexOf(n)===-1){if(n.sizey!==1&&n.sizey<this.minSizey){m.push(n);this.resize({widget:n,sizey:this.minSizey,silent:true})}}}}this.updateGridHeight();this.dispatchEvent("onUnFit");return this},fit:function(){var p=this.gridmap,o,l,r,s,q,m,n=[];this.minSizey=Math.min(this.options.fitMinSize[1],this.minSizey);for(m=1;m<p.length;m++){r=0;for(q=p[m].length-1;q>0;q--){if(this.isWidget(m,q)&&(r||q>this.visibleRows)){o=p[m][q];r||(r=q-this.visibleRows);if(!r){break}if(n.indexOf(o)>-1){continue}if(o.sizey>this.minSizey){l=Math.max(o.sizey-r,this.minSizey);r-=o.sizey-l;n.push(o);this.resize({widget:o,sizey:l,silent:true})}}}}n=[];for(m=1;m<p.length;m++){s=0;for(q=this.visibleRows;q>0;q--){o=p[m][q];if(n.indexOf(o)>-1){continue}else{if(this.isEmpty(m,q)){s++}else{if(s&&o.sizey>=this.minSizey){l=this.canMoveWidget(o,"down",s);n.push(o);if(l){this.resize({widget:o,sizey:l-o.row+1,silent:true})}s=0}}}}}n=[];for(m=1;m<p.length;m++){for(q=p[m].length-1;q>0;q--){o=p[m][q];if(this.isWidget(m,q)&&(q>this.visibleRows)&&(n.indexOf(o)===-1)){n.push(o)}}}this.updateGridHeight();this.dispatchEvent("onFit",[n]);return this},getWidgetsBelow:function(o){var n=this,m=o.row+o.sizey-1,l=[];this.forEachCol(o,function(p){n.forEachWidgetBelow(p,m,function(q){if(!n.isPlayer(q.col,q.row)&&l.indexOf(q)===-1){l.push(q);return true}})});return j(l)},forEachWidgetBelow:function(n,q,r){var p=this.gridmap,o=[],m;if(!p[n]){return}for(q=q+1,m=p[n].length;q<m;q++){if(this.isWidget(n,q)&&o.indexOf(p[n][q])===-1){o.push(p[n][q]);if(r(p[n][q])){break}}}},moveWidgetUp:function(p,o){var m=this,l=[],n;o||(o=1);if(!this.canMoveWidget(p,"up")){return false}this.forEachCol(p,function(q){if(l.indexOf(p)===-1){var r=p.row-o;r=m.canMoveWidgetUpToRow(p,q,r);if(!r){return true}n=m.getWidgetsBelow(p);m.removeFauxWidget(p);p.row=r;m.addFauxWidget(p);p.el.setAttribute("data-row",p.row);l.push(p);n.forEach(function(s){m.moveWidgetUp(s,o)})}})},moveWidgetUpToRow:function(o,p){var m=this,l=this.getWidgetsBelow(o),n=this.isValidPosition(o,o.col,p);if(n===false){return}this.removeFauxWidget(o);o.row=p;this.addFauxWidget(o);o.el.setAttribute("data-row",p);l.forEach(function(r){var q=m.getHighestEmptyRow(r);if(q&&q!==r.row){m.moveWidgetUpToRow(r,q)}})},moveWidgetDown:function(p,o){var n=this,m=p.row+o,l;if(o<=0){return}l=this.getWidgetsBelow(p);this.removeFauxWidget(p);l.forEach(function(q){var r=[];n.forEachCol(q,function(s){var u=0;for(var t=p.row+p.sizey;t<q.row;t++){if(n.isEmpty(s,t)){u++}}r.push(u)});o=o-Math.max.apply(Math,r);if(o>0){n.moveWidgetDown(q,o)}});p.row=m;this.updateFauxWidget(p);p.el.setAttribute("data-row",p.row)},canMoveWidget:function(q,s,p){var m=s==="up"?-1:1,t=q.row+m,n=t+m*(p||1),l=true,o;if(s==="up"){for(o=t;o>n;o--){this.forEachCol(q,function(r){if(this.isWidget(r,o)||this.isPlaceholderIn(r,o)){l=false;return true}}.bind(this));if(l){l=o}else{break}}}else{for(o=t+q.sizey-1;o<n+q.sizey-1;o++){this.forEachCol(q,function(r){if(this.isWidget(r,o)||this.isPlaceholderIn(r,o)){l=false;return true}}.bind(this));if(l){l=o}else{break}}}return l},canMoveWidgetUpToRow:function(s,o,v){var t=this,w=true,n=[],m;this.forEachCol(s,function(l){n[l]=[];m=s.row;while(m--){if(t.isEmpty(l,m)&&!t.isPlaceholderIn(l,m)){n[l].push(m)}else{break}}if(!n[l].length){w=false;return true}});if(!w){return false}m=v;for(m=1;m<s.row;m++){var u=true;for(var q=0,p=n.length;q<p;q++){if(n[q]&&n[q].indexOf(m)===-1){u=false}}if(u===true){w=m;break}}return w},mutateWidget:function(q,p){var l=[],s=[],o=[],u=[],t=q.sizey,m=this.getCells(q),n=this.getCells(p);function r(x){var w=this,v=this.getWidgetsBelow(x);v.forEach(function(y){if(y.el!==x.el){w.moveWidgetUp(y,x.sizey)}})}m.cols.forEach(function(v){if(n.cols.indexOf(v)===-1){l.push(v)}});n.cols.forEach(function(v){if(m.cols.indexOf(v)===-1){s.push(v)}});m.rows.forEach(function(v){if(n.rows.indexOf(v)===-1){o.push(v)}});n.rows.forEach(function(v){if(m.rows.indexOf(v)===-1){u.push(v)}});this.removeFauxWidget(q);if(s.length){this.emptyCells({col:p.col,row:p.row,sizex:p.sizex,sizey:Math.min(q.sizey,p.sizey),el:q.el})}if(u.length){this.emptyCells(g.extend({el:q.el},p))}q.col=p.col;q.row=p.row;q.sizex=p.sizex;q.sizey=p.sizey;this.addFauxWidget(q);this.setData(q);if(l.length){r.call(this,{col:l[0],row:q.row,sizex:l.length,sizey:Math.min(t,q.sizey),el:q.el})}if(o.length){r.call(this,q)}this.moveWidgetUp(q)},emptyCells:function(m){var l=this.getWidgetsBelow({col:m.col,row:m.row-m.sizey,sizex:m.sizex,sizey:m.sizey});l.every(function(n){if(n.row>(m.row+m.sizey-1)){return true}if(n.el!==m.el){this.moveWidgetDown(n,m.row+m.sizey-n.row)}return true}.bind(this))},updateGridHeight:function(){var m=this.getLastRow();var l=m*this.minWidgetHeight;this.elements.container.setStyle("height",l)},getBreakpoint:function(n){var m,l=i.getPlatform();if(!n||!g.is(n,"string")){return}m=n.split(" ").reduce(function(p,o){o=o.split(":");p[o[0]]={col:+o[1],minSizex:+o[2],minSizey:+o[3]};return p},{});this.breakpoints=Object.keys(m);return m[l]&&g.merge({name:l},m[l])},getHighestEmptyRow:function(p){var n=this,m=true,o=[],l=1000;this.forEachCol(p,function(q){var r=n.gridmap[q],s=p.row+p.sizey;o[q]=[];while(--s>0){if(n.isWidget(q,s)&&!n.isPlayer(q,s)){if(r[s]!==p){break}}if(!n.isPlayer(q,s)){o[q].push(s)}if(s<l){l=s}}if(!o[q].length){m=false;return true}o[q].sort(function(u,t){return u-t})});return m?this.getValidRows(p,o,l):false},getValidRows:function(p,r,q){var l=p.row+p.sizey-1,t=q-1,s=false,n=[];function m(u){if(g.is(u,"array")&&u.indexOf(t)===-1){o=false}}while(++t<=l){var o=true;r.forEach(m);if(o){n.push(t);if(n.length===p.sizey){break}}}if(p.sizey===1){if(n[0]!==p.row){s=n[0]||false}}else{if(n[0]!==p.row){s=i.getConsecutiveNumbers(n,p.sizey)}}return s},isValidPosition:function(o,m,p,q){var l=true,n={sizey:o.sizey,sizex:o.sizex,col:m,row:p};if(m+o.sizex-1>this.cols){return false}if(q&&q<p+o.sizey-1){return false}this.forEachCell(n,function(r,s){if(this.isWidget(r,s)){l=false}}.bind(this));return l},getNextAvailablePosition:function(o){var q=this.gridmap,l=[],p,n,m,r;if(o.sizex>this.cols){o.sizex=this.cols}for(m=1,p=q.length;m<p;m++){for(r=1,n=q[m].length;r<=n;r++){if(this.isValidPosition(o,m,r)){l.push({col:m,row:r,sizey:o.sizey,sizex:o.sizex})}}}return l.length?e(l)[0]:false},parseData:function(o,l){var n={},m=o.el?o.el:(g.is(o,"element")?o:false);n.col=o.col||(m&&m.getData("col"));n.row=o.row||(m&&m.getData("row"));n.sizex=o.sizex||(m&&m.getData("sizex"));n.sizey=o.sizey||(m&&m.getData("sizey"));if(!l){n.sizex=Math.max((n.sizex||1),this.minSizex);n.sizey=(n.sizey!==1)?Math.max((n.sizey||1),this.minSizey):1}return n},setData:function(n,m){var l=n.el?n.el:n;m=g.is(m)?m:n;m.col&&l.setAttribute("data-col",m.col);m.row&&l.setAttribute("data-row",m.row);m.sizex&&l.setAttribute("data-sizex",m.sizex);m.sizey&&l.setAttribute("data-sizey",m.sizey)},isWidget:function(m,n){var l=this.gridmap[m];return l&&l[n]?l[n]:false},isEmpty:function(m,n){var l=this.gridmap[m];if(!l){return true}return l&&l[n]===false},isPlayerIn:function(m,n){var l=this.playerCells;return l&&l.cols.indexOf(m)>-1&&l.rows.indexOf(n)>-1},isPlaceholderIn:function(m,n){var l=this.placeholderCells;return l&&l.cols.indexOf(m)>-1&&l.rows.indexOf(n)>-1},isPlayer:function(l,n){if(n&&!this.gridmap[l]){return false}var m=n?this.gridmap[l][n]:l;return m&&(m.el===(this.player&&this.player.el))},forEachCol:function(m,n){for(var l=0;l<m.sizex;l++){n(m.col+l,m)}},forEachCell:function(l,m){this.forEachCol(l,function(n){for(var o=0;o<l.sizey;o++){m(n,l.row+o)}})},addStyleTag:function(n,m){var o=document,l=o.createElement("style");l.id="r2g-"+n;o.getElementsByTagName("head")[0].appendChild(l);l.setAttribute("type","text/css");if(l.styleSheet){l.styleSheet.cssText=m}else{l.appendChild(o.createTextNode(m))}},removeStyleTag:function(n){var m=b.getElement.call(document,"head");var l=m.getElement("style#r2g-"+n);if(l){l.remove();d[n]=false}},findWidget:function(q,p,n){p||(p=this.widgets);if(q.row&&q.col&&q.el){return q}for(var o=0,m=p.length;o<m;o++){if(q===p[o].el){return n?{wdg:p[o],idx:o}:p[o]}}},createFauxGrid:function(){this.fauxGrid=[];this.gridmap=[];for(var l=this.cols;l>0;l--){this.gridmap[l]=[];for(var m=this.rows;m>0;m--){this.addFauxCell(m,l)}}},addFauxWidget:function(n,m,l){this.updateFauxWidget(n,m);if(l){this.getWidgetsBelow(n).forEach(function(o){this.moveWidgetUp(o)}.bind(this))}},removeFauxWidget:function(l){this.updateFauxWidget(l,false)},updateFauxWidget:function(m,l){var n=this.gridmap;this.forEachCell(m,function(o,p){if(!n[o]){return}n[o][p]=(typeof l==="undefined"?m:l)})},addFauxCell:function(n,l){var m={x:this.baseX+(l-1)*this.minWidgetWidth,y:this.baseY+(n-1)*this.minWidgetHeight,width:this.minWidgetWidth,height:this.minWidgetHeight,col:l,row:n};m.x1=m.x+m.width/2;m.y1=m.y+m.height/2;m.x2=m.x+m.width;m.y2=m.y+m.height;if(!this.gridmap[l][n]){this.gridmap[l][n]=false}this.fauxGrid.push(m)},addFauxRows:function(n){var l=this.rows+(n||1),o,m;for(o=l;o>this.rows;o--){for(m=this.cols;m>=1;m--){this.addFauxCell(o,m)}}this.rows=l;this.createStylesheet()},updateFauxGrid:function(){var l=this.fauxGrid.slice(0);this.fauxGrid=[];l.forEach(function(m){this.addFauxCell(m.row,m.col)}.bind(this))},getCells:function(n){var l={cols:[],rows:[]},m;for(m=0;m<n.sizex;m++){l.cols.push(n.col+m)}for(m=0;m<n.sizey;m++){l.rows.push(n.row+m)}return l},getCoords:function(m){var n=this.options.margins,l={x:this.baseX+(m.col-1)*this.minWidgetWidth,y:this.baseY+(m.row-1)*this.minWidgetHeight,width:this.widgetWidth*m.sizex+(m.sizex-1)*n[0]*2,height:this.widgetHeight*m.sizey+(m.sizey-1)*n[1]*2};g.extend(l,m);l.x1=l.x+l.width/2;l.y1=l.y+l.height/2;l.x2=l.x+l.width;l.y2=l.y+l.height;return l},findCollisions:function(t){var o=this.fauxGrid.length,p=[],n;function m(w,v){var u=false,z=false;if((v.x>=w.x&&v.x<=w.x2)||(v.x2>=w.x&&v.x2<=w.x2)||(w.x>=v.x&&w.x2<=v.x2)){u=true}if((v.y>=w.y&&v.y<=w.y2)||(v.y2>=w.y&&v.y2<=w.y2)||(w.y>=v.y&&w.y2<=v.y2)){z=true}return(u&&z)}function q(v,u){var x="",w="";if(v.y>u.y1&&v.y<=u.y2){x="N"}if(v.y2>=u.y&&v.y2<u.y1){x="S"}if(v.x>u.x1&&v.x<=u.x2){w="W"}if(v.x2>=u.x&&v.x2<u.x1){w="E"}return(x+w)||"C"}function s(w,v){var u=Math.max(w.x,v.x),B=Math.max(w.y,v.y),z=Math.min(w.x2,v.x2),A=Math.min(w.y2,v.y2);return{width:(z-u),height:(A-B)}}while(o--){var r,l;n=this.fauxGrid[o];if(m(t,n)){r=q(t,n);if(r==="C"){l=s(t,n);l=l.width*l.height;p.push({area:l,region:r,coords:n,el:n.el})}}}return p},getClosestColliders:function(l){return this.findCollisions(l).sort(function(n,m){if(n.coords.y1<m.coords.y1||n.coords.x1<m.coords.x1){return -1}return 1})},getWidgetsOverlapping:function(q,m){var p=this,l=this.getCells(q),r=this.gridmap,o=[],n=[];l.cols.forEach(function(s){l.rows.forEach(function(u){if(!r[s]){return true}var t=r[s][u];if(p.isWidget(s,u)&&(!m&&!p.isPlayer(s,u)||m)&&n.indexOf(t)===-1){o.push(t);n.push(t)}})});return o},getWidgetsConstraints:function(n){var l=[],m=[];n.forEach(function(o){var p=this.getHighestEmptyRow(o);if(p){l.push({wdg:o,row:p})}else{m.push(o)}}.bind(this));return{canGoUp:j(l),cantGoUp:a(m)}},canPlayerGoUp:function(p){var o=this,r=p.row+p.sizey,n=true,q=[],m=-Infinity,l=-Infinity;this.forEachCol(p,function(t){var s=r;q[t]=[];while(--s>0){if(o.isEmpty(t,s)){q[t].push(s);if(s<p.row&&s>l){l=s;m=s}m=m-s<2?s:m}}if(q[t].length===0||(p.row-l>1)){n=false;return true}q[t].sort(function(v,u){return v-u})});if(!n){return false}return this.getValidRows(p,q,m)},add:function(m){var l,o,n;l=this.parseWidgetsOption(m);o=this.parseOriginalWidgets(l);if(!o.col||!o.row){n=this.getNextAvailablePosition(o);g.extend(o,n)}else{this.emptyCells(o)}this.originalWidgets.push(l);this.widgets.push(o);this.registerWidget(o);this.addFauxRows(o.sizey);if(this.options.fit){this.fit()}this.updateGridHeight()},remove:function(m){var o,l,n;o=this.findWidget(m.widget,this.widgets,true);l=this.findWidget(m.widget,this.originalWidgets,true);if(!o||!l){return this}this.originalWidgets.splice(l.idx,1);o=this.widgets.splice(o.idx,1)[0];if(!m.silent){n=this.getWidgetsBelow(o)}!m.prevent&&this.removeFauxWidget(o);o.el.remove();if(!m.silent){n.forEach(function(p){this.moveWidgetUp(p,o.sizey)}.bind(this))}if(m.callback){m.callback.call(this,o.el)}if(this.options.fit){this.fit()}this.updateGridHeight();return this},resize:function(o){var m=o.sizex,l=o.sizey,n=o.col,p=this.findWidget(o.widget);if(!p){return}m||(m=p.sizex);l||(l=p.sizey);n||(n=p.col);if(this.options.maxSize[0]){m=Math.min(m,this.options.maxSize[0]-n+1)}if(!this.options.fit&&this.options.maxSize[1]){l=Math.min(l,this.options.maxSize[1])}if(l>p.sizey){this.addFauxRows(Math.max(l-p.sizey,0))}this.mutateWidget(p,{col:n,row:p.row,sizex:m,sizey:l});if(!o.silent){this.options.fit&&this.fit();this.dispatchEvent("onResize");this.updateGridHeight()}return p},update:function(n){var l,m=document.documentElement.clientWidth;if(this.options.viewport){l=this.options.viewport.getSize().height}else{l=document.documentElement.clientHeight}if(n||m!==this.clientWidth||l!==this.viewportHeight){this.clientWidth=m;this.viewportHeight=l;this.setupGrid(true);this.createStylesheet();this.updateFauxGrid();if(this.options.fit){this.fit()}this.updateGridHeight()}return this},serialize:function(){var l=[];this.originalWidgets.forEach(function(m){var n=this.findWidget(m.el),o;if(!n){return false}if(this.breakpoint){o=g.extend({},m);o[this.breakpoint.name]=g.extend({},n);delete o[this.breakpoint.name].el;delete o.row;delete o.col;delete o.sizex;delete o.sizey}else{o=g.extend({},n)}delete o.el;if(this.options.serialize){o=this.options.serialize(n.el,o)}o&&l.push(o)}.bind(this));return l},toggle:function(l){if(!this.events.drag||!this.events.resize){return}if(!g.is(l)){l=!this.events.drag.disabled}this.events.drag.disabled=l;this.events.resize.disabled=l;return this},destroy:function(){var l=this.options.namespace?this.options.namespace:"default";if(this.events.drag&&this.events.resize){this.events.drag.destroy();this.events.resize.destroy()}if(this.events.window){i.removeEvent(window,"resize",this.events.window)}if(l!=="default"){this.removeStyleTag(l)}this.widgets=null;this.originalWidgets=null;this.fauxGrid=null;this.gridmap=null;this.elements=null;this.player=null;this.resized=null;this.playerCells=null;this.placeholderCells=null;this.placeholder&&this.placeholder.el&&this.placeholder.el.remove();this.placeholder=null;this.options=null;this.events=null;this.breakpoint=null;this.breakpoints=null;this.resizeTemplate=null}};return h.extend(f)});define("DS/UWPClientControls/LazyLoader",["UWA/Core","DS/UWPClientControls/Utils"],function(f,c){var d,m,s,q,l,b,a,n,r,g,e,k=true;function p(t,y){var v=t.scrollHeight,x=t.scrollWidth,u=window.requestAnimationFrame(w);function w(){window.cancelAnimationFrame(u);if(v!==t.scrollHeight||x!==t.scrollWidth){y()}v=t.scrollHeight;x=t.scrollWidth;u=requestAnimationFrame(w)}}function i(u,t){c[u+"Event"](window,"resize",b);if(!q){c[u+"Event"](window,"resize",l);c[u+"Event"](t,"scroll",l);p(t,l)}}function o(u){var t,v;if(r){for(t=0;t<m.length;t++){v=m[t];if(j(v.element,u)&&v.element.offsetWidth>0&&v.element.offsetHeight>0&&e<d.maxSimultaneous){s.load(v);t--}}}if(g){for(t=0;t<m.length;t++){v=m[t];if(e<d.maxSimultaneous){s.load(v);t--}}}if(m.length===0){s.destroy()}}function j(t,v){if(Array.isArray(v)){return v.map(function(x){return x.isIntersecting&&x.target}).indexOf(t)>-1}var u=t.getBoundingClientRect(),w=a+d.offset;return(u.left<=n+d.offset&&u.right>=0&&(u.top>=0&&u.top<=w||u.bottom<=w&&u.bottom>=0-d.offset))}function h(){a=window.innerHeight||document.documentElement.clientHeight;n=window.innerWidth||document.documentElement.clientWidth}s={defaultOptions:{mode:"viewport",loadedEvent:"load",loadedEventTarget:undefined,maxSimultaneous:Infinity,offset:0,scrollTarget:window},init:function(t){if(k){d=f.merge(t||{},this.defaultOptions);k=false;m=[];e=0;r=["viewport","viewport-queue"].indexOf(d.mode)!==-1;g=["queue","viewport-queue"].indexOf(d.mode)!==-1;if(r){if(typeof IntersectionObserver!=="undefined"){q=new IntersectionObserver(o,{root:d.scrollTarget instanceof Element?d.scrollTarget:undefined})}l=c.debounce(o,200);b=c.throttle(h,50);i("add",d.scrollTarget);h()}}},load:function(u){var t=m.indexOf(u);if(t===-1){return}e++;setTimeout(u.callback());m.splice(t,1)},revalidate:function(){o()},track:function(u){var v;if(d.loadedEvent){v=u.element.getElement(d.loadedEventTarget)||u.element;c.addEvent(v,d.loadedEvent,function t(w){e--;c.removeEvent(w.target,w.type,t);q&&q.unobserve(u.element);w.stopPropagation();d.onLoad&&d.onLoad(w,u)})}q&&q.observe(u.element);m.push(u);if(d.sorter){m.sort(d.sorter)}if(d.forceLoad){d.forceLoad(u,function(){s.load(u)})}},untrack:function(u){var t=m.map(function(v){return v.element}).indexOf(u);if(t>-1){m.splice(t,1)}q&&q.unobserve(u);if(m.length===0){s.destroy()}},destroy:function(){if(d&&d.scrollTarget){i("remove",d.scrollTarget)}if(m){m.length=0}if(q){q.disconnect();q=null}k=true}};return s});define("DS/UWPClientControls/Modal",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils/Client","UWA/Controls/Abstract","UWA/Controls/Drag","UWA/Controls/Input","UWA/Utils","DS/UWPClientControls/ModalManager"],function(c,a,k,b,d,j,f,g,i){function e(n,l,m,r){var q=["webkit","moz","MS","o",""];for(var o=0;o<q.length;o++){if(!q[o]){m=m.toLowerCase()}l[n+"EventListener"](q[o]+m,r,false)}}var h=d.extend({MAIN_CLASS:"wp-modal",defaultOptions:{className:"",display:false,destroy:false,displayHeader:true,displayFooter:true,overlay:true,closable:false,clickToClose:false,resizable:false,draggable:false,modal:true,maximizable:false,animate:true},init:function(l){this._parent(l);this.isVisible=false;this.isMaximized=false;this.options.draggable=this.options.draggable&&this.options.displayHeader;this.options.resizable=this.options.draggable&&this.options.resizable;this.options.clickToClose=this.options.overlay&&this.options.clickToClose;this.options.animate=b.Features.cssTransitions&&this.options.animate;this.handlers={};this.buttons=[];this.keyHandler=this.getKeyHandler();if(l.display){this.show()}},setTitle:function(l){if(this.elements.title){this.elements.title.setText(l)}},setBody:function(l){if(this.elements.body){this.elements.body.setContent(l)}},getKeyHandler:function(){var l=this;return function(o){var n=k.whichKey(o),m=l.handlers[n];if(typeof m==="function"){m(o)}}},buildSkeleton:function(){var o=this,n=c.createElement,q=document,p=this.elements,l=this.options,m=this.MAIN_CLASS+" "+l.className;if(p.container){return}p.overlay=q.getElementById(this.MAIN_CLASS+"-overlay");if(l.draggable){m+=" "+this.MAIN_CLASS+"-draggable"}p.container=n("div",{"class":m});p.wrapper=n("div",{"class":this.MAIN_CLASS+"-wrap"}).inject(p.container);p.content=n("div",{"class":this.MAIN_CLASS+"-content"}).inject(p.wrapper);p.header=n("div",{"class":this.MAIN_CLASS+"-header",html:{tag:"h1","class":this.MAIN_CLASS+"-text"}}).inject(p.content);p.body=n("div",{"class":this.MAIN_CLASS+"-body"}).inject(p.content);p.footer=n("div",{"class":this.MAIN_CLASS+"-footer"}).inject(p.content);p.title=p.header.getElement("h1");if(l.maximizable||l.closable){p.buttons=n("div",{"class":this.MAIN_CLASS+"-buttons"}).inject(p.header,"top");if(l.maximizable){n("button",{"class":this.MAIN_CLASS+"-button wp-icon-maximize",events:{click:function(){o.toggleMaximize()}}}).inject(p.buttons,"top")}if(l.closable){n("button",{"class":this.MAIN_CLASS+"-button wp-svg-delete",events:{click:function(){o.hide()}}}).inject(p.buttons,"top")}}if(!l.displayHeader){p.header.hide()}if(!l.displayFooter){p.footer.hide()}if(l.animate){p.container.addClassName("animate")}if(l.buttons){this.addButtons(l.buttons)}if(l.modal){i.register(this)}this.setTitle(l.title);this.setBody(l.content);if(l.renderTo){a.inject.call(p.container,l.renderTo)}else{a.inject.call(p.container,q.body)}if(l.overlay){if(!p.overlay){p.overlay=n("div",{"class":this.MAIN_CLASS+"-overlay",id:this.MAIN_CLASS+"-overlay"});if(l.animate){p.overlay.addClassName("animate")}q.body.appendChild(p.overlay)}}},addButton:function(n){var o=this.elements,m=n.context||this,l;if(o.container){l=new f.Button({className:(typeof n.className!=="undefined")?n.className:"",value:(typeof n.value!=="undefined")?n.value:"",events:n.handler?{onClick:function(p){n.handler.call(m,p)}}:{}});if(n.handler&&n.key){this.handlers[n.key]=n.handler.bind(m)}n.element=l;this.buttons.push(n);l.inject(o.footer);return l}},addButtons:function(m){var l=this;if(c.is(m,"array")){return m.map(function(n){return l.addButton(n)})}else{return l.addButton(m)}},getButtonIndex:function(m){var l=-1,o=this.buttons;if(this.elements.container){if(typeof m==="string"){for(var n=o.length-1;n>=0;n--){if(o[n].value===m){l=n;break}}}else{if(typeof m==="number"){if(o[m]){l=m}}}return l}},getButton:function(m){var l=this.getButtonIndex(m);if(l!==-1){return this.buttons[l].element}},removeButton:function(m){var l=this.getButtonIndex(m),n=this.buttons;if(l!==-1){n[l].element.destroy();n.splice(l,1)}},attachEvents:function(){var n=this,l=this.options,o=this.elements,m;if(l.draggable){this.attachDragEvent()}if(l.clickToClose){m=l.draggable?o.overlay:o.container;m.addEvent("click",function(q){var p=k.getElement(q);if(p&&(p.hasClassName(n.MAIN_CLASS)||p.hasClassName(n.MAIN_CLASS+"-overlay"))){n.hide()}})}a.addEvent.call(document.body,"keydown",this.keyHandler)},removeEvents:function(){var l=this.options,n=this.elements,m;if(l.draggable){this.drag.destroy()}if(l.clickToClose){m=l.draggable?n.overlay:n.container;m.removeEvent("click")}a.removeEvent.call(document.body,"keydown",this.keyHandler)},attachDragEvent:function(){var m=this,l,o={x:0,y:0},n="."+this.MAIN_CLASS+"-header, ."+this.MAIN_CLASS+"-header > *";l=j.extend({call:function(r,p){var q=this.options[r];if(q){return g.attempt(q,0,null,this.context,p)}},start:function(p){this._parent(p);this.context=Object.create(this);this.call("start")},move:function(p,q){this._parent(p,q);this.call("move")}});this.drag=new l({delegate:n,document:document,start:function(){o.x=parseFloat(m.elements.container.getStyle("left"));o.y=parseFloat(m.elements.container.getStyle("top"));m.elements.container.setStyles({left:o.x,top:o.y})},move:function(p){m.elements.container.setStyles({left:p.currentDelta.x+o.x,top:p.currentDelta.y+o.y})}})},toggleMaximize:function(){var l=this.options,n=this.elements,m;if(n.container){if(l.maximizable&&this.isMaximized){if(l.draggable){this.drag.attach();m=n.header.getElement(".wp-icon-minimize");m.removeClassName("wp-icon-minimize");m.addClassName("wp-icon-maximize");n.container.setStyles({top:this.minimizedPosition.top,left:this.minimizedPosition.left});n.container.addClassName(this.MAIN_CLASS+"-draggable")}n.container.removeClassName(this.MAIN_CLASS+"-maximized");this.dispatchEvent("onMinimize");this.isMaximized=false}else{if(l.maximizable&&!this.isMaximized){if(l.draggable){this.drag.detach();m=n.header.getElement(".wp-icon-maximize");m.removeClassName("wp-icon-maximize");m.addClassName("wp-icon-minimize");this.minimizedPosition={left:parseFloat(n.container.getStyle("left")),top:parseFloat(n.container.getStyle("top"))};n.container.setStyles({top:"",left:""});n.container.removeClassName(this.MAIN_CLASS+"-draggable")}n.container.addClassName(this.MAIN_CLASS+"-maximized");this.dispatchEvent("onMaximize");this.isMaximized=true}}}},destroy:function(){var m=this,l=this.options,n=this.elements;l.destroy=false;if(l.animate&&this.hidding){this.destroyed=true}else{if(n.container){this.destroyed=false;this.hide(function(){i.unregister(m);n.container.destroy();delete m.elements})}this.handlers=null;this.buttons=null;this.keyHandler=null}},show:function(){var n=this,o=this.elements,l=this.options,m;if(!o.container){this.buildSkeleton()}if(l.overlay){o.overlay.addClassName("visible")}if(l.modal){a.addClassName.call(document.body,this.MAIN_CLASS+"-open");m=i.getActive();if(m){this.previousModal=m;m.display(false,function(){n.display(true)})}else{this.display(true)}}else{this.display(true)}},hide:function(p){var n=this,o=this.elements,l=this.options;function m(){if(l.overlay&&(!n.previousModal||!n.previousModal.elements||!n.previousModal.options.overlay)){o.overlay.removeClassName("hidding");o.overlay.removeClassName("visible")}if(l.modal&&(!n.previousModal||!n.previousModal.elements||!n.previousModal.options.modal)){a.removeClassName.call(document.body,n.MAIN_CLASS+"-open")}if(typeof p==="function"){p()}if(l.destroy){n.destroy()}}if(o.container){if(l.overlay&&(!this.previousModal||!this.previousModal.elements||!this.previousModal.options.overlay)){if(l.animate){o.overlay.addClassName("hidding")}}this.display(false,function(){if(l.modal&&n.previousModal&&n.previousModal.elements){n.previousModal.display(true,m)}else{m()}})}},display:function(l,q){var o=this,n=this.options,p=this.elements;function m(){o.hidding=false;if(n.animate){e("remove",p.wrapper,"AnimationEnd",m)}if(o.isVisible){o.attachEvents();o.dispatchEvent("onShow");if(typeof q==="function"){q()}}else{p.container.removeClassName("hidding");p.container.removeClassName("visible");o.removeEvents();o.dispatchEvent("onHide");if(typeof q==="function"){q()}if(o.destroyed){o.destroy()}}}if(this.isVisible!==l){this.isVisible=l;if(n.animate){this.hidding=true;e("add",p.wrapper,"AnimationEnd",m)}if(this.isVisible){i.setActive(o,true);p.container.addClassName("visible")}else{i.setActive(o,false);p.container.addClassName("hidding")}if(!n.animate){m()}}else{if(typeof q==="function"){q()}if(this.destroyed){this.destroy()}}}});return h});define("DS/UWPClientControls/DockLayout/AbstractContainer",["UWA/Class","DS/UWPClientControls/DockLayout/Utils"],function(a,d){var c="Child unknown to element";function b(){throw new Error("Incomplete method of abstract class")}function f(g){if(!this.childExists(g)){throw new Error(c)}}var e=a.extend({init:function(){var g;Object.defineProperty(this,"manager",{get:function(){if(g){return g}var h=this,i=h;while(i.type!=="root"){i=i.container}return i.manager},set:function(h){g=h}});Object.defineProperty(this,"size",{get:function(){var h=this.manager.containersDimensions.get(this);if(!h){h={};this.manager.containersDimensions.set(this,h)}return h}});Object.defineProperty(this,"width",{get:function(){return this.size.width},set:function(h){this.size.width=h}});Object.defineProperty(this,"height",{get:function(){return this.size.height},set:function(h){this.size.height=h}})},childExists:b,addChild:b,removeChild:f,replaceChild:f,remove:function(){this.container.removeChild(this)},duplicate:function(j){var i=require("DS/UWPClientControls/DockLayout/RowOrColumn"),h=this.getRectangle(),l;var k=this.container,g=new i({type:(h.width<(this.isMinimized()?this.container&&this.container.type==="column"?this.heightCache:this.container.getRectangle().height:h.height))?"column":"row",container:this.container,weight:this.weight});this.weight=50;this.container=g;g.addChild(this);l=this.getCopy();g.addChild(l);k.replaceChild(this,g);if(j){this.manager.paint();this.manager.onChange("duplicate")}return l},getCopy:b,getGridCoordinates:function(){function h(i,j){return i.container.content.slice(0,i.container.content.indexOf(i)).map(function(k){return k.getMaxAlignedElementCount(j)}).reduce(function(l,k){return l+k},0)}if(!this.container){return{x:0,y:0}}var g=this.container.getGridCoordinates();if(this.container.type==="root"){return g}return{x:g.x+(this.container.isRow?h(this,"width"):0),y:g.y+(this.container.isColumn?h(this,"height"):0),}},getRectangle:function(){return this.container.getChildRectangle(this)},getChildRectangle:f,getMinSize:b,getMaxAlignedElementCount:b,updateSize:function(m){function l(p,r){var o=p.getContentSizeRelations(r),q=o.reduce(function(t,s){return t||s.factors.size===1&&s.factors.get(p)===1},false);if(!q){o.unshift({factors:d.toMap([[p,1]]),result:p[r]})}return o}function n(o,p){return Array.apply(null,Array(o)).map((0).valueOf,p)}function k(t){var s,q,r,o,w,p=t.length,u,v,x;t=t.slice().map(function(y){return y.slice()});for(s=0;s<p;++s){o=Math.abs(t[s][s]);w=s;for(q=s+1;q<p;++q){if(Math.abs(t[q][s])>o){o=Math.abs(t[q][s]);w=q}}u=t[w];t[w]=t[s];t[s]=u;for(q=s+1;q<p;++q){v=-t[q][s]/t[s][s];for(r=s;r<p+1;++r){if(s===r){t[q][r]=0}else{t[q][r]+=v*t[s][r]}}}}x=n(p,0);for(s=p-1;s>=0;--s){x[s]=t[s][p]/t[s][s];for(q=s-1;q>-1;--q){t[q][p]-=t[q][s]*x[s]}}return x}function j(o){var r=d.toMap([]),s=d.toMap([]),q=0,p=[];o.forEach(function(t){t.factors.forEach(function(v,u){if(!s.has(u)){r.set(q,u);s.set(u,q);++q}})});o.forEach(function(t){var u=n(q+1,0);t.factors.forEach(function(w,v){u[s.get(v)]=w});u[u.length-1]=t.result;p.push(u)});return{matrix:p,indexMapping:r}}var g=l(this,m),i=j(g),h=k(i.matrix);h.forEach(function(p,o){i.indexMapping.get(o)[m]=p});this.fixConstraintViolations(m)},updateRectangle:b,paint:function(){this.updateSize("width");this.updateSize("height");this.updateRectangle()},getDropTargets:b,dropItemAt:b,isMinimized:b,getContentSizeRelations:b,fixConstraintViolations:b,toJSON:function(){return{type:this.type,weight:this.weight,content:this.content}}});return e});define("DS/UWPClientControls/DockLayout/PlayerDragUtils",["DS/UWPClientControls/DockLayout/DropTargetIndicator","DS/UWPClientControls/DockLayout/Utils"],function(h,g){var e="dock-dragging",d,f,a,c;var b={dragStart:function(j){var p=j.event,m=j.manager,l=j.element,o=b.getEventClientX(p),n=b.getEventClientY(p),q=l?l.getOffsets():{x:0,y:0};f={x:o-q.x,y:n-q.y};a=[];for(var k=0;k<(typeof j.itemCount==="number"?j.itemCount:1);++k){a.push(new h({manager:m}))}j.onDrag&&j.onDrag();if(l){l.addClassName(e);l.setStyle("z-index",4)}m.paint();a.forEach(function(i){i.show()});b._updateDropIndicators(b._getSafeVisibleDropTarget({manager:m,x:o,y:n}))},drag:function(i){var n=i.event,j=i.manager,m=b.getEventClientX(n),k=b.getEventClientY(n),l=j.getRelativeCoordinates(m,k);b._updateDropIndicators(b._getSafeVisibleDropTarget({manager:j,x:m,y:k}));i.element&&i.element.setStyles({left:l.x-f.x,top:l.y-f.y})},dragStop:function(i){if(!f){return}var k=i.event,j=i.manager,l=b._getSafeVisibleDropTarget({manager:j,x:b.getEventClientX(k),y:b.getEventClientY(k)});i.onDrop&&i.onDrop(l);j.paint();j.onChange(i.changeEventName);this.dragCleanup({element:i.element})},dragCleanup:function(i){var j=(i||{}).element;(a||[]).forEach(function(k){k.remove()});if(j){j.removeClassName(e);j.setStyle("z-index","")}f=undefined;a=undefined;c=undefined},getEventClientX:function(i){return b._getEventClientPosition(i).x},getEventClientY:function(i){return b._getEventClientPosition(i).y},_getEventClientPosition:function(j){var i={x:j.clientX||((j.targetTouches||[])[0]||{}).clientX||d.x,y:j.clientY||((j.targetTouches||[])[0]||{}).clientY||d.y};d=i;return i},_getSafeVisibleDropTarget:function(j){var k=j.manager,i=k.element.getSize(),l=k.getRelativeCoordinates(j.x,j.y),m=g.clamp({x:l.x,minX:0,maxX:i.width-1,y:l.y,minY:0,maxY:i.height-1});c=k.getDropTargetAt(m.x,m.y)||c;return c},_updateDropIndicators:function(j){if(!j){return}var i=g.divideRectangle(j.indicatorRectangle,a.length);a.forEach(function(k,l){k.setRectangle(i[l])})}};return b});define("DS/UWPClientControls/DockLayout/Root",["DS/UWPClientControls/DockLayout/AbstractContainer","DS/UWPClientControls/DockLayout/DropTarget","DS/UWPClientControls/DockLayout/Utils"],function(c,a,b){var d=c.extend({init:function(e){this._parent();this.type="root";this.manager=e.manager;this.content=e.content||null},childExists:function(e){return this.content&&this.content===e},addChild:function(e){if(!this.content){this.content=e}else{throw new Error("Cannot add any new children to root")}},removeChild:function(e){this._parent(e);this.content=undefined},replaceChild:function(f,e){this._parent(f);this.content=e},remove:function(){throw new Error("Cannot remove root element")},duplicate:function(){throw new Error("Root cannot be duplicated")},getCopy:function(){throw new Error("Root cannot be copied")},getGridCoordinates:function(){if(!this.content){throw new Error("Cannot provide grid coordinates of empty root element")}return{x:0,y:0}},getRectangle:function(){return{left:0,top:0,width:this.width,height:this.height}},getChildRectangle:function(e){this._parent(e);return this.getRectangle()},getDropTargets:function(){var e;if(!this.content){e=this.getRectangle();return[new a({dropRectangle:e,indicatorRectangle:e,mousePolygon:[{x:e.left,y:e.top},{x:e.left+e.width,y:e.top},{x:e.left+e.width,y:e.top+e.height},{x:e.left,y:e.top+e.height}],container:this,name:"root",priority:0})]}return this.content.getDropTargets(1)},dropItemAt:function(f,e){if(f!=="root"){throw new Error("Unknown drop area")}this.addChild(e);e.container=this},updateRectangle:function(){this.content&&this.content.updateRectangle()},getMinSize:function(f){var e=this.content?this.content.getMinSize(f):0;if(f==="width"){return Math.max(this.manager.element.clientWidth,e)}else{return this.isMinimized()?e:Math.max(this.manager.element.clientHeight,e)}},getMaxAlignedElementCount:function(e){return this.content?this.content.getMaxAlignedElementCount(e):0},isMinimized:function(){return this.content&&this.content.isMinimized()},getContentSizeRelations:function(f){var e=[];e.push({factors:b.toMap([[this,1]]),result:this.getMinSize(f)});if(this.content){e.push({factors:b.toMap([[this.content,1],[this,-1]]),result:0})}return e.concat(this.content?this.content.getContentSizeRelations(f):[])},fixConstraintViolations:function(e){this.content&&this.content.fixConstraintViolations(e)}});return d});define("DS/UWPClientControls/DockLayout/Splitter",["UWA/Core","UWA/Class/View","DS/UWPClientControls/DockLayout/Utils","DS/UWPClientControls/DockLayout/PlayerDragUtils"],function(g,e,c,a){var b,f="dock-dragging";var d=e.extend({init:function(h){var i;this._parent();this.container=h.container;i=this.container.manager;this.thickness=i.sizes.splitter;this.isVertical=!!h.isVertical;this.isHorizontal=!this.isVertical;this.element=g.createElement("div",{"class":"dock-splitter "+(this.isVertical?"vertical":"horizontal")});this.element.dockSplitter=this;this.element.setStyle(this.isVertical?"width":"height",this.thickness);this.element.setStyle("position","absolute");this.element.onDragStart=this.onDragStart.bind(this);this.element.onDrag=this.onDrag.bind(this);this.element.onDragStop=this.onDragStop.bind(this);this.position={left:0,top:0};i.element.appendChild(this.element)},setLength:function(h){this.element.setStyle(this.isVertical?"height":"width",h)},setPosition:function(h){this.position=h;this.element.setStyles({left:h.left,top:h.top,})},setEnabled:function(h){var i="dock-splitter-disabled";this.enabled=h;if(this.enabled){this.element.removeClassName(i)}else{this.element.addClassName(i)}},remove:function(){this.element.remove()},onDragStart:function(i){var h=this.container.manager;if(!this.enabled||!h.enabled){return}b=h.getRelativeCoordinates(a.getEventClientX(i),a.getEventClientY(i));this.element.addClassName(f)},onDrag:function(i){if(!this.enabled||!this.container.manager.enabled||!b){return}var j=this.container,p=j.manager,u=this.thickness,n=j.splitters.indexOf(this),s,m,l,k,v,t,r,q,h,w,o;if(n===-1){throw new Error("Unknown splitter")}m=this.position;s=p.getRelativeCoordinates(a.getEventClientX(i),a.getEventClientY(i));v=j.content[n];t=j.content[n+1];r=v.getRectangle();q=t.getRectangle();h=v.getMinSize(this.isVertical?"width":"height");w=t.getMinSize(this.isVertical?"width":"height");l=c.clamp({x:s.x-u/2,minX:r.left-u/2+h,maxX:(q.left+q.width)-u/2-w,y:s.y-u/2,minY:r.top-u/2+h,maxY:(q.top+q.height)-u/2-w});k={left:this.isVertical?l.x:m.left,top:this.isHorizontal?l.y:m.top};this.setPosition(k);o=(v.weight+t.weight)*(j.isRow?(k.left-m.left)/(r.width+q.width):(k.top-m.top)/(r.height+q.height));v.weight+=o;t.weight-=o;j.paint()},onDragStop:function(){var h=this.container.manager;if(!this.enabled||!h.enabled||!b){return}h.onChange("resize");this.element.removeClassName(f);b=undefined}});return d});define("DS/UWPClientControls/DockLayout/RowOrColumn",["DS/UWPClientControls/DockLayout/AbstractContainer","DS/UWPClientControls/DockLayout/Splitter","DS/UWPClientControls/DockLayout/DropTarget","DS/UWPClientControls/DockLayout/Utils"],function(e,d,b,c){var f="row/column children must define a weight";var a=e.extend({init:function(g){this._parent();if(["row","column"].indexOf(g.type)===-1){throw new Error("Invalid type: "+g.type)}this.type=g.type||"row";this.isRow=this.type==="row";this.isColumn=!this.isRow;this.container=g.container;this.weight=g.weight;this.content=g.content||[];this.splitters=[]},_matchesItemFlowDirection:function(g){return g==="width"&&this.isRow||g==="height"&&this.isColumn},childExists:function(g){return this.content.length>0&&this.content.indexOf(g)>-1},addChild:function(m,h){var l,k,j,g=this.content.length;if(m.type===this.type){k=m.splitters.length;for(j=0;j<k;++j){m.removeSplitter(0)}l=m.getTotalChildrenWeight();m.content.forEach(function(n,i){n.weight*=m.weight/l;n.container=this;this.addChild(n,(typeof h==="number"?h:g)+i)},this);return}if(typeof h==="number"){this.content.splice(h,0,m)}else{this.content.push(m)}if(this.content.length>=2){this.addSplitter()}},removeChild:function(i){this._parent(i);var g=this.content.lastIndexOf(i),h;this.content.splice(g,1);if(this.splitters.length>0){this.removeSplitter(Math.min(g-1,0))}if(this.content.length===1){h=this.content[0];h.container=this.container;h.weight=this.weight;this.container.replaceChild(this,h)}},duplicate:function(){return this._parent.apply(this,arguments)},getCopy:function(){var g=new a({type:this.type,container:this.container,weight:this.weight});this.content.forEach(function(i){var h=i.getCopy();g.addChild(h);h.container=g});return g},getGridCoordinates:function(){return this._parent.apply(this,arguments)},replaceChild:function(i,h){this._parent(i);var g=this.content.indexOf(i);this.addChild(h,g);this.removeChild(i)},addSplitter:function(){this.splitters.push(new d({container:this,isVertical:this.isRow}))},removeSplitter:function(g){if(g>=this.splitters.length){throw new Error("Unknown splitter index: "+g)}var h=this.splitters.splice(g,1)[0];h.remove()},getTotalChildrenWeight:function(){return this.content.map(function(g){if(!("weight" in g)){throw new Error(f)}return g.weight}).reduce(function(g,h){return g+h},0)},getChildRectangle:function(i){this._parent.apply(this,arguments);var h=this.getRectangle(),g=this.content.slice(0,this.content.indexOf(i)).reduce((function(j,k){return j+k[this.isRow?"width":"height"]}).bind(this),0);return{left:h.left+(this.isRow?g:0),top:h.top+(this.isColumn?g:0),width:i.width,height:i.height}},_makeDropTarget:function(k,o){var j=20,p=this.manager.sizes.splitter,m,l,g,h,n;m=this.getRectangle();l={left:m.left+p/2,top:m.top+p/2,width:m.width-p,height:m.height-p};function i(r,q){switch(k){case"top":return{left:m.left,top:m.top,width:m.width,height:q};case"right":return{left:m.left+m.width-r,top:m.top,width:r,height:m.height};case"bottom":return{left:m.left,top:m.top+m.height-q,width:m.width,height:q};case"left":return{left:m.left,top:m.top,width:r,height:m.height}}}g=i(j,j);h=i(this.isRow?m.width/(this.content.length+1):m.width/2,this.isColumn?m.height/(this.content.length+1):m.height/2);n=(function(){switch(k){case"top":return[{x:l.left,y:m.top},{x:l.left+j,y:m.top+j},{x:l.left+l.width-j,y:m.top+j},{x:l.left+l.width,y:m.top}];case"right":return[{x:m.left+m.width,y:l.top},{x:m.left+m.width-j,y:l.top+j},{x:m.left+m.width-j,y:l.top+l.height-j},{x:m.left+m.width,y:l.top+l.height}];case"bottom":return[{x:l.left+l.width,y:m.top+m.height},{x:l.left+l.width-j,y:m.top+m.height-j},{x:l.left+j,y:m.top+m.height-j},{x:l.left,y:m.top+m.height}];case"left":return[{x:m.left,y:l.top+l.height},{x:m.left+j,y:l.top+l.height-j},{x:m.left+j,y:l.top+j},{x:m.left,y:l.top}]}}());return new b({dropRectangle:h,indicatorRectangle:g,mousePolygon:n,container:this,name:k,priority:o})},getDropTargets:function(g){if(typeof g==="undefined"){g=1}return["top","right","bottom","left"].map(function(h){return this._makeDropTarget(h,g)},this).concat(this.content.map(function(h){return h.getDropTargets(g+1)}).reduce(function(h,i){return h.concat(i)},[]))},dropItemAt:function(l,i){var j=["left","right"].indexOf(l)!==-1?"width":"height",g=this.getMaxAlignedElementCount(j),h,k;if(this._matchesItemFlowDirection(j)){i.weight=this.getTotalChildrenWeight()/g;i.container=this;this.addChild(i,["left","top"].indexOf(l)!==-1&&0)}else{h=new a({type:this.isRow?"column":"row",container:this.container,weight:this.weight});k=this.container;this.container=i.container=h;h.addChild(this);h.addChild(i,["left","top"].indexOf(l)!==-1&&0);this.weight=10*g;i.weight=10;k.replaceChild(this,h)}},updateRectangle:function(){var g,h=this.getRectangle();this.content.forEach(function(l,j){var k,i=this.getChildRectangle(l);if(j>0){k=this.splitters[j-1];k.setLength(h[this.isRow?"height":"width"]);k.setPosition({top:i.top-(this.isColumn?k.thickness/2:0),left:i.left-(this.isRow?k.thickness/2:0)});k.setEnabled(this.isRow||!(g.isMinimized()||l.isMinimized()))}l.updateRectangle();g=l},this)},_applyNestedDimensionalNumberComputation:function(h,g){if(this._matchesItemFlowDirection(h)){return this.content.reduce(function(i,j){return i+j[g](h)},0)}else{return c.max(this.content.map(function(i){return i[g](h)}))}},getMinSize:function(g){return this._applyNestedDimensionalNumberComputation(g,"getMinSize")},getMaxAlignedElementCount:function(g){return this._applyNestedDimensionalNumberComputation(g,"getMaxAlignedElementCount")},isMinimized:function(){return this.content.reduce(function(g,h){return g&&h.isMinimized()},true)},getContentSizeRelations:function(i){var g=[],h;this.content.forEach(function(j){if(i==="height"&&j.isMinimized()){g.push({factors:c.toMap([[j,1]]),result:j.getMinSize("height")})}else{if(h){if(this._matchesItemFlowDirection(i)){g.push({factors:c.toMap([[h,1],[j,-h.weight/j.weight]]),result:0})}else{g.push({factors:c.toMap([[h,1],[j,-1]]),result:0})}}h=j}},this);if(this._matchesItemFlowDirection(i)){if(!(i==="height"&&this.isMinimized())){g.push({factors:c.toMap(this.content.map(function(j){return[j,1]}).concat([[this,-1]])),result:0})}}else{if(h){g.push({factors:c.toMap([[h,1],[this,-1]]),result:0})}}return[].concat.apply(g,this.content.map(function(j){return j.getContentSizeRelations(i)}))},fixConstraintViolations:function(l){var n=c.toMap([]),m=0,h;function g(o){return o[l]-o.getMinSize(l)}function j(o,p){o[l]=o.getMinSize(l)+p;n.set(o,true)}function i(q){if(g(q)<=0){return}var o=g(q),p=Math.min(g(q),m*q.weight/k);j(q,o-p);h+=p}this.content.forEach(function(p){var o=g(p);if(o<0){m-=o;j(p,0)}},this);if(this._matchesItemFlowDirection(l)){do{h=0;var k=this.content.reduce(function(o,p){return g(p)>0?o+p.weight:o},0);this.content.forEach(i);m-=h}while(h>0);if(m>0){j(this,g(this)-m)}}this.content.forEach(function(p){if(!(l==="height"&&p.isMinimized())){var o=n.has(p)||n.has(this.content);o&&p.updateSize(l);p.fixConstraintViolations(l)}},this)}});return a});define("DS/UWPClientControls/DockLayout/Item",["UWA/Core","DS/UWPClientControls/DockLayout/AbstractContainer","DS/UWPClientControls/DockLayout/RowOrColumn","DS/UWPClientControls/DockLayout/DropTarget","DS/UWPClientControls/DockLayout/Utils","DS/UWPClientControls/DockLayout/PlayerDragUtils"],function(c,e,g,h,d,f){var a={MINIMIZED:"dock-minimized",MAXIMIZED:"dock-maximized"},i={DEFAULT:"default",MINIMIZED:"minimized",MAXIMIZED:"maximized"};var b=e.extend({init:function(j){this._parent();this.type="item";this.content=j.content;this.container=j.container;this.weight=j.weight;this.view=i.DEFAULT;this.element=c.extendElement(this.manager.leafReviver(this.content));this.element.addClassName("dock-item");Object.keys(a).forEach(function(k){if(this.element.hasClassName(a[k])){this.view=i[k]}},this);this.element.onDragStart=this.onDragStart.bind(this);this.element.onDrag=this.onDrag.bind(this);this.element.onDragStop=this.onDragStop.bind(this);this.element.dockItem=this;if(!this.manager.element.contains(this.element)){this.manager.element.appendChild(this.element)}},swapElement:function(j){var k=this.element;this.element=j;j.dockItem=this;j.onDragStart=k.onDragStart;j.onDrag=k.onDrag;j.onDragStop=k.onDragStop;j.setAttribute("style",k.getAttribute("style"));[].forEach.call(k.classList,function(l){if(l.indexOf("dock-")===0){j.classList.add(l)}})},childExists:function(){throw new Error("Item cannot contain children")},addChild:function(){throw new Error("Cannot add child to item")},removeChild:function(){throw new Error("Cannot remove child from item")},replaceChild:function(){throw new Error("Cannot swap child it item")},remove:function(j){this._parent();if(this.manager.maximizedItem===this){this.manager.maximizedItem=null}if(j){this.element.remove();this.manager.paint();this.manager.onChange("remove")}},duplicate:function(){return this._parent.apply(this,arguments)},getCopy:function(){return new b({content:this.content,container:this.container,weight:this.weight})},getGridCoordinates:function(){return this._parent.apply(this,arguments)},getChildRectangle:function(){throw new Error("Item has no children")},_makeDropTarget:function(l){var n,o,k,m=this,j=m;n=this.getRectangle();while(j&&j.type!=="root"&&j.isMinimized()){j=j.container}if(j!==this&&!j.isColumn){n.height=j.isRow?j.getRectangle().height:Math.max(this.manager.element.clientHeight,this.manager.sizes.minItemHeight)}o=(function(){switch(l){case"top":return{left:n.left,top:n.top,width:n.width,height:n.height/2};case"right":return{left:n.left+n.width/2,top:n.top,width:n.width/2,height:n.height};case"bottom":return{left:n.left,top:n.top+n.height/2,width:n.width,height:n.height/2};case"left":return{left:n.left,top:n.top,width:n.width/2,height:n.height}}}());k=(function(){switch(l){case"top":return[{x:n.left,y:n.top},{x:n.left+n.width,y:n.top},{x:n.left+n.width/2,y:n.top+n.height/2}];case"right":return[{x:n.left+n.width,y:n.top},{x:n.left+n.width,y:n.top+n.height},{x:n.left+n.width/2,y:n.top+n.height/2}];case"bottom":return[{x:n.left+n.width,y:n.top+n.height},{x:n.left,y:n.top+n.height},{x:n.left+n.width/2,y:n.top+n.height/2}];case"left":return[{x:n.left,y:n.top+n.height},{x:n.left,y:n.top},{x:n.left+n.width/2,y:n.top+n.height/2}]}}());return new h({dropRectangle:o,indicatorRectangle:o,mousePolygon:k,container:this,name:l,priority:0,})},getDropTargets:function(){return["top","right","bottom","left"].map(this._makeDropTarget.bind(this))},dropItemAt:function(m,k){var l,j=new g({type:["top","bottom"].indexOf(m)!==-1?"column":"row",container:this.container,weight:this.weight});l=this.container;this.container=k.container=j;this.weight=k.weight=50;j.addChild(this);j.addChild(k,["left","top"].indexOf(m)!==-1&&0);l.replaceChild(this,j)},updateRectangle:function(){var j=this.getRectangle(),k=this.manager.element;if(this.view===i.MAXIMIZED){this.element.setStyles({position:"absolute","z-index":3,left:k.clientLeft,top:k.clientTop,width:k.clientWidth,height:k.clientHeight})}else{this.element.setStyles({position:"absolute","z-index":0,left:j.left,top:j.top,width:j.width,height:j.height})}},getMinSize:function(j){return this.manager.sizes[j==="width"?"minItemWidth":this.isMinimized()?"minimizedItemHeight":"minItemHeight"]},getMaxAlignedElementCount:function(){return 1},isMinimized:function(){return this.view===i.MINIMIZED},_toggleViewMode:function(j){if(this.view===i[j]){this.view=i.DEFAULT;this.element.removeClassName(a[j])}else{this.view=i[j];this.element.addClassName(a[j])}},toggleMinimize:function(){this._toggleViewMode("MINIMIZED")},toggleMaximize:function(){this._toggleViewMode("MAXIMIZED");this.manager.maximizedItem=this.view===i.MAXIMIZED?this:null},onDragStart:function(j){f.dragStart({event:j,manager:this.manager,element:this.element,onDrag:(function(){this.remove()}).bind(this)})},onDrag:function(j){f.drag({event:j,manager:this.manager,element:this.element})},onDragStop:function(j){f.dragStop({event:j,manager:this.manager,element:this.element,changeEventName:"reorder",onDrop:(function(k){if(k){k.container.dropItemAt(k.name,this)}else{this.manager.restoreState(true)}}).bind(this)})},getContentSizeRelations:function(){return[]},fixConstraintViolations:function(){return}});return b});define("DS/UWPClientControls/DropdownMenu",["UWA/Core","UWA/Event","UWA/Utils","UWA/String","UWA/Controls/Abstract","DS/UWPClientControls/ClickRemover"],function(h,a,e,d,g,f){function c(j,o,n){for(var m=0,k=j.length;m<k;m++){if(n&&j[m].items){return c(j[m],o,false)}else{if(o!==undefined&&o.nodeType&&o===j[m].el){return j[m]}else{if(o!==undefined&&o.name===j[m].name){return j[m]}else{if(o!==undefined&&h.is(o,"string")&&o===j[m].name){return j[m]}}}}}}var b=g.extend({MAIN_CLASS:"wp-menu",defaultOptions:{position:{}},init:function(k){var n=this,m,j;n._parent(k);if(h.is(k.target,"element")){this.isSectionEnabled=h.is(k.sections,"array");this.isVisible=false;this.id=e.getUUID();this.items=[];this.sections=[];this.elements.target=k.target;if(this.isSectionEnabled){for(m=0,j=k.sections.length;m<j;m++){this.addSection(k.sections[m])}}else{for(m=0,j=k.items.length;m<j;m++){this.addItem(k.items[m])}}k.target.addEvent("click",function(i){a.preventDefault(i);n.dispatchEvent("onTargetClick",[i]);if(!n.elements.container){n.buildSkeleton();n.show(i)}else{n.toggle(i)}})}},buildSkeleton:function(){var n=h.createElement,k=this.options,o=this.elements,m,j;if(o.container){return}o.container=n("div",{"class":this.MAIN_CLASS+(k.className?" "+k.className:""),id:this.id});o.actions=n("ul",{"class":this.MAIN_CLASS+"-actions"}).inject(o.container);if(this.isSectionEnabled){for(m=0,j=this.sections.length;m<j;m++){this.buildSectionSkeleton(this.sections[m])}}else{for(m=0,j=this.items.length;m<j;m++){this.buildItemSkeleton(this.items[m])}if(k.selectable){o.container.addClassName(this.MAIN_CLASS+"-selectable")}}if(h.is(k.renderTo,"element")){o.container.inject(k.renderTo)}else{o.container.inject(k.target)}this.updatePosition();o.container.addEvent("click",this.eventHandler.bind(this))},eventHandler:function(m){var j=this.options,n,k,l,i;a.stop(m);k=this.getItemFromEvent(m);if(k){this.hide();if(this.isSectionEnabled){l=this.getSection(k.section);n=[k,l,m];i=l.selectable}else{i=j.selectable;n=[k,m]}if(i){this.select(k)}this.dispatchEvent("onItemClick",n)}},updatePosition:(function(){function i(j){return h.is(j,"function")?j():j}return function(){this.elements.container.setPosition(i(this.options.position),i(this.options.positionOptions));return this}}()),getItemFromEvent:function(l){var i=a.getElement(l),j=this.MAIN_CLASS+"-action",k;if(i){if(i.hasClassName(j)){k=i}else{k=i.getClosest("."+j)}return this.getItem(k)}},getItem:function(i){if(i){return c(this.items,i)}},getSection:function(i){if(i&&this.isSectionEnabled){return c(this.sections,i)}},getSelection:function(k){var i,j=[];function l(m,n){for(var o=m.length-1;o>=0;o--){if(m[o].items){n.concat(l(m[o].items,n))}else{if(m[o].selected){n.push(m[o])}}}}if(this.isSectionEnabled&&k){i=[this.getSection(k)]}else{if(this.isSectionEnabled||this.options.selectable){i=this.items}}if(i){l(i,j)}return j},buildItemSkeleton:function(k){var j=h.createElement,i=this.options.selectable,l;if(k.section){l=this.getSection(k.section);i=l.selectable}if(k.delimiter){k.el=j("li",{"class":this.MAIN_CLASS+"-delimiter"})}else{k.el=j("li",{"class":this.MAIN_CLASS+"-action "+k.className,html:{tag:"span","class":"text",text:k.text}})}if(k.icon||i){j("span",{"class":"fonticon "+k.iconClassName}).inject(k.el,"top")}if(k.section){k.el.inject(l.body)}else{k.el.inject(this.elements.actions)}},addItems:function(k,i){var j=this;if(h.is(k,"array")){k.forEach(function(l){j.addItem(l,i)})}},addItem:function(k,j){var i=this.options.selectable,n={},p,m,l,o;if(!k||!h.is(k.name,"string")||k.name.length<0){return}n.name=k.name;n.id=e.getUUID();if(k&&k.delimiter){n.delimiter=true}else{p=d.ucfirst(k.name);m=k.name.toLowerCase().split(" ").join("-");l="fonticon-"+m;n.text=k.text||p;n.className=k.className||m;n.icon=typeof k.icon!=="undefined"?k.icon:true;n.iconClassName=k.iconClassName||l}if(this.isSectionEnabled&&j){o=this.getSection(j);i=o.selectable;if(typeof k.position!=="undefined"){if(k.position>o.items.length){k.position=o.items.length}o.items.splice(k.position,0,n)}else{o.items.push(n)}n.section=o.name}if(i&&!n.delimiter){n.iconClassName="fonticon-dot"}if(typeof k.position!=="undefined"){if(k.position>this.items.length){k.position=this.items.length}this.items.splice(k.position,0,n)}else{this.items.push(n)}if(this.elements.container){this.buildItemSkeleton(n)}return n},buildSectionSkeleton:function(n){var m=h.createElement,k,j;n.el=m("li",{"class":this.MAIN_CLASS+"-section "+n.className});n.body=m("ul").inject(n.el);if(n.selectable){n.el.addClassName(this.MAIN_CLASS+"-selectable")}n.el.inject(this.elements.actions);for(k=0,j=n.items.length;k<j;k++){this.buildItemSkeleton(n.items[k])}},addSection:function(k){var o={},p,n,m,j;if(!k||!h.is(k.name,"string")||k.name.length<0){return}p=d.ucfirst(k.name);n=k.name.toLowerCase().split(" ").join("-");o.name=k.name;o.id=e.getUUID();o.selectable=k.selectable||false;o.multiSelect=k.multiSelect||false;o.className=k.className||n;o.items=[];this.sections.push(o);if(h.is(k.items,"array")){for(m=0,j=k.items.length;m<j;m++){this.addItem(k.items[m],o.name)}}if(this.elements.container){this.buildSectionSkeleton()}return o},select:function(l,j){var j=typeof j!=="undefined"?j:true,o=this.getItem(l),p,n,m,k,i;if(!o){return}p=this.isSectionEnabled&&o.section&&this.getSection(o.section)||null;if(this.isSectionEnabled){n=this.getSection(o.section);k=p.selectable;i=p.multiselect}else{n=this.items;k=this.options.selectable;i=this.options.multiselect}if(k&&o.selected!==j){if(!i){m=this.getSelection(p);if(m.length===1){m[0].selected=false;m[0].el.removeClassName(this.MAIN_CLASS+"-selected")}}if(j){o.el.addClassName(this.MAIN_CLASS+"-selected");o.selected=true}else{m[0].selected=false;m[0].el.removeClassName(this.MAIN_CLASS+"-selected")}}return o},setItem:function(l,k){var n=this.getItem(l),o,m,i,j,p;if(n&&k){if(k.text&&k.text!==n.text){n.text=k.text;if(n.el){m=n.el.getElement(".text");m.setText(n.text)}}if(k.className&&k.className!==n.className){if(n.el){n.el.removeClassName(n.className);n.className=k.className;n.el.addClassName(k.className)}else{n.className=k.className}}if(k.icon){}if(h.is(k.position,"number")){o=this.getSection(n.section);i=o?o.items:i;j=i.indexOf(n);p=k.position;if(k.position>=i.length||k.position<0){k.position=i.length-1}if(j>k.position){p--}if(n.el){if(k.position===0){n.el.inject(i[0].el,"before")}else{if(j-1===k.position){n.el.inject(i[k.position].el,"before")}else{n.el.inject(i[p].el,"after")}}}i.splice(k.position,0,i.splice(j,1)[0])}if(n.icon&&k.iconClassName&&k.iconClassName!==n.iconClassName){if(n.el){m=n.el.getElement(".fonticon");m.removeClassName(n.iconClassName);n.iconClassName=k.iconClassName;m.addClassName(k.iconClassName)}else{n.iconClassName=k.iconClassName}}}},removeItem:function(j){var l=this.getItem(j),m,k;if(l){if(this.isSectionEnabled&&l.section){m=this.getSection(l.section);for(k=m.items.length-1;k>=0;k--){if(m.items[k]===l){m.items.splice(k,1);break}}}for(k=this.items.length-1;k>=0;k--){if(this.items[k]===l){if(l.el){l.el.destroy()}this.items.splice(k,1);return l}}}},removeItems:function(j){var m=this.getSection(j),k,l;if(m){m.items=[]}else{for(k=this.items.length-1;k>=0;k--){if(!m||this.items[k].section===m){l=this.items[k];if(l.el){l.el.destroy()}this.items.splice(k,1);return l}}}},removeSection:function(j){var l,k;if(this.isSectionEnabled){l=this.getSection(j);if(l){for(k=this.items.length-1;k>=0;k--){if(this.items[k].section===l.name){this.items.splice(k,1)}}for(k=this.sections.length-1;k>=0;k--){if(this.sections[k]===l){l.body.destroy();this.sections.splice(k,1);return l}}}}},toggle:function(j){var i=this.elements;if(i.container){if(!this.isVisible){this.show(j)}else{this.hide(j)}}},show:function(j){var i=this.elements;if(i.container&&!this.isVisible){this.updatePosition();this.dispatchEvent("onBeforeShowMenu",[i,j]);i.container.setStyle("display","block");this.dispatchEvent("onShowMenu",[i,j]);f.add("dd-menu-"+this.id,this.hide.bind(this),true);this.isVisible=true}},hide:function(j){var i=this.elements;if(i.container&&this.isVisible){this.dispatchEvent("onBeforeHideMenu",[i,j]);i.container.setStyle("display","");this.dispatchEvent("onHideMenu",[i,j]);f.remove("dd-menu-"+this.id);this.isVisible=false}},destroy:function(){var i=this.elements;i.target.removeEvents();if(i.container){i.container.destroy()}this.options=null;this.items=null;this.sections=null}});return b});define("DS/UWPClientControls/DockLayout/Player",["UWA/Core","UWA/Class","DS/UWPClientControls/DockLayout/Item","DS/UWPClientControls/DockLayout/RowOrColumn","DS/UWPClientControls/DockLayout/PlayerDragUtils"],function(f,b,d,e,a){var c=b.extend({init:function(g){this.manager=g.manager;this.element=g.element;this.content=f.is(g.content,"array")?g.content:[g.content]},onDragStart:function(g){a.dragStart({event:g,manager:this.manager,element:this.element,itemCount:this.content.length})},onDrag:function(g){a.drag({event:g,manager:this.manager,element:this.element})},onDragStop:function(g){a.dragStop({event:g,manager:this.manager,element:this.element,changeEventName:"add",onDrop:(function(h){h&&h.createItems(this.content)}).bind(this)})},onDragCancel:function(){a.dragCleanup({element:this.element})}});return c});define("DS/UWPClientControls/DockLayout/Manager",["UWA/Core","UWA/Class","DS/WebappsUtils/Utils","DS/UWPClientControls/DockLayout/AbstractContainer","DS/UWPClientControls/DockLayout/Root","DS/UWPClientControls/DockLayout/RowOrColumn","DS/UWPClientControls/DockLayout/Item","DS/UWPClientControls/DockLayout/Player","DS/UWPClientControls/DockLayout/DropTarget","DS/UWPClientControls/DockLayout/Utils","DS/UWPClientControls/Draggable"],function(g,o,e,m,r,p,b,l,f,c,i){function q(s,t,u){u=u||[];if(typeof s==="object"){if(s instanceof m){u.push(s)}else{u.push(g.extend(s,{container:t}))}if(s.content instanceof Array){s.content.forEach(function(v){q(v,s,u)})}else{q(s.content,s,u)}}return u}function n(s){if(s.type==="item"){return}s.content.forEach(function(t){t.container=s})}function d(s){var u;function t(v){var w=0;if(v.type!=="item"){while(w<v.content.length){if(v.content[w]==null){v.content.splice(w,1)}else{++w}}if(v.content.length===1){if(v.container&&v.container.type!=="root"){v.content[0].weight=v.weight;v.container.content[v.container.content.indexOf(v)]=v.content[0];v=v.container}else{s=s.content[0];v=s}n(v);u=true}}if(v.type==="item"){return}v.content.forEach(function(z,x){if(z.type!==v.type){return}var y=v.content.map(function(A){return A.weight}).reduce(function(B,A){return B+A},0);v.content[x]=z.content;v.content=v.content.reduce(function(B,A){A.forEach&&A.forEach(function(C){C.weight*=C.container.weight/y});return B.concat(A)},[]);u=true});n(v)}do{u=false;q(s).forEach(t)}while(u);return s}var k=100,h,j;var a=o.extend({init:function(s){this._parent();this.sizes=g.merge(s.sizes||{},{splitter:10,minItemWidth:20,minItemHeight:20,minimizedItemHeight:20});this.containersDimensions=c.toMap([]);this._stateStack=[s.structure];this._stateStackIndex=0;this.onChange=(function(t){this.commitState();s.onChange&&s.onChange(t,this)}).bind(this);this.leafReviver=s.leafReviver;this.element=g.extendElement(g.is(s.container,"string")?document.querySelector(s.container):s.container);this.root=new r({manager:this});this.maximizedItem=null;this.enabled=true;this.createTree(s.structure,this.root);this.element.addEvent("resize",(function(){if(this._getContainerVisibility()==="visible"&&!e.isVirtualKeyboardOpen()){this.paint();s.onResize&&s.onResize(this)}}).bind(this));s.onBeforeFirstPaint&&s.onBeforeFirstPaint(this);this.paint()},freeze:function(){this.element.getElements(".dock-splitter").forEach(function(s){s.remove()});this.element.removeEvents()},_getContainerVisibility:function(){return window.getComputedStyle(this.element).visibility},getRelativeCoordinates:function(s,u){var t=this.element.getBoundingClientRect();return{x:s-t.left,y:u-t.top}},getDropTargetAt:function(s,w){var v=f.sortByPriority(this.root.getDropTargets()),u;for(var t=0;t<v.length;++t){u=v[t];if(u.matchesCoordinates(s,w)){return(j=u)}}return j||v[0]},addItems:function(s){var t=typeof t==="string"?[s.content]:s.content;if(t.length===0){throw new Error("Content must have length of at least 1")}else{this.getDropTargetAt(s.x,s.y).createItems(t)}},getPlayer:function(s){return new l({manager:this,element:s.element,content:s.content})},minimize:function(s){var t=s.dockItem;if(!t){throw new Error("Invalid item element for minimizing")}if(t.isMinimized()){return}t.toggleMinimize();this.paint()},maximize:function(s){var t=s.dockItem;if(!t){throw new Error("Invalid item element for maximizing")}if(this.maximizedItem){this.maximizedItem.toggleMaximize()}t.toggleMaximize();this.paint()},setDefaultViewMode:function(s){var t=s.dockItem;if(!t){throw new Error("Invalid item element")}if(t.isMinimized()){t.toggleMinimize()}else{if(this.maximizedItem===t){t.toggleMaximize()}else{return}}this.paint()},createTree:function(w,u){if(!w){return}if(u.type==="root"){d(w)}var v=this,t=["row","column"].indexOf(u.type)!==-1;function s(y){var x;switch(y.type){case"row":case"column":x=new p({type:y.type,container:u,weight:y.weight});break;case"item":if(typeof y.content!=="string"){throw new Error("Item content must be a string")}x=new b({container:u,content:y.content,weight:y.weight});break;default:throw new Error("Unknown element type: "+y.type)}if(y.type!=="item"){v.createTree(y.content,x)}return x}if(t&&!g.is(w,"array")){throw new Error("Rows/columns must have arrays as content")}else{if(!t&&g.is(w,"array")){throw new Error("Cannot define array content for non row/column type")}}if(t){w.forEach(function(x){u.addChild(s(x))})}else{u.addChild(s(w))}},serialize:function(){return JSON.stringify(this.root.content)},paint:function(){this.containersDimensions=c.toMap([]);this.root.updateSize("width");this.root.updateSize("height");this.root.updateRectangle()},setMaxAlignedItems:function(w,y){var u=w==="horizontal"?"x":"y",v=u==="x"?"y":"x",z=w==="horizontal"?"row":"column",B=z==="row"?"column":"row";function x(C){var E=w==="horizontal"?"height":"width",D=C.content.reduce(function(F,G){return F+G.getMaxAlignedElementCount(E)},0);C.content.forEach(function(F){F.weight=100*F.getMaxAlignedElementCount(E)/D})}function s(E,D){var C=[];E.forEach(function(G,F){if(F%D===0){C.push([])}C[C.length-1].push(G)});return C}function A(C){var F,E,D;function G(H){if(H.getGridCoordinates()[u]<y||E.indexOf(H)>-1){return}D=true;var N=H.container,I=I=N&&N.content.indexOf(H),J,M,O,P,L,K;if(N&&N.type===z){P=N.content.splice(I);O=N.content}else{if(N){N.splice(H,1);O=N.content}P=[H]}J=s(P,y);M=100/(J.length+(O?1:0));L=new p({type:B,content:(O?[new p({type:z,content:O,weight:M,container:L})]:[]).concat(J.map(function(Q){return new p({type:z,content:Q,weight:M,container:L})})),weight:100});L.content.forEach(n);n(L);if(N&&N.container&&N.container.type!=="root"){K=N.container.content.indexOf(N);N.container.content[K]=g.extend(L,{weight:N.container.content[K].weight});n(N.container.content[K]);x(N.container.content[K])}else{C=L;n(C);x(C)}C=d(C);E=E.concat(q(L));F.push(L)}do{F=[];E=[];D=false;q(C).sort(function(I,H){var J=I.getGridCoordinates(),K=H.getGridCoordinates();return J[u]-K[u]||J[v]-K[v]}).forEach(G)}while(D);return C}if(!this.root.content||this.root.content.type==="item"){return}var t=new a({container:document.createElement("div"),structure:JSON.parse(JSON.stringify(this.root.content)),leafReviver:function(){return document.createElement("div")}});this.setState(A(t.root.content),true)},undo:function(s){if(this._stateStackIndex===0){throw new Error("Nothing to undo")}--this._stateStackIndex;this.restoreState(s)},redo:function(s){if(this._stateStackIndex===this._stateStack.length-1){throw new Error("Nothing to redo")}++this._stateStackIndex;this.restoreState(s)},restoreState:function(s){this.setState(this._stateStack[this._stateStackIndex],s)},setState:function(t,s){this.root.content=undefined;while(!s&&this.element.firstChild){this.element.removeChild(this.element.firstChild)}if(s){this.element.getElements(".dock-splitter").forEach(function(u){u.remove()})}this.createTree(t,this.root);!s&&this.paint()},commitState:function(){this._stateStack=this._stateStack.slice(0,this._stateStackIndex+1);this._stateStack.push(JSON.parse(this.serialize()||"null"));if(this._stateStack.length>k){this._stateStack.shift()}else{++this._stateStackIndex}},onDragStart:function(s,t){if(this.maximizedItem||!this.enabled){return false}h=s;while(!h.onDragStart){h=h.parentElement;if(h===this.element){throw new Error("Element cannot receive drag events")}}h.onDragStart(t);return true},onDrag:function(s){if(this.maximizedItem||!this.enabled){return false}h.onDrag(s);return true},onDragStop:function(s){if(this.maximizedItem||!this.enabled){return false}h&&h.onDragStop(s);h=undefined;j=undefined;return true},setupDrag:function(){var t=this,s;this.draggable&&this.draggable.destroy();this.draggable=new i({movePlayer:false,container:t.element,items:".dock-splitter, .dock-item",limit:true,textSelection:false,distance:0,area:15,beforeStart:function(u,v){s=v.player},start:function(u){t.onDragStart(s,u)},drag:function(u){t.onDrag(u)},stop:function(u){t.onDragStop(u)}})},setEnabled:function(t,s){var u="dock-disabled";this.enabled=t;if(this.enabled||s){this.element.removeClassName(u)}else{this.element.addClassName(u)}},restoreWeights:function(t){function s(v,u){if(!v||!u){return}v.weight=u.weight||v.weight;if(v.type==="item"){return}if(v.content.length!==(u.content||[]).length){return}v.content.forEach(function(x,w){s(x,u.content&&u.content[w])})}s(this.root.content,t)}});return a});define("DS/UWPClientControls/EditableTab",["UWA/Core","UWA/Element","UWA/Controls/TabView","DS/UWPClientControls/EditInPlace","DS/UIKIT/Tooltip","i18n!DS/UWPClientControls/assets/nls/tooltips"],function(f,a,b,c,d,e){return b.Tab.extend({defaultOptions:{className:"",classNames:{tabPanel:"wp-tab-panel",tab:"wp-tab",selected:"selected",disabled:"disabled"},editable:false},init:function(g){this._parent(g)},_createInnerTabElement:function(){var k=this,j=f.createElement,i=k.elements,g=k.options,h=j("div",{"class":"inner-ctn",html:[{tag:"span","class":"title",text:k.getText()||"."}]});if(g.menuItems){var l=j("span",{"class":"action fonticon fonticon-down-open"}).inject(h,"top");new d({position:"bottom",target:l,body:e.menu,offset:{x:0,y:0},closeOnClick:true})}h.addContent({tag:"div","class":"underline-tab-el"});i.title=h.getElement(".title");i.action=h.getElement(".action");return h},tabElement:function(){if(!this.elements.container){this.elements.container=this._createTabElement();if(this.options.className){this.elements.container.addClassName(this.options.className)}if(this.options.icon){this.setIcon(this.options.icon)}if(this.options.id){this.elements.container.setAttribute("data-tabId",this.options.id)}}return this.elements.container},contentElement:function(){if(!this.elements.content){this.elements.content=this._createContentElement();if(this.elements.content){this.elements.content.addClassName("hidden")}}return this.elements.content},setName:function(g){if(this.options.name!==g){this.options.name=g;this.setText(g)}},isEditable:function(){return this.options.editable},setText:function(i){var g=this.options,h=this.elements;if(i&&g.text!==i){h.title.setText(i);g.text=i;g.name=i;this.dispatchEvent("onTextChanged",this)}return this},editText:function(){var m,j,n,h,i="editing",l=this,k=l.editor;function g(){h.removeClassName(i);l.editor=null}if(k){l.endEditText();return}if(l.options.editable){m=l.elements;n=m.title;h=m.container;h.addClassName(i);j=n.getText();l.editor=k=new c(n,{maxLength:50,autoEdit:false,emptyText:false,growInputAsUserType:true,onEdit:function(o){o=o.trim();if(!o){l.setText("temp").setText(j)}else{l.setText(o)}g()},onCancel:g,onComplete:g});k.edit()}},hide:function(){this.getContent().hide();this.options.hidden=true;return this.dispatchEvent("onHide")},show:function(){this.getContent().show();this.options.hidden=false;return this.dispatchEvent("onShow")},endEditText:function(h){var g=this.editor;if(g){g.endEdit(!!h)}}})});define("DS/UWPClientControls/EditableTabview",["UWA/Core","UWA/Element","UWA/Event","UWA/Utils/Client","UWA/Controls/TabView","UWA/Controls/Drag","UWA/Controls/Input","DS/UWPClientControls/EditableTab","DS/UWPClientControls/DropdownMenu","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UWPClientControls/Utils"],function(d,b,k,c,m,i,e,j,h,a,g,f){var l=m.extend({defaultOptions:{showTabs:true,editable:false,allowNewTab:false,className:"",classNames:{scroller:"wp-tablist-scroller",scrollerButton:"wp-scroller-button",tabMenu:"wp-tab-menu",tab:"wp-tab",tabDirectAdd:"wp-tab-directadd",tabAddList:"wp-tab-addlist",tabView:"wp-tabview",tabList:"wp-tablist",selected:"selected",tabPanels:"wp-tabview-panel"}},init:function(n){this._parent(n);var o=this,q=this.elements,p=this.options.classNames.scroller;this.options.allowNewTab=this.options.editable+this.options.allowNewTab;if(this.options.showTabs){this.options.tabSelector="."+this.options.classNames.tab;d.createElement("div",{"class":p+"-ctn",events:{resize:function(){o.onResize()}}}).grab(q.container.getElement("."+p)).inject(q.container,"top");q.scroller=q.container.getElement("."+p);q.scrollerContainer=q.container.getElement("."+p+"-ctn");this._fixIosStylusEvents(this);if(this.options.editable){this.attachReorder()}}else{this.hideTabList()}},buildContainer:function(){this._parent();var p=this,n=p.options,r=n.classNames,o=d.createElement,q=p.elements;if(n.showTabs){n.scroller={className:r.scroller,scrollButtonClassName:r.scrollerButton,nextButton:function(s){var u=o("div",{"class":r.scrollerButton+" icon fonticon fonticon-right-open"}),t=o("div",{"class":r.tabAddList+" icon fonticon "+(n.allowNewTab?"fonticon-list-add":"fonticon-menu")});q.tabAddListBtn=t;o("div",{"class":r.scrollerButton+"-ctn next",html:[u,t]}).inject(s);return u},previousButton:function(s){var t=o("div",{"class":r.scrollerButton+" icon fonticon fonticon-left-open"});o("div",{"class":r.scrollerButton+"-ctn previous",html:t}).inject(s,"top");return t}};if(n.allowNewTab&&n.editable){q.tabDirectAddBtn=o("li",{"class":r.tabDirectAdd,html:[{tag:"div","class":"fake-content",html:"&nbsp;"},{tag:"span","class":"icon fonticon fonticon-plus"}],events:{click:f.debounce(p.dispatchEvent.bind(p,"onNewTab"))}}).inject(q.tabList);new g({position:"bottom",target:q.tabDirectAddBtn,body:d.i18n("Add new tab"),offset:{x:0,y:0},closeOnClick:true})}}else{if(n.dashboardSwitch){d.createElement("span",{"class":"fonticon fonticon-menu dashboard-menu-open",styles:{position:"absolute"}}).inject(q.container,"top")}}},handleEvent:function(o){var n=this.getTabFromEvent(o),p=k.getElement(o);if(n){if(n===this.selectedTab){if(p.hasClassName("title")){n.editText()}if(d.is(n.handleEvent,"function")){n.handleEvent(o,this)}if(this.options.allowReload){this.selectTab(n,o)}}else{if(!n.isDisabled()){this.selectTab(n,o)}}}},onPreSelectTab:function(n,p){var o=p||n;if(o&&p!==n){o.endEditText(true)}},addTab:function(p,r){var q=this,v=q.options,n=q.elements,u,t=["editable","menuItems"],s=n.tabDirectAddBtn,o=q.tabs[q.tabs.length-1];if(p instanceof j===false){t.forEach(function(w){p[w]=typeof p[w]!=="undefined"?p[w]:v[w]});p=new j(p)}if(d.is(r,"number")&&(r+1)<q.tabs.length&&r>=0){p.tabElement().inject(q.getTab(r).tabElement(),"before");q.tabs.splice(r,0,p)}else{n.tabList.grab(p.tabElement());q.tabs.push(p)}if(p.options.hidden){if(p.elements&&p.elements.container){d.extendElement(p.elements.container).hide()}}if(n.contentNode){u=p.contentElement();if(u){if(o){o.contentElement()&&o.contentElement().grab(u,"after")}else{n.contentNode.grab(u,"top")}}}if(p.options.selected){q.selectTab(p)}if(v.showTabs){if(q.menu&&!p.options.hidden){q.menu.addItem({name:p.options.id,text:p.options.text},"tabs")}if(p.options.menuItems){q.attachMenu(p)}if(p.options.editable){if(s){s=s.remove();n.tabList.addContent(s)}p.addEvent("onTextChanged",function(){if(q.menu){q.menu.setItem(p.options.id,{text:p.getText()})}q.dispatchEvent("onTabTextChanged",p,p.getText())});p.elements.container.addClassName("wp-drop")}q.onResize()}q.dispatchEvent("onAddTab",[p]);return p},onOverflowChange:function(r){var q=this,s=this.elements,p=this.options,o=s.tabAddListBtn,n;if(r.overflow){setTimeout(function(){if(q.selectedTab){q.scrollToTab(q.selectedTab)}},100);if(!this.menu){n=[{name:"tabs",className:"tabs-section Tm",selectable:true,items:this.tabs.filter(function(t){return !t.options.hidden}).map(function(t){return{name:t.options.id,text:t.options.text}})}];if(p.allowNewTab){n.unshift({name:"header",className:"header-section",items:[{name:"addTab",iconClassName:"fonticon-plus",text:d.i18n("Add new tab")}]})}this.menu=new h({target:o,renderTo:this.elements.scrollerContainer,position:function(){var w=5,t=o.getPosition(q.elements.scrollerContainer,{x:"left",y:"bottom"}),v=o.getDimensions(),u=q.menu.elements.container.getSize();return{x:t.x-u.width+v.outerWidth,y:t.y+w}},sections:n,events:{onItemClick:function(t){if(t.name==="addTab"){q.dispatchEvent("onNewTab")}else{q.selectTab(t.name)}},onShowMenu:function(t){t.target.addClassName("active");this.select(q.selectedTab.options.id);this.getSelection().forEach(function(u){var v=this.getSection(u.section);if(!v.multiselect){v.el.scrollTop=u.el.getPosition(v.el).y+v.el.scrollTop}},this)},onHideMenu:function(t){t.target.removeClassName("active")}}})}}else{if(this.menu){this.menu.destroy();this.menu=null}}},attachReorder:function(){var o=this,n=this.options,p=this.elements;new i.Move({snap:30,container:p.scroller,root:p.tabList,delegate:"> li :not(input),> li",fixed:function(r,s){var t=d.extendElement(s).getClosest("li"),q=o.getTab(t);return !q||!q.isEditable()},handles:function(q){var r=n.classNames,s;q.target=d.extendElement(q.target).getClosest("li");q.placeholder=d.createElement("li",{"class":r.tab+" placeholder",html:"&nbsp;",styles:{width:q.target.getSize().width+14}}).inject(q.target,"after");s=q.target.getPosition(q.target.getOffsetParent());return q.target.setStyles({left:s.x+"px",top:s.y+"px"}).addClassName("dragged")},move:function(q){if(q.limited.left){o.scroller.autoScrollPrevious()}else{if(q.limited.right){o.scroller.autoScrollNext()}else{o.scroller.stopScroll()}}},enter:function(q){return q.placeholder},drop:function(r){var q=r.zone.getElements("li:not(.dragged)").indexOf(r.placeholder);if(o.moveTab(r.target,q)){if(o.menu){o.menu.setItem(r.target.getAttribute("data-tabid"),{position:q})}o.dispatchEvent("onReorderTabs")}},stop:function(q){q.placeholder.destroy();o.scroller.stopScroll();q.target.removeClassName("dragged").setStyles({top:"",left:""})}})},attachMenu:function(o){var p=this,n=o.options.menuItems;if(!o.menu&&d.is(n,"array")&&n.length>0){o.menu=new a({className:"moduleMenu",target:o.elements.action,renderTo:this.elements.scrollerContainer,items:n,events:{onClick:function(r,q){p.dispatchEvent("onTabMenuItemClick",[o,q,r])},onShow:function(){this.options.target.addClassName("active")},onHide:function(){this.options.target.removeClassName("active")}}})}},_fixIosStylusEvents:function(){if(c.Platform.name!=="ios"){return}var o=this.elements.scrollerContainer,t,r,q=0,p={capture:true,passive:false},n=10,s=2;o.addEventListener("touchstart",function(u){if(!u.touches||u.touches.length!==1){return}t=u.touches[0];q=0},p);o.addEvent("touchmove",function(u){if(!t){return}r=u.touches[0];++q},p);o.addEvent("touchend",function(w){if(!t){return}if(!r){r=t}var v=t.pageX-r.pageX,u=t.pageY-r.pageY,x=Math.sqrt(v*v+u*u);if(x<n&&q<s&&w.target!==document.activeElement){w.preventDefault();document.activeElement.blur();w.target.click()}t=r=undefined},p)}});return l});