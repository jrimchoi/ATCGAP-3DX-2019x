define("DS/Store/StoreBodyPage",["UWA/Core","UWA/Class/View","i18n!DS/Store/assets/nls/StoreComponents"],function(c,b,a){return b.extend({className:"registration3ds-steps-container",render:function(){var d,f;var e;this.stepInfoContainer=c.createElement("div",{"class":"step-info-container"});d=c.createElement("div",{"class":"steps-info",html:[this._initNavTabs(),this.stepInfoContainer]});this.greyContainer=c.createElement("div",{"class":"grey-container"});f=c.createElement("div",{"class":"steps-info-for-user",html:this.greyContainer});e=c.createElement("div",{"class":"registrations-steps",html:[d,f]});this.container.setContent(e);return this},_updateNavTabs:function(d){this.step1.toggleClassName("current",d===1);this.step2.toggleClassName("current",d===2);this.step3.toggleClassName("current",d===3);this.step1.toggleClassName("validated",d===2||d===3);this.step2.toggleClassName("validated",d===3);this.transition1.toggleClassName("performed",d===2||d===3);this.transition2.toggleClassName("performed",d===3)},_initNavTabs:function(){this.step1=c.createElement("div",{"class":"steps step1",html:[c.createElement("div",{"class":"numerotation font-3dsregular",text:"1"}),c.createElement("div",{"class":"label-step-container",html:c.createElement("div",{"class":"label-step font-3dsregular",text:a.get("login")})})]});this.transition1=c.createElement("div",{"class":"steps transition fonticon fonticon-chevron-right fonticon-4x"});this.step2=c.createElement("div",{"class":"steps step2",html:[c.createElement("div",{"class":"numerotation font-3dsregular",text:"2"}),c.createElement("div",{"class":"label-step-container",html:c.createElement("div",{"class":"label-step font-3dsregular",text:a.get("validate")})})]});this.transition2=c.createElement("div",{"class":"steps transition fonticon fonticon-chevron-right fonticon-4x"});this.step3=c.createElement("div",{"class":"steps step3",html:[c.createElement("div",{"class":"numerotation font-3dsregular",text:"3"}),c.createElement("div",{"class":"label-step-container",html:c.createElement("div",{"class":"label-step font-3dsregular",text:a.get("complete")})})]});return c.createElement("div",{"class":"steps-nav",html:[this.step1,this.transition1,this.step2,this.transition2,this.step3]})}})});define("DS/Store/StoreTokenInputComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Text","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFTokenModel/TokenModel","i18n!DS/Store/assets/nls/StoreComponents"],function(e,c,d,g,b,f,i,h){var a=c.extend({className:"mpf-token-input",setup:function(j){j||(j={});this._parent(j);f.requiredOfPrototype(j.token,i,"options.token must be a TokenModel");this.token=j.token;this.codeInput=new d({placeholder:h.get("enterCode"),value:this.token.getToken(),multiline:false,id:"token",disabled:true});this.alert=new b({visible:true,maximumVisibleMessages:1});this.spinner=new g()},render:function(){var j;j=e.createElement("form",{html:[this.codeInput,this.alert]});this.container.setContent(j);this.dispatchEvent("onRender");return this},checkToken:function(){var j=this;this.dispatchEvent("checkingToken");this.spinner.inject(this.container.getElement(".mpf-token-input input"),"after");this.spinner.show();this.token.set({token:this.codeInput.getValue()});return this.token.savePromise().then(function(n,k){var m=j.token.getProcessingCode();var o=j.token.get("message");j.spinner.hide();if(m===0||m===7){j._displayValidationMessage();j.dispatchEvent("validated",j.token.getSource())}else{if(m===4){var l=window.location.origin.replace("apps","ifwe");window.location.replace(l)}else{if(m===5){j._displayErrorMessage(h.get("tokenAlreadyUsed"))}else{if(m===6||m===9){j._displayErrorMessage(h.get("errDeployment"))}else{if(m===8){j.dispatchEvent("loading",j.token.getCartID())}}}}}console.warn("token code: "+m+", message: "+o)})["catch"](function(k){j.spinner.hide();j._displayErrorMessage(h.get("tokenError"));console.error(k.response)})},_displayValidationMessage:function(){var j=this.alert.getMessages();if(j.length>0){this.alert.remove(j[0])}this.alert.add({className:"success",message:h.get("tokenSuccess")})},_displayErrorMessage:function(k){var j=this.alert.getMessages();if(j.length>0){this.alert.remove(j[0])}this.alert.add({className:"error",message:k})}});return a});define("DS/Store/StoreHeaderPage",["UWA/Core","UWA/String","UWA/Class/View","i18n!DS/Store/assets/nls/StoreComponents"],function(d,b,c,a){return c.extend({className:"registration3ds-page-header",render:function(){var e;e=d.createElement("div",{"class":"registration3ds-placeholder font-3dsregular",html:[this._getPlaceholderTitle(),this._getPlaceholderLabel()]});this.container.setContent(e);return this},_getPlaceholderTitle:function(){var g;var e;var f;g=d.createElement("span",{"class":"font-3dsbold",text:"3D"}).outerHTML+"EXPERIENCE";e=d.createElement("span",{"class":"brand-container",html:g});f=d.createElement("div",{"class":"title",html:e.outerHTML+" Social Collaboration Services"});return d.createElement("div",{"class":"title-container",html:f})},_getPlaceholderLabel:function(){var h;var f;var g;var e;h=d.createElement("span",{"class":"font-3dsbold",text:"3D"}).outerHTML+"EXPERIENCE";f=b.format(a.get("power"),h);g=b.format(a.get("offerIsTheGateway"),d.createElement("span",{"class":"font-3dsregular",html:f}).outerHTML);e=d.createElement("div",{"class":"exp-label font-3dslight",html:g});return d.createElement("div",{"class":"title-desc",html:e})}})});define("DS/Store/StoreDeployBodyPage",["UWA/Core","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/Store/StoreBodyPage","DS/MPFCartModel/CartModel","i18n!DS/Store/assets/nls/StoreComponents"],function(g,e,a,b,f,c,d){return f.extend({init:function(h){h||(h={});this._parent(h);b.requiredOfPrototype(h.cart,c,"options.cart must be a CartModel");this.cart=h.cart;this.alert=new a({className:"alert-deploy",visible:true,maximumVisibleMessages:1})},render:function(){var l=this;var k;var m;var h;var j;var i;this._parent();this.greyContainer.hide();k=g.createElement("div",{"class":"step-info-complete",html:[{tag:"span","class":"label-info-step3-bold",text:d.get("registrationComplete")},{tag:"br"},{tag:"span","class":"label-info-step3",text:d.get("waitMinutes")}]});m=new e({animate:false});h=g.createElement("div",{"class":"spinner-container",html:[m,this.alert]});j=g.createElement("iframe",{width:"640",height:"360",src:"https://www.youtube.com/embed/kmI9zN3Uqyo"});this._updateNavTabs(3);this.stepInfoContainer.setContent([k,h]);j.inject(this.greyContainer,"after");m.show();i=window.setInterval(function(){l.cart.fetch(l._manageDeploy(i,m,j))},2000);window.setTimeout(function(){m.hide();l._displayAlert("primary",d.get("deployPlatform"));window.clearInterval(i)},180000);return this},_manageDeploy:function(i,l,k){var j=this;var h;return{onComplete:function(){if(j.cart.getState()===c.States.FAILED||j.cart.getState()===c.States.BLOCKED||j.cart.getState()===c.States.EXPIRED){l.hide();window.clearInterval(i);j._displayAlert("error",d.get("errDeployment"))}else{if(j.cart.getState()===c.States.DELIVERED){window.clearInterval(i);h=window.location.origin.replace("apps","ifwe");window.location.replace(h)}}},onFailure:function(){window.clearInterval(i);l.hide();j._displayAlert("error",d.get("errMsg"))}}},_displayAlert:function(h,j){var i;i=this.alert.getMessages();if(i.length>0){this.alert.remove(i[0])}this.alert.add({className:h,message:j})}})});define("DS/Store/StoreTokenBodyPage",["UWA/Core","UWA/String","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/Store/StoreBodyPage","DS/MPFServices/ObjectService","DS/MPFUrl/UrlUtils","DS/MPFDataProxy/AppsConnector","DS/Store/StoreTokenInputComponent","DS/Usage/TrackerAPI","DS/MPFModelFactory/TokenFactory","DS/MPFModelFactory/SoftwareAgreementFactory","DS/MPFModelFactory/CartFactory","DS/MPFModelFactory/TCContractFactory","DS/MPFModelFactory/PersonFactory","i18n!DS/Store/assets/nls/StoreComponents"],function(i,g,p,k,a,o,d,l,r,q,c,m,e,j,h,n,b,f){return d.extend({init:function(s){s||(s={});this._parent(s);this._checkPrototypes(s);this.tokenFactory=s.tokenFactory;this.token=this.tokenFactory.createModel("validate");this.personFactory=s.personFactory;this.me=this.personFactory.createModel("me");this.softwareAgreementFactory=s.softwareAgreementFactory;this.softwareAgreementModel=this.softwareAgreementFactory.createModel();this.cartFactory=s.cartFactory;this.cart=this.cartFactory.createModel("CART");this.tcContractFactory=s.tcContractFactory;this.tcContract=this.tcContractFactory.createModel("existing-document");this._checkTokenUrlParam(this.token);this.alert=new k({className:"alert-deploy",visible:true,maximumVisibleMessages:1})},render:function(){var s;var t;s=i.createElement("div",{"class":"step-info",html:[{tag:"div","class":"label-info-step2",html:[g.format(f.get("accessConditionToMy3DExperienceMessage"),i.createElement("span",{"class":"ds-blue",html:[{tag:"strong",text:"3D"},"EXPERIENCE Social Collaboration Services"]}).outerHTML,i.createElement("strong",{text:"CATIA"}).outerHTML,i.createElement("strong",{text:"SOLIDWORKS"}).outerHTML)]},{tag:"div","class":"label-info-step2",text:f.get("accessConditionToMy3DExperienceMessage2")}]});t=i.createElement("div",{text:f.get("registrationCode"),"class":"labelInput"});this._parent();this._updateNavTabs(2);this.tokenInput=new c({token:this.token});this._initListeners();this.stepInfoContainer.setContent([s,this.alert]);t.inject(this.stepInfoContainer.getParent(),"after");this.greyContainer.setContent(this.tokenInput.render());this.tokenInput.checkToken();return this},_initListeners:function(){var s=this;this.listenTo(this.tokenInput,"validated",function(t){s._getAgreements(t)});this.listenTo(this.tokenInput,"loading",function(t){s.cart.set({id:t});s.dispatchEvent("onDeploy",s.cart)})},_getAgreements:function(t){var s=this;return this.me.fetchPromise().then(this.softwareAgreementModel.fetchPromise.bind(this.softwareAgreementModel,{token:s.token.getToken()})).then(this._displayAgreements.bind(this,t))["catch"](function(){s._displayAlert("error",f.get("errMsg"))})},_displayAgreements:function(v){var s;var w;var u;var t;console.warn("software agreements code: "+this.softwareAgreementModel.getCode()+", message: "+this.softwareAgreementModel.getMessage());if(this.softwareAgreementModel.getCode()===10){this._displayAlert("error",f.get("serviceUnavailable"))}else{u=i.createElement("a",{text:f.get(v+"LinkAgreement"),target:"_blank",href:this.softwareAgreementModel.get("url")});w=new p({value:f.get("next"),className:"primary next",disabled:"true",events:{onClick:this._signContracts.bind(this)}});s=new a({type:"switch",value:"tc",label:"",className:"primary",events:{onChange:function(){w.setDisabled(!this.isChecked())}}});t=i.createElement("span",{html:g.format(f.get(v+"Agreements"),u.outerHTML)});s.inject(this.greyContainer,"after");s.elements.label.setContent(t);w.inject(s.elements.container,"after")}m.registerData("authUser",this.me.getFirstName()+" "+this.me.getLastName())},_signContracts:function(){var s=this;this.token.dataProxy=this.tokenFactory.getDataProxy("consume");this.tcContract.set({consumerID:this.me.get("id"),documentID:this.softwareAgreementModel.get("id"),currentState:"IN_EFFECT"});o.mask(this.greyContainer.getParent());return this.tcContract.savePromise().then(function(){s.token.set({agreementID:s.tcContract.get("id")});return s.token.savePromise()}).then(function(){var v;var u;var t;v=s.token.getProcessingCode();u=s.token.get("message");if(v===2){t=window.location.origin.replace("apps","ifwe");window.location.replace(t)}else{if(v===3){s._displayAlert("error",f.get("noCustomer"))}else{if(v===4||v===10){s._displayAlert("error",f.get("serviceUnavailable"))}else{if(v===8){s._displayAlert("error",f.get("expiredLicenses"))}else{s.cart.set({id:s.token.getCartID()});s.dispatchEvent("onDeploy",s.cart)}}}}console.warn("token code: "+v+", message: "+u)})["catch"](function(t){s._displayAlert("error",f.get("errMsg"));console.error(t.response)})["finally"](function(){o.unmask(s.greyContainer.getParent())})},_checkTokenUrlParam:function(s){var u=window.location.search.match(/token=([^&#]+)/);var t;if(u&&u[1]){t=u[1];s.set("token",t)}},_displayAlert:function(s,u){var t;t=this.alert.getMessages();if(t.length>0){this.alert.remove(t[0])}this.alert.add({className:s,message:u})},_checkPrototypes:function(s){l.requiredOfPrototype(s.tokenFactory,e,"options.tokenFactory must be a TokenFactory");l.requiredOfPrototype(s.softwareAgreementFactory,j,"options.softwareAgreementFactory must be a SoftwareAgreementFactory");l.requiredOfPrototype(s.cartFactory,h,"options.cartFactory must be a CartFactory");l.requiredOfPrototype(s.tcContractFactory,n,"options.tcContractFactory must be a TokenFactory");l.requiredOfPrototype(s.personFactory,b,"options.personFactory must be a PersonFactory")}})});define("DS/Store/StoreTokenPage",["UWA/Core","UWA/Promise","UWA/Utils","UWA/Class/View","DS/MPFModelFactory/MPFFactoriesV2","DS/UIKIT/Mask","DS/i3DXCompass/i3DXCompass","DS/TopBar/TopBar","DS/TopBarProxy/TopBarProxy","DS/MPFDataProxy/MarketplaceConnector","DS/MPFDataProxy/AppsConnector","DS/MPFAppsPlatform/PublicPlatformsDataProxy","DS/MPFAppsPlatform/PlatformCollection","DS/MPFAppsPlatform/ServiceEnum","DS/Store/StoreHeaderPage","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFPersonModel/MePersonDataProxy","DS/Store/StoreTokenBodyPage","DS/Store/StoreDeployBodyPage","DS/Usage/UsageManager","i18n!DS/Store/assets/nls/StoreComponents","css!DS/Store/Store","css!DS/TopBar/TopBar","css!DS/i3DXCompass/i3DXCompass"],function(l,c,f,g,m,q,h,i,r,s,t,p,v,b,k,a,n,d,o,u,j){var e={};e.LOADING="loading";e.ACTIVE="active";return g.extend({className:"page-container",init:function(w){var x=this;this._parent(w);this.stateMachine=new a({state:e.LOADING,states:[e.LOADING,e.ACTIVE],transitions:[{from:e.LOADING,to:e.ACTIVE},{from:e.ACTIVE,to:e.LOADING}]});l.createElement("div",{id:"my-apps-ct"}).inject(document.body,"top");this._getPlatform().then(function(y){var z;z=y.services.get(b.PASSPORT.name);if(!(z)){throw new Error("Passport service not found")}x._initTopBar(z.getUrl());x._initCompass();x.stateMachine.changeState(e.ACTIVE);x.render(z.getUrl())});u.init("/upload","My3DExperience")},render:function(A){var E=this;var y;var w;var G;var z,D,B,x,F,C;y=document.getElementById("topbar");w=this.stateMachine.getState();if(w===e.LOADING){q.mask(this.container)}else{s.fetchPromise({service:"3DStore"}).then(function(H){z=m.getInstance(H);return c.all([z.getFactory(m.Types.TOKEN),z.getFactory(m.Types.PERSON),z.getFactory(m.Types.SOFTWARE_AGREEMENT),z.getFactory(m.Types.CART),z.getFactory(m.Types.TC_CONTRACT)])}).then(function(I){var H={};D=I[0];F=I[1];B=I[2];C=I[3];x=I[4];G=F.createModel("me");H[n.Params.ALLOW_CREATION]=true;return G.fetchPromise(H)}).then(function(){return G.fetchPromise()}).then(function(){if(G.getFirstName()&&G.getLastName()){i.set("userName",G.getFirstName()+" "+G.getLastName());E._initTopBarSubmenus(A)}y.style.display="flex";if(l.is(y.getElement(".topbar-menu-item-badge"))){y.getElement(".topbar-menu-item-badge").setStyle("display","none")}})["finally"](function(){var H;H=new d({tokenFactory:D,personFactory:F,softwareAgreementFactory:B,cartFactory:C,tcContractFactory:x});E.listenTo(H,"onDeploy",function(I){E._displayDeployBodyPage(I)});E._buildContainer(H);u.pages.push({url:"TokenPage",timestamp:Date.now()})})}return this},_displayDeployBodyPage:function(x){var w;w=new o({cart:x});this._buildContainer(w);u.pages.push({url:"DeployPage",timestamp:Date.now()})},_buildContainer:function(w){var x;x=new k();this.container.setContent([x.render(),w.render()])},_getPlatform:function(){var x;var z;var w;x=new t(window.location.origin+"/enovia/resources/AppsMngt");z=new p(x);w=new v([],{dataProxy:z});function y(B){return B.services.get(b.MARKETPLACE.name)}function A(B){return B.find(y)}return w.fetchPromise().then(A)},_initTopBar:function(w){i.init({brand:"Onboarding",topMenus:{profile:true,add:false,share:false,home:false,help:false},useTagger:false,userName:"Profile",loginUrl:w+"/login?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash),signupUrl:w+"/register?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)});i.view.container.getElement(".topbar-center").remove()},_initCompass:function(){var x=this;var w;w={};if(window.location.hash){window.location.hash.substring(1,window.location.hash.length).split("/").forEach(function(z){var y=z.split(":");w[y[0]]=y[1]})}h.initialize({compassTarget:"compass_ctn",appsTarget:"my-apps-ct",myAppsBaseUrl:f.buildUrl(window.location,"../../"),userId:w.userId,passportUrl:f.buildUrl(window.location,"assets/PassportStub"),proxyTicketUrl:f.buildUrl(window.location,"assets/AppStub/ticket?url=V6"),lang:"en",closable:true,onOpen:function(){x.container.setStyles({width:"80%","float":"right"})},onClose:function(){x.container.setStyles({width:"100%","float":"none"})}})},_initTopBarSubmenus:function(x){var y=new r({id:"persoMenu"});var w={profile:[{label:j.get("signOut"),onExecute:function(){window.location.href=x+"/logout?service="+encodeURIComponent(window.location.origin+"/enovia/resources/ordering")}}]};y.setContent(w);i.MainMenuBar.setActiveMenuProviders("persoMenu")}})});define("DS/Store/StoreRegistrationBodyPage",["UWA/Core","UWA/Utils","UWA/String","DS/UIKIT/Input/Button","DS/Store/StoreBodyPage","DS/MPFUrl/UrlUtils","DS/MPFDataProxy/AppsConnector","i18n!DS/Store/assets/nls/StoreComponents"],function(h,e,g,d,f,b,a,c){return f.extend({render:function(){var j;var i;j=h.createElement("div",{"class":"step-info",html:g.format(c.get("accessToMy3DExperienceMessage"),h.createElement("span",{"class":"ds-blue",html:[{tag:"strong",text:"3D"},"EXPERIENCE Social Collaboration Services"]}).outerHTML,h.createElement("strong",{text:"3DEXPERIENCE ID"}).outerHTML,h.createElement("strong",{text:"SOLIDWORKS ID"}).outerHTML)});i=new d({value:c.get("login"),className:"primary login",events:{onClick:this._onClick.bind(this)}});this._parent();this._updateNavTabs(1);this.stepInfoContainer.setContent(j);this.greyContainer.setContent(i);return this},_onClick:function(){a.fetchPromiseSynchro().then(function(i){var k;var j;j=(new b(window.location.href)).setPath("/enovia/resources/ordering/token").getUrl();k=(new b(i.rootUrl)).addParameter("platform",i.platformId).addParameter("url",e.base64Encode(j)).addParameter("roles","MPU").getUrl();window.location.href=k})}})});define("DS/Store/StoreRegistrationPage",["UWA/Core","UWA/Utils","UWA/Class/View","DS/UIKIT/Mask","DS/i3DXCompass/i3DXCompass","DS/TopBar/TopBar","DS/MPFDataProxy/AppsConnector","DS/MPFAppsPlatform/PublicPlatformsDataProxy","DS/MPFAppsPlatform/PlatformCollection","DS/MPFAppsPlatform/ServiceEnum","DS/Store/StoreHeaderPage","DS/Store/StoreRegistrationBodyPage","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/Usage/UsageManager","i18n!DS/Store/assets/nls/StoreComponents","css!DS/Store/Store","css!DS/TopBar/TopBar","css!DS/i3DXCompass/i3DXCompass"],function(l,k,b,h,m,i,g,d,c,n,o,j,f,e,p){var a={};a.LOADING="loading";a.ACTIVE="active";return b.extend({className:"page-container",init:function(q){var r=this;this._parent(q);this.stateMachine=new f({state:a.LOADING,states:[a.LOADING,a.ACTIVE],transitions:[{from:a.LOADING,to:a.ACTIVE},{from:a.ACTIVE,to:a.LOADING}]});l.createElement("div",{id:"my-apps-ct"}).inject(document.body,"top");this._getPlatform().then(function(s){var t;t=s.services.get(n.PASSPORT.name);if(!(t)){throw new Error("Passport service not found")}r._initTopBar(t.getUrl());r._initCompass();r.stateMachine.changeState(a.ACTIVE);r.render(t.getUrl())});e.init("/upload","My3DExperience")},render:function(s){var t=this;var r=document.getElementById("topbar");var u;var v;var q;u=this.stateMachine.getState();if(u===a.LOADING){h.mask(this.container)}else{v=new o();q=new j();t.container.setContent([v.render(),q.render()]);r.style.display="flex";if(l.is(r.getElement(".topbar-menu-item-badge"))){r.getElement(".topbar-menu-item-badge").setStyle("display","none")}h.unmask(t.container)}e.pages.push({url:"LoginPage",timestamp:Date.now()});return this},_getPlatform:function(){var r;var t;var q;r=new g(window.location.origin+"/enovia/resources/AppsMngt");t=new d(r);q=new c([],{dataProxy:t});function s(v){return v.services.get(n.MARKETPLACE.name)}function u(v){return v.find(s)}return q.fetchPromise().then(u)},_initTopBar:function(r,q,s){i.init({brand:"Onboarding",topMenus:{profile:false,add:false,share:false,home:false,help:false},useTagger:false,userName:"",loginUrl:r+"/login?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash),signupUrl:r+"/register?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)});i.view.container.getElement(".topbar-center").remove()},_initCompass:function(){var r=this;var q;q={};if(window.location.hash){window.location.hash.substring(1,window.location.hash.length).split("/").forEach(function(t){var s=t.split(":");q[s[0]]=s[1]})}m.initialize({compassTarget:"compass_ctn",appsTarget:"my-apps-ct",myAppsBaseUrl:k.buildUrl(window.location,"../"),userId:q.userId,passportUrl:k.buildUrl(window.location,"assets/PassportStub"),proxyTicketUrl:k.buildUrl(window.location,"assets/AppStub/ticket?url=V6"),lang:"en",closable:true,onOpen:function(){r.container.setStyles({width:"80%","float":"right"})},onClose:function(){r.container.setStyles({width:"100%","float":"none"})}})}})});