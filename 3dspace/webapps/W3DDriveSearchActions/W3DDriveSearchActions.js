define("DS/W3DDriveSearchActions/searchSharedView",["UWA/Core","UWA/Utils","UWA/String","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/W3DDriveSearchActions/assets/nls/W3DDriveSearchActions","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css","css!DS/UIKIT/UIKIT.css"],function(m,g,c,i,b,o){function d(q,p){var r=q+"/api/user/getpicture/login/"+p+"/format/normal";return r}function l(p){if(p.image){return new UWA.Element("img",{"class":"img-circle search-detail__card__block__img",src:p.image})}else{if(p.icon){return new UWA.Element("div",{"class":p.icon+" search-detail__card__block__icon",tag:"span"})}}return null}function k(q){var p=document.createElement("div");p.classList.add("search-detail__card__block");var r=l(q);p.appendChild(r);return p}function h(){var p=document.createElement("div");p.classList.add("search-detail__share__info");p.appendChild(new UWA.Element("p",{"class":"fonticon fonticon-lock search-detail__share__info__icon"}));p.appendChild(new UWA.Element("p",{text:o.notShared}));return p}function n(p){var t=0;p.forEach(function(u){t=t+u.length});if(t===0){return h()}var q=document.createElement("div");q.classList.add("search-detail__card");function r(u,y){var x=0,v,z;for(v=0;v<u.length;++v){var w=u[v];for(z=0;z<w.length;++z){q.appendChild(k(w[z]));x++;if(x>=y){return}}}}var s=5;r(p,s);return q}function e(p){return new Promise(function(r,q){b.getServiceUrl({serviceName:"3DDrive",platformId:p,onComplete:r,onFailure:q})})}function a(p){return new Promise(function(r,q){b.getServiceUrl({serviceName:"3DSwym",platformId:p,onComplete:r,onFailure:q})})}function j(q){var t=document.createElement("div");var p=q.id;var u=q.tenant;var s=e(u)["then"](function(w){var v=w;return Promise.resolve(v)});var r=a(u)["then"](function(w){var v=w;return Promise.resolve(v)});return Promise.all([s,r]).then(function(z){var y=z[0];var x=z[1];var w=new Promise(function(D,C){if(y){var B=c.format("{0}/resources/3ddrive/v1/bos/{1}/accesses?tenant={2}",y,p,u);var A={id:"id",title:"name",access:"accessright",login:"login"};i.authenticatedRequest(B,{method:"GET",type:"json",onComplete:function(G){var E=[],F=[];if(G.accesses){E=G.accesses;E.forEach(function(I){var H={};Object.keys(A).map(function(J){H[J]=I[A[J]]});if(I.lname==="Unknown"){H.title=I.email}H.image=d(x,H.login);F.push(H)})}D(F)},onFailure:function(){}})}});var v=new Promise(function(D,C){if(y){var B=c.format("{0}/resources/3ddrive/v1/bos/{1}/groupaccesses?tenant={2}",y,p,u);var A={id:"id",title:"title",description:"members",access:"accessright"};i.authenticatedRequest(B,{method:"GET",type:"json",onComplete:function(G){var E,F=[];if(G.accesses){E=G.accesses;E.forEach(function(I){var H={};Object.keys(A).map(function(J){H[J]=I[A[J]]});H.icon="fonticon fonticon-users-group";F.push(H)});D(F)}},onFailure:function(){}})}});return Promise.all([w,v]).then(function(A){t.appendChild(n(A));return t})})}function f(q){var p=document.createElement("div");j(q).then(function(r){p.appendChild(r)});return p}return f});define("DS/W3DDriveSearchActions/searchPropertiesView",["i18n!DS/W3DDriveSearchActions/assets/nls/W3DDriveSearchActions","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css"],function(g){function a(j){if(!(typeof j==="string"||j instanceof String)){return""}var i={catanalysis:"CATAnalysis",catdrawing:"CATDrawing",catmaterial:"CATMaterial",catpart:"CATPart",catprocess:"CATProcess",catproduct:"CATProduct",catshape:"CATShape",catsystem:"CATSystem"};return i.hasOwnProperty(j.toLowerCase())?i[j.toLowerCase()]:j.toUpperCase()}function b(i){var j=document.createElement("div");j.classList.add("search-detail__table__property-row__cell");j.classList.add("search-detail__table__property-row__cell--label");j.textContent=i;return j}function f(i){var j=document.createElement("div");j.classList.add("search-detail__table__property-row__cell");j.classList.add("search-detail__table__property-row__cell--value");j.textContent=i;return j}function c(i,l){var k=document.createElement("div");var j=b(i);var m=f(l);k.classList.add("search-detail__table__property-row");[j,m].map(k.appendChild.bind(k));return k}function e(i){var j=document.createElement("div");j.classList.add("search-detail__properties__table");i=i.map(function(k){return c(k.txt,k.val)});i.map(j.appendChild.bind(j));return j}function d(j){function q(B){var C=" ",z=["B","KB","MB","GB","TB"],A,i,y;for(y=0;y<=z.length;y++){A=Math.pow(1000,y);i=Math.pow(1000,y+1);if(B>=A&&B<i){C=C+z[y];if(A>0){B=B/A}break}}return(Math.round(B*100)/100)+C}var w="ds6wg:filesize";var k="ds6w:type";var v="ds6w:label";var l="ds6w:docExtension";var p=[k,v,w,"ds6w:created","ds6w:modified","ds6w:responsible"];var t=[];var x=p.length;var n;for(n=0;n<x;n++){var s=p[n];var r=j.get(s);if(s===w&&!!r){r=q(r)}if(s===k){var u;if(r==="document"){u=j.get(v);var o=u.lastIndexOf(".");if(o>=0){r=a(u.slice(o+1))}else{r=null}}else{if(r==="File"){u=j.get(l);r=a(u)}else{r=g.folder}}}var m=g.get(s);if(!!r){t.push({id:s,title:m,value:r})}}return t}function h(i){var j=d(i);return Object.assign(j)}return h});define("DS/W3DDriveSearchActions/sharedFacet",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Class","DS/EditPropWidget/facets/Common/FacetsBase","DS/UIKIT/Scroller","DS/W3DDriveSearchActions/searchSharedView","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css"],function(g,f,h,c,d,b,e){var a=c.extend(h,d,{init:function(i){this._parent(i);this._initUI()},_initUI:function(){this.elements.container=UWA.createElement("div");this.elements.contentScroll=UWA.createElement("div");this.elements.scroller=new b({element:this.elements.contentScroll}).inject(this.elements.container)},updateFacet:function(){var k=this;this.elements.contentScroll.empty();var i=this.getModel();if(i){var m=i.get("objectId");var l=i.get("tenant");var j={id:m,tenant:l};k.elements.contentScroll.appendChild(e(j))}},destroyComponent:function(){},onResize:function(){},onRefresh:function(){this.updateFacet()}});return a});define("DS/W3DDriveSearchActions/3DDrivePreview",["UWA/Core","UWA/Class/View","DS/3DPlaySupport/AssetSupport","DS/SNInfraUX/SearchPreviewContainer","DS/W3DDriveSearchActions/searchPropertiesView","css!DS/W3DDriveSearchActions/W3DDriveSearchActions.css"],function(c,b,d,a,f){var e=a.extend({_isFacetSupported:false,init:function(g){this._parent(g)},getPrimaryContent:function(g){this._isFacetSupported=true;if(!c.is(g)||!c.is(g.searchmodel)){return}if(c.is(g.onFailure,"function")){g.onFailure.call()}},getSecondaryContent:function(h){if(!c.is(h)||!c.is(h.searchmodel)){return}if(c.is(h.onFailure,"function")){var g=f(h.searchmodel);h.onFailure.call(null,g)}},isFacetSupported:function(){return this._isFacetSupported}});return e});define("DS/W3DDriveSearchActions/3DDrive",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/String","DS/WAFData/WAFData","DS/3DPlaySupport/AssetSupport","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/W3DDriveSearchActions/3DDrivePreview","i18n!DS/W3DDriveSearchActions/assets/nls/W3DDriveSearchActions"],function(h,i,f,c,g,a,b,e,j){var d=i.singleton(f,{_3DDriveDefaultPreview:null,init:function(){this._3DDriveDefaultPreview=null},_viewIn3DDrive:function(p,l,k,m){function q(t,v){t=t+"/#app:X3DDRIV_AP/content:";var w="granted-"+l+"=true";var r="firstlyLoading=false";var u=(m.indexOf("Folder")>-1)?"/content":"/preview";var s="saved-fragment="+encodeURIComponent("drives/"+l+"/mimetype/text%2Fdirectory/inode/"+p+u);window.open(t+w+"&"+r+"&"+s,v)}var o="_top";if(k!=="3DDashboard"){o="_blank"}var n;b.getServiceUrl({serviceName:"3DDashboard",onComplete:function(r){r.map(function(s){if(s.platformId===l){n=s.url;q(n,o)}})}})},_downloadFrom3DDrive:function(k,n,o,m){var l;b.getServiceUrl({serviceName:"3DDrive",onComplete:function(p){p.map(function(r){if(r.platformId===n){l=r.url}});if(l){var q=c.format("{0}/resources/3ddrive/v1/bos/{1}/download/?tenant={2}",l,k,n);g.authenticatedRequest(q,{type:"json",onComplete:function(r){if(!r){m({message:j.replace(j.emptyDownload,{name:o}),className:"warning",autoHide:true});return}require(["DS/W3DDrive/Actions/download"],function(s){s(r.url,"POST")})},onFailure:function(){throw new Error("Download failed.")}})}}})},getActionsPath:function(k){if(h.is(k)&&h.is(k.platformID)){return"/resources/3ddrive/v1/actions?tenant="+k.platformID}else{throw ("INVALID inputs for getActionsPath, platformID is missing")}},is3DPlayAvailable:function(m){function l(o){var q={provider:"FILE",physicalid:o.model.id,filename:o.model.get("ds6w:label"),format:o.model.get("ds6w:docExtension"),type:o.model.get("ds6w:docExtension")};var r={usage:"preview"};var p=false;a.checkSupport(q,r,function(s){p=s});return p}if(h.is(m)&&h.is(m.onComplete,"function")){var k=m.model;if(h.is(k)){var n=k.get("ds6w:type_value");if((n==="DriveFile")&&l(m)){m.onComplete({availability:true})}else{m.onComplete({availability:false})}}}},get3DPlayOptions:function(l){var m=this;if(h.is(l)&&h.is(l.onComplete,"function")&&h.is(l.onFailure,"function")){var k=l.model;var n=l.defaultPlayOptions;if(h.is(k)&&h.is(n)&&h.is(l.serviceURL,"string")){if(h.is(n.input)&&h.is(n.input.asset)){n.input.asset=h.merge({provider:"3DDRIVE",physicalid:k.id,dtype:k.get("ds6w:type_value"),tenant:k.getPlatformID()},n.input.asset);l.onComplete.call(m,n,null,l)}}}},executeAction:function(o){var r=o.action_id;var m=o.object_ids[0];var l=o.actionsHelper.getPlatformID({id:m});var k=o.actionsHelper.getClientInfo().identifier;var n=o.actionsHelper.getValue({id:m,attribute:"ds6w:type"});var q=o.actionsHelper.getValue({id:m,attribute:"ds6w:label"});var p=o.actionsHelper.displayAlert;switch(r){case"download":this._downloadFrom3DDrive(m,l,q,p);break;case"view":this._viewIn3DDrive(m,l,k,n);break;default:throw new Error("Action id ["+r+"] is not supported")}},getRenderPreview:function(k){if(!h.is(k)||!h.is(k.searchmodel)){return}var l=this;var m=function(n){l._3DDriveDefaultPreview=new e();n.onComplete.call(undefined,l._3DDriveDefaultPreview)};if(l._3DDriveDefaultPreview===null){m(k)}else{k.onComplete.call(undefined,l._3DDriveDefaultPreview)}},getFacets:function(m){if(UWA.is(m)&&UWA.is(m.model)&&UWA.is(m.constants)){if(UWA.is(m.setFacets,"function")&&UWA.is(m.addFacets,"function")){var n=[m.constants.FACET_PROPERTIES];var o=[{name:m.constants.FACET_PROPERTIES,text:j.properties,icon:"attributes",expandedFlag:true}];m.setFacets.call(undefined,n,o);if(this._3DDriveDefaultPreview&&this._3DDriveDefaultPreview.isFacetSupported()===true){var k=m.model.getType();if(k==="DriveFile"||k==="DriveFolder"){var p={name:"sharedwith",text:j.sharedWith,icon:"users",expandedFlag:true,height:"130px"};var l={require:"DS/W3DDriveSearchActions/sharedFacet",facet:p};m.addFacets([l])}}}}},getDoubleClickAction:function(l){if(h.is(l,"object")&&h.is(l.model)&&h.is(l.appID)){if("X3DSEAR_AP"===l.appID){var k=l.model.getType();if(k==="document"||k==="folder"){l.onFailure.call(undefined,"no action available for double click on object of type "+k)}else{l.onComplete.call(undefined,{id:"view",sourceJS:"DS/W3DDriveSearchActions/3DDrive"})}}}}});return d});