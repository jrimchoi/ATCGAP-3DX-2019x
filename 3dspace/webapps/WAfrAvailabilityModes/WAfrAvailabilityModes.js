define("DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent",["text!DS/WAfrAvailabilityModes/assets/afr/availabilitymodes/AFR_DEFAULT_AVAILABILITY_MODES.json","UWA/Class/Promise"],function(l,e){var f="DEACTIVATED";var b=JSON.parse(l);function k(){return e.resolve(b)}function r(y,A,z){var w=false;var x=y._private._defaultModesValues;if(x.hasOwnProperty(A)&&(x[A].values.hasOwnProperty(z)||z===f)){w=true}return w}var v=Object.create(null);v.DEFAULT_COMPONENT_NAME="AFR_AvailabilityModesComponent";var q="[AVAILABILITY_MODE]";var g=false;v.setDebugMode=function(x){if(x!==undefined&&typeof x==="boolean"&&g!==x){g=x;var w;if(g){w=new Error("Debug mode activated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}else{w=new Error("Debug mode deactivated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}}};var p="[DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent]";var c=p+"_b_";var h=p+"_e_";var s=p+"_m_";var a=false;v.setProbeMode=function(x){if(x!==undefined&&typeof x==="boolean"&&a!==x){a=x;var w;if(a){w=new Error("Probe mode activated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}else{w=new Error("Probe mode deactivated - DO NOT USE IN PRODUCTION");w.name="Warning";console.warn(w.stack)}}};function t(x,w){if(undefined===x||null===x||undefined===w||null===w){throw new Error("probesId and identifier has to be defined")}if(a){window.performance.mark(c+w+x)}}function n(A,x){if(undefined===A||null===A||undefined===x||null===x){throw new Error("probesId and identifier has to be defined")}if(a){window.performance.mark(h+x+A);var y=s+x+A;window.performance.measure(y,c+x+A,h+x+A);if(g){var w=window.performance.getEntriesByName(y);var z=w[w.length-1];console.log(q+" [PROBES] "+x,z)}}}v.AvailabilityModesComponent=function(){this._private=Object.create(null);this._private._probesId=new Date().valueOf()};v.AvailabilityModesComponent.DEFAULT_COMPONENT_NAME=v.DEFAULT_COMPONENT_NAME;v.AvailabilityModesComponent.prototype.initialize=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.initialize");this._private._currentModes={};this._private._clients={};this._private._nextClientUid=0;var x=this;if(!this._private._defaultModesValues){var y=k().then(function z(A){x._private._defaultModesValues=A;n(x._private._probesId,"AvailabilityModesComponent.prototype.initialize");return e.resolve()},function w(A){throw A});return y}else{n(this._private._probesId,"AvailabilityModesComponent.prototype.initialize");return e.resolve()}};function o(w){for(var x in w){if(w.hasOwnProperty(x)){delete w[x]}}}v.AvailabilityModesComponent.prototype.clean=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.clean");if(!this._private||!this._private._clients||!this._private._currentModes){throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize")}o(this._private._currentModes);o(this._private._clients);this._private._nextClientUid=0;n(this._private._probesId,"AvailabilityModesComponent.prototype.clean");return e.resolve()};v.AvailabilityModesComponent.prototype.destroy=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.destroy");if(!this._private||!this._private._clients||!this._private._currentModes){throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize")}delete this._private._currentModes;delete this._private._clients;delete this._private._nextClientUid;delete this._private._defaultModesValues;n(this._private._probesId,"AvailabilityModesComponent.prototype.destroy");return e.resolve()};v.AvailabilityModesComponent.prototype.canBeParallelized=function(){return false};function j(){return e.resolve()}v.AvailabilityModesComponent.prototype.getExposedComponentCtor=function(){t(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor");var x=this;function w(){}w.prototype.initialize=j;w.prototype.clean=j;w.prototype.destroy=j;w.prototype.subscribe=x.subscribe.bind(x);w.prototype.unsubscribe=x.unsubscribe.bind(x);w.prototype.publish=x.publish.bind(x);w.prototype.canBeParallelized=x.canBeParallelized.bind(x);n(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor");return w};function u(w){if(!w||!w.getAvailabilityModesInfo||typeof w.getAvailabilityModesInfo!=="function"||!w.onAvailabilityChanged||typeof w.onAvailabilityChanged!=="function"){throw new Error("element is not defined or it does not implement required methods")}}v.AvailabilityModesComponent.prototype.subscribe=function(y){t(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe");u(y);var x=this._private._clients;for(var A in x){if(x.hasOwnProperty(A)){if(x[A]===y){throw new Error("Trying to subscribe an element which is already registered",y)}}}if(x.hasOwnProperty(this._private._nextClientUid)){throw new Error("Internal Error")}x[this._private._nextClientUid]=y;++this._private._nextClientUid;var w=this._private._defaultModesValues;var z=this._private._currentModes;i(this,y,{currentModes:z,defaultModes:w});n(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe");return this._private._nextClientUid-1};v.AvailabilityModesComponent.prototype.unsubscribe=function(x){t(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe");var w=this._private._clients;if(!w.hasOwnProperty(x)){throw new Error("No element registered with this token",x)}delete w[x];n(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe")};function m(D,B){var A=JSON.parse(JSON.stringify(D));var y=JSON.parse(JSON.stringify(B));for(var C in y){if(y.hasOwnProperty(C)){if(!A[C]){throw new Error(q+" Unsupported availability mode ("+C+")")}var z=A[C].values;var w=y[C].values;for(var x in w){if(w.hasOwnProperty(x)){if(w[x]!==z[x]){z[x]=w[x]}}}}}return A}function i(w,A){var x=w._private._defaultModesValues;var y=w._private._currentModes;var D=A.getAvailabilityModesInfo();if(!D||undefined===D.currentAvailability){throw new Error("Cannot retrieve availabilityModes information for this client",A)}var F=null;var z=null;F=D.modes||{};z=D.currentAvailability;var B=m(x,F);var G=null;var C=null;var E=false;for(G in y){if(y.hasOwnProperty(G)){C=y[G];if(B[G].values[C.selected]===false){E=true;if(z){setTimeout(A.onAvailabilityChanged.bind(A,false,{mode:C,value:C.selected}),0)}break}}}if(!E&&!z){setTimeout(A.onAvailabilityChanged.bind(A,true),0)}}function d(y){if(g){console.log(q+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - Begin computation",y._private._clients)}t(y._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync");var w=y._private._clients;for(var x in w){if(w.hasOwnProperty(x)){i(y,w[x])}}n(y._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync");if(g){console.log(q+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - End computation",y._private._clients)}}v.AvailabilityModesComponent.prototype.publish=function(w){if(g){console.log(q+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - Before computation",this._private._currentModes)}t(this._private._probesId,"AvailabilityModesComponent.prototype.publish");var z=w.mode;var y=w.data;var x=w.value;if(!z||x===undefined){throw new Error("settings.mode, settings.value has to be defined")}if(!r(this,z,x)){throw new Error("INVALID MODE OR VALUE",z,x)}var A=false;if(!this._private._currentModes.hasOwnProperty(z)){if(x!==f){this._private._currentModes[z]={selected:x,data:y};A=true}}else{if(this._private._currentModes[z].value!==x){if(x===f){delete this._private._currentModes[z]}else{this._private._currentModes[z]={selected:x,data:y}}A=true}}if(A){d(this)}if(g){console.log(q+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - After computation",this._private._currentModes)}n(this._private._probesId,"AvailabilityModesComponent.prototype.publish")};return v});