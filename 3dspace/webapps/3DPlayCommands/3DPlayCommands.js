/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/3DPlayCommands/CmdShowAll",["DS/ApplicationFrame/Command","DS/Visualization/PathElement"],function(a,c){var b=a.extend({init:function(d){this._parent(d,{isAsynchronous:false,mode:"exclusive"})},execute:function(){var i=this.getFrameWindow().getViewer();var h=this.getFrameWindow().experience;var e=h.getRootBag();var d=i.createSceneGraph("VisibilitySG",e);var f=new c([e]);var g=d.getOverridesFromPathElement(e);if(g){g.forEach(function(j){if(j.getOpacity()!==undefined){j.getPathes().forEach(function(k){d.setOpacity(k,null)})}if(j.getPickability()!==undefined){j.getPathes().forEach(function(k){d.setPickability(k,null)})}if(j.getVisibility()!==undefined){j.getPathes().forEach(function(k){d.setVisibility(k,null)})}})}i.render({updateInfinitePlane:true});d=null;if(h.notifyAction&&h.collabMode===true){h.notifyAction("showAll")}}});return b});var cmd="DS/DMUMeasure/DMUCreateMeasureCmd";define("DS/3DPlayCommands/Proxy/CmdMeasureProxy",[cmd,"DS/WebUtils/Tracker"],function(a,b){return a.extend({execute:function(){b.inc("command-"+this.getId());this._parent.apply(this,arguments)}})});var cmd="DS/DMUSection/DMUCreateSectionCmd";define("DS/3DPlayCommands/Proxy/CmdSectionProxy",[cmd,"DS/WebUtils/Tracker"],function(b,a){return b.extend({execute:function(){a.inc("command-"+this.getId());this._parent.apply(this,arguments)}})});define("DS/3DPlayCommands/CmdExplode",["DS/ApplicationFrame/Command","DS/CoreEvents/Events"],function(b,a){var c;return b.extend({init:function(e){var h=this;this._parent(e,{isAsynchronous:true});var g=this.getFrameWindow();var d=this.getFrameWindow().experience;var f=function(){var j=undefined;if(!j&&g&&d){j=d.getRootBag()}if(j){var k=0;var i=function(o){if(o!==undefined&&o.name!=="annotGroupNode"){if(o.children!==undefined&&o.children.length>0){var m=o.children.length;for(var n=0;n<m;n++){var p=o.children[n];i(p)}}else{k++}}};i(j);if(k>1){h.enable()}else{h.disable()}}};if(d&&d.modelLoadComplete){f()}if(d){this._onModelLoadingFinshedToken=d.subscribe("ASSET/LOADINGFINISHED/",f)}},_destroy:function(){if(this._onModelLoadingFinshedToken&&this.getFrameWindow()&&this.getFrameWindow().experience){this.getFrameWindow().experience.unsubscribe(this._onModelLoadingFinshedToken)}if(this.exp&&this._isRunning){this.exp.endExecute()}if(this.exp){this.exp.dispose();this.exp=null}this._parent()},beginExecute:function(){var f=this;var e=this.getFrameWindow();if(!this.exp){var d=["DS/3DPlayCommands/FunctionExplode"];require(d,function(g){if(g){f.exp=new g({frameWindow:e,ctx:f._ctx});f.exp.beginExecute()}})}else{this.exp.beginExecute()}},endExecute:function(){if(this._isRunning&&this.exp){this.exp.endExecute()}},setExplodeTimelineValue:function(d){this.exp.myExplodeTimeline.setValue(d)}})});define("DS/3DPlayCommands/CmdShareBase",["DS/ApplicationFrame/Command","DS/WebUtils/Tracker"],function(a,b){return a.extend({init:function(c){this._parent(c,{isAsynchronous:true});this.enable()},execute:function(){b.inc("command-"+this.getId());var c=this.getFrameWindow();var d=c.experience;if(d&&this.shareWithPanelManager){this.shareWithPanelManager(d.PanelManager)}this.end()}})});define("DS/3DPlayCommands/CmdENOPADStream",["DS/WebUtils/Tracker","DS/WebInfraUI/ConfirmBox","i18n!DS/3DPlayCommands/assets/nls/CmdENOPADStream","DS/WebSystem/Environment","DS/WebSystem/Preference"],function(d,f,b,c,a){var e=[];return function(g){if(c.isSet("3DPlay.FUN088072.Disable")){return{}}else{var h={destroy:function(){e=[];this._parent()},init:function(i){var l=this.changeIcon.bind(this);this._parent(i);var j=this.getFrameWindow();if(j){var k=j.experience;if(k){if(k.pad3DViewer){if(e.length===0){k.subscribe("ASSET/LOADINGSTARTED",l,true)}e.push(i.ID);if(k.modelLoadComplete){l()}else{k.subscribeOnce("ASSET/LOADINGFINISHED",l,true)}}}}},changeIcon:function(){if(false){var n,p=this.getFrameWindow();if(p){n=p.experience}var q=n.rootLoadedStream==="thumbnail";var k=document.getElementsByClassName("wux-afr-cmdstarter");for(var o=k.length;o--;){if(k[o]){var l=k[o].getAttribute("data-command");for(var r=e.length;r--;){if(l===e[r]){var m=k[o].children[0];var j=m.style.backgroundImage;j=j.substr(0,j.lastIndexOf(".png"))+(q?"-reload":"")+'.png")';m.style.backgroundImage=j}}}}}},testStream:function(m){var q=this.getFrameWindow();if(q){var l=q.experience;if(l){if(l.pad3DViewer){if(l.rootLoaded&&l.rootLoaded.length){if(l.rootLoadedStream==="thumbnail"){var o=c.get("3DPlay.CGRPolicy")||"index";var n=this,s,k,r,p=function(){n=null,l=null},j=function(){l.ENOPADConnectorPolicy="cgr";l.clearView();m.apply(n);l.loadAsset({asset:l.args.lastLoad});l.subscribeOnce("ASSET/LOADINGFINISHED",p)};var i=0;if(l.enopadStatistics){if(l.enopadStatistics.nbCgrLoaded>0){if(l.enopadStatistics.nbThbLoaded===0){m.apply(this);return}else{i=Math.floor(100*l.enopadStatistics.nbCgrLoaded/(l.enopadStatistics.nbThbLoaded+l.enopadStatistics.nbCgrLoaded))}}}if(o==="auto"){j()}else{s=b.General_Caption+" "+b.Warning_Preferences;k={callback:j,text:b.Button_Proceed};r={callback:function(){n.end();p()},text:b.Button_Cancel};f({warning:false,container:q.getViewerFrame(),caption:b.Title,info:[b.General_Caption,b.Confirm_General],checkBox:{text:b.CheckBox_Settings,callback:function(){a.set("3DPlay.CGRPolicy","auto")}},confirm:k,cancel:r})}return}}}}}m.apply(this)}};h[g]=function(){d.inc("command-"+this.getId());this.testStream(this._parent)};return h}}});define("DS/3DPlayCommands/CmdPublishToMake",["DS/ApplicationFrame/Command","DS/CoreEvents/Events"],function(a,b){var c=a.extend({init:function(d){this._parent(d,{isAsynchronous:true,mode:"exclusive"})},execute:function(){var e=this;var g=e.getFrameWindow().experience;var d=g.args.input.asset;var f=["DS/PlatformAPI/PlatformAPI"];require(f,function(h){h.publish("marketplace.make.sendContent",d)})},endExecute:function(){}});return UWA.namespace("ViewerCommands/PublishToMakeCmd",c)});define("DS/3DPlayCommands/EmptyNRCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/Manipulators/RotationManipulator","DS/Manipulators/PlaneTranslationManipulator","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/VisuEvents/EventsManager"],function(h,c,b,f,d,e,g){var a=c.extend({init:function(i){this._parent(i,{isAsynchronous:true,mode:"exclusive"});this.rotManip=null;this.transManip=null;this.initialMatrix=null;this._panLaunchCB=null},beginExecute:function(){var k=this.getFrameWindow()||FrameWindowsManager.getFrameWindow(options.context);var j=k&&k.getViewer();var i=j&&j.canvas;if(i){var l=this;l._panLaunchCB=function(m){if(m.state==="begin"){}else{var p=l.getFrameWindow().getViewer();var n=p.getRootNode();var o=n.getChildByName("RootBag").children[0];o.translateY(m.gesture.barycenter.x-m.gesture.lastBarycenter.x);o.translateX(m.gesture.barycenter.y-m.gesture.lastBarycenter.y)}};g.addEvent(k.getViewer().canvas,"onPan",l._panLaunchCB)}else{console.warn("Feature to execute emptyCmd cmd from onPan gesture could not be initialized...")}},resumeExecute:function(){var k=this.getFrameWindow().getViewer();var i=k.getRootNode();var j=i.getChildByName("RootBag").children[0];this.rotManip.linkToNode(j);this.rotManip.enable()},pauseExecute:function(){this.rotManip.disable()},execute:function(){var m=this;var j=new d.Vector3(0,0,1);this.rotManip=new b({axis:j});this.rotManip.setExclusive(true);var l=this.getFrameWindow().getViewer();var i=l.getRootNode();var k=i.getChildByName("RootBag").children[0];this.manipulatorToken=this.rotManip.linkToNode(i.getChildByName("RootBag"));this.rotManip.onBeginManipulate(function(o){if(m.rotManip.active){var q=m.getFrameWindow().getViewer();var n=q.getRootNode();var p=n.getChildByName("RootBag").children[0];m.initialMatrix=p.getMatrix();m.rotManip.setCenter(new d.Vector3().getPositionFromMatrix(m.initialMatrix))}});this.rotManip.onManipulate(function(r){if(m.rotManip.active){var q=r.rotationMatrix;var n=new d.Matrix4().copy(q);n.multiply(new d.Matrix4().extractRotation(m.initialMatrix));var p=n.setPosition(new d.Vector3().getPositionFromMatrix(m.initialMatrix));var t=m.getFrameWindow().getViewer();var o=t.getRootNode();var s=o.getChildByName("RootBag").children[0];s.setMatrix(p)}})},cancelExecute:function(j){this.rotManip.unlink(this.manipulatorToken);var l=this.getFrameWindow()||FrameWindowsManager.getFrameWindow(options.context);var k=l&&l.getViewer();var i=k&&k.canvas;if(i){g.removeEvent(i,"onPan",this._panLaunchCB)}},endExecute:function(){},});return a});define("DS/3DPlayCommands/VisibilityCommands",["DS/ApplicationFrame/Command","DS/WebInfraUI/ContextualBarManager","DS/WebUtils/ContextedSingleton","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/3DPlayUtils/VisibilityUtils","DS/CoreEvents/Events","DS/Visualization/PathElement","DS/3DPlay/3DPlay","DS/WebUtils/State","DS/WebViewer/SceneGraphHelper","DS/WebUtils/Tracker","DS/WebSystem/Nls","DS/WebInfraUI/NotificationScreen","DS/WebInfraUI/Notification"],function(n,e,c,g,q,l,f,i,m,r,h,a,o,d,p,k){var b=function(u){var t,s=u.getNodes();s.forEach(function(v){if(v.name==="RootBag"){t=v}});if(!t){t=s[0]}return t};var j=n.extend({init:function(s){this._parent(s,{isAsynchronous:true,mode:"exclusive"});this.framewindow=this.getFrameWindow()},beginExecute:function(){o.inc("command-"+this.getId());var y=this;var x=this.framewindow.getViewer();this.myDestroy=function(){y=null;x=null};if(!this.sceneGraphState){this.sceneGraphState=x.createSceneGraph("VisibilitySG",this.framewindow.experience.getRootBag())}this.prepicking=new h({getValue:function(){return x.pPicking.activated},restore:function(z){x.setPrePicking({activated:z})}});x.setPrePicking({activated:true});var v=[{id:"HideShow",rsc:"3DPlay/3DPlayExperience3D",nls:"3DPlay/3DPlayExperience3D",selected:true},{id:"ShowAll",rsc:"3DPlay/3DPlayExperience3D",nls:"3DPlay/3DPlayExperience3D"}];this.contextualMenu=new e({frameWindow:this.framewindow});var u=function(){if(y.framewindow.getActionBar().MAB&&y.framewindow.getActionBar().MAB.state.visible){y.framewindow.experience.notifScreen.clearAll();if(s.visible){s.disable(false)}}var z=y.sceneGraphState;var B=q.get();for(var A=0;A<B.length;A++){var D=B[A].pathElement||B[A];f.applyVisibilityToPath(y.sceneGraphState,D,false)}x.render({updateInfinitePlane:true});r.publish(y._ctx,"3DPLAY/HIDE",{ctx:y._ctx,data:B});var C="DS/PADUtils/PADContext";require([C],function(F){var E=F.get().getHideShowController();E.publish({event:"onHide",data:{nodes:[b(x)]}});B=null})};var t={type:this.contextualMenu.Button.Radio,onclickCB:function(E){if(E.id==="ShowAll"){if(y.token){q._modelEvents.unsubscribe(y.token);y.token=null}var z=y.sceneGraphState;var A=b(x);var B=new m([A]);var C=z.getOverridesFromPathElement(A);if(C){C.forEach(function(F){if(F.getOpacity()!==null){F.getPathes().forEach(function(G){z.setOpacity(G,null)})}if(F.getPickability()!==null){F.getPathes().forEach(function(G){z.setPickability(G,null)})}if(F.getVisibility()!==null){F.getPathes().forEach(function(G){z.setVisibility(G,null)})}})}y.clearSelection();r.publish(y._ctx,"3DPLAY/SHOW_ALL",{ctx:y._ctx});var D="DS/PADUtils/PADContext";require([D],function(H){var F=C?C.length:0;var G=H.get().getHideShowController();G.publish({event:"onShow",data:{nodes:[A],modifiedObjectsLength:F}});A=null});setTimeout(function(){y.contextualMenu.setSelected({token:y.contextualMenuToken,id:"HideShow",state:true});y.token=q.onAdd(u);u()},200)}if(E.id==="HideShow"){if(!y.token){y.token=q.onAdd(u);u()}}x.render({updateInfinitePlane:true})},content:v};this.contextualMenuToken=this.contextualMenu.addButtons([t],{barType:this.contextualMenu.Toolbar.New,showContextBarBackground:true});this.token=q.onAdd(u);var s=y.contextualMenu.panel.container.buttons[0].buttons[1];u();var w=this.framewindow.getActionBar();if(w&&w.MAB){w.MAB.onVisibilityChangeSubscribe("3DPlay-VisibilityCommands",function(z){if(z!=="hidden"){d.nls("3DPlay/3DPlay","visibilityAssistance",function(A){if(y.framewindow.experience.notifScreen){y.framewindow.experience.notifScreen.clearAll();r.sendEvent(y._ctx,eventType.notif,k.assistance,{msg:A});s.disable(true)}})}else{y.framewindow.experience.notifScreen.clearAll()}})}},endExecute:function(){this.framewindow.experience.notifScreen.clearAll();this.framewindow.getActionBar().MAB.onVisibilityChangeUnsubscribe("3DPlay-VisibilityCommands");this.contextualMenu.removeButtons(this.contextualMenuToken);this.contextualMenu.dispose();this.contextualMenu=undefined;if(this.token){q._modelEvents.unsubscribe(this.token);this.token=null}this.clearSelection();this.prepicking.restore();this.myDestroy&&this.myDestroy();this.myDestroy=null;this.frameWindow=undefined},clearSelection:function(){q.empty();g.empty();l.empty();this.framewindow.getViewer().render({updateInfinitePlane:true})},destroy:function(){if(this.sceneGraphState){this.sceneGraphState.dispose();this.sceneGraphState=null}}});return j});define("DS/3DPlayCommands/CmdHideShow",["DS/ApplicationFrame/Command","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/3DPlayUtils/VisibilityUtils","DS/CoreEvents/Events"],function(a,e,c,b,g,d){var f=a.extend({init:function(h){this._parent(h,{isAsynchronous:true,mode:"exclusive"})},hideShow:function(k){if(k.length==0){return null}var n=this.getFrameWindow().experience;if(n){var m=this.getFrameWindow().getViewer();var h=m.createSceneGraph("VisibilitySG",n.getRootBag());if(h){for(var j=0;j<k.length;j++){var l=k[j].pathElement||k[j];if(h.getVisibility(l)==false){g.applyVisibilityToPath(h,l,true);if(n.collabMode===true&&n.notifyAction){n.notifyAction("showNode",[n.createIdFromPath(l)])}}else{g.applyVisibilityToPath(h,l,false);if(n.collabMode===true&&n.notifyAction){n.notifyAction("hideNode",[n.createIdFromPath(l)])}}}}}this.end()},execute:function(){var h=this;var i=c.get();if(i.length==0){h.token=c.onAdd(function(){h.hideShow(i)})}else{h.hideShow(i)}},endExecute:function(){if(this.token){c._modelEvents.unsubscribe(this.token)}c.empty();e.empty();b.empty();this.getFrameWindow().getViewer().render({updateInfinitePlane:true})}});return UWA.namespace("ViewerCommands/VisuHideShowCmd",f)});define("DS/3DPlayCommands/CmdScenario",["UWA/Core","DS/ApplicationFrame/Command","DS/3DPlay/3DPlay","DS/3DPlay/3DPlayScenarioManager","DS/CoreEvents/Events","css!DS/3DPlayCommands/CmdScenario.css","DS/WebUtils/Tracker","DS/Core/PointerEvents","DS/WebSystem/Nls","DS/WebSystem/DetectBrowser"],function(f,l,w,c,o,k,s,g,d,m){var j;var t;var r=20;var n=20;var i;var v;var e;var h;var u=function(){var K=[];var A=new f.Element("div",{"class":"PlayWeb-Scroller",styles:{overflow:"hidden"}});var I=new f.Element("table",{id:"PlayWeb-ScrollContainer",styles:{margin:"0 auto",left:0,position:"relative"}}).inject(A);var F=new f.Element("tr",{id:"PlayWeb-ScrollList",styles:{position:"relative","justify-content":"center"}}).inject(I);var E=new f.Element("a",{"class":"fonticon fonticon-chevron-left Scrolling-Arrow "+e,styles:{left:0},events:{click:function(){J("left")}}}).inject(A);var G=new f.Element("a",{"class":"fonticon fonticon-chevron-right Scrolling-Arrow "+e,styles:{right:0},events:{click:function(){J("right")}}}).inject(A);var z=0;var H=false;var y=0;var J=function(N){var P=A.offsetWidth-I.scrollWidth;var L=0;var T=parseFloat(I.getStyle("left"));var S=I.scrollWidth-(Math.abs(T)+A.offsetWidth);var R=Math.abs(T)%h;var Q=0;if(T===0||R===0){Q=Math.min(S,h)}else{Q=R}var M=T;if(N==="left"){M+=Q}else{if(N==="right"){M-=Q}}if(M<=L&&M>=P){I.setStyle("transition","left 0.6s ease-in-out 0s");var O=function(){D();I.removeEventListener("transitionend",O,true);I.setStyle("transition","")};I.addEventListener("transitionend",O,true);I.setStyle("left",M)}};var D=function(){var M=parseFloat(I.getStyle("left"));var L=A.offsetWidth-I.scrollWidth;if(L>=0){G.setStyle("display","none");E.setStyle("display","none")}else{if(M>=z){G.setStyle("display","block");E.setStyle("display","none")}else{if(M<=L){G.setStyle("display","none");E.setStyle("display","block")}else{G.setStyle("display","block");E.setStyle("display","block")}}}};var x=function(L){if(I.scrollWidth>A.offsetWidth){H=true;y=L.clientX}};var C=function(O){if(H===true){var N=y;y=O.clientX;var L=A.offsetWidth-I.scrollWidth;var P=parseFloat(I.getStyle("left"));var M=P+(y-N);if(M<=z&&M>=L){I.setStyle("left",M);D()}}};var B=function(){H=false};A.addEvent(g.POINTERDOWN,x,true);A.addEvent(g.POINTERMOVE,C,true);A.addEvent(g.POINTERUP,B,true);I.inject(A);this.appendTo=function(L){A.inject(L);requestAnimationFrame(D)};this.addScrollItem=function(L){var M=new f.Element("td",{}).inject(F);L.appendTo(M);K.push(M)}};var b=function(){var x=new f.Element("div",{"class":"PlayWeb-ScenarioItemSepartor",styles:{width:"3px","background-image":"radial-gradient(#d4d4d4, white)",margin:n+"px",height:t+"px"}});this.appendTo=function(y){x.inject(y)}};var a=function(I){h=j;var B=c.getCurrentScenario();var H=c._getDefaultScenario();var F="#d1d4d4";if(B){if(B&&I&&B.scenarioID==I.scenarioId){F="#89CFF0"}}else{if(H&&I&&H.scenarioID==I.scenarioId){F="#89CFF0"}}var G=new f.Element("div",{"class":"PlayWeb-ScenarioItem",styles:{position:"relative",cursor:"pointer",margin:r+"px",width:j+"px",height:t+"px"},events:{click:function(){if(I.onSelectCB){I.onSelectCB(I.registerId,I.scenarioId,I.subScenarioId,true)}}}});if(I.showThumbnailOnly){var y=new f.Element("img",{"class":"PlayWeb-ScenarioThumbnail",src:I.thumbnail,styles:{height:"100%",width:"100%","pointer-events":"none"}}).inject(G);if(m().browser.name==="ie"){y.setStyle("background-repeat","no-repeat");y.setStyle("background-position","center");y.setStyle("background-size","contain")}else{y.setStyle("object-fit","scale-down")}}else{var A=new f.Element("div",{"class":"PlayWeb-ScenarioItemBack1",styles:{width:j+"px",height:t+"px",position:"absolute","background-color":"white",border:"1px solid "+F,top:"-10px",left:"-10px","pointer-events":"none"}}).inject(G);var z=new f.Element("div",{"class":"PlayWeb-ScenarioItemBack2",styles:{width:j+"px",height:t+"px",position:"absolute","background-color":"white",border:"1px solid "+F,top:"-5px",left:"-5px","pointer-events":"none"}}).inject(G);var x=new f.Element("div",{"class":"PlayWeb-ScenarioItemFront",styles:{width:j+"px",height:t+"px",position:"absolute","background-color":"white",border:"1px solid "+F,top:"0px",left:"0px",display:"flex","flex-direction":"column","align-items":"center","pointer-events":"none"}}).inject(G);var D=new f.Element("img",{"class":"PlayWeb-ScenarioThumbnail",src:I.thumbnail,styles:{height:i+"px",width:"100%","background-color":"#f4f5f6",border:"3px solid "+F,"pointer-events":"none"}}).inject(x);if(m().browser.name==="ie"){D.setStyle("background-repeat","no-repeat");D.setStyle("background-position","center");D.setStyle("background-size","contain")}else{D.setStyle("object-fit","scale-down")}var E=new f.Element("div",{"class":"PlayWeb-ScenarioNameContainer",styles:{height:v+"px","line-height":(v-5)+"px",border:"2px solid white","text-align":"center","pointer-events":"none",width:"100%"}}).inject(x);var C=new f.Element("span",{"class":"PlayWeb-ScenarioName",html:I.name,styles:{"font-family":"3ds","font-size":"16px",color:"#368ec4",width:"100%","pointer-events":"none",display:"inline-block","vertical-align":"middle","line-height":"normal"}}).inject(E)}this.appendTo=function(J){G.inject(J)}};var q=function(I){var x=new f.Element("div",{"class":"PlayWeb-ScenarioChooserMainPanel",styles:{position:"absolute","background-color":"#f4f5f6",opacity:0.9,border:"1px solid #d1d4d4","font-family":"3ds",width:I.width+"px",height:I.height+"px"}});var F=function(){x.remove()};if(I.showTopBar){var z=new f.Element("div",{id:"PlayWeb-ScenarioChooserTopBar",styles:{position:"relative"}}).inject(x);var E=new f.Element("span",{"class":"fonticon fonticon-close",styles:{cursor:"pointer",margin:"10px",position:"absolute",right:0,top:0},events:{click:function(){if(I.onCloseCB){I.onCloseCB()}}}}).inject(z)}var C=new f.Element("div",{id:"PlayWeb-ScenarioChooserContent",styles:{display:"flex","flex-direction":"column","justify-content":"center",width:"100%",height:"100%"}}).inject(x);var G=new f.Element("p",{id:"PlayWeb-ScenarioChooserTitle",styles:{color:"black","font-size":"20px","font-weight":"bold",margin:"10px"}}).inject(C);var H=new f.Element("span",{"class":"fonticon fonticon-close",styles:{cursor:"pointer",margin:"10px",position:"absolute",right:0,top:0},events:{click:function(J){if(I.onCloseCB){I.onCloseCB()}}}}).inject(C);d.nls("3DPlay/3DPlay","Scenario.PanelTitle",function(J){G.setContent(J)});var B=new u();for(var A=0;A<I.scenarios.length;A++){var y=new a(I.scenarios[A]);B.addScrollItem(y);if(A<I.scenarios.length-1&&I.showSeparator){var D=new b();B.addScrollItem(D);h=j+2*(r+n)+3}}B.appendTo(C);this.appendTo=function(J){x.inject(J)};this.getPosition=function(){return{top:x.offsetTop,left:x.offsetLeft}};this.setPosition=function(K,J){x.setStyles({top:K,left:J})};this.getDimensions=function(){return{height:x.offsetHeight,width:x.offsetWidth}};this.setDimensions=function(J,K){x.setStyles({height:J,width:K})};this.destroy=F};var p=l.extend({init:function(x){this._parent(x,{isAsynchronous:true});c._updateScenarioChooser()},_buildLayout:function(){var E=this;var y=Object.keys(c.getAllRegisters()).length;var x=this.getFrameWindow().getViewer().SCREEN_WIDTH;var F=this.getFrameWindow().getViewer().SCREEN_HEIGHT;if(x>=800){j=200;t=150;i=100;v=45;e="fonticon-3x"}else{if(x>=540&&x<800){j=160;t=120;i=70;v=45;e="fonticon-2x"}else{if(x>=320&&x<540){j=135;t=110;i=60;v=45;e="fonticon-2x"}else{j=80;t=60;e=""}}}var J=[];var I=c.getAllRegisters();var H=false;var z=c.getExperience();if(z&&(z._iOS||z._android)){H=true}for(var M in I){var C=c.getAllScenarioForRegister(M);for(var A=0;A<C.length;A++){var D=C[A].scenario;if(!((x<540||H)&&!D.isMobileCompatible())&&C[A].available){J.push({name:D.title,thumbnail:D.icon,showThumbnailOnly:(x<320),registerId:M,scenarioId:D.scenarioID,onSelectCB:function(Q,P,N,O){c.changeScenario(Q,P,N,O);E.end()}})}}}this.backgroundDiv=new f.Element("div",{"class":"PlayWeb-ScenarioChooserBackgroundPanel",styles:{position:"absolute",width:x+"px",height:F+"px"},events:{click:function(){E.end()}}});this.backgroundDiv.inject(this.getFrameWindow().getUIFrame());var B=(x<540)?F:250;var K=x;this.scenarioChooserUI=new q({scenarios:J,height:B,width:K,onCloseCB:function(){E.end()},showSeparator:(x>=540),showTopBar:(x<540)});this.scenarioChooserUI.appendTo(this.getFrameWindow().getUIFrame());var L=this.scenarioChooserUI.getDimensions();var G=this.viewerFrame.offsetHeight*0.5-L.height*0.5+"px";this.scenarioChooserUI.setPosition(G,"0px")},beginExecute:function(){o.publish({event:"3DPLAY/SPECTREE/DISABLE",data:{}})},execute:function(){s.inc("command-"+this.getId());var y=this;this.viewerFrame=this.getFrameWindow().getViewerFrame();var x=c.getAllScenarios().length;if(x<2){this.end()}else{this._buildLayout()}this._tokenVISUResizeEvent=o.subscribe({event:"/VISU/onWindowResized"},function(z){if(z.eventType==="@onWindowResized"){y.endExecute()}})},endExecute:function(){if(this.scenarioChooserUI){this.scenarioChooserUI.destroy();this.scenarioChooserUI=undefined}if(this.backgroundDiv){this.backgroundDiv.remove()}if(this._tokenVISUResizeEvent){o.unsubscribe(this._tokenVISUResizeEvent);this._tokenVISUResizeEvent=null}c._updateScenarioChooser();var x=this.getFrameWindow();if(x){var y=x.getActionBar();if(y){if(y.MAB&&y.MAB.state.visible===false){o.publish({event:"3DPLAY/SPECTREE/ENABLE",data:{}})}}}}});return p});define("DS/3DPlayCommands/EmptyCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(b,a){return a.extend({init:function(c){this._parent(c,{isAsynchronous:true})}})});define("DS/3DPlayCommands/CmdFS",["DS/ApplicationFrame/Command","DS/3DPlayUtils/FullScreen","DS/WebSystem/Environment"],function(b,a,c){return b.extend({init:function(d){var h=this;this._parent(d,{isAsynchronous:true});this.disable();var f=this.getFrameWindow();var e=(f&&f.experience&&f.experience.args)?f.experience.args:{};this._fsUtil=new a(e.container,e.options.fullscreen,e.widget);if(this._fsUtil.getMode()!=="none"){var g=f.getActionBar();if(g&&g.elements&&g.elements.container&&c.isSet("3DPlay.AllowFSCmd")){this.enable();g.elements.container.addClassName("PlayWebAllowFullScreen");if(e.options.fullscreen&&e.options.fullscreen.activateOnStart){this.execute()}}}},execute:function(){this._fsUtil.toggle();this.end()}})});define("DS/3DPlayCommands/3DPlayCommands",[],function(){});var transparencyVal=0.1;define("DS/3DPlayCommands/FunctionExplode",["DS/3DPlay/3DPlay","UWA/Core","DS/ApplicationFrame/Command","DS/Controls/Timeline","DS/Visualization/ThreeJS_DS","DS/Visualization/PathElement","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/CoreEvents/Events","DS/VisuEvents/EventsManager","DS/3DPlayUtils/SpreadGesture","DS/WebUtils/Profiler","DS/WebUtils/State","DS/3DPlayUtils/VisibilityUtils","DS/WebInfraUI/Touch","DS/3DPlayUtils/UIManager","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/WebViewer/SceneGraphHelper","css!DS/3DPlayCommands/CmdExplode"],function(t,e,k,f,s,q,r,h,o,n,b,j,i,g,l,u,m,c,a){var d=function(x){var w,v=x.getNodes();v.forEach(function(y){if(y.name==="RootBag"){w=y}});return w};var p=e.Class.extend({init:function(v){this.frameWindow=v.frameWindow;this.viewer=this.frameWindow.getViewer();this.UIManager=new u(v);this.addUIControls()},dispose:function(){this.frameWindow=null;this.viewer=null;this.UIManager=null;this.myExplodeTimelineContainer=null;this.sceneGraphState=null},addUIControls:function(){var y=this;this.myExplodeTimelineContainer=new e.Element("div",{"class":"CmdExplode-Container"});this.myExplodeTimeline=new f({minValue:0,maxValue:100,value:0,dynamicGraduations:false,dynamicGaugeColor:false,graduationsLabel:false,eventsList:[{label:"0%",value:0},{label:"50%",value:50},{label:"100%",value:100}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(this.myExplodeTimelineContainer);var v=new e.Element("a",{html:'<span class="fonticon fonticon-left-open"></span>',"class":"wux-timeline-controls CmdExplode-Button CmdExplodeFontSizeMedium a"}).inject(this.myExplodeTimelineContainer);l(v).on("tap",function(B){y.explode("rewind")});var A=new e.Element("a",{html:'<span class="fonticon fonticon-right-open"></span>',"class":"wux-timeline-controls CmdExplode-Button CmdExplodeFontSizeMedium a"}).inject(this.myExplodeTimelineContainer);l(A).on("tap",function(B){y.explode("play")});var z=new e.Element("a",{html:'<span class="fonticon fonticon-pause"></span>',"class":"wux-timeline-controls CmdExplode-Button CmdExplodeFontSizeMedium a"}).inject(this.myExplodeTimelineContainer);l(z).on("tap",function(B){y.explode("pause")});var x=new e.Element("a",{html:'<span class="fonticon fonticon-stop"></span>',"class":"wux-timeline-controls CmdExplode-Button CmdExplodeFontSizeMedium a"}).inject(this.myExplodeTimelineContainer);l(x).on("tap",function(B){y.explode("stop")});this.myExplodeTimelineContainer.addEventListener("contextmenu",function(B){B.preventDefault()},false);var w=function(){var C=j.start("Explode");var B=y.viewer.getBagNode?y.viewer.getBagNode():d(y.viewer);if(y.doExplode){var E=C.addProfile("ExplodeFunc");y.createExplodedView(B);E.stop()}else{y.deleteExplodedView(B);var D=y.sceneGraphState.getOverridesFromPathElement(B);if(D){D.forEach(function(F){if(F.getPosition()){F.getPathes().forEach(function(G){this.sceneGraphState.setPosition(G,null)},this)}},y)}}y.viewer.render({updateInfinitePlane:true,});C.stop()};this.initValue=y.myExplodeTimeline.getValue();this._explodeTouch=function(B){this.initValue=y.myExplodeTimeline.getValue();var C=B.gesture.distance-B.gesture.lastDistance;var D=C/10+y.initValue;console.log("Explode Value = "+C+" real value = "+D);if(D<0){D=0}else{if(D>100){D=100}}this.myExplodeTimeline.setValue(D);w()};this.explodeGesture=new b();this.explodeGesture.setDebugEvents(6);n.addGestureRecognizer(y.explodeGesture);this.onSpreadToken=o.subscribe({event:"/VISU/onSpread"},y._explodeTouch);this.myExplodeTimeline.addEvent("change",w);this.UIManager.addToActionBarEvent(this.myExplodeTimelineContainer);this.UIManager.addToResizeEvent(this.myExplodeTimelineContainer)},createExplodedView:function(w,F){if(!F){F=new q();F.addElement(w)}var y=w.saveMatrix||(w.saveMatrix=w.getMatrix().clone());var D=w.saveCenter||(w.saveCenter=w.bSphere.center.clone());var A=(2*(50+parseInt(this.myExplodeTimeline.getValue(),10))/100)-1;function B(J){var I=new s.Matrix4();if(J.exVector===undefined){var H=J.saveMatrix||(J.saveMatrix=J.getMatrix().clone());var G=J.saveCenter||(J.saveCenter=J.bSphere.center.clone());D.applyMatrix4(y);J.exVector=J.saveCenter.clone().applyMatrix4(H).applyMatrix4(y).sub(D)}I.setPosition(J.exVector.clone().multiplyScalar(A));return w.getMatrix().multiply(I)}var x=w.children.length;for(var z=0;z<x;z++){var v=w.children[z];var E=B(v);var C=F.clone();C.addElement(v);this.sceneGraphState.setPosition(C,E);this.createExplodedView(v,C)}},deleteExplodedView:function(x){if(x.saveMatrix!==undefined){delete x.saveMatrix}if(x.saveCenter!==undefined){delete x.saveCenter}if(x.exVector!==undefined){delete x.exVector}if(x.explodeVisibility){delete x.explodeVisibility}var v=x.children.length;for(var w=0;w<v;w++){this.deleteExplodedView(x.children[w])}},applyTransparentSelection:function(A,C){var B=this.viewer;var w=this.sceneGraphState;var v=B.getBagNode?B.getBagNode():d(B);var x=new q();x.addElement(v);var z=[];A.forEach(function(D){if(D!=null&&D.pathElement!=undefined){z.push(D.pathElement)}});if(C=="add"){if(true!=B.isAllTransparent){g.applyTransparencyToObjects(this.sceneGraphState,[x],transparencyVal,true);B.isAllTransparent=true}g.applyTransparencyToObjects(this.sceneGraphState,z,1,true)}else{if(C=="remove"){g.applyTransparencyToObjects(this.sceneGraphState,z,transparencyVal,true)}else{if(C=="empty"){var y=this.sceneGraphState.getOverridesFromPathElement(v);if(y){y.forEach(function(D){if(D.getOpacity()){D.getPathes().forEach(function(E){this.sceneGraphState.setOpacity(E,null)},this)}},this)}B.isAllTransparent=undefined}}}h.empty();B.render()},beginExecute:function(){r.empty();h.empty();var y=this.viewer;if(!this.sceneGraphState){if(this.viewer.createSceneGraph){this.sceneGraphState=this.viewer.createSceneGraph("ExplodeSG",d(this.viewer))}else{var z=function(B){var D=this.getSceneGraphOverrideSetManager();if(D){for(var A=D.getNumberOfSceneGraphOverrideSets();A--;){var C=D.getSceneGraphOverrideSetAt(A);if(C&&C.helper&&C.helper.name===B){return C.helper}}}return null};var v=function(E,D){var A=z.apply(this,[D]);if(!A){var C=new m(E);var B=this.getSceneGraphOverrideSetManager();if(B){if(B.pushSceneGraphOverrideSet(C)){A=C.helper=new c(C,D)}}}return A};this.sceneGraphState=v.apply(this.viewer,[d(this.viewer,d(this.viewer)),"ExplodeSG"])}}var w=this.viewer.getBagNode?this.viewer.getBagNode():d(this.viewer);g.setVisibilityOfAnnotations(y,false,w);g.setVisibilityOfSectionsAndMeasures(y,false,w);this.Shadow=new i({getValue:function(){return y.getShadow()},restore:function(){y.setShadow(this.getInitialValue())}});this.picking=new i({getValue:function(){return y.picking.displayHL},restore:function(){y.setPicking({displayHL:this.getInitialValue()})}});this.prepicking=new i({getValue:function(){return y.pPicking.activated},restore:function(){y.setPrePicking({activated:this.getInitialValue()})}});this.myExplodeTimelineContainer.inject(this.frameWindow.getUIFrame());this.myExplodeTimelineContainer.classList.remove("close");this.myExplodeTimelineContainer.classList.remove("open");this.myExplodeTimelineContainer.classList.add("open");this.doExplode=true;y.setPicking({displayHL:false});y.setPrePicking({activated:true});var x=this;this._csoAddToken=r.onAdd(function(B){y.setShadow(false);var A=[];A.push(B);if(x.doExplode){x.applyTransparentSelection(A,"add")}});this._csoRemoveToken=r.onRemove(function(B){if(r.isEmpty()){x.Shadow.restore()}var A=[];A.push(B);if(x.doExplode){x.applyTransparentSelection(A,"remove")}});this._csoEmptyToken=r.onEmpty(function(B){if(r.isEmpty()){x.Shadow.restore()}var A=[];A.push(B);if(x.doExplode){x.applyTransparentSelection(A,"empty")}})},endExecute:function(){this.doExplode=false;this.myExplodeTimelineContainer.classList.remove("close");this.myExplodeTimelineContainer.classList.remove("open");this.myExplodeTimelineContainer.classList.add("close");this.myExplodeTimelineContainer.remove();this.myExplodeTimeline.stop();this.picking.restore();this.applyTransparentSelection([],"empty");this.Shadow.restore();this.prepicking.restore();var v=this.viewer.getBagNode?this.viewer.getBagNode():d(this.viewer);g.setVisibilityOfAnnotations(this.viewer,true,v);g.setVisibilityOfSectionsAndMeasures(this.viewer,true,v);r._modelEvents.unsubscribe(this._csoAddToken);r._modelEvents.unsubscribe(this._csoRemoveToken);r._modelEvents.unsubscribe(this._csoEmptyToken);r.empty();if(this.onSpreadToken){o.unsubscribe(this.onSpreadToken);delete this.onSpreadToken}},explode:function(v){if(typeof v==="number"){this.myExplodeTimeline.setValue(v)}else{if(typeof v==="string"){if(v==="play"){this.myExplodeTimeline.pause();this.myExplodeTimeline.play(20)}else{if(v==="rewind"){this.myExplodeTimeline.pause();this.myExplodeTimeline.play(-20)}else{if(v==="pause"){this.myExplodeTimeline.pause()}else{if(v==="stop"){this.myExplodeTimeline.stop()}}}}}}}});return p});define("DS/3DPlayCommands/CmdViewSelector",["UWA/Core","DS/3DPlay/3DPlay","DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/WebInfraUI/Touch","DS/Visualization/Viewpoint","DS/WebappsUtils/WebappsUtils","DS/3DPlayUtils/VisibilityUtils","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/Selection/HSOManager","DS/WebInfraUI/NavigationArrows","DS/VisuEvents/EventsManager","DS/CoreEvents/Events","DS/WebUtils/Tracker"],function(k,p,d,q,f,m,h,j,g,n,e,b,c,i,l){var o;var a=d.extend({init:function(r){this._parent(r,{isAsynchronous:true,mode:"exclusive"});this.frameWindow=this.getFrameWindow();this.rotationQueue=[];this._isReadyForAnimation=true;this._isCurrentViewISO=false;o=this},destroy:function(){o=null;this.viewer=null;this.viewerFrame=null;this.viewpoint=null;this.viewControl=null},getNearestAxis:function(r){var v=[];v.push(new q.Vector3(1,0,0));v.push(new q.Vector3(0,1,0));v.push(new q.Vector3(0,0,1));v.push(new q.Vector3(-1,0,0));v.push(new q.Vector3(0,-1,0));v.push(new q.Vector3(0,0,-1));var s=0;var w=Infinity;for(var u=0;u<v.length;u++){var t=r.angleTo(v[u]);if(t<w){s=u;w=t}}return v[s]},applyNearestStdView:function(){o.rotationQueue.push("nearestUP","nearestSIGHT");o.callForAnimation()},_animate:function(z,v){z.normalize();v.normalize();o._isReadyForAnimation=false;var t=Math.acos(v.dot(z));var s=t*(180/Math.PI);var u=Math.floor(Math.abs(s));var y=s-u;var x=0;var w=v.cross(z);w.normalize();var r=function(){var A=new q.Quaternion().setFromAxisAngle(w,-10*(Math.PI/180));var B=u-x;if(B>=10){A.setFromAxisAngle(w,-10*(Math.PI/180))}else{if(B<10){A.setFromAxisAngle(w,-B*(Math.PI/180))}else{if(x>u){A.setFromAxisAngle(w,-y*(Math.PI/180))}}}o.viewControl&&o.viewControl.orientation.multiplyQuaternions(A,o.viewControl.orientation.clone());o.viewControl&&o.viewControl.update();o.frameWindow.getViewer().render();x+=10;if(x<u){requestAnimationFrame(r)}else{if(o.rotationQueue.length>0){o.callForAnimation()}else{o._isReadyForAnimation=true}}};r()},updateRotationQueue:function(r,s){if(s&&s.srcEvent){s.srcEvent.preventDefault()}this.rotationQueue.push(r);if(this._isReadyForAnimation){this.callForAnimation()}},callForAnimation:function(){var r=this.rotationQueue.shift();var s={};if(this._isCurrentViewISO){switch(r){case"left":s={stdView:"right"};break;case"right":s={stdView:"front"};break;case"up":s={stdView:"bottom"};break;case"down":s={stdView:"top"};break;case"rotateCW":s={stdView:"front"};break;case"rotateCCW":s={stdView:"right"};break}if(r==="iso"){this._isCurrentViewISO=true}else{this._isCurrentViewISO=false}}else{switch(r){case"left":s={from:this.viewpoint.getSightDirection(),to:this.viewpoint.getUpDirection().cross(this.viewpoint.getSightDirection())};break;case"right":s={from:this.viewpoint.getSightDirection(),to:this.viewpoint.getSightDirection().clone().cross(this.viewpoint.getUpDirection())};break;case"up":s={from:this.viewpoint.getSightDirection(),to:this.viewpoint.getUpDirection()};break;case"down":s={from:this.viewpoint.getSightDirection(),to:this.viewpoint.getUpDirection().multiplyScalar(-1)};break;case"iso":s={stdView:"iso"};this._isCurrentViewISO=true;break;case"rotateCW":s={from:this.viewpoint.getUpDirection(),to:this.viewpoint.getUpDirection().cross(this.viewpoint.getSightDirection())};break;case"rotateCCW":s={from:this.viewpoint.getUpDirection(),to:this.viewpoint.getSightDirection().cross(this.viewpoint.getUpDirection())};break;case"nearestUP":s={from:this.viewpoint.getUpDirection(),to:this.getNearestAxis(this.viewpoint.getUpDirection())};break;case"nearestSIGHT":s={from:this.viewpoint.getSightDirection(),to:this.getNearestAxis(this.viewpoint.getSightDirection())};break}if(!(r==="nearestSIGHT"||r==="nearestUP"||r==="iso")){o.rotationQueue.unshift("nearestUP","nearestSIGHT")}}if(s&&s.from){this._animate(s.from,s.to)}else{if(s&&s.stdView){this.viewpoint.reframe(s.stdView)}}this.frameWindow.getViewer().render()},saveCurrentViewSettings:function(){var r=this.frameWindow.getViewer();this.viewSettings={};this.viewSettings.shadow=r.getShadow();this.viewSettings.mirror=r.getMirror();this.viewSettings.grid=r.getGrid();this.viewSettings.infinitePlane=r.getInfinitePlane();if(r){r.setShadow(false);r.setGrid(false);r.setMirror(false,false);r.displayInfinitePlane(false);r.setPrePicking({activated:false,displayHL:false},true);r.setPicking({activated:false,displayHL:false},true)}this.viewControl.setActive(false);this.viewControl.resetGestureCB();j.setVisibilityOfAnnotations(o.viewer,false);j.setVisibilityOfSectionsAndMeasures(o.viewer,false)},applySavedViewSettings:function(){if(o.viewer){o.viewer.setShadow(this.viewSettings.shadow);o.viewer.setMirror(this.viewSettings.mirror);o.viewer.setGrid(this.viewSettings.grid);o.viewer.setPicking({activated:true,displayHL:true},true);o.viewer.setPrePicking({activated:true,displayHL:true},true);o.viewer.displayInfinitePlane(this.viewSettings.infinitePlane);delete this.viewSettings}},onModelLoadingEnd:function(){o.rotationQueue=[];o._refreshView()},onSwipeLeft:function(r){o.updateRotationQueue("left",r)},onSwipeRight:function(r){o.updateRotationQueue("right",r)},onSwipeUp:function(r){o.updateRotationQueue("up",r)},onSwipeDown:function(r){o.updateRotationQueue("down",r)},rotateLeft:function(r){o.updateRotationQueue("left",r)},rotateRight:function(r){o.updateRotationQueue("right",r)},rotateUp:function(r){o.updateRotationQueue("up",r)},rotateDown:function(r){o.updateRotationQueue("down",r)},rotateCW:function(r){o.updateRotationQueue("rotateCW",r)},rotateCCW:function(r){o.updateRotationQueue("rotateCCW",r)},applyISOView:function(r){if(r&&r.srcEvent&&r.srcEvent.stopPropagation){r.srcEvent.stopPropagation()}o.updateRotationQueue("iso",r)},onPinch:function(r){r.rotation=0;r.srcEvent.preventDefault()},onRotate:function(s){if(o.startRotation){var r=s.rotation-o.startRotation;if(Math.abs(r)>45){o.startRotation=s.rotation;o.leastOneRotation=true;if(r>0){o.updateRotationQueue("rotateCW",s)}else{if(r<0){o.updateRotationQueue("rotateCCW",s)}}}}else{o.startRotation=s.rotation}},onRotateStart:function(r){o.startRotation=r.rotation},onRotateEnd:function(s){var r=s.rotation-o.startRotation;o.startRotation=undefined;if(Math.abs(r)<45){if(!o.leastOneRotation){if(r>0){o.updateRotationQueue("rotateCW",s)}else{if(r<0){o.updateRotationQueue("rotateCCW",s)}}}}o.leastOneRotation=false},endCommand:function(s){if(s&&s.center){if((!s.target.id.contains("iso"))&&(s.target.className.indexOf("arrow")===-1)){var r=new q.Vector2(s.center.x,s.center.y);var u=o.viewer.getMousePosition(r);var v=o.viewer.pick(u,"mesh",true);if(v.path.length===0){var t=o.frameWindow.getActionBar();if(t){t.open();if(t.MAB){t.MAB.showFlyout(0)}}}}}},_buildUI:function(){var u=o.frameWindow.getActionBar();u.close();var s=u.onActionBarOpen(function(){u.removeCallback(s);o.end()});var r=o.frameWindow.getUIFrame();o.mainContainer=new k.Element("div",{id:"mainContainer",styles:{position:"absolute",width:"100%",height:"100%",top:0,left:0,"touch-action":"none"}}).inject(r);var t={arrowCB:{left:o.rotateLeft,right:o.rotateRight,up:o.rotateUp,down:o.rotateDown,clockwise:o.rotateCW,counterClockwise:o.rotateCCW},gestureCB:{tap:o.endCommand,swipeleft:o.onSwipeLeft,swiperight:o.onSwipeRight,swipeup:o.onSwipeUp,swipedown:o.onSwipeDown,rotate:o.onRotate,rotatestart:o.onRotateStart,rotateend:o.onRotateEnd}};o.navigationArrows=new b(t,{container:o.mainContainer,frmWindow:o.frameWindow});o.isometricDiv=new k.Element("div",{id:"navigate3DPlay-isometric-div",styles:{position:"absolute","background-size":"contain",width:"10%",height:"10%","min-width":"64px","min-height":"64px",cursor:"pointer","background-repeat":"no-repeat","background-image":"url("+h.getWebappsBaseUrl()+"3DPlayCommands/assets/icons/I_3DSHARE_ISO_View_Icon.png)",right:0,top:0}}).inject(r);o._checkKey=function(w){if(w&&w.from[0]&&w.from[0].event){var v=w.from[0].event;if((v.keyCode===73||v.keyCode===105)&&v.ctrlKey===false&&o.applyISOView){o.applyISOView(w)}}};o.touchIso=f(o.isometricDiv);o.touchIso.on("tap",o.applyISOView);if(window.__karma__){o.isometricDiv.onclick=o.applyISOView}c.addEvent(document,"onKeyDown",o._checkKey);j.setVisibilityOfAnnotations(o.viewer,true);j.setVisibilityOfSectionsAndMeasures(o.viewer,true)},beginExecute:function(){l.inc("command-"+this.getId());this._initializeView();i.publish({event:"3DPLAY/SPECTREE/DISABLE",data:{}})},_initializeView:function(){g.empty();e.empty();n.empty();o.viewer=o.frameWindow.getViewer();o.viewerFrame=o.frameWindow.getViewerFrame();o.viewpoint=o.frameWindow.getViewpoint();o.viewControl=o.viewpoint.getControl();o.saveCurrentViewSettings();o._buildUI();if(o.frameWindow.experience){if(o.frameWindow.experience.modelLoadComplete===true){o._refreshView()}}else{o._refreshView()}},_clearView:function(){o.viewControl.setActive(true);o.viewControl.initGestureCB();o.applySavedViewSettings();o.navigationArrows.dispose();o.navigationArrows=null;o.touchIso.off("tap",o.applyISOView);c.removeEvent(document,"onKeyDown",o._checkKey);o.mainContainer.remove();o.isometricDiv.remove();o.touchIso=null;o.mainContainer=null;o.isometricDiv=null;o.viewSettings=null;o.viewControl=undefined;o.viewer=null;o.viewerFrame=null;o._isReadyForAnimation=null;o._isCurrentViewISO=null;o.rotationQueue=[];o.frameWindow.getActionBar().open()},_refreshView:function(){if(o&&o.viewpoint){o.viewpoint.reframe(null,200);this.timeoutToken=setTimeout(function(){o.applyNearestStdView()},400)}},endExecute:function(){if(this.timeoutToken){clearTimeout(this.timeoutToken);this.timeoutToken=undefined}if(o){o._clearView();var r=o.frameWindow.getActionBar();if(r){if(r.MAB&&r.MAB.state.visible===false){i.publish({event:"3DPLAY/SPECTREE/ENABLE",data:{}})}}}else{i.publish({event:"3DPLAY/SPECTREE/ENABLE",data:{}})}}});return a});define("DS/3DPlayCommands/CmdEnhancedExplode",["DS/VCXWebLevelExploderGUI/VCXLevelExploderGUICmd","DS/3DPlayUtils/VisibilityUtils","DS/Visualization/PathElement","DS/WebUtils/Tracker","DS/WebSystem/Settings"],function(a,e,d,b,c){return a.extend({init:function(h){var i=this;this.ctx=h.context;this._parent(h,{isAsynchronous:true});var f=this.getFrameWindow().experience;f.disposeFunctions.add(function(){i=null});function g(){i.disable();if(i.checkIsExplodable()){i.enable()}}var f=this.getFrameWindow().experience;if(f){f.disposeFunctions.add(function(){i=null});if(f.modelLoadComplete){g()}this._onModelLoadingFinshedToken=f.subscribe("ASSET/LOADINGFINISHED",g,true)}},checkIsExplodable:function(){var k=this.getFrameWindow();var f=this.getFrameWindow().experience;var h=undefined;if(!h&&k&&f){h=f.getRootBag()}if(!h||!h.children||!h.children.length){return false}var g=new d([h]);var i=f.experienceBase._ManagerSet.getManager("VCXContextManager");i.setRootNode(h);var j={attributeToUse:"productType",componentTypeForRootNode:"VCXWebComponentOccurrence",Instance3D:"VCXWebComponentOccurrence",Reference3D:null,InstanceRep:"VCXComponentMesh",defaultType:"VCXWebComponentOccurrence"};f.experienceBase.BuildComponentsFromNodeEXT(h,g,null,j);if(!g.getLength()){console.error("Could not build the components.");return false}return this.isExplodable(g)},_destroy:function(){if(this._onModelLoadingFinshedToken&&this.getFrameWindow()&&this.getFrameWindow().experience){this.getFrameWindow().experience.unsubscribe(this._onModelLoadingFinshedToken)}this._onModelLoadingFinshedToken=null;if(this._parent){this._parent()}},execute:function(){b.inc("command-"+this.getId());var g=this.getFrameWindow().getViewer();var f=this.getFrameWindow().experience;if(!c.get("3DPlay.UseExplodeCompatibleAnnotationManager")){e.setVisibilityOfAnnotations(g,false,f.getRootBag());e.setVisibilityOfSectionsAndMeasures(g,false,f.getRootBag())}this._parent()},endExecute:function(){var g=this.getFrameWindow().getViewer();var f=this.getFrameWindow().experience;if(!c.get("3DPlay.UseExplodeCompatibleAnnotationManager")){e.setVisibilityOfAnnotations(g,true,f.getRootBag());e.setVisibilityOfSectionsAndMeasures(g,true,f.getRootBag())}this._parent()}})});define("DS/3DPlayCommands/Proxy/VisuShadingMaterialEdgesCmdProxy",["DS/ViewerCommands/VisuShadingMaterialEdgesCmd","DS/3DPlayCommands/CmdENOPADStream"],function(a,b){return a.extend(b("beginExecute"))});define("DS/3DPlayCommands/CmdShare3DComment",["DS/3DPlayCommands/CmdShareBase"],function(b){var a=b.extend({shareWithPanelManager:function(c){if(c){c._shareTo3DComment()}}});return a});define("DS/3DPlayCommands/CmdLineicFilter",["DS/ApplicationFrame/Command","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils","DS/WebInfraUI/ContextualBarManager","DS/WebSystem/Settings","DS/WebUtils/Tracker","DS/3DPlayCommands/CmdENOPADStream"],function(c,f,d,e,b,g,i){var h;var a=c.extend({destroy:function(){if(h){h._frmWindow=null;h._viewer=null;if(h.token){f.unsubscribe(h.token)}h.token=null;h=null}},init:function(j){h=this;h._parent(j,{isAsynchronous:true,mode:"exclusive"});h._frmWindow=h.getFrameWindow();h._viewer=h._frmWindow.getViewer();h._iconDir=d.getWebappsAssetUrl("3DPlay","icons/32/");h._axisState="true"===b.get("axisState3DPlay",true);h._linesState="true"===b.get("linesState3DPlay",true);h._edgesState="true"===b.get("edgesState3DPlay",true);h._pointsState="true"===b.get("pointsState3DPlay",true);h._exp=h._frmWindow.experience;if(h._exp!==undefined){h._exp.registerCollabAction("lineicFilterExecute",h.execute.bind(h));h._exp.registerCollabAction("lineicFilterResumeExecute",h.resumeExecute.bind(h));h._exp.registerCollabAction("lineicFilterEndExecute",h.endExecute.bind(h))}h.setAxis=function(m){var l=h.getFrameWindow().experience.getRootBag();if(l){h._frmWindow.hello=h._axisState}h._viewer.setAxisFilter(h._axisState);h._viewer.render();if(h._exp.notifyAction&&h._exp.collabMode===true){h._exp.notifyAction("lineicFilterSetAxis",[h._axisState])}};h.setAxisFF=function(l){h._axisState=l;h.setAxis()};if(h._exp!==undefined){h._exp.registerCollabAction("lineicFilterSetAxis",h.setAxisFF.bind(h))}h.setPoints=function(l){h._viewer.setPointsFilter(h._pointsState);h._viewer.render();if(h._exp.notifyAction&&h._exp.collabMode===true){h._exp.notifyAction("lineicFilterSetPoints",[h._pointsState])}};h.setPointsFF=function(l){h._pointsState=l;h.setPoints()};if(h._exp!==undefined){h._exp.registerCollabAction("lineicFilterSetPoints",h.setPointsFF.bind(h))}h.setEdges=function(l){h._viewer.render();if(h._exp.notifyAction&&h._exp.collabMode===true){h._exp.notifyAction("lineicFilterSetEdges",[h.edgesState])}};h.setEdgesFF=function(l){h._edgesState=l;h.setEdges()};if(h._exp!==undefined){h._exp.registerCollabAction("lineicFilterSetEdges",h.setEdgesFF.bind(h))}h.setLines=function(l){h._viewer.setLinesFilter(h._linesState);h._viewer.render();if(h._exp.notifyAction&&h._exp.collabMode===true){h._exp.notifyAction("lineicFilterSetLines")}};h.setLinesFF=function(l){h._linesState=l;h.setLines()};if(h._exp!==undefined){h._exp.registerCollabAction("lineicFilterSetLines",h.setLinesFF.bind(h))}if(h._frmWindow.hello==true){h.setAxis()}else{var k=h._frmWindow.experience;this.token=k.subscribe("ASSET/LOADINGFINISHED",h.setAxis);k.EventDisposer.add(this.token)}h.setPoints();h.setLines()},execute:function(){h.contextualMenu=new e({frameWindow:h._frmWindow});var l={type:h.contextualMenu.Button.Check,id:"FilterAxis",rsc:"3DPlay/3DPlayExperience3D",nls:"3DPlay/3DPlayExperience3D",selected:h._axisState,onclickCB:function(){h._axisState=!h._axisState;b.set("axisState3DPlay",h._axisState);h.setAxis()}};var k={type:h.contextualMenu.Button.Check,id:"FilterLines",rsc:"3DPlay/3DPlayExperience3D",nls:"3DPlay/3DPlayExperience3D",selected:h._linesState,onclickCB:function(){h._linesState=!h._linesState;b.set("linesState3DPlay",h._linesState);h.setLines()}};var j={type:h.contextualMenu.Button.Check,id:"FilterPoints",rsc:"3DPlay/3DPlayExperience3D",nls:"3DPlay/3DPlayExperience3D",selected:h._pointsState,onclickCB:function(){h._pointsState=!h._pointsState;b.set("pointsState3DPlay",h._pointsState);h.setPoints()}};h.axisToolToken=h.contextualMenu.addButtons([l],{barType:h.contextualMenu.Toolbar.New});h.linesToolToken=h.contextualMenu.addButtons([k],{barType:h.contextualMenu.Toolbar.Append});h.pointsToolToken=h.contextualMenu.addButtons([j],{barType:h.contextualMenu.Toolbar.Append,showContextBarBackground:true});h._viewer.render();if(h._exp.notifyAction&&h._exp.collabMode===true){h._exp.notifyAction("lineicFilterExecute")}},resumeExecute:function(){var j=this;j._viewer.render();j.end();if(j._exp.notifyAction&&j._exp.collabMode===true){j._exp.notifyAction("lineicFilterResumeExecute")}},endExecute:function(){var j=this;j.contextualMenu.removeButtons(j.axisToolToken);j.contextualMenu.removeButtons(j.linesToolToken);j.contextualMenu.removeButtons(j.pointsToolToken);j.contextualMenu.dispose();j.contextualMenu=undefined;if(j._exp.notifyAction&&j._exp.collabMode===true){j._exp.notifyAction("lineicFilterEndExecute")}}}).extend(i("execute"));return UWA.namespace("ViewerCommands/LineicFilter",a)});define("DS/3DPlayCommands/CmdSharePrint",["DS/3DPlayCommands/CmdShareBase"],function(a){return a.extend({shareWithPanelManager:function(b){if(b){b._printScreenshot()}}})});define("DS/3DPlayCommands/Proxy/VisuShadingEdgesCmdProxy",["DS/ViewerCommands/VisuShadingEdgesCmd","DS/3DPlayCommands/CmdENOPADStream"],function(a,b){return a.extend(b("beginExecute"))});define("DS/3DPlayCommands/Proxy/VisuShadingMaterialCmdProxy",["DS/ViewerCommands/VisuShadingMaterialCmd","DS/3DPlayCommands/CmdENOPADStream"],function(a,b){return a.extend(b("beginExecute"))});define("DS/3DPlayCommands/Proxy/VisuShadingEdgesNoSmoothEdgesCmdProxy",["DS/ViewerCommands/VisuShadingEdgesNoSmoothEdgesCmd","DS/3DPlayCommands/CmdENOPADStream"],function(a,b){return a.extend(b("beginExecute"))});define("DS/3DPlayCommands/Proxy/VisuShadingEdgesHiddenEdgesCmdProxy",["DS/ViewerCommands/VisuShadingEdgesHiddenEdgesCmd","DS/3DPlayCommands/CmdENOPADStream"],function(a,b){return a.extend(b("beginExecute"))});define("DS/3DPlayCommands/CmdShareTo3DSwYm",["DS/3DPlayCommands/CmdShareBase"],function(a){return a.extend({shareWithPanelManager:function(b){if(b){b._publishToSwYm()}}})});define("DS/3DPlayCommands/Proxy/VisuNoShadingEdgesCmdProxy",["DS/ViewerCommands/VisuNoShadingEdgesCmd","DS/3DPlayCommands/CmdENOPADStream"],function(a,b){return a.extend(b("beginExecute"))});define("DS/3DPlayCommands/Proxy/VisuShadingIllustrationCmdProxy",["DS/ViewerCommands/VisuShadingIllustrationCmd","DS/3DPlayCommands/CmdENOPADStream"],function(a,b){return a.extend(b("beginExecute"))});define("DS/3DPlayCommands/CmdShareDownload",["DS/3DPlayCommands/CmdShareBase"],function(a){return a.extend({shareWithPanelManager:function(b){if(b){b._saveScreenshot()}}})});