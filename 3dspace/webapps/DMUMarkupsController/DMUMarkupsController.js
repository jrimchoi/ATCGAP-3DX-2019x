define("DS/DMUMarkupsController/DMUMarkupsController",["UWA/Class","DS/CoreEvents/Events","DS/DMUBaseExperience/EXPControllerEvents","DS/DMUBaseExperience/DMUContextManager"],function(a,f,c,e){var g=a.extend({init:function(k){this._parent(k);var h=null;var o=[];var j=k.context;var i=null,n=null,m=null;var l=function(t){if(!o||o&&!o.length){return}var r=t.eventType||t.event,q;var p=false;var u=t;if(r==="@onWindowResized"||r==="@onViewpointChange"||r==="@onViewpointEndMove"||r==="@onPinchPanRotate"||r==="beginExplodeCmd"||r==="endExplodeCmd"||r==="onSwapVisibleSpace"){p=true}else{if(r==="EXPHideShowEvent"){if(t&&t.occurrence||t.paths){p=true;u={eventType:"onHideShow",flag:t.flag,paths:[]};if(t.occurrence){var s=t.occurrence.getOccurrence?t.occurrence.getOccurrence():null;if(s&&s.pathElement){u.paths.push(s.pathElement.clone())}}else{for(q=0;q<t.paths.length;q++){u.paths.push(t.paths[q].clone())}}}}}if(p){for(q=0;q<o.length;q++){if(o[q]&&o[q].onViewerEventCB){o[q].onViewerEventCB(u)}}}};this.setActiveState=function(s){if(s===h){return}h=s;var p=e.giveEventsController({viewer:j});if(h){if(p){if(!m){m=p.addEvent(c.Events.EXPHideShowEvent,l)}}if(!i){i={};i.onVISUEvents=f.subscribe({event:"/VISU/"},l);i.onExplodeStart=f.subscribe({event:"3DPLAY/EXPLODE/START"},function(){l({eventType:"beginExplodeCmd"})});i.onExplodeEnd=f.subscribe({event:"3DPLAY/EXPLODE/END"},function(){l({eventType:"endExplodeCmd"})})}if(!n){n=j.onSwapVisibleSpace(function(){l({eventType:"onSwapVisibleSpace"})})}}else{o.length=0;if(m){p.removeEvent(m);m=null}if(i){var r=Object.keys(i);for(var q=0;q<r.length;q++){f.unsubscribe(i[r[q]])}i=null}if(n){j.unsubscribe(n);n=null}}};this.clear=function(){this.setActiveState(false);o=j=null};this.registerMarker=function(p){o.push(p)};this.unregisterMarker=function(q){for(var p=o.length-1;p>=0;p--){if(o[p]===q){o.splice(p,1);break}}}}});var b=[];var d=a.singleton({init:function(){},getDMUMarkupsController:function(j){if(j&&j.context){var h=false;for(var i=0;i<b.length;i++){if(b[i].context===j.context){b[i].counter++;h=true;break}}if(!h){var k=new g(j);k.setActiveState(true);b.push({counter:1,context:j.context,markersController:k})}return this.giveDMUMarkupsController(j)}return undefined},giveDMUMarkupsController:function(i){if(i&&i.context){var j;for(var h=0;h<b.length;h++){if(b[h].context===i.context){j=b[h].markersController;break}}if(j){return Object.freeze({registerMarker:function(k){if(j){return j.registerMarker(k)}return undefined},unregisterMarker:function(k){if(j){j.unregisterMarker(k)}}})}}return undefined},unreferenceDMUMarkupsController:function(i){if(i&&i.context){for(var h=0;h<b.length;h++){if(b[h].context===i.context){b[h].counter--;if(b[h].counter<=0){if(b[h].markersController){b[h].markersController.clear()}b.splice(h,1)}return}}}}});return d});