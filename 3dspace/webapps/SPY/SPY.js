/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("SPY/SimulationPlayerModel",["DS/SPY/SimulationPlayerModel"],function(a){console.warn("This module is deprecated. use DS/SPY/SimulationPlayer instead of SPY/SimulationPlayer");return a});define("DS/SPY/SimulationPlayerModel",["UWA/Core","DS/CoreEvents/Events","DS/Visualization/Node3D"],function(f,c,d){var a=function(g){return("_frame"+String(g))};var e=function(g){var h=g.split("_frame");return(h.length>1?parseInt(h[1]):undefined)};var b=f.Class.extend({init:function(g){this.simulationName="Simulation";this.scenarioName="Simulation case";this.window=g?(g.window?g.window:g):undefined;this.ctx=g?(g.context?g.context:"ctxUndefined"):"ctxUndefined";this.sequences=[];this.level=2;this._dataLists=[];this._frmDetailsMaps=[];this.filesToLoad=[];this.framesIndices=[];this.fatherNodes=[];this.loadingMap=new Map();this.transactionMap=new Map();this.fatherTransactionMap=new Map();this.noNodeTransactionCounter=0;this.progress={loaded:0,total:0};this.previousProgressPosition=0;if(this.window&&this.window.getModelLoader){this.window.getModelLoader().setOnLoadedCallback(this.onLoaderDoneCallback.bind(this));this.window.getModelLoader().setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this))}},clean:function(){this.clearLoadingQueue();for(var g=0;g<this.sequences.length;g++){if(this.sequences[g].zip){delete this.sequences[g].zip}var i=this.sequences[g].listDD;if(i){for(var h=0;h<i.length;h++){i[h].clean()}}delete this.sequences[g].listDD}delete this.sequences;if(this.logoUrl){URL.revokeObjectURL(this.logoUrl);this.logoUrl=undefined}},getContext:function(){return this.ctx},addDataList:function(h,g){if(this._dataLists[g]===undefined){this._dataLists[g]={}}this._dataLists[g][h.getName()]=h},getDataList:function(g,h){var i;if(h<this._dataLists.length&&h>=0){i=this._dataLists[h][g]}return i},getFrameDetails:function(h,k){var j;var i=this._frmDetailsMaps[k];if(i){j=i.get(h)}else{this._frmDetailsMaps[k]=new Map();i=this._frmDetailsMaps[k]}if(!j){j={};var n=this.getDataList("frm",k);var l=n.getEntry(parseInt(h)-1);j.position=l.pos;j.scaled=l.scaled;var m=this.getDataList("grp",k);var g=m.getEntry(parseInt(l.grpId)-1);j.group=g.val;j.unit=g.unit;i.set(h,j)}return j},addSequence:function(h,i,j,g){require(["DS/SPY/CATSimNavDataLWFactory"],function(l){var m=new l();var k={idx:0,name:"sequence",listDD:[],listDDShared:[],zip:i};k.idx=this.sequences.push(k)-1;m.parseXML(h,k,this,j,function(){this.sequences.pop();g()}.bind(this))}.bind(this))},getNbSequences:function(){return this.sequences.length},getSimulationName:function(){return this.simulationName},getDisclaimer:function(){return this.disclaimer},getLogoUrl:function(j){if(this.logo&&this.logo.length>0){if(!this.logoUrl){if(this.sequences.length>0&&!isNaN(this.sequences[0].idx)){var g=this.getZipEntries(this.sequences[0].idx);var i="image";var h=g.find(this.logo);if(h){h.getBlob(i,function(k){this.logoUrl=URL.createObjectURL(k);if(j){j(this.logoUrl)}}.bind(this))}}}}return this.logoUrl},getSequenceName:function(g){if(this.sequences.length>g){return this.sequences[g].name}else{return"undefined"}},getDataDisplayList:function(g){if(this.sequences.length>g){return this.sequences[g].listDD}else{return undefined}},getSharedDataDisplayList:function(g,i){if(this.sequences.length>g){var h=this.sequences[g].listDDShared;if(i){h=this.sequences[g].listDDShared.filter(function(j){return j.category===i})}return h}else{return undefined}},getZipEntries:function(g){return this.sequences[g].zip},loadFiles:function(k){if(k&&k.filesList&&(k.fatherNode||(k.fatherNodes&&!isNaN(k.frameIndex)))&&!isNaN(k.sequence)&&k.callback){var j=this.filesToLoad.length>0;this.filesToLoad=this.filesToLoad.concat(k.filesList);this.bufferingSize=Math.round(this.filesToLoad.length/10);var l;if(!k.framesIndices){k.framesIndices=[];for(l=0;l<k.filesList.length;l++){k.framesIndices.push(k.frameIndex)}}if(k.framesIndices&&k.framesIndices.length!==k.filesList.length){console.error("SimulationPlayerModel - inconsistencies between files and frames indices to load")}this.framesIndices=this.framesIndices.concat(k.framesIndices);if(!k.fatherNodes){k.fatherNodes=[];for(l=0;l<k.filesList.length;l++){k.fatherNodes.push(k.fatherNode)}}this.fatherNodes=this.fatherNodes.concat(k.fatherNodes);if(k.fatherNodes&&k.fatherNodes.length!==k.filesList.length){console.error("SimulationPlayerModel - inconsistencies between files and father node list")}var i=k.fatherNodes[0].id;var g=a(k.framesIndices[0]);var n=String(i)+g;var h=this.transactionMap.get(n);if(!h){var m={count:0,loadStatus:"loading",callbacks:[]};m.sequence=k.sequence;m.count+=k.filesList.length;m.callbacks.push(k.callback);this.transactionMap.set(n,m);if(k.fatherNodes){l=0;k.fatherNodes.forEach(function(o){this.fatherTransactionMap.set(String(o.id)+g,n)}.bind(this))}if(!j){this.progress.loaded=0;this.progress.total=k.filesList.length;if(this.window.experience){c.publish({event:this.getContext()+"/SPY/PROGRESS/INIT",data:{fromPreviousValue:!k.resetProgress}});this.window.experience.modelLoadComplete=false;this.window.experience.modelLoadCount=0;this.window.experience.modelPrevLoadCount=0}}else{this.progress.total+=k.filesList.length}}}},_closeTransaction:function(i){var g=this.transactionMap.get(i);if(g){g.loadStatus="done";var h=g.callbacks;this.transactionMap["delete"](i);this.fatherTransactionMap.forEach(function(k,l,j){if(k===i){j["delete"](l)}});h.forEach(function(j){if(j){j()}})}},_updateTransactionForFatherNode:function(g,j){if(g){var i=this.fatherTransactionMap.get(String(g.id)+a(j));var h=this.transactionMap.get(i);if(h){if(h.loadStatus==="loading"){h.count--;if(h.count===0){this._closeTransaction(i)}}}else{g.parents[0].traverse(function(k){k.children.forEach(function(l){if(l._SPYFrameIndex===j){k.remove(l)}})})}}},_getNodeToReuse:function(g){var h;if(g&&"loaded"===g.status&&g.usages&&g.usages.length>0){h=g.usages[0].children[0]}return h},_reuseNode:function(i,j,h){var g=new d();if(!isNaN(j)){g._SPYFrameIndex=j}g.addChild(h);i.addChild(g);this._updateTransactionForFatherNode(i,j);this.processLoadFiles();if(this.filesToLoad.length===0){this.onLoaderDoneCallback()}},_loadRequest:function(j,k,l){var h;var p;if(l){p=this.loadingMap.get(l)}h=this._getNodeToReuse(p);if(h){this._reuseNode(j,k,h)}else{var g=this.fatherTransactionMap.get(String(j.id)+a(k));if(g){var r=this.transactionMap.get(g).sequence;if(!l){var q=new d();if(!isNaN(k)){q._SPYFrameIndex=k}j.addChild(q);q.setVisibility(false);this._closeTransaction(g);this.processLoadFiles();if(this.filesToLoad.length===0){this.onLoaderDoneCallback()}}else{if(!isNaN(r)){var o=new d();if(!isNaN(k)){o._SPYFrameIndex=k}j.addChild(o);o.setVisibility(false);if(p&&"loading"===p.status){p.usages.push(o)}else{if(p){j._SPYMultipleUsages=true;p.status="loading";p.usages.push(o)}var s=this.sequences[r].zip.find(l);if(s){var i="text/plain";var m=this.window.getModelLoader();m.setKeepLoaderMode(true);var n=new FileReader();m.fileType="cgr";s.getBlob(i,function(t){n.onload=function(u){m.loadModelFromBuffer(u.target.result,o)};n.readAsArrayBuffer(t)})}else{}}}}}}},processLoadFiles:function(){var g=this.filesToLoad.length;if(g>0){var k=[];var h=function(){k.push({fatherNode:this.fatherNodes.shift(),frameIndex:this.framesIndices.shift(),cgrFileToLoad:this.filesToLoad.shift()})}.bind(this);var i=this.window.getModelLoader().cgrLoader;if(i){while(i.currentDownload+k.length<i.maxParrallelDownload&&this.fatherNodes.length>0){h()}}else{h()}while(k.length>0){var j=k.shift();this._loadRequest(j.fatherNode,j.frameIndex,j.cgrFileToLoad)}}},initLoadingMap:function(h){this.clearLoadingMap();var g=this.loadingMap;if(Array.isArray(h)){h.forEach(function(i){g.set(i,{status:"notLoaded",usages:[]})})}},clearLoadingMap:function(){this.loadingMap.clear()},clearLoadingQueue:function(h){this.filesToLoad=[];this.framesIndices=[];this.fatherNodes=[];var k=[];this.transactionMap.forEach(function(n,m){if(n.loadStatus==="loading"){k.push(m)}});var i=[];k.forEach(function(n){var m=e(n);if(!isNaN(m)){i.push(m)}});if(this.window&&this.window.getViewer){var j=this.window.getViewer().getRootNode();i.forEach(function(m){j.traverse(function(o){o.children.forEach(function(n){if(n._SPYFrameIndex===m){o.remove(n)}})})})}this.fatherTransactionMap.clear();this.transactionMap.clear();this.noNodeTransactionCounter=0;this.progress.loaded=0;this.progress.total=0;if(this.window&&this.window.experience){this.window.experience.modelLoadComplete=true;this.window.experience.modelLoadCount=0;this.window.experience.modelPrevLoadCount=0;var g=this.window.getModelLoader();if(g){g.abort();var l=g.cgrLoader;if(l){l.cleanLoader()}g.setOnLoadedCallback(this.onLoaderDoneCallback.bind(this));g.setOnLoadedProductStructureCallback(this.onModelLoadedCallback.bind(this))}if(!h){this.window.experience.progress.updateProgression(0)}}},onModelLoadedCallback:function(l){var j;var k;if(l.nodes&&l.nodes.length>0){var i=l.nodes[0].parents[0];j=i.parents[0];k=i._SPYFrameIndex;if(j&&j._SPYMultipleUsages){var h=[];this.loadingMap.forEach(function(n){if(h.length===0){var o=n;if(o.status==="loading"){var m=o.usages.indexOf(i);if(m>=0){h=o.usages;o.status="loaded"}}}});h.forEach(function(n){if(n!==i&&n.id!==i.id){n.addChild(i.children[0]);var m=n.parents[0];this._updateTransactionForFatherNode(m,k)}}.bind(this))}}else{this.noNodeTransactionCounter++}this._updateTransactionForFatherNode(j,k);var g=(this.window.experience&&this.window.experience.mySPM)?this.window.experience.mySPM:this;if(g){if(this.window.experience){g.progress.loaded++;c.publish({event:this.getContext()+"/SPY/PROGRESS/UPDATE",data:{value:g.progress.loaded,total:g.progress.total}});this.window.experience.modelLoadCount=g.progress.loaded}g.processLoadFiles()}},onLoaderDoneCallback:function(){var g=0;this.transactionMap.forEach(function(i){g+=i.count});var h=this;if(g-this.noNodeTransactionCounter<=0){this.transactionMap.forEach(function(j,i){h._closeTransaction(i)});this.transactionMap.clear();this.fatherTransactionMap.clear();this.noNodeTransactionCounter=0;if(this.window.experience){setTimeout(function(){if(h.filesToLoad.length<=0){c.publish({event:h.getContext()+"/SPY/PROGRESS/END"})}},500);this.window.experience.modelLoadComplete=true;this.window.experience.modelLoadCount=0;this.window.experience.modelPrevLoadCount=0}c.publish({event:this.getContext()+"/SPY/VISULOADING/FINISHED"})}}});return f.namespace("DS/SPY/SimulationPlayerModel",b)});define("DS/SPY/CATSimNavDataDisplayAbstract",["UWA/Core","UWA/Class","DS/CoreEvents/Events"],function(e,d,a){var c=100;var b=d.extend({_computeScopeMinMax:function(g){var f=this.getLegend();if(f&&f.localMin&&f.localMax){g.min=Math.min.apply(null,f.localMin.slice(g.globalStart,g.globalEnd+1));g.max=Math.max.apply(null,f.localMax.slice(g.globalStart,g.globalEnd+1))}},init:function(h,g,f){this.spm=g;this.seq=f;this.id="";this.name="Data Display";this.category="Model";this.thumbnail="";this.defaultMode="ENG";this.activated=false;this.list2DViews=[];this.list3DViews=[];this.listFrameViews=[];this.impl={CATISimNavDataDisplayUI:{module:"SPYUI",ext:"CATSimNavDataDisplayUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataDisplayAnimation",type:"data",obj:null},CATISimNavDataColorShadingManager:{module:"SPYUI",ext:"CATSimNavDataDisplayColorShadingManager",type:"data",obj:null}}},clean:function(){delete this.spm;delete this.seq;delete this.list2DViews;delete this.list3DViews;delete this.listFrameViews;delete this.impl},QI:function(f,g){if(!this.impl[f]){g()}else{if(this.impl[f].obj){g(this.impl[f].obj)}else{require(["DS/"+(this.impl[f].module?this.impl[f].module:"SPY")+"/"+this.impl[f].ext],function(h){if(this.impl){this.impl[f].obj=new h();this.impl[f].obj.implementation=this;for(var i in this.impl){if(this.impl[i].ext===this.impl[f].ext){this.impl[i].obj=this.impl[f].obj}}g(this.impl[f].obj)}else{g()}}.bind(this))}}},getSPM:function(){return this.spm},getSequence:function(){return this.seq},getNavData2DViewList:function(h){var k=[];if(this.spm&&this.list2DViews){var f=[];if(!this.isShared&&undefined===h){var g=this.spm.getSharedDataDisplayList(this.seq);if(g){for(var j=0;j<g.length;j++){f=f.concat(g[j].getNavData2DViewList())}}}k=this.list2DViews.concat(f)}return k},getNavData3DViewList:function(j){var g=[];if(this.spm&&this.list3DViews){var f=[];if(!this.isShared&&undefined===j){var h=this.spm.getSharedDataDisplayList(this.seq);if(h){for(var k=0;k<h.length;k++){f=f.concat(h[k].getNavData3DViewList())}}}g=this.list3DViews.concat(f)}return g},getNavDataFrameViewList:function(l){var k=(undefined===l||true===l)?this.category:undefined;var g=[];if(this.spm&&this.listFrameViews){var f=[];if(!this.isShared){var h=this.spm.getSharedDataDisplayList(this.seq,k);if(h){for(var j=0;j<h.length;j++){f=f.concat(h[j].getNavDataFrameViewList())}}}g=this.listFrameViews.concat(f)}return g},isEmpty:function(){var f=this.getNavData3DViewList();var h=this.getNavData2DViewList();var g=this.getLegend();return(f.length===0&&h.length===(g?1:0)&&this.listFrameViews.length===0)},getStreamlines:function(){var j=[];var g=this.getNavData3DViewList();if(g.length){for(var f=0;f<g.length;f++){var h=g[f];if(h.subType==="streamLines"){h.isAStreamLine=true;j.push(h)}}}return j},hasExtremaAvailable:function(f){var p=false;var o=this.getNavData3DViewList();var n;for(var m=0;m<o.length&&!n;m++){if(o[m].getType()==="CATSimNavData3DExtremasRoot"){n=o[m]}}if(n){var l=n.getListExtremasSet();for(var k=0;k<l.length&&!p;k++){var g=l[k];if(g){var h=g.getExtremas(f);p=h&&h.getListExtrema().length>0}}}return p},getLegend:function(){var g;var h=this.getNavData2DViewList();for(var f=0;f<h.length;f++){if(h[f].type==="CATSimNavData2DLegend"){g=h[f];break}}return g},hasMinMax:function(){var f=this.getLegend();return f&&f.localMin&&f.localMax&&f.localMin.length>0&&f.localMax.length>0},getGroupInfo:function(k){var g={};var i=this.getLegend();if(i){var h=this.getGroupForFrame(k);if(h){var f=function(o){var l={};var m=o.globalStart;var p=o.globalEnd;l.min=i.localMin[m];l.max=i.localMax[p];for(var n=m+1;n<=p;n++){if(i.localMin[n]<l.min){l.min=i.localMin[n]}if(i.localMax[n]>l.max){l.max=i.localMax[n]}}return l};if(h.group){var j=f(h.group);g.groupMin=j.min;g.groupMax=j.max}}g.localMin=i.localMin[k];g.localMax=i.localMax[k];g.frameIndex=k;g.userMin=i.userMin;g.userMax=i.userMax}return g},updateLegend:function(h){var g=this.getLegend();if(g&&h&&h.globalStart>=0&&h.globalStart<g.localMin.length&&h.globalEnd<g.localMin.length){g.min=g.localMin[h.globalStart];g.max=g.localMax[h.globalStart];for(var i=h.globalStart+1;i<=h.globalEnd;i++){if(g.localMin[i]<g.min){g.min=g.localMin[i]}if(g.localMax[i]>g.max){g.max=g.localMax[i]}}}},hasNoGlobalData:function(){if(undefined===this._noGlobalData){var f=this.getLegend();if(f){this._noGlobalData=f.hasNoGlobalFlag()}}return this._noGlobalData},isAnimated:function(){var g=false;var f=this.getAnimationStructure();if(f){g=f.totalFrameNumber>1}return g},isAnimationInitialized:function(){return this.animationInitialized},setAnimationAsInitialized:function(){this.animationInitialized=true},getTotalNumberOfFrames:function(){var g;var f=this.getAnimationStructure();if(f){g=f.totalFrameNumber}return g},getAnimationStructure:function(){if(!this.animationStructure){var f=this.getLegend();if(f){this.animationStructure=f.animationStructure}}return this.animationStructure},getIsolatedFrames:function(){var j=[];var f=this.getAnimationStructure();if(f&&f.groupList){for(var h=0;h<f.groupList.length;h++){var i=f.groupList[h];if(i){if(i.frameList&&i.frameList.length===1){if(i.frameList[0].globalIndex!==undefined){j.push(i.frameList[0].globalIndex)}}}}}return j},getGroupForFrame:function(m){var h={};var i=this.getAnimationStructure();if(!isNaN(m)&&i&&i.groupList){for(var j=0;j<i.groupList.length;j++){var l=i.groupList[j];if(l){if(l.frameList){for(var k=0;k<l.frameList.length;k++){var n=l.frameList[k];if(n&&n.globalIndex===m+1){h.group=l;h.frame=n;return h}}}}}}return h},setPartialAnimationMode:function(f){if(typeof(f)==="boolean"){this._partialAnimMode=f;a.publish({event:this.spm.ctx+"/SPY/ANIMSCOPECHANGE"})}},isPartialAnimationMode:function(){return this._partialAnimMode},getDefaultAnimationScope:function(m){var h={};h.groupIDs=[];h.groupIDsNoMode=[];h.frames=[];h.hasModes=false;var j=this.getAnimationStructure();var i=this.getGroupForFrame(m);if(j){h.globalStart=0;h.globalEnd=j.totalFrameNumber-1;h.localPosition=i.frame.globalIndex;var k;for(k=0;k<j.groupList.length;k++){h.groupIDs.push(j.groupList[k].id);h.groupIDsNoMode.push(j.groupList[k].idNoMode);h.frames=h.frames.concat(j.groupList[k].frameList);h.hasModes=h.hasModes?h.hasModes:j.groupList[k].isMode}h.length=h.frames.length;if(j.computedFramesOnlyForDefault){h.frames=[];for(k=0;k<j.groupList.length;k++){h.frames=h.frames.concat(j.groupList[k].computedFrameList)}h.globalStart=h.frames[0].globalIndex-1;h.globalEnd=h.frames[h.frames.length-1].globalIndex-1;h.length=h.frames.length;h.localPosition=h.frames.length;for(var l=0;l<h.frames.length;l++){var n=h.frames[l];if(n&&n.globalIndex===m){h.localPosition=l}}}this._computeScopeMinMax(h)}return h},getAnimationScope:function(k){var f={};f.groupIDs=[];f.groupIDsNoMode=[];f.frames=[];f.hasModes=false;var i=this.getAnimationStructure();var h=this.getGroupForFrame(k);if(i&&h&&h.group){if(h.group.isComplex||this.hasLockableCurves){f.canBePartial=true;f.globalStart=h.group.globalStart;f.globalEnd=h.group.globalEnd;f.localPosition=h.frame.localIndex;f.groupIDs.push(h.group.id);f.groupIDsNoMode.push(h.group.idNoMode);f.frames=f.frames.concat(h.group.frameList);f.hasModes=h.group.isMode}else{f.globalStart=0;f.globalEnd=i.totalFrameNumber-1;f.localPosition=h.frame.globalIndex;for(var j=0;j<i.groupList.length;j++){f.groupIDs.push(i.groupList[j].id);f.groupIDsNoMode.push(i.groupList[j].idNoMode);f.frames=f.frames.concat(i.groupList[j].frameList);f.hasModes=f.hasModes?f.hasModes:i.groupList[j].isMode}}f.length=f.frames.length;this._computeScopeMinMax(f)}if(f.length<=1){f.canBePartial=false}return f},getClosestComputedFrameInGroup:function(l){var i;var f=this.getGroupForFrame(l);if(f&&f.group&&f.frame){var k=f.group;var j=f.frame;var h=false;while(!h&&j.localIndex>=1&&j.localIndex<=k.frameList.length){h=!j.isScaledPosition;if(!h){var g=j.localIndex;j=g>=0?k.frameList[g]:k.frameList[k.frameList.length-1]}}if(h){i=j.globalIndex}}return i},getComputedFramesByGroup:function(){var f;var j=this.getAnimationStructure();if(j&&j.groupList.length>0){f=new Map();var l=j.groupList[0];var i=l.idNoMode;var h=l.computedFrameList;f.set(l.idNoMode,h);for(var k=1;k<j.groupList.length;k++){l=j.groupList[k];if(l.idNoMode===i){h=h.concat(l.computedFrameList)}else{h=l.computedFrameList}f.set(l.idNoMode,h);i=l.idNoMode}}return f},getRetexturingMode:function(j,f){var h="NEUTRAL";var i=this.getIsolatedFrames();i=(i===undefined)?[]:i;if(i.indexOf(j+1)>-1||(this.hasNoGlobalData()&&!this.animationStructure.computedFramesOnlyForDefault)){h=f?"REDUCE":"NEUTRAL"}else{if(this.noFramePosition){h=f?"NEUTRAL":"EXTEND"}else{var g=this.getGroupForFrame(j);if(g&&g.group){if(g.group.scaledAnimation){if(g.frame.isScaledPosition){h=f?"NEUTRAL":(g.group.scalingType===2?"NEUTRAL":"EXTEND")}else{h=f?"REDUCE":"NEUTRAL"}}else{h=f?"REDUCE":"NEUTRAL"}}}}return h},isLarge:function(){return this.list3DViews.length>c},resetLoadingStatus:function(){var f=this.list2DViews.concat(this.list3DViews);for(var h=0;h<f.length;h++){var g=f[h];if(g&&g.resetLoadingStatus){g.resetLoadingStatus()}}},getCameraRoot:function(){return undefined},getMultiInstanciatedFiles:function(){return undefined},registerChart:function(){this._containsCharts=true},registerImage:function(){this._containsImages=true},containsCharts:function(){var f=this._containsCharts;if(!f){var g=this.spm.getSharedDataDisplayList(this.seq,this.category);if(g){g.forEach(function(h){if(!f){f=h._containsCharts}})}}return f},containsImages:function(){return this._containsImages}});return e.namespace("DS/SPY/CATSimNavDataDisplayAbstract",b)});define("DS/SPY/CATSimNavDataHelper",["UWA/Core","UWA/Class"],function(f,e){var b="?|?";var c="_Mode";var d=" - ";var a=e.singleton({init:function(){},parseGroupIds:function(g){var h=[];if(g){h=g.split(b)}return h},isModeSeparator:function(g){return g===c},buildGroupIdNoMode:function(h,g){return(g&&!this.isModeSeparator(g)?h+b+g:h)},buildGroupName:function(g){var h="";if(g&&g.length>0){h=g[0];for(var j=1;j<g.length;j++){if(g[j]){h+=d+g[j]}}}return h},buildGroupNameFromIds:function(g){return this.buildGroupName(this.parseGroupIds(g))}});return f.namespace("DS/SPY/CATSimNavDataHelper",a)});define("DS/SPY/CATSimNavDataChartAxis",["UWA/Core"],function(b){var a=b.Class.extend({init:function(c,d){this._dimension=1;this._position="bottom";this._scale="linear";this._fixedBounds=false;this.readFromXML(c,d)},setId:function(c){if(!isNaN(c)){this._identifier=c}},getId:function(){return this._identifier},setName:function(c){this._name=c},getName:function(){return this._name},setDimension:function(c){this._dimension=c;if(this._dimension===2&&this._position==="bottom"){this._position="left"}},getDimension:function(){return this._dimension},getPosition:function(){return this._position},getScale:function(){return this._scale},setUnit:function(c){this._unit=c},getUnit:function(){return this._unit},hasFixedBounds:function(){return this._fixedBounds},getFixedBounds:function(){return{min:this._fixedMin,max:this._fixedMax}},getColor:function(){return this._color},getTickNb:function(){return this._tickNb},getValueOfInterest:function(){return this._voi},getPrecision:function(){return this._precision},getExponent:function(){return this._exp},readFromXML:function(h,o){if(h){this._name=h.getAttribute("name");var c=parseInt(h.getAttribute("id"));if(!isNaN(c)){this._identifier=c}var l=h.getAttribute("dimension");if(l==="2"){this._dimension=2;this._position="left"}var m=h.getAttribute("position");if(m){if(this._dimension===1){this._position=m==="top"?m:this._position}else{this._position=m==="right"?m:this._position}}var e=h.getAttribute("scale");if(e==="log"||e==="percentage"){this._scale=e}var n=h.getAttribute("unit");this._unit=n?n:"";var p=parseFloat(h.getAttribute("fixedMin"));var d=parseFloat(h.getAttribute("fixedMax"));if(!isNaN(p)){this._fixedBounds=true;this._fixedMin=e==="log"?Math.pow(10,p):p}if(!isNaN(d)){this._fixedBounds=true;this._fixedMax=e==="log"?Math.pow(10,d):d}var g=h.getAttribute("color");if(g){this._color=g}var k=parseInt(h.getAttribute("tickNb"));if(!isNaN(k)){this._tickNb=k}var j=parseInt(h.getAttribute("precision"));if(!isNaN(j)){this._precision=j}var f=parseInt(h.getAttribute("exp"));if(!isNaN(f)){this._exp=f}var i=parseFloat(h.getAttribute("interest"));if(!isNaN(i)){this._voi=i}}if(o){o()}}});return b.namespace("DS/SPY/CATSimNavDataChartAxis",a)});define("DS/SPY/CATSimNavDataSpec",["UWA/Core"],function(c){var b={};var a=c.Class.extend({init:function(e,d){this.dd=d;this.name=e?e.getAttribute("name"):undefined;this.id=e?e.getAttribute("id"):undefined;this.type=e?e.getAttribute("type"):undefined;this.subType=e?e.getAttribute("subType"):undefined;this.supportedModes=e?e.getAttribute("supportedModes"):undefined;this.matRendering=e?e.getAttribute("matRendering"):undefined;this.unit=e?e.getAttribute("unit"):undefined;this.defaultMode="ENG";this.visibility=e?e.getAttribute("DefVis")!=="0":true;this.active=!this.supportedModes||this.supportedModes.indexOf(this.defaultMode)!==-1;this.sibling=undefined;this.siblingSearched=false;this.listLinks=[]},_createExtension:function(e,f,g){if(this.impl){if(!this.impl[e].obj){this.impl[e].obj=new f(this);this.impl[e].obj.implementation=this;for(var d in this.impl){if(this.impl[d]&&this.impl[d].ext===this.impl[e].ext){this.impl[d].obj=this.impl[e].obj}}}if(g){g(this.impl[e].obj)}}else{g()}},QI:function(f,g){if(!this.impl[f]){g()}else{if(this.impl[f].obj){this.impl[f].obj.implementation=this;g(this.impl[f].obj)}else{var d="DS/"+(this.impl[f].module?this.impl[f].module:"SPY")+"/"+this.impl[f].ext;var e=b[d];if(!e){b[d]={status:"requested",queue:[]};require([d],function(h){b[d].status="loaded";b[d].typeClass=h;this._createExtension(f,h,g);var i=b[d];while(i.queue&&i.queue.length>0){if(i.queue[0]){i.queue[0](h);i.queue.shift()}}}.bind(this))}else{if(e.status==="loaded"){this._createExtension(f,e.typeClass,g)}else{if(e.status==="requested"){e.queue.push(function(h){this._createExtension(f,h,g)}.bind(this))}}}}}},getDataDisplay:function(){return this.dd},getName:function(){return this.name},getId:function(){return(this.id?this.id:this.name)},getType:function(){return this.type},getSupportedMode:function(){return this.mode},getSibling:function(){var g=this.supportedModes;if(g==="ENG"||g==="REA"){if(this.sibling===undefined&&!this.siblingSearched&&this.dd&&this.name.length>0){this.siblingSearched=true;var d=false;var f;var e;if(this.type==="CATSimNavData2DView"||this.type==="CATSimNav2DAnimationView"){for(e=0;this.dd.list2DViews&&e<this.dd.list2DViews.length&&!d;e++){f=this.dd.list2DViews[e];if(f&&f.name===this.name&&f!==this&&f.supportedModes!==g){this.sibling=f;d=true}}}else{if(this.type==="CATSimNavData3DView"||this.type==="CATSimNavData3DAnimationView"){for(e=0;this.dd.list3DViews&&e<this.dd.list3DViews.length&&!d;e++){f=this.dd.list3DViews[e];if(f&&f.name===this.name&&f!==this&&f.supportedModes!==g){this.sibling=f;d=true}}}}}}return this.sibling},isActive:function(){return this.active},setActive:function(d){this.active=d},getUnit:function(){return this.unit},getLinks:function(d){return this.listLinks[d]},addLink:function(f,e){var d=this.listLinks[f];if(d===undefined){this.listLinks[f]=e}else{d.appendSpec(e)}},readFromXML:function(){}});return c.namespace("DS/SPY/CATSimNavDataSpec",a)});define("DS/SPY/CATSimNavDataLink",[],function(){return function(b,a,c){this.dd=a;this._resourcePath="";this.nextSpec=null;this.getNextSpec=function(){return this.nextSpec};this.appendSpec=function(d){if(this.nextSpec===null){this.nextSpec=d}else{this.nextSpec.appendSpec(d)}};this.getPointedResource=function(){return this._resourcePath};this.setPointedResource=function(d){this._resourcePath=d};this.getPointedData=function(){if(this._pointedDataId&&!this._pointedData){for(var d=0;this.dd.list3DViews&&d<this.dd.list3DViews.length;d++){if(this.dd.list3DViews[d].getId()===this._pointedDataId){this._pointedData=this.dd.list3DViews[d]}}}return this._pointedData};this.setPointedData=function(d){this._pointedDataId=d;this._pointedData=null};this.getMatrix=function(){return this._matrix};this.readFromXML=function(e,j){if(e){var i=e.getAttribute("id");var d=e.getAttribute("name");this.setPointedData(i?i:d);var h;var f=parseInt(e.getAttribute("srcId"));if(!isNaN(f)){var g=this.dd.spm.getDataList("src",this.dd.seq);h=g.getEntry(f-1).val}else{h=e.getAttribute("src")}this.setPointedResource(h);if(j){j(this)}}};this.readFromXML(b,c)}});define("DS/SPY/CATSimNavDataAbstractFactory",["UWA/Core","UWA/Class"],function(c,b){var a=b.extend({init:function(){},createSequence:function(e,d){console.error("CATSimNavDataAbstractFactory - abstract createSequence should not be called")},});return c.namespace("DS/SPY/CATSimNavDataAbstractFactory",a)});define("DS/SPY/CATSimNavDataXYValue",function(){return function(a,c,b){this.index=-1;this.getX=function(){return this.X};this.setX=function(d){this.X=d};this.getY=function(){return this.Y};this.setY=function(d){this.Y=d};this.setIndex=function(d){this.index=d};this.getIndex=function(){return this.index};this.getGroupId=function(){return this.groupId};this.setGroupId=function(d){this.groupId=d};this.getPosition=function(){return this.position};this.setPosition=function(d){this.position=d};this.readFromXML=function(e,k,j){var d;var h=e.getAttribute("X");if(h&&h.length>0){d=Number(h)}this.setX(d);this.setY(Number(e.getAttribute("Y")));var g=j&&j.group?j.group:e.getAttribute("group");this.setGroupId(g);var i;var f=j&&j.position?j.position:e.getAttribute("position");if(f&&f.length>0){i=Number(f)}this.setPosition(i);k(this)};if(a){this.readFromXML(a,c,b)}}});define("DS/SPY/SimulationPlayerUI",["DS/SPYUI/controllers/SimulationPlayerUI"],function(a){console.warn("SimulationPlayerUI (SPMUI) module has moved. use DS/SPYUI/controllers/SimulationPlayerUI instead of DS/SPY/SimulationPlayerUI");console.warn("SimulationPlayerUI (SPMUI) module should not be used directly. Please contact owner to expose required services through API");return a});define("DS/SPY/CATSimNavData3DAnimationExtremaProvider",["UWA/Core"],function(b){var a=b.Class.extend({init:function(){this._parent()},getImpl:function(){return this.implementation},getExtrema:function(e){var t={listMin:[],listMax:[]};if(this.implementation){var r=this.implementation.dd;var d=r.getNavData3DViewList("plotContentOnly");var l;for(var k=0;k<d.length&&!l;k++){if(d[k].getType()==="CATSimNavData3DExtremasRoot"){l=d[k]}}if(l){var s;var h=l.getListExtremasSet();for(var g=0;g<h.length&&!s;g++){var f=h[g];if(f){var o=f.getLinks("ExtremasToPart");if(o){var n=o.getPointedData();if(n&&(n.getId()===this.implementation.getId())){s=f}}}}if(s){var q=s.getExtremas(e);if(q){var c=q.getListExtrema();if(c){for(var p=0;p<c.length;p++){var m=c[p];if(m){m.setComponent(this.implementation);if(m.getExtremaType()==="Min"){t.listMin.push(m)}else{t.listMax.push(m)}}}}}}}}return t}});return b.namespace("DS/SPY/CATSimNavData3DAnimationExtremaProvider",a)});define("DS/SPY/CATSimNavDataList",["UWA/Core","UWA/Class"],function(c,b){var a=b.extend({init:function(g){if(g&&g.nodeName==="List"){this._name=g.getAttribute("name");this._entries=[];var d=g.children;for(var i=0;i<d.length;i++){var h={};var j=d[i].getAttributeNames();for(var f=0;f<j.length;f++){h[j[f]]=d[i].getAttribute(j[f])}this._entries.push(h)}}},getName:function(){return this._name},getEntry:function(d){return this._entries[d]}});return c.namespace("DS/SPY/CATSimNavDataList",a)});define("DS/SPY/CATSimNavData3DRepStaticView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],function(b,c){var a=b.extend({init:function(f,d,e,g){this._parent(f,d);this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DRepStaticViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavData3DStaticColorShading",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}};this.readFromXML(f,g)},getCGRList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(h,q){var d=0;var o=false;var r=function(i){if(i){this.addLink("SP_StaticList",i);d--;if(d===0&&o&&q){q()}}}.bind(this);for(var m=0;m<h.children.length;m++){var f=h.children[m];if(f.getAttribute("level")!=="1"){continue}for(var l=0;l<f.children.length;l++){var e=f.children[l];if(e){for(var g=0;g<e.children.length;g++){var p=e.children[g];d++;var n=new c(p,this.dd,r)}}}}o=true;if(d===0){q()}}});return UWA.namespace("DS/SPY/CATSimNavData3DRepStaticView",a)});define("DS/SPY/CATSimNavData2DLegend",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/CoreEvents/Events","DS/SPY/CATSimNavDataHelper"],function(f,d,a,b){var e=function(l){if(l){for(var o=0;o<l.length;o++){var m=l[o];var h=(o+1)<l.length?l[o+1]:undefined;m.displayName="";var n=b.parseGroupIds(m.id);if(n.length>0){m.rootName=n[0];m.displayName+=m.rootName;if(n.length>1){m.isComplex=true}}for(var k=1;k<n.length;k++){if(b.isModeSeparator(n[k])){var q=(k+1<n.length)?parseInt(n[k+1]):undefined;m.modeIndex=q;m.isMode=(!isNaN(q)&&q>=0);var p="Mode "+(undefined!==q?q.toString():"index missing");var g=m.isScaledPosition?h:m;var j=1;while(g&&g.isScaledPosition){g=(o+j)<l.length?l[o+j]:undefined;j++}if(g){p=g.position+(g.positionUnit?" "+g.positionUnit:"")}m.displayName+=" - "+p;break}else{if(isNaN(parseInt(n[k]))){m.loadName=n[k];m.displayName+=" - "+n[k]}else{}}}}}};var c=d.extend({_parseDataFrame:function(h){this.title=h.getAttribute("title");this.scaleFactor=parseFloat(h.getAttribute("scaleFactor"));this.inverseState=h.getAttribute("inverseState");this.min=parseFloat(h.getAttribute("max"));this.max=parseFloat(h.getAttribute("min"));if(this.min===0&&this.max===0){this.noGlobalFlag=true}var i=parseFloat(h.getAttribute("userMin"));if(!isNaN(i)){this.userMin=i}var g=parseFloat(h.getAttribute("userMax"));if(!isNaN(g)){this.userMax=g}this.unit=h.getAttribute("unit")},_parseFrameSet:function(r){for(var n=0;n<r.children.length;n++){var q=r.children[n];if(q.nodeName==="Frame"||q.nodeName==="LocalMinMax"){var v=parseFloat(q.getAttribute("localMin"));if(!isNaN(v)){this.localMin.push(v);if(v<=this.min){this.min=v}}var h=parseFloat(q.getAttribute("localMax"));if(!isNaN(h)){this.localMax.push(h);if(h>=this.max){this.max=h}}var g=-1;var i=parseFloat(q.getAttribute("scaleFactor"));if(!isNaN(i)&&i>0){g=i}else{if(!isNaN(this.scaleFactor)&&this.scaleFactor>0){g=this.scaleFactor}}this.deformationScales.push(g);var p=undefined;var o;var m;var t;var s;if(q.nodeName==="Frame"){var l=q.getAttribute("frmId");var k=this.dd.spm.getFrameDetails(l,this.dd.seq);o=k.position;m=k.scaled;t=k.group;s=k.unit}else{t=q.getAttribute("group");o=q.getAttribute("position");m=q.getAttribute("scaled");s=q.getAttribute("unit")}if(o&&o.length>0){p=Number(o)}if(!isNaN(p)&&this.animationStructure.noFramePosition){this.animationStructure.noFramePosition=false}var w=(m!==undefined&&m!==null&&m!==""&&m!=="0");var u;if(w){u=parseInt(m);if(u===2){this.hasScanAnimation=true}}this.animRawData.push({id:t,position:p,positionUnit:s,isScaledPosition:w,scalingType:u})}}},init:function(i,g,h,j){this._parent(i,g);this.localMin=[];this.localMax=[];this.deformationScales=[];this.animRawData=[];this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DLegendUI",type:"data",obj:null}};this.readFromXML(i,j)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(t,p){this.animationStructure={noFramePosition:true};for(var D=0;D<t.children.length;D++){var C=t.children[D];switch(C.nodeName){case"DataFrame":this._parseDataFrame(C);break;case"PaletteFrame":this.palette=C.getAttribute("src");break;case"DiscreteValues":this.labels=b.parseGroupIds(C.getAttribute("labels"));this.colors=b.parseGroupIds(C.getAttribute("colors"));break;case"FrameSet":this._parseFrameSet(C);break;default:break}}e(this.animRawData);this.animationStructure.groupList=[];var q=0;var k=0;var n=0;var s;var w;var y;var h;var o=false;var F;var A=false;var z;var G=0;var g=0;var B=0;var r;var v=0;var j=0;for(var H=0;H<this.animRawData.length;H++){var E=this.animRawData[H];if(E.id!==s){q=0;s=E.id;w=E.displayName;y=E.rootName;h=E.positionUnit;o=E.isComplex;F=E.loadName;A=E.isMode;z=A?E.modeIndex:undefined;G=0;g=0;B=0;r={index:n,id:s,idNoMode:b.buildGroupIdNoMode(y,F),name:w,rootName:y,frameList:[],computedFrameList:[],scaledAnimation:false,scalingFactor:G,globalStart:k,globalEnd:k,unit:h,isComplex:o,loadCaseName:F,isMode:A,modeIndex:z};this.animationStructure.groupList.push(r);n++}if(r){q++;k++;var m="";var x=E.position;var u=E.positionUnit;if(!isNaN(x)){m=x.toString()+(u?" "+u:"");g++;j++}else{if(E.isScaledPosition){m="scaled";r.scaledAnimation=true;r.scalingType=E.scalingType;B++}}if(this.animationStructure.noFramePosition){m="frame "+q}var l={name:m,globalIndex:k,localIndex:q,isScaledPosition:E.isScaledPosition,position:x};r.frameList.push(l);if(!E.isScaledPosition){r.computedFrameList.push(l)}r.globalEnd=k-1;r.scalingFactor=g>0?(g+B)/g:0;r.numberComputedFrames=g;if(r.scaledAnimation&&r.isMode){v++}}else{}}this.animationStructure.totalFrameNumber=k;if(v>1){this.animationStructure.computedFramesOnlyForDefault=true;this.animationStructure.totalComputedFramesNumber=j}p()},hasNoGlobalFlag:function(){return this.noGlobalFlag},setUserMin:function(j,h,i){i=(i===undefined?true:i);if(j!==undefined&&isNaN(j)){return"E_INVALIDARG"}else{if(j!==this.userMin){if(!this._inEdition){var g=!isNaN(h)&&h>=0&&h<this.localMax.length;this._inEdition=true;if(j===undefined){this.userMin=undefined}else{if(!isNaN(this.userMax)){if(j>this.userMax){this.userMin=this.userMax}else{this.userMin=j}}else{if(g){this.userMin=j<=this.localMax[h]?j:this.localMax[h]}else{this.userMin=j<=this.max?j:this.max}}}a.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMIN",data:{value:this.userMin,computed:g?this.localMin[h]:undefined,unit:this.unit,syncFlag:i}});this._inEdition=false}}}return this.userMin},getUserMin:function(){return this.userMin},setUserMax:function(j,h,i){i=(i===undefined?true:i);if(j!==undefined&&isNaN(j)){return"E_INVALIDARG"}else{if(j!==this.userMax){if(!this._inEdition){var g=!isNaN(h)&&h>=0&&h<this.localMin.length;this._inEdition=true;if(j===undefined){this.userMax=undefined}else{if(!isNaN(this.userMin)){if(j<this.userMin){this.userMax=this.userMin}else{this.userMax=j}}else{if(g){this.userMax=j>=this.localMin[h]?j:this.localMin[h]}else{this.userMax=j>=this.min?j:this.min}}}a.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMAX",data:{value:this.userMax,computed:g?this.localMax[h]:undefined,unit:this.unit,syncFlag:i}});this._inEdition=false}}}return this.userMax},getUserMax:function(){return this.userMax},getComputedMin:function(h){var g=this.min;if(!isNaN(h)){g=(h>=0&&h<this.localMin.length)?this.localMin[h]:undefined}return g},getComputedMax:function(g){var h=this.max;if(!isNaN(g)){h=(g>=0&&g<this.localMax.length)?this.localMax[g]:undefined}return h},getMinMaxData:function(g){return{unit:this.unit,userMin:this.getUserMin(),userMax:this.getUserMax(),computedMin:this.getComputedMin(g),computedMax:this.getComputedMax(g)}},integrateMinMaxData:function(h,k){var n,j;var i=(!isNaN(k)&&k>=0&&k<this.localMin.length)?this.localMin[k]:this.min;var m=(!isNaN(k)&&k>=0&&k<this.localMax.length)?this.localMax[k]:this.max;var l=!isNaN(this.userMin)?this.userMin:i;var g=!isNaN(this.userMax)?this.userMax:m;if(h&&h.length>0){h.forEach(function(p){if(p.unit===this.unit){var o=(p.userMin!==null&&!isNaN(p.userMin))?p.userMin:p.computedMin;var q=(p.usermax!==null&&!isNaN(p.userMax))?p.userMax:p.computedMax;if(o<l){n=o;l=n}if(q>g){j=q;g=j}}}.bind(this))}n=!isNaN(n)?n:l;if(n===this.userMin){a.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMIN",data:{value:n,unit:this.unit,syncFlag:true}})}else{this.setUserMin(n,k,true)}j=!isNaN(j)?j:g;if(j===this.userMax){a.publish({event:this.getDataDisplay().getSPM().getContext()+"/SPY/LEGEND/EDIT/USERMAX",data:{value:j,unit:this.unit,syncFlag:true}})}else{this.setUserMax(j,k,true)}}});return f.namespace("DS/SPY/CATSimNavData2DLegend",c)});define("DS/SPY/CATSimNavData2DRepStaticView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],function(a,c){var b=a.extend({init:function(f,d,e,g){this._parent(f,d);this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DRepStaticViewUI",type:"data",obj:null}};this.readFromXML(f,g)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(h,q){var d=0;var o=false;var r=function(i){if(i){this.addLink("SP_StaticList",i);d--;if(d===0&&o&&q){q()}}}.bind(this);for(var m=0;m<h.children.length;m++){var f=h.children[m];if(f.getAttribute("level")!=="1"){continue}for(var l=0;l<f.children.length;l++){var e=f.children[l];if(e){for(var g=0;g<e.children.length;g++){var p=e.children[g];d++;var n=new c(p,this.dd,r)}}}}o=true;if(d===0){q()}}});return UWA.namespace("DS/SPY/CATSimNavData2DRepStaticView",b)});define("DS/SPY/CATSimNavData2DAnimationView",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink"],function(a,c){var b=a.extend({init:function(f,d,e,g){this._parent(f,d);this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData2DAnimationViewUI",type:"data",obj:null}};this.readFromXML(f,g)},getPNGList:function(){return this.getLinks("SP_StaticList")},readFromXML:function(h,q){var d=0;var o=false;var r=function(i){if(i){this.addLink("SP_StaticList",i);d--;if(d===0&&o&&q){q()}}}.bind(this);for(var m=0;m<h.children.length;m++){var f=h.children[m];if(f.getAttribute("level")!=="1"){continue}for(var l=0;l<f.children.length;l++){var e=f.children[l];if(e){for(var g=0;g<e.children.length;g++){var p=e.children[g];d++;var n=new c(p,this.dd,r)}}}}o=true;if(d===0){q()}}});return UWA.namespace("DS/SPY/CATSimNavData2DAnimationView",b)});define("DS/SPY/CATSimNavDataFrameViewComp",["DS/SPY/CATSimNavDataSpec"],function(b){var a=b.extend({init:function(d,c){this._parent(d,c)},getValues:function(){alert("error: call to getValues on CATSimNavDataFrameViewComp")},readFromXML:function(c,d){alert("error: call to readFromXML on CATSimNavDataFrameViewComp")},isComplex:function(){return false}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewComp",a)});define("DS/SPY/CATSimNavDataFrameViewImage",["DS/SPY/CATSimNavDataFrameViewComp"],function(a){var b=a.extend({init:function(e,c,d,f){if(c){c.registerImage()}this._parent(e,c);this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewImageUI",type:"data",obj:null}};this.readFromXML(e,f)},getTitle:function(){return this.name},getTooltip:function(){return this._tooltip},getPNGList:function(){return[this._src]},readFromXML:function(c,d){if(c){this._tooltip=c.getAttribute("tooltip");this._src=c.getAttribute("src");if(d){d(this)}}}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewImage",b)});define("DS/SPY/CATSimNavDataFrameView",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],function(a,d){var b=Node.ELEMENT_NODE;var c=a.extend({init:function(g,e,f,h){this._parent(g,e);this.tempChildren=[];this.children=[];this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavDataFrameViewUI",type:"data",obj:null},CATISimNavDataColorShading:{module:"SPYUI",ext:"CATSimNavDataFrameViewColorShading",type:"data",obj:null}};this.readFromXML(g,f,h)},getChildren:function(){return this.children},readFromXML:function(g,f,p){if(g){var m=null;var o=function(){var j=0;var i=false;var w=function(r){return function(x){var y=new x(r,this.dd,f,function(z){this.tempChildren[r._spyRank]=z;j--;if(j===0&&i&&p){this.tempChildren.forEach(function(A){if(A){this.children.push(A)}}.bind(this));this.tempChildren=[];p(this)}}.bind(this))}.bind(this)}.bind(this);var u=false;for(var v=0,t=0;v<g.children.length;v++){var q=g.children[v];var s=null;if(q.nodeName==="DDXYPlot"||q.nodeName==="DDXYChart"){s="DS/SPY/CATSimNavDataFrameViewXYChart"}else{if(q.nodeName==="DDScalar"){s="DS/SPY/CATSimNavDataFrameViewCompValue"}else{if(q.nodeName==="DDText"){s="DS/SPY/CATSimNavDataFrameViewText"}else{if(q.nodeName==="DDImage"){s="DS/SPY/CATSimNavDataFrameViewImage"}else{if(q.nodeName==="DDElementFrame"){s="DS/SPY/CATSimNavDataFrameView";u=true}}}}}if(s){q._spyRank=t++;this._isComplex=u;j++;require([s],(w)(q))}}i=true;if(j===0){p(this)}}.bind(this);for(var l=0;l<g.childNodes.length;l++){var k=g.childNodes[l];if(k.nodeType!==b||k.nodeName!=="LinkSet"||k.getAttribute("role")!=="Frameto3D"){continue}for(var h=0;h<k.childNodes.length&&m===null;h++){var n=k.childNodes[h];if(!n||n.nodeType!==b||n.nodeName!=="InternalRef"){continue}m=n}}if(m){var e=new d(m,this.dd,function(i){this.addLink("Frameto3D",i);o()}.bind(this))}else{o()}}},isComplex:function(){return this._isComplex}});return UWA.namespace("DS/SPY/CATSimNavDataFrameView",c)});define("DS/SPY/CATSimNavData3DCamera",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavDataLink","DS/Visualization/ThreeJS_DS"],function(c,d,b){var a=c.extend({init:function(f,e,g,h){this._parent(f,e);this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationCameraUI",type:"data",obj:null}};this._isTracking=false;this.readFromXML(f,g,h)},getThumbnail:function(){return this._thumbnail},getEyePosition:function(){return this._eyePosition},getSightDirection:function(){return this._sightDirection},getUpDirection:function(){return this._upDirection},getTargetDistance:function(){return this._focus},getAngle:function(){return this._angle},getLockedDOF:function(){return this._lockedDOF},getDescription:function(){return this._description?this._description:""},isTracking:function(){return this._isTracking},readFromXML:function(l,w,h){this._thumbnail=l.getAttribute("thumbnail");var f=l.getAttribute("camera").split("]");for(var v=0;v<f.length;++v){f[v]=f[v].replace("[","")}var n=f[0].split(";");this._eyePosition=new b.Vector3(Number(n[0]),Number(n[1]),Number(n[2]));var e=f[1].split(";");this._sightDirection=new b.Vector3(Number(e[0]),Number(e[1]),Number(e[2]));var q=f[2].split(";");this._upDirection=new b.Vector3(Number(q[0]),Number(q[1]),Number(q[2]));this._focus=Number(l.getAttribute("focus"));var t=l.getAttribute("angle");this._angle=t?Number(t):45;var m=l.getAttribute("lock");if(m){var r=m.split(";");this._lockedDOF={};for(var u=0;u<r.length;++u){this._lockedDOF[r[u]]=true}}this._description=l.getAttribute("description");var k=null;for(var s=0;s<l.childNodes.length;s++){var x=l.childNodes[s];if(x.nodeName==="LinkSet"&&x.getAttribute("role")==="CamerasToPart"){for(var p=0;p<x.childNodes.length;p++){var o=x.childNodes[p];if(o.nodeName==="InternalRef"){k=o;break}}break}}if(k){var g=new d(k,this.dd,function(i){this.addLink("CamerasToPart",i);this._isTracking=(w!==true)}.bind(this))}h(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DCamera",a)});define("DS/SPY/CATSimNavData3DCamerasRoot",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DCamera"],function(d,a,b){var c=a.extend({init:function(g,e,f,h){this._parent(g,e);this.impl={CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DCamerasRootAnimationUI",type:"data",obj:null}};this._cameraList=[];this._currentCameraIdx=0;this.readFromXML(g,f,h)},addCamera:function(e){if(e){this._cameraList.push(e)}},getCamera:function(e){return this._cameraList[e]},getListCamera:function(){return this._cameraList},getCurrentCamera:function(){return this._cameraList[this._currentCameraIdx]},getCurrentCameraIdx:function(){return this._currentCameraIdx},setCurrentCamera:function(e){this._currentCameraIdx=e},readFromXML:function(h,f,p){var k={counter:0,loopCompleted:false};var q=parseInt(h.getAttribute("currentCamera"));q=isNaN(q)?1:q;this._currentCameraIdx=q-1;var o=function(i){if(i){this.addCamera(i);k.counter--;if(k.counter===0&&k.loopCompleted&&p){p()}}}.bind(this);var e=(f&&f.types)?f.types[this.type]:undefined;var n=(e&&e.disableTracking);var g=(e&&!isNaN(e.maxChildrenNb))?e.maxChildrenNb:h.children.length;for(var l=0;l<g;l++){var j=h.children[l];if(j.nodeName.indexOf("Camera")<0){continue}k.counter++;var m=new b(j,this.dd,n,o)}k.loopCompleted=true;if(k.counter===0){p()}},getLoadingDescription:function(){return{status:"loaded"}}});return d.namespace("DS/SPY/CATSimNavData3DCamerasRoot",c)});define("DS/SPY/CATSimNavData3DAnimationView",["UWA/Core","DS/SPY/CATSimNavDataSpec","DS/Visualization/ThreeJS_DS"],function(g,e,d){var a=/[^;\[\]]+;[^;\[\]]+;[^;\[\]]+/g;var c=function(k){var j;var l=k.split(";");if(l.length===3){var i=parseFloat(l[0]);var h=parseFloat(l[1]);var m=parseFloat(l[2]);if(!isNaN(i)&&!isNaN(h)&&!isNaN(m)){j=new d.Vector3(i,h,m)}}return j};var f=function(m){var j=undefined;var n=[];var o;while((o=a.exec(m))!==null){n.push(o[0])}if(n.length===4){var k=c(n[0]);var i=c(n[1]);var h=c(n[2]);var l=c(n[3]);j=new d.Matrix4();j.set(k.x,i.x,h.x,l.x,k.y,i.y,h.y,l.y,k.z,i.z,h.z,l.z,0,0,0,1)}return j};var b=e.extend({init:function(j,h,i,k){this._parent(j,h);this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DAnimationViewUI",type:"data",obj:null},CATISimNavDataExtremaProvider:{module:"SPY",ext:"CATSimNavData3DAnimationExtremaProvider",type:"data",obj:null}};this._cgrsLinkedList={cgrs:[],status:[],matrices:[],getPointedResource:function(){var l;if(this.index>=0&&this.index<this.cgrs.length){l=this.cgrs[this.index]}return l},getMatrix:function(){var l=null;if(this.index>=0&&this.index<this.matrices.length){l=this.matrices[this.index]}return l},getNextSpec:function(){this.index++;var l=(this.index<this.cgrs.length)?this:null;return l},index:0};this.readFromXML(j,function(){if(k){k(this)}}.bind(this))},getCGRList:function(){var h;if(this._cgrsLinkedList&&this._cgrsLinkedList.cgrs.length>0){this._cgrsLinkedList.index=0;h=this._cgrsLinkedList}return h},readFromXML:function(o,w){var t=this.dd.spm.getDataList("src",this.dd.seq);for(var r=0;r<o.children.length;r++){var n=o.children[r];if(n.getAttribute("level")!=="1"){continue}for(var q=0;q<n.children.length;q++){var m=n.children[q];for(var p=0;p<m.children.length;p++){var s=m.children[p];var l=parseInt(s.getAttribute("srcId"));if(!isNaN(l)&&t){var h=t.getEntry(l-1);this._cgrsLinkedList.cgrs.push(h.val)}else{this._cgrsLinkedList.cgrs.push(s.getAttribute("src"))}this._cgrsLinkedList.status.push("notLoaded");var v=s.getAttribute("matrix");if(v){if(v===this._lastMxStr&&this._lastMx){this._cgrsLinkedList.matrices.push(this._lastMx)}else{var u=f(v);this._cgrsLinkedList.matrices.push(u);this._lastMx=u}this._lastMxStr=v}}}}w(this)},getLoadingDescription:function(i){var h;if(this._cgrsLinkedList){h={status:this._cgrsLinkedList.status[i],file:this._cgrsLinkedList.cgrs[i],matrix:this._cgrsLinkedList.matrices[i]}}return h},getAllLoadingDescription:function(){return this._cgrsLinkedList},setLoadingStatus:function(i,h){if(this._cgrsLinkedList&&this._cgrsLinkedList.status&&i>=0&&i<this._cgrsLinkedList.status.length){this._cgrsLinkedList.status[i]=h}},resetLoadingStatus:function(){if(this._cgrsLinkedList&&this._cgrsLinkedList.status){for(var h=0;h<this._cgrsLinkedList.status.length;h++){this._cgrsLinkedList.status[h]="notLoaded"}}}});return g.namespace("DS/SPY/CATSimNavData3DAnimationView",b)});define("DS/SPY/CATSimNavData3DVirtualComponent",["DS/SPY/CATSimNavData3DAnimationView"],function(b){var a=b.extend({init:function(e,c,d,f){this._isVirtual=true;this._parent(e,c,d,function(g){g.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYUI",ext:"CATSimNavData3DVirtualComponentUI",type:"data",obj:null}};if(f){f(g)}})}});return UWA.namespace("DS/SPY/CATSimNavData3DVirtualComponent",a)});define("DS/SPY/CATSimNavData3DExtrema",["DS/SPY/CATSimNavDataSpec","DS/Visualization/ThreeJS_DS"],function(c,b){var a=c.extend({init:function(e,d,f){this._parent(e,d);this.impl={};this.readFromXML(e,f)},getExtremaType:function(){return this._extremaType},getExtremaValue:function(){return this._extremaValue},getPosition:function(){return this._position},getNormalVector:function(){return this._normalVector},getComponent:function(){return this._component},setComponent:function(d){this._component=d},readFromXML:function(d,e){this._extremaType=d.getAttribute("label");this._position=new b.Vector3(parseFloat(d.getAttribute("PosX")),parseFloat(d.getAttribute("PosY")),parseFloat(d.getAttribute("PosZ")));this._normalVector=new b.Vector3(0,0,0);this._extremaValue=d.getAttribute("value");e(this)}});return UWA.namespace("DS/SPY/CATSimNavData3DExtrema",a)});define("DS/SPY/CATSimNavDataDisplay",["UWA/Core","DS/SPY/CATSimNavDataDisplayAbstract","DS/SPY/CATSimNavDataHelper"],function(e,b,a){var c={};var d=b.extend({init:function(h,i,g,j,f){this._parent(h,i,g);this.readFromXML(h,j,f)},readFromXML:function(m,k,l){if(m.nodeName==="DataDisplay"){this.id=m.getAttribute("id");this.name=m.getAttribute("name");var n=a.parseGroupIds(this.name);if(n.length>1){this.name=n[0];this.subName=n[1]}this.type=m.getAttribute("type");this.plotType=m.getAttribute("plotType");this.category=m.getAttribute("category");this.thumbnail=m.getAttribute("thumbnail");this.isShared=("Shared"===this.type);var v={DDElement2D:{itemList:this.list2DViews},DDElement3D:{itemList:this.list3DViews},DDElementFrame:{itemList:this.listFrameViews}};var s=function(B){var i=false;if(l&&l.excludedTypes){i=(l.excludedTypes.indexOf(B)>=0)}return i};var o=function(B,D){var i=false;if(l&&l.types){var C=l.types[B];i=(C&&!isNaN(C.maxNb)&&D.nbInst>C.maxNb)}return i};var t={counter:0,loopCompleted:false};var u=this;var f=function(){t.counter--;if(t.counter===0&&t.loopCompleted&&k){k(u)}};var A=function(D,C,B,E){var i=new C(D,B,l,f);E.push(i)};var r=function(B,i,C){return function(E){var D=new E(B,i,l,f);C.push(D)}};var w=function(){for(var B=0;B<m.children.length;B++){var D=m.children[B];var F=v[D.nodeName];if(F){var C=(D.nodeName==="DDElementFrame")?"CATSimNavDataFrameView":D.getAttribute("type");var E=c[C];if(E){if(!o(C,E)){t.counter++;E.nbInst++;if(E.status==="loaded"){A(D,E.typeClass,u,F.itemList)}else{if(E.status==="requested"&&E.queue){E.queue.push((r)(D,u,F.itemList))}}}}}}t.loopCompleted=true;if(t.counter===0&&k){k(u)}};var j={counter:0,loopCompleted:false};var p=function(){j.counter--;if(j.counter===0&&j.loopCompleted){w()}};var z=function(i){return function(C){var B=c[i];if(B){B.status="loaded";B.typeClass=C;while(B.queue.length>0){if(B.queue[0]){B.queue[0](C);B.queue.shift()}}}p()}};for(var y=0;y<m.children.length;y++){var x=m.children[y];var g=v[x.nodeName];if(g){var h=(x.nodeName==="DDElementFrame")?"CATSimNavDataFrameView":x.getAttribute("type");var q=c[h];if(!q&&!s(h)){j.counter++;c[h]={status:"requested",queue:[],nbInst:0};require(["DS/SPY/"+h],(z)(h))}}}j.loopCompleted=true;if(j.counter===0){w()}}},getMultiInstanciatedFiles:function(){var g=[];var j=[];var i=[];var f=this.getNavData3DViewList(true);f.forEach(function(l){if(l&&l.getCGRList){j=j.concat(l.getCGRList().cgrs)}});var h=j.sort();for(var k=0;k<h.length-1;k++){if(h[k+1]===h[k]){i.push(h[k])}}g=i.reduce(function(l,n){const m=l.length;if(m===0||l[m-1]!==n){l.push(n)}return l},[]);return g},getCameraRoot:function(){var f;var h=this.getNavData3DViewList();if(h&&h.length){for(var g=0;g<h.length&&!f;g++){var j=h[g];if(j.type==="CATSimNavData3DCamerasRoot"){f=j}}}return f}});return e.namespace("DS/SPY/CATSimNavDataDisplay",d)});(function(a){if(a&&a.prototype){if(a.prototype.children===null||a.prototype.children===undefined){Object.defineProperty(a.prototype,"children",{get:function(){if(undefined===this._SPYchildren){var c=0,d,b=this.childNodes;this._SPYchildren=[];d=b[0];while(d){if(d.nodeType===1){this._SPYchildren.push(d)}d=b[c++]}}return this._SPYchildren}})}if(a.prototype.getAttributeNames===null||a.prototype.getAttributeNames===undefined){a.prototype.getAttributeNames=function(){var c=this.attributes;var e=c.length;var b=new Array(e);for(var d=0;d<e;d++){b[d]=c[d].name}return b}}}})(window.Node||window.Element);define("DS/SPY/CATSimNavDataLWFactory",["UWA/Core","DS/SPY/CATSimNavDataAbstractFactory","DS/CoreEvents/Events","DS/ZipJS/zip-fs","DS/SPY/CATSimNavDataList","DS/SPY/CATSimNavDataDisplay"],function(g,f,c,a,b,d){var e=f.extend({init:function(){this._parent()},createSequence:function(l,k){if(k&&l){var i=new a.fs.FS();a.workerScriptsPath="scripts/ThreeDS/Visualization/zip-js/";var j=function(){var m="SimNavData.xml";var n=i.find(m);if(n){n.getText(function(q){if(q&&q.target&&q.target.result&&typeof q.target.result==="string"&&q.target.result.length>0&&q.target.result.search("<")>=0){var s=new DOMParser();var r=s.parseFromString(q.target.result,"text/xml");var o=r.firstChild;var p={idx:0,name:"sequence",listDD:[],listDDShared:[],zip:i};p.idx=k.sequences.push(p)-1;this.parseXML(o,p,k,function(t,u){c.publish({event:k.getContext()+"/SPY/SEQUENCE/CREATED",data:{spm:k,seqIdx:p.idx,filteredDDNb:u}})},function(t){k.sequences.pop();c.publish({event:k.getContext()+"/SPY/SEQUENCE/ERROR",data:{spm:k,seqIdx:p.idx,errorCode:t}})})}else{c.publish({event:k.getContext()+"/SPY/SEQUENCE/ERROR",data:{spm:k}})}}.bind(this))}}.bind(this);var h=function(){alert("failed to open zip")};if(l.provider==="BLOB"){i.importBlob(l.blob,j,h)}else{i.importHttpContent(l,false,j,h)}}},parseXML:function(x,v,r,l,m,q){if(x.nodeName==="SimDDTree"){var s=0;var z=false;var u=false;var p="INVALIDDATA";r.simulationName=x.getAttribute("name");r.disclaimer=x.getAttribute("disclaimer");r.logo=x.getAttribute("logo");var w=0;var n=function(){var i=v.listDD.length-1;while(i>=0){if(v.listDD[i].isEmpty()){v.listDD.splice(i,1);w++}i--}};var h=function(){s--;if(s===0&&z){n();if(v.listDD.length>0){l(r,w)}else{m("FILTEREDCONTENT")}}};for(var A=0;A<x.childNodes.length;A++){var D=x.childNodes[A];if(D.nodeName!=="Scenario"){continue}r.dataLevel=parseInt(D.getAttribute("level"));if(r.level<r.dataLevel){continue}v.name=D.getAttribute("name");for(var y=0;y<D.children.length;y++){var B=D.children[y];if(B.nodeName==="List"){var C=new b(B);r.addDataList(C,v.idx)}else{if(B.nodeName==="DataDisplay"){var k=false;var t=D.children[y].getAttribute("type")==="Shared";if(q&&Array.isArray(q.categories)){k=q.categories.indexOf(D.children[y].getAttribute("category"))<0}if(t||!k){s++;u=true;var o=new d(D.children[y],r,v.idx,h,q);if(t){v.listDDShared.push(o)}else{v.listDD.push(o)}}}}}}z=true;if(!u){m(p)}else{if(s===0){n();if(v.listDD.length>0){l(r,w)}else{m("FILTEREDCONTENT")}}}}else{m()}}});return g.namespace("DS/SPY/CATSimNavDataLWFactory",e)});define("DS/SPY/CATSimNavDataLWLimitedFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(c,b){var a=b.extend({init:function(){this._parent()},parseXML:function(h,f,g,i,e){var d={categories:["Result"],excludedTypes:["CATSimNavDataFrameView"],types:{CATSimNavData3DCamerasRoot:{maxChildrenNb:1,disableTracking:true}}};this._parent(h,f,g,i,e,d)}});return c.namespace("DS/SPY/CATSimNavDataLWLimitedFactory",a)});define("DS/SPY/CATSimNavDataLWSensorsFactory",["UWA/Core","DS/SPY/CATSimNavDataLWFactory"],function(c,b){var a=b.extend({init:function(){this._parent()},parseXML:function(h,f,g,i,e){var d={categories:["Result"],info:true,types:["CATSimNavData3DAnimationView","CATSimNavData3DCamerasRoot","CATSimNavData2DLegend"]};this._parent(h,f,g,i,e,d)}});return c.namespace("DS/SPY/CATSimNavDataLWSensorsFactory",a)});define("DS/SPY/CATSimNavData3DExtremas",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtrema"],function(a,c){var b=a.extend({init:function(e,d,f){this._parent(e,d);this.impl={};this._extremaList=[];this._extremaFrameIndex=e._extremaFrameIndex;this.readFromXML(e,f)},getFrameIndex:function(){return this._extremaFrameIndex},addExtrema:function(d){if(d){this._extremaList.push(d)}},getListExtrema:function(){return this._extremaList},readFromXML:function(g,l){var e=0;var d=false;var k=function(i){if(i){this.addExtrema(i);e--;if(e===0&&d&&l){l(this)}}}.bind(this);for(var f=0;f<g.children.length;f++){var j=g.children[f];if(j.nodeName!=="Extrema"){continue}e++;var h=new c(j,this.dd,k)}d=true;if(e===0){l(this)}}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremas",b)});define("DS/SPY/CATSimNavDataXYCurve",["UWA/Core","DS/SPY/CATSimNavDataXYValue","DS/SPY/CATSimNavDataHelper"],function(d,b,c){var a=d.Class.extend({init:function(e,f,h,g){this.listValues=[];this.listGroups=[];this.hasPositions=true;this.curveStyle={};this.readFromXML(e,f,h,g)},getMetadata:function(){var e={name:this.name,rootName:this.rootName,loadCaseName:this.loadCaseName,nameX:this.nameX,nameY:this.nameY,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,hasPositions:this.hasPositions,isBijective:this.isBijective,isFilled:this.isFilled,isStacked:this.isStacked};return e},getCurveStyle:function(){return this.curveStyle},getAssignedAxisX:function(){return this.assignedAxisX},setAssignedAxisX:function(e){this.assignedAxisX=e},getAssignedAxisY:function(){return this.assignedAxisY},setAssignedAxisY:function(e){this.assignedAxisY=e},getGroups:function(){return this.listGroups},getValues:function(){return this.listValues},addValue:function(e){if(e&&this.listValues){this.listValues.push(e);this.hasPositions=this.hasPositions&&!isNaN(e.getPosition())}},stack:function(f){if(this.isStacked&&f.isStacked){for(var e=0;e<this.listValues.length;e++){this.listValues[e].setY(this.listValues[e].getY()+f.listValues[e].getY())}}},ratio:function(g){if(this.isStacked&&g.isStacked){for(var f=0;f<this.listValues.length;f++){var e=g.listValues[f].getY();if(e!==0){this.listValues[f].setY(100*this.listValues[f].getY()/e)}else{this.listValues[f].setY(0)}}}},setTo100:function(){if(this.isStacked){for(var f=0;f<this.listValues.length;f++){var e=this.listValues[f].getY();if(e!==0){this.listValues[f].setY(100)}}}},readFromXML:function(q,w,k,r){if(r){this.rootName=r.rootName;this.loadCaseName=r.loadName}if(q){this.name=q.getAttribute("name");this.nameX=q.getAttribute("nameX");this.nameY=q.getAttribute("nameY");this.assignedAxisX=parseInt(q.getAttribute("axisX"));this.assignedAxisY=parseInt(q.getAttribute("axisY"));this.curveStyle.color=q.getAttribute("color");this.curveStyle.lineStyle=q.getAttribute("lineStyle");this.curveStyle.lineWidth=q.getAttribute("lineWidth");this.curveStyle.markerSize=parseInt(q.getAttribute("markerSize"));this.curveStyle.markerSize=!isNaN(this.curveStyle.markerSize)&&this.curveStyle.markerSize>3?3:this.curveStyle.markerSize;this.curveStyle.markerColor=q.getAttribute("markerColor");this.curveStyle.markerPeriod=parseInt(q.getAttribute("markerPeriod"));this.curveStyle.markerPeriod=!isNaN(this.curveStyle.markerPeriod)&&this.curveStyle.markerPeriod>=1?this.curveStyle.markerPeriod:1;if(this.curveStyle.lineWidth){this.curveStyle.lineWidth+="px"}this.isFilled=q.getAttribute("filled")==="true";this.isStacked=q.getAttribute("stacked")==="true";this.isBarChart=false;var G=q.getAttribute("valuesX");var E=q.getAttribute("valuesY");if(G&&E){var A=G.split(" ");var y=E.split(" ");if(A&&A[A.length-1]===""){A.pop()}if(y&&y[y.length-1]===""){y.pop()}if(A.length===y.length){var z={x:0,y:0};var D=function(i){i.setX(z.x);i.setY(z.y);this.addValue(i)}.bind(this);for(var s=0;s<A.length;s++){z.x=Number(A[s]);z.y=Number(y[s]);var C=new b(q,D);C.setIndex(s)}}}if(!G&&!E&&q.hasChildNodes()){this.isBarChart=true;var n=function(i){this.addValue(i)}.bind(this);var l;var t;var o=0;var J;var h;this.isBijective=true;var e=w&&w.modelMgr.getDataList?w.modelMgr.getDataList("grp",w.sequence):undefined;for(var B=0;B<q.children.length;B++){var u=q.children[B];if(u.nodeName==="Value"){var F=true;o++;var p;var m;var I=u.getAttribute("frmId");if(I&&w&&w.modelMgr.getFrameDetails){p=w.modelMgr.getFrameDetails(I,w.sequence);m=p.group}else{var j=u.getAttribute("grpId");if(j&&e){m=e.getEntry(parseInt(j)-1).val;p={group:m}}else{m=u.getAttribute("group")}}var g=m?c.parseGroupIds(m):[];t=g[0];if(r){F=(t===r.rootName&&g[1]===r.loadName)}if(F){if(m){if(l&&l===m){if(this.isBarChart){this.isBarChart=false}}else{this.listGroups.push(m);this.isCrossGroup=this.listGroups.length>1}l=m}else{this.isBarChart=false}var f=new b(u,n,p);if(isNaN(f.getX())){f.setX(o)}f.setIndex(B);if(this.isBijective){var x=f.getX();if(!isNaN(J)){var H=x-J;if(!isNaN(h)){this.isBijective=(H*h>0)}h=H}J=x}}}}}}if(this.listGroups.length===1&&this.rootName===undefined){this.rootName=c.parseGroupIds(this.listGroups[0])[0]}if(k){k(this)}}});return d.namespace("DS/SPY/CATSimNavDataXYCurve",a)});define("DS/SPY/CATSimNavDataFrameViewXYChart",["UWA/Core","DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataXYCurve","DS/SPY/CATSimNavDataChartAxis","DS/SPY/CATSimNavDataHelper"],function(h,b,d,g,f){var a=-1;var e=-2;var c=b.extend({init:function(k,i,j,l){if(i){i.registerChart()}this._parent(k,i);this.impl={CATISimNavDataSpecUI:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null},CATISimNavDataAnimation:{module:"SPYExtUI",ext:"CATSimNavDataFrameViewXYChartUI",type:"data",obj:null}};this.listCurves=[];this.axis={x:[],y:[]};this._idForAxis=1;this.listCurvesGroupNames=[];this.readFromXML(k,l,i)},getMetadata:function(){var i={name:this.name,distribution:this.distribution,animation:this.animation,isBarChart:this.isBarChart,isCrossGroup:this.isCrossGroup,oneCurvePerGroup:this.oneCurvePerGroup,numberOfDisctinctGroups:this.numberOfDistinctGroups,hasPositions:this.hasPositions};return i},getCurves:function(){this.computePositions();return this.listCurves},addCurve:function(i){if(i&&this.listCurves&&i.getValues().length>0){this.listCurves.push(i);var j=i.getMetadata();this.isCrossGroup=j.isCrossGroup;this.listCurvesGroupNames.push(j.rootName+" "+j.loadCaseName);var k=this.listCurvesGroupNames.reduce(function(o,n){if(o.indexOf(n)<0){o.push(n)}return o},[]);this.oneCurvePerGroup=k.length===this.listCurves.length;this.numberOfDistinctGroups=k.length;var m=i.getAssignedAxisX();var l=i.getAssignedAxisY();if(isNaN(m)){this._defaultXaxisNeeded=true;i.setAssignedAxisX(a)}if(isNaN(l)){this._defaultYaxisNeeded=true;i.setAssignedAxisY(e)}}},getAxisList:function(i){return this.axis[i]},getAxis:function(k){var i=function(l){return l.getId()===k};var j=this.axis.x.find(i);if(!j){j=this.axis.y.find(i)}return j},addAxis:function(i){if(i){if(i.getDimension()===2){this.axis.y.push(i)}else{this.axis.x.push(i)}if(isNaN(i.getId())){i.setId(this._idForAxis);this._idForAxis++}}},readFromXML:function(z,q,A){if(z){this.name=z.getAttribute("name");this.distribution=z.getAttribute("Distribution");this.animation=z.getAttribute("Animation");this.nameX=z.getAttribute("nameX");this.nameY=z.getAttribute("nameY");this.unitX=z.getAttribute("unitX");this.unitY=z.getAttribute("unitY");this.isBarChart=true;var k=function(){this.hasPositions=true;for(var ad=0;ad<this.listCurves.length&&this.hasPositions;ad++){var Y=this.listCurves[ad];if(Y){var P=Y.getMetadata();this.hasPositions=P&&P.hasPositions}}if(A){A.hasLockableCurves=this.isCrossGroup}if(this._defaultXaxisNeeded){var p=new g();p.setId(a);this.addAxis(p);var U=this.listCurves.filter(function(ag){return(ag.getAssignedAxisX()===a&&ag.nameX)});var i=U.length>0?U[0].nameX:undefined;var O=U.filter(function(ag){return(ag.nameX===i)});var N=O.length===U.length&&i?i:this.nameX;p.setName(N);p.setUnit(this.unitX?this.unitX:"")}if(this._defaultYaxisNeeded){var aa=new g();aa.setId(e);aa.setDimension(2);this.addAxis(aa);var T=this.listCurves.filter(function(ag){return(ag.getAssignedAxisY()===e&&ag.nameY)});var Z=T.length>0?T[0].nameY:undefined;var v=T.filter(function(ag){return(ag.nameY===Z)});var af=v.length===T.length&&Z?Z:this.nameY;aa.setName(af);aa.setUnit(this.unitY?this.unitY:"")}var ab=this.listCurves.filter(function(ag){return ag.isStacked});var R=ab[ab.length-1];for(var V=ab.length-2;V>=0;V--){ab[V].stack(R);R=ab[V]}var S=this.getAxisList("y").filter(function(ag){return ag.getScale()==="percentage"});if(S&&S.length>0){var ac=S[0].getId();var X=ab.filter(function(ag){return ag.getAssignedAxisY()===ac});var ae=X[0];for(var W=1;W<X.length;W++){X[W].ratio(ae)}ae.setTo100()}if(q){var Q=this.listCurves&&this.listCurves.length>0?this:undefined;q(Q)}}.bind(this);var u=true;var L={counter:0,loopCompleted:false};var s=function(){L.counter--;if(L.counter===0&&L.loopCompleted){k()}};for(var K=0;K<z.children.length;K++){var J=z.children[K];if(J.nodeName==="Curve"){u=false;L.counter++;var y=new d(J,{modelMgr:A.spm,sequence:A.seq},function(i){if(!i.isBarChart){this.isBarChart=false}this.addCurve(i);s()}.bind(this))}else{if(J.nodeName==="ChartAxis"){L.counter++;var E=new g(J,s);this.addAxis(E)}}}L.loopCompleted=true;if(!u){this._positionsComputed=true;if(L.counter===0){k()}}else{this._defaultXaxisNeeded=true;this._defaultYaxisNeeded=true;this.isBarChart=false;var r=[];var F="";var m="";var j=A.spm.getDataList("grp",A.seq);for(var B=0;B<z.children.length;B++){var t=z.children[B];if(t.nodeName==="Value"){var x;var M=t.getAttribute("frmId");if(M){var w=A.spm.getFrameDetails(M,A.seq);x=w.group}else{var n=t.getAttribute("grpId");if(n&&j){x=j.getEntry(parseInt(n)-1).val}else{x=t.getAttribute("group")}}if(x){var C=f.parseGroupIds(x);var G=C[0];var l=C[1];if(G!==F||l!==m){r.push({rootName:G,loadName:l});F=G;m=l}}else{r=[];break}}}if(r.length===0){var I=new d(z,{modelMgr:A.spm,sequence:A.seq},function(i){this.addCurve(i);k()}.bind(this))}else{L.counter=0;L.loopCompleted=false;for(var H=0;H<r.length;H++){var o=r[H];L.counter++;var D=new d(z,{modelMgr:A.spm,sequence:A.seq},function(i){this.addCurve(i);s()}.bind(this),o)}L.loopCompleted=true;if(L.counter===0){k()}}}}},computePositions:function(){if(!this._positionsComputed&&this.dd&&this.dd.animationStructure&&this.dd.animationStructure.groupList.length>0){for(var n=0;n<this.listCurves.length;n++){var j=this.listCurves[n];if(j){var k=[];for(var l=0;l<this.dd.animationStructure.groupList.length;l++){var r=this.dd.animationStructure.groupList[l];if(r&&r.rootName===j.rootName&&r.loadCaseName===j.loadCaseName){var s=r.frameList;if(s){for(var m=0;m<s.length;m++){var i=s[m];if(i&&!i.isScaledPosition&&!isNaN(i.position)){k.push(i.position)}}}}}if(k.length>0){var q=j.getValues();if(k.length===q.length){for(var p=0;p<q.length;p++){var o=q[p];if(o){o.position=k[p]}}}}}}this._positionsComputed=true}}});return h.namespace("DS/SPY/CATSimNavDataFrameViewXYChart",c)});define("DS/SPY/CATSimNavData3DExtremasSet",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremas","DS/SPY/CATSimNavDataLink"],function(c,a,d){var b=c.extend({init:function(f,e,g){this._parent(f,e);this.impl={};this._extremasList=[];this.readFromXML(f,g)},addExtremas:function(e){if(e){this._extremasList.push(e)}},getExtremas:function(g){var e;for(var f=0;f<this._extremasList.length&&!e;f++){if(this._extremasList[f].getFrameIndex()===g){e=this._extremasList[f]}}return e},readFromXML:function(f,o){var n=function(){var q=0;var u=0;var p=false;var j=function(i){this.addExtremas(i);q--;if(q===0&&p){o(this)}}.bind(this);for(var r=0;r<f.children.length;r++){var t=f.children[r];if(t.nodeName!=="Extremas"){continue}t._extremaFrameIndex=u;u++;q++;var s=new a(t,this.dd,j)}p=true;if(q===0){o(this)}}.bind(this);var l=null;for(var k=0;k<f.children.length;k++){var h=f.children[k];if(h.nodeName!=="LinkSet"||h.getAttribute("role")!=="ExtremasToPart"){continue}for(var g=0;g<h.children.length&&l===null;g++){var m=h.children[g];if(m.nodeName!=="InternalRef"){continue}l=m}}if(l){var e=new d(l,this.dd,function(i){this.addLink("ExtremasToPart",i);n()}.bind(this))}else{n()}}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasSet",b)});define("DS/SPY/CATSimNavData3DExtremasRoot",["DS/SPY/CATSimNavDataSpec","DS/SPY/CATSimNavData3DExtremasSet"],function(c,a){var b=c.extend({init:function(f,d,e,g){this._parent(f,d);this.impl={};this._extremasSetList=[];this.readFromXML(f,g)},addExtremasSet:function(d){if(d){this._extremasSetList.push(d)}},getListExtremasSet:function(){return this._extremasSetList},readFromXML:function(j,l){var f=0;var d=false;var h=function(i){if(i){this.addExtremasSet(i);f--;if(f===0&&d&&l){l()}}}.bind(this);for(var g=0;g<j.children.length;g++){var k=j.children[g];if(k.nodeName!=="ExtremasSet"){continue}f++;var e=new a(k,this.dd,h)}d=true;if(f===0){l()}}});return UWA.namespace("DS/SPY/CATSimNavData3DExtremasRoot",b)});define("DS/SPY/CATSimNavDataFrameViewCompValue",["DS/SPY/CATSimNavDataFrameViewComp","DS/SPY/CATSimNavDataLink"],function(a,c){var b=a.extend({init:function(f,d,e,g){this._parent(f,d);this.impl={CATISimNavDataSpecUI:{module:"SPYUI",ext:"CATSimNavDataFrameViewCompValueUI",type:"data",obj:null}};this.readFromXML(f,g)},getValues:function(){var d={name:this.name,type:this.type,value:this.value,unit:this.unit};return d},readFromXML:function(e,n){if(e){this.value=e.getAttribute("value");this.unit=e.getAttribute("unit");if(e.children.length>0){var k=this;var l=null;for(var h=0;h<e.children.length&&l===null;h++){var g=e.children[h];if(g.nodeName!=="LinkSet"||g.getAttribute("role")!=="Frameto3D"){continue}for(var f=0;f<g.children.length&&l===null;f++){var m=g.children[f];if(m.nodeName!=="InternalRef"){continue}l=m}}if(l){var d=new c(l,this.dd,function(i){k.addLink("Frameto3D",i);n(k)})}}else{n(this)}}}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewCompValue",b)});define("DS/SPY/CATSimNavDataFrameViewText",["DS/SPY/CATSimNavDataFrameViewCompValue"],function(a){var b=a.extend({init:function(e,c,d,f){this._parent(e,c,d,f);this.impl.CATISimNavDataSpecUI={module:"SPYUI",ext:"CATSimNavDataFrameViewTextUI",type:"data",obj:null}},getValues:function(){var c={name:this.name,value:this.value};return c}});return UWA.namespace("DS/SPY/CATSimNavDataFrameViewText",b)});