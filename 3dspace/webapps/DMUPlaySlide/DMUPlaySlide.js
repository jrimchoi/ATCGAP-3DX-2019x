define("DS/DMUPlaySlide/DMUSlideImport",["UWA/Class","DS/DMUBaseExperience/EXPUtils"],function(a,b){return a.extend({init:function(d){var c=this;this.importData=function(f,e){if(f&&e&&d){e.fillObjectAttributes(d,f);c._environmentOverload=f.EnvironmentOverload||{};c._objectOverloads=f.ObjectOverloads||[];e.registerForPostImport(d)}};this.afterImport=function(){if(d){if(c._environmentOverload){d.setEnvironmentOverload({target:d.getParent().getEnvironment(),state:c.readState(d.getParent().getEnvironment(),c._environmentOverload.state)})}if(c._objectOverloads){c._objectOverloads.forEach(function(f){var e=d.getParent().getChildWithID(f.targetId);if(e){d.addObjectOverload({target:e,state:c.readState(e,f.state)})}})}}};this.readState=function(m,e){if(m&&m._parameters&&e){var f={};var j=m._parameters.length;for(var l=0;l<j;l++){var k=m._parameters[l];if(k.isAstate!==false&&k.isOverloadable!==undefined&&k.JSONname){var g=e;var n=k.JSONname.split(".");while(true){if(0===n.length){f[k.name]=b.strToType(g,k.type)}var h=n.shift();g=g[h];if(g===undefined){break}}}}return f}}}})});define("DS/DMUPlaySlide/DMUThumbnailUpdater",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization"],function(b,e,d,a){var c=b.extend({init:function(n,k){var h=new e.Clock(),l=true,m,g;var j=200,i=this;if(n){g=n.getViewer().onSwapVisibleSpace(function(){if(n&&n.getViewer().getVisibleSpace()!==0){i.updateActiveSlideThumbnail()}})}this.clean=function(){if(n&&g){n.getViewer().unsubscribe(g)}if(m){clearTimeout(m)}h=null};this.enable=function(){l=true};this.disable=function(){l=false};function f(p){var o=d.getReviewContext({viewer:n.getViewer()})?d.getReviewContext({viewer:n.getViewer()}).getCurrentReview():null;if(o&&(!o.isReadOnly()||!o.isImporting())){l=false;a.computeImage(n.getViewer(),144,108,{onSuccess:function(q){if(p&&p.GetType&&p.GetType()==="DMUSlide"){p.setImage(q);k.updateSlide(p,{img:q.src})}else{o.setImage(q);k.updateSlide(null,{img:q.src})}l=true},onFailure:function(){l=true}})}}this.updateActiveSlideThumbnail=function(q){if(l&&n.getViewer().getVisibleSpace()!==0){var p=function(){if(!h){return}h.stop();m=0;if(l&&n.getViewer().getVisibleSpace()!==0){var r=d.getReviewContext({viewer:n.getViewer()})?d.getReviewContext({viewer:n.getViewer()}).getCurrentReview():null;if(r){f(r.getCurrentSlide())}}};if(!q||(q&&!q.force)){if(!m){h.start();m=setTimeout(p,j)}else{var o=h.getDelta();if(o<j){clearTimeout(m);m=setTimeout(p,j)}}}else{p()}}}}});return c});define("DS/DMUPlaySlide/DMUTransitionSlide",["UWA/Class","DS/Animation/PropertyAnimation","DS/Animation/AnimationPath","DS/DMUBaseExperience/EXPUtils"],function(b,a,c,d){return b.extend({init:function(n,e,j){var k=n,g=e;var f={P1:[],P2:[]},h;function l(t,s){if(!s){return}var v,q=0,p=null,u=null;if(s.target){var r=s.target.GetType()==="DMUOccurrenceOverloader";if(s.beginState===null||s.beginState===undefined){s.beginState={}}if(s.endState===null||s.endState===undefined){s.endState={}}if(s.beginState.bVisible!==undefined){p=s.beginState.bVisible}else{if(r){p=s.target.getNominalAttribute("bVisible");p=p===null||p===undefined?true:p}if(p===undefined||p===null){p=false}}if(s.endState.bVisible!==undefined){u=s.endState.bVisible}else{if(r){u=s.target.getNominalAttribute("bVisible");u=u===null||u===undefined?true:u}if(u===undefined||u===null){u=false}}if(p===false&&u===true){for(q=0;q<s.target._parameters.length;q++){v=s.target._parameters[q];if(v.isOverloadable){if(s.endState[v.name]!==undefined){if(v.name==="bVisible"){if(!r){if(s.beginState[v.name]===undefined){s.beginState[v.name]=false}if(s.endState[v.name]===undefined){s.endState[v.name]=true}}}else{s.beginState[v.name]=s.endState[v.name]}}}}}if(p===true&&u===false){for(q=0;q<s.target._parameters.length;q++){v=s.target._parameters[q];if(v.isOverloadable){if(s.beginState[v.name]!==undefined){if(v.name==="bVisible"){if(!r){if(s.beginState[v.name]===undefined){s.beginState[v.name]=true}if(s.endState[v.name]===undefined){s.endState[v.name]=false}}}else{s.endState[v.name]=s.beginState[v.name]}}}}}if(p===false&&u===false&&!r){if(s.beginState.bVisible===undefined){s.beginState.bVisible=false}if(s.endState.bVisible===undefined){s.endState.bVisible=false}}for(q=0;q<s.target._parameters.length;q++){v=s.target._parameters[q];if(v.isOverloadable){if(s.beginState[v.name]===undefined&&s.endState[v.name]!==undefined){s.beginState[v.name]=s.target.getNominalAttribute(v.name)}else{if(s.endState[v.name]===undefined&&s.beginState[v.name]!==undefined){s.endState[v.name]=s.target.getNominalAttribute(v.name)}}}}}if(t!=="DMUSection"){f.P1.push(s)}else{f.P2.push(s)}}function i(){var p;if(k&&k.getObjectOverloads){k.getObjectOverloads().forEach(function(q){if(q&&q.target&&q.state){var r=null;if(g){var s=g.getOverloadForTarget(q.target);if(s&&s.state){r=s.state}else{if(s===null){if(q.target.GetType()!=="DMUOccurrenceOverloader"){r={bVisible:false}}}}}if(r===null){r=q.target.getNominalState()}l(q.target.GetType(),{target:q.target,state:null,beginState:o(q.state,q.target),endState:r})}});if(g===null){p=k.getParent();if(p){p.getChildren().forEach(function(s){var q=s.GetType();if(q!=="DMUSlide"&&q!=="DMUEnvironment"&&q!=="DMUOccurrenceOverloader"&&q!=="DMULinksManager"){var r=k.getOverloadForTarget(s);if(r===null){l(q,{target:s,state:null,beginState:{bVisible:false},endState:s.getNominalState()})}}})}}}if(g&&g.getObjectOverloads){g.getObjectOverloads().forEach(function(r){if(r&&r.target&&r.state){var s=1;if(k){var q=k.getOverloadForTarget(r.target);if(q&&q.state){s=0}}if(s){l(r.target.GetType(),{target:r.target,state:null,beginState:r.target.getState(),endState:o(r.state,r.target)})}}});if(k===null){p=g.getParent();if(p){p.getChildren().forEach(function(s){var q=s.GetType();if(q!=="DMUSlide"&&q!=="DMUEnvironment"&&q!=="DMUOccurrenceOverloader"&&q!=="DMULinksManager"){var r=g.getOverloadForTarget(s);if(r===null){l(q,{target:s,state:null,beginState:s.getState(),endState:{bVisible:false}})}}})}}}}function m(p){if(f.P1){f.P1.forEach(function(q){if(q&&q.target){q.state=q.target.getStateForAnimation(q.beginState,q.endState,p);q.target.refreshNode()}})}if(f.P2){f.P2.forEach(function(q){if(q&&q.target){q.state=q.target.getStateForAnimation(q.beginState,q.endState,p);q.target.refreshNode()}})}}function o(s,q){var r={};if(q&&s){var t;for(var p=0;p<q._parameters.length;p++){t=q._parameters[p];if(s[t.name]!==undefined){r[t.name]=d.cloneType(s[t.name],t.type)}}}return r}this.animate=function(p,r){var q=new c();q.setStartValue(0);q.setEndValue(1);q.setDuration(p);var s=function(t){m(t);if(t===1){r()}if(j){j.render()}};if(p===0){s(1)}else{h=new a({onNewFrame:s},"onNewFrame",q);h.start()}};this.getOverloadForTarget=function(p){var q=null;f.P1.forEach(function(r){if(r.target===p){q=r}});f.P2.forEach(function(r){if(r.target===p){q=r}});return q};i()}})});define("DS/DMUPlaySlide/DMUSlideServices",["UWA/Class","DS/DMUBaseExperience/DMUContextManager","DS/ApplicationFrame/CommandsManager","DS/DMUPlaySlide/DMUTransitionSlide"],function(a,e,c,b){var d=[];var f=a.singleton({init:function(){},getSlidePreferences:function(h){if(h&&h.context){for(var g=0;g<d.length;g++){if(d[g].context===h.context){return d[g].preferences}}}return undefined},setSlidePreferences:function(k){if(k&&k.context&&k.preferences){var g=true;for(var h=0;h<d.length;h++){if(d[h].context===k.context){var j=Object.keys(k.preferences);for(var i=0;i<j.length;i++){d[h].preferences[j[i]]=k.preferences[j[i]]}g=false}}if(g){d.push({context:k.context,preferences:k.preferences})}}},removeSlidePreferences:function(h){if(h&&h.context){for(var g=0;g<d.length;g++){if(d[g].context===h.context){d.splice(g,1);break}}}},setActiveSlide:function(n){if(!n||!n.context){return}var i=n.opts&&n.opts.duration&&!isNaN(n.opts.duration)?n.opts.duration:200;var g=e.getReviewContext({context:n.context});var o=g?g.getCurrentReview():null;if(o){var l=o.getCurrentSlide();if(n.onBeforeApplySlide){n.onBeforeApplySlide({previousSlide:l,nextSlide:n.slide})}if(!n.context.getViewer().getVisibleSpace()){var k=c.getCommand("VisuVisibleSpace",n.context.getCommandContext());if(k){k.begin()}}o.setCurrentSlide(n.slide&&n.slide.GetType&&n.slide.GetType()==="DMUSlide"?n.slide:null);var j=o.getReviewEnvironment();if(j){j.refresh(i,true);j.applyCurrent2DSheet();j.applyLockUnlockSection()}var h=function(){o.setCurrentSlide(n.slide&&n.slide.GetType&&n.slide.GetType()==="DMUSlide"?n.slide:null);o.refreshNode({doNotRefresh:["DMUSlide"]});if(j){j.refresh(0,false)}if(n.onSlideActivated){n.onSlideActivated({slide:n.slide})}};if(i){var m=new b(l,n.slide,n.context.getViewer());o.setCurrentSlide(m);m.animate(i,h)}else{h()}}}});return f});define("DS/DMUPlaySlide/controllers/DMUSlidesController",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/WebappsUtils/WebappsUtils","DS/DMUControls/panels/DMUSlidesPanel","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization","DS/Selection/CSOManager","DS/DMUPlaySlide/DMUTransitionSlide","DS/ApplicationFrame/CommandsManager","DS/DMUPlaySlide/DMUSlideServices","DS/DMUPlaySlide/DMUThumbnailUpdater","DS/CATWebUXComponents/CATWebUXPanel","DS/CATWebUXComponents/CATWebUXInfoFlag","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,k,p,d,b,r,f,o,m,a,l,g,h,n,c){var q=k.extend({init:function(V){this._parent(V);var K=V||{};var w=this;var E=[];var v,R;var I;var N;var U=K.context;var L=false,F=false,O=true;var J;var P=d.getWebappsAssetUrl("DMUBaseCommands","icons/32/")+"I_WebSlide.png";var t=null;var M=false,x=true,Z;var Y=[];var u=null;var aa,B;var X=new g(U,this);var s=false;this.addSlide=function(ae){var ag=r.getReviewContext({viewer:U.getViewer()});var ad=ag?ag.getCurrentReview():null;if(!ag||!ae||!ad){return}z(ad);for(var af=0;af<E.length;af++){if(E[af].slide===ae){return}}G({slide:ae,img:ae.getImage()?ae.getImage().src:null,id:"slide"+ae.getAttribute("sID"),title:ae.getAttribute("sName"),isActiveSlide:!ad.isImporting(),category:ae._bInWork?"InWork":"Slides",isEditable:function(){return !ae.isReadOnly()},onSlideNameChanged:function(ah){ae.setAttribute("sName",ah.name)},callback:function(ah){if(ah==="delete"){if(ad.getCurrentSlide()===ae){w.setActiveSlide(null)}ae.remove();if(Z){Z.publish("onSlideRemoved",{slide:ae})}}else{if(ah==="click"){w.setActiveSlide(ae)}}}});if(Z){Z.publish("onSlideAdded",{slide:ae})}};this.updateSlide=function(ad,ae){if(!v){return}if(!ae||!ae.img){X.updateActiveSlideThumbnail()}if(ae){v.updateSlide(ad?"slide"+ad.getAttribute("sID"):"NominalSlide",ae)}};this.updateSlideEditableFlag=function(ad){if(!ad){return}for(var ae=0;ae<E.length;ae++){if(E[ae].slide===ad){E[ae].titleEditionAllowed=E[ae].isEditable()&&!L;v.updateSlide(E[ae].id,{titleEditionAllowed:E[ae].titleEditionAllowed});return}}};this.update=function(){if(!v||!E){return}X.updateActiveSlideThumbnail();for(var ad=0;ad<E.length;ad++){E[ad].titleEditionAllowed=E[ad].isEditable()&&!L;v.updateSlide(E[ad].id,{titleEditionAllowed:E[ad].titleEditionAllowed})}};this.clear=function(){if(v){v.cleanPanel();var ae=Object.keys(N);for(var ad=0;ad<ae.length;ad++){v.unsubscribe(N[ae[ad]])}N={}}if(R){R.setPanelVisibilityFlag(false);R.clean()}if(J){J.clean()}if(X){X.clean()}v=R=E=J=Z=aa=B=Y=u=null;X=s=null};this.setPlayMode=function(ad){L=ad;if(v){v.setSectionHeaderCommandsVisibleFlag(!L)}if(L){ab();if(F){F=false;if(v){v.setCheckBoxeActiveFlag(F)}}}if(E){for(var ae=0;ae<E.length;ae++){if(!L&&E[ae].isActiveSlide){W(E[ae])}if(v&&E[ae].id!=="NominalSlide"){E[ae].titleEditionAllowed=E[ae].isEditable()&&!L;v.updateSlide(E[ae].id,{titleEditionAllowed:E[ae].titleEditionAllowed})}}}};this.getPlayMode=function(){return L};this.setVisibleFlag=function(ae){O=ae;var ad=E&&E.length>1;if(ad){if(E.length===2&&!x&&E[1].category==="InWork"){ad=false}}if(R){R.setPanelVisibilityFlag(ad&&O)}if(O&&E&&E.length){for(var af=0;af<E.length;af++){if(E[af].isActiveSlide){W(E[af]);break}}}else{if(!O){ab()}}};this.getVisibleFlag=function(){return O};this.getActiveSlide=function(){return u};this.setPanelOptions=function(af){if(!af){return}var ad=false;if(typeof af.panelTitle==="string"){t=af.panelTitle;ad=true}if(typeof af.displayNominal==="boolean"){M=af.displayNominal;ad=true}if(typeof af.displayInWork==="boolean"){x=af.displayInWork;ad=true}if(typeof af.playMode==="boolean"){w.setPlayMode(af.playMode)}if(af.publisher){Z=af.publisher}if(af.beforeApplySlideCB){aa=af.beforeApplySlideCB}if(af.afterApplySlideCB){B=af.afterApplySlideCB}if(ad){if(v){var ag=[],ae=0;for(ae=0;ae<E.length;ae++){ag.push(E[ae])}this.clear();y();for(ae=0;ae<ag.length;ae++){w.addSlide(ag[ae])}}}};this.setActiveSlide=function(ad,ah){if(!U){return}if(!v){y()}var ai=u!==ad;if(ai){var ag,ae;for(var af=0;af<Y.length;af++){ag=Y[af].slide?Y[af].slide.getAttribute("sID"):null;ae=ad?ad.getAttribute("sID"):null;if(ag===ae){ai=false;break}}if(ai){Y.push({slide:ad,options:ah||{}})}}if(Y.length===1){C(Y[0].slide,Y[0].options)}};function y(){var ae=l.getSlidePreferences({context:U});if(ae){if(typeof ae.panelTitle==="string"){t=ae.panelTitle}if(typeof ae.displayNominal==="boolean"){M=ae.displayNominal}if(typeof ae.displayInWork==="boolean"){x=ae.displayInWork}if(typeof ae.playMode==="boolean"){L=ae.playMode}if(ae.publisher){Z=ae.publisher}if(ae.beforeApplySlideCB){aa=ae.beforeApplySlideCB}if(ae.afterApplySlideCB){B=ae.afterApplySlideCB}}if(!v){v=new b();N={};N.onPanelResizedCB=v.subscribe("onPanelResized",A);N.onSlideSelectedCB=v.subscribe("onSlideSelected",Q);N.onSlidesDeletedCB=v.subscribe("onSlidesDeleted",T);N.onSlideNameChangedCB=v.subscribe("onSlideNameChanged",ac);N.onCheckBoxesDisplayedCB=v.subscribe("onCheckBoxesDisplayed",S)}if(!R){var ah=v.buildPanel({panelTitle:t,displayNominal:M,displayInWork:x});v.setSectionHeaderCommandsVisibleFlag(!L);var ag,ad=302;var af=H();if(sessionStorage.getItem("DMUSlidesExpFlag_"+widget.id)==="true"){ag=parseFloat(sessionStorage.getItem("DMUSlidesWidth_"+widget.id))}if(!ag){ag=I!==undefined?I:af}ag=ag>=af?ag:af;var ai={id:"DMUSlidesPanel",className:"DMUSlidesPanel",title:c.slidePanelTitle,showTitleFlag:false,icon:P,immersiveFrame:U.getImmersiveFrame(),content:ah,minWidth:af,width:ag,widthStep:165,minHeight:ad,height:ad,heightStep:124,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,currentDockArea:WUXDockAreaEnum.LeftDockArea,onPanelResizedCB:function(aj){if(aj.currentDockArea===WUXDockAreaEnum.RightDockArea||aj.currentDockArea===WUXDockAreaEnum.LeftDockArea){I=aj.width;if(aj.widthModifiedInteractively){sessionStorage.setItem("DMUSlidesExpFlag_"+widget.id,"true");sessionStorage.setItem("DMUSlidesWidth_"+widget.id,aj.width)}}}};R=new h(ai)}w.setPlayMode(L)}function G(ae){if(!v){y()}ae.titleEditionAllowed=ae.isEditable()&&!L;E.push(ae);v.addSlide(ae);var ad=E&&E.length>1;if(ad){if(E.length===2&&!x&&E[1].category==="InWork"){ad=false}}R.setPanelVisibilityFlag(ad&&O)}function z(ae){if(!s){s=true;var ad=ae.getImage();if(!ad){ad=new Image();f.computeImage(U.getViewer(),144,108,{onSuccess:function(af){ad=af;ae.setImage(ad);w.updateSlide(null,{img:ad.src})},onFailure:function(){}})}G({img:ad.src,id:"NominalSlide",category:"Nominal",isEditable:function(){return false},callback:function(af){if(af==="click"){w.setActiveSlide(null)}}});Q({id:"NominalSlide",doNotSenCB:true})}}function W(ad){if(!O){return}ab();if(L||ad.id==="NominalSlide"){return}if(!J){J=new n({frameWindow:U,viewer:U.getViewer()})}J.display({label:c.currentSlide+ad.title,icon:P,onClickCB:D,widgetType:"Accept",dockingSide:"left",className:"editingConfirmDiv"})}function ab(){if(J){J.hide()}}function D(){Q(E[0]);ab()}function H(){return 178}function C(ae,af){Y.splice(0,1);var ag=r.getReviewContext({viewer:U.getViewer()});var ad=ag?ag.getCurrentReview():null;if(ad){var ah=ad.getCurrentSlide();u=ae;l.setActiveSlide({context:r.getContextViewer({reviewContext:ag}),slide:ae,opts:af,onBeforeApplySlide:function(){X.disable();o.empty();if(aa){aa(ah,u)}},onSlideActivated:function(ai){if(ai.slide){for(var aj=0;aj<E.length;aj++){if(E[aj].slide===ai.slide){W(E[aj])}}}else{ab()}if(!v){return}v.setActiveSlide(ai.slide?"slide"+ai.slide.getAttribute("sID"):"NominalSlide");X.enable();if(Z){Z.publish("onSlideActivated",ai)}if(af.afterSlideActivationCB){af.afterSlideActivationCB(ah,ai.slide)}if(B){B(ah,ai.slide)}if(Y.length){C(Y[0].slide,Y[0].options)}else{X.updateActiveSlideThumbnail({force:true})}}})}}function A(){if(typeof sessionStorage!=="undefined"){var ad=sessionStorage.getItem("DMUSlidesExpFlag_"+widget.id);if(ad==="true"){sessionStorage.setItem("DMUSlidesExpFlag_"+widget.id,"false");R.setWidth(H())}else{var ae=parseFloat(sessionStorage.getItem("DMUSlidesWidth_"+widget.id));if(ae&&ae!==H()){sessionStorage.setItem("DMUSlidesExpFlag_"+widget.id,"true");R.setWidth(ae)}}}}function Q(ae){if(ae&&ae.id){v.setActiveSlide(ae.id);for(var ad=0;ad<E.length;ad++){E[ad].isActiveSlide=E[ad].id===ae.id;if(E[ad].id===ae.id){if(!ae.doNotSenCB){E[ad].callback("click")}}}}}function T(){var ah=0;var ag=v.getSelectedTiles();if(!ag.length&&!F&&u){var ad="slide"+u.getAttribute("sID");for(ah=1;ah<E.length;ah++){if(ad===E[ah].id){ag=[E[ah].id];break}}}if(ag&&ag.length){var ae=[],af=false;for(ah=0;ah<ag.length;ah++){for(var ai=1;ai<E.length;ai++){if(ag[ah]===E[ai].id){if(E[ai].isActiveSlide){af=true}v.removeSlide(ag[ah]);ae.push(ai)}}}for(ah=ae.length-1;ah>=0;ah--){E[ae[ah]].callback("delete");if(E){E.splice(ae[ah],1)}}if(E&&E.length&&af){Q(E[0])}}F=false;if(v){v.setCheckBoxeActiveFlag(F)}}function ac(ae){for(var ad=0;ad<E.length;ad++){if(E[ad].isActiveSlide&&E[ad].onSlideNameChanged){E[ad].onSlideNameChanged({name:ae.title});E[ad].title=ae.title;W(E[ad]);break}}}function S(){F=!F;v.setCheckBoxeActiveFlag(F)}}});var j=[];var i=k.singleton({init:function(){},getDMUSlidesController:function(t){var u=this.giveDMUSlidesController(t);if(t&&t.context&&!u){var s=new q(t);u={addSlide:function(v){if(!s){return undefined}return s.addSlide(v)},updateSlide:function(v,w){if(!s){return}s.updateSlide(v,w)},updateSlideEditableFlag:function(v){if(!s){return}s.updateSlideEditableFlag(v)},update:function(){if(!s){return}s.update()},clear:function(){if(!s){return}s.clear()},setPlayMode:function(v){if(!s){return}s.setPlayMode(v)},getPlayMode:function(){if(!s){return false}return s.getPlayMode()},setVisibleFlag:function(v){if(!s){return}s.setVisibleFlag(v)},getVisibleFlag:function(){if(!s){return undefined}return s.getVisibleFlag()},setActiveSlide:function(v,w){if(!s){return}s.setActiveSlide(v,w)},getActiveSlide:function(){if(!s){return undefined}return s.getActiveSlide()},setPanelOptions:function(v){if(!s){return}s.setPanelOptions(v)}};j.push({context:t.context,slidesController:u})}return u?Object.freeze(u):u},giveDMUSlidesController:function(t){var u;if(t&&t.context){for(var s=0;s<j.length;s++){if(j[s].context===t.context){u=j[s].slidesController;break}}}return u?Object.freeze(u):u},unreferenceDMUSlidesController:function(t){if(t&&t.context){for(var s=0;s<j.length;s++){if(j[s].context===t.context){j[s].slidesController.clear();j.splice(s,1);break}}}}});return i});define("DS/DMUPlaySlide/commands/DMUPlaySlideCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/CommandsManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUPlaySlide/controllers/DMUSlidesController","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/DMUBaseExperience/DMUContextManager"],function(i,b,a,e,d,c,g,h){var f=i.extend({init:function(j){this._parent(j);var k=true;this.onStateChange(function(){if(!k){return}d.empty();c.empty();g.empty();var p=this.getState();var m=this.getFrameWindow();if(m){var q=h.getReviewContext({viewer:m.getViewer()});if(q){q.setReadOnly(p)}var o=e.giveDMUSlidesController({context:m});if(o){o.setPlayMode(p)}m.getViewer().render();var r=a.getManager({name:"DMU2DSheetManager",context:m});if(r){r.setReviewPlayMode(p)}if(p===true){if(q){q.getUIManager().disableAllCmds();var n=b.getCommandCheckHeader("slidePlayCmdHdr",h.getContextViewer({reviewContext:q}).getCommandContext());if(n){n.enable()}}}else{if(p===false){if(q){q.getUIManager().restoreCmds();if(q.getCurrentReview()){var l=q.getCurrentReview().getCurrentSlide();if(l&&o){o.setActiveSlide(l)}}}}}}});this._destroy=function(){k=false}}});return f});define("DS/DMUPlaySlide/controllers/DMUSlideShowController",["UWA/Class","DS/CATWebUXSlideShow/CATWebUXSlideShowController","DS/DMUPlaySlide/controllers/DMUSlidesController","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","i18n!DS/DMUPlaySlide/assets/nls/DMUPlaySlide"],function(c,j,g,i,a,e,d,h,f){var b=c.extend({init:function(m){this._parent(m);var v=m||{};var r=v.context;var t=a.getManager({name:"DMU2DSheetManager",context:r.getFrameWindow()});var k=j.getSlideShowController({context:r.getFrameWindow(),id:"DMU3DMarkupSlideShow"});k.setListOfCommandsAllowed(["LockUnlockSectionHdr"]);function o(w,z,y){var x=g.giveDMUSlidesController({context:r.getFrameWindow()});if(x){x.setActiveSlide(w);k.displaySlideInformation({message:w?(w.getAttribute("sName")+" ("+z+" / "+y+") "):f.nominalSlide})}}function n(w){var y=g.giveDMUSlidesController({context:r.getFrameWindow()});if(y){var x=y.getActiveSlide();var A=i.getReviewContext({context:r}).getCurrentReview().getChildren("DMUSlide");for(var z=0;z<A.length;z++){if(x&&A[z].getAttribute("sID")===x.getAttribute("sID")){if(w==="next"){if(z<A.length-1){o(A[z+1],z+2,A.length)}else{o(null)}}else{if(z>0){o(A[z-1],z,A.length)}else{o(null)}}return}}if(w==="next"){o(A[0],1,A.length)}else{o(A[A.length-1],A.length,A.length)}}}k.subscribe("onPreviousSlideCB",function(){n("previous")});k.subscribe("onNextSlideCB",function(){n("next")});k.subscribe("onFirstSlideCB",function(){o(null)});k.subscribe("onLastSlideCB",function(){var w=i.getReviewContext({context:r}).getCurrentReview().getChildren("DMUSlide");o(w[w.length-1],w.length,w.length)});var l,q,p,u,s;k.subscribe("onActiveStateModified",function(C){var A=i.getReviewContext({context:r});var z=A?A.getCurrentReview().getChildren("DMUSlide"):null;var x=g.giveDMUSlidesController({context:r.getFrameWindow()});if(C.state){C.onBeginSlideShow(z!==null&&z!==undefined&&z.length>0);if(!z||!z.length){return}if(x){x.setVisibleFlag(!C.state)}else{k.setActiveState(false);return}e.empty();d.empty();h.empty();l=A.isReadOnly();A.setReadOnly(true);q=t?t.getReviewPlayMode():false;if(t){t.setReviewPlayMode(true);p=t.getNavBarVisibleFlag();if(p){t.setNavBarVisibleFlag(false)}}var B=r.getViewer();u={activated:B.picking.activated,trapSelection:B.picking.trapSelection,primitive:B.picking.primitive,trapSelectionMesh:B.picking.trapSelectionMesh};B.setPicking({activated:false,primitive:1,trapSelectionMesh:false,trapSelection:false});s={activated:B.pPicking.activated,primitive:B.pPicking.primitive,trapSelectionMesh:B.pPicking.trapSelectionMesh,trapSelection:B.pPicking.trapSelection};B.setPrePicking({activated:false,primitive:1,trapSelectionMesh:true,trapSelection:true});var w=x.getActiveSlide();if(!w){o(null)}else{for(var y=0;y<z.length;y++){if(z[y].getAttribute("sID")===w.getAttribute("sID")){x.setActiveSlide(null);o(w,y+1,z.length);break}}}}else{if(x){x.setVisibleFlag(!C.state)}else{k.setActiveState(false);return}if(t){t.setReviewPlayMode(q);if(p){t.setNavBarVisibleFlag(true)}}if(A){A.setReadOnly(l)}r.getViewer().setPicking(u);r.getViewer().setPrePicking(s)}});this.clean=function(){j.unreferenceSlideShowController({context:r.getFrameWindow(),id:"DMU3DMarkupSlideShow"});k=null};this.getActiveState=function(){return k?k.getActiveState():null};this.setActiveState=function(w){if(k){k.setActiveState(w)}};this.subscribe=function(x,w){return k?k.subscribe(x,w):null};this.unsubscribe=function(w){if(k){k.unsubscribe(w)}}}});return b});define("DS/DMUPlaySlide/DMUSlide",["DS/DMUBaseExperience/EXPObject","DS/DMUBaseUI/DMUNode3D","DS/DMUPlaySlide/controllers/DMUSlidesController","DS/DMUPlaySlide/DMUSlideImport","DS/DMUBaseExperience/DMUContextManager"],function(b,f,g,a,e){var d=[{name:"sType",type:"string",JSONname:"type"},{name:"sID",type:"string",JSONname:"id"},{name:"sUuid",type:"string",JSONname:"uuid"},{name:"sName",type:"string",JSONname:"Name"},{name:"sDescription",type:"string",JSONname:"Description"},{name:"sImageURL",type:"ImageURL",JSONname:"ImageURL"},{name:"bInWork",type:"boolean",JSONname:"InWork"}];var c=b.extend({init:function(m,q){this._parent(m,q);this._sExpType=this.GetType();var o=this;this._parameters=d;this.defineMembersFromParameters();var j={},h=[],n=[];var i=false;var l=true;this.setActiveFlag=function(s){l=s;if(s){o.refreshNode()}else{i=false;var r=g.giveDMUSlidesController({context:o._frmWindow});if(r){r.setActiveSlide(null)}g.unreferenceDMUSlidesController({context:o._frmWindow})}};this.setReadOnly=function(s){this._bReadOnly=s;var r=g.giveDMUSlidesController({context:o._frmWindow});if(r){r.updateSlideEditableFlag(o)}};this.addObjectOverload=function(r){n.push(r)};this.setEnvironmentOverload=function(r){j=r};this.activate=function(){var r=g.giveDMUSlidesController({context:o._frmWindow});if(r){r.setActiveSlide(o)}};this.deactivate=function(){var r=g.giveDMUSlidesController({context:o._frmWindow});if(r){r.setActiveSlide(null)}};this.getChildWithID=function(r){var u=null;if(j.id===r){u=j}if(u===null){for(var t=0;t<h.length;t++){if(h[t].id===r){u=h[t];break}}}if(u===null){for(var s=0;s<n.length;s++){if(n[s].id===r){u=n[s];break}}}return u};this.getOverloadForTarget=function(s){var r=null;n.concat(h,j).forEach(function(t){if(t.target===s){r=t}});return r};this.getEnvironmentOverload=function(){return j||{}};this.getObjectOverloads=function(){return n||{}};this.saveOverloadsFromCurrentStates=function(){o.getParent().getChildren().forEach(function(u){var t=u._sExpType;if(t!=="DMUSlide"&&t!=="DMUEnvironment"&&t!=="DMULinksManager"){var s=u.getState();if(s){n.push({target:u,state:s})}}});var r=o.getParent().getEnvironment();j={target:r,state:r.getState()}};this.setImage=function(r){o.set({attribute:"sImageURL",value:r})};this.getImage=function(){return o.getAttribute("sImageURL")};this.refreshNode=function(){if(!l){return}var r=g.getDMUSlidesController({context:o._frmWindow});if(r){if(!i){i=true;r.addSlide(this)}else{r.updateSlide(this)}}};if(e.getAuthoringFeatureTypes().indexOf("Slide")!==-1){var p="DS/DMUSlideEdition/DMUSlideExport";require([p],function(s){var r=new s(o);o.exportData=r.exportData})}var k=new a(o);this.importData=k.importData;this.afterImport=k.afterImport;this.parentRemove=this.remove;this.remove=function(){o.parentRemove();o.getParent().onAfterSlideRemoved();if(!o.getParent().getChildren("DMUSlide").length){g.unreferenceDMUSlidesController({context:o._frmWindow})}k=n=j=h=null}},initComponent:function(j){this._parent(j);this._createNode();if(!this.getParent().isImporting()){var i=this.getParent();if(i){i.addOrModifyEnvironment();var h=i.getReviewEnvironment();if(h){h.initializeViewpointModifCallback()}}}},_createNode:function(){if(!this._nNode){this._nNode=new f(this);this.addNodeInParentNode()}},GetType:function(){return"DMUSlide"}});return c});