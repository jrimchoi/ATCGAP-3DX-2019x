define("DS/Magnifier/Magnifier",["UWA/Class","UWA/Controls/Abstract","DS/CoreEvents/Events","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/VisuEvents/ScreenEvent","DS/VisuEvents/EventsManager"],function(c,h,a,e,d,b,g){var f=h.extend({defaultOptions:{activated:true,viewer:null,dim:83,shiftVector:{x:-40,y:110}},init:function(i){this._parent(i);this._buildView();this.displayed=false;this.enableSelection=false;this.devicePixelRatio=window.devicePixelRatio||1;this.container=this.elements.container;this.content=this.elements.container.firstChild;this.setUpCBs();this.setOption(this.options);this.viewer.divCssElement.appendChild(this.container);this.onRenderCB=null},setOption:function(i){if(i.viewer){this.viewer=i.viewer}if(i.dim){this._setDimension(i.dim)}if(i.shiftVector){this.shiftVector=i.shiftVector}else{this.shiftVector=new e.Vector2()}if(i.activated){this._activate()}else{this._desactivate()}},_buildView:function(){this.elements.container=UWA.Element("div",{id:"magnify-div",html:[{tag:"canvas",id:"magnify-canvas",}],styles:{position:"absolute",display:"none","box-shadow":"-1px 2px 5px 1px rgba(0, 0, 0, 0.7)",border:"1px solid #ccc",}})},_setDimension:function(i){this.devicePixelRatio=window.devicePixelRatio||1;this.dim=(i%2===0)?(i+1):i;this.container.setStyle("width",this.dim);this.container.setStyle("height",this.dim);this.container.setStyle("overflow","hidden");this.container.setStyle("border-radius","50%");this.content.setStyle("width","100%");this.content.setStyle("height","100%");this.content.width=this.dim*(window.devicePixelRatio||1);this.content.height=this.dim*(window.devicePixelRatio||1)},_updateMagnifier:function(i){var l=(window.devicePixelRatio||1);if(l!==this.devicePixelRatio){this.devicePixelRatio=l;this._setDimension(this.dim)}var j={x:this.viewer.renderer.deviceWidth,y:this.viewer.renderer.deviceHeight};var k={x:Math.round(this.dim*l),y:Math.round(this.dim*l)};var m={x:Math.min(Math.max(0,i.xPix+this.shiftVector.x*l),j.x-k.x),y:Math.min(Math.max(0,i.yPix-this.shiftVector.y*l),j.y-k.y)};this.container.show();this.displayed=true;this._renderOffscreen(this.viewer,this.viewer.currentViewpoint,this.content,j,k,i);this.container.setStyles({left:Math.round(m.x/l),top:Math.round(m.y/l)})},_renderOffscreen:function(q,u,m,A,v,s){var x={x:s.xPix-v.x/2,y:s.yPix+v.y/2};var o={data:null,width:v.x,height:v.y,x:Math.round(x.x),y:Math.round(A.y-x.y)};q.renderToTarget(o,u,true);var z=m.getContext("2d");var w=z.getImageData(0,0,v.x,v.y);var t=w.data;for(var n=0;n<w.height;n++){for(var p=0;p<w.width;p++){var k=this._getBufferIndex(p,n,w.width,w.height,false);var r=this._getBufferIndex(p,n,o.width,o.height,true);t[4*k]=o.data[4*r];t[4*k+1]=o.data[4*r+1];t[4*k+2]=o.data[4*r+2];t[4*k+3]=o.data[4*r+3]}}z.putImageData(w,0,0);z.drawImage(z.canvas,0,0,v.x,v.y);var l=Math.floor(v.x/2)+0.5;var y=Math.floor(v.y/2)+0.5;z.fillStyle="rgba(0, 255, 255, 0.5)";z.fillRect(l-2,y-8,4,16);z.fillRect(l-8,y-2,16,4);z.fillStyle="rgba(0, 0, 0, 0.5)";z.fillRect(l-1.5,y-7.5,3,15);z.fillRect(l-7.5,y-1.5,15,3);z.fillStyle="rgba(255, 255, 255, 1)";z.fillRect(l-0.5,y-6.5,1,13);z.fillRect(l-6.5,y-0.5,13,1);if(this.onRenderCB){this.onRenderCB()}},_getBufferIndex:function(m,l,k,n,o){if(o){l=n-l;return k*Math.floor(l-1)+Math.floor(m)}return k*Math.floor(l)+Math.floor(m)},_activate:function(){this.active=true;g.addEvent(this.viewer.canvas,"onLongHold",this.startCB)},_desactivate:function(){this.active=false;g.removeEvent(this.viewer.canvas,"onLongHold",this.startCB)},setUpCBs:function(){var i=this;i.displayed=false;this.startCB=function(j){if(!i.viewer.currentViewpoint.control.isMiddleButtonPressed()&&!i.viewer.currentViewpoint.control.isRightButtonPressed()){i._updateMagnifier(i.viewer.getMousePosition(j.from[0].getCurrentPosition(i.viewer.canvas)));g.addEvent(i.viewer.canvas,"onSwipe",i.moveCB);g.addEvent(i.viewer.canvas,"onRelease",i.endCB)}};this.moveCB=function(j){if(j.from[0].deltaPosition.length()<300){i._updateMagnifier(i.viewer.getMousePosition(j.from[0].getCurrentPosition(i.viewer.canvas)))}else{i.container.hide()}if(j.from[0].offsetPosition.length()>10){i.enableSelection=true}};this.endCB=function(){i.container.hide();g.removeEvent(i.viewer.canvas,"onSwipe",i.moveCB);g.removeEvent(i.viewer.canvas,"onRelease",i.endCB)}}});return f});define("Magnifier/Magnifier",["DS/Magnifier/Magnifier","DS/DSMigration/DSMigration"],function(b,a){a.deprecateModule("Magnifier/Magnifier");return b});