define("DS/VCXWebTimeline/VCXWebTimelineView",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/WebappsUtils/WebappsUtils","DS/Controls/Button","DS/Windows/Panel","DS/Controls/Toggle"],function(d,c,a,h,f,e,b){var g=d.extend({init:function(j){this.options=j;this._container=null;this._updateModelLocked=false;this._listCustomButtons=[];this._parentPanel=null;this._parentNode=j.parent||null;this._frmWindow=j.frmWindow;this._title=j.title||"Timeline";this._maxFrame=j.maxFrame||0;this._fps=j.fps||30;this.loadCssFile("VCXWebTimeline/VCXWebTimeline.css",1);if(this._parentNode!==null){var k=this._parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;this.oldWidth=0;var i=this;this._observer=new MutationObserver(function(m){m.forEach(function(o){if(o.target===k&&i.oldWidth!==k.style.width){var n=((i._parentNode.clientWidth-i.oldWidth)>0)?true:false;i._updateDynamicToolbar(i._parentNode.clientWidth,n);i.oldWidth=i._parentNode.clientWidth}})});var l={attributes:true,childList:false,characterData:false,subtree:false,attributeOldValue:true,attributeFilter:["style"]};if(k){this._observer.observe(k,l)}}},unInitialize:function(){if(this._parentPanel){this._parentPanel.close();delete this._parentPanel}this._observer&&this._observer.disconnect();this._observer=null},updateModelLocked:function(i){this._updateModelLocked=i},isVisible:function(){if(this._parentPanel){if(this._parentPanel.getDockedFlag()===true){if(this._frmWindow.getImmersiveFrame().getDockingElement(this._parentPanel.currentDockArea).collapseDockingZoneFlag===true){return false}}return true}else{return false}},loadCssFile:function(k,j){var m=document.getElementsByTagName("head")[0];var n=m.getElementsByTagName("link");var o=null;for(var l=0;l<n.length;l++){o=n[l];if(o.href.search(k)>-1){o.disabled=false;return}}o=document.createElement("link");o.type="text/css";o.rel="stylesheet";if(j===undefined){o.href=k}else{o.href=h.getWebappsBaseUrl()+k}m.appendChild(o)},_convertIndexToTime:function(i){return i/this._fps},_convertIndexToSimpleDisplayTime:function(l){var j=l/this._fps;var q=Math.floor(j);var p=Math.floor(q/86400),o=Math.floor(q/3600)%24,i=Math.floor(q/60)%60,n=q%60,k=Math.floor(j%1*1000);if(p>0){return p+"d "+(o>0?o+"h ":"")}else{if(o>0){return o+"h "+(i>0?i+"min ":"")}else{if(i>0){return i+"min "+(n>0?n+"s ":"")}else{if(n>0){return n+"s "+(k>0?k+"ms":"")}else{if(k>0){return k+"ms"}else{return"0"}}}}}},_convertIndexToDisplayTime:function(l){var j=l/this._fps;var q=Math.floor(j);var p=Math.floor(q/86400),o=Math.floor(q/3600)%24,i=Math.floor(q/60)%60,n=q%60,k=Math.floor(j%1*1000);if(k==0&&n==0&&i==0&&o==0&&p==0){return"0"}return(p>0?p+"d ":"")+(o>0?o+"h ":"")+(i>0?i+"min ":"")+(n>0?n+"s ":"")+(k>0?k+"ms":"")},_sendEvent:function(i,j){a.publish({event:i,data:j})},_createPanel:function(m,n,k,o,l,j){m.getDockingElement(WUXDockAreaEnum.TopDockArea).collapseDockingZoneFlag=true;var i=new e({activeFlag:false,immersiveFrame:m,resizableFlag:n,currentDockArea:k,title:o,content:l,minWidth:500,width:1000,height:40,visibleFlag:true,maximizedFlag:false,closeButtonFlag:false});if(i){i.elements.container.addClassName(j);return i}},_createContainer:function(i){return new UWA.Element("div",{"class":i})},_addSeparator:function(i){var j=new UWA.Element("div",{"class":"wux-afr-cmdSeparator",styles:{height:"24px"}}).inject(i)},_createToggle:function(j,i,k){return new b({type:j,label:i,checkFlag:k})},_createStandardButton:function(i,j,m){var n=j;if(Array.isArray(j)){n=j[0]}var k=new f({recId:m,icon:n,iconSize:"1x",type:"standard"}).inject(i);if(Array.isArray(j)){var l=k.elements.button.childNodes[0];l.className="wux-ui-fa wux-ui-fa-stack vcx-timeline-toolbar-stack";UWA.createElement("i",{"class":"wux-ui-fa wux-ui-fa-lg "+j[0]+" "+j[1]}).inject(l);UWA.createElement("i",{"class":"wux-ui-fa wux-ui-fa-lg "+j[2]+" "+j[3]}).inject(l)}k.elements.button.title=m;return k},_createCheckButton:function(i,k,m,j){var l=this._createStandardButton(i,k,m);l.type="check";l.checkFlag=j;return l},getContainer:function(){return this._container},getParentPanel:function(){return this._parentPanel},getParentNode:function(){return this._parentNode},getFrameWindow:function(){return this._frmWindow},getTitle:function(){return this._title},getMaxFrame:function(){return this._maxFrame},getFPS:function(){return this._fps},getTrackTreeListView:function(){return null},getTimelineModel:function(){return null}});return g});define("DS/VCXWebTimeline/VCXWebTimelineCustomTreeNodeView",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Tree/TreeNodeView",],function(c,b,a,e){var d=e.extend({init:function(f){this._parent(f)},updateInternalParameters:function(){this._parent();var f=this.getCellInfos();if(!f.isHeader){if(f.nodeModel.options.preventDisplayChilds){f.cellView.getContent().addClassName("vcx-preventDisplayChilds")}else{f.cellView.getContent().removeClassName("vcx-preventDisplayChilds")}}}});return d});define("DS/VCXWebTimeline/VCXWebTimeline",["UWA/Class","DS/CoreEvents/Events"],function(b,a){var c=b.extend({init:function(d){this.options=d;this._index=d.index||0;this._fps=d.fps||30;this._view=null;this._GUID=this.guid();console.log(this._GUID);this._registerIndexPositionChangedToken;this._registerPlayToken;this._registerPauseToken;this._registerStopToken;this._registerStepBackwardToken;this._registerStepForwardToken;this._registerCameraToken;this._registerLoopToken;this._registerBounceToken;this._registerReverseToken;this._registerAutoKeyToken},unInitialize:function(){this._unRegisterWUXEvent(this._registerIndexPositionChangeWhileToken);this._registerIndexPositionChangeWhileToken=0;this._unRegisterWUXEvent(this._registerIndexPositionChangeEndToken);this._registerIndexPositionChangeEndToken=0;this._unRegisterWUXEvent(this._registerPlayToken);this._unRegisterWUXEvent(this._registerPauseToken);this._unRegisterWUXEvent(this._registerStopToken);this._unRegisterWUXEvent(this._registerStepBackwardToken);this._unRegisterWUXEvent(this._registerStepForwardToken);this._unRegisterWUXEvent(this._registerCameraToken);this._unRegisterWUXEvent(this._registerLoopToken);this._unRegisterWUXEvent(this._registerBounceToken);this._unRegisterWUXEvent(this._registerReverseToken);this._unRegisterWUXEvent(this._registerAutoKeyToken);this._registerPlayToken=0;this._registerPauseToken=0;this._registerStopToken=0;this._registerStepBackwardToken=0;this._registerStepForwardToken=0;this._registerCameraToken=0;this._registerLoopToken=0;this._registerBounceToken=0;this._registerReverseToken=0;if(this._view){this._view.unInitialize()}},guid:function(){function d(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()},_subscribeToGUIEvent:function(g,d){var e=this;var f=a.subscribe({event:g},function(){e._sendEvent(d)});return f},_subscribeToGUIEventWithData:function(g,d){var e=this;var f=a.subscribe({event:g},function(h){e._sendEvent(d,h)});return f},_registerIndexPositionChange:function(g,d){var e=this;var f=null;f=a.subscribe({event:g},function(h){e._index=h;e._sendEvent(d,h)});return f},_unRegisterWUXEvent:function(d){a.unsubscribe(d)},_sendEvent:function(d,e){a.publish({event:d,data:e})},getIndex:function(){return this._index},getFPS:function(){return this._fps},getView:function(){return this._view},pauseGUIMode:function(){},playGUIMode:function(){},updateGrid:function(){},onRedraw:function(){},removeKey:function(d){},emptyMarkers:function(){},getTrackTreeListView:function(){return null},getTimelineModel:function(){return null},getSelectedTime:function(){}});return c});define("DS/VCXWebTimeline/VCXWebTimelineLightView",["UWA/Core","UWA/Element","DS/Core/PointerEvents","DS/Controls/SpinBox","DS/VCXWebTimeline/VCXWebTimelineView","DS/Controls/Timeline"],function(g,a,b,f,d,c){var e=d.extend({init:function(i,j){this._parent(i);this._eventsName=j;this._slider=null;this.sliderContainer=null;this._toolbar=null;this._playBack=null;this.playBackContainer=null;if(i.customButtons){this._listCustomButtons=i.customButtons}this._displayToolbar=i.displayToolbar;this._displaySlider=i.displaySlider;this._displayPlayBack=i.displayPlayBack;this._displayLoop=i.displayLoop;this._displayBounce=i.displayBounce;this._displayReverse=i.displayReverse;this._displayMarkers=i.displayMarkers;this._displayCamera=i.displayCamera;this._cameraMode=i.displayCameraMode;this._displayAutoKey=i.displayAutoKey;this._autoKeyMode=i.displayAutoKeyMode;this._displayRemoveTracks=i.displayRemoveTracks;this._displayFilterOnSelection=i.displayFilterOnSelection;this._filterOnSelectionMode=i.filterOnSelectionMode;this._play=null;this._stepBackward=null;this._stepForward=null;this._stop=null;this._nextMarker=null;this._previousMarker=null;this._loop=null;this._bounce=null;this._reverse=null;this._camera=null;this._waitPressTimer=0;this._pressTimer=0;this._isPressed=false;this._fromFrame=null;this._prevVal=0;var h=this;this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK=function(k){if(h._play.checkFlag){h._play.icon="play";h._play.checkFlag=false;h._sendEvent(h._eventsName.pause)}h._isPressed=true};this._buildLightTimelineComponents();if(this._parentNode===null){this._parentPanel=this._createPanel(this._frmWindow.getImmersiveFrame(),true,WUXDockAreaEnum.TopDockArea,this._title,this._container);this._parentNode=this._parentPanel.elements.container}else{this._container.inject(this._parentNode)}this._DOCUMENT_POINTERUP=function(l){window.clearTimeout(h._waitPressTimer);window.clearInterval(h._pressTimer);if(h._isPressed){h._isPressed=false;if(h._fromFrame!=h._slider.getValue()){var k={from:h._fromFrame,to:h._slider.getValue()};h._sendEvent(h._eventsName.indexPositionChangeEnd,k)}else{var k={from:h._prevVal,to:h._slider.getValue()};h._sendEvent(h._eventsName.indexPositionChangeEnd,k)}}if(h._displaySlider){h._prevVal=h._slider.getValue()}};document.addEventListener(b.POINTERUP,this._DOCUMENT_POINTERUP)},unInitialize:function(){this._parent();this._stepBackward.elements.button.removeEventListener(b.POINTERDOWN,this._STEPBACKWARD_MOUSEDOWN_CALLBACK);this._stepForward.elements.button.removeEventListener(b.POINTERDOWN,this._STEPFORWARD_MOUSEDOWN_CALLBACK);if(this._slider){this._slider.elements.container.removeEventListener(b.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK);this._slider._modelEvents.unsubscribe(this._SLIDER_ONCHANGE)}if(this._playBack){this._playBack.elements.up.removeEventListener(b.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK);this._playBack.elements.down.removeEventListener(b.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK)}document.removeEventListener(b.POINTERUP,this._DOCUMENT_POINTERUP);this._container.remove();this._container=null;this._STEPBACKWARD_MOUSEDOWN_CALLBACK=0;this._STEPFORWARD_MOUSEDOWN_CALLBACK=0;this._DOCUMENT_POINTERUP=0;this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK=0},_buildLightTimelineComponents:function(){this._container=this._createContainer("vcx-timeline vcx-timeline-light");if(this._displayToolbar){this._buildToolbar()}if(this._displaySlider){this._buildSlider()}if(this._displayPlayBack){this._buildPlayBack()}},_buildToolbar:function(){var h=this;this._toolbar=this._createContainer("vcx-timeline-light vcx-timeline-toolbar").inject(this._container);this._previousMarkerButton(h);this._stepBackwardButton(h);this._playPauseButton(h);this._stopButton(h);this._stepForwardButton(h);this._nextMarkerButton(h);this._addSeparator(this._toolbar);this._loopButton(h);this._bounceButton(h);this._reverseButton(h);this._addSeparator(this._toolbar);this._autoKeyButton(h);this._cameraButton(h);this._removeTrackSelectedButton(h);this._filterOnSelectionButton(h);for(var j=0;j<this._listCustomButtons.length;j++){var k=this._listCustomButtons[j];this._createCustomButton(k.icon,k.tooltip,k.callback)}},_stepBackwardButton:function(h){this._stepBackward=this._createStandardButton(this._toolbar,["wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-backward-1","wux-ui-fa-stop","vcx-timeline-toolbar-stack-frame-backward-2"],"Frame Backward");this._STEPBACKWARD_MOUSEDOWN_CALLBACK=function(i){h._onPause(h);h._sendEvent(h._eventsName.stepBackward);h._waitPressTimer=window.setTimeout(function(){h._pressTimer=window.setInterval(function(){h._sendEvent(h._eventsName.stepBackward)},100)},300)};this._stepBackward.elements.button.addEventListener(b.POINTERDOWN,this._STEPBACKWARD_MOUSEDOWN_CALLBACK)},_createCustomButton:function(i,j,k){var h=this._createStandardButton(this._toolbar,i,j);this._addCustomButtonClick(h,k);return h},_addCustomButtonClick:function(h,i){h.onClick=i},_previousMarkerButton:function(h){if(this._displayMarkers){this._previousMarker=this._createStandardButton(this._toolbar,["wux-ui-fa-circle-o","vcx-timeline-toolbar-stack-frame-previousMarker-1","wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-previousMarker-2"],"Previous Marker");this._previousMarker.visibleFlag=false;this._previousMarker.onClick=function(i){h._onPause(h);h._sendEvent(h._eventsName.previousMarker)}}},_playPauseButton:function(h){this._play=this._createCheckButton(this._toolbar,"play","Play",false);this._play.onClick=function(i){if(!h._play.checkFlag){h._play.icon="play";h._play.elements.button.title="Play";h._sendEvent(h._eventsName.pause)}else{h._play.icon="pause";h._play.elements.button.title="Pause";h._sendEvent(h._eventsName.play)}}},_stopButton:function(h){this._stop=this._createStandardButton(this._toolbar,"stop","Stop");this._stop.onClick=function(i){h._sendEvent(h._eventsName.stop)}},_nextMarkerButton:function(h){if(this._displayMarkers){this._nextMarker=this._createStandardButton(this._toolbar,["wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-nextMarker-1","wux-ui-fa-circle-o","vcx-timeline-toolbar-stack-frame-nextMarker-2"],"Next Marker");this._nextMarker.visibleFlag=false;this._nextMarker.onClick=function(i){h._onPause(h);h._sendEvent(h._eventsName.nextMarker)}}},_stepForwardButton:function(h){this._stepForward=this._createStandardButton(this._toolbar,["wux-ui-fa-stop","vcx-timeline-toolbar-stack-frame-forward-1","wux-ui-fa-play","vcx-timeline-toolbar-stack-frame-forward-2"],"Frame Forward");this._STEPFORWARD_MOUSEDOWN_CALLBACK=function(i){h._onPause(h);h._sendEvent(h._eventsName.stepForward);h._waitPressTimer=window.setTimeout(function(){h._pressTimer=window.setInterval(function(){h._sendEvent(h._eventsName.stepForward)},100)},300)};this._stepForward.elements.button.addEventListener(b.POINTERDOWN,this._STEPFORWARD_MOUSEDOWN_CALLBACK)},_cameraButton:function(h){if(this._displayCamera){this._camera=this._createCheckButton(this._toolbar,"video-camera","Camera Play Mode",this._cameraMode);this._camera.onClick=function(i){h._sendEvent(h._eventsName.camera,i.dsModel.checkFlag)}}},_autoKeyButton:function(h){if(this._displayAutoKey){this._autoKey=this._createCheckButton(this._toolbar,"dot-circle-o","Auto key mode",this._autoKeyMode);this._autoKey.onClick=function(i){h._sendEvent(h._eventsName.autoKey,i.dsModel.checkFlag)}}},_removeTrackSelectedButton:function(h){if(this._displayRemoveTracks){this._removeTracks=this._createStandardButton(this._toolbar,"trash","Empty selection");this._removeTracks.onClick=function(i){h._sendEvent(h._eventsName.removeSelectedTracks,i.dsModel.checkFlag)}}},_filterOnSelectionButton:function(h){if(this._displayFilterOnSelection){this._displayFilterOnSelectionButton=this._createCheckButton(this._toolbar,"filter","Filter on Selection",this._filterOnSelectionMode);this._displayFilterOnSelectionButton.onClick=function(i){h._sendEvent(h._eventsName.filterOnSelection,i.dsModel.checkFlag)}}},_loopButton:function(h){if(this._displayLoop){this._loop=this._createCheckButton(this._toolbar,"retweet","Loop Play Mode",false);this._loop.onClick=function(i){h._sendEvent(h._eventsName.loop,i.dsModel.checkFlag)}}},_bounceButton:function(h){if(this._displayBounce){this._bounce=this._createCheckButton(this._toolbar,["wux-ui-fa-circle","vcx-timeline-toolbar-stack-bounce-1","wux-ui-fa-check","vcx-timeline-toolbar-stack-bounce-2"],"Bounce Play Mode",false);this._bounce.onClick=function(i){h._sendEvent(h._eventsName.bounce,i.dsModel.checkFlag)}}},_reverseButton:function(h){if(this._displayReverse){this._reverse=this._createCheckButton(this._toolbar,["wux-ui-fa-play","vcx-timeline-toolbar-stack-reverse-1","wux-ui-fa-play","vcx-timeline-toolbar-stack-reverse-2"],"Reverse Play Mode",false);this._reverse.onClick=function(i){h._sendEvent(h._eventsName.reverse,i.dsModel.checkFlag)}}},_buildSlider:function(){this.sliderContainer=this._createContainer("vcx-timeline-light-slider").inject(this._container);this._createSlider(this.sliderContainer,0,0,this._maxFrame)},_createSlider:function(i,k,l,h){var j=this;this._slider=new c({minValue:k,maxValue:h,value:l,snap:50,dynamicGraduations:false,dynamicGaugeColor:false,graduationsLabel:true,eventsList:[{label:k,value:l,},{label:this._convertIndexToSimpleDisplayTime(h),value:h}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}).inject(i);this._slider._buildScaling=function(){var n=0;var u=this.options.graduations;var o=g.typeOf(u);var C;var B;if(o=="array"){C=u.length;B=C}else{C=parseInt(u,10);B=C+1}var m=-parseInt(this.options.theme.fontSize+5,10);for(var A=0;A<B;A++){var p;var q;if(this.options.dynamicGraduations){var F=(180-A*180/C);q="hsl("+F+", 100%, 50%)";p=0}else{q=this.options.inactiveGraduationsColor;p=1}if(o=="array"){n=this._realToVirtualValue(u[A].value).percent}else{n=A/C}var w=parseInt(this.options.theme.graduations.height/4,10);if(this.options.dynamicGraduations){w=0}var E=new g.Element("div",{"class":"wux-Gauge-scale",styles:{position:"absolute",opacity:p}});var y=new g.Element("div",{styles:{position:"relative"}}).inject(E);if(this.options.graduationsLabel){var r;if(o=="array"){r=u[A].label}else{r=this._percentToRealValue(parseFloat(n))}var D=this;var v=new g.Element("div",{"class":"wux-Gauge-scale-label","data-value":D._percentToRealValue(n),styles:{position:"absolute",top:m,fontSize:this.options.theme.fontSize,color:this.options.graduationsLabelColor},html:r.toString(),}).inject(y);if(u[A].type!==undefined){var z=document.createAttribute("marker-type");z.value=u[A].type;v.setAttributeNode(z);v.title=u[A].name;var s=function(x){return function(G){G.stopPropagation();j._onPause(j);j._sendEvent(j._eventsName.goToMarker,x)}};v.addEventListener(b.POINTERDOWN,s(u[A]))}}var t=n*100;E.setStyles({backgroundColor:q,top:-2,left:t+"%",marginLeft:(A==(B-1))?-1:0,width:this.options.theme.graduations.width,height:this.options.theme.graduations.height}).inject(this.elements.container)}};this._slider.removeScalingFromDOM=function(){var o=this.elements.container.querySelectorAll(".wux-controls-gauge.wux-timeline > .wux-Gauge-scale:not(.wux-Gauge-cursor)");var n=o.length;for(var m=0;m<n;m++){o[m].parentNode.removeChild(o[m])}};this._sliderInteractions()},_sliderInteractions:function(){var h=this;this._SLIDER_ONCHANGE=this._slider.addEvent("change",function(i){var j=h._slider.getValue();if(h._displayToolbar){h._updateToolbarButtons(h,j)}else{if(j===0||j>=h._maxFrame){window.clearTimeout(h._waitPressTimer);window.clearInterval(h._pressTimer)}}if(!h._updateModelLocked){h._sendEvent(h._eventsName.indexPositionChangeWhile,j);if(!h._isPressed){h._fromFrame=j}}h._updateComposantsUnits(j)});h._slider.elements.container.addEventListener(b.POINTERDOWN,h._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK)},_addMarkers:function(l){var j=l.length;if(j===0){return}if(this._displayMarkers){this._previousMarker.visibleFlag=true;this._nextMarker.visibleFlag=true}if(this._displaySlider){this._slider.removeScalingFromDOM();var h;for(var k=0;k<j;k++){if(l[k].frame<=this._maxFrame){h={id:l[k].id,value:l[k].frame,type:l[k].type,name:l[k].name,label:""}}this._slider.options.graduations.push(h)}this._slider._buildScaling()}},_buildPlayBack:function(){this.playBackContainer=this._createContainer("vcx-timeline-light-spinbox").inject(this._container);this._createSpinBox(this.playBackContainer,100,"s",0,this._maxFrame,1,1)},_createSpinBox:function(i,n,j,l,h,m,k){this._playBack=new f({value:n,units:j,minValue:l,maxValue:h,stepValue:m,pageStepValue:k}).inject(i);this._spinBoxInteractions()},_spinBoxInteractions:function(){var h=this;this._playBack.addEventListener("change",function(i){if(h._displaySlider){h._slider.setValue(i.dsModel.value)}else{h._sendEvent(h._eventsName.indexPositionChangeEnd,i.dsModel.value)}});this._playBack.elements.up.addEventListener(b.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK);this._playBack.elements.down.addEventListener(b.POINTERDOWN,this._SLIDER_OR_SPINBOX_MOUSEDOWN_CALLBACK)},_updateDynamicToolbar:function(i,h){var l=this._displayToolbar?this._toolbar.clientWidth:null;var k=this._displaySlider?this.sliderContainer.clientWidth:null;var j=this._displayPlayBack?this._playBack.clientWidth:null;if(h){if(i>220&i<=260){this._camera.visibleFlag=true}else{if(i>260){this._stepBackward.visibleFlag=true;this._stepForward.visibleFlag=true}else{if(this._camera){this._camera.visibleFlag=true}}}}else{if(i<260&&i>220){this._stepBackward.visibleFlag=false;this._stepForward.visibleFlag=false}else{if(i<=220){if(this._camera){this._camera.visibleFlag=false}}else{}}}},_onPause:function(h){if(h._play.checkFlag){h._play.icon="play";h._play.checkFlag=false}},_updateComposantsUnits:function(h){var j=this._convertIndexToSimpleDisplayTime(h);if(this._displayPlayBack){this._playBack.elements.inputField.value=j}},_updateToolbarButtons:function(h,i){if(i===0){window.clearTimeout(h._waitPressTimer);window.clearInterval(h._pressTimer);if(h._displayMarkers){h._previousMarker.disabled=true;h._nextMarker.disabled=false}h._stepBackward.disabled=true;h._play.disabled=false;h._stepForward.disabled=false}else{if(i>=h._maxFrame){window.clearTimeout(h._waitPressTimer);window.clearInterval(h._pressTimer);h._play.disabled=true;h._stepForward.disabled=true;h._stepBackward.disabled=false;if(h._displayMarkers){h._previousMarker.disabled=false;h._nextMarker.disabled=true}}else{h._play.disabled=false;h._stepBackward.disabled=false;h._stepForward.disabled=false;if(h._displayMarkers){h._previousMarker.disabled=false;h._nextMarker.disabled=false}}}},isToolbarDisplayed:function(){return this._displayToolbar},getStepBackwardButton:function(){return this._stepBackward},getPreviousMarkerButton:function(){return this._previousMarker},getPlayButton:function(){return this._play},getStopButton:function(){return this._stop},getNextMarkerButton:function(){return this._nextMarker},getStepForwardButton:function(){return this._stepForward},getLoopButton:function(){return this._loop},getBounceButton:function(){return this._bounce},getReverseButton:function(){return this._reverse},getCameraButton:function(){return this._camera},getAutoKeyButton:function(){return this._autoKey},getFilterOnSelectionButton:function(){return this._displayFilterOnSelectionButton},isMarkersDisplayed:function(){return this._displayMarkers},isCameraDisplayed:function(){return this._displayCamera},isAutoKeyDisplayed:function(){return this._displayAutoKey},isLoopDisplayed:function(){return this._displayLoop},isBounceDisplayed:function(){return this._displayBounce},isReverseDisplayed:function(){return this._displayReverse},isSliderDisplayed:function(){return this._displaySlider},getSlider:function(){return this._slider},isPlayBackDisplayed:function(){return this._displayPlayBack},getPlayBack:function(){return this._playBack},getWaitPressTimer:function(){return this._waitPressTimer},getPressTimer:function(){return this._pressTimer},});return e});define("DS/VCXWebTimeline/VCXWebTimelineLight",["DS/VCXWebTimeline/VCXWebTimeline","DS/VCXWebTimeline/VCXWebTimelineLightView"],function(b,c){var a=b.extend({init:function(e){this._parent(e);var o=this.guid();var s="VCX_Timeline_GUI_IndexPosChgWhile"+o;var k="VCX_Timeline_GUI_IndexPosChgEnd"+o;var t="VCX_Timeline_GUI_Play"+o;var f="VCX_Timeline_GUI_Pause"+o;var p="VCX_Timeline_GUI_Stop"+o;var i="VCX_Timeline_GUI_StepBackward"+o;var j="VCX_Timeline_GUI_StepForward"+o;var r="VCX_Timeline_GUI_Camera"+o;var u="VCX_Timeline_GUI_Loop"+o;var g="VCX_Timeline_GUI_Bounce"+o;var h="VCX_Timeline_GUI_Reverse"+o;var m="VCX_Timeline_GUI_PreviousMarker"+o;var q="VCX_Timeline_GUI_NextMarker"+o;var n="VCX_Timeline_GUI_GoToMarker"+o;var v="VCX_Timeline_GUI_RemoveSelectedTracks"+o;var d="VCX_Timeline_GUI_FilterOnSelection"+o;var l="VCX_Timeline_GUI_AutoKey"+o;this.eventsName={indexPositionChangeWhile:s,indexPositionChangeEnd:k,play:t,pause:f,stop:p,stepBackward:i,stepForward:j,camera:r,loop:u,bounce:g,reverse:h,nextMarker:q,previousMarker:m,goToMarker:n,removeSelectedTracks:v,filterOnSelection:d,autoKey:l};this._view=new c(e,this.eventsName);this._registerIndexPositionChangeWhileToken=this._registerIndexPositionChange(s,e.event_timePosChangeWhile);this._registerIndexPositionChangeEndToken=this._registerIndexPositionChange(k,e.event_timePosChangeEnd);this._registerPlayToken=this._subscribeToGUIEvent(t,e.event_play);this._registerPauseToken=this._subscribeToGUIEvent(f,e.event_pause);this._registerStopToken=this._subscribeToGUIEvent(p,e.event_stop);this._registerStepBackwardToken=this._subscribeToGUIEvent(i,e.event_stepBackward);this._registerStepForwardToken=this._subscribeToGUIEvent(j,e.event_stepForward);this._registerCameraToken=this._subscribeToGUIEventWithData(r,e.event_camera);this._registerPreviousMarkerToken=this._subscribeToGUIEvent(m,e.event_previousMarker);this._registerNextMarkerToken=this._subscribeToGUIEvent(q,e.event_nextMarker);this._registerGoToMarkerToken=this._subscribeToGUIEventWithData(n,e.event_goToMarker);this._registerRemoveSelectedTracksToken=this._subscribeToGUIEvent(v,e.event_removeSelectedTracks);this._registerFilterOnSelection=this._subscribeToGUIEventWithData(d,e.event_filterOnSelection);this._registerAutoKeyToken=this._subscribeToGUIEventWithData(l,e.event_autoKey);if(e.displayLoop){this._registerLoopToken=this._subscribeToGUIEventWithData(u,e.event_loop)}if(e.displayBounce){this._registerBounceToken=this._subscribeToGUIEventWithData(g,e.event_bounce)}if(e.displayReverse){this._registerReverseToken=this._subscribeToGUIEventWithData(h,e.event_reverse)}},unInitialize:function(){this._parent();this._unRegisterWUXEvent(this._registerPreviousMarkerToken);this._unRegisterWUXEvent(this._registerNextMarkerToken);this._unRegisterWUXEvent(this._registerGoToMarkerToken);this._unRegisterWUXEvent(this._registerRemoveSelectedTracksToken);this._unRegisterWUXEvent(this._registerFilterOnSelection);this._registerPreviousMarkerToken=0;this._registerNextMarkerToken=0;this._registerGoToMarkerToken=0;this._registerRemoveSelectedTracksToken=0;this._registerFilterOnSelection=0},addMarkers:function(d){this._view._addMarkers(d)},replayAnimation:function(){this.playGUIMode();var d=this._view;if(d.isToolbarDisplayed()&&d.isLoopDisplayed()&&d.getPlayButton()){d.getPlayButton().elements.container.click()}},playGUIMode:function(){var d=this._view;if(d.isToolbarDisplayed()&&d.getPlayButton()){d.getPlayButton().icon="play";d.getPlayButton().checkFlag=false}},pauseGUIMode:function(){var d=this._view;if(d.isToolbarDisplayed()&&d.getPlayButton()){d.getPlayButton().icon="pause";d.getPlayButton().checkFlag=true}},setAnimationLoopMode:function(e){var d=this._view;if(d.isToolbarDisplayed()&&d.getLoopButton()&&d.getLoopButton().checkFlag!==e){d.getLoopButton().checkFlag=e}},setAnimationBounceMode:function(e){var d=this._view;if(d.isToolbarDisplayed()&&d.getBounceButton()&&d.getBounceButton().checkFlag!==e){d.getBounceButton().checkFlag=e}},setAnimationReverseMode:function(e){var d=this._view;if(d.isToolbarDisplayed()&&d.getReverseButton()&&d.getReverseButton().checkFlag!==e){d.getReverseButton().checkFlag=e}},setCameraPlayMode:function(e){var d=this._view;if(d.isToolbarDisplayed()&&d.getCameraButton()&&d.getCameraButton().checkFlag!==e){d.getCameraButton().checkFlag=e}},setAutoKeyMode:function(e){var d=this._view;if(d.isToolbarDisplayed()&&d.getAutoKeyButton()&&d.getAutoKeyButton().checkFlag!==e){d.getAutoKeyButton().checkFlag=e}},setFilterOnSelectionMode:function(e){var d=this._view;if(d.isToolbarDisplayed()&&d.getFilterOnSelectionButton()&&d.getFilterOnSelectionButton().checkFlag!==e){d.getFilterOnSelectionButton().checkFlag=e}},setIndexValue:function(e){var d=this._view;if(this._index===e){return}this._index=e;d.updateModelLocked(true);if(d.isSliderDisplayed()&&d.getSlider()&&d.getSlider().getValue()!==parseInt(e)){d.getSlider().setValue(e)}if(d.isPlayBackDisplayed()&&d.getPlayBack()&&d.getPlayBack().value!=e){d.getPlayBack().value=e}d.updateModelLocked(false)},});return a});define("DS/VCXWebTimeline/VCXWebTimelineMainView",["UWA/Element","DS/Layouts/GridEngine","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Utilities/RAFDispatcher","DS/Utilities/Utils","DS/VisuEvents/EventsManager","DS/Tree/TreeListView","DS/VCXWebTimeline/VCXWebTimelineView","DS/VCXWebTimeline/VCXWebTimelineCustomTreeNodeView","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/Windows/DockingElement"],function(c,n,a,h,g,k,f,p,m,l,j,e,o){function d(s,r){var q=s;if(q){var t=(" "+q.className+" ").replace(/[\n\t]/g," ").indexOf(" "+r+" ")>-1;if(t){return q}else{return d(q.parentNode,r)}}else{return}}function i(r,q){var s=(" "+r.className+" ").replace(/[\n\t]/g," ").indexOf(" "+q+" ")>-1;return s}var b=m.extend({init:function(v){this._parent(v);this._targetedTracks=[];this.options=v;this._modelInterface=this.options.modelInterface;this._modelInterface.setNodeModel(h);this._mousePosY=0;this._mousePosX=0;this._mouseDownPosX=0;this._selectionStart={};this._selectionStart.x=0;this._selectionFromY=0;this._selectionEnd={};this._selectionEnd.x=0;this._selectionToY=0;this._sliderPosition=0;this._sliderPreviousPosition=0;this._cellWidthMin=100;this._cellWidthMax=210;this._cellWidth=this._cellWidthMin;this._cells=[];this._stopPan=false;this._isSliderMinPosition=true;this._delta=0;this._onePixelInTime=0;this._zoomPixels=10;this._currentFrame=0;this._stepTime=1;this._stepTimeMin=v._stepTimeMin||0.1;this._timeMax=parseFloat(this._convertIndexToTime(this._maxFrame));this._fitMode=true;this._treeMode=true;this._listOfRenderedMarkers={};this._listOfFreeMarkers=[];this._markers=[];this._tracksLine=[];this._selectedElement=null;this._timeBarH=0;this._trackH=18;this._timeFrameH=18;this._markerContainerH=20;this._treeW=v.propertiesTreeWidth||150;this._panelBottom=15;var s=["Position","Properties","Viewport","Camera","Digger"];var C=this;if(this._parentNode===null){this._container=this._createContainer("vcx-timeline VCX_TimelineMain_Container");this._parentPanel=this._createPanel(this._frmWindow.getImmersiveFrame(),true,WUXDockAreaEnum.TopDockArea,this._title,this._container,"VCX_TimelineMain_Panel");this._parentNode=this._parentPanel.elements.container}else{this._container=this.options.container}this._headerBarContainer=this._createContainer("headerBarContainer").inject(this._parentNode.firstChild);this._headerBarLeft=this._createContainer("headerBarLeft").inject(this._headerBarContainer);this._headerBarRight=this._createContainer("headerBarRight").inject(this._headerBarContainer);this._fitButton=this._createToggle("switch","Fit",true).inject(this._headerBarRight);this._topContainer=this._createContainer("top");this._topContainerLeft=this._createContainer("topLeft");this._topContainerRight=this._createContainer("topRight").inject(this._topContainer);this._mainContainer=this._createContainer("main").inject(this._container);this._markersContainer=this._createContainer("markersContainer").inject(this._topContainerRight);this._markersHelper=this._createContainer("markersHelper").inject(this._markersContainer);this._markersTooltip=this._createContainer("markersTooltip").inject(this._markersContainer);this._timeFrame=this._createContainer("timeFrame").inject(this._topContainerRight);this._grid=this._createContainer("grid");this._grid.style.position="absolute";this._grid.style.top="40px";this._grid.style.bottom="0px";this._grid.style.right="0px";this._grid.style.left="0px";this._grid.style.backgroundColor="#f1f1f1";this._gridComponentContainer=this._createContainer("gridComponentContainer").inject(this._grid);this._gridComponentContainerRel=this._createContainer("gridComponentContainerRel").inject(this._gridComponentContainer);this._tracksLinesContainer=this._createContainer("tracksLinesContainer").inject(this._grid);this._timeBar=this._createContainer("timeBar");this._timeBarTooltip=this._createContainer("timeBarTooltip wux-controls-popup");this._ghostKey=this._createContainer("ghostKey disable");this.hasSelectedTime=false;this._selectionStart={};this._selectionEnd={};this._selection=this._createContainer("keySelection").inject(this._gridComponentContainerRel);this._selectionBackground=this._createContainer("keySelectionBackground").inject(this._selection);this._selectionTop=this._createContainer("keySelectionTop").inject(this._selection);this._selectionRight=this._createContainer("keySelectionRight").inject(this._selection);this._selectionBottom=this._createContainer("keySelectionBottom").inject(this._selection);this._selectionLeft=this._createContainer("keySelectionLeft").inject(this._selection);this._selectionBottom.style.bottom="-4px";this._selectionRight.style.right="-4px";this._panelW=parseFloat(this._container.clientWidth,10)-this._treeW;this._leftTreeDockingElement=new o({side:WUXDockAreaEnum.LeftDockArea,collapsibleFlag:false,collapseDockingZoneFlag:false,visibleDockingZoneFlag:true,dockingZoneSize:this._treeW});this._dockingAreaContainer=new UWA.Element("div",{styles:{position:"absolute",top:0,bottom:0,left:0,right:0}});this._dockingAreaContainer.inject(this._container);this._leftTreeDockingElement.inject(this._dockingAreaContainer);this._markersContainer.style.height=this._markerContainerH+"px";this._timeFrame.style.height=this._timeFrameH+"px";this._markersHelper.style.height=(this._timeFrameH+2)+"px";this._topContainerLeft.style.height=(this._markerContainerH+this._timeFrameH+2)+"px";this._timeBar.style.top=this._markerContainerH+"px";this._markersHelper.style.top=this._markerContainerH+"px";this._markersTooltip.style.top=(this._markerContainerH+13)+"px";this._markersHelper.style.display="none";this._markersTooltip.style.display="none";this._topContainerLeft.style.backgroundColor="#f1f1f1";for(var J=0;J<10;J++){this._tracksLine[J]=this._createContainer("trackLine").inject(this._tracksLinesContainer);this._tracksLine[J].style.height=this._trackH+"px"}for(var J=0;J<=2*(this._panelW/this._cellWidthMin)+1;J++){this._cells[J]=this._createContainer("cell").inject(this._timeFrame);this._createContainer("").inject(this._cells[J]);var K=this._createContainer("separator").inject(this._cells[J]);this._createContainer("line").inject(this._cells[J]);var w;for(var I=0;I<10;I++){w=(I==4)?"middle":"small";this._createContainer(w).inject(K)}}this._cellsNumber=this._cells.length;this._zoomCB=k.throttle(function(N){C.zoom(N)},40);this._panCB=k.throttle(function(N){C.pan(N)},30);this._panEndCB=function(N){C.panEnd(N)};this._gridMouseDownCB=function(N){C.gridMouseDown(N)};this._gridMouseRightClickCB=function(N){C.gridMouseRightClick(N)};this._keySelectionStartCB=function(N){C.keySelectionStart(N)};this._keySelectionWhileCB=function(N){C.keySelectionWhile(N)};this._keySelectionEndCB=function(N){C.keySelectionEnd(N)};this._leftBorderDownSelectionCB=function(N){C.leftBorderDownSelection(N)};this._rightBorderDownSelectionCB=function(N){C.rightBorderDownSelection(N)};this._topBorderDownSelectionCB=function(N){C.topBorderDownSelection(N)};this._bottomBorderDownSelectionCB=function(N){C.bottomBorderDownSelection(N)};this._leftBorderMoveSelectionCB=function(N){C.leftBorderMoveSelection(N)};this._rightBorderMoveSelectionCB=function(N){C.rightBorderMoveSelection(N)};this._topBorderMoveSelectionCB=function(N){C.topBorderMoveSelection(N)};this._bottomBorderMoveSelectionCB=function(N){C.bottomBorderMoveSelection(N)};this._leftBorderUpSelectionCB=function(N){C.leftBorderUpSelection(N)};this._rightBorderUpSelectionCB=function(N){C.rightBorderUpSelection(N)};this._topBorderUpSelectionCB=function(N){C.topBorderUpSelection(N)};this._bottomBorderUpSelectionCB=function(N){C.bottomBorderUpSelection(N)};var G=C._selection;var F="2px";var y="1px";this._leftBorderEnterCB=function(N){G.style.borderLeftWidth=F};this._rightBorderEnterCB=function(N){G.style.borderRightWidth=F};this._topBorderEnterCB=function(N){G.style.borderTopWidth=F};this._bottomBorderEnterCB=function(N){G.style.borderBottomWidth=F};this._leftBorderLeaveCB=function(N){G.style.borderLeftWidth=y};this._rightBorderLeaveCB=function(N){G.style.borderRightWidth=y};this._topBorderLeaveCB=function(N){G.style.borderTopWidth=y};this._bottomBorderLeaveCB=function(N){G.style.borderBottomWidth=y};this._selectionDragStartCB=function(N){C._selection.cacheTimeStart=C._selectionStart.x;C._selection.cacheTimeEnd=C._selectionEnd.x;C._selection.cacheClientX=N.clientX;N.preventDefault();N.stopImmediatePropagation();C._selection.addEventListener(j.POINTERUP,C._selectionDragEndCB);C._selection.addEventListener(j.POINTERMOVE,C._selectionDragWhileCB)};this._selectionDragWhileCB=function(P){var N=P.clientX-C._selection.cacheClientX;var O=C.getTimeFromPixel(N);C._selectionStart.x=C._selection.cacheTimeStart+O;C._selectionEnd.x=C._selection.cacheTimeEnd+O;C.drawRectangle(C._selectionStart,C._selectionEnd);P.preventDefault();P.stopImmediatePropagation()};this._selectionDragEndCB=function(O){O.preventDefault();O.stopImmediatePropagation();C._selection.removeEventListener(j.POINTERMOVE,C._selectionDragWhileCB);C._selection.removeEventListener(j.POINTERUP,C._selectionDragEndCB);var N={};N.tracks=C._targetedTracks;N.timeInitStart=C._selection.cacheTimeStart;N.timeInitEnd=C._selection.cacheTimeEnd;N.timeFinalStart=C._selectionStart.x;N.timeFinalEnd=C._selectionEnd.x;N.timeToFrame=C.getFrameFromTime(1);N.scenarioID=C.options.scenario;C._sendEvent(C.options.event_selectionAreaMove,N)};this._timeBarMouseOverCB=function(N){C.timeBarMouseOver(N)};this._timeBarMouseLeaveCB=function(N){C.timeBarMouseLeave(N)};this._timeBarMouseDownCB=k.throttle(function(N){C.timeBarMouseDown(N)},30);this._timeBarMouseMoveCB=k.throttle(function(N){C.timeBarMouseMove(N)},30);this._timeBarMouseUpCB=function(N){C.timeBarMouseUp(N)};this._timeBarUpdatePositionCB=function(N){C.timeBarUpdatePosition(N)};this._timeFrameMouseDownCB=function(N){C.timeFrameMouseDown(N)};this._panelWCB=k.throttle(function(N){C.displayFromTo(0,C._timeMax,N)},40);this.panelListener(this);this._keyMouseMoveCB=function(N){C.keyMouseMove(N)};this._keyMoveMouseUpCB=function(N){C.keyMoveMouseUp(N)};this._keyCopyMouseUpCB=function(N){C.keyCopyMouseUp(N)};this._markerMouseDownCB=function(N){C.markerMouseDown(N)};this._markerMouseMoveCB=function(N){C.markerMouseMove(N)};this._markerMouseUpCB=function(N){C.markerMouseUp(N)};this._markerCancelOrRemoveCB=function(N){C.markerCancelOrRemove(N)};this._fitCB=function(N){C._fitMode=N.dsModel.checkFlag;if(C._fitMode){C._sliderPosition=0;C.displayFromTo(0,C._timeMax);C.selectionHide()}};this._cancelOrRemoveCB=function(N){C.cancelOrRemove(N)};this._wheelEvt="onwheel" in document.createElement("div")?"wheel":document.onmousewheel!==undefined?"mousewheel":"DOMMouseScroll";this._timeBar.addEventListener(this._wheelEvt,this._zoomCB);this._timeBar.addEventListener(j.POINTERDOWN,this._timeBarMouseDownCB);this._timeBar.addEventListener("mouseover",this._timeBarMouseOverCB);this._timeBar.addEventListener("mouseleave",this._timeBarMouseLeaveCB);this._timeFrame.addEventListener(this._wheelEvt,this._zoomCB);this._timeFrame.addEventListener(j.POINTERDOWN,this._timeFrameMouseDownCB);this._gridComponentContainerRel.addEventListener(this._wheelEvt,this._zoomCB);this._gridComponentContainerRel.addEventListener(j.POINTERDOWN,this._gridMouseDownCB);f.addEvent(this._gridComponentContainerRel,"onRightClick",this._gridMouseRightClickCB);this._fitButton.addEventListener("buttonclick",this._fitCB);this._selectionTop.addEventListener("mouseenter",this._topBorderEnterCB);this._selectionRight.addEventListener("mouseenter",this._rightBorderEnterCB);this._selectionBottom.addEventListener("mouseenter",this._bottomBorderEnterCB);this._selectionLeft.addEventListener("mouseenter",this._leftBorderEnterCB);this._selectionTop.addEventListener("mouseleave",this._topBorderLeaveCB);this._selectionRight.addEventListener("mouseleave",this._rightBorderLeaveCB);this._selectionBottom.addEventListener("mouseleave",this._bottomBorderLeaveCB);this._selectionLeft.addEventListener("mouseleave",this._leftBorderLeaveCB);this._selection.addEventListener(j.POINTERDOWN,this._selectionDragStartCB);var r={apiVersion:2,height:"auto",defaultCellHeight:this._trackH,show:{rowHeaders:false,columnHeaders:false},columns:[{text:"setKey",dataIndex:"setKey",width:20}],expanderStyle:"triangle",selection:{preSelection:true,nodes:true,canMultiSelect:true,enableListSelection:true,toggle:false},cellClass:l,};this._trackTreeListViewTracks=new p(r);this._trackTreeListViewTracks.onNodeClick(function(O){if(O.dataIndex==="setKey"){var N={};N.trackId=O.nodeModel.options.id;C._sendEvent(C.options.event_addTracksKey,N)}});r.columns=[{text:"Type",dataIndex:"type",width:"auto"}];this._trackTreeListViewTracksRight=new p(r);this._trackTreeListViewTracksRight.getManager().hideColumn(0);this._trackTreeListViewTracks.getContent().setStyles({zIndex:10});var M=new UWA.Element("div",{});var q=new UWA.Element("div",{styles:{position:"absolute",height:40,left:0,top:0,width:"100%",backgroundColor:"#f1f1f1"}});var x=new UWA.Element("div",{"class":"vcx-tracks",styles:{position:"absolute",top:40,bottom:0,left:0,right:0}});q.inject(M);x.inject(M);this._trackTreeListViewTracks.inject(x);this._leftTreeDockingElement.dockingZoneContent=M;var H=new UWA.Element("div",{styles:{position:"absolute",width:"100%",height:"100%",left:"5px"}});this._trackTreeListViewTracksRight.inject(this._gridComponentContainerRel);this._timeBarTooltip.inject(H);this._timeBar.inject(H);this._topContainer.inject(H);this._grid.inject(H);this._leftTreeDockingElement.freeZoneContent=H;var B=this._trackTreeListViewTracks.getManager();var u;var t;var A;var L=0,E=0,D=-1;this._timelineTreeDocument=new a({});this._timelineTreeDocument.lock=0;this._timelineTreeDocument.prepareUpdate();this._modelInterface.generateTracksData(this._timelineTreeDocument);this._timelineTreeDocument.pushUpdate();this._trackTreeListViewTracks.getManager().loadDocument(this._timelineTreeDocument);this._trackTreeListViewTracksRight.getManager().loadDocument(this._timelineTreeDocument);this._displayedTracks=this.getDisplayedTracks();this._bigData=this._modelInterface._generateGridData(this._displayedTracks,this._maxFrame);this.grid=new n({model:this._bigData,showRowsHeader:false,showColumnsHeader:false,defaultCellWidth:this._cellWidth,defaultCellHeight:this._trackH,headersDimensions:{width:40,height:20},height:"auto",performances:{useRequestAnimationFrameRendering:true}}).inject(this._gridComponentContainerRel);this.grid.onCellRequest(function(N){});this.grid.onReady(function(){if(C.isVisible()===false){return}C.updatePanelHeight();C.updateTracksLine();C.displayFromTo(0,C._timeMax)});C._trackTreeListViewTracks.getManager().onReady(function(){if(!(C&&C._trackTreeListViewTracks)){return}C._trackTreeListViewTracks.getManager().getScroller().onScroll(function(){var N={x:C.grid.getScrollerPosition().x,y:C._trackTreeListViewTracks.getManager().getScrollerPosition().y};C.grid.setScrollerPosition(N,true);C._trackTreeListViewTracksRight.getManager().getScroller().setPosition(N,true)});C._trackTreeListViewTracks.getManager().getScroller().onScrollEnd(function(){var N={x:C.grid.getScrollerPosition().x,y:C._trackTreeListViewTracks.getManager().getScrollerPosition().y};C.grid.setScrollerPosition(N,true);C._trackTreeListViewTracksRight.getManager().getScroller().setPosition(N,true)})});this._markersLayer=this._createContainer("keys-layer").inject(this.grid.elements.poolContainerRel);this._ghostKey.inject(this._markersLayer);this._tracksTreeDocument=new a({shouldBeEditable:function(N){return false}});this._timelineTreeDocument.updateNumberTracksDisplayed=function(){C.updateNumberTracksDisplayed()};this._timelineTreeDocument.getXSO().onChange(function(){if(C._timelineTreeDocument.getXSO().get().length>0){var N=C._timelineTreeDocument.getXSO().get()[0]}});if(this._parentPanel){C._parentPanel.onExpandPanel=function(){if(C._parentPanel){C._parentPanel.onRedrawLauncher();e.publish({event:"VCX_Timeline_AutoKey",data:true})}};C._parentPanel.onCollapsePanel=function(){if(C._parentPanel){e.publish({event:"VCX_Timeline_AutoKey",data:false})}};C._parentPanel.onRedrawLauncher=function(){C.updateOnePixel();C.updateTimeBar(C._currentFrame);C.updateMarkersPosition();C.onRedraw()}}var z=this._parentPanel.immersiveFrame.getDockingElement(this._parentPanel.currentDockArea);if(z){z.addEventListener("expand",C._parentPanel.onExpandPanel.bind(C));z.addEventListener("collapse",C._parentPanel.onCollapsePanel)}this._timelineTreeDocument.dirty=true;this._trackTreeListViewTracks.getManager().onPostUpdateView(C._parentPanel.onRedrawLauncher)},unInitialize:function(){if(this._parentPanel){var s=this._parentPanel.immersiveFrame.getDockingElement(this._parentPanel.currentDockArea);if(s){s.removeEventListener("expand",this._parentPanel.onRedrawLauncher)}}this._parent();this._timeFrame.removeEventListener(this._wheelEvt,this._zoomCB);this._timeFrame.removeEventListener(j.POINTERDOWN,this._timeFrameMouseDownCB);this._timeBar.removeEventListener(j.POINTERDOWN,this._timeBarMouseDownCB);this._timeBar.removeEventListener("mouseover",this._timeBarMouseOverCB);this._timeBar.removeEventListener("mouseleave",this._timeBarMouseLeaveCB);this._timeBar.removeEventListener(this._wheelEvt,this._zoomCB);this._selectionTop.removeEventListener("mouseenter",this._topBorderEnterCB);this._selectionRight.removeEventListener("mouseenter",this._rightBorderEnterCB);this._selectionBottom.removeEventListener("mouseenter",this._bottomBorderEnterCB);this._selectionLeft.removeEventListener("mouseenter",this._leftBorderEnterCB);this._selectionTop.removeEventListener("mouseleave",this._topBorderLeaveCB);this._selectionRight.removeEventListener("mouseleave",this._rightBorderLeaveCB);this._selectionBottom.removeEventListener("mouseleave",this._bottomBorderLeaveCB);this._selectionLeft.removeEventListener("mouseleave",this._leftBorderLeaveCB);this._selection.removeEventListener(j.POINTERDOWN,this._selectionDragStartCB);this._gridComponentContainerRel.removeEventListener(this._wheelEvt,this._zoomCB);this._gridComponentContainerRel.removeEventListener(j.POINTERDOWN,this._timeFrameMouseDownCB);this._fitButton.elements.buttonSwitch.removeEventListener("buttonclick",this._fitCB);this._zoomCB=0;this._panCB=0;this._panEndCB=0;this._timeFrameMouseDownCB=0;this._panelWCB=0;this._timeBarMouseOverCB=0;this._timeBarMouseLeaveCB=0;this._timeBarMouseDownCB=0;this._timeBarMouseMoveCB=0;this._timeBarMouseUpCB=0;this._timeBarUpdatePositionCB=0;this._keyMouseMoveCB=0;this._keyMoveMouseUpCB=0;this._keyCopyMouseUpCB=0;this._cancelOrRemoveCB=0;this._fitCB=0;this._markerMouseDownCB=0;this._markerMouseMoveCB=0;this._markerMouseUpCB=0;this._markerCancelOrRemoveCB=0;this._keySelectionStartCB=0;this._keySelectionWhileCB=0;this._keySelectionEndCB=0;this._leftBorderEnterCB=0;this._rightBorderEnterCB=0;this._topBorderEnterCB=0;this._bottomBorderEnterCB=0;this._leftBorderLeaveCB=0;this._rightBorderLeaveCB=0;this._topBorderLeaveCB=0;this._bottomBorderLeaveCB=0;this._leftBorderDownSelectionCB=0;this._rightBorderDownSelectionCB=0;this._topBorderDownSelectionCB=0;this._bottomBorderDownSelectionCB=0;this._leftBorderMoveSelectionCB=0;this._rightBorderMoveSelectionCB=0;this._topBorderMoveSelectionCB=0;this._bottomBorderMoveSelectionCB=0;this._leftBorderUpSelectionCB=0;this._rightBorderUpSelectionCB=0;this._topBorderUpSelectionCB=0;this._bottomBorderUpSelectionCB=0;if(this._timelineTreeDocument._cleanBindingOnDocument){this._timelineTreeDocument._cleanBindingOnDocument()}else{if(this._timelineTreeDocument._cleanBindings){this._timelineTreeDocument._cleanBindings()}}this._timelineTreeDocument.empty();this._timelineTreeDocument=null;this._trackTreeListViewTracks.getManager().unloadDocument();this._trackTreeListViewTracks=null;this.grid=null;if(this.tree){var r=this.tree.getDocument();if(r._cleanBindingOnDocument){r._cleanBindingOnDocument()}else{if(r._cleanBindings){r._cleanBindings()}}r.empty();var u=this.tree.getManager();u.unloadDocument();this.tree.destroy();r.options=r.defaultOptions;u.options=u.defaultOptions;this.tree.options=this.tree.defaultOptions;this.tree=null}this._targetedTracks=null;this.options=null;this._modelInterface=null;this._selectionStart=null;this._selectionEnd=null;this._cells=null;this._listOfRenderedMarkers=null;this._listOfFreeMarkers=null;this._markers=null;this._selectedElement=null;var t=null;this._container&&this._container.destroy();this._parentNode&&this._parentNode.destroy();this._headerBarContainer&&this._headerBarContainer.destroy();this._headerBarLeft&&this._headerBarLeft.destroy();this._headerBarRight&&this._headerBarRight.destroy();this._container=null;this._parentNode=null;this._headerBarContainer=null;this._headerBarLeft=null;this._headerBarRight=null;this._fitButton&&this._fitButton.destroy();this._fitButton=null;this._topContainer&&this._topContainer.destroy();this._topContainerLeft&&this._topContainerLeft.destroy();this._topContainerRight&&this._topContainerRight.destroy();this._mainContainer&&this._mainContainer.destroy();this._topContainer=null;this._topContainerLeft=null;this._topContainerRight=null;this._mainContainer=null;this._markersContainer&&this._markersContainer.destroy();this._markersHelper&&this._markersHelper.destroy();this._markersTooltip&&this._markersTooltip.destroy();this._timeFrame&&this._timeFrame.destroy();this._markersContainer=null;this._markersHelper=null;this._markersTooltip=null;this._timeFrame=null;this._grid&&this._grid.destroy();this._gridComponentContainer&&this._gridComponentContainer.destroy();this._gridComponentContainerRel&&this._gridComponentContainerRel.destroy();this._grid=null;this._gridComponentContainer=null;this._gridComponentContainerRel=null;this._timeBar&&this._timeBar.destroy();this._timeBarTooltip&&this._timeBarTooltip.destroy();this._timeBar=null;this._timeBarTooltip=null;this._ghostKey&&this._ghostKey.destroy();this._ghostKey=null;this._selection&&this._selection.destroy();this._selectionBackground&&this._selectionBackground.destroy();this._selectionTop&&this._selectionTop.destroy();this._selectionRight&&this._selectionRight.destroy();this._selectionBottom&&this._selectionBottom.destroy();this._selectionLeft&&this._selectionLeft.destroy();this._selection=null;this._selectionBackground=null;this._selectionTop=null;this._selectionRight=null;this._selectionBottom=null;this._selectionLeft=null;var q=0;if(this._cells){for(q=0;q<this._cells.length;++q){this._cells[q].destroy()}}if(this._tracksLine){for(q=0;q<this._tracksLine.length;++q){this._tracksLine[q].destroy()}this._tracksLinesContainer&&this._tracksLinesContainer.destroy();this._tracksLine=null;this._tracksLinesContainer=null}this._leftTreeDockingElement&&this._leftTreeDockingElement.destroy();this._dockingAreaContainer&&this._dockingAreaContainer.destroy();this._leftTreeDockingElement=null;this._dockingAreaContainer=null},panelListener:function(q){this._mutationTarget=this._parentNode.firstChild;this._observer=new MutationObserver(function(r){r.forEach(function(u){if(u.target===q._mutationTarget){var s=parseInt(u.oldValue.match(/\d+/)[0]);var v=parseInt(q._mutationTarget.style.width.match(/\d+/)[0]);if(s!==v){var t=v>=s;q._panelW=q._parentNode.clientWidth-q._treeW;if(q._panelW>0&&q._fitMode){q._panelWCB(t)}}}})});this._observerConfig={attributes:true,childList:false,characterData:false,subtree:false,attributeOldValue:true,attributeFilter:["style"]};if(this._mutationTarget){this._observer.observe(this._mutationTarget,this._observerConfig)}},updatePanelHeight:function(){var q=this.getDisplayedTracks()*this._trackH+this._timeFrameH+this._markerContainerH+this._panelBottom;if(this._parentNode&&this._parentNode.parentNode===null){return}},updateTimeFrame:function(u){this._delta+=u;this._delta=parseFloat(this._delta.toFixed(1));for(var q=0;q<this._cellsNumber;q++){this._cells[q].style.left=(parseFloat(this._cells[q].style.left,10)+u)+"px"}var r=this._delta==0||Math.abs(this._delta)>=this._cellWidth;if(r){this._delta%=this._cellWidth;this._delta=parseFloat(this._delta.toFixed(1));var s=this._delta-this._cellWidth;var t=this.getTimeFromPixel(this._sliderPosition+s);t=Math.round(t/this._stepTime)*this._stepTime;this.updateCells(t,s)}},timeFrameMouseDown:function(s){this._mousePosX=s.clientX;this._mouseDownPosX=s.clientX;this._sliderPreviousPosition=this._sliderPosition;var q=s.clientX-this._timeFrame.getBoundingClientRect().left;if(s.which===2){this.setFitMode(false);document.addEventListener(j.POINTERMOVE,this._panCB);document.addEventListener(j.POINTERUP,this._panEndCB)}else{if(s.which===1){this._timeBar.classList.add("timeBarTransition");this._timeBarTooltip.style.display="inline-block";var r=this.getTimeFromPixel(this._sliderPosition+q);var t=parseInt(Math.round(this.getFrameFromTime(r)));this._sendEvent(this.options.event_timePosChangeWhile,t);document.addEventListener(j.POINTERMOVE,this._timeBarMouseMoveCB);document.addEventListener(j.POINTERUP,this._timeBarMouseUpCB)}}},pan:function(t){if(this._isSliderMinPosition&&this._mouseDownPosX<=t.clientX){this._stopPan=true;return}this._mousePosX=this._stopPan?this._mouseDownPosX:this._mousePosX;var u=t.clientX-this._mousePosX;var s=u>0;this._mousePosX=t.clientX;this._stopPan=false;this._isSliderMinPosition=s?this._isSliderMinPosition:false;this._sliderPosition=this._sliderPreviousPosition+(this._mouseDownPosX-this._mousePosX);this._sliderPosition=parseFloat(this._sliderPosition.toFixed(1));if(this._sliderPosition<=0){this._isSliderMinPosition=true;u+=this._sliderPosition;this._sliderPosition=0}this.updateTimeFrame(u);this.updateTimeBar(this._currentFrame);this.updateMarkersPosition();this.updateGrid();if(this.hasSelectedTime){var r={x:this._selectionStart.x,y:this._selectionFromY};var q={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(r,q)}},panEnd:function(q){document.removeEventListener(j.POINTERMOVE,this._panCB);document.removeEventListener(j.POINTERUP,this._panEndCB)},zoom:function(C){this.setFitMode(false);if(C.type==="mousewheel"){C.deltaY=-C.wheelDelta}var B=C.deltaY<=0;if(B){this._isSliderMinPosition=false}var F=(this._stepTime<=this._stepTimeMin)&&(this._cellWidth==this._cellWidthMax&&B);if(F){return}var z=C.clientX-this._timeFrame.getBoundingClientRect().left;var r=this._delta>0?this._cellWidth-this._delta:-this._delta;var s=(z+r)%this._cellWidth;var q=parseFloat(this.getTimeFromPixel(this._sliderPosition+z).toFixed(3));if(q<0.3){q=0}var y=(B&&this._cellWidth>=this._cellWidthMax)||(!B&&this._cellWidth<=this._cellWidthMin);if(y){if(!B&&this._isSliderMinPosition){q=0}else{var E=(q%this._stepTime);var x=q-E;var v=z-this.getPixelFromTime(E)}this._stepTime=this.updateStepTime(this._stepTime,B);this._cellWidth=B?this._cellWidthMin:this._cellWidthMax}else{var v=z-s;var x=this.getTimeFromPixel(this._sliderPosition+v);x=Math.round(x/this._stepTime)*this._stepTime;this._cellWidth+=B?this._zoomPixels:-this._zoomPixels;if(!B&&this._isSliderMinPosition){v-=5}else{var A=parseFloat((s/this._cellWidth).toFixed(2));var u=Math.round(this._zoomPixels*A);v+=B?-u:u}}this._sliderPosition=Math.round((this.getPixelFromTime(q)-z));if(this._sliderPosition<=0){this._sliderPosition=0;this._delta=0;this._isSliderMinPosition=true;x=-this._stepTime;v=-this._cellWidth}else{this._delta=this._cellWidth-(this._sliderPosition%this._cellWidth)}if(v>=0){var w=Math.ceil(v/this._cellWidth);v-=w*this._cellWidth;x=x-w*this._stepTime}v=Math.round(v);this.updateOnePixel();this.updateTimeBar(this._currentFrame);this.updateMarkersPosition();this.updateCells(x,v);this.updateGrid();if(this.hasSelectedTime){var D={x:this._selectionStart.x,y:this._selectionFromY};var t={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(D,t)}},selectionHide:function(){this.hasSelectedTime=false;this._selectionStart={};this._selectionEnd={};this._selection.style.opacity="0";this._selection.style.pointerEvents="none";this._selectionTop.style.opacity="0";this._selectionBottom.style.opacity="0";this._selectionLeft.style.opacity="0";this._selectionRight.style.opacity="0"},selectionShow:function(){this.hasSelectedTime=true;this._selection.style.opacity="1";this._selection.style.pointerEvents=""},gridMouseDown:function(s){this.getTrackTreeListView().getManager().unselectAll();this._mousePosY=s.clientY;this._mousePosX=s.clientX;this._mouseDownPosX=s.clientX;this._sliderPreviousPosition=this._sliderPosition;if(s.which===2){this.setFitMode(false);document.addEventListener(j.POINTERMOVE,this._panCB);document.addEventListener(j.POINTERUP,this._panEndCB)}else{if(s.which===1){this.selectionHide();if(s.path&&s.path[0].hasClassName("key")){var r=s.path[0];s.stopPropagation();var q=this;q._selectedElement=r;q._ghostKey.classList.remove("disable");q._selectedElement.markerModel.select(true);q._selectedElement.style.opacity=0.4;q._ghostKey.style.cssText=document.defaultView.getComputedStyle(r,"").cssText;document.addEventListener(j.POINTERMOVE,q._keyMouseMoveCB);document.addEventListener("keydown",q._cancelOrRemoveCB);if(s.ctrlKey||s.shiftKey){document.addEventListener(j.POINTERUP,q._keyCopyMouseUpCB)}else{document.addEventListener(j.POINTERUP,q._keyMoveMouseUpCB)}}else{document.addEventListener(j.POINTERUP,this._timeBarUpdatePositionCB);document.addEventListener(j.POINTERMOVE,this._keySelectionStartCB)}}else{if(s.eventType==="@onRightClickEvent"){}}}},gridMouseRightClick:function(s){if(s.from&&s.from[0].path&&s.from[0].path[0].hasClassName("key")){var r=s.from[0].path[0];var q=this;q._selectedElement=r;this._actionsOnKeys(s.from[0].event,"delete")}},keySelectionStart:function(s){document.removeEventListener(j.POINTERUP,this._timeBarUpdatePositionCB);document.removeEventListener(j.POINTERMOVE,this._keySelectionStartCB);document.addEventListener(j.POINTERMOVE,this._keySelectionWhileCB);document.addEventListener(j.POINTERUP,this._keySelectionEndCB);var r=s.clientX-this._timeFrame.getBoundingClientRect().left;var q=this.getTimeFromPixel(this._sliderPosition+r);this._selectionStart.x=q;this._selectionFromY=s.clientY;this.selectionShow();this._targetedTracks=[]},keySelectionWhile:function(t){this._selectionFromY=(this._mousePosY<=t.clientY)?this._mousePosY:t.clientY;this._selectionToY=(this._mousePosY<=t.clientY)?t.clientY:this._mousePosY;var s=t.clientX-this._timeFrame.getBoundingClientRect().left;var u=this.getTimeFromPixel(this._sliderPosition+s);this._selectionEnd.x=u;var r={x:this._selectionStart.x,y:this._selectionFromY};var q={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(r,q)},drawRectangle:function(z,u){z.x=Math.max(0,z.x);var q=this._timeFrame.getBoundingClientRect().top;var E=z.y-q-this._timeFrameH;var C=u.y-q-this._timeFrameH;if(E<0){E=0}else{if(C>(this._displayedTracks*this._trackH)){C=this._displayedTracks*this._trackH}}var y=Math.max(0,parseInt(Math.round(this.getFrameFromTime(z.x))));var s=this.getTimeFromFrame(y);var w=this.getPixelFromTime(s)-this._sliderPosition;var B=Math.max(0,parseInt(Math.round(this.getFrameFromTime(u.x))));var v=this.getTimeFromFrame(B);var D=this.getPixelFromTime(v)-this._sliderPosition;if(z.y<=u.y){z.y=Math.floor(E/this._trackH)*this._trackH;u.y=Math.ceil(C/this._trackH)*this._trackH}else{z.y=Math.ceil(E/this._trackH)*this._trackH;u.y=Math.floor(C/this._trackH)*this._trackH}var t=(Math.min(w,D));var x=Math.min(z.y,u.y);var r=Math.abs(w-D);var A=Math.abs(z.y-u.y);this._selection.style.width=r+"px";this._selection.style.height=A+"px";this._selection.style.left=t+"px";this._selection.style.top=x+"px";this.displayBars(t,x,r,A);z.y=this._selectionFromY;u.y=this._selectionToY;this._selectionStart=z;this._selectionEnd=u},displayBars:function(u,t,s,q){var r=4},keySelectionEnd:function(s){var t=Math.min(this._selectionStart.x,this._selectionEnd.x);var q=Math.max(this._selectionStart.x,this._selectionEnd.x);this._selectionStart.x=t;this._selectionEnd.x=q;document.removeEventListener(j.POINTERMOVE,this._keySelectionWhileCB);document.removeEventListener(j.POINTERUP,this._keySelectionEndCB);this._selectionLeft.addEventListener(j.POINTERDOWN,this._leftBorderDownSelectionCB);this._selectionRight.addEventListener(j.POINTERDOWN,this._rightBorderDownSelectionCB);this._selectionTop.addEventListener(j.POINTERDOWN,this._topBorderDownSelectionCB);this._selectionBottom.addEventListener(j.POINTERDOWN,this._bottomBorderDownSelectionCB);this.findTargetedTracks(this._selectionStart,this._selectionEnd);var r={};r.tracks=this._targetedTracks;r.frameStart=this._selectionStart.x;r.frameEnd=this._selectionEnd.x;this._sendEvent(this.options.event_selectionArea,r)},leftBorderDownSelection:function(q){q.stopPropagation();document.addEventListener(j.POINTERMOVE,this._leftBorderMoveSelectionCB);document.addEventListener(j.POINTERUP,this._leftBorderUpSelectionCB);this._selection.cacheTimeStart=this._selectionStart.x;this._selection.cacheTimeEnd=this._selectionEnd.x},rightBorderDownSelection:function(q){q.stopPropagation();document.addEventListener(j.POINTERMOVE,this._rightBorderMoveSelectionCB);document.addEventListener(j.POINTERUP,this._rightBorderUpSelectionCB);this._selection.cacheTimeStart=this._selectionStart.x;this._selection.cacheTimeEnd=this._selectionEnd.x},topBorderDownSelection:function(q){q.stopPropagation();document.addEventListener(j.POINTERMOVE,this._topBorderMoveSelectionCB);document.addEventListener(j.POINTERUP,this._topBorderUpSelectionCB)},bottomBorderDownSelection:function(q){q.stopPropagation();document.addEventListener(j.POINTERMOVE,this._bottomBorderMoveSelectionCB);document.addEventListener(j.POINTERUP,this._bottomBorderUpSelectionCB)},leftBorderMoveSelection:function(s){this._selectionStart.x=this.getTimeFromPixel(s.clientX-this._timeFrame.getBoundingClientRect().left+this._sliderPosition);var r={x:this._selectionStart.x,y:this._selectionFromY};var q={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(r,q)},rightBorderMoveSelection:function(s){this._selectionEnd.x=this.getTimeFromPixel(s.clientX-this._timeFrame.getBoundingClientRect().left+this._sliderPosition);var r={x:this._selectionStart.x,y:this._selectionFromY};var q={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(r,q)},topBorderMoveSelection:function(s){if(s.clientY<this._selectionToY){this._selectionFromY=s.clientY}else{this._selectionFromY=this._selectionToY;this._selectionToY=s.clientY}var r={x:this._selectionStart.x,y:this._selectionFromY};var q={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(r,q)},bottomBorderMoveSelection:function(s){if(s.clientY>this._selectionFromY){this._selectionToY=s.clientY}else{this._selectionToY=this._selectionFromY;this._selectionFromY=s.clientY}var r={x:this._selectionStart.x,y:this._selectionFromY};var q={x:this._selectionEnd.x,y:this._selectionToY};this.drawRectangle(r,q)},leftBorderUpSelection:function(s){document.removeEventListener(j.POINTERMOVE,this._leftBorderMoveSelectionCB);document.removeEventListener(j.POINTERUP,this._leftBorderUpSelectionCB);var t=Math.min(this._selectionStart.x,this._selectionEnd.x);var q=Math.max(this._selectionStart.x,this._selectionEnd.x);this._selectionStart.x=t;this._selectionEnd.x=q;var r={};r.tracks=this._targetedTracks;r.timeInitStart=this._selection.cacheTimeStart;r.timeInitEnd=this._selection.cacheTimeEnd;r.timeFinalStart=this._selectionStart.x;r.timeFinalEnd=this._selectionEnd.x;r.timeToFrame=this.getFrameFromTime(1);r.scenarioID=this.options.scenario;this._sendEvent(this.options.event_selectionAreaMove,r)},rightBorderUpSelection:function(s){document.removeEventListener(j.POINTERMOVE,this._rightBorderMoveSelectionCB);document.removeEventListener(j.POINTERUP,this._rightBorderUpSelectionCB);var t=Math.min(this._selectionStart.x,this._selectionEnd.x);var q=Math.max(this._selectionStart.x,this._selectionEnd.x);this._selectionStart.x=t;this._selectionEnd.x=q;var r={};r.tracks=this._targetedTracks;r.timeInitStart=this._selection.cacheTimeStart;r.timeInitEnd=this._selection.cacheTimeEnd;r.timeFinalStart=this._selectionStart.x;r.timeFinalEnd=this._selectionEnd.x;r.timeToFrame=this.getFrameFromTime(1);r.scenarioID=this.options.scenario;this._sendEvent(this.options.event_selectionAreaMove,r)},topBorderUpSelection:function(q){document.removeEventListener(j.POINTERMOVE,this._topBorderMoveSelectionCB);document.removeEventListener(j.POINTERUP,this._topBorderUpSelectionCB)},bottomBorderUpSelection:function(q){document.removeEventListener(j.POINTERMOVE,this._bottomBorderMoveSelectionCB);document.removeEventListener(j.POINTERUP,this._bottomBorderUpSelectionCB)},findTargetedTracks:function(t,q){var w=Math.min(t.y,q.y);var v=Math.max(t.y,q.y)+2;var u=this._trackTreeListViewTracks._datagrid.options.defaultCellHeight;var r=null;for(var s=w;s<=v;s+=1){var x=this.getTrackNodeModelFromPosition({x:parseInt(this.getPixelFromTime(this.getTimeFromFrame(t.x))),y:s});if(x&&this._targetedTracks.indexOf(x)==-1){if(x._rowID==4&&!x._isExpanded){r=x;continue}this._targetedTracks.push(x)}}if(r){this._targetedTracks.push.apply(this._targetedTracks,r._options.children)}},selectTracks:function(q){},getTrackNodeModelFromPosition:function(r){var u=this._trackTreeListViewTracks._datagrid.elements.container.getBoundingClientRect();var q=document.elementFromPoint(u.left+(u.right-u.left)*0.5,r.y);var s=i(q,"wux-datagrid-cell")?q:d(q,"wux-datagrid-cell");if(typeof(s)==="undefined"){return null}var t=this._trackTreeListViewTracks._datagrid._cellsManager._getCellInfosFromDom(s,true);var v=t.nodeModel;return v},geTracksNodeModelFromSelection:function(){},timeBarUpdatePosition:function(s){var q=s.clientX-this._timeFrame.getBoundingClientRect().left;var r=this.getTimeFromPixel(this._sliderPosition+q);var t=parseInt(Math.round(this.getFrameFromTime(r)));this._sendEvent(this.options.event_timePosChangeWhile,t);document.removeEventListener(j.POINTERUP,this._timeBarUpdatePositionCB);document.removeEventListener(j.POINTERMOVE,this._keySelectionStartCB)},updateVerticalGridSeparatorHeight:function(){var r=this._timeFrame.querySelectorAll(".line");var q=this._displayedTracks*this._trackH;for(var s=0;s<r.length;s++){r[s].style.height=q+"px"}},keyMouseMove:function(r){var q=this._scrollTimelineOnX(r,"key");this.updatePosition(q,this._ghostKey)},keyMoveMouseUp:function(q){this._selectedElement.markerModel.selected=false;this._ghostKey.classList.add("disable");this._actionsOnKeys(q,"move");document.removeEventListener("onkeydown",this._cancelOrRemoveCB);document.removeEventListener(j.POINTERMOVE,this._keyMouseMoveCB);document.removeEventListener(j.POINTERUP,this._keyMoveMouseUpCB)},keyCopyMouseUp:function(q){this._ghostKey.classList.add("disable");this._actionsOnKeys(q,"copy");document.removeEventListener("onkeydown",this._cancelOrRemoveCB);document.removeEventListener(j.POINTERMOVE,this._keyMouseMoveCB);document.removeEventListener(j.POINTERUP,this._keyCopyMouseUpCB)},cancelOrRemove:function(q){if(q.keyCode===27||q.keyCode===46){if(q.keyCode===27){this._ghostKey.classList.add("disable")}else{this._ghostKey.classList.add("disable");this._actionsOnKeys("delete")}document.removeEventListener(j.POINTERMOVE,this._keyMouseMoveCB);document.removeEventListener(j.POINTERUP,this._keyMoveMouseUpCB);document.removeEventListener(j.POINTERUP,this._keyCopyMouseUpCB);document.removeEventListener("onkeydown",this._cancelOrRemoveCB)}},_actionsOnKeys:function(w,u){if(this._selectedElement){this._selectedElement.markerModel.selected=false}var s=w.clientX-this._timeFrame.getBoundingClientRect().left;var v=this.getTimeFromPixel(this._sliderPosition+s);var q=parseInt(this.getFrameFromTime(v));if(q>this._maxFrame){this._maxFrame=q}var t=-1;if(this._modelInterface.options.flattenKeys===true){var r=this.getTrackNodeModelFromPosition({x:s,y:this._selectedElement.getBoundingClientRect().bottom});if(r){t=r.options.id}}this._modelInterface.actionsOnKeys(w,u,this._selectedElement.markerModel,this._selectedElement.markerModel.options.markerBeginTime,q,this.options.scenario,t)},markerMouseDown:function(s){this._mousePosX=s.clientX;this._selectedElement=this.getMarkerObjSelected(s.target);var q=this._mousePosX-this._timeFrame.getBoundingClientRect().left;var r=this.getTimeFromPixel(this._sliderPosition+q);var t=Math.round(this.getFrameFromTime(r));r=this.getTimeFromFrame(t);this._markersHelper.style.left=this._selectedElement.div.style.left;this._markersTooltip.style.left=(parseFloat(this._selectedElement.div.style.left)+5)+"px";this._markersTooltip.innerText=this._convertIndexToDisplayTime(t)+" ("+parseInt(t)+")";this._markersHelper.style.display="block";this._markersTooltip.style.display="block";this._selectedElement.div.style.opacity=0.6;this._selectedElement.selected=true;document.addEventListener("keydown",this._markerCancelOrRemoveCB);document.addEventListener(j.POINTERMOVE,this._markerMouseMoveCB);document.addEventListener(j.POINTERUP,this._markerMouseUpCB)},getMarkerObjSelected:function(s){var r=this._markers.length;for(var q=0;q<r;q++){if(s.isEqualNode(this._markers[q].div)){return this._markers[q]}}},markerMouseMove:function(s){var q=this._scrollTimelineOnX(s,"marker");this.updatePosition(q,this._selectedElement.div);var r=this.getTimeFromPixel(this._sliderPosition+q);var t=parseInt(Math.round(this.getFrameFromTime(r)));if(t<0){t=0}r=this.getTimeFromFrame(t);this._markersHelper.style.left=this._selectedElement.div.style.left;this._markersTooltip.style.left=(parseFloat(this._selectedElement.div.style.left)+5)+"px";this._markersTooltip.innerText=this._convertIndexToDisplayTime(t)+" ("+parseInt(t)+")"},markerMouseUp:function(r){this._selectedElement.div.style.opacity=1;var q=r.clientX-this._timeFrame.getBoundingClientRect().left;var s=this.updatePosition(q,this._selectedElement.div);this._selectedElement.selected=false;this._selectedElement.frame=s;this._markersHelper.style.display="none";this._markersTooltip.style.display="none";document.removeEventListener("keydown",this._markerCancelOrRemoveCB);document.removeEventListener(j.POINTERMOVE,this._markerMouseMoveCB);document.removeEventListener(j.POINTERUP,this._markerMouseUpCB)},markerCancelOrRemove:function(r){if(r.keyCode===27||r.keyCode===46){if(r.keyCode===27){this._selectedElement.div.style.opacity=1;this._selectedElement.selected=false}else{this._selectedElement.div.remove();for(var q=0;q<this._markers.length;q++){if(this._markers[q].selected){this._markers.splice(q,1);break}}}this._selectedElement=null;this.updateMarkersPosition();this._markersHelper.style.display="none";this._markersTooltip.style.display="none";document.removeEventListener("keydown",this._markerCancelOrRemoveCB);document.removeEventListener(j.POINTERMOVE,this._markerMouseMoveCB);document.removeEventListener(j.POINTERUP,this._markerMouseUpCB)}},_createMarker:function(r,s,x,z,y){var v=this._createContainer("wux-Gauge-scale-label");var w=this.getTimeFromFrame(s);var q=this.getPixelFromTime(w)-this._sliderPosition;v.style.left=q+"px";v.style.marginTop="16px";v.addEventListener(j.POINTERDOWN,this._markerMouseDownCB);var u=document.createAttribute("marker-type");u.value=x;v.setAttributeNode(u);v.title=z;v.inject(this._markersContainer);var t={div:v,id:r,frame:s,type:x,selected:false,component:y};this._markers.push(t)},updateMarkersPosition:function(){var r=this._markers.length;for(var q=0;q<r;q++){if(!this._markers[q].selected){var s=this.getTimeFromFrame(this._markers[q].frame);var t=this.getPixelFromTime(s)-this._sliderPosition;this._markers[q].div.style.left=t+"px"}}},timeBarMouseDown:function(q){this._timeBarTooltip.style.display="inline-block";this._mousePosX=q.clientX;document.addEventListener(j.POINTERMOVE,this._timeBarMouseMoveCB);document.addEventListener(j.POINTERUP,this._timeBarMouseUpCB);this._sendEvent(this.options.event_timePosChangeStart)},timeBarMouseMove:function(s){this._timeBar.classList.remove("timeBarTransition");var q=this._scrollTimelineOnX(s,"timebar");var r=this.getTimeFromPixel(this._sliderPosition+q);var t=Math.max(0,parseInt(Math.round(this.getFrameFromTime(r))));if(t>=0){this._sendEvent(this.options.event_timePosChangeWhile,t)}},timeBarMouseOver:function(q){if(!(q.which===1)){this._timeBarTooltip.style.display="inline-block"}},timeBarMouseLeave:function(q){if(!(q.which===1)){this._timeBarTooltip.style.display="none"}},timeBarMouseUp:function(s){this._timeBarTooltip.style.display="none";document.removeEventListener(j.POINTERMOVE,this._timeBarMouseMoveCB);document.removeEventListener(j.POINTERUP,this._timeBarMouseUpCB);var q=this._scrollTimelineOnX(s,"timebar");var r=Math.max(0,this.getTimeFromPixel(this._sliderPosition+q));var t=parseInt(Math.round(this.getFrameFromTime(r)));this._sendEvent(this.options.event_timePosChangeEnd,t)},updateTimeBar:function(t){if(this.isVisible()===false){return}t=(t<0)?0:t;this._currentFrame=t;var s=this.getTimeFromFrame(t);var q=this.getPixelFromTime(s)-this._sliderPosition;this._timeBarH=(this._displayedTracks+1)*this._trackH;if(this._timeBar.style.height!==this._timeBarH+"px"){this._timeBar.style.height=this._timeBarH+"px"}if(q<=0&&this._sliderPosition!=0){if(this._timeBar.style.display!=="none"){this._timeBar.style.display="none";this._timeBarTooltip.style.display="none"}}else{if(this._timeBar.style.left!==q+"px"){this._timeBar.style.display="block";this._timeBar.style.left=q+"px";this._timeBarTooltip.style.left=q+parseInt(this._timeBar.style.width)+"px"}}var r=this._convertIndexToDisplayTime(t)+" ("+parseInt(t)+")";if(this._timeBarTooltip.innerText!==r){if(this.value_isNaN(r)){console.error("_timeBarTooltip is corrupted, for frame "+t)}else{this._timeBarTooltip.innerText=r}}},value_isNaN:function(q){return(q!==q)},setFitMode:function(q){this._fitMode=q;this._fitButton.checkFlag=q},getDisplayedTracks:function(){var q=this._timelineTreeDocument.getRoots();var s=0;for(var r=0;r<q.length;r++){s+=this.getDisplayedTracksChild(q[r])}return s},getTrackTreeListView:function(){return this._trackTreeListViewTracks},getTimelineModel:function(){return this._timelineTreeDocument},getDisplayedTracksChild:function(q){var s=0;if(q){s++;if(q._expandState=="collapseState"){var t=q.options.children;for(var r=0;r<t.length;r++){s+=this.getDisplayedTracksChild(t[r])}}}return s},updateNumberTracksDisplayed:function(){this._displayedTracks=this.getDisplayedTracks();var q={};q.numberOfRows=this._displayedTracks;q.numberOfColumns=this._maxFrame;this._bigData=this._modelInterface._generateGridData(this._displayedTracks,this._maxFrame);this.grid._destroyPool();this.grid.updateModel(this._bigData);this.updatePanelHeight();this.updateTimeBar(this._currentFrame);this.updateVerticalGridSeparatorHeight();this.updateTracksLine()},updateTracksLine:function(){var s=this._displayedTracks-this._tracksLine.length;if(s>0){for(var q=0;q<s;q++){var r=this._createContainer("trackLine").inject(this._tracksLinesContainer);this._tracksLine.push(r)}}for(var q=0;q<this._tracksLine.length;q++){this._tracksLine[q].style.display=(q<this._displayedTracks)?"block":"none"}},displayFromTo:function(s,r,q){this._isSliderMinPosition=(s<=0);this.findStepTime(this._panelW,r,q);this._delta=0;this.updateOnePixel();this.updateTimeBar(this._currentFrame);this.updateVerticalGridSeparatorHeight();this.updateMarkersPosition();this.updateCells(s-this._stepTime,-this._cellWidth);this._sliderPosition=this.getPixelFromTime(s);this._sliderPosition=parseFloat(this._sliderPosition.toFixed(1));this.updateGrid()},updatePosition:function(q,t){var r=this.getTimeFromPixel(this._sliderPosition+q);r=this.getTimeFromFrame(Math.round(this.getFrameFromTime(r)));var s=this.getPixelFromTime(r)-this._sliderPosition;t.style.left=(s<=0)?0+"px":s+"px";return Math.round(this.getFrameFromTime(r))},_scrollTimelineOnX:function(u,s){var v=u.clientX>this._mousePosX;this._mousePosX=u.clientX;var r=this._mousePosX-this._timeFrame.getBoundingClientRect().left;var t=parseFloat((r/this._panelW).toFixed(2))*100;var q=t>=90&&v;var x=t<=10&&!v&&this._sliderPosition>0;if(q||x){var w=q?89-t:11-t;if(w>this._sliderPosition){w=this._sliderPosition;this._isSliderMinPosition=true}this.updateTimeFrame(w);this._sliderPosition-=w;this.updateMarkersPosition();if(s!="timebar"){this.updateTimeBar(this._currentFrame)}this.updateGrid()}return r},updateCells:function(s,q){var u=0,t=0;s=parseFloat(s.toPrecision(12));for(var r=0;r<this._cellsNumber;r++){this._cells[r].style.width=this._cellWidth+"px";t=q+r*this._cellWidth;t=parseFloat(t.toFixed(3));this._cells[r].style.left=t+"px";u=s+r*this._stepTime;u=parseFloat(u.toPrecision(12));if(u<0){this._cells[r].style.display="none"}else{this._cells[r].style.display="block";this._updateCellValue(u,this._cells[r].children[0])}}},_updateCellValue:function(w,s){if(s===undefined){return}var q,v,u=0,r=0,t="";if(w>=86400){r=w%86400;u=(r==0)?w/86400:r/3600;q=(r==0)?"d":"h";v=(r==0)?"day":"hour"}else{if(w>=3600){r=w%3600;u=(r==0)?w/3600:r/60;q=(r==0)?"h":"min";v=(r==0)?"hour":"min"}else{if(w>=60){r=w%60;u=(r==0)?w/60:r;q=(r==0)?"min":"s";v=(r==0)?"min":"sec"}else{r=w*1000%1000;if(r==0){u=w;q="s";v="sec"}else{if((r%500)==0||(r%250)==0||(r%100)==0){u=r;v="dc"}else{if((r%50)==0||(r%25)==0||(r%10)==0){u=r.toString().substring(1);v="ct"}else{u=r.toString().substring(2);v="ms"}}q="ms"}}}}s.innerText=u+""+q;s.className=v},getTimeFromFrame:function(q){return q*this._timeMax/this._maxFrame},getFrameFromTime:function(q){return q*this._maxFrame/this._timeMax},getPixelFromTime:function(q){return q*this._cellWidth/this._stepTime},getTimeFromPixel:function(q){return q*this._stepTime/this._cellWidth},getFrameFromPixels:function(q){return 0},getPixelFromFrame:function(q){return 0},updateOnePixel:function(){this._onePixelInTime=this.getFrameFromTime(this._stepTime/this._cellWidth);if(this._timeBar){this._timeBar.style.width=1/this._onePixelInTime+"px"}},findStepTime:function(v,r,t){var s=Math.ceil(r/this._stepTime);if(t===undefined){t=this.getTimeFromPixel(v)>r}var u,q;while(true){u=this._cellWidthMin*s;q=this._cellWidthMax*s;if(v>=u&&v<=q){return this.findCellWidth(v,s)}else{if(!t&&v>q){return this.findCellWidth(v,s)}else{if(t&&v<u){this._stepTime=this.updateStepTime(this._stepTime,false);s=Math.ceil(r/this._stepTime);return this.findCellWidth(v,s)}}}this._stepTime=this.updateStepTime(this._stepTime,t);s=Math.ceil(r/this._stepTime)}},findCellWidth:function(s,q){for(var r=this._cellWidthMin;r<=this._cellWidthMax;r+=this._zoomPixels){if((r*q)>s){return}this._cellWidth=r}},updateStepTime:function(s,t){var q=0;var r=s<1;if(s<0.001){q=10000}else{if(s<0.01){q=1000}else{if(s<0.1){q=100}else{if(s<1){q=10}else{if(s<60){q=1}else{if(s<3600){q=60}else{if(s<86400){q=3600}else{q=86400}}}}}}}if(r){s*=q;q=1/q}else{s/=q}if(r){if(q!=0.001){if(s==1){s=t?0.5:2.5}else{if(s==2.5){s=t?1:5}else{if(s==5){s=t?2.5:10}else{if(s==10){s=t?5:10}}}}}else{if(s==1){s*=t?0.5:2}else{if(s==2){s=t?1:5}else{if(s==5){s=t?1:10}else{if(s==10){s=t?5:10}}}}}}else{if(q<=60){if(s<=1){s*=t?0.5:2}else{if(s==2){s=t?1:5}else{if(s==5){s=t?2:10}else{if(s==10){s=t?5:15}else{if(s==15){s=t?10:20}else{if(s==20){s=t?15:30}else{if(s==30){s=t?20:60}else{if(t&&s==60){s=30}}}}}}}}}else{if(s==1){s=t?1:2}else{if(s==2){s=t?1:4}else{if(s==4){s=t?2:8}else{if(s==8){s=t?4:12}else{if(s==12){s=t?8:24}else{s+=t?-24:24}}}}}}}return s*q},getSelectedTime:function(){if(!this.hasSelectedTime){return null}var q={};q.start=parseInt(Math.round(this.getFrameFromTime(this._selectionStart.x)));q.end=parseInt(Math.round(this.getFrameFromTime(this._selectionEnd.x)));q.targetedTracks=this._targetedTracks;return q},elementInViewport2:function(t,q){var s=q.x;var r=q.w;return(s<(t.x+t.w)&&(s+r)>t.x)},updateGrid:function(){var q=this._sliderPosition;this._timelineTreeDocument.prepareUpdate();this.renderMarkers(q);this.grid.setScrollerPosition({x:q,y:this.grid.getScrollerPosition().y},true);this._timelineTreeDocument.pushUpdate()},onRedraw:function(){if(this.isVisible()===false){return}if(this._timelineTreeDocument&&this._timelineTreeDocument.dirty&&this._timelineTreeDocument.lock===0){this.updateNumberTracksDisplayed();this.renderMarkers(this._sliderPosition);this._timelineTreeDocument.dirty=false}},renderMarkers:function(u){for(var t in this._listOfRenderedMarkers){this._listOfFreeMarkers.push(this._listOfRenderedMarkers[t]);this._listOfRenderedMarkers[t].remove();delete this._listOfRenderedMarkers[t]}var q=this.grid.getVirtualViewport();var v;var s=this._timelineTreeDocument.getRoots();for(v=0;v<=s.length;v++){var r=this._timelineTreeDocument.getRoots()[v];if(r){this.drawTracksKeys(u,r,this.grid,this._onePixelInTime,true)}}},removeKey:function(s){if(s){var q=this;var t="node_"+s._getID();var r=q._listOfRenderedMarkers[t];if(r!==undefined){q._listOfFreeMarkers.push(r);delete q._listOfRenderedMarkers[t]}s.remove()}},emptyMarkers:function(){for(var q in this._listOfRenderedMarkers){var r=this._listOfRenderedMarkers[q];r.markerModel=[];this._listOfFreeMarkers.push(r);r.remove();delete this._listOfRenderedMarkers[q]}},drawTracksKeys:function(x,z,q,r,s){if(this._timelineTreeDocument.lock){return}var u=this;var F=z._rowID;if(F===null){F=z._parentNode._rowID}if(F===null){F=z._parentNode._parentNode._rowID}var G=z.getChildren()||[];var E=z._options.preventDisplayChilds||z.hasChildren()||false;var y=z._options.preventDisplayChilds||(z._expandState!=="expandState"&&s);var t=F;if(E){for(var D=0;D<G.length;D++){var C=(G[D].hasChildren());t=this.drawTracksKeys(x,G[D],q,r,s)}if(y){F=t}}else{var H=z;var w="node_"+H._getID();if(u._listOfRenderedMarkers[w]!==undefined){u._listOfFreeMarkers.push(u._listOfRenderedMarkers[w]);u._listOfRenderedMarkers[w].remove();delete u._listOfRenderedMarkers[w]}var v=H.options.markerBeginTime/u._onePixelInTime;var A=H.options.markerDuration/u._onePixelInTime;var B=u.grid._scrollerDimensions?u.elementInViewport2({x:x,w:u.grid._scrollerDimensions.width},{x:v,w:A}):true;if(B){g.addTask({callback:function(J,K,L,N){if(u.isVisible()===false){this.destroy();return}var M="node_"+J._getID();var I;if(u._listOfRenderedMarkers[M]===undefined){if(u._listOfFreeMarkers.length>0){I=u._listOfFreeMarkers.pop()}else{I=new UWA.Element("div",{"class":"key",styles:{position:"absolute",height:u._trackH-6,top:N*u._trackH+3,left:L,width:K,background:J.options.markerColor}})}I.markerModel=J;I.inject(u._markersLayer);u._listOfRenderedMarkers[M]=I}else{I=u._listOfRenderedMarkers[M]}I.setStyles({top:N*u._trackH+3,left:L,width:K,background:J.options.markerColor,opacity:J.isSelected()?0.4:1});I.title=J.options.markerBeginTime;I.track=J.options.idGroup},taskArgs:[H,A,v,F]},w)}}return F},});return b});define("DS/VCXWebTimeline/VCXWebTimelineMain",["DS/VCXWebTimeline/VCXWebTimeline","DS/VCXWebTimeline/VCXWebTimelineMainView","DS/VCXWebTimeline/VCXWebTimelineLight",],function(d,b,a){var c=d.extend({init:function(f){this._parent(f);this._view=new b(f);var h=Object.assign({},f,f.toolbar);var g=h;if(g.parent){}else{g.parent=this.getView().getParentNode().getElementsByClassName("headerBarLeft")[0]}this._toolbar=new a(g);var e=this},unInitialize:function(){this._toolbar.unInitialize();this._toolbar=null;this._parent()},setIndexValue:function(e){if(this._index!==e){this._index=e;this.getView().updateTimeBar(e)}},setAnimationLoopMode:function(e){this._toolbar.setAnimationLoopMode(e)},setAnimationBounceMode:function(e){this._toolbar.setAnimationBounceMode(e)},setAnimationReverseMode:function(e){this._toolbar.setAnimationReverseMode(e)},setCameraPlayMode:function(e){this._toolbar.setCameraPlayMode(e)},setAutoKeyMode:function(e){this._toolbar.setAutoKeyMode(e)},getView:function(){return this._view},addMarkers:function(f){for(var e=0;e<f.length;e++){this.getView()._createMarker(f[e].id,f[e].frame,f[e].type,f[e].name,f[e].component)}},pauseGUIMode:function(){this._toolbar.pauseGUIMode()},playGUIMode:function(){this._toolbar.playGUIMode()},replayAnimation:function(){this._toolbar.replayAnimation()},updateGrid:function(){this.getView().updateGrid()},onRedraw:function(){this.getView().onRedraw()},removeKey:function(e){this.getView().removeKey(e)},emptyMarkers:function(){this.getView().emptyMarkers()},getTrackTreeListView:function(){return this.getView().getTrackTreeListView()},getTimelineModel:function(){return this.getView().getTimelineModel()},getSelectedTime:function(){return this.getView().getSelectedTime()}});return c});var VCXWebTimelineGUIEnum={Light:0,Main:1,Master:2};define("DS/VCXWebTimeline/VCXWebTimelineController",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Utilities/Color","DS/VCXWebTimeline/VCXWebTimelineLight","DS/VCXWebTimeline/VCXWebTimelineMain","DS/ApplicationFrame/CommandsManager",],function(b,c,e,i,g,f,a){var h=b.extend({init:function(k){var j=this;this.options=k;if(this.options.flattenKeys===undefined){this.options.flattenKeys=true}this.flattenKeysArray=[];this.listTracks=[];this.selectedTracks=[];this._nodeClass=null;this._isAnimationLoop=false;this._isAnimationBounce=false;this._isAnimationReverse=false;this._isCameraPlayMode=true;this._isAutoKeyMode=false;this._isFilterOnSelectionMode=false;this._timelines=[];this._startChangeTime=true;this.options.event_timePosChangeStart="VCX_Timeline_TIMEPOS_CHANGE_START";this.options.event_timePosChangeWhile="VCX_Timeline_TIMEPOS_CHANGE_WHILE";this.options.event_timePosChangeEnd="VCX_Timeline_TIMEPOS_CHANGE_END";this.options.event_play="VCX_Timeline_START_PLAY";this.options.event_pause="VCX_Timeline_PAUSE_PLAY";this.options.event_stop="VCX_Timeline_STOP_PLAY";this.options.event_stepBackward="VCX_Timeline_STEPBACKWARD_PLAY";this.options.event_stepForward="VCX_Timeline_STEPFORWARD_PLAY";this.options.event_loop="VCX_Timeline_Loop";this.options.event_bounce="VCX_Timeline_Bounce";this.options.event_reverse="VCX_Timeline_Reverse";this.options.event_previousMarker="VCX_Timeline_PREVIOUSMARKER_PLAY";this.options.event_nextMarker="VCX_Timeline_NEXTMARKER_PLAY";this.options.event_camera="VCX_Timeline_CAMERA_PLAY";this.options.event_goToMarker="VCX_Timeline_GO_TO_MARKER";this.options.event_removeSelectedTracks="VCX_Timeline_RemoveSelectedTracks";this.options.event_filterOnSelection="VCX_Timeline_FilterOnSelection";this.options.event_autoKey="VCX_Timeline_AutoKey";this.options.event_selectionArea="VCX_Timeline_SELECTION_AREA";this.options.event_selectionAreaMove="VCX_Timeline_SELECTION_AREA_MOVE";this.options.event_addTracksKey="VCX_Timeline_AddTracksKey";this._VCX_Timeline_TIMEPOS_CHANGE_START=e.subscribe({event:this.options.event_timePosChangeStart},function(l){j.onTimePosChangeStart(l)});this._VCX_Timeline_TIMEPOS_CHANGE_WHILE=e.subscribe({event:this.options.event_timePosChangeWhile},function(l){j.onTimePosChangeWhile(l)});this._VCX_Timeline_TIMEPOS_CHANGE_END=e.subscribe({event:this.options.event_timePosChangeEnd},function(l){j.onTimePosChangeEnd(l)});this._VCX_Timeline_START_PLAY=e.subscribe({event:this.options.event_play},function(){j.onStartPlay()});this._VCX_Timeline_PAUSE_PLAY=e.subscribe({event:this.options.event_pause},function(){j.onPausePlay()});this._VCX_Timeline_STOP_PLAY=e.subscribe({event:this.options.event_stop},function(){j.onStopPlay()});this._VCX_Timeline_STEPBACKWARD_PLAY=e.subscribe({event:this.options.event_stepBackward},function(){j.onTimelineStepBackward()});this._VCX_Timeline_STEPFORWARD_PLAY=e.subscribe({event:this.options.event_stepForward},function(){j.onTimelineStepForward()});this._VCX_Timeline_CAMERA_PLAY=e.subscribe({event:this.options.event_camera},function(l){j.onTimelineCamera(l)});this._VCX_Timeline_AutoKey=e.subscribe({event:this.options.event_autoKey},function(l){j.onTimelineAutoKey(l)});this._VCX_Timeline_PREVIOUSMARKER_PLAY=e.subscribe({event:this.options.event_previousMarker},function(){j.OnTimelinePreviousMarker()});this._VCX_Timeline_NEXTMARKER_PLAY=e.subscribe({event:this.options.event_nextMarker},function(){j.onTimelineNextMarker()});this._VCX_Timeline_GO_TO_MARKER=e.subscribe({event:this.options.event_goToMarker},function(l){j.onTimelineGoToMarker(l)});this._VCX_Timeline_RemoveSelectedTracks=e.subscribe({event:this.options.event_removeSelectedTracks},function(){j.getTimelineModel().dirty=false;j.emptyMarkers(false);j.onRemoveSelectedTracks();j.getTimelineModel().prepareUpdate();j.generateListOfMarkers();j.getTimelineModel().pushUpdate();j.getTimelineModel().dirty=true;j.onRedraw()});this._VCX_Timeline_FilterOnSelection=e.subscribe({event:this.options.event_filterOnSelection},function(l){j.onToggleFilterOnSelection(l)});this._tokenSelectionAdd=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},function(){j.onCSOChange()});this._tokenSelectionRemove=e.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},function(){j.onCSOChange()});this._VCX_Timeline_LOOP=e.subscribe({event:this.options.event_loop},function(l){j.setTimelineLoop(l)});this._VCX_Timeline_BOUNCE=e.subscribe({event:this.options.event_bounce},function(l){j.setTimelineBounce(l)});this._VCX_Timeline_REVERSE=e.subscribe({event:this.options.event_reverse},function(l){j.setTimelineReverse(l)});this._VCX_Timeline_SELECTION_AREA=e.subscribe({event:this.options.event_selectionArea},function(l){j.onSelectionArea(l)});this._VCX_Timeline_SELECTION_AREA_MOVE=e.subscribe({event:this.options.event_selectionAreaMove},function(l){j.onSelectionAreaMove(l)});this._VCX_Timeline_ADD_TRACKS_KEY=e.subscribe({event:this.options.event_addTracksKey},function(l){j.onAddTracksKey(l)})},createTimeline:function(j){j.modelInterface=this;var l=Object.assign({},this.options,j);var k=null;if(j.timelineGUI===VCXWebTimelineGUIEnum.Light){k=new g(l)}else{if(j.timelineGUI===VCXWebTimelineGUIEnum.Main){k=new f(l)}else{if(j.timelineGUI===VCXWebTimelineGUIEnum.Master){}else{return}}}var m={timeline:k,options:j};this._timelines.push(m);if(j.timelineGUI===VCXWebTimelineGUIEnum.Main){k.getTrackTreeListView().getDocument().getPXSO().onAdd(function(o){if(o.options.data&&o.options.data.pathElement){var n=o.options.data.pathElement;WUX.Selection.PSOManager.add({pathElement:n})}});k.getTrackTreeListView().getDocument().getPXSO().onRemove(function(o){if(o.options.data&&o.options.data.pathElement){var n=o.options.data.pathElement;WUX.Selection.PSOManager.remove({pathElement:n})}});k.getTrackTreeListView().getDocument().getXSO().onAdd(function(o){if(o.options.data&&o.options.data.pathElement){var n=o.options.data.pathElement;WUX.Selection.CSOManager.add({pathElement:n})}});k.getTrackTreeListView().getDocument().getXSO().onRemove(function(o){if(o.options.data&&o.options.data.pathElement){var n=o.options.data.pathElement;WUX.Selection.CSOManager.remove({pathElement:n})}})}},getTrackTreeListView:function(){console.error("VCXWebTimelineController::getTrackTreeListView() must be implemented on app's side");return null},getTimelineModel:function(){console.error("VCXWebTimelineController::getTimelineModel() must be implemented on app's side");return null},unInitialize:function(){this.selectedTracks=[];this.emptyMarkers();this.emptyTreeTracks();this.RemoveTimelineEvents();for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.unInitialize();this._timelines[j].timeline=null;this._timelines[j].options=null}this._timelines=[]},addMarkers:function(k){for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.addMarkers(k)}},setIndexValue:function(j){for(var k=0;k<this._timelines.length;k++){this._timelines[k].timeline.setIndexValue(j)}},getSelectedTime:function(){var k={};for(var j=0;j<this._timelines.length;j++){k=this._timelines[j].timeline.getSelectedTime();if(k){return k}}return null},setAnimationLoopMode:function(k){if(this._isAnimationLoop===k){return}this._isAnimationLoop=k;for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.setAnimationLoopMode(k)}},setAnimationBounceMode:function(k){if(this._isAnimationBounce===k){return}this._isAnimationBounce=k;for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.setAnimationBounceMode(k)}},setAnimationReverseMode:function(k){if(this._isAnimationReverse===k){return}this._isAnimationReverse=k;for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.setAnimationReverseMode(k)}},setCameraPlayMode:function(k){if(this._isCameraPlayMode===k){return}this._isCameraPlayMode=k;for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.setCameraPlayMode(k)}},setAutoKeyMode:function(k){if(this._isAutoKeyMode===k){return}this._isAutoKeyMode=k;for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.setAutoKeyMode(k)}},setFilterOnSelectionMode:function(k){this._isFilterOnSelectionMode=k;for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.setFilterOnSelectionMode(k)}},getFilterOnSelectionMode:function(){return this._isFilterOnSelectionMode},updateTimelineFromModel:function(){var j=this.getFrameFromModel();this.setIndexValue(j);this.setAnimationLoopMode(this._isAnimationLoop);this.setAnimationBounceMode(this._isAnimationBounce);this.setAnimationReverseMode(this._isAnimationReverse);this.setCameraPlayMode(this._isCameraPlayMode)},RemoveTimelineEvents:function(){e.unsubscribe(this._VCX_Timeline_TIMEPOS_CHANGE_START);e.unsubscribe(this._VCX_Timeline_TIMEPOS_CHANGE_WHILE);e.unsubscribe(this._VCX_Timeline_TIMEPOS_CHANGE_END);e.unsubscribe(this._VCX_Timeline_START_PLAY);e.unsubscribe(this._VCX_Timeline_PAUSE_PLAY);e.unsubscribe(this._VCX_Timeline_STOP_PLAY);e.unsubscribe(this._VCX_Timeline_STEPBACKWARD_PLAY);e.unsubscribe(this._VCX_Timeline_STEPFORWARD_PLAY);e.unsubscribe(this._VCX_Timeline_CAMERA_PLAY);e.unsubscribe(this._VCX_Timeline_AutoKey);e.unsubscribe(this._VCX_Timeline_PREVIOUSMARKER_PLAY);e.unsubscribe(this._VCX_Timeline_NEXTMARKER_PLAY);e.unsubscribe(this._VCX_Timeline_GO_TO_MARKER);e.unsubscribe(this._VCX_Timeline_LOOP);e.unsubscribe(this._VCX_Timeline_BOUNCE);e.unsubscribe(this._VCX_Timeline_REVERSE);e.unsubscribe(this._VCX_Timeline_SELECTION_AREA);e.unsubscribe(this._VCX_Timeline_SELECTION_AREA_MOVE);e.unsubscribe(this._VCX_Timeline_ADD_TRACKS_KEY);e.unsubscribe(this._VCX_Timeline_RemoveSelectedTracks);e.unsubscribe(this._VCX_Timeline_FilterOnSelection);e.unsubscribe(this._tokenSelectionRemove);e.unsubscribe(this._tokenSelectionAdd);this._VCX_Timeline_TIMEPOS_CHANGE_START=0;this._VCX_Timeline_TIMEPOS_CHANGE_WHILE=0;this._VCX_Timeline_TIMEPOS_CHANGE_END=0;this._VCX_Timeline_START_PLAY=0;this._VCX_Timeline_PAUSE_PLAY=0;this._VCX_Timeline_STOP_PLAY=0;this._VCX_Timeline_STEPBACKWARD_PLAY=0;this._VCX_Timeline_STEPFORWARD_PLAY=0;this._VCX_Timeline_CAMERA_PLAY=0;this._VCX_Timeline_AutoKey=0;this._VCX_Timeline_PREVIOUSMARKER_PLAY=0;this._VCX_Timeline_NEXTMARKER_PLAY=0;this._VCX_Timeline_GO_TO_MARKER=0;this._VCX_Timeline_LOOP=0;this._VCX_Timeline_BOUNCE=0;this._VCX_Timeline_REVERSE=0;this._VCX_Timeline_SELECTION_AREA=0;this._VCX_Timeline_SELECTION_AREA_MOVE=0;this._VCX_Timeline_ADD_TRACKS_KEY=0;this._VCX_Timeline_RemoveSelectedTracks=0;this._VCX_Timeline_FilterOnSelection=0;this._tokenSelectionRemove=0;this._tokenSelectionAdd=0},onTimePosChangeStart:function(){},onTimePosChangeWhile:function(j){this.ChangeTimePos(j,false)},onTimePosChangeEnd:function(j){this.ChangeTimePos(j,true)},onStartPlay:function(){for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.pauseGUIMode()}},onStopPlay:function(){for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.playGUIMode()}},onPausePlay:function(){for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.playGUIMode()}},setTimelineLoop:function(k){var j=this;if(k!=j._isAnimationLoop){j.setScenarioAnimationLoop(k);j.setAnimationLoopMode(k)}},setTimelineBounce:function(k){var j=this;if(k!=j._isAnimationBounce){j.setScenarioAnimationBounce(k);j.setAnimationBounceMode(k)}},setTimelineReverse:function(k){var j=this;if(k!=j._isAnimationReverse){j.setScenarioAnimationReverse(k);j.setAnimationReverseMode(k)}},setScenarioAnimationLoop:function(j){},setScenarioAnimationBounce:function(j){},setScenarioAnimationReverse:function(j){},onTimelineGoToMarker:function(j){},onRemoveSelectedTracks:function(){var j=this.getTrackTreeListView().getManager().getSelectedCells();var k=this.getSelectedTime();if(k){this.removeTracksFromModel(k.targetedTracks,k.start,k.end)}else{this.removeTracksFromModel(j)}},removeTracksFromModel:function(k,m,n){var l=[];var j=this;k.forEach(function(r,u,t){if(r._view===undefined&&r._manager){return}var o=r._view?r.getView()._cellInfos.nodeModel:r;var q=o.getChildren();if(j.options.flattenKeys===false){if(o.isRoot()){var s=q;if(s){for(var p=0;p<s.length;p++){l.push(s[p])}}}else{l.push(o)}o.remove()}else{if(q&&!o._options.preventDisplayChilds){j.removeTracksFromModel(q)}else{if(m&&n){j.removeTrackFromModelFlatten(o,m,n)}else{o.removeChildren();j.removeTrackFromModelFlatten(o)}}}},j);this.removeTrackFromModel(l,m,n)},removeTrackFromModel:function(k,j,l){},removeTrackFromModelFlatten:function(k,j,l){},onSelectionArea:function(k){var j=[];return j},onSelectionAreaMove:function(j){this.getTimelineModel().dirty=true;if(this.options.flattenKeys===false){}else{this.onSelectionAreaMoveFlatten(j)}},moveKeysAreaFromModelFlatten:function(j){},onAddTracksKey:function(j){console.error("VCXWebTimelineController::onAddTracksKey() must be implemented on app's side")},getTrackModelFromTrackNode:function(j){},onTimelineNextMarker:function(){},OnTimelinePreviousMarker:function(){},onTimelineCamera:function(k){var j=this;j._isCameraPlayMode=k},onTimelineAutoKey:function(o){var m=this;m._isAutoKeyMode=o;var l=this.options.frmWindow;var k=l._experienceBase;var j=k.getManager("VCXContextManager").getContext();var n=a.getCommandCheckHeader("VCXAutoKeyCmd",j);if(n){n.setState(this._isAutoKeyMode)}},onToggleFilterOnSelection:function(k){var j=this;j._isFilterOnSelectionMode=k;j.emptyMarkers();j.generateListOfMarkers();j.updateGrid()},onCSOChange:function(){if(this._isFilterOnSelectionMode){this.emptyMarkers();this.generateListOfMarkers();this.updateGrid()}if(this.options.flattenKeys===false){}},onTimelineStepForward:function(){},onTimelineStepBackward:function(){},ChangeTimePos:function(k,j){},_createTrackNode:function(n,k,o,m,q,p){if(o===-1){o=gridModel.getChildren().length}var j=this;var l=new n({label:k,id:o,grid:{type:"",setKey:""}});m.addChild(l);o++;l.onPostExpand(function(){j.expandCallBack(j.getTimelineModel())});l.onPostCollapse(function(){j.collapseCallBack(j.getTimelineModel())});return l},expandCallBack:function(j){j.dirty=true},collapseCallBack:function(j){j.dirty=true},selectCallBack:function(j){target.select();var k=target.options.id;if(this.options.flattenKeys===false){if(target.isRoot()){k=target._localID}else{k=target._parentNode._localID+target._localID+1}}this.selectedTracks[k]=target},unselectCallBack:function(j){target.unselect();if(this.selectedTracks.length===0){return}var k=target.options.id;if(this.options.flattenKeys===false){if(target.isRoot()){k=target._localID}else{k=target._parentNode._localID+target._localID+1}}this.selectedTracks.splice(k,1)},clearKeys:function(j,k){},emptyTreeTracks:function(){if(this.getTrackTreeListView()){var j=this.getTrackTreeListView().getDocument();j.empty()}if(this.getTimelineModel()){var k=this.getTimelineModel();k.empty()}},_generateTreeTracks:function(l){l.prepareUpdate();if(this.options.flattenKeys){var r=0;var q=["Position","Materials","Opacity","Camera","Properties"];var o=["Links","Viewport","Digger","Others"];for(var n=0;n<q.length;n++){var k=this._createTrackNode(this._nodeClass,q[n],r,l._getTrueRoot());r=1+k.options.id;if(q[n]==="Properties"){for(var m=0;m<o.length;m++){var p=this._createTrackNode(this._nodeClass,o[m],r,k);r=1+p.options.id;p._options.preventDisplayChilds=true}}else{k._options.preventDisplayChilds=true}}}else{this.generateClientTreeTracks(l)}l.pushUpdate()},emptyMarkers:function(){for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.emptyMarkers()}},setNodeModel:function(j){this._nodeClass=j},generateTracksData:function(j){this._generateTreeTracks(j);this.generateListOfMarkers(undefined,undefined,undefined,j)},onRedraw:function(){for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.onRedraw()}},_updateListOfMarkers:function(m,q,n){if(this.getTimelineModel()){this.getTimelineModel().lock++}if(n===undefined){return}var E;var w;var u;var v;var x;var F;var G;var C=this.getTimelineModel();for(var p=0;p<n.length;p++){E=n[p];if(this.options.flattenKeys===true){w=this.convertTrackToId(E.propertyName,E.modifiable.GetObject().GetType())}else{}u=E.frame;v=E.modifiable.GetHashing();x=E.modifiable;F=E.propertyName;G=E.value;if(E.value){var B="#ababab";if(w===1&&E.value.GetValue()&&E.value.GetValue().GetColorHexString){B="#"+E.value.GetValue().GetColorHexString()}this._addKey(u,1,B,w,v,F,G)}else{if(this.options.flattenKeys===false){var t=C.getRoots()||[];var l=null;var o=null;var D=null;var H=null;for(var A=0;A<t.length;A++){l=t[A];if(l.options._hash===v){o=l.getChildren()||[];for(var z=0;z<o.length;z++){if(o[z].options.label===F){D=o[z].getChildren()||[];for(var y=0;y<D.length;y++){if(D[y]._options.markerBeginTime===u){this.removeKey(D[y]);break}break}break}}break}}}else{if(this.flattenKeysArray[w]&&this.flattenKeysArray[w][u]&&this.flattenKeysArray[w][u][F]){this.flattenKeysArray[w][u][F]=this.flattenKeysArray[w][u][F].splice(v,1);if(Object.keys(this.flattenKeysArray[w][u][F]).length===0){delete this.flattenKeysArray[w][u][F]}if(Object.keys(this.flattenKeysArray[w][u]).length===0){delete this.flattenKeysArray[w][u]}}var H;var s=C.search({match:function(j){if(j.nodeModel.options.id===w){return true}}});var o=s[0].getChildren()||[];for(var r=o.length-1;r>=0;r--){H=o[r];if(H.options.markerBeginTime===parseInt(u)){this.removeKey(H)}}}}}if(this.getTimelineModel()){this.getTimelineModel().lock--;this.getTimelineModel().dirty=true}this.onRedraw()},_removeMarkers:function(n,m,p,o){for(var l=0;l<n.length;l++){var k=n[l];if(k&&this.listTracks&&k.options.componentHash===o){if(this.listTracks[m].options.children){delete n._vcxArrayKeys[p][l];this.listTracks[m].removeChild(k);this.removeKey(k)}else{delete this.listTracks[m]._vcxArrayKeys[p][l];this.removeKey(k)}break}}},_updateListOfMarkersGroup:function(p,o,n){if(n===undefined){return}var m;var k;var x;var y;var u;var t;for(var s=0;s<n.length;s++){m=n[s];if(this.options.flattenKeys===true){o=this.convertTrackToId(m.propertyName,m.modifiable.GetObject().GetType())}else{}k=m.frame;x=m.modifiable.GetHashing();y=m.modifiable;u=m.propertyName;t=m.value;if(m.value){var w="#cccccc";if(o===3){w="#"+m.value.GetValue().GetColorHexString()}var r=this._createKey(k,1,w,o,x,y,u,t);if(r._listProperties){}else{r._listProperties={}}if(r._listProperties[x]){}else{r._listProperties[x]={}}r._listProperties[x][u]=true;var l=false;if(this.listTracks[o]._vcxArrayKeys[k]===undefined){this.listTracks[o]._vcxArrayKeys[k]=[];l=true}this.listTracks[o]._vcxArrayKeys[k].push(r);if(l){this.listTracks[o].addChild(r)}}else{var v=this.listTracks[o]._vcxArrayKeys[k];if(v){for(var q=0;q<v.length;q++){var r=v[q];if(r&&this.listTracks&&r.options.componentHash===x){if(this.listTracks[o].options.children){this.listTracks[o].removeChild(r)}delete this.listTracks[o]._vcxArrayKeys[k][q];this.removeKey(r);break}}}}}},removeKey:function(j){for(var k=0;k<this._timelines.length;k++){this._timelines[k].timeline.removeKey(j)}},updateGrid:function(){for(var j=0;j<this._timelines.length;j++){this._timelines[j].timeline.updateGrid()}},convertTrackToId:function(j,m){var l=j;var k=8;if(l.search("Digger.")!==-1||m==="VCXComponentDigger"){k=7}else{if((l.search("Camera.")!==-1)||(l.search("Viewpoint.")!==-1)||m==="VCXComponentCamera"){k=3}else{if((l.search("Viewport.")!==-1)||(m==="VCXComponentViewport")){k=6}else{if(l==="Actor.Position"){k=0}else{if(l==="Actor.Opacity"){k=2}else{if((l==="Actor.Color")||(l.search("Actor.Env")!==-1)||(l.search("Actor.Texture")!==-1)){k=1}else{if(l==="Actor.Hyperlink"){k=5}}}}}}}return k},generateListOfMarkers:function(l,m,k,j){console.error("VCXWebTimelineController::generateListOfMarkers() must be implemented on app's side");return[]},generateClientTreeTracks:function(j){console.error("VCXWebTimelineController::generateClientTreeTracks() must be implemented on app's side")},_createKey:function d(p,n,k,j,m,l,o){return new this._nodeClass({label:p,markerBeginTime:p,markerDuration:n,markerColor:k,idGroup:j,componentHash:m,strPropertyName:l,key:o})},_addKey:function(v,l,C,y,w,H,I,E){if(this.options.flattenKeys===true){var q=this.flattenKeysArray[y]||[];if(q.tracksNames===undefined){q.tracksNames={}}q[v]=q[v]||[];q[v][H]=q[v][H]||[];var x=q[v][H][w];if(x){}else{x={length:1,keyColor:C,componentHash:w,strPropertyName:H,data:I};q.tracksNames.strPropertyName=1}q[v][H][w]=x;this.flattenKeysArray[y]=q;if(Object.keys(q[v]).length>1){return}}else{}E=E||this.getTimelineModel();var s=this._createKey(v,l,C,y,w,H,I);var m=null;if(this.options.flattenKeys===true){var z=y;var n=E.getRoots();for(var F=0;F<n.length;F++){var u=n[F];if(u._options.id===z){m=u;break}else{if(F===4){var o=E.getNthRoot(F).getChildren();for(var D=0;D<o.length;D++){var G=o[D];if(G._options.id===z){m=G;break}}}}}}else{var t=E.getRoots()||[];var k=null;var p=null;for(var B=0;B<t.length;B++){k=t[B];if(k.options._hash===w){p=k.getChildren()||[];for(var A=0;A<p.length;A++){if(p[A].options.label===H){m=p[A];break}}break}}}var r=false;r=true;if(m){m.addChild(s);if(this.getTimelineModel()){this.getTimelineModel().dirty=true}}return r},_generateGridData:function(l,m){var j=new Array(l);for(var k=0;k<l;k++){j[k]=new Array(m)}return j},actionsOnKeys:function(r,l,o,m,t,q,p,j){this.getTimelineModel().lock++;if(this.options.flattenKeys===false){if(o._options.key){this.getTimelineModel().dirty=true;this.actionOnKey(l,q,o._options.componentHash,o._options.strPropertyName,m,t,o._options.key.GetValue(),j)}}else{if(p!==4){var u=this.flattenKeysArray[p][m];for(var s in u){for(var k in u[s]){this.getTimelineModel().dirty=true;this.actionOnKey(l,q,k,s,m,t,u[s][k].data.GetValue(),j)}}}else{for(var n=5;n<9;n++){var u=this.flattenKeysArray[n][m];for(var s in u){for(var k in u[s]){this.getTimelineModel().dirty=true;this.actionOnKey(l,q,k,s,m,t,u[s][k].data.GetValue(),j)}}}}}this.getTimelineModel().lock--;this.getTimelineModel().dirty=true;this.onRedraw()},actionOnKey:function(o,m,l,p,j,k,n){},getFrameFromModel:function(){console.error("VCXWebTimelineController::getFrameFromModel() must be implemented on app's side")},getSelection:function(){console.error("VCXWebTimelineController::getSelection() must be implemented on app's side")},getCurrentSelection:function(){console.error("VCXWebTimelineController::getCurrentSelection() must be implemented on app's side")},});return h});